exports.id=130,exports.ids=[130],exports.modules={34130:(e,t,r)=>{"use strict";let i,n,a,s,o,l,u,c,h,d,f,p,m,g,A,v,y,E,x,_,b,S,w,C,T,I,M,R,B,D,P,L,k,F,O,U,N,z,G,H,Q,V,W,j,Y,K,q,X,$,J,Z,ee,et,er;r.r(t),r.d(t,{AccumulativeShadows:()=>Pw,AdaptiveDpr:()=>LJ,AdaptiveEvents:()=>LZ,ArcballControls:()=>wF,AsciiRenderer:()=>SH,BBAnchor:()=>R7,Backdrop:()=>PD,BakeShadows:()=>Lj,Billboard:()=>Ez,Bounds:()=>DO,Box:()=>Du,Bvh:()=>RJ,CameraControls:()=>Cy,CameraShake:()=>DQ,Capsule:()=>DC,CatmullRomLine:()=>xf,Caustics:()=>PN,Center:()=>Bn,Circle:()=>Dc,Clone:()=>bP,Cloud:()=>La,CloudInstance:()=>Ln,Clouds:()=>Li,ComputedAttribute:()=>bB,Cone:()=>Dh,ContactShadows:()=>P_,CubeCamera:()=>S3,CubeTexture:()=>C2,CubicBezierLine:()=>xd,CurveModifier:()=>Bz,CycleRaycast:()=>fn,Cylinder:()=>Dd,Decal:()=>bV,Detailed:()=>LV,DetectGPU:()=>Me,DeviceOrientationControls:()=>wr,Dodecahedron:()=>Db,DragControls:()=>pb,Edges:()=>bc,Effects:()=>_8,Environment:()=>Py,EnvironmentCube:()=>Pg,EnvironmentMap:()=>Pm,EnvironmentPortal:()=>PA,Example:()=>Ba,Extrude:()=>DS,FaceControls:()=>FI,FaceLandmarker:()=>Fb,FaceLandmarkerDefaults:()=>F_,Facemesh:()=>FA,FacemeshDatas:()=>FE,FacemeshEye:()=>Fy,FacemeshEyeDefaults:()=>Fv,Fbo:()=>S$,Fbx:()=>In,FirstPersonControls:()=>w6,Fisheye:()=>L7,Float:()=>DV,FlyControls:()=>wl,GizmoHelper:()=>CU,GizmoViewcube:()=>Cq,GizmoViewport:()=>CJ,Gltf:()=>Sz,GradientTexture:()=>_7,GradientType:()=>_9,Grid:()=>C0,Helper:()=>IH,Html:()=>fi,Hud:()=>CC,Icosahedron:()=>Dx,Image:()=>bu,Instance:()=>Bb,InstancedAttribute:()=>BT,Instances:()=>BS,IsObject:()=>bt,KeyboardControls:()=>Em,Ktx2:()=>IR,Lathe:()=>Dw,Lightformer:()=>Pq,Line:()=>xu,Loader:()=>fm,MapControls:()=>wv,MarchingCube:()=>bN,MarchingCubes:()=>bU,MarchingPlane:()=>bz,Mask:()=>L8,MatcapTexture:()=>Lp,Merged:()=>Bw,MeshDiscardMaterial:()=>De,MeshDistortMaterial:()=>BH,MeshPortalMaterial:()=>kr,MeshReflectorMaterial:()=>BK,MeshRefractionMaterial:()=>B6,MeshTransmissionMaterial:()=>B7,MeshWobbleMaterial:()=>BV,MotionPathControls:()=>CS,MultiMaterial:()=>Dt,NormalTexture:()=>Lg,Octahedron:()=>D_,OrbitControls:()=>wy,OrthographicCamera:()=>SZ,Outlines:()=>bd,PerformanceMonitor:()=>L1,PerspectiveCamera:()=>S1,PivotControls:()=>Fd,Plane:()=>Dp,Point:()=>LF,PointMaterial:()=>Dn,PointMaterialImpl:()=>Di,PointerLockControls:()=>w0,Points:()=>LU,PointsBuffer:()=>LO,Polyhedron:()=>DE,PositionMesh:()=>Bp,PositionPoint:()=>LB,PositionalAudio:()=>xp,Preload:()=>LW,PresentationControls:()=>Ed,Progress:()=>ff,QuadraticBezierLine:()=>xh,RandomizedLight:()=>PC,Reflector:()=>Pz,RenderCubeTexture:()=>L5,RenderTexture:()=>L3,Resize:()=>DB,Ring:()=>Dy,RoundedBox:()=>DI,Sampler:()=>bR,ScreenQuad:()=>DR,ScreenSizer:()=>Eq,ScreenSpace:()=>EG,ScreenVideoTexture:()=>Ff,Scroll:()=>mm,ScrollControls:()=>md,Segment:()=>LQ,SegmentObject:()=>LG,Segments:()=>Lz,Select:()=>EU,Shadow:()=>PP,ShadowAlpha:()=>LC,Shape:()=>DT,Sky:()=>P1,SoftShadows:()=>Do,Sparkles:()=>Ld,Sphere:()=>Df,Splat:()=>Sq,SpotLight:()=>PK,SpotLightShadow:()=>PY,SpriteAnimator:()=>BB,Stage:()=>PR,Stars:()=>P4,Stats:()=>Ij,StatsGl:()=>Iq,Svg:()=>bj,Tetrahedron:()=>Dv,Text:()=>_E,Text3D:()=>_k,Texture:()=>bi,Torus:()=>Dg,TorusKnot:()=>DA,TrackballControls:()=>wS,Trail:()=>bw,TrailTexture:()=>Bi,TransformControls:()=>wQ,Tube:()=>Dm,VideoTexture:()=>IF,View:()=>kw,WebcamVideoTexture:()=>Fp,Wireframe:()=>Lw,accumulativeContext:()=>Pb,calcPosFromAngles:()=>P0,calculateScaleFactor:()=>EY,checkIfFrameIsEmpty:()=>IN,createInstances:()=>BC,getFirstFrame:()=>IU,isWebGL2Available:()=>_6,meshBounds:()=>L$,shaderMaterial:()=>be,useAnimations:()=>R0,useAspect:()=>I$,useBVH:()=>R$,useBounds:()=>DU,useBoxProjectedEnv:()=>R6,useCamera:()=>IJ,useContextBridge:()=>RZ,useCubeCamera:()=>S2,useCubeTexture:()=>C1,useCursor:()=>fa,useDepthBuffer:()=>IX,useDetectGPU:()=>I7,useEnvironment:()=>Ps,useFBO:()=>SX,useFBX:()=>Ii,useFaceControls:()=>FM,useFaceLandmarker:()=>FS,useFont:()=>_D,useGLTF:()=>SN,useGizmoContext:()=>CI,useHelper:()=>IG,useIntersect:()=>R1,useKTX2:()=>IM,useKeyboardControls:()=>Eg,useMask:()=>L9,useMatcapTexture:()=>Lf,useMotion:()=>C_,useNormalTexture:()=>Lm,usePerformanceMonitor:()=>L2,useProgress:()=>fd,useScroll:()=>mh,useSelect:()=>EN,useSpriteAnimator:()=>BM,useSpriteLoader:()=>Iz,useSurfaceSampler:()=>bM,useTexture:()=>br,useTrail:()=>bS,useTrailTexture:()=>Br,useVideoTexture:()=>Ik});var ei,en,ea,es,eo,el,eu,ec,eh,ed,ef,ep,em,eg,eA,ev,ey,eE,ex,e_,eb,eS,ew,eC,eT,eI,eM,eR,eB,eD,eP,eL,ek,eF,eO={};function eU(){return(eU=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)({}).hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(null,arguments)}r.r(eO),r.d(eO,{ACESFilmicToneMapping:()=>tP,AddEquation:()=>e9,AddOperation:()=>tI,AdditiveAnimationBlendMode:()=>r6,AdditiveBlending:()=>e4,AgXToneMapping:()=>tk,AlphaFormat:()=>ro,AlwaysCompare:()=>iF,AlwaysDepth:()=>ty,AlwaysStencilFunc:()=>iI,AmbientLight:()=>cx,AnimationAction:()=>hi,AnimationClip:()=>u0,AnimationLoader:()=>u9,AnimationMixer:()=>ha,AnimationObjectGroup:()=>hr,AnimationUtils:()=>uG,ArcCurve:()=>lB,ArrayCamera:()=>cG,ArrowHelper:()=>h3,AttachedBindMode:()=>tO,Audio:()=>cq,AudioAnalyser:()=>c1,AudioContext:()=>ck,AudioListener:()=>cK,AudioLoader:()=>cF,AxesHelper:()=>h4,BackSide:()=>e0,BasicDepthPacking:()=>ie,BasicShadowMap:()=>eq,BatchedMesh:()=>o$,Bone:()=>ou,BooleanKeyframeTrack:()=>uY,Box2:()=>h_,Box3:()=>nL,Box3Helper:()=>h0,BoxGeometry:()=>s_,BoxHelper:()=>hZ,BufferAttribute:()=>a1,BufferGeometry:()=>sl,BufferGeometryLoader:()=>cI,ByteType:()=>t5,Cache:()=>u1,Camera:()=>sI,CameraHelper:()=>hX,CanvasTexture:()=>lm,CapsuleGeometry:()=>lv,CatmullRomCurve3:()=>lO,CineonToneMapping:()=>tD,CircleGeometry:()=>ly,ClampToEdgeWrapping:()=>tj,Clock:()=>cH,Color:()=>aQ,ColorKeyframeTrack:()=>uK,ColorManagement:()=>nA,CompressedArrayTexture:()=>lf,CompressedCubeTexture:()=>lp,CompressedTexture:()=>ld,CompressedTextureLoader:()=>u7,ConeGeometry:()=>lx,ConstantAlphaFactor:()=>tg,ConstantColorFactor:()=>tp,Controls:()=>h6,CubeCamera:()=>sP,CubeReflectionMapping:()=>tz,CubeRefractionMapping:()=>tG,CubeTexture:()=>sL,CubeTextureLoader:()=>cr,CubeUVReflectionMapping:()=>tV,CubicBezierCurve:()=>lG,CubicBezierCurve3:()=>lH,CubicInterpolant:()=>uQ,CullFaceBack:()=>ej,CullFaceFront:()=>eY,CullFaceFrontBack:()=>eK,CullFaceNone:()=>eW,Curve:()=>lM,CurvePath:()=>lq,CustomBlending:()=>e8,CustomToneMapping:()=>tL,CylinderGeometry:()=>lE,Cylindrical:()=>hy,Data3DTexture:()=>nD,DataArrayTexture:()=>nR,DataTexture:()=>oc,DataTextureLoader:()=>ci,DataUtils:()=>a$,DecrementStencilOp:()=>iA,DecrementWrapStencilOp:()=>iy,DefaultLoadingManager:()=>u3,DepthFormat:()=>rc,DepthStencilFormat:()=>rh,DepthTexture:()=>lg,DetachedBindMode:()=>tU,DirectionalLight:()=>cE,DirectionalLightHelper:()=>hY,DiscreteInterpolant:()=>uW,DodecahedronGeometry:()=>lb,DoubleSide:()=>e1,DstAlphaFactor:()=>tu,DstColorFactor:()=>th,DynamicCopyUsage:()=>iV,DynamicDrawUsage:()=>iU,DynamicReadUsage:()=>iG,EdgesGeometry:()=>lI,EllipseCurve:()=>lR,EqualCompare:()=>iB,EqualDepth:()=>t_,EqualStencilFunc:()=>ib,EquirectangularReflectionMapping:()=>tH,EquirectangularRefractionMapping:()=>tQ,Euler:()=>ao,EventDispatcher:()=>iZ,ExternalTexture:()=>lA,ExtrudeGeometry:()=>ul,FileLoader:()=>u8,Float16BufferAttribute:()=>a7,Float32BufferAttribute:()=>se,FloatType:()=>re,Fog:()=>sz,FogExp2:()=>sN,FramebufferTexture:()=>lh,FrontSide:()=>eZ,Frustum:()=>oR,FrustumArray:()=>oP,GLBufferAttribute:()=>hh,GLSL1:()=>ij,GLSL3:()=>iY,GreaterCompare:()=>iP,GreaterDepth:()=>tS,GreaterEqualCompare:()=>ik,GreaterEqualDepth:()=>tb,GreaterEqualStencilFunc:()=>iT,GreaterStencilFunc:()=>iw,GridHelper:()=>hH,Group:()=>sF,HalfFloatType:()=>rt,HemisphereLight:()=>cs,HemisphereLightHelper:()=>hG,IcosahedronGeometry:()=>uc,ImageBitmapLoader:()=>cL,ImageLoader:()=>ct,ImageUtils:()=>nE,IncrementStencilOp:()=>ig,IncrementWrapStencilOp:()=>iv,InstancedBufferAttribute:()=>op,InstancedBufferGeometry:()=>cT,InstancedInterleavedBuffer:()=>hc,InstancedMesh:()=>o_,Int16BufferAttribute:()=>a5,Int32BufferAttribute:()=>a8,Int8BufferAttribute:()=>a2,IntType:()=>t9,InterleavedBuffer:()=>sH,InterleavedBufferAttribute:()=>sV,Interpolant:()=>uH,InterpolateDiscrete:()=>rZ,InterpolateLinear:()=>r0,InterpolateSmooth:()=>r1,InterpolationSamplingMode:()=>iJ,InterpolationSamplingType:()=>i$,InvertStencilOp:()=>iE,KeepStencilOp:()=>ip,KeyframeTrack:()=>uj,LOD:()=>s9,LatheGeometry:()=>uh,Layers:()=>al,LessCompare:()=>iR,LessDepth:()=>tE,LessEqualCompare:()=>iD,LessEqualDepth:()=>tx,LessEqualStencilFunc:()=>iS,LessStencilFunc:()=>i_,Light:()=>ca,LightProbe:()=>cS,Line:()=>o6,Line3:()=>hR,LineBasicMaterial:()=>oJ,LineCurve:()=>lQ,LineCurve3:()=>lV,LineDashedMaterial:()=>uk,LineLoop:()=>lt,LineSegments:()=>le,LinearFilter:()=>tZ,LinearInterpolant:()=>uV,LinearMipMapLinearFilter:()=>t3,LinearMipMapNearestFilter:()=>t1,LinearMipmapLinearFilter:()=>t2,LinearMipmapNearestFilter:()=>t0,LinearSRGBColorSpace:()=>iu,LinearToneMapping:()=>tR,LinearTransfer:()=>ic,Loader:()=>u4,LoaderUtils:()=>cC,LoadingManager:()=>u2,LoopOnce:()=>rX,LoopPingPong:()=>rJ,LoopRepeat:()=>r$,MOUSE:()=>eQ,Material:()=>aj,MaterialLoader:()=>cw,MathUtils:()=>ne,Matrix2:()=>hE,Matrix3:()=>ns,Matrix4:()=>n8,MaxEquation:()=>tr,Mesh:()=>sE,MeshBasicMaterial:()=>aY,MeshDepthMaterial:()=>uD,MeshDistanceMaterial:()=>uP,MeshLambertMaterial:()=>uB,MeshMatcapMaterial:()=>uL,MeshNormalMaterial:()=>uR,MeshPhongMaterial:()=>uI,MeshPhysicalMaterial:()=>uT,MeshStandardMaterial:()=>uC,MeshToonMaterial:()=>uM,MinEquation:()=>tt,MirroredRepeatWrapping:()=>tY,MixOperation:()=>tT,MultiplyBlending:()=>e6,MultiplyOperation:()=>tC,NearestFilter:()=>tK,NearestMipMapLinearFilter:()=>tJ,NearestMipMapNearestFilter:()=>tX,NearestMipmapLinearFilter:()=>t$,NearestMipmapNearestFilter:()=>tq,NeutralToneMapping:()=>tF,NeverCompare:()=>iM,NeverDepth:()=>tv,NeverStencilFunc:()=>ix,NoBlending:()=>e2,NoColorSpace:()=>io,NoToneMapping:()=>tM,NormalAnimationBlendMode:()=>r5,NormalBlending:()=>e3,NotEqualCompare:()=>iL,NotEqualDepth:()=>tw,NotEqualStencilFunc:()=>iC,NumberKeyframeTrack:()=>uq,Object3D:()=>aS,ObjectLoader:()=>cM,ObjectSpaceNormalMap:()=>is,OctahedronGeometry:()=>ud,OneFactor:()=>tn,OneMinusConstantAlphaFactor:()=>tA,OneMinusConstantColorFactor:()=>tm,OneMinusDstAlphaFactor:()=>tc,OneMinusDstColorFactor:()=>td,OneMinusSrcAlphaFactor:()=>tl,OneMinusSrcColorFactor:()=>ts,OrthographicCamera:()=>cv,PCFShadowMap:()=>eX,PCFSoftShadowMap:()=>e$,PMREMGenerator:()=>vx,Path:()=>lX,PerspectiveCamera:()=>sD,Plane:()=>oC,PlaneGeometry:()=>uf,PlaneHelper:()=>h1,PointLight:()=>cA,PointLightHelper:()=>hO,Points:()=>lo,PointsMaterial:()=>lr,PolarGridHelper:()=>hQ,PolyhedronGeometry:()=>l_,PositionalAudio:()=>c0,PropertyBinding:()=>ht,PropertyMixer:()=>c2,QuadraticBezierCurve:()=>lW,QuadraticBezierCurve3:()=>lj,Quaternion:()=>nr,QuaternionKeyframeTrack:()=>u$,QuaternionLinearInterpolant:()=>uX,RED_GREEN_RGTC2_Format:()=>rK,RED_RGTC1_Format:()=>rj,REVISION:()=>eH,RGBADepthPacking:()=>it,RGBAFormat:()=>ru,RGBAIntegerFormat:()=>rA,RGBA_ASTC_10x10_Format:()=>rz,RGBA_ASTC_10x5_Format:()=>rO,RGBA_ASTC_10x6_Format:()=>rU,RGBA_ASTC_10x8_Format:()=>rN,RGBA_ASTC_12x10_Format:()=>rG,RGBA_ASTC_12x12_Format:()=>rH,RGBA_ASTC_4x4_Format:()=>rM,RGBA_ASTC_5x4_Format:()=>rR,RGBA_ASTC_5x5_Format:()=>rB,RGBA_ASTC_6x5_Format:()=>rD,RGBA_ASTC_6x6_Format:()=>rP,RGBA_ASTC_8x5_Format:()=>rL,RGBA_ASTC_8x6_Format:()=>rk,RGBA_ASTC_8x8_Format:()=>rF,RGBA_BPTC_Format:()=>rQ,RGBA_ETC2_EAC_Format:()=>rI,RGBA_PVRTC_2BPPV1_Format:()=>rw,RGBA_PVRTC_4BPPV1_Format:()=>rS,RGBA_S3TC_DXT1_Format:()=>ry,RGBA_S3TC_DXT3_Format:()=>rE,RGBA_S3TC_DXT5_Format:()=>rx,RGBDepthPacking:()=>ir,RGBFormat:()=>rl,RGBIntegerFormat:()=>rg,RGB_BPTC_SIGNED_Format:()=>rV,RGB_BPTC_UNSIGNED_Format:()=>rW,RGB_ETC1_Format:()=>rC,RGB_ETC2_Format:()=>rT,RGB_PVRTC_2BPPV1_Format:()=>rb,RGB_PVRTC_4BPPV1_Format:()=>r_,RGB_S3TC_DXT1_Format:()=>rv,RGDepthPacking:()=>ii,RGFormat:()=>rp,RGIntegerFormat:()=>rm,RawShaderMaterial:()=>uw,Ray:()=>n6,Raycaster:()=>hf,RectAreaLight:()=>c_,RedFormat:()=>rd,RedIntegerFormat:()=>rf,ReinhardToneMapping:()=>tB,RenderTarget:()=>nI,RenderTarget3D:()=>hs,RepeatWrapping:()=>tW,ReplaceStencilOp:()=>im,ReverseSubtractEquation:()=>te,RingGeometry:()=>up,SIGNED_RED_GREEN_RGTC2_Format:()=>rq,SIGNED_RED_RGTC1_Format:()=>rY,SRGBColorSpace:()=>il,SRGBTransfer:()=>ih,Scene:()=>sG,ShaderChunk:()=>A9,ShaderLib:()=>ve,ShaderMaterial:()=>sT,ShadowMaterial:()=>uS,Shape:()=>l$,ShapeGeometry:()=>um,ShapePath:()=>h5,ShapeUtils:()=>ua,ShortType:()=>t6,Skeleton:()=>of,SkeletonHelper:()=>hF,SkinnedMesh:()=>ol,Source:()=>n_,Sphere:()=>nJ,SphereGeometry:()=>ug,Spherical:()=>hv,SphericalHarmonics3:()=>cb,SplineCurve:()=>lY,SpotLight:()=>cd,SpotLightHelper:()=>hD,Sprite:()=>s4,SpriteMaterial:()=>sW,SrcAlphaFactor:()=>to,SrcAlphaSaturateFactor:()=>tf,SrcColorFactor:()=>ta,StaticCopyUsage:()=>iQ,StaticDrawUsage:()=>iO,StaticReadUsage:()=>iz,StereoCamera:()=>cz,StreamCopyUsage:()=>iW,StreamDrawUsage:()=>iN,StreamReadUsage:()=>iH,StringKeyframeTrack:()=>uJ,SubtractEquation:()=>e7,SubtractiveBlending:()=>e5,TOUCH:()=>eV,TangentSpaceNormalMap:()=>ia,TetrahedronGeometry:()=>uA,Texture:()=>nC,TextureLoader:()=>cn,TextureUtils:()=>h9,Timer:()=>hg,TimestampQuery:()=>iX,TorusGeometry:()=>uv,TorusKnotGeometry:()=>uy,Triangle:()=>aU,TriangleFanDrawMode:()=>r7,TriangleStripDrawMode:()=>r9,TrianglesDrawMode:()=>r8,TubeGeometry:()=>uE,UVMapping:()=>tN,Uint16BufferAttribute:()=>a6,Uint32BufferAttribute:()=>a9,Uint8BufferAttribute:()=>a3,Uint8ClampedBufferAttribute:()=>a4,Uniform:()=>ho,UniformsGroup:()=>hu,UniformsLib:()=>A7,UniformsUtils:()=>sC,UnsignedByteType:()=>t4,UnsignedInt101111Type:()=>rs,UnsignedInt248Type:()=>rn,UnsignedInt5999Type:()=>ra,UnsignedIntType:()=>t7,UnsignedShort4444Type:()=>rr,UnsignedShort5551Type:()=>ri,UnsignedShortType:()=>t8,VSMShadowMap:()=>eJ,Vector2:()=>nt,Vector3:()=>ni,Vector4:()=>nT,VectorKeyframeTrack:()=>uZ,VideoFrameTexture:()=>lc,VideoTexture:()=>lu,WebGL3DRenderTarget:()=>nP,WebGLArrayRenderTarget:()=>nB,WebGLCoordinateSystem:()=>iK,WebGLCubeRenderTarget:()=>sk,WebGLRenderTarget:()=>nM,WebGLRenderer:()=>Eu,WebGLUtils:()=>Ee,WebGPUCoordinateSystem:()=>iq,WebXRController:()=>sU,WireframeGeometry:()=>ux,WrapAroundEnding:()=>r4,ZeroCurvatureEnding:()=>r2,ZeroFactor:()=>ti,ZeroSlopeEnding:()=>r3,ZeroStencilOp:()=>id,createCanvasElement:()=>nd});var eN=r(58009),ez=r.n(eN),eG=r(53413);let eH="180",eQ={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},eV={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},eW=0,ej=1,eY=2,eK=3,eq=0,eX=1,e$=2,eJ=3,eZ=0,e0=1,e1=2,e2=0,e3=1,e4=2,e5=3,e6=4,e8=5,e9=100,e7=101,te=102,tt=103,tr=104,ti=200,tn=201,ta=202,ts=203,to=204,tl=205,tu=206,tc=207,th=208,td=209,tf=210,tp=211,tm=212,tg=213,tA=214,tv=0,ty=1,tE=2,tx=3,t_=4,tb=5,tS=6,tw=7,tC=0,tT=1,tI=2,tM=0,tR=1,tB=2,tD=3,tP=4,tL=5,tk=6,tF=7,tO="attached",tU="detached",tN=300,tz=301,tG=302,tH=303,tQ=304,tV=306,tW=1e3,tj=1001,tY=1002,tK=1003,tq=1004,tX=1004,t$=1005,tJ=1005,tZ=1006,t0=1007,t1=1007,t2=1008,t3=1008,t4=1009,t5=1010,t6=1011,t8=1012,t9=1013,t7=1014,re=1015,rt=1016,rr=1017,ri=1018,rn=1020,ra=35902,rs=35899,ro=1021,rl=1022,ru=1023,rc=1026,rh=1027,rd=1028,rf=1029,rp=1030,rm=1031,rg=1032,rA=1033,rv=33776,ry=33777,rE=33778,rx=33779,r_=35840,rb=35841,rS=35842,rw=35843,rC=36196,rT=37492,rI=37496,rM=37808,rR=37809,rB=37810,rD=37811,rP=37812,rL=37813,rk=37814,rF=37815,rO=37816,rU=37817,rN=37818,rz=37819,rG=37820,rH=37821,rQ=36492,rV=36494,rW=36495,rj=36283,rY=36284,rK=36285,rq=36286,rX=2200,r$=2201,rJ=2202,rZ=2300,r0=2301,r1=2302,r2=2400,r3=2401,r4=2402,r5=2500,r6=2501,r8=0,r9=1,r7=2,ie=3200,it=3201,ir=3202,ii=3203,ia=0,is=1,io="",il="srgb",iu="srgb-linear",ic="linear",ih="srgb",id=0,ip=7680,im=7681,ig=7682,iA=7683,iv=34055,iy=34056,iE=5386,ix=512,i_=513,ib=514,iS=515,iw=516,iC=517,iT=518,iI=519,iM=512,iR=513,iB=514,iD=515,iP=516,iL=517,ik=518,iF=519,iO=35044,iU=35048,iN=35040,iz=35045,iG=35049,iH=35041,iQ=35046,iV=35050,iW=35042,ij="100",iY="300 es",iK=2e3,iq=2001,iX={COMPUTE:"compute",RENDER:"render"},i$={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},iJ={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};class iZ{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){let r=this._listeners;return void 0!==r&&void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){let r=this._listeners;if(void 0===r)return;let i=r[e];if(void 0!==i){let e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){let t=this._listeners;if(void 0===t)return;let r=t[e.type];if(void 0!==r){e.target=this;let t=r.slice(0);for(let r=0,i=t.length;r<i;r++)t[r].call(this,e);e.target=null}}}let i0=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],i1=1234567,i2=Math.PI/180,i3=180/Math.PI;function i4(){let e=0xffffffff*Math.random()|0,t=0xffffffff*Math.random()|0,r=0xffffffff*Math.random()|0,i=0xffffffff*Math.random()|0;return(i0[255&e]+i0[e>>8&255]+i0[e>>16&255]+i0[e>>24&255]+"-"+i0[255&t]+i0[t>>8&255]+"-"+i0[t>>16&15|64]+i0[t>>24&255]+"-"+i0[63&r|128]+i0[r>>8&255]+"-"+i0[r>>16&255]+i0[r>>24&255]+i0[255&i]+i0[i>>8&255]+i0[i>>16&255]+i0[i>>24&255]).toLowerCase()}function i5(e,t,r){return Math.max(t,Math.min(r,e))}function i6(e,t){return(e%t+t)%t}function i8(e,t,r){return(1-r)*e+r*t}function i9(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/0xffffffff;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/0x7fffffff,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw Error("Invalid component type.")}}function i7(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(0xffffffff*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(0x7fffffff*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw Error("Invalid component type.")}}let ne={DEG2RAD:i2,RAD2DEG:i3,generateUUID:i4,clamp:i5,euclideanModulo:i6,mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},inverseLerp:function(e,t,r){return e!==t?(r-e)/(t-e):0},lerp:i8,damp:function(e,t,r,i){return i8(e,t,1-Math.exp(-r*i))},pingpong:function(e,t=1){return t-Math.abs(i6(e,2*t)-t)},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(i1=e);let t=i1+=0x6d2b79f5;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/0x100000000},degToRad:function(e){return e*i2},radToDeg:function(e){return e*i3},isPowerOfTwo:function(e){return(e&e-1)==0&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,r,i,n){let a=Math.cos,s=Math.sin,o=a(r/2),l=s(r/2),u=a((t+i)/2),c=s((t+i)/2),h=a((t-i)/2),d=s((t-i)/2),f=a((i-t)/2),p=s((i-t)/2);switch(n){case"XYX":e.set(o*c,l*h,l*d,o*u);break;case"YZY":e.set(l*d,o*c,l*h,o*u);break;case"ZXZ":e.set(l*h,l*d,o*c,o*u);break;case"XZX":e.set(o*c,l*p,l*f,o*u);break;case"YXY":e.set(l*f,o*c,l*p,o*u);break;case"ZYZ":e.set(l*p,l*f,o*c,o*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}},normalize:i7,denormalize:i9};class nt{constructor(e=0,t=0){nt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=i5(this.x,e.x,t.x),this.y=i5(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=i5(this.x,e,t),this.y=i5(this.y,e,t),this}clampLength(e,t){let r=this.length();return this.divideScalar(r||1).multiplyScalar(i5(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:Math.acos(i5(this.dot(e)/t,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,a=this.y-e.y;return this.x=n*r-a*i+e.x,this.y=n*i+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class nr{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,n,a,s){let o=r[i+0],l=r[i+1],u=r[i+2],c=r[i+3],h=n[a+0],d=n[a+1],f=n[a+2],p=n[a+3];if(0===s){e[t+0]=o,e[t+1]=l,e[t+2]=u,e[t+3]=c;return}if(1===s){e[t+0]=h,e[t+1]=d,e[t+2]=f,e[t+3]=p;return}if(c!==p||o!==h||l!==d||u!==f){let e=1-s,t=o*h+l*d+u*f+c*p,r=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){let n=Math.sqrt(i),a=Math.atan2(n,t*r);e=Math.sin(e*a)/n,s=Math.sin(s*a)/n}let n=s*r;if(o=o*e+h*n,l=l*e+d*n,u=u*e+f*n,c=c*e+p*n,e===1-s){let e=1/Math.sqrt(o*o+l*l+u*u+c*c);o*=e,l*=e,u*=e,c*=e}}e[t]=o,e[t+1]=l,e[t+2]=u,e[t+3]=c}static multiplyQuaternionsFlat(e,t,r,i,n,a){let s=r[i],o=r[i+1],l=r[i+2],u=r[i+3],c=n[a],h=n[a+1],d=n[a+2],f=n[a+3];return e[t]=s*f+u*c+o*d-l*h,e[t+1]=o*f+u*h+l*c-s*d,e[t+2]=l*f+u*d+s*h-o*c,e[t+3]=u*f-s*c-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){let r=e._x,i=e._y,n=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(r/2),u=s(i/2),c=s(n/2),h=o(r/2),d=o(i/2),f=o(n/2);switch(a){case"XYZ":this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f;break;case"YXZ":this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f;break;case"ZXY":this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f;break;case"ZYX":this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f;break;case"YZX":this._x=h*u*c+l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c-h*d*f;break;case"XZY":this._x=h*u*c-l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,r=t[0],i=t[4],n=t[8],a=t[1],s=t[5],o=t[9],l=t[2],u=t[6],c=t[10],h=r+s+c;if(h>0){let e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(u-o)*e,this._y=(n-l)*e,this._z=(a-i)*e}else if(r>s&&r>c){let e=2*Math.sqrt(1+r-s-c);this._w=(u-o)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(n+l)/e}else if(s>c){let e=2*Math.sqrt(1+s-r-c);this._w=(n-l)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(o+u)/e}else{let e=2*Math.sqrt(1+c-r-s);this._w=(a-i)/e,this._x=(n+l)/e,this._y=(o+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<1e-8?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=r,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(i5(this.dot(e),-1,1)))}rotateTowards(e,t){let r=this.angleTo(e);if(0===r)return this;let i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let r=e._x,i=e._y,n=e._z,a=e._w,s=t._x,o=t._y,l=t._z,u=t._w;return this._x=r*u+a*s+i*l-n*o,this._y=i*u+a*o+n*s-r*l,this._z=n*u+a*l+r*o-i*s,this._w=a*u-r*s-i*o-n*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let r=this._x,i=this._y,n=this._z,a=this._w,s=a*e._w+r*e._x+i*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=r,this._y=i,this._z=n,this;let o=1-s*s;if(o<=Number.EPSILON){let e=1-t;return this._w=e*a+t*this._w,this._x=e*r+t*this._x,this._y=e*i+t*this._y,this._z=e*n+t*this._z,this.normalize(),this}let l=Math.sqrt(o),u=Math.atan2(l,s),c=Math.sin((1-t)*u)/l,h=Math.sin(t*u)/l;return this._w=a*c+this._w*h,this._x=r*c+this._x*h,this._y=i*c+this._y*h,this._z=n*c+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){let e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),n=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),n*Math.sin(t),n*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ni{constructor(e=0,t=0,r=0){ni.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(na.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(na.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,r=this.y,i=this.z,n=e.elements,a=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*a,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*a,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*a,this}applyQuaternion(e){let t=this.x,r=this.y,i=this.z,n=e.x,a=e.y,s=e.z,o=e.w,l=2*(a*i-s*r),u=2*(s*t-n*i),c=2*(n*r-a*t);return this.x=t+o*l+a*c-s*u,this.y=r+o*u+s*l-n*c,this.z=i+o*c+n*u-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=i5(this.x,e.x,t.x),this.y=i5(this.y,e.y,t.y),this.z=i5(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=i5(this.x,e,t),this.y=i5(this.y,e,t),this.z=i5(this.z,e,t),this}clampLength(e,t){let r=this.length();return this.divideScalar(r||1).multiplyScalar(i5(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let r=e.x,i=e.y,n=e.z,a=t.x,s=t.y,o=t.z;return this.x=i*o-n*s,this.y=n*a-r*o,this.z=r*s-i*a,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return nn.copy(this).projectOnVector(e),this.sub(nn)}reflect(e){return this.sub(nn.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:Math.acos(i5(this.dot(e)/t,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){let i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=Math.random()*Math.PI*2,t=2*Math.random()-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}let nn=new ni,na=new nr;class ns{constructor(e,t,r,i,n,a,s,o,l){ns.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,r,i,n,a,s,o,l)}set(e,t,r,i,n,a,s,o,l){let u=this.elements;return u[0]=e,u[1]=i,u[2]=s,u[3]=t,u[4]=n,u[5]=o,u[6]=r,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let r=e.elements,i=t.elements,n=this.elements,a=r[0],s=r[3],o=r[6],l=r[1],u=r[4],c=r[7],h=r[2],d=r[5],f=r[8],p=i[0],m=i[3],g=i[6],A=i[1],v=i[4],y=i[7],E=i[2],x=i[5],_=i[8];return n[0]=a*p+s*A+o*E,n[3]=a*m+s*v+o*x,n[6]=a*g+s*y+o*_,n[1]=l*p+u*A+c*E,n[4]=l*m+u*v+c*x,n[7]=l*g+u*y+c*_,n[2]=h*p+d*A+f*E,n[5]=h*m+d*v+f*x,n[8]=h*g+d*y+f*_,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],u=e[8];return t*a*u-t*s*l-r*n*u+r*s*o+i*n*l-i*a*o}invert(){let e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],u=e[8],c=u*a-s*l,h=s*o-u*n,d=l*n-a*o,f=t*c+r*h+i*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);let p=1/f;return e[0]=c*p,e[1]=(i*l-u*r)*p,e[2]=(s*r-i*a)*p,e[3]=h*p,e[4]=(u*t-i*o)*p,e[5]=(i*n-s*t)*p,e[6]=d*p,e[7]=(r*o-l*t)*p,e[8]=(a*t-r*n)*p,this}transpose(){let e;let t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,n,a,s){let o=Math.cos(n),l=Math.sin(n);return this.set(r*o,r*l,-r*(o*a+l*s)+a+e,-i*l,i*o,-i*(-l*a+o*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(no.makeScale(e,t)),this}rotate(e){return this.premultiply(no.makeRotation(-e)),this}translate(e,t){return this.premultiply(no.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,r=e.elements;for(let e=0;e<9;e++)if(t[e]!==r[e])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){let r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}let no=new ns;function nl(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}let nu={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function nc(e,t){return new nu[e](t)}function nh(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function nd(){let e=nh("canvas");return e.style.display="block",e}let nf={};function np(e){e in nf||(nf[e]=!0,console.warn(e))}let nm=new ns().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),ng=new ns().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715),nA=function(){let e={enabled:!0,workingColorSpace:iu,spaces:{},convert:function(e,t,r){return!1!==this.enabled&&t!==r&&t&&r&&(this.spaces[t].transfer===ih&&(e.r=nv(e.r),e.g=nv(e.g),e.b=nv(e.b)),this.spaces[t].primaries!==this.spaces[r].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[r].fromXYZ)),this.spaces[r].transfer===ih&&(e.r=ny(e.r),e.g=ny(e.g),e.b=ny(e.b))),e},workingToColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},colorSpaceToWorking:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===io?ic:this.spaces[e].transfer},getToneMappingMode:function(e){return this.spaces[e].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,r){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[r].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(t,r){return np("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),e.workingToColorSpace(t,r)},toWorkingColorSpace:function(t,r){return np("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),e.colorSpaceToWorking(t,r)}},t=[.64,.33,.3,.6,.15,.06],r=[.2126,.7152,.0722],i=[.3127,.329];return e.define({[iu]:{primaries:t,whitePoint:i,transfer:ic,toXYZ:nm,fromXYZ:ng,luminanceCoefficients:r,workingColorSpaceConfig:{unpackColorSpace:il},outputColorSpaceConfig:{drawingBufferColorSpace:il}},[il]:{primaries:t,whitePoint:i,transfer:ih,toXYZ:nm,fromXYZ:ng,luminanceCoefficients:r,outputColorSpaceConfig:{drawingBufferColorSpace:il}}}),e}();function nv(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ny(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class nE{static getDataURL(e,t="image/png"){let r;if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)r=e;else{void 0===i&&(i=nh("canvas")),i.width=e.width,i.height=e.height;let t=i.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),r=i}return r.toDataURL(t)}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let t=nh("canvas");t.width=e.width,t.height=e.height;let r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);let i=r.getImageData(0,0,e.width,e.height),n=i.data;for(let e=0;e<n.length;e++)n[e]=255*nv(n[e]/255);return r.putImageData(i,0,0),t}if(!e.data)return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e;{let t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*nv(t[e]/255)):t[e]=nv(t[e]);return{data:t,width:e.width,height:e.height}}}}let nx=0;class n_{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:nx++}),this.uuid=i4(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){let t=this.data;return"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):null!==t?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];let r={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,r=i.length;t<r;t++)i[t].isDataTexture?e.push(nb(i[t].image)):e.push(nb(i[t]))}else e=nb(i);r.url=e}return t||(e.images[this.uuid]=r),r}}function nb(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?nE.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let nS=0,nw=new ni;class nC extends iZ{constructor(e=nC.DEFAULT_IMAGE,t=nC.DEFAULT_MAPPING,r=tj,i=tj,n=tZ,a=t2,s=ru,o=t4,l=nC.DEFAULT_ANISOTROPY,u=io){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:nS++}),this.uuid=i4(),this.name="",this.source=new n_(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=n,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new nt(0,0),this.repeat=new nt(1,1),this.center=new nt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ns,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!e&&!!e.depth&&e.depth>1,this.pmremVersion=0}get width(){return this.source.getSize(nw).x}get height(){return this.source.getSize(nw).y}get depth(){return this.source.getSize(nw).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(let t in e){let r=e[t];if(void 0===r){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}let i=this[t];if(void 0===i){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}i&&r&&i.isVector2&&r.isVector2?i.copy(r):i&&r&&i.isVector3&&r.isVector3?i.copy(r):i&&r&&i.isMatrix3&&r.isMatrix3?i.copy(r):this[t]=r}}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==tN)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case tW:e.x=e.x-Math.floor(e.x);break;case tj:e.x=e.x<0?0:1;break;case tY:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case tW:e.y=e.y-Math.floor(e.y);break;case tj:e.y=e.y<0?0:1;break;case tY:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}nC.DEFAULT_IMAGE=null,nC.DEFAULT_MAPPING=tN,nC.DEFAULT_ANISOTROPY=1;class nT{constructor(e=0,t=0,r=0,i=1){nT.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,r=this.y,i=this.z,n=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*n,this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*n,this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*n,this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*n,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,n;let a=e.elements,s=a[0],o=a[4],l=a[8],u=a[1],c=a[5],h=a[9],d=a[2],f=a[6],p=a[10];if(.01>Math.abs(o-u)&&.01>Math.abs(l-d)&&.01>Math.abs(h-f)){if(.1>Math.abs(o+u)&&.1>Math.abs(l+d)&&.1>Math.abs(h+f)&&.1>Math.abs(s+c+p-3))return this.set(1,0,0,0),this;t=Math.PI;let e=(s+1)/2,a=(c+1)/2,m=(p+1)/2,g=(o+u)/4,A=(l+d)/4,v=(h+f)/4;return e>a&&e>m?e<.01?(r=0,i=.707106781,n=.707106781):(i=g/(r=Math.sqrt(e)),n=A/r):a>m?a<.01?(r=.707106781,i=0,n=.707106781):(r=g/(i=Math.sqrt(a)),n=v/i):m<.01?(r=.707106781,i=.707106781,n=0):(r=A/(n=Math.sqrt(m)),i=v/n),this.set(r,i,n,t),this}let m=Math.sqrt((f-h)*(f-h)+(l-d)*(l-d)+(u-o)*(u-o));return .001>Math.abs(m)&&(m=1),this.x=(f-h)/m,this.y=(l-d)/m,this.z=(u-o)/m,this.w=Math.acos((s+c+p-1)/2),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=i5(this.x,e.x,t.x),this.y=i5(this.y,e.y,t.y),this.z=i5(this.z,e.z,t.z),this.w=i5(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=i5(this.x,e,t),this.y=i5(this.y,e,t),this.z=i5(this.z,e,t),this.w=i5(this.w,e,t),this}clampLength(e,t){let r=this.length();return this.divideScalar(r||1).multiplyScalar(i5(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class nI extends iZ{constructor(e=1,t=1,r={}){super(),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:tZ,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},r),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=r.depth,this.scissor=new nT(0,0,e,t),this.scissorTest=!1,this.viewport=new nT(0,0,e,t);let i=new nC({width:e,height:t,depth:r.depth});this.textures=[];let n=r.count;for(let e=0;e<n;e++)this.textures[e]=i.clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;this._setTextureOptions(r),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}_setTextureOptions(e={}){let t={minFilter:tZ,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==e.mapping&&(t.mapping=e.mapping),void 0!==e.wrapS&&(t.wrapS=e.wrapS),void 0!==e.wrapT&&(t.wrapT=e.wrapT),void 0!==e.wrapR&&(t.wrapR=e.wrapR),void 0!==e.magFilter&&(t.magFilter=e.magFilter),void 0!==e.minFilter&&(t.minFilter=e.minFilter),void 0!==e.format&&(t.format=e.format),void 0!==e.type&&(t.type=e.type),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.colorSpace&&(t.colorSpace=e.colorSpace),void 0!==e.flipY&&(t.flipY=e.flipY),void 0!==e.generateMipmaps&&(t.generateMipmaps=e.generateMipmaps),void 0!==e.internalFormat&&(t.internalFormat=e.internalFormat);for(let e=0;e<this.textures.length;e++)this.textures[e].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,n=this.textures.length;i<n;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,r=e.textures.length;t<r;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;let r=Object.assign({},e.textures[t].image);this.textures[t].source=new n_(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class nM extends nI{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class nR extends nC{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=tK,this.minFilter=tK,this.wrapR=tj,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class nB extends nM{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new nR(null,e,t,r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class nD extends nC{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=tK,this.minFilter=tK,this.wrapR=tj,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class nP extends nM{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new nD(null,e,t,r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class nL{constructor(e=new ni(Infinity,Infinity,Infinity),t=new ni(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(nF.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(nF.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let r=nF.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let r=e.geometry;if(void 0!==r){let i=r.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,r=i.count;t<r;t++)!0===e.isMesh?e.getVertexPosition(t,nF):nF.fromBufferAttribute(i,t),nF.applyMatrix4(e.matrixWorld),this.expandByPoint(nF);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),nO.copy(e.boundingBox)):(null===r.boundingBox&&r.computeBoundingBox(),nO.copy(r.boundingBox)),nO.applyMatrix4(e.matrixWorld),this.union(nO)}let i=e.children;for(let e=0,r=i.length;e<r;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,nF),nF.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(nV),nW.subVectors(this.max,nV),nU.subVectors(e.a,nV),nN.subVectors(e.b,nV),nz.subVectors(e.c,nV),nG.subVectors(nN,nU),nH.subVectors(nz,nN),nQ.subVectors(nU,nz);let t=[0,-nG.z,nG.y,0,-nH.z,nH.y,0,-nQ.z,nQ.y,nG.z,0,-nG.x,nH.z,0,-nH.x,nQ.z,0,-nQ.x,-nG.y,nG.x,0,-nH.y,nH.x,0,-nQ.y,nQ.x,0];return!!(nK(t,nU,nN,nz,nW)&&nK(t=[1,0,0,0,1,0,0,0,1],nU,nN,nz,nW))&&(nj.crossVectors(nG,nH),nK(t=[nj.x,nj.y,nj.z],nU,nN,nz,nW))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,nF).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(nF).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(nk[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),nk[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),nk[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),nk[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),nk[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),nk[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),nk[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),nk[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(nk)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}let nk=[new ni,new ni,new ni,new ni,new ni,new ni,new ni,new ni],nF=new ni,nO=new nL,nU=new ni,nN=new ni,nz=new ni,nG=new ni,nH=new ni,nQ=new ni,nV=new ni,nW=new ni,nj=new ni,nY=new ni;function nK(e,t,r,i,n){for(let a=0,s=e.length-3;a<=s;a+=3){nY.fromArray(e,a);let s=n.x*Math.abs(nY.x)+n.y*Math.abs(nY.y)+n.z*Math.abs(nY.z),o=t.dot(nY),l=r.dot(nY),u=i.dot(nY);if(Math.max(-Math.max(o,l,u),Math.min(o,l,u))>s)return!1}return!0}let nq=new nL,nX=new ni,n$=new ni;class nJ{constructor(e=new ni,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let r=this.center;void 0!==t?r.copy(t):nq.setFromPoints(e).getCenter(r);let i=0;for(let t=0,n=e.length;t<n;t++)i=Math.max(i,r.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;nX.subVectors(e,this.center);let t=nX.lengthSq();if(t>this.radius*this.radius){let e=Math.sqrt(t),r=(e-this.radius)*.5;this.center.addScaledVector(nX,r/e),this.radius+=r}return this}union(e){return e.isEmpty()||(this.isEmpty()?this.copy(e):!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(n$.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(nX.copy(e.center).add(n$)),this.expandByPoint(nX.copy(e.center).sub(n$)))),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}let nZ=new ni,n0=new ni,n1=new ni,n2=new ni,n3=new ni,n4=new ni,n5=new ni;class n6{constructor(e=new ni,t=new ni(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,nZ)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=nZ.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(nZ.copy(this.origin).addScaledVector(this.direction,t),nZ.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){let n,a,s,o;n0.copy(e).add(t).multiplyScalar(.5),n1.copy(t).sub(e).normalize(),n2.copy(this.origin).sub(n0);let l=.5*e.distanceTo(t),u=-this.direction.dot(n1),c=n2.dot(this.direction),h=-n2.dot(n1),d=n2.lengthSq(),f=Math.abs(1-u*u);if(f>0){if(n=u*h-c,a=u*c-h,o=l*f,n>=0){if(a>=-o){if(a<=o){let e=1/f;n*=e,a*=e,s=n*(n+u*a+2*c)+a*(u*n+a+2*h)+d}else s=-(n=Math.max(0,-(u*(a=l)+c)))*n+a*(a+2*h)+d}else s=-(n=Math.max(0,-(u*(a=-l)+c)))*n+a*(a+2*h)+d}else a<=-o?(a=(n=Math.max(0,-(-u*l+c)))>0?-l:Math.min(Math.max(-l,-h),l),s=-n*n+a*(a+2*h)+d):a<=o?(n=0,s=(a=Math.min(Math.max(-l,-h),l))*(a+2*h)+d):(a=(n=Math.max(0,-(u*l+c)))>0?l:Math.min(Math.max(-l,-h),l),s=-n*n+a*(a+2*h)+d)}else a=u>0?-l:l,s=-(n=Math.max(0,-(u*a+c)))*n+a*(a+2*h)+d;return r&&r.copy(this.origin).addScaledVector(this.direction,n),i&&i.copy(n0).addScaledVector(n1,a),s}intersectSphere(e,t){nZ.subVectors(e.center,this.origin);let r=nZ.dot(this.direction),i=nZ.dot(nZ)-r*r,n=e.radius*e.radius;if(i>n)return null;let a=Math.sqrt(n-i),s=r-a,o=r+a;return o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectsSphere(e){return!(e.radius<0)&&this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){let r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return!!(0===t||e.normal.dot(this.direction)*t<0)}intersectBox(e,t){let r,i,n,a,s,o;let l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return(l>=0?(r=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),u>=0?(n=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(n=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),r>a||n>i)?null:((n>r||isNaN(r))&&(r=n),(a<i||isNaN(i))&&(i=a),c>=0?(s=(e.min.z-h.z)*c,o=(e.max.z-h.z)*c):(s=(e.max.z-h.z)*c,o=(e.min.z-h.z)*c),r>o||s>i)?null:((s>r||r!=r)&&(r=s),(o<i||i!=i)&&(i=o),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return null!==this.intersectBox(e,nZ)}intersectTriangle(e,t,r,i,n){let a;n3.subVectors(t,e),n4.subVectors(r,e),n5.crossVectors(n3,n4);let s=this.direction.dot(n5);if(s>0){if(i)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}n2.subVectors(this.origin,e);let o=a*this.direction.dot(n4.crossVectors(n2,n4));if(o<0)return null;let l=a*this.direction.dot(n3.cross(n2));if(l<0||o+l>s)return null;let u=-a*n2.dot(n5);return u<0?null:this.at(u/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class n8{constructor(e,t,r,i,n,a,s,o,l,u,c,h,d,f,p,m){n8.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,r,i,n,a,s,o,l,u,c,h,d,f,p,m)}set(e,t,r,i,n,a,s,o,l,u,c,h,d,f,p,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new n8().fromArray(this.elements)}copy(e){let t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){let t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,r=e.elements,i=1/n9.setFromMatrixColumn(e,0).length(),n=1/n9.setFromMatrixColumn(e,1).length(),a=1/n9.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,r=e.x,i=e.y,n=e.z,a=Math.cos(r),s=Math.sin(r),o=Math.cos(i),l=Math.sin(i),u=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){let e=a*u,r=a*c,i=s*u,n=s*c;t[0]=o*u,t[4]=-o*c,t[8]=l,t[1]=r+i*l,t[5]=e-n*l,t[9]=-s*o,t[2]=n-e*l,t[6]=i+r*l,t[10]=a*o}else if("YXZ"===e.order){let e=o*u,r=o*c,i=l*u,n=l*c;t[0]=e+n*s,t[4]=i*s-r,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-s,t[2]=r*s-i,t[6]=n+e*s,t[10]=a*o}else if("ZXY"===e.order){let e=o*u,r=o*c,i=l*u,n=l*c;t[0]=e-n*s,t[4]=-a*c,t[8]=i+r*s,t[1]=r+i*s,t[5]=a*u,t[9]=n-e*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){let e=a*u,r=a*c,i=s*u,n=s*c;t[0]=o*u,t[4]=i*l-r,t[8]=e*l+n,t[1]=o*c,t[5]=n*l+e,t[9]=r*l-i,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){let e=a*o,r=a*l,i=s*o,n=s*l;t[0]=o*u,t[4]=n-e*c,t[8]=i*c+r,t[1]=c,t[5]=a*u,t[9]=-s*u,t[2]=-l*u,t[6]=r*c+i,t[10]=e-n*c}else if("XZY"===e.order){let e=a*o,r=a*l,i=s*o,n=s*l;t[0]=o*u,t[4]=-c,t[8]=l*u,t[1]=e*c+n,t[5]=a*u,t[9]=r*c-i,t[2]=i*c-r,t[6]=s*u,t[10]=n*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ae,e,at)}lookAt(e,t,r){let i=this.elements;return an.subVectors(e,t),0===an.lengthSq()&&(an.z=1),an.normalize(),ar.crossVectors(r,an),0===ar.lengthSq()&&(1===Math.abs(r.z)?an.x+=1e-4:an.z+=1e-4,an.normalize(),ar.crossVectors(r,an)),ar.normalize(),ai.crossVectors(an,ar),i[0]=ar.x,i[4]=ai.x,i[8]=an.x,i[1]=ar.y,i[5]=ai.y,i[9]=an.y,i[2]=ar.z,i[6]=ai.z,i[10]=an.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let r=e.elements,i=t.elements,n=this.elements,a=r[0],s=r[4],o=r[8],l=r[12],u=r[1],c=r[5],h=r[9],d=r[13],f=r[2],p=r[6],m=r[10],g=r[14],A=r[3],v=r[7],y=r[11],E=r[15],x=i[0],_=i[4],b=i[8],S=i[12],w=i[1],C=i[5],T=i[9],I=i[13],M=i[2],R=i[6],B=i[10],D=i[14],P=i[3],L=i[7],k=i[11],F=i[15];return n[0]=a*x+s*w+o*M+l*P,n[4]=a*_+s*C+o*R+l*L,n[8]=a*b+s*T+o*B+l*k,n[12]=a*S+s*I+o*D+l*F,n[1]=u*x+c*w+h*M+d*P,n[5]=u*_+c*C+h*R+d*L,n[9]=u*b+c*T+h*B+d*k,n[13]=u*S+c*I+h*D+d*F,n[2]=f*x+p*w+m*M+g*P,n[6]=f*_+p*C+m*R+g*L,n[10]=f*b+p*T+m*B+g*k,n[14]=f*S+p*I+m*D+g*F,n[3]=A*x+v*w+y*M+E*P,n[7]=A*_+v*C+y*R+E*L,n[11]=A*b+v*T+y*B+E*k,n[15]=A*S+v*I+y*D+E*F,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],a=e[1],s=e[5],o=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14],f=e[3];return f*(+n*o*c-i*l*c-n*s*h+r*l*h+i*s*d-r*o*d)+e[7]*(+t*o*d-t*l*h+n*a*h-i*a*d+i*l*u-n*o*u)+e[11]*(+t*l*c-t*s*d-n*a*c+r*a*d+n*s*u-r*l*u)+e[15]*(-i*s*u-t*o*c+t*s*h+i*a*c-r*a*h+r*o*u)}transpose(){let e;let t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(e,t,r){let i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){let e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15],A=c*m*l-p*h*l+p*o*d-s*m*d-c*o*g+s*h*g,v=f*h*l-u*m*l-f*o*d+a*m*d+u*o*g-a*h*g,y=u*p*l-f*c*l+f*s*d-a*p*d-u*s*g+a*c*g,E=f*c*o-u*p*o-f*s*h+a*p*h+u*s*m-a*c*m,x=t*A+r*v+i*y+n*E;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let _=1/x;return e[0]=A*_,e[1]=(p*h*n-c*m*n-p*i*d+r*m*d+c*i*g-r*h*g)*_,e[2]=(s*m*n-p*o*n+p*i*l-r*m*l-s*i*g+r*o*g)*_,e[3]=(c*o*n-s*h*n-c*i*l+r*h*l+s*i*d-r*o*d)*_,e[4]=v*_,e[5]=(u*m*n-f*h*n+f*i*d-t*m*d-u*i*g+t*h*g)*_,e[6]=(f*o*n-a*m*n-f*i*l+t*m*l+a*i*g-t*o*g)*_,e[7]=(a*h*n-u*o*n+u*i*l-t*h*l-a*i*d+t*o*d)*_,e[8]=y*_,e[9]=(f*c*n-u*p*n-f*r*d+t*p*d+u*r*g-t*c*g)*_,e[10]=(a*p*n-f*s*n+f*r*l-t*p*l-a*r*g+t*s*g)*_,e[11]=(u*s*n-a*c*n-u*r*l+t*c*l+a*r*d-t*s*d)*_,e[12]=E*_,e[13]=(u*p*i-f*c*i+f*r*h-t*p*h-u*r*m+t*c*m)*_,e[14]=(f*s*i-a*p*i-f*r*o+t*p*o+a*r*m-t*s*m)*_,e[15]=(a*c*i-u*s*i+u*r*o-t*c*o-a*r*h+t*s*h)*_,this}scale(e){let t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this}getMaxScaleOnAxis(){let e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let r=Math.cos(t),i=Math.sin(t),n=1-r,a=e.x,s=e.y,o=e.z,l=n*a,u=n*s;return this.set(l*a+r,l*s-i*o,l*o+i*s,0,l*s+i*o,u*s+r,u*o-i*a,0,l*o-i*s,u*o+i*a,n*o*o+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,n,a){return this.set(1,r,n,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){let i=this.elements,n=t._x,a=t._y,s=t._z,o=t._w,l=n+n,u=a+a,c=s+s,h=n*l,d=n*u,f=n*c,p=a*u,m=a*c,g=s*c,A=o*l,v=o*u,y=o*c,E=r.x,x=r.y,_=r.z;return i[0]=(1-(p+g))*E,i[1]=(d+y)*E,i[2]=(f-v)*E,i[3]=0,i[4]=(d-y)*x,i[5]=(1-(h+g))*x,i[6]=(m+A)*x,i[7]=0,i[8]=(f+v)*_,i[9]=(m-A)*_,i[10]=(1-(h+p))*_,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){let i=this.elements,n=n9.set(i[0],i[1],i[2]).length(),a=n9.set(i[4],i[5],i[6]).length(),s=n9.set(i[8],i[9],i[10]).length();0>this.determinant()&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],n7.copy(this);let o=1/n,l=1/a,u=1/s;return n7.elements[0]*=o,n7.elements[1]*=o,n7.elements[2]*=o,n7.elements[4]*=l,n7.elements[5]*=l,n7.elements[6]*=l,n7.elements[8]*=u,n7.elements[9]*=u,n7.elements[10]*=u,t.setFromRotationMatrix(n7),r.x=n,r.y=a,r.z=s,this}makePerspective(e,t,r,i,n,a,s=iK,o=!1){let l,u;let c=this.elements;if(o)l=n/(a-n),u=a*n/(a-n);else if(s===iK)l=-(a+n)/(a-n),u=-2*a*n/(a-n);else if(s===iq)l=-a/(a-n),u=-a*n/(a-n);else throw Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);return c[0]=2*n/(t-e),c[4]=0,c[8]=(t+e)/(t-e),c[12]=0,c[1]=0,c[5]=2*n/(r-i),c[9]=(r+i)/(r-i),c[13]=0,c[2]=0,c[6]=0,c[10]=l,c[14]=u,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,r,i,n,a,s=iK,o=!1){let l,u;let c=this.elements;if(o)l=1/(a-n),u=a/(a-n);else if(s===iK)l=-2/(a-n),u=-(a+n)/(a-n);else if(s===iq)l=-1/(a-n),u=-n/(a-n);else throw Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);return c[0]=2/(t-e),c[4]=0,c[8]=0,c[12]=-(t+e)/(t-e),c[1]=0,c[5]=2/(r-i),c[9]=0,c[13]=-(r+i)/(r-i),c[2]=0,c[6]=0,c[10]=l,c[14]=u,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){let t=this.elements,r=e.elements;for(let e=0;e<16;e++)if(t[e]!==r[e])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){let r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}let n9=new ni,n7=new n8,ae=new ni(0,0,0),at=new ni(1,1,1),ar=new ni,ai=new ni,an=new ni,aa=new n8,as=new nr;class ao{constructor(e=0,t=0,r=0,i=ao.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){let i=e.elements,n=i[0],a=i[4],s=i[8],o=i[1],l=i[5],u=i[9],c=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(i5(s,-1,1)),.9999999>Math.abs(s)?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-i5(u,-1,1)),.9999999>Math.abs(u)?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(i5(h,-1,1)),.9999999>Math.abs(h)?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-i5(c,-1,1)),.9999999>Math.abs(c)?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(i5(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-i5(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,n)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===r&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return aa.makeRotationFromQuaternion(e),this.setFromRotationMatrix(aa,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return as.setFromEuler(this),this.setFromQuaternion(as,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ao.DEFAULT_ORDER="XYZ";class al{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let au=0,ac=new ni,ah=new nr,ad=new n8,af=new ni,ap=new ni,am=new ni,ag=new nr,aA=new ni(1,0,0),av=new ni(0,1,0),ay=new ni(0,0,1),aE={type:"added"},ax={type:"removed"},a_={type:"childadded",child:null},ab={type:"childremoved",child:null};class aS extends iZ{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:au++}),this.uuid=i4(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=aS.DEFAULT_UP.clone();let e=new ni,t=new ao,r=new nr,i=new ni(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new n8},normalMatrix:{value:new ns}}),this.matrix=new n8,this.matrixWorld=new n8,this.matrixAutoUpdate=aS.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=aS.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new al,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ah.setFromAxisAngle(e,t),this.quaternion.multiply(ah),this}rotateOnWorldAxis(e,t){return ah.setFromAxisAngle(e,t),this.quaternion.premultiply(ah),this}rotateX(e){return this.rotateOnAxis(aA,e)}rotateY(e){return this.rotateOnAxis(av,e)}rotateZ(e){return this.rotateOnAxis(ay,e)}translateOnAxis(e,t){return ac.copy(e).applyQuaternion(this.quaternion),this.position.add(ac.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(aA,e)}translateY(e){return this.translateOnAxis(av,e)}translateZ(e){return this.translateOnAxis(ay,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ad.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?af.copy(e):af.set(e,t,r);let i=this.parent;this.updateWorldMatrix(!0,!1),ap.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ad.lookAt(ap,af,this.up):ad.lookAt(af,ap,this.up),this.quaternion.setFromRotationMatrix(ad),i&&(ad.extractRotation(i.matrixWorld),ah.setFromRotationMatrix(ad),this.quaternion.premultiply(ah.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(aE),a_.child=e,this.dispatchEvent(a_),a_.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let t=this.children.indexOf(e);return -1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(ax),ab.child=e,this.dispatchEvent(ab),ab.child=null),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ad.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ad.multiply(e.parent.matrixWorld)),e.applyMatrix4(ad),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(aE),a_.child=e,this.dispatchEvent(a_),a_.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){let i=this.children[r].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);let i=this.children;for(let n=0,a=i.length;n<a;n++)i[n].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ap,e,am),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ap,ag,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){let t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){let r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){let e=this.children;for(let t=0,r=e.length;t<r;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){let t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});let i={};function n(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(e=>({...e,boundingBox:e.boundingBox?e.boundingBox.toJSON():void 0,boundingSphere:e.boundingSphere?e.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(e=>({...e})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(i.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(i.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(e.geometries,this.geometry);let t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){let r=t.shapes;if(Array.isArray(r))for(let t=0,i=r.length;t<i;t++){let i=r[t];n(e.shapes,i)}else n(e.shapes,r)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material){if(Array.isArray(this.material)){let t=[];for(let r=0,i=this.material.length;r<i;r++)t.push(n(e.materials,this.material[r]));i.material=t}else i.material=n(e.materials,this.material)}if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){let r=this.animations[t];i.animations.push(n(e.animations,r))}}if(t){let t=a(e.geometries),i=a(e.materials),n=a(e.textures),s=a(e.images),o=a(e.shapes),l=a(e.skeletons),u=a(e.animations),c=a(e.nodes);t.length>0&&(r.geometries=t),i.length>0&&(r.materials=i),n.length>0&&(r.textures=n),s.length>0&&(r.images=s),o.length>0&&(r.shapes=o),l.length>0&&(r.skeletons=l),u.length>0&&(r.animations=u),c.length>0&&(r.nodes=c)}return r.object=i,r;function a(e){let t=[];for(let r in e){let i=e[r];delete i.metadata,t.push(i)}return t}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){let r=e.children[t];this.add(r.clone())}return this}}aS.DEFAULT_UP=new ni(0,1,0),aS.DEFAULT_MATRIX_AUTO_UPDATE=!0,aS.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let aw=new ni,aC=new ni,aT=new ni,aI=new ni,aM=new ni,aR=new ni,aB=new ni,aD=new ni,aP=new ni,aL=new ni,ak=new nT,aF=new nT,aO=new nT;class aU{constructor(e=new ni,t=new ni,r=new ni){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),aw.subVectors(e,t),i.cross(aw);let n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}static getBarycoord(e,t,r,i,n){aw.subVectors(i,t),aC.subVectors(r,t),aT.subVectors(e,t);let a=aw.dot(aw),s=aw.dot(aC),o=aw.dot(aT),l=aC.dot(aC),u=aC.dot(aT),c=a*l-s*s;if(0===c)return n.set(0,0,0),null;let h=1/c,d=(l*o-s*u)*h,f=(a*u-s*o)*h;return n.set(1-d-f,f,d)}static containsPoint(e,t,r,i){return null!==this.getBarycoord(e,t,r,i,aI)&&aI.x>=0&&aI.y>=0&&aI.x+aI.y<=1}static getInterpolation(e,t,r,i,n,a,s,o){return null===this.getBarycoord(e,t,r,i,aI)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(n,aI.x),o.addScaledVector(a,aI.y),o.addScaledVector(s,aI.z),o)}static getInterpolatedAttribute(e,t,r,i,n,a){return ak.setScalar(0),aF.setScalar(0),aO.setScalar(0),ak.fromBufferAttribute(e,t),aF.fromBufferAttribute(e,r),aO.fromBufferAttribute(e,i),a.setScalar(0),a.addScaledVector(ak,n.x),a.addScaledVector(aF,n.y),a.addScaledVector(aO,n.z),a}static isFrontFacing(e,t,r,i){return aw.subVectors(r,t),aC.subVectors(e,t),0>aw.cross(aC).dot(i)}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return aw.subVectors(this.c,this.b),aC.subVectors(this.a,this.b),.5*aw.cross(aC).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return aU.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return aU.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,n){return aU.getInterpolation(e,this.a,this.b,this.c,t,r,i,n)}containsPoint(e){return aU.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return aU.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let r,i;let n=this.a,a=this.b,s=this.c;aM.subVectors(a,n),aR.subVectors(s,n),aD.subVectors(e,n);let o=aM.dot(aD),l=aR.dot(aD);if(o<=0&&l<=0)return t.copy(n);aP.subVectors(e,a);let u=aM.dot(aP),c=aR.dot(aP);if(u>=0&&c<=u)return t.copy(a);let h=o*c-u*l;if(h<=0&&o>=0&&u<=0)return r=o/(o-u),t.copy(n).addScaledVector(aM,r);aL.subVectors(e,s);let d=aM.dot(aL),f=aR.dot(aL);if(f>=0&&d<=f)return t.copy(s);let p=d*l-o*f;if(p<=0&&l>=0&&f<=0)return i=l/(l-f),t.copy(n).addScaledVector(aR,i);let m=u*f-d*c;if(m<=0&&c-u>=0&&d-f>=0)return aB.subVectors(s,a),i=(c-u)/(c-u+(d-f)),t.copy(a).addScaledVector(aB,i);let g=1/(m+p+h);return r=p*g,i=h*g,t.copy(n).addScaledVector(aM,r).addScaledVector(aR,i)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let aN={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32},az={h:0,s:0,l:0},aG={h:0,s:0,l:0};function aH(e,t,r){return(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*6*(2/3-r):e}class aQ{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){return void 0===t&&void 0===r?e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e):this.setRGB(e,t,r),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=il){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,nA.colorSpaceToWorking(this,t),this}setRGB(e,t,r,i=nA.workingColorSpace){return this.r=e,this.g=t,this.b=r,nA.colorSpaceToWorking(this,i),this}setHSL(e,t,r,i=nA.workingColorSpace){if(e=i6(e,1),t=i5(t,0,1),r=i5(r,0,1),0===t)this.r=this.g=this.b=r;else{let i=r<=.5?r*(1+t):r+t-r*t,n=2*r-i;this.r=aH(n,i,e+1/3),this.g=aH(n,i,e),this.b=aH(n,i,e-1/3)}return nA.colorSpaceToWorking(this,i),this}setStyle(e,t=il){let r;function i(t){void 0!==t&&1>parseFloat(t)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let n;let a=r[1],s=r[2];switch(a){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,t);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,t);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let i=r[1],n=i.length;if(3===n)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,t);if(6===n)return this.setHex(parseInt(i,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=il){let r=aN[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=nv(e.r),this.g=nv(e.g),this.b=nv(e.b),this}copyLinearToSRGB(e){return this.r=ny(e.r),this.g=ny(e.g),this.b=ny(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=il){return nA.workingToColorSpace(aV.copy(this),e),65536*Math.round(i5(255*aV.r,0,255))+256*Math.round(i5(255*aV.g,0,255))+Math.round(i5(255*aV.b,0,255))}getHexString(e=il){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=nA.workingColorSpace){let r,i;nA.workingToColorSpace(aV.copy(this),t);let n=aV.r,a=aV.g,s=aV.b,o=Math.max(n,a,s),l=Math.min(n,a,s),u=(l+o)/2;if(l===o)r=0,i=0;else{let e=o-l;switch(i=u<=.5?e/(o+l):e/(2-o-l),o){case n:r=(a-s)/e+(a<s?6:0);break;case a:r=(s-n)/e+2;break;case s:r=(n-a)/e+4}r/=6}return e.h=r,e.s=i,e.l=u,e}getRGB(e,t=nA.workingColorSpace){return nA.workingToColorSpace(aV.copy(this),t),e.r=aV.r,e.g=aV.g,e.b=aV.b,e}getStyle(e=il){nA.workingToColorSpace(aV.copy(this),e);let t=aV.r,r=aV.g,i=aV.b;return e!==il?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*r)},${Math.round(255*i)})`}offsetHSL(e,t,r){return this.getHSL(az),this.setHSL(az.h+e,az.s+t,az.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(az),e.getHSL(aG);let r=i8(az.h,aG.h,t),i=i8(az.s,aG.s,t),n=i8(az.l,aG.l,t);return this.setHSL(r,i,n),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){let t=this.r,r=this.g,i=this.b,n=e.elements;return this.r=n[0]*t+n[3]*r+n[6]*i,this.g=n[1]*t+n[4]*r+n[7]*i,this.b=n[2]*t+n[5]*r+n[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let aV=new aQ;aQ.NAMES=aN;let aW=0;class aj extends iZ{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:aW++}),this.uuid=i4(),this.name="",this.type="Material",this.blending=e3,this.side=eZ,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=to,this.blendDst=tl,this.blendEquation=e9,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new aQ(0,0,0),this.blendAlpha=0,this.depthFunc=tx,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=iI,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ip,this.stencilZFail=ip,this.stencilZPass=ip,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let t in e){let r=e[t];if(void 0===r){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}let i=this[t];if(void 0===i){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});let r={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function i(e){let t=[];for(let r in e){let i=e[r];delete i.metadata,t.push(i)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(r.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(r.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),void 0!==this.dispersion&&(r.dispersion=this.dispersion),void 0!==this.iridescence&&(r.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(r.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(r.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapRotation&&(r.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==e3&&(r.blending=this.blending),this.side!==eZ&&(r.side=this.side),!0===this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=!0),this.blendSrc!==to&&(r.blendSrc=this.blendSrc),this.blendDst!==tl&&(r.blendDst=this.blendDst),this.blendEquation!==e9&&(r.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(r.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(r.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==tx&&(r.depthFunc=this.depthFunc),!1===this.depthTest&&(r.depthTest=this.depthTest),!1===this.depthWrite&&(r.depthWrite=this.depthWrite),!1===this.colorWrite&&(r.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==iI&&(r.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(r.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ip&&(r.stencilFail=this.stencilFail),this.stencilZFail!==ip&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==ip&&(r.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(r.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.alphaHash&&(r.alphaHash=!0),!0===this.alphaToCoverage&&(r.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=!0),!0===this.forceSinglePass&&(r.forceSinglePass=!0),!0===this.wireframe&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),!1===this.fog&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData),t){let t=i(e.textures),n=i(e.images);t.length>0&&(r.textures=t),n.length>0&&(r.images=n)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,r=null;if(null!==t){let e=t.length;r=Array(e);for(let i=0;i!==e;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class aY extends aj{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new aQ(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ao,this.combine=tC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}let aK=function(){let e=new ArrayBuffer(4),t=new Float32Array(e),r=new Uint32Array(e),i=new Uint32Array(512),n=new Uint32Array(512);for(let e=0;e<256;++e){let t=e-127;t<-27?(i[e]=0,i[256|e]=32768,n[e]=24,n[256|e]=24):t<-14?(i[e]=1024>>-t-14,i[256|e]=1024>>-t-14|32768,n[e]=-t-1,n[256|e]=-t-1):t<=15?(i[e]=t+15<<10,i[256|e]=t+15<<10|32768,n[e]=13,n[256|e]=13):t<128?(i[e]=31744,i[256|e]=64512,n[e]=24,n[256|e]=24):(i[e]=31744,i[256|e]=64512,n[e]=13,n[256|e]=13)}let a=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;(8388608&t)==0;)t<<=1,r-=8388608;t&=-8388609,r+=0x38800000,a[e]=t|r}for(let e=1024;e<2048;++e)a[e]=0x38000000+(e-1024<<13);for(let e=1;e<31;++e)s[e]=e<<23;s[31]=0x47800000,s[32]=0x80000000;for(let e=33;e<63;++e)s[e]=0x80000000+(e-32<<23);s[63]=0xc7800000;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:r,baseTable:i,shiftTable:n,mantissaTable:a,exponentTable:s,offsetTable:o}}();function aq(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=i5(e,-65504,65504),aK.floatView[0]=e;let t=aK.uint32View[0],r=t>>23&511;return aK.baseTable[r]+((8388607&t)>>aK.shiftTable[r])}function aX(e){let t=e>>10;return aK.uint32View[0]=aK.mantissaTable[aK.offsetTable[t]+(1023&e)]+aK.exponentTable[t],aK.floatView[0]}class a${static toHalfFloat(e){return aq(e)}static fromHalfFloat(e){return aX(e)}}let aJ=new ni,aZ=new nt,a0=0;class a1{constructor(e,t,r=!1){if(Array.isArray(e))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:a0++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=r,this.usage=iO,this.updateRanges=[],this.gpuType=re,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,r=this.count;t<r;t++)aZ.fromBufferAttribute(this,t),aZ.applyMatrix3(e),this.setXY(t,aZ.x,aZ.y);else if(3===this.itemSize)for(let t=0,r=this.count;t<r;t++)aJ.fromBufferAttribute(this,t),aJ.applyMatrix3(e),this.setXYZ(t,aJ.x,aJ.y,aJ.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)aJ.fromBufferAttribute(this,t),aJ.applyMatrix4(e),this.setXYZ(t,aJ.x,aJ.y,aJ.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)aJ.fromBufferAttribute(this,t),aJ.applyNormalMatrix(e),this.setXYZ(t,aJ.x,aJ.y,aJ.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)aJ.fromBufferAttribute(this,t),aJ.transformDirection(e),this.setXYZ(t,aJ.x,aJ.y,aJ.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=i9(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=i7(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=i9(t,this.array)),t}setX(e,t){return this.normalized&&(t=i7(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=i9(t,this.array)),t}setY(e,t){return this.normalized&&(t=i7(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=i9(t,this.array)),t}setZ(e,t){return this.normalized&&(t=i7(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=i9(t,this.array)),t}setW(e,t){return this.normalized&&(t=i7(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=i7(t,this.array),r=i7(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=i7(t,this.array),r=i7(r,this.array),i=i7(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e*=this.itemSize,this.normalized&&(t=i7(t,this.array),r=i7(r,this.array),i=i7(i,this.array),n=i7(n,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==iO&&(e.usage=this.usage),e}}class a2 extends a1{constructor(e,t,r){super(new Int8Array(e),t,r)}}class a3 extends a1{constructor(e,t,r){super(new Uint8Array(e),t,r)}}class a4 extends a1{constructor(e,t,r){super(new Uint8ClampedArray(e),t,r)}}class a5 extends a1{constructor(e,t,r){super(new Int16Array(e),t,r)}}class a6 extends a1{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class a8 extends a1{constructor(e,t,r){super(new Int32Array(e),t,r)}}class a9 extends a1{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class a7 extends a1{constructor(e,t,r){super(new Uint16Array(e),t,r),this.isFloat16BufferAttribute=!0}getX(e){let t=aX(this.array[e*this.itemSize]);return this.normalized&&(t=i9(t,this.array)),t}setX(e,t){return this.normalized&&(t=i7(t,this.array)),this.array[e*this.itemSize]=aq(t),this}getY(e){let t=aX(this.array[e*this.itemSize+1]);return this.normalized&&(t=i9(t,this.array)),t}setY(e,t){return this.normalized&&(t=i7(t,this.array)),this.array[e*this.itemSize+1]=aq(t),this}getZ(e){let t=aX(this.array[e*this.itemSize+2]);return this.normalized&&(t=i9(t,this.array)),t}setZ(e,t){return this.normalized&&(t=i7(t,this.array)),this.array[e*this.itemSize+2]=aq(t),this}getW(e){let t=aX(this.array[e*this.itemSize+3]);return this.normalized&&(t=i9(t,this.array)),t}setW(e,t){return this.normalized&&(t=i7(t,this.array)),this.array[e*this.itemSize+3]=aq(t),this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=i7(t,this.array),r=i7(r,this.array)),this.array[e+0]=aq(t),this.array[e+1]=aq(r),this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=i7(t,this.array),r=i7(r,this.array),i=i7(i,this.array)),this.array[e+0]=aq(t),this.array[e+1]=aq(r),this.array[e+2]=aq(i),this}setXYZW(e,t,r,i,n){return e*=this.itemSize,this.normalized&&(t=i7(t,this.array),r=i7(r,this.array),i=i7(i,this.array),n=i7(n,this.array)),this.array[e+0]=aq(t),this.array[e+1]=aq(r),this.array[e+2]=aq(i),this.array[e+3]=aq(n),this}}class se extends a1{constructor(e,t,r){super(new Float32Array(e),t,r)}}let st=0,sr=new n8,si=new aS,sn=new ni,sa=new nL,ss=new nL,so=new ni;class sl extends iZ{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:st++}),this.uuid=i4(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(nl(e)?a9:a6)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);let r=this.attributes.normal;if(void 0!==r){let t=new ns().getNormalMatrix(e);r.applyNormalMatrix(t),r.needsUpdate=!0}let i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return sr.makeRotationFromQuaternion(e),this.applyMatrix4(sr),this}rotateX(e){return sr.makeRotationX(e),this.applyMatrix4(sr),this}rotateY(e){return sr.makeRotationY(e),this.applyMatrix4(sr),this}rotateZ(e){return sr.makeRotationZ(e),this.applyMatrix4(sr),this}translate(e,t,r){return sr.makeTranslation(e,t,r),this.applyMatrix4(sr),this}scale(e,t,r){return sr.makeScale(e,t,r),this.applyMatrix4(sr),this}lookAt(e){return si.lookAt(e),si.updateMatrix(),this.applyMatrix4(si.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(sn).negate(),this.translate(sn.x,sn.y,sn.z),this}setFromPoints(e){let t=this.getAttribute("position");if(void 0===t){let t=[];for(let r=0,i=e.length;r<i;r++){let i=e[r];t.push(i.x,i.y,i.z||0)}this.setAttribute("position",new se(t,3))}else{let r=Math.min(e.length,t.count);for(let i=0;i<r;i++){let r=e[i];t.setXYZ(i,r.x,r.y,r.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new nL);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new ni(-1/0,-1/0,-1/0),new ni(Infinity,Infinity,Infinity));return}if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){let r=t[e];sa.setFromBufferAttribute(r),this.morphTargetsRelative?(so.addVectors(this.boundingBox.min,sa.min),this.boundingBox.expandByPoint(so),so.addVectors(this.boundingBox.max,sa.max),this.boundingBox.expandByPoint(so)):(this.boundingBox.expandByPoint(sa.min),this.boundingBox.expandByPoint(sa.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new nJ);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new ni,1/0);return}if(e){let r=this.boundingSphere.center;if(sa.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){let r=t[e];ss.setFromBufferAttribute(r),this.morphTargetsRelative?(so.addVectors(sa.min,ss.min),sa.expandByPoint(so),so.addVectors(sa.max,ss.max),sa.expandByPoint(so)):(sa.expandByPoint(ss.min),sa.expandByPoint(ss.max))}sa.getCenter(r);let i=0;for(let t=0,n=e.count;t<n;t++)so.fromBufferAttribute(e,t),i=Math.max(i,r.distanceToSquared(so));if(t)for(let n=0,a=t.length;n<a;n++){let a=t[n],s=this.morphTargetsRelative;for(let t=0,n=a.count;t<n;t++)so.fromBufferAttribute(a,t),s&&(sn.fromBufferAttribute(e,t),so.add(sn)),i=Math.max(i,r.distanceToSquared(so))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let r=t.position,i=t.normal,n=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new a1(new Float32Array(4*r.count),4));let a=this.getAttribute("tangent"),s=[],o=[];for(let e=0;e<r.count;e++)s[e]=new ni,o[e]=new ni;let l=new ni,u=new ni,c=new ni,h=new nt,d=new nt,f=new nt,p=new ni,m=new ni,g=this.groups;0===g.length&&(g=[{start:0,count:e.count}]);for(let t=0,i=g.length;t<i;++t){let i=g[t],a=i.start,A=i.count;for(let t=a,i=a+A;t<i;t+=3)!function(e,t,i){l.fromBufferAttribute(r,e),u.fromBufferAttribute(r,t),c.fromBufferAttribute(r,i),h.fromBufferAttribute(n,e),d.fromBufferAttribute(n,t),f.fromBufferAttribute(n,i),u.sub(l),c.sub(l),d.sub(h),f.sub(h);let a=1/(d.x*f.y-f.x*d.y);isFinite(a)&&(p.copy(u).multiplyScalar(f.y).addScaledVector(c,-d.y).multiplyScalar(a),m.copy(c).multiplyScalar(d.x).addScaledVector(u,-f.x).multiplyScalar(a),s[e].add(p),s[t].add(p),s[i].add(p),o[e].add(m),o[t].add(m),o[i].add(m))}(e.getX(t+0),e.getX(t+1),e.getX(t+2))}let A=new ni,v=new ni,y=new ni,E=new ni;function x(e){y.fromBufferAttribute(i,e),E.copy(y);let t=s[e];A.copy(t),A.sub(y.multiplyScalar(y.dot(t))).normalize(),v.crossVectors(E,t);let r=v.dot(o[e]);a.setXYZW(e,A.x,A.y,A.z,r<0?-1:1)}for(let t=0,r=g.length;t<r;++t){let r=g[t],i=r.start,n=r.count;for(let t=i,r=i+n;t<r;t+=3)x(e.getX(t+0)),x(e.getX(t+1)),x(e.getX(t+2))}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(void 0!==t){let r=this.getAttribute("normal");if(void 0===r)r=new a1(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let e=0,t=r.count;e<t;e++)r.setXYZ(e,0,0,0);let i=new ni,n=new ni,a=new ni,s=new ni,o=new ni,l=new ni,u=new ni,c=new ni;if(e)for(let h=0,d=e.count;h<d;h+=3){let d=e.getX(h+0),f=e.getX(h+1),p=e.getX(h+2);i.fromBufferAttribute(t,d),n.fromBufferAttribute(t,f),a.fromBufferAttribute(t,p),u.subVectors(a,n),c.subVectors(i,n),u.cross(c),s.fromBufferAttribute(r,d),o.fromBufferAttribute(r,f),l.fromBufferAttribute(r,p),s.add(u),o.add(u),l.add(u),r.setXYZ(d,s.x,s.y,s.z),r.setXYZ(f,o.x,o.y,o.z),r.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,s=t.count;e<s;e+=3)i.fromBufferAttribute(t,e+0),n.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),u.subVectors(a,n),c.subVectors(i,n),u.cross(c),r.setXYZ(e+0,u.x,u.y,u.z),r.setXYZ(e+1,u.x,u.y,u.z),r.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){let e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)so.fromBufferAttribute(e,t),so.normalize(),e.setXYZ(t,so.x,so.y,so.z)}toNonIndexed(){function e(e,t){let r=e.array,i=e.itemSize,n=e.normalized,a=new r.constructor(t.length*i),s=0,o=0;for(let n=0,l=t.length;n<l;n++){s=e.isInterleavedBufferAttribute?t[n]*e.data.stride+e.offset:t[n]*i;for(let e=0;e<i;e++)a[o++]=r[s++]}return new a1(a,i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new sl,r=this.index.array,i=this.attributes;for(let n in i){let a=e(i[n],r);t.setAttribute(n,a)}let n=this.morphAttributes;for(let i in n){let a=[],s=n[i];for(let t=0,i=s.length;t<i;t++){let i=e(s[t],r);a.push(i)}t.morphAttributes[i]=a}t.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let e=0,r=a.length;e<r;e++){let r=a[e];t.addGroup(r.start,r.count,r.materialIndex)}return t}toJSON(){let e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let t=this.parameters;for(let r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};let t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let r=this.attributes;for(let t in r){let i=r[t];e.data.attributes[t]=i.toJSON(e.data)}let i={},n=!1;for(let t in this.morphAttributes){let r=this.morphAttributes[t],a=[];for(let t=0,i=r.length;t<i;t++){let i=r[t];a.push(i.toJSON(e.data))}a.length>0&&(i[t]=a,n=!0)}n&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));let s=this.boundingSphere;return null!==s&&(e.data.boundingSphere=s.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let r=e.index;null!==r&&this.setIndex(r.clone());let i=e.attributes;for(let e in i){let r=i[e];this.setAttribute(e,r.clone(t))}let n=e.morphAttributes;for(let e in n){let r=[],i=n[e];for(let e=0,n=i.length;e<n;e++)r.push(i[e].clone(t));this.morphAttributes[e]=r}this.morphTargetsRelative=e.morphTargetsRelative;let a=e.groups;for(let e=0,t=a.length;e<t;e++){let t=a[e];this.addGroup(t.start,t.count,t.materialIndex)}let s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());let o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}let su=new n8,sc=new n6,sh=new nJ,sd=new ni,sf=new ni,sp=new ni,sm=new ni,sg=new ni,sA=new ni,sv=new ni,sy=new ni;class sE extends aS{constructor(e=new sl,t=new aY){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){let t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){let r=this.geometry,i=r.attributes.position,n=r.morphAttributes.position,a=r.morphTargetsRelative;t.fromBufferAttribute(i,e);let s=this.morphTargetInfluences;if(n&&s){sA.set(0,0,0);for(let r=0,i=n.length;r<i;r++){let i=s[r],o=n[r];0!==i&&(sg.fromBufferAttribute(o,e),a?sA.addScaledVector(sg,i):sA.addScaledVector(sg.sub(t),i))}t.add(sA)}return t}raycast(e,t){let r=this.geometry,i=this.material,n=this.matrixWorld;if(void 0!==i){if(null===r.boundingSphere&&r.computeBoundingSphere(),sh.copy(r.boundingSphere),sh.applyMatrix4(n),sc.copy(e.ray).recast(e.near),!1===sh.containsPoint(sc.origin)&&(null===sc.intersectSphere(sh,sd)||sc.origin.distanceToSquared(sd)>(e.far-e.near)**2)||(su.copy(n).invert(),sc.copy(e.ray).applyMatrix4(su),null!==r.boundingBox&&!1===sc.intersectsBox(r.boundingBox)))return;this._computeIntersections(e,t,sc)}}_computeIntersections(e,t,r){let i;let n=this.geometry,a=this.material,s=n.index,o=n.attributes.position,l=n.attributes.uv,u=n.attributes.uv1,c=n.attributes.normal,h=n.groups,d=n.drawRange;if(null!==s){if(Array.isArray(a))for(let n=0,o=h.length;n<o;n++){let o=h[n],f=a[o.materialIndex],p=Math.max(o.start,d.start),m=Math.min(s.count,Math.min(o.start+o.count,d.start+d.count));for(let n=p;n<m;n+=3)(i=sx(this,f,e,r,l,u,c,s.getX(n),s.getX(n+1),s.getX(n+2)))&&(i.faceIndex=Math.floor(n/3),i.face.materialIndex=o.materialIndex,t.push(i))}else{let n=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);for(let h=n;h<o;h+=3)(i=sx(this,a,e,r,l,u,c,s.getX(h),s.getX(h+1),s.getX(h+2)))&&(i.faceIndex=Math.floor(h/3),t.push(i))}}else if(void 0!==o){if(Array.isArray(a))for(let n=0,s=h.length;n<s;n++){let s=h[n],f=a[s.materialIndex],p=Math.max(s.start,d.start),m=Math.min(o.count,Math.min(s.start+s.count,d.start+d.count));for(let n=p;n<m;n+=3)(i=sx(this,f,e,r,l,u,c,n,n+1,n+2))&&(i.faceIndex=Math.floor(n/3),i.face.materialIndex=s.materialIndex,t.push(i))}else{let n=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);for(let o=n;o<s;o+=3)(i=sx(this,a,e,r,l,u,c,o,o+1,o+2))&&(i.faceIndex=Math.floor(o/3),t.push(i))}}}}function sx(e,t,r,i,n,a,s,o,l,u){e.getVertexPosition(o,sf),e.getVertexPosition(l,sp),e.getVertexPosition(u,sm);let c=function(e,t,r,i,n,a,s,o){if(null===(t.side===e0?i.intersectTriangle(s,a,n,!0,o):i.intersectTriangle(n,a,s,t.side===eZ,o)))return null;sy.copy(o),sy.applyMatrix4(e.matrixWorld);let l=r.ray.origin.distanceTo(sy);return l<r.near||l>r.far?null:{distance:l,point:sy.clone(),object:e}}(e,t,r,i,sf,sp,sm,sv);if(c){let e=new ni;aU.getBarycoord(sv,sf,sp,sm,e),n&&(c.uv=aU.getInterpolatedAttribute(n,o,l,u,e,new nt)),a&&(c.uv1=aU.getInterpolatedAttribute(a,o,l,u,e,new nt)),s&&(c.normal=aU.getInterpolatedAttribute(s,o,l,u,e,new ni),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));let t={a:o,b:l,c:u,normal:new ni,materialIndex:0};aU.getNormal(sf,sp,sm,t.normal),c.face=t,c.barycoord=e}return c}class s_ extends sl{constructor(e=1,t=1,r=1,i=1,n=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:a};let s=this;i=Math.floor(i),n=Math.floor(n);let o=[],l=[],u=[],c=[],h=0,d=0;function f(e,t,r,i,n,a,f,p,m,g,A){let v=a/m,y=f/g,E=a/2,x=f/2,_=p/2,b=m+1,S=g+1,w=0,C=0,T=new ni;for(let a=0;a<S;a++){let s=a*y-x;for(let o=0;o<b;o++){let h=o*v-E;T[e]=h*i,T[t]=s*n,T[r]=_,l.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[r]=p>0?1:-1,u.push(T.x,T.y,T.z),c.push(o/m),c.push(1-a/g),w+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){let r=h+t+b*e,i=h+t+b*(e+1),n=h+(t+1)+b*(e+1),a=h+(t+1)+b*e;o.push(r,i,a),o.push(i,n,a),C+=6}s.addGroup(d,C,A),d+=C,h+=w}f("z","y","x",-1,-1,r,t,e,a=Math.floor(a),n,0),f("z","y","x",1,-1,r,t,-e,a,n,1),f("x","z","y",1,1,e,r,t,i,a,2),f("x","z","y",1,-1,e,r,-t,i,a,3),f("x","y","z",1,-1,e,t,r,i,n,4),f("x","y","z",-1,-1,e,t,-r,i,n,5),this.setIndex(o),this.setAttribute("position",new se(l,3)),this.setAttribute("normal",new se(u,3)),this.setAttribute("uv",new se(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new s_(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function sb(e){let t={};for(let r in e)for(let i in t[r]={},e[r]){let n=e[r][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[r][i]=null):t[r][i]=n.clone():Array.isArray(n)?t[r][i]=n.slice():t[r][i]=n}return t}function sS(e){let t={};for(let r=0;r<e.length;r++){let i=sb(e[r]);for(let e in i)t[e]=i[e]}return t}function sw(e){let t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:nA.workingColorSpace}let sC={clone:sb,merge:sS};class sT extends aj{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=sb(e.uniforms),this.uniformsGroups=function(e){let t=[];for(let r=0;r<e.length;r++)t.push(e[r].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);for(let r in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){let i=this.uniforms[r].value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;let r={};for(let e in this.extensions)!0===this.extensions[e]&&(r[e]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class sI extends aS{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new n8,this.projectionMatrix=new n8,this.projectionMatrixInverse=new n8,this.coordinateSystem=iK,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}let sM=new ni,sR=new nt,sB=new nt;class sD extends sI{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=2*i3*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*i2*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*i3*Math.atan(Math.tan(.5*i2*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){sM.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(sM.x,sM.y).multiplyScalar(-e/sM.z),sM.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(sM.x,sM.y).multiplyScalar(-e/sM.z)}getViewSize(e,t){return this.getViewBounds(e,sR,sB),t.subVectors(sB,sR)}setViewOffset(e,t,r,i,n,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(.5*i2*this.fov)/this.zoom,r=2*t,i=this.aspect*r,n=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){let e=a.fullWidth,s=a.fullHeight;n+=a.offsetX*i/e,t-=a.offsetY*r/s,i*=a.width/e,r*=a.height/s}let s=this.filmOffset;0!==s&&(n+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-r,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class sP extends aS{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;let i=new sD(-90,1,e,t);i.layers=this.layers,this.add(i);let n=new sD(-90,1,e,t);n.layers=this.layers,this.add(n);let a=new sD(-90,1,e,t);a.layers=this.layers,this.add(a);let s=new sD(-90,1,e,t);s.layers=this.layers,this.add(s);let o=new sD(-90,1,e,t);o.layers=this.layers,this.add(o);let l=new sD(-90,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){let e=this.coordinateSystem,t=this.children.concat(),[r,i,n,a,s,o]=t;for(let e of t)this.remove(e);if(e===iK)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),n.up.set(0,0,-1),n.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else if(e===iq)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),n.up.set(0,0,1),n.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1);else throw Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(let e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();let{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());let[n,a,s,o,l,u]=this.children,c=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;let p=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,n),e.setRenderTarget(r,1,i),e.render(t,a),e.setRenderTarget(r,2,i),e.render(t,s),e.setRenderTarget(r,3,i),e.render(t,o),e.setRenderTarget(r,4,i),e.render(t,l),r.texture.generateMipmaps=p,e.setRenderTarget(r,5,i),e.render(t,u),e.setRenderTarget(c,h,d),e.xr.enabled=f,r.texture.needsPMREMUpdate=!0}}class sL extends nC{constructor(e=[],t=tz,r,i,n,a,s,o,l,u){super(e,t,r,i,n,a,s,o,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class sk extends nM{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let r={width:e,height:e,depth:1};this.texture=new sL([r,r,r,r,r,r]),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new s_(5,5,5),n=new sT({name:"CubemapFromEquirect",uniforms:sb(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:e0,blending:e2});n.uniforms.tEquirect.value=t;let a=new sE(i,n),s=t.minFilter;return t.minFilter===t2&&(t.minFilter=tZ),new sP(1,10,this).update(e,a),t.minFilter=s,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,r=!0,i=!0){let n=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,r,i);e.setRenderTarget(n)}}class sF extends aS{constructor(){super(),this.isGroup=!0,this.type="Group"}}let sO={type:"move"};class sU{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new sF,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new sF,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ni,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ni),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new sF,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ni,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ni),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,r){let i=null,n=null,a=null,s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){for(let i of(a=!0,e.hand.values())){let e=t.getJointPose(i,r),n=this._getHandJoint(l,i);null!==e&&(n.matrix.fromArray(e.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.matrixWorldNeedsUpdate=!0,n.jointRadius=e.radius),n.visible=null!==e}let i=l.joints["index-finger-tip"],n=l.joints["thumb-tip"],s=i.position.distanceTo(n.position);l.inputState.pinching&&s>.025?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&null!==(n=t.getPose(e.gripSpace,r))&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1);null!==s&&(null===(i=t.getPose(e.targetRaySpace,r))&&null!==n&&(i=n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(sO)))}return null!==s&&(s.visible=null!==i),null!==o&&(o.visible=null!==n),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){let r=new sF;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class sN{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new aQ(e),this.density=t}clone(){return new sN(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class sz{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new aQ(e),this.near=t,this.far=r}clone(){return new sz(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class sG extends aS{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new ao,this.environmentIntensity=1,this.environmentRotation=new ao,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class sH{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=iO,this.updateRanges=[],this.version=0,this.uuid=i4()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let i=0,n=this.stride;i<n;i++)this.array[e+i]=t.array[r+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=i4()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=i4()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}let sQ=new ni;class sV{constructor(e,t,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)sQ.fromBufferAttribute(this,t),sQ.applyMatrix4(e),this.setXYZ(t,sQ.x,sQ.y,sQ.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)sQ.fromBufferAttribute(this,t),sQ.applyNormalMatrix(e),this.setXYZ(t,sQ.x,sQ.y,sQ.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)sQ.fromBufferAttribute(this,t),sQ.transformDirection(e),this.setXYZ(t,sQ.x,sQ.y,sQ.z);return this}getComponent(e,t){let r=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(r=i9(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=i7(r,this.array)),this.data.array[e*this.data.stride+this.offset+t]=r,this}setX(e,t){return this.normalized&&(t=i7(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=i7(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=i7(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=i7(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=i9(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=i9(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=i9(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=i9(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=i7(t,this.array),r=i7(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=i7(t,this.array),r=i7(r,this.array),i=i7(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=i7(t,this.array),r=i7(r,this.array),i=i7(i,this.array),n=i7(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new sV(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let r=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[r+t])}return new a1(new this.array.constructor(e),this.itemSize,this.normalized)}}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let r=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[r+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}}}class sW extends aj{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new aQ(0xffffff),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let sj=new ni,sY=new ni,sK=new ni,sq=new nt,sX=new nt,s$=new n8,sJ=new ni,sZ=new ni,s0=new ni,s1=new nt,s2=new nt,s3=new nt;class s4 extends aS{constructor(e=new sW){if(super(),this.isSprite=!0,this.type="Sprite",void 0===n){n=new sl;let e=new sH(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);n.setIndex([0,1,2,0,2,3]),n.setAttribute("position",new sV(e,3,0,!1)),n.setAttribute("uv",new sV(e,2,3,!1))}this.geometry=n,this.material=e,this.center=new nt(.5,.5),this.count=1}raycast(e,t){let r,i;null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),sY.setFromMatrixScale(this.matrixWorld),s$.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),sK.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&sY.multiplyScalar(-sK.z);let n=this.material.rotation;0!==n&&(i=Math.cos(n),r=Math.sin(n));let a=this.center;s5(sJ.set(-.5,-.5,0),sK,a,sY,r,i),s5(sZ.set(.5,-.5,0),sK,a,sY,r,i),s5(s0.set(.5,.5,0),sK,a,sY,r,i),s1.set(0,0),s2.set(1,0),s3.set(1,1);let s=e.ray.intersectTriangle(sJ,sZ,s0,!1,sj);if(null===s&&(s5(sZ.set(-.5,.5,0),sK,a,sY,r,i),s2.set(0,1),null===(s=e.ray.intersectTriangle(sJ,s0,sZ,!1,sj))))return;let o=e.ray.origin.distanceTo(sj);o<e.near||o>e.far||t.push({distance:o,point:sj.clone(),uv:aU.getInterpolation(sj,sJ,sZ,s0,s1,s2,s3,new nt),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function s5(e,t,r,i,n,a){sq.subVectors(e,r).addScalar(.5).multiply(i),void 0!==n?(sX.x=a*sq.x-n*sq.y,sX.y=n*sq.x+a*sq.y):sX.copy(sq),e.copy(t),e.x+=sX.x,e.y+=sX.y,e.applyMatrix4(s$)}let s6=new ni,s8=new ni;class s9 extends aS{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);let t=e.levels;for(let e=0,r=t.length;e<r;e++){let r=t[e];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,r=0){let i;t=Math.abs(t);let n=this.levels;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,hysteresis:r,object:e}),this.add(e),this}removeLevel(e){let t=this.levels;for(let r=0;r<t.length;r++)if(t[r].distance===e){let e=t.splice(r,1);return this.remove(e[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){let t=this.levels;if(t.length>0){let r,i;for(r=1,i=t.length;r<i;r++){let i=t[r].distance;if(t[r].object.visible&&(i-=i*t[r].hysteresis),e<i)break}return t[r-1].object}return null}raycast(e,t){if(this.levels.length>0){s6.setFromMatrixPosition(this.matrixWorld);let r=e.ray.origin.distanceTo(s6);this.getObjectForDistance(r).raycast(e,t)}}update(e){let t=this.levels;if(t.length>1){let r,i;s6.setFromMatrixPosition(e.matrixWorld),s8.setFromMatrixPosition(this.matrixWorld);let n=s6.distanceTo(s8)/e.zoom;for(r=1,t[0].object.visible=!0,i=t.length;r<i;r++){let e=t[r].distance;if(t[r].object.visible&&(e-=e*t[r].hysteresis),n>=e)t[r-1].object.visible=!1,t[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){let t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];let r=this.levels;for(let e=0,i=r.length;e<i;e++){let i=r[e];t.object.levels.push({object:i.object.uuid,distance:i.distance,hysteresis:i.hysteresis})}return t}}let s7=new ni,oe=new nT,ot=new nT,or=new ni,oi=new n8,on=new ni,oa=new nJ,os=new n8,oo=new n6;class ol extends sE{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=tO,this.bindMatrix=new n8,this.bindMatrixInverse=new n8,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){let e=this.geometry;null===this.boundingBox&&(this.boundingBox=new nL),this.boundingBox.makeEmpty();let t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,on),this.boundingBox.expandByPoint(on)}computeBoundingSphere(){let e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new nJ),this.boundingSphere.makeEmpty();let t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,on),this.boundingSphere.expandByPoint(on)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){let r=this.material,i=this.matrixWorld;if(void 0!==r&&(null===this.boundingSphere&&this.computeBoundingSphere(),oa.copy(this.boundingSphere),oa.applyMatrix4(i),!1!==e.ray.intersectsSphere(oa))){if(os.copy(i).invert(),oo.copy(e.ray).applyMatrix4(os),null!==this.boundingBox&&!1===oo.intersectsBox(this.boundingBox))return;this._computeIntersections(e,t,oo)}}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new nT,t=this.geometry.attributes.skinWeight;for(let r=0,i=t.count;r<i;r++){e.fromBufferAttribute(t,r);let i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===tO?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===tU?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){let r=this.skeleton,i=this.geometry;oe.fromBufferAttribute(i.attributes.skinIndex,e),ot.fromBufferAttribute(i.attributes.skinWeight,e),s7.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){let i=ot.getComponent(e);if(0!==i){let n=oe.getComponent(e);oi.multiplyMatrices(r.bones[n].matrixWorld,r.boneInverses[n]),t.addScaledVector(or.copy(s7).applyMatrix4(oi),i)}}return t.applyMatrix4(this.bindMatrixInverse)}}class ou extends aS{constructor(){super(),this.isBone=!0,this.type="Bone"}}class oc extends nC{constructor(e=null,t=1,r=1,i,n,a,s,o,l=tK,u=tK,c,h){super(null,a,s,o,l,u,i,n,c,h),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let oh=new n8,od=new n8;class of{constructor(e=[],t=[]){this.uuid=i4(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new n8)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let t=new n8;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){let e=this.bones,t=this.boneInverses,r=this.boneMatrices,i=this.boneTexture;for(let i=0,n=e.length;i<n;i++){let n=e[i]?e[i].matrixWorld:od;oh.multiplyMatrices(n,t[i]),oh.toArray(r,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new of(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length),t=new Float32Array((e=Math.max(e=4*Math.ceil(e/4),4))*e*4);t.set(this.boneMatrices);let r=new oc(t,e,e,ru,re);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,i=e.bones.length;r<i;r++){let i=e.bones[r],n=t[i];void 0===n&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),n=new ou),this.bones.push(n),this.boneInverses.push(new n8().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){let e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,r=this.boneInverses;for(let i=0,n=t.length;i<n;i++){let n=t[i];e.bones.push(n.uuid);let a=r[i];e.boneInverses.push(a.toArray())}return e}}class op extends a1{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}let om=new n8,og=new n8,oA=[],ov=new nL,oy=new n8,oE=new sE,ox=new nJ;class o_ extends sE{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new op(new Float32Array(16*r),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<r;e++)this.setMatrixAt(e,oy)}computeBoundingBox(){let e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new nL),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,om),ov.copy(e.boundingBox).applyMatrix4(om),this.boundingBox.union(ov)}computeBoundingSphere(){let e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new nJ),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,om),ox.copy(e.boundingSphere).applyMatrix4(om),this.boundingSphere.union(ox)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){let r=t.morphTargetInfluences,i=this.morphTexture.source.data.data,n=e*(r.length+1)+1;for(let e=0;e<r.length;e++)r[e]=i[n+e]}raycast(e,t){let r=this.matrixWorld,i=this.count;if(oE.geometry=this.geometry,oE.material=this.material,void 0!==oE.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),ox.copy(this.boundingSphere),ox.applyMatrix4(r),!1!==e.ray.intersectsSphere(ox)))for(let n=0;n<i;n++){this.getMatrixAt(n,om),og.multiplyMatrices(r,om),oE.matrixWorld=og,oE.raycast(e,oA);for(let e=0,r=oA.length;e<r;e++){let r=oA[e];r.instanceId=n,r.object=this,t.push(r)}oA.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new op(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){let r=t.morphTargetInfluences,i=r.length+1;null===this.morphTexture&&(this.morphTexture=new oc(new Float32Array(i*this.count),i,this.count,rd,re));let n=this.morphTexture.source.data.data,a=0;for(let e=0;e<r.length;e++)a+=r[e];let s=this.geometry.morphTargetsRelative?1:1-a,o=i*e;n[o]=s,n.set(r,o+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}let ob=new ni,oS=new ni,ow=new ns;class oC{constructor(e=new ni(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){let i=ob.subVectors(r,t).cross(oS.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){let r=e.delta(ob),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/i;return n<0||n>1?null:t.copy(e.start).addScaledVector(r,n)}intersectsLine(e){let t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let r=t||ow.getNormalMatrix(e),i=this.coplanarPoint(ob).applyMatrix4(e),n=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}let oT=new nJ,oI=new nt(.5,.5),oM=new ni;class oR{constructor(e=new oC,t=new oC,r=new oC,i=new oC,n=new oC,a=new oC){this.planes=[e,t,r,i,n,a]}set(e,t,r,i,n,a){let s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(i),s[4].copy(n),s[5].copy(a),this}copy(e){let t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=iK,r=!1){let i=this.planes,n=e.elements,a=n[0],s=n[1],o=n[2],l=n[3],u=n[4],c=n[5],h=n[6],d=n[7],f=n[8],p=n[9],m=n[10],g=n[11],A=n[12],v=n[13],y=n[14],E=n[15];if(i[0].setComponents(l-a,d-u,g-f,E-A).normalize(),i[1].setComponents(l+a,d+u,g+f,E+A).normalize(),i[2].setComponents(l+s,d+c,g+p,E+v).normalize(),i[3].setComponents(l-s,d-c,g-p,E-v).normalize(),r)i[4].setComponents(o,h,m,y).normalize(),i[5].setComponents(l-o,d-h,g-m,E-y).normalize();else if(i[4].setComponents(l-o,d-h,g-m,E-y).normalize(),t===iK)i[5].setComponents(l+o,d+h,g+m,E+y).normalize();else if(t===iq)i[5].setComponents(o,h,m,y).normalize();else throw Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),oT.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{let t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),oT.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(oT)}intersectsSprite(e){oT.center.set(0,0,0);let t=oI.distanceTo(e.center);return oT.radius=.7071067811865476+t,oT.applyMatrix4(e.matrixWorld),this.intersectsSphere(oT)}intersectsSphere(e){let t=this.planes,r=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){let t=this.planes;for(let r=0;r<6;r++){let i=t[r];if(oM.x=i.normal.x>0?e.max.x:e.min.x,oM.y=i.normal.y>0?e.max.y:e.min.y,oM.z=i.normal.z>0?e.max.z:e.min.z,0>i.distanceToPoint(oM))return!1}return!0}containsPoint(e){let t=this.planes;for(let r=0;r<6;r++)if(0>t[r].distanceToPoint(e))return!1;return!0}clone(){return new this.constructor().copy(this)}}let oB=new n8,oD=new oR;class oP{constructor(){this.coordinateSystem=iK}intersectsObject(e,t){if(!t.isArrayCamera||0===t.cameras.length)return!1;for(let r=0;r<t.cameras.length;r++){let i=t.cameras[r];if(oB.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),oD.setFromProjectionMatrix(oB,i.coordinateSystem,i.reversedDepth),oD.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let r=0;r<t.cameras.length;r++){let i=t.cameras[r];if(oB.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),oD.setFromProjectionMatrix(oB,i.coordinateSystem,i.reversedDepth),oD.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let r=0;r<t.cameras.length;r++){let i=t.cameras[r];if(oB.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),oD.setFromProjectionMatrix(oB,i.coordinateSystem,i.reversedDepth),oD.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let r=0;r<t.cameras.length;r++){let i=t.cameras[r];if(oB.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),oD.setFromProjectionMatrix(oB,i.coordinateSystem,i.reversedDepth),oD.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let r=0;r<t.cameras.length;r++){let i=t.cameras[r];if(oB.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),oD.setFromProjectionMatrix(oB,i.coordinateSystem,i.reversedDepth),oD.containsPoint(e))return!0}return!1}clone(){return new oP}}function oL(e,t){return e-t}function ok(e,t){return e.z-t.z}function oF(e,t){return t.z-e.z}class oO{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,r,i){let n=this.pool,a=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1,index:-1});let s=n[this.index];a.push(s),this.index++,s.start=e,s.count=t,s.z=r,s.index=i}reset(){this.list.length=0,this.index=0}}let oU=new n8,oN=new aQ(1,1,1),oz=new oR,oG=new oP,oH=new nL,oQ=new nJ,oV=new ni,oW=new ni,oj=new ni,oY=new oO,oK=new sE,oq=[];function oX(e,t){if(e.constructor!==t.constructor){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++)t[i]=e[i]}else{let r=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,r))}}class o$ extends sE{constructor(e,t,r=2*t,i){super(new sl,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=r,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount),t=new oc(new Float32Array((e=Math.max(e=4*Math.ceil(e/4),4))*e*4),e,e,ru,re);this._matricesTexture=t}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount),t=new oc(new Uint32Array((e=Math.ceil(e))*e),e,e,rf,t7);this._indirectTexture=t}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount),t=new oc(new Float32Array((e=Math.ceil(e))*e*4).fill(1),e,e,ru,re);t.colorSpace=nA.workingColorSpace,this._colorsTexture=t}_initializeGeometry(e){let t=this.geometry,r=this._maxVertexCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(let i in e.attributes){let{array:n,itemSize:a,normalized:s}=e.getAttribute(i),o=new a1(new n.constructor(r*a),a,s);t.setAttribute(i,o)}if(null!==e.getIndex()){let e=r>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new a1(e,1))}this._geometryInitialized=!0}}_validateGeometry(e){let t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(let r in t.attributes){if(!e.hasAttribute(r))throw Error(`THREE.BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);let i=e.getAttribute(r),n=t.getAttribute(r);if(i.itemSize!==n.itemSize||i.normalized!==n.normalized)throw Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){let t=this._instanceInfo;if(e<0||e>=t.length||!1===t[e].active)throw Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){let t=this._geometryInfo;if(e<0||e>=t.length||!1===t[e].active)throw Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new nL);let e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let r=0,i=t.length;r<i;r++){if(!1===t[r].active)continue;let i=t[r].geometryIndex;this.getMatrixAt(r,oU),this.getBoundingBoxAt(i,oH).applyMatrix4(oU),e.union(oH)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new nJ);let e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let r=0,i=t.length;r<i;r++){if(!1===t[r].active)continue;let i=t[r].geometryIndex;this.getMatrixAt(r,oU),this.getBoundingSphereAt(i,oQ).applyMatrix4(oU),e.union(oQ)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw Error("THREE.BatchedMesh: Maximum item count reached.");let t={visible:!0,active:!0,geometryIndex:e},r=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(oL),r=this._availableInstanceIds.shift(),this._instanceInfo[r]=t):(r=this._instanceInfo.length,this._instanceInfo.push(t));let i=this._matricesTexture;oU.identity().toArray(i.image.data,16*r),i.needsUpdate=!0;let n=this._colorsTexture;return n&&(oN.toArray(n.image.data,4*r),n.needsUpdate=!0),this._visibilityChanged=!0,r}addGeometry(e,t=-1,r=-1){let i;this._initializeGeometry(e),this._validateGeometry(e);let n={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},a=this._geometryInfo;n.vertexStart=this._nextVertexStart,n.reservedVertexCount=-1===t?e.getAttribute("position").count:t;let s=e.getIndex();if(null!==s&&(n.indexStart=this._nextIndexStart,n.reservedIndexCount=-1===r?s.count:r),-1!==n.indexStart&&n.indexStart+n.reservedIndexCount>this._maxIndexCount||n.vertexStart+n.reservedVertexCount>this._maxVertexCount)throw Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(oL),a[i=this._availableGeometryIds.shift()]=n):(i=this._geometryCount,this._geometryCount++,a.push(n)),this.setGeometryAt(i,e),this._nextIndexStart=n.indexStart+n.reservedIndexCount,this._nextVertexStart=n.vertexStart+n.reservedVertexCount,i}setGeometryAt(e,t){if(e>=this._geometryCount)throw Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);let r=this.geometry,i=null!==r.getIndex(),n=r.getIndex(),a=t.getIndex(),s=this._geometryInfo[e];if(i&&a.count>s.reservedIndexCount||t.attributes.position.count>s.reservedVertexCount)throw Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");let o=s.vertexStart,l=s.reservedVertexCount;for(let e in s.vertexCount=t.getAttribute("position").count,r.attributes){let i=t.getAttribute(e),n=r.getAttribute(e);!function(e,t,r=0){let i=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){let n=e.count;for(let a=0;a<n;a++)for(let n=0;n<i;n++)t.setComponent(a+r,n,e.getComponent(a,n))}else t.array.set(e.array,r*i);t.needsUpdate=!0}(i,n,o);let a=i.itemSize;for(let e=i.count;e<l;e++){let t=o+e;for(let e=0;e<a;e++)n.setComponent(t,e,0)}n.needsUpdate=!0,n.addUpdateRange(o*a,l*a)}if(i){let e=s.indexStart,r=s.reservedIndexCount;s.indexCount=t.getIndex().count;for(let t=0;t<a.count;t++)n.setX(e+t,o+a.getX(t));for(let t=a.count;t<r;t++)n.setX(e+t,o);n.needsUpdate=!0,n.addUpdateRange(e,s.reservedIndexCount)}return s.start=i?s.indexStart:s.vertexStart,s.count=i?s.indexCount:s.vertexCount,s.boundingBox=null,null!==t.boundingBox&&(s.boundingBox=t.boundingBox.clone()),s.boundingSphere=null,null!==t.boundingSphere&&(s.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){let t=this._geometryInfo;if(e>=t.length||!1===t[e].active)return this;let r=this._instanceInfo;for(let t=0,i=r.length;t<i;t++)r[t].active&&r[t].geometryIndex===e&&this.deleteInstance(t);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0,r=this._geometryInfo,i=r.map((e,t)=>t).sort((e,t)=>r[e].vertexStart-r[t].vertexStart),n=this.geometry;for(let a=0,s=r.length;a<s;a++){let s=r[i[a]];if(!1!==s.active){if(null!==n.index){if(s.indexStart!==t){let{indexStart:r,vertexStart:i,reservedIndexCount:a}=s,o=n.index,l=o.array,u=e-i;for(let e=r;e<r+a;e++)l[e]=l[e]+u;o.array.copyWithin(t,r,r+a),o.addUpdateRange(t,a),s.indexStart=t}t+=s.reservedIndexCount}if(s.vertexStart!==e){let{vertexStart:t,reservedVertexCount:r}=s,i=n.attributes;for(let n in i){let a=i[n],{array:s,itemSize:o}=a;s.copyWithin(e*o,t*o,(t+r)*o),a.addUpdateRange(e*o,r*o)}s.vertexStart=e}e+=s.reservedVertexCount,s.start=n.index?s.indexStart:s.vertexStart,this._nextIndexStart=n.index?s.indexStart+s.reservedIndexCount:0,this._nextVertexStart=s.vertexStart+s.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;let r=this.geometry,i=this._geometryInfo[e];if(null===i.boundingBox){let e=new nL,t=r.index,n=r.attributes.position;for(let r=i.start,a=i.start+i.count;r<a;r++){let i=r;t&&(i=t.getX(i)),e.expandByPoint(oV.fromBufferAttribute(n,i))}i.boundingBox=e}return t.copy(i.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;let r=this.geometry,i=this._geometryInfo[e];if(null===i.boundingSphere){let t=new nJ;this.getBoundingBoxAt(e,oH),oH.getCenter(t.center);let n=r.index,a=r.attributes.position,s=0;for(let e=i.start,r=i.start+i.count;e<r;e++){let r=e;n&&(r=n.getX(r)),oV.fromBufferAttribute(a,r),s=Math.max(s,t.center.distanceToSquared(oV))}t.radius=Math.sqrt(s),i.boundingSphere=t}return t.copy(i.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);let r=this._matricesTexture,i=this._matricesTexture.image.data;return t.toArray(i,16*e),r.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,16*e)}setColorAt(e,t){return this.validateInstanceId(e),null===this._colorsTexture&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,4*e),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,4*e)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t||(this._instanceInfo[e].visible=t,this._visibilityChanged=!0),this}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);let r=this._geometryInfo[e];return t.vertexStart=r.vertexStart,t.vertexCount=r.vertexCount,t.reservedVertexCount=r.reservedVertexCount,t.indexStart=r.indexStart,t.indexCount=r.indexCount,t.reservedIndexCount=r.reservedIndexCount,t.start=r.start,t.count=r.count,t}setInstanceCount(e){let t=this._availableInstanceIds,r=this._instanceInfo;for(t.sort(oL);t[t.length-1]===r.length-1;)r.pop(),t.pop();if(e<r.length)throw Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);let i=new Int32Array(e),n=new Int32Array(e);oX(this._multiDrawCounts,i),oX(this._multiDrawStarts,n),this._multiDrawCounts=i,this._multiDrawStarts=n,this._maxInstanceCount=e;let a=this._indirectTexture,s=this._matricesTexture,o=this._colorsTexture;a.dispose(),this._initIndirectTexture(),oX(a.image.data,this._indirectTexture.image.data),s.dispose(),this._initMatricesTexture(),oX(s.image.data,this._matricesTexture.image.data),o&&(o.dispose(),this._initColorsTexture(),oX(o.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){let r=[...this._geometryInfo].filter(e=>e.active);if(Math.max(...r.map(e=>e.vertexStart+e.reservedVertexCount))>e)throw Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...r.map(e=>e.indexStart+e.reservedIndexCount))>t)throw Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);let i=this.geometry;i.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new sl,this._initializeGeometry(i));let n=this.geometry;for(let e in i.index&&oX(i.index.array,n.index.array),i.attributes)oX(i.attributes[e].array,n.attributes[e].array)}raycast(e,t){let r=this._instanceInfo,i=this._geometryInfo,n=this.matrixWorld,a=this.geometry;oK.material=this.material,oK.geometry.index=a.index,oK.geometry.attributes=a.attributes,null===oK.geometry.boundingBox&&(oK.geometry.boundingBox=new nL),null===oK.geometry.boundingSphere&&(oK.geometry.boundingSphere=new nJ);for(let a=0,s=r.length;a<s;a++){if(!r[a].visible||!r[a].active)continue;let s=r[a].geometryIndex,o=i[s];oK.geometry.setDrawRange(o.start,o.count),this.getMatrixAt(a,oK.matrixWorld).premultiply(n),this.getBoundingBoxAt(s,oK.geometry.boundingBox),this.getBoundingSphereAt(s,oK.geometry.boundingSphere),oK.raycast(e,oq);for(let e=0,r=oq.length;e<r;e++){let r=oq[e];r.object=this,r.batchId=a,t.push(r)}oq.length=0}oK.material=null,oK.geometry.index=null,oK.geometry.attributes={},oK.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(e=>({...e,boundingBox:null!==e.boundingBox?e.boundingBox.clone():null,boundingSphere:null!==e.boundingSphere?e.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(e=>({...e})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,r,i,n){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;let a=i.getIndex(),s=null===a?1:a.array.BYTES_PER_ELEMENT,o=this._instanceInfo,l=this._multiDrawStarts,u=this._multiDrawCounts,c=this._geometryInfo,h=this.perObjectFrustumCulled,d=this._indirectTexture,f=d.image.data,p=r.isArrayCamera?oG:oz;h&&!r.isArrayCamera&&(oU.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),oz.setFromProjectionMatrix(oU,r.coordinateSystem,r.reversedDepth));let m=0;if(this.sortObjects){oU.copy(this.matrixWorld).invert(),oV.setFromMatrixPosition(r.matrixWorld).applyMatrix4(oU),oW.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(oU);for(let e=0,t=o.length;e<t;e++)if(o[e].visible&&o[e].active){let t=o[e].geometryIndex;this.getMatrixAt(e,oU),this.getBoundingSphereAt(t,oQ).applyMatrix4(oU);let i=!1;if(h&&(i=!p.intersectsSphere(oQ,r)),!i){let r=c[t],i=oj.subVectors(oQ.center,oV).dot(oW);oY.push(r.start,r.count,i,e)}}let e=oY.list,t=this.customSort;null===t?e.sort(n.transparent?oF:ok):t.call(this,e,r);for(let t=0,r=e.length;t<r;t++){let r=e[t];l[m]=r.start*s,u[m]=r.count,f[m]=r.index,m++}oY.reset()}else for(let e=0,t=o.length;e<t;e++)if(o[e].visible&&o[e].active){let t=o[e].geometryIndex,i=!1;if(h&&(this.getMatrixAt(e,oU),this.getBoundingSphereAt(t,oQ).applyMatrix4(oU),i=!p.intersectsSphere(oQ,r)),!i){let r=c[t];l[m]=r.start*s,u[m]=r.count,f[m]=e,m++}}d.needsUpdate=!0,this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(e,t,r,i,n,a){this.onBeforeRender(e,null,i,n,a)}}class oJ extends aj{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new aQ(0xffffff),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}let oZ=new ni,o0=new ni,o1=new n8,o2=new n6,o3=new nJ,o4=new ni,o5=new ni;class o6 extends aS{constructor(e=new sl,t=new oJ){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,r=[0];for(let e=1,i=t.count;e<i;e++)oZ.fromBufferAttribute(t,e-1),o0.fromBufferAttribute(t,e),r[e]=r[e-1],r[e]+=oZ.distanceTo(o0);e.setAttribute("lineDistance",new se(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let r=this.geometry,i=this.matrixWorld,n=e.params.Line.threshold,a=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),o3.copy(r.boundingSphere),o3.applyMatrix4(i),o3.radius+=n,!1===e.ray.intersectsSphere(o3))return;o1.copy(i).invert(),o2.copy(e.ray).applyMatrix4(o1);let s=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=this.isLineSegments?2:1,u=r.index,c=r.attributes.position;if(null!==u){let r=Math.max(0,a.start),i=Math.min(u.count,a.start+a.count);for(let n=r,a=i-1;n<a;n+=l){let r=o8(this,e,o2,o,u.getX(n),u.getX(n+1),n);r&&t.push(r)}if(this.isLineLoop){let n=o8(this,e,o2,o,u.getX(i-1),u.getX(r),i-1);n&&t.push(n)}}else{let r=Math.max(0,a.start),i=Math.min(c.count,a.start+a.count);for(let n=r,a=i-1;n<a;n+=l){let r=o8(this,e,o2,o,n,n+1,n);r&&t.push(r)}if(this.isLineLoop){let n=o8(this,e,o2,o,i-1,r,i-1);n&&t.push(n)}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){let t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function o8(e,t,r,i,n,a,s){let o=e.geometry.attributes.position;if(oZ.fromBufferAttribute(o,n),o0.fromBufferAttribute(o,a),r.distanceSqToSegment(oZ,o0,o4,o5)>i)return;o4.applyMatrix4(e.matrixWorld);let l=t.ray.origin.distanceTo(o4);if(!(l<t.near)&&!(l>t.far))return{distance:l,point:o5.clone().applyMatrix4(e.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:e}}let o9=new ni,o7=new ni;class le extends o6{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,r=[];for(let e=0,i=t.count;e<i;e+=2)o9.fromBufferAttribute(t,e),o7.fromBufferAttribute(t,e+1),r[e]=0===e?0:r[e-1],r[e+1]=r[e]+o9.distanceTo(o7);e.setAttribute("lineDistance",new se(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class lt extends o6{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class lr extends aj{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new aQ(0xffffff),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let li=new n8,ln=new n6,la=new nJ,ls=new ni;class lo extends aS{constructor(e=new sl,t=new lr){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){let r=this.geometry,i=this.matrixWorld,n=e.params.Points.threshold,a=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),la.copy(r.boundingSphere),la.applyMatrix4(i),la.radius+=n,!1===e.ray.intersectsSphere(la))return;li.copy(i).invert(),ln.copy(e.ray).applyMatrix4(li);let s=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=r.index,u=r.attributes.position;if(null!==l){let r=Math.max(0,a.start),n=Math.min(l.count,a.start+a.count);for(let a=r;a<n;a++){let r=l.getX(a);ls.fromBufferAttribute(u,r),ll(ls,r,o,i,e,t,this)}}else{let r=Math.max(0,a.start),n=Math.min(u.count,a.start+a.count);for(let a=r;a<n;a++)ls.fromBufferAttribute(u,a),ll(ls,a,o,i,e,t,this)}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){let t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function ll(e,t,r,i,n,a,s){let o=ln.distanceSqToPoint(e);if(o<r){let r=new ni;ln.closestPointToPoint(e,r),r.applyMatrix4(i);let l=n.ray.origin.distanceTo(r);if(l<n.near||l>n.far)return;a.push({distance:l,distanceToRay:Math.sqrt(o),point:r,index:t,face:null,faceIndex:null,barycoord:null,object:s})}}class lu extends nC{constructor(e,t,r,i,n=tZ,a=tZ,s,o,l){super(e,t,r,i,n,a,s,o,l),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;let u=this;"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(function t(){u.needsUpdate=!0,u._requestVideoFrameCallbackId=e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){0!==this._requestVideoFrameCallbackId&&this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),super.dispose()}}class lc extends lu{constructor(e,t,r,i,n,a,s,o){super({},e,t,r,i,n,a,s,o),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class lh extends nC{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=tK,this.minFilter=tK,this.generateMipmaps=!1,this.needsUpdate=!0}}class ld extends nC{constructor(e,t,r,i,n,a,s,o,l,u,c,h){super(null,a,s,o,l,u,i,n,c,h),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class lf extends ld{constructor(e,t,r,i,n,a){super(e,t,r,n,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=tj,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class lp extends ld{constructor(e,t,r){super(void 0,e[0].width,e[0].height,t,r,tz),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class lm extends nC{constructor(e,t,r,i,n,a,s,o,l){super(e,t,r,i,n,a,s,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class lg extends nC{constructor(e,t,r=t7,i,n,a,s=tK,o=tK,l,u=rc,c=1){if(u!==rc&&u!==rh)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:e,height:t,depth:c},i,n,a,s,o,u,r,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new n_(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){let t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class lA extends nC{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class lv extends sl{constructor(e=1,t=1,r=4,i=8,n=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:r,radialSegments:i,heightSegments:n},t=Math.max(0,t),r=Math.max(1,Math.floor(r)),i=Math.max(3,Math.floor(i));let a=[],s=[],o=[],l=[],u=t/2,c=Math.PI/2*e,h=t,d=2*c+h,f=2*r+(n=Math.max(1,Math.floor(n))),p=i+1,m=new ni,g=new ni;for(let A=0;A<=f;A++){let v=0,y=0,E=0,x=0;if(A<=r){let t=A/r,i=t*Math.PI/2;y=-u-e*Math.cos(i),E=e*Math.sin(i),x=-e*Math.cos(i),v=t*c}else if(A<=r+n){let i=(A-r)/n;y=-u+i*t,E=e,x=0,v=c+i*h}else{let t=(A-r-n)/r,i=t*Math.PI/2;y=u+e*Math.sin(i),E=e*Math.cos(i),x=e*Math.sin(i),v=c+h+t*c}let _=Math.max(0,Math.min(1,v/d)),b=0;0===A?b=.5/i:A===f&&(b=-.5/i);for(let e=0;e<=i;e++){let t=e/i,r=t*Math.PI*2,n=Math.sin(r),a=Math.cos(r);g.x=-E*a,g.y=y,g.z=E*n,s.push(g.x,g.y,g.z),m.set(-E*a,x,E*n),m.normalize(),o.push(m.x,m.y,m.z),l.push(t+b,_)}if(A>0){let e=(A-1)*p;for(let t=0;t<i;t++){let r=e+t,i=e+t+1,n=A*p+t,s=A*p+t+1;a.push(r,i,n),a.push(i,s,n)}}}this.setIndex(a),this.setAttribute("position",new se(s,3)),this.setAttribute("normal",new se(o,3)),this.setAttribute("uv",new se(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lv(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class ly extends sl{constructor(e=1,t=32,r=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},t=Math.max(3,t);let n=[],a=[],s=[],o=[],l=new ni,u=new nt;a.push(0,0,0),s.push(0,0,1),o.push(.5,.5);for(let n=0,c=3;n<=t;n++,c+=3){let h=r+n/t*i;l.x=e*Math.cos(h),l.y=e*Math.sin(h),a.push(l.x,l.y,l.z),s.push(0,0,1),u.x=(a[c]/e+1)/2,u.y=(a[c+1]/e+1)/2,o.push(u.x,u.y)}for(let e=1;e<=t;e++)n.push(e,e+1,0);this.setIndex(n),this.setAttribute("position",new se(a,3)),this.setAttribute("normal",new se(s,3)),this.setAttribute("uv",new se(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ly(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class lE extends sl{constructor(e=1,t=1,r=1,i=32,n=1,a=!1,s=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:a,thetaStart:s,thetaLength:o};let l=this;i=Math.floor(i),n=Math.floor(n);let u=[],c=[],h=[],d=[],f=0,p=[],m=r/2,g=0;function A(r){let n=f,a=new nt,p=new ni,A=0,v=!0===r?e:t,y=!0===r?1:-1;for(let e=1;e<=i;e++)c.push(0,m*y,0),h.push(0,y,0),d.push(.5,.5),f++;let E=f;for(let e=0;e<=i;e++){let t=e/i*o+s,r=Math.cos(t),n=Math.sin(t);p.x=v*n,p.y=m*y,p.z=v*r,c.push(p.x,p.y,p.z),h.push(0,y,0),a.x=.5*r+.5,a.y=.5*n*y+.5,d.push(a.x,a.y),f++}for(let e=0;e<i;e++){let t=n+e,i=E+e;!0===r?u.push(i,i+1,t):u.push(i+1,i,t),A+=3}l.addGroup(g,A,!0===r?1:2),g+=A}(function(){let a=new ni,A=new ni,v=0,y=(t-e)/r;for(let l=0;l<=n;l++){let u=[],g=l/n,v=g*(t-e)+e;for(let e=0;e<=i;e++){let t=e/i,n=t*o+s,l=Math.sin(n),p=Math.cos(n);A.x=v*l,A.y=-g*r+m,A.z=v*p,c.push(A.x,A.y,A.z),a.set(l,y,p).normalize(),h.push(a.x,a.y,a.z),d.push(t,1-g),u.push(f++)}p.push(u)}for(let r=0;r<i;r++)for(let i=0;i<n;i++){let a=p[i][r],s=p[i+1][r],o=p[i+1][r+1],l=p[i][r+1];(e>0||0!==i)&&(u.push(a,s,l),v+=3),(t>0||i!==n-1)&&(u.push(s,o,l),v+=3)}l.addGroup(g,v,0),g+=v})(),!1===a&&(e>0&&A(!0),t>0&&A(!1)),this.setIndex(u),this.setAttribute("position",new se(c,3)),this.setAttribute("normal",new se(h,3)),this.setAttribute("uv",new se(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lE(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class lx extends lE{constructor(e=1,t=1,r=32,i=1,n=!1,a=0,s=2*Math.PI){super(0,e,t,r,i,n,a,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:s}}static fromJSON(e){return new lx(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class l_ extends sl{constructor(e=[],t=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i};let n=[],a=[];function s(e){n.push(e.x,e.y,e.z)}function o(t,r){let i=3*t;r.x=e[i+0],r.y=e[i+1],r.z=e[i+2]}function l(e,t,r,i){i<0&&1===e.x&&(a[t]=e.x-1),0===r.x&&0===r.z&&(a[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}(function(e){let r=new ni,i=new ni,n=new ni;for(let a=0;a<t.length;a+=3)o(t[a+0],r),o(t[a+1],i),o(t[a+2],n),function(e,t,r,i){let n=i+1,a=[];for(let i=0;i<=n;i++){a[i]=[];let s=e.clone().lerp(r,i/n),o=t.clone().lerp(r,i/n),l=n-i;for(let e=0;e<=l;e++)0===e&&i===n?a[i][e]=s:a[i][e]=s.clone().lerp(o,e/l)}for(let e=0;e<n;e++)for(let t=0;t<2*(n-e)-1;t++){let r=Math.floor(t/2);t%2==0?(s(a[e][r+1]),s(a[e+1][r]),s(a[e][r])):(s(a[e][r+1]),s(a[e+1][r+1]),s(a[e+1][r]))}}(r,i,n,e)})(i),function(e){let t=new ni;for(let r=0;r<n.length;r+=3)t.x=n[r+0],t.y=n[r+1],t.z=n[r+2],t.normalize().multiplyScalar(e),n[r+0]=t.x,n[r+1]=t.y,n[r+2]=t.z}(r),function(){let e=new ni;for(let t=0;t<n.length;t+=3){e.x=n[t+0],e.y=n[t+1],e.z=n[t+2];let r=u(e)/2/Math.PI+.5,i=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5;a.push(r,1-i)}(function(){let e=new ni,t=new ni,r=new ni,i=new ni,s=new nt,o=new nt,c=new nt;for(let h=0,d=0;h<n.length;h+=9,d+=6){e.set(n[h+0],n[h+1],n[h+2]),t.set(n[h+3],n[h+4],n[h+5]),r.set(n[h+6],n[h+7],n[h+8]),s.set(a[d+0],a[d+1]),o.set(a[d+2],a[d+3]),c.set(a[d+4],a[d+5]),i.copy(e).add(t).add(r).divideScalar(3);let f=u(i);l(s,d+0,e,f),l(o,d+2,t,f),l(c,d+4,r,f)}})(),function(){for(let e=0;e<a.length;e+=6){let t=a[e+0],r=a[e+2],i=a[e+4],n=Math.max(t,r,i),s=Math.min(t,r,i);n>.9&&s<.1&&(t<.2&&(a[e+0]+=1),r<.2&&(a[e+2]+=1),i<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new se(n,3)),this.setAttribute("normal",new se(n.slice(),3)),this.setAttribute("uv",new se(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new l_(e.vertices,e.indices,e.radius,e.details)}}class lb extends l_{constructor(e=1,t=0){let r=(1+Math.sqrt(5))/2,i=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new lb(e.radius,e.detail)}}let lS=new ni,lw=new ni,lC=new ni,lT=new aU;class lI extends sl{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){let r=Math.cos(i2*t),i=e.getIndex(),n=e.getAttribute("position"),a=i?i.count:n.count,s=[0,0,0],o=["a","b","c"],l=[,,,],u={},c=[];for(let e=0;e<a;e+=3){i?(s[0]=i.getX(e),s[1]=i.getX(e+1),s[2]=i.getX(e+2)):(s[0]=e,s[1]=e+1,s[2]=e+2);let{a:t,b:a,c:h}=lT;if(t.fromBufferAttribute(n,s[0]),a.fromBufferAttribute(n,s[1]),h.fromBufferAttribute(n,s[2]),lT.getNormal(lC),l[0]=`${Math.round(1e4*t.x)},${Math.round(1e4*t.y)},${Math.round(1e4*t.z)}`,l[1]=`${Math.round(1e4*a.x)},${Math.round(1e4*a.y)},${Math.round(1e4*a.z)}`,l[2]=`${Math.round(1e4*h.x)},${Math.round(1e4*h.y)},${Math.round(1e4*h.z)}`,l[0]!==l[1]&&l[1]!==l[2]&&l[2]!==l[0])for(let e=0;e<3;e++){let t=(e+1)%3,i=l[e],n=l[t],a=lT[o[e]],h=lT[o[t]],d=`${i}_${n}`,f=`${n}_${i}`;f in u&&u[f]?(lC.dot(u[f].normal)<=r&&(c.push(a.x,a.y,a.z),c.push(h.x,h.y,h.z)),u[f]=null):d in u||(u[d]={index0:s[e],index1:s[t],normal:lC.clone()})}}for(let e in u)if(u[e]){let{index0:t,index1:r}=u[e];lS.fromBufferAttribute(n,t),lw.fromBufferAttribute(n,r),c.push(lS.x,lS.y,lS.z),c.push(lw.x,lw.y,lw.z)}this.setAttribute("position",new se(c,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class lM{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){let r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){let t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){let t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],r,i=this.getPoint(0),n=0;t.push(0);for(let a=1;a<=e;a++)t.push(n+=(r=this.getPoint(a/e)).distanceTo(i)),i=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){let r;let i=this.getLengths(),n=0,a=i.length;r=t||e*i[a-1];let s=0,o=a-1,l;for(;s<=o;)if((l=i[n=Math.floor(s+(o-s)/2)]-r)<0)s=n+1;else if(l>0)o=n-1;else{o=n;break}if(i[n=o]===r)return n/(a-1);let u=i[n],c=i[n+1];return(n+(r-u)/(c-u))/(a-1)}getTangent(e,t){let r=e-1e-4,i=e+1e-4;r<0&&(r=0),i>1&&(i=1);let n=this.getPoint(r),a=this.getPoint(i),s=t||(n.isVector2?new nt:new ni);return s.copy(a).sub(n).normalize(),s}getTangentAt(e,t){let r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t=!1){let r=new ni,i=[],n=[],a=[],s=new ni,o=new n8;for(let t=0;t<=e;t++){let r=t/e;i[t]=this.getTangentAt(r,new ni)}n[0]=new ni,a[0]=new ni;let l=Number.MAX_VALUE,u=Math.abs(i[0].x),c=Math.abs(i[0].y),h=Math.abs(i[0].z);u<=l&&(l=u,r.set(1,0,0)),c<=l&&(l=c,r.set(0,1,0)),h<=l&&r.set(0,0,1),s.crossVectors(i[0],r).normalize(),n[0].crossVectors(i[0],s),a[0].crossVectors(i[0],n[0]);for(let t=1;t<=e;t++){if(n[t]=n[t-1].clone(),a[t]=a[t-1].clone(),s.crossVectors(i[t-1],i[t]),s.length()>Number.EPSILON){s.normalize();let e=Math.acos(i5(i[t-1].dot(i[t]),-1,1));n[t].applyMatrix4(o.makeRotationAxis(s,e))}a[t].crossVectors(i[t],n[t])}if(!0===t){let t=Math.acos(i5(n[0].dot(n[e]),-1,1));t/=e,i[0].dot(s.crossVectors(n[0],n[e]))>0&&(t=-t);for(let r=1;r<=e;r++)n[r].applyMatrix4(o.makeRotationAxis(i[r],t*r)),a[r].crossVectors(i[r],n[r])}return{tangents:i,normals:n,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class lR extends lM{constructor(e=0,t=0,r=1,i=1,n=0,a=2*Math.PI,s=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=a,this.aClockwise=s,this.aRotation=o}getPoint(e,t=new nt){let r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,n=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=n?0:r),!0!==this.aClockwise||n||(i===r?i=-r:i-=r);let a=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(a),o=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){let e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),r=s-this.aX,i=o-this.aY;s=r*e-i*t+this.aX,o=r*t+i*e+this.aY}return t.set(s,o)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class lB extends lR{constructor(e,t,r,i,n,a){super(e,t,r,r,i,n,a),this.isArcCurve=!0,this.type="ArcCurve"}}function lD(){let e=0,t=0,r=0,i=0;function n(n,a,s,o){e=n,t=s,r=-3*n+3*a-2*s-o,i=2*n-2*a+s+o}return{initCatmullRom:function(e,t,r,i,a){n(t,r,a*(r-e),a*(i-t))},initNonuniformCatmullRom:function(e,t,r,i,a,s,o){let l=(t-e)/a-(r-e)/(a+s)+(r-t)/s,u=(r-t)/s-(i-t)/(s+o)+(i-r)/o;n(t,r,l*=s,u*=s)},calc:function(n){let a=n*n;return e+t*n+r*a+a*n*i}}}let lP=new ni,lL=new lD,lk=new lD,lF=new lD;class lO extends lM{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,t=new ni){let r,i;let n=this.points,a=n.length,s=(a-(this.closed?0:1))*e,o=Math.floor(s),l=s-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/a)+1)*a:0===l&&o===a-1&&(o=a-2,l=1),this.closed||o>0?r=n[(o-1)%a]:(lP.subVectors(n[0],n[1]).add(n[0]),r=lP);let u=n[o%a],c=n[(o+1)%a];if(this.closed||o+2<a?i=n[(o+2)%a]:(lP.subVectors(n[a-1],n[a-2]).add(n[a-1]),i=lP),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,t=Math.pow(r.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(c),e),a=Math.pow(c.distanceToSquared(i),e);n<1e-4&&(n=1),t<1e-4&&(t=n),a<1e-4&&(a=n),lL.initNonuniformCatmullRom(r.x,u.x,c.x,i.x,t,n,a),lk.initNonuniformCatmullRom(r.y,u.y,c.y,i.y,t,n,a),lF.initNonuniformCatmullRom(r.z,u.z,c.z,i.z,t,n,a)}else"catmullrom"===this.curveType&&(lL.initCatmullRom(r.x,u.x,c.x,i.x,this.tension),lk.initCatmullRom(r.y,u.y,c.y,i.y,this.tension),lF.initCatmullRom(r.z,u.z,c.z,i.z,this.tension));return t.set(lL.calc(l),lk.calc(l),lF.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let r=e.points[t];this.points.push(new ni().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function lU(e,t,r,i,n){let a=(i-t)*.5,s=(n-r)*.5,o=e*e;return e*o*(2*r-2*i+a+s)+(-3*r+3*i-2*a-s)*o+a*e+r}function lN(e,t,r,i){return function(e,t){let r=1-e;return r*r*t}(e,t)+2*(1-e)*e*r+e*e*i}function lz(e,t,r,i,n){return function(e,t){let r=1-e;return r*r*r*t}(e,t)+function(e,t){let r=1-e;return 3*r*r*e*t}(e,r)+3*(1-e)*e*e*i+e*e*e*n}class lG extends lM{constructor(e=new nt,t=new nt,r=new nt,i=new nt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new nt){let r=this.v0,i=this.v1,n=this.v2,a=this.v3;return t.set(lz(e,r.x,i.x,n.x,a.x),lz(e,r.y,i.y,n.y,a.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class lH extends lM{constructor(e=new ni,t=new ni,r=new ni,i=new ni){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new ni){let r=this.v0,i=this.v1,n=this.v2,a=this.v3;return t.set(lz(e,r.x,i.x,n.x,a.x),lz(e,r.y,i.y,n.y,a.y),lz(e,r.z,i.z,n.z,a.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class lQ extends lM{constructor(e=new nt,t=new nt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new nt){return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new nt){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class lV extends lM{constructor(e=new ni,t=new ni){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new ni){return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ni){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class lW extends lM{constructor(e=new nt,t=new nt,r=new nt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new nt){let r=this.v0,i=this.v1,n=this.v2;return t.set(lN(e,r.x,i.x,n.x),lN(e,r.y,i.y,n.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class lj extends lM{constructor(e=new ni,t=new ni,r=new ni){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new ni){let r=this.v0,i=this.v1,n=this.v2;return t.set(lN(e,r.x,i.x,n.x),lN(e,r.y,i.y,n.y),lN(e,r.z,i.z,n.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class lY extends lM{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new nt){let r=this.points,i=(r.length-1)*e,n=Math.floor(i),a=i-n,s=r[0===n?n:n-1],o=r[n],l=r[n>r.length-2?r.length-1:n+1],u=r[n>r.length-3?r.length-1:n+2];return t.set(lU(a,s.x,o.x,l.x,u.x),lU(a,s.y,o.y,l.y,u.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let r=e.points[t];this.points.push(new nt().fromArray(r))}return this}}var lK=Object.freeze({__proto__:null,ArcCurve:lB,CatmullRomCurve3:lO,CubicBezierCurve:lG,CubicBezierCurve3:lH,EllipseCurve:lR,LineCurve:lQ,LineCurve3:lV,QuadraticBezierCurve:lW,QuadraticBezierCurve3:lj,SplineCurve:lY});class lq extends lM{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){let r=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new lK[r](t,e))}return this}getPoint(e,t){let r=e*this.getLength(),i=this.getCurveLengths(),n=0;for(;n<i.length;){if(i[n]>=r){let e=i[n]-r,a=this.curves[n],s=a.getLength(),o=0===s?0:1-e/s;return a.getPointAt(o,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let r=0,i=this.curves.length;r<i;r++)e.push(t+=this.curves[r].getLength());return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t;let r=[];for(let i=0,n=this.curves;i<n.length;i++){let a=n[i],s=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,o=a.getPoints(s);for(let e=0;e<o.length;e++){let i=o[e];t&&t.equals(i)||(r.push(i),t=i)}}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){let r=e.curves[t];this.curves.push(new lK[r.type]().fromJSON(r))}return this}}class lX extends lq{constructor(e){super(),this.type="Path",this.currentPoint=new nt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let r=new lQ(this.currentPoint.clone(),new nt(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){let n=new lW(this.currentPoint.clone(),new nt(e,t),new nt(r,i));return this.curves.push(n),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,n,a){let s=new lG(this.currentPoint.clone(),new nt(e,t),new nt(r,i),new nt(n,a));return this.curves.push(s),this.currentPoint.set(n,a),this}splineThru(e){let t=new lY([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,n,a){let s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+s,t+o,r,i,n,a),this}absarc(e,t,r,i,n,a){return this.absellipse(e,t,r,r,i,n,a),this}ellipse(e,t,r,i,n,a,s,o){let l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,r,i,n,a,s,o),this}absellipse(e,t,r,i,n,a,s,o){let l=new lR(e,t,r,i,n,a,s,o);if(this.curves.length>0){let e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);let u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class l$ extends lX{constructor(e){super(e),this.uuid=i4(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){let r=e.holes[t];this.holes.push(new lX().fromJSON(r))}return this}}function lJ(e,t,r,i,n){let a;if(n===function(e,t,r,i){let n=0;for(let a=t,s=r-i;a<r;a+=i)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}(e,t,r,i)>0)for(let n=t;n<r;n+=i)a=ut(n/i|0,e[n],e[n+1],a);else for(let n=r-i;n>=t;n-=i)a=ut(n/i|0,e[n],e[n+1],a);return a&&l5(a,a.next)&&(ur(a),a=a.next),a}function lZ(e,t){if(!e)return e;t||(t=e);let r=e,i;do if(i=!1,!r.steiner&&(l5(r,r.next)||0===l4(r.prev,r,r.next))){if(ur(r),(r=t=r.prev)===r.next)break;i=!0}else r=r.next;while(i||r!==t);return t}function l0(e,t){let r=e.x-t.x;return 0===r&&0==(r=e.y-t.y)&&(r=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function l1(e,t,r,i,n){return(e=((e=((e=((e=((e=(e-r)*n|0)|e<<8)&0xff00ff)|e<<4)&0xf0f0f0f)|e<<2)&0x33333333)|e<<1)&0x55555555)|(t=((t=((t=((t=((t=(t-i)*n|0)|t<<8)&0xff00ff)|t<<4)&0xf0f0f0f)|t<<2)&0x33333333)|t<<1)&0x55555555)<<1}function l2(e,t,r,i,n,a,s,o){return(n-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(i-o)>=(r-s)*(t-o)&&(r-s)*(a-o)>=(n-s)*(i-o)}function l3(e,t,r,i,n,a,s,o){return!(e===s&&t===o)&&l2(e,t,r,i,n,a,s,o)}function l4(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function l5(e,t){return e.x===t.x&&e.y===t.y}function l6(e,t,r,i){let n=l9(l4(e,t,r)),a=l9(l4(e,t,i)),s=l9(l4(r,i,e)),o=l9(l4(r,i,t));return!!(n!==a&&s!==o||0===n&&l8(e,r,t)||0===a&&l8(e,i,t)||0===s&&l8(r,e,i)||0===o&&l8(r,t,i))}function l8(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function l9(e){return e>0?1:e<0?-1:0}function l7(e,t){return 0>l4(e.prev,e,e.next)?l4(e,t,e.next)>=0&&l4(e,e.prev,t)>=0:0>l4(e,t,e.prev)||0>l4(e,e.next,t)}function ue(e,t){let r=ui(e.i,e.x,e.y),i=ui(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function ut(e,t,r,i){let n=ui(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function ur(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ui(e,t,r){return{i:e,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class un{static triangulate(e,t,r=2){return function(e,t,r=2){let i,n,a;let s=t&&t.length,o=s?t[0]*r:e.length,l=lJ(e,0,o,r,!0),u=[];if(!l||l.next===l.prev)return u;if(s&&(l=function(e,t,r,i){let n=[];for(let r=0,a=t.length;r<a;r++){let s=t[r]*i,o=r<a-1?t[r+1]*i:e.length,l=lJ(e,s,o,i,!1);l===l.next&&(l.steiner=!0),n.push(function(e){let t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}(l))}n.sort(l0);for(let e=0;e<n.length;e++)r=function(e,t){let r=function(e,t){let r,i=t,n=e.x,a=e.y,s=-1/0;if(l5(e,i))return i;do{if(l5(e,i.next))return i.next;if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let e=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>s&&(s=e,r=i.x<i.next.x?i:i.next,e===n))return r}i=i.next}while(i!==t);if(!r)return null;let o=r,l=r.x,u=r.y,c=1/0;i=r;do{if(n>=i.x&&i.x>=l&&n!==i.x&&l2(a<u?n:s,a,l,u,a<u?s:n,a,i.x,i.y)){var h,d;let t=Math.abs(a-i.y)/(n-i.x);l7(i,e)&&(t<c||t===c&&(i.x>r.x||i.x===r.x&&(h=r,d=i,0>l4(h.prev,h,d.prev)&&0>l4(d.next,h,h.next))))&&(r=i,c=t)}i=i.next}while(i!==o);return r}(e,t);if(!r)return t;let i=ue(r,e);return lZ(i,i.next),lZ(r,r.next)}(n[e],r);return r}(e,t,l,r)),e.length>80*r){i=1/0,n=1/0;let t=-1/0,s=-1/0;for(let a=r;a<o;a+=r){let r=e[a],o=e[a+1];r<i&&(i=r),o<n&&(n=o),r>t&&(t=r),o>s&&(s=o)}a=0!==(a=Math.max(t-i,s-n))?32767/a:0}return function e(t,r,i,n,a,s,o){if(!t)return;!o&&s&&function(e,t,r,i){let n=e;do 0===n.z&&(n.z=l1(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){let t;let r=1;do{let i,n=e;e=null;let a=null;for(t=0;n;){t++;let s=n,o=0;for(let e=0;e<r&&(o++,s=s.nextZ);e++);let l=r;for(;o>0||l>0&&s;)0!==o&&(0===l||!s||n.z<=s.z)?(i=n,n=n.nextZ,o--):(i=s,s=s.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=s}a.nextZ=null,r*=2}while(t>1)}(n)}(t,n,a,s);let l=t;for(;t.prev!==t.next;){let u=t.prev,c=t.next;if(s?function(e,t,r,i){let n=e.prev,a=e.next;if(l4(n,e,a)>=0)return!1;let s=n.x,o=e.x,l=a.x,u=n.y,c=e.y,h=a.y,d=Math.min(s,o,l),f=Math.min(u,c,h),p=Math.max(s,o,l),m=Math.max(u,c,h),g=l1(d,f,t,r,i),A=l1(p,m,t,r,i),v=e.prevZ,y=e.nextZ;for(;v&&v.z>=g&&y&&y.z<=A;){if(v.x>=d&&v.x<=p&&v.y>=f&&v.y<=m&&v!==n&&v!==a&&l3(s,u,o,c,l,h,v.x,v.y)&&l4(v.prev,v,v.next)>=0||(v=v.prevZ,y.x>=d&&y.x<=p&&y.y>=f&&y.y<=m&&y!==n&&y!==a&&l3(s,u,o,c,l,h,y.x,y.y)&&l4(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;v&&v.z>=g;){if(v.x>=d&&v.x<=p&&v.y>=f&&v.y<=m&&v!==n&&v!==a&&l3(s,u,o,c,l,h,v.x,v.y)&&l4(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;y&&y.z<=A;){if(y.x>=d&&y.x<=p&&y.y>=f&&y.y<=m&&y!==n&&y!==a&&l3(s,u,o,c,l,h,y.x,y.y)&&l4(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}(t,n,a,s):function(e){let t=e.prev,r=e.next;if(l4(t,e,r)>=0)return!1;let i=t.x,n=e.x,a=r.x,s=t.y,o=e.y,l=r.y,u=Math.min(i,n,a),c=Math.min(s,o,l),h=Math.max(i,n,a),d=Math.max(s,o,l),f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=h&&f.y>=c&&f.y<=d&&l3(i,s,n,o,a,l,f.x,f.y)&&l4(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}(t)){r.push(u.i,t.i,c.i),ur(t),t=c.next,l=c.next;continue}if((t=c)===l){o?1===o?e(t=function(e,t){let r=e;do{let i=r.prev,n=r.next.next;!l5(i,n)&&l6(i,r,r.next,n)&&l7(i,n)&&l7(n,i)&&(t.push(i.i,r.i,n.i),ur(r),ur(r.next),r=e=n),r=r.next}while(r!==e);return lZ(r)}(lZ(t),r),r,i,n,a,s,2):2===o&&function(t,r,i,n,a,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){var l,u;if(o.i!==t.i&&(l=o,u=t,l.next.i!==u.i&&l.prev.i!==u.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&l6(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(l,u)&&(l7(l,u)&&l7(u,l)&&function(e,t){let r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==e);return i}(l,u)&&(l4(l.prev,l,u.prev)||l4(l,u.prev,u))||l5(l,u)&&l4(l.prev,l,l.next)>0&&l4(u.prev,u,u.next)>0))){let l=ue(o,t);o=lZ(o,o.next),l=lZ(l,l.next),e(o,r,i,n,a,s,0),e(l,r,i,n,a,s,0);return}t=t.next}o=o.next}while(o!==t)}(t,r,i,n,a,s):e(lZ(t),r,i,n,a,s,1);break}}}(l,u,r,i,n,a,0),u}(e,t,r)}}class ua{static area(e){let t=e.length,r=0;for(let i=t-1,n=0;n<t;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return .5*r}static isClockWise(e){return 0>ua.area(e)}static triangulateShape(e,t){let r=[],i=[],n=[];us(e),uo(r,e);let a=e.length;t.forEach(us);for(let e=0;e<t.length;e++)i.push(a),a+=t[e].length,uo(r,t[e]);let s=un.triangulate(r,i);for(let e=0;e<s.length;e+=3)n.push(s.slice(e,e+3));return n}}function us(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function uo(e,t){for(let r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}class ul extends sl{constructor(e=new l$([new nt(.5,.5),new nt(-.5,.5),new nt(-.5,-.5),new nt(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let r=this,i=[],n=[];for(let a=0,s=e.length;a<s;a++)(function(e){let a,s,o,l,u;let c=[],h=void 0!==t.curveSegments?t.curveSegments:12,d=void 0!==t.steps?t.steps:1,f=void 0!==t.depth?t.depth:1,p=void 0===t.bevelEnabled||t.bevelEnabled,m=void 0!==t.bevelThickness?t.bevelThickness:.2,g=void 0!==t.bevelSize?t.bevelSize:m-.1,A=void 0!==t.bevelOffset?t.bevelOffset:0,v=void 0!==t.bevelSegments?t.bevelSegments:3,y=t.extrudePath,E=void 0!==t.UVGenerator?t.UVGenerator:uu,x,_=!1;y&&(x=y.getSpacedPoints(d),_=!0,p=!1,a=y.computeFrenetFrames(d,!1),s=new ni,o=new ni,l=new ni),p||(v=0,m=0,g=0,A=0);let b=e.extractPoints(h),S=b.shape,w=b.holes;if(!ua.isClockWise(S)){S=S.reverse();for(let e=0,t=w.length;e<t;e++){let t=w[e];ua.isClockWise(t)&&(w[e]=t.reverse())}}function C(e){let t=1e-10*1e-10,r=e[0];for(let i=1;i<=e.length;i++){let n=i%e.length,a=e[n],s=a.x-r.x,o=a.y-r.y,l=s*s+o*o,u=Math.max(Math.abs(a.x),Math.abs(a.y),Math.abs(r.x),Math.abs(r.y));if(l<=t*u*u){e.splice(n,1),i--;continue}r=a}}C(S),w.forEach(C);let T=w.length,I=S;for(let e=0;e<T;e++){let t=w[e];S=S.concat(t)}function M(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,r)}let R=S.length;function B(e,t,r){let i,n,a;let s=e.x-t.x,o=e.y-t.y,l=r.x-e.x,u=r.y-e.y,c=s*s+o*o;if(Math.abs(s*u-o*l)>Number.EPSILON){let h=Math.sqrt(c),d=Math.sqrt(l*l+u*u),f=t.x-o/h,p=t.y+s/h,m=((r.x-u/d-f)*u-(r.y+l/d-p)*l)/(s*u-o*l),g=(i=f+s*m-e.x)*i+(n=p+o*m-e.y)*n;if(g<=2)return new nt(i,n);a=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(u)&&(e=!0),e?(i=-o,n=s,a=Math.sqrt(c)):(i=s,n=o,a=Math.sqrt(c/2))}return new nt(i/a,n/a)}let D=[];for(let e=0,t=I.length,r=t-1,i=e+1;e<t;e++,r++,i++)r===t&&(r=0),i===t&&(i=0),D[e]=B(I[e],I[r],I[i]);let P=[],L,k=D.concat();for(let e=0;e<T;e++){let t=w[e];L=[];for(let e=0,r=t.length,i=r-1,n=e+1;e<r;e++,i++,n++)i===r&&(i=0),n===r&&(n=0),L[e]=B(t[e],t[i],t[n]);P.push(L),k=k.concat(L)}if(0===v)u=ua.triangulateShape(I,w);else{let e=[],t=[];for(let r=0;r<v;r++){let i=r/v,n=m*Math.cos(i*Math.PI/2),a=g*Math.sin(i*Math.PI/2)+A;for(let t=0,r=I.length;t<r;t++){let r=M(I[t],D[t],a);N(r.x,r.y,-n),0===i&&e.push(r)}for(let e=0;e<T;e++){let r=w[e];L=P[e];let s=[];for(let e=0,t=r.length;e<t;e++){let t=M(r[e],L[e],a);N(t.x,t.y,-n),0===i&&s.push(t)}0===i&&t.push(s)}}u=ua.triangulateShape(e,t)}let F=u.length,O=g+A;for(let e=0;e<R;e++){let t=p?M(S[e],k[e],O):S[e];_?(o.copy(a.normals[0]).multiplyScalar(t.x),s.copy(a.binormals[0]).multiplyScalar(t.y),l.copy(x[0]).add(o).add(s),N(l.x,l.y,l.z)):N(t.x,t.y,0)}for(let e=1;e<=d;e++)for(let t=0;t<R;t++){let r=p?M(S[t],k[t],O):S[t];_?(o.copy(a.normals[e]).multiplyScalar(r.x),s.copy(a.binormals[e]).multiplyScalar(r.y),l.copy(x[e]).add(o).add(s),N(l.x,l.y,l.z)):N(r.x,r.y,f/d*e)}for(let e=v-1;e>=0;e--){let t=e/v,r=m*Math.cos(t*Math.PI/2),i=g*Math.sin(t*Math.PI/2)+A;for(let e=0,t=I.length;e<t;e++){let t=M(I[e],D[e],i);N(t.x,t.y,f+r)}for(let e=0,t=w.length;e<t;e++){let t=w[e];L=P[e];for(let e=0,n=t.length;e<n;e++){let n=M(t[e],L[e],i);_?N(n.x,n.y+x[d-1].y,x[d-1].x+r):N(n.x,n.y,f+r)}}}function U(e,t){let n=e.length;for(;--n>=0;){let a=n,s=n-1;s<0&&(s=e.length-1);for(let e=0,n=d+2*v;e<n;e++){let n=R*e,o=R*(e+1);(function(e,t,n,a){G(e),G(t),G(a),G(t),G(n),G(a);let s=i.length/3,o=E.generateSideWallUV(r,i,s-6,s-3,s-2,s-1);H(o[0]),H(o[1]),H(o[3]),H(o[1]),H(o[2]),H(o[3])})(t+a+n,t+s+n,t+s+o,t+a+o)}}}function N(e,t,r){c.push(e),c.push(t),c.push(r)}function z(e,t,n){G(e),G(t),G(n);let a=i.length/3,s=E.generateTopUV(r,i,a-3,a-2,a-1);H(s[0]),H(s[1]),H(s[2])}function G(e){i.push(c[3*e+0]),i.push(c[3*e+1]),i.push(c[3*e+2])}function H(e){n.push(e.x),n.push(e.y)}(function(){let e=i.length/3;if(p){let e=0*R;for(let t=0;t<F;t++){let r=u[t];z(r[2]+e,r[1]+e,r[0]+e)}e=R*(d+2*v);for(let t=0;t<F;t++){let r=u[t];z(r[0]+e,r[1]+e,r[2]+e)}}else{for(let e=0;e<F;e++){let t=u[e];z(t[2],t[1],t[0])}for(let e=0;e<F;e++){let t=u[e];z(t[0]+R*d,t[1]+R*d,t[2]+R*d)}}r.addGroup(e,i.length/3-e,0)})(),function(){let e=i.length/3,t=0;U(I,0),t+=I.length;for(let e=0,r=w.length;e<r;e++){let r=w[e];U(r,t),t+=r.length}r.addGroup(e,i.length/3-e,1)}()})(e[a]);this.setAttribute("position",new se(i,3)),this.setAttribute("uv",new se(n,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return function(e,t,r){if(r.shapes=[],Array.isArray(e))for(let t=0,i=e.length;t<i;t++){let i=e[t];r.shapes.push(i.uuid)}else r.shapes.push(e.uuid);return r.options=Object.assign({},t),void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){let r=[];for(let i=0,n=e.shapes.length;i<n;i++){let n=t[e.shapes[i]];r.push(n)}let i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=new lK[i.type]().fromJSON(i)),new ul(r,e.options)}}let uu={generateTopUV:function(e,t,r,i,n){let a=t[3*r],s=t[3*r+1],o=t[3*i],l=t[3*i+1],u=t[3*n],c=t[3*n+1];return[new nt(a,s),new nt(o,l),new nt(u,c)]},generateSideWallUV:function(e,t,r,i,n,a){let s=t[3*r],o=t[3*r+1],l=t[3*r+2],u=t[3*i],c=t[3*i+1],h=t[3*i+2],d=t[3*n],f=t[3*n+1],p=t[3*n+2],m=t[3*a],g=t[3*a+1],A=t[3*a+2];return Math.abs(o-c)<Math.abs(s-u)?[new nt(s,1-l),new nt(u,1-h),new nt(d,1-p),new nt(m,1-A)]:[new nt(o,1-l),new nt(c,1-h),new nt(f,1-p),new nt(g,1-A)]}};class uc extends l_{constructor(e=1,t=0){let r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new uc(e.radius,e.detail)}}class uh extends sl{constructor(e=[new nt(0,-.5),new nt(.5,0),new nt(0,.5)],t=12,r=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t),i=i5(i,0,2*Math.PI);let n=[],a=[],s=[],o=[],l=[],u=1/t,c=new ni,h=new nt,d=new ni,f=new ni,p=new ni,m=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(p.x,p.y,p.z);break;default:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.x+=p.x,d.y+=p.y,d.z+=p.z,d.normalize(),o.push(d.x,d.y,d.z),p.copy(f)}for(let n=0;n<=t;n++){let d=r+n*u*i,f=Math.sin(d),p=Math.cos(d);for(let r=0;r<=e.length-1;r++){c.x=e[r].x*f,c.y=e[r].y,c.z=e[r].x*p,a.push(c.x,c.y,c.z),h.x=n/t,h.y=r/(e.length-1),s.push(h.x,h.y);let i=o[3*r+0]*f,u=o[3*r+1],d=o[3*r+0]*p;l.push(i,u,d)}}for(let r=0;r<t;r++)for(let t=0;t<e.length-1;t++){let i=t+r*e.length,a=i+e.length,s=i+e.length+1,o=i+1;n.push(i,a,o),n.push(s,o,a)}this.setIndex(n),this.setAttribute("position",new se(a,3)),this.setAttribute("uv",new se(s,2)),this.setAttribute("normal",new se(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uh(e.points,e.segments,e.phiStart,e.phiLength)}}class ud extends l_{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ud(e.radius,e.detail)}}class uf extends sl{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};let n=e/2,a=t/2,s=Math.floor(r),o=Math.floor(i),l=s+1,u=o+1,c=e/s,h=t/o,d=[],f=[],p=[],m=[];for(let e=0;e<u;e++){let t=e*h-a;for(let r=0;r<l;r++){let i=r*c-n;f.push(i,-t,0),p.push(0,0,1),m.push(r/s),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<s;t++){let r=t+l*e,i=t+l*(e+1),n=t+1+l*(e+1),a=t+1+l*e;d.push(r,i,a),d.push(i,n,a)}this.setIndex(d),this.setAttribute("position",new se(f,3)),this.setAttribute("normal",new se(p,3)),this.setAttribute("uv",new se(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uf(e.width,e.height,e.widthSegments,e.heightSegments)}}class up extends sl{constructor(e=.5,t=1,r=32,i=1,n=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},r=Math.max(3,r);let s=[],o=[],l=[],u=[],c=e,h=(t-e)/(i=Math.max(1,i)),d=new ni,f=new nt;for(let e=0;e<=i;e++){for(let e=0;e<=r;e++){let i=n+e/r*a;d.x=c*Math.cos(i),d.y=c*Math.sin(i),o.push(d.x,d.y,d.z),l.push(0,0,1),f.x=(d.x/t+1)/2,f.y=(d.y/t+1)/2,u.push(f.x,f.y)}c+=h}for(let e=0;e<i;e++){let t=e*(r+1);for(let e=0;e<r;e++){let i=e+t,n=i+r+1,a=i+r+2,o=i+1;s.push(i,n,o),s.push(n,a,o)}}this.setIndex(s),this.setAttribute("position",new se(o,3)),this.setAttribute("normal",new se(l,3)),this.setAttribute("uv",new se(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new up(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class um extends sl{constructor(e=new l$([new nt(0,.5),new nt(-.5,-.5),new nt(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let r=[],i=[],n=[],a=[],s=0,o=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(s,o,t),s+=o,o=0;function l(e){let s=i.length/3,l=e.extractPoints(t),u=l.shape,c=l.holes;!1===ua.isClockWise(u)&&(u=u.reverse());for(let e=0,t=c.length;e<t;e++){let t=c[e];!0===ua.isClockWise(t)&&(c[e]=t.reverse())}let h=ua.triangulateShape(u,c);for(let e=0,t=c.length;e<t;e++){let t=c[e];u=u.concat(t)}for(let e=0,t=u.length;e<t;e++){let t=u[e];i.push(t.x,t.y,0),n.push(0,0,1),a.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){let t=h[e],i=t[0]+s,n=t[1]+s,a=t[2]+s;r.push(i,n,a),o+=3}}this.setIndex(r),this.setAttribute("position",new se(i,3)),this.setAttribute("normal",new se(n,3)),this.setAttribute("uv",new se(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let r=0,i=e.length;r<i;r++){let i=e[r];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){let r=[];for(let i=0,n=e.shapes.length;i<n;i++){let n=t[e.shapes[i]];r.push(n)}return new um(r,e.curveSegments)}}class ug extends sl{constructor(e=1,t=32,r=16,i=0,n=2*Math.PI,a=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:s},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));let o=Math.min(a+s,Math.PI),l=0,u=[],c=new ni,h=new ni,d=[],f=[],p=[],m=[];for(let d=0;d<=r;d++){let g=[],A=d/r,v=0;0===d&&0===a?v=.5/t:d===r&&o===Math.PI&&(v=-.5/t);for(let r=0;r<=t;r++){let o=r/t;c.x=-e*Math.cos(i+o*n)*Math.sin(a+A*s),c.y=e*Math.cos(a+A*s),c.z=e*Math.sin(i+o*n)*Math.sin(a+A*s),f.push(c.x,c.y,c.z),h.copy(c).normalize(),p.push(h.x,h.y,h.z),m.push(o+v,1-A),g.push(l++)}u.push(g)}for(let e=0;e<r;e++)for(let i=0;i<t;i++){let t=u[e][i+1],n=u[e][i],s=u[e+1][i],l=u[e+1][i+1];(0!==e||a>0)&&d.push(t,n,l),(e!==r-1||o<Math.PI)&&d.push(n,s,l)}this.setIndex(d),this.setAttribute("position",new se(f,3)),this.setAttribute("normal",new se(p,3)),this.setAttribute("uv",new se(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ug(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class uA extends l_{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new uA(e.radius,e.detail)}}class uv extends sl{constructor(e=1,t=.4,r=12,i=48,n=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},r=Math.floor(r),i=Math.floor(i);let a=[],s=[],o=[],l=[],u=new ni,c=new ni,h=new ni;for(let a=0;a<=r;a++)for(let d=0;d<=i;d++){let f=d/i*n,p=a/r*Math.PI*2;c.x=(e+t*Math.cos(p))*Math.cos(f),c.y=(e+t*Math.cos(p))*Math.sin(f),c.z=t*Math.sin(p),s.push(c.x,c.y,c.z),u.x=e*Math.cos(f),u.y=e*Math.sin(f),h.subVectors(c,u).normalize(),o.push(h.x,h.y,h.z),l.push(d/i),l.push(a/r)}for(let e=1;e<=r;e++)for(let t=1;t<=i;t++){let r=(i+1)*e+t-1,n=(i+1)*(e-1)+t-1,s=(i+1)*(e-1)+t,o=(i+1)*e+t;a.push(r,n,o),a.push(n,s,o)}this.setIndex(a),this.setAttribute("position",new se(s,3)),this.setAttribute("normal",new se(o,3)),this.setAttribute("uv",new se(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uv(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class uy extends sl{constructor(e=1,t=.4,r=64,i=8,n=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:n,q:a},r=Math.floor(r),i=Math.floor(i);let s=[],o=[],l=[],u=[],c=new ni,h=new ni,d=new ni,f=new ni,p=new ni,m=new ni,g=new ni;for(let s=0;s<=r;++s){let v=s/r*n*Math.PI*2;A(v,n,a,e,d),A(v+.01,n,a,e,f),m.subVectors(f,d),g.addVectors(f,d),p.crossVectors(m,g),g.crossVectors(p,m),p.normalize(),g.normalize();for(let e=0;e<=i;++e){let n=e/i*Math.PI*2,a=-t*Math.cos(n),f=t*Math.sin(n);c.x=d.x+(a*g.x+f*p.x),c.y=d.y+(a*g.y+f*p.y),c.z=d.z+(a*g.z+f*p.z),o.push(c.x,c.y,c.z),h.subVectors(c,d).normalize(),l.push(h.x,h.y,h.z),u.push(s/r),u.push(e/i)}}for(let e=1;e<=r;e++)for(let t=1;t<=i;t++){let r=(i+1)*(e-1)+(t-1),n=(i+1)*e+(t-1),a=(i+1)*e+t,o=(i+1)*(e-1)+t;s.push(r,n,o),s.push(n,a,o)}function A(e,t,r,i,n){let a=Math.cos(e),s=Math.sin(e),o=r/t*e,l=Math.cos(o);n.x=i*(2+l)*.5*a,n.y=i*(2+l)*s*.5,n.z=i*Math.sin(o)*.5}this.setIndex(s),this.setAttribute("position",new se(o,3)),this.setAttribute("normal",new se(l,3)),this.setAttribute("uv",new se(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uy(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class uE extends sl{constructor(e=new lj(new ni(-1,-1,0),new ni(-1,1,0),new ni(1,1,0)),t=64,r=1,i=8,n=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:n};let a=e.computeFrenetFrames(t,n);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;let s=new ni,o=new ni,l=new nt,u=new ni,c=[],h=[],d=[],f=[];function p(n){u=e.getPointAt(n/t,u);let l=a.normals[n],d=a.binormals[n];for(let e=0;e<=i;e++){let t=e/i*Math.PI*2,n=Math.sin(t),a=-Math.cos(t);o.x=a*l.x+n*d.x,o.y=a*l.y+n*d.y,o.z=a*l.z+n*d.z,o.normalize(),h.push(o.x,o.y,o.z),s.x=u.x+r*o.x,s.y=u.y+r*o.y,s.z=u.z+r*o.z,c.push(s.x,s.y,s.z)}}(function(){for(let e=0;e<t;e++)p(e);p(!1===n?t:0),function(){for(let e=0;e<=t;e++)for(let r=0;r<=i;r++)l.x=e/t,l.y=r/i,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){let r=(i+1)*(e-1)+(t-1),n=(i+1)*e+(t-1),a=(i+1)*e+t,s=(i+1)*(e-1)+t;f.push(r,n,s),f.push(n,a,s)}}()})(),this.setIndex(f),this.setAttribute("position",new se(c,3)),this.setAttribute("normal",new se(h,3)),this.setAttribute("uv",new se(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new uE(new lK[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class ux extends sl{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){let t=[],r=new Set,i=new ni,n=new ni;if(null!==e.index){let a=e.attributes.position,s=e.index,o=e.groups;0===o.length&&(o=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,l=o.length;e<l;++e){let l=o[e],u=l.start,c=l.count;for(let e=u,o=u+c;e<o;e+=3)for(let o=0;o<3;o++){let l=s.getX(e+o),u=s.getX(e+(o+1)%3);i.fromBufferAttribute(a,l),n.fromBufferAttribute(a,u),!0===u_(i,n,r)&&(t.push(i.x,i.y,i.z),t.push(n.x,n.y,n.z))}}}else{let a=e.attributes.position;for(let e=0,s=a.count/3;e<s;e++)for(let s=0;s<3;s++){let o=3*e+s,l=3*e+(s+1)%3;i.fromBufferAttribute(a,o),n.fromBufferAttribute(a,l),!0===u_(i,n,r)&&(t.push(i.x,i.y,i.z),t.push(n.x,n.y,n.z))}}this.setAttribute("position",new se(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function u_(e,t,r){let i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==r.has(i)&&!0!==r.has(n)&&(r.add(i),r.add(n),!0)}var ub=Object.freeze({__proto__:null,BoxGeometry:s_,CapsuleGeometry:lv,CircleGeometry:ly,ConeGeometry:lx,CylinderGeometry:lE,DodecahedronGeometry:lb,EdgesGeometry:lI,ExtrudeGeometry:ul,IcosahedronGeometry:uc,LatheGeometry:uh,OctahedronGeometry:ud,PlaneGeometry:uf,PolyhedronGeometry:l_,RingGeometry:up,ShapeGeometry:um,SphereGeometry:ug,TetrahedronGeometry:uA,TorusGeometry:uv,TorusKnotGeometry:uy,TubeGeometry:uE,WireframeGeometry:ux});class uS extends aj{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new aQ(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class uw extends sT{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class uC extends aj{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new aQ(0xffffff),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new aQ(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ia,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ao,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class uT extends uC{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new nt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return i5(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new aQ(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new aQ(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new aQ(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class uI extends aj{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new aQ(0xffffff),this.specular=new aQ(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new aQ(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ia,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ao,this.combine=tC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class uM extends aj{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new aQ(0xffffff),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new aQ(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ia,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class uR extends aj{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ia,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class uB extends aj{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new aQ(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new aQ(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ia,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ao,this.combine=tC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class uD extends aj{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=ie,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class uP extends aj{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class uL extends aj{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new aQ(0xffffff),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ia,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class uk extends oJ{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function uF(e,t){return e&&e.constructor!==t?"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}function uO(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function uU(e){let t=e.length,r=Array(t);for(let e=0;e!==t;++e)r[e]=e;return r.sort(function(t,r){return e[t]-e[r]}),r}function uN(e,t,r){let i=e.length,n=new e.constructor(i);for(let a=0,s=0;s!==i;++a){let i=r[a]*t;for(let r=0;r!==t;++r)n[s++]=e[i+r]}return n}function uz(e,t,r,i){let n=1,a=e[0];for(;void 0!==a&&void 0===a[i];)a=e[n++];if(void 0===a)return;let s=a[i];if(void 0!==s){if(Array.isArray(s))do void 0!==(s=a[i])&&(t.push(a.time),r.push(...s)),a=e[n++];while(void 0!==a);else if(void 0!==s.toArray)do void 0!==(s=a[i])&&(t.push(a.time),s.toArray(r,r.length)),a=e[n++];while(void 0!==a);else do void 0!==(s=a[i])&&(t.push(a.time),r.push(s)),a=e[n++];while(void 0!==a)}}class uG{static convertArray(e,t){return uF(e,t)}static isTypedArray(e){return uO(e)}static getKeyframeOrder(e){return uU(e)}static sortedArray(e,t,r){return uN(e,t,r)}static flattenJSON(e,t,r,i){uz(e,t,r,i)}static subclip(e,t,r,i,n=30){return function(e,t,r,i,n=30){let a=e.clone();a.name=t;let s=[];for(let e=0;e<a.tracks.length;++e){let t=a.tracks[e],o=t.getValueSize(),l=[],u=[];for(let e=0;e<t.times.length;++e){let a=t.times[e]*n;if(!(a<r)&&!(a>=i)){l.push(t.times[e]);for(let r=0;r<o;++r)u.push(t.values[e*o+r])}}0!==l.length&&(t.times=uF(l,t.times.constructor),t.values=uF(u,t.values.constructor),s.push(t))}a.tracks=s;let o=1/0;for(let e=0;e<a.tracks.length;++e)o>a.tracks[e].times[0]&&(o=a.tracks[e].times[0]);for(let e=0;e<a.tracks.length;++e)a.tracks[e].shift(-1*o);return a.resetDuration(),a}(e,t,r,i,n)}static makeClipAdditive(e,t=0,r=e,i=30){return function(e,t=0,r=e,i=30){i<=0&&(i=30);let n=r.tracks.length,a=t/i;for(let t=0;t<n;++t){let i;let n=r.tracks[t],s=n.ValueTypeName;if("bool"===s||"string"===s)continue;let o=e.tracks.find(function(e){return e.name===n.name&&e.ValueTypeName===s});if(void 0===o)continue;let l=0,u=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=u/3);let c=0,h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);let d=n.times.length-1;if(a<=n.times[0]){let e=l,t=u-l;i=n.values.slice(e,t)}else if(a>=n.times[d]){let e=d*u+l,t=e+u-l;i=n.values.slice(e,t)}else{let e=n.createInterpolant(),t=l,r=u-l;e.evaluate(a),i=e.resultBuffer.slice(t,r)}"quaternion"===s&&new nr().fromArray(i).normalize().conjugate().toArray(i);let f=o.times.length;for(let e=0;e<f;++e){let t=e*h+c;if("quaternion"===s)nr.multiplyQuaternionsFlat(o.values,t,i,0,o.values,t);else{let e=h-2*c;for(let r=0;r<e;++r)o.values[t+r]-=i[r]}}}return e.blendMode=r6,e}(e,t,r,i)}}class uH{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,r=this._cachedIndex,i=t[r],n=t[r-1];e:{t:{let a;r:{i:if(!(e<i)){for(let a=r+2;;){if(void 0===i){if(e<n)break i;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===a)break;if(n=i,e<(i=t[++r]))break t}a=t.length;break r}if(!(e>=n)){let s=t[1];e<s&&(r=2,n=s);for(let a=r-2;;){if(void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(r===a)break;if(i=n,e>=(n=t[--r-1]))break t}a=r,r=0;break r}break e}for(;r<a;){let i=r+a>>>1;e<t[i]?a=i:r=i+1}if(i=t[r],void 0===(n=t[r-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,n,i)}return this.interpolate_(r,n,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i;for(let e=0;e!==i;++e)t[e]=r[n+e];return t}interpolate_(){throw Error("call to abstract method")}intervalChanged_(){}}class uQ extends uH{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:r2,endingEnd:r2}}intervalChanged_(e,t,r){let i=this.parameterPositions,n=e-2,a=e+1,s=i[n],o=i[a];if(void 0===s)switch(this.getSettings_().endingStart){case r3:n=e,s=2*t-r;break;case r4:n=i.length-2,s=t+i[n]-i[n+1];break;default:n=e,s=r}if(void 0===o)switch(this.getSettings_().endingEnd){case r3:a=e,o=2*r-t;break;case r4:a=1,o=r+i[1]-i[0];break;default:a=e-1,o=t}let l=(r-t)*.5,u=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-r),this._offsetPrev=n*u,this._offsetNext=a*u}interpolate_(e,t,r,i){let n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(r-t)/(i-t),p=f*f,m=p*f,g=-h*m+2*h*p-h*f,A=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,v=(-1-d)*m+(1.5+d)*p+.5*f,y=d*m-d*p;for(let e=0;e!==s;++e)n[e]=g*a[u+e]+A*a[l+e]+v*a[o+e]+y*a[c+e];return n}}class uV extends uH{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){let n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,u=(r-t)/(i-t),c=1-u;for(let e=0;e!==s;++e)n[e]=a[l+e]*c+a[o+e]*u;return n}}class uW extends uH{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class uj{constructor(e,t,r,i){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=uF(t,this.TimeBufferType),this.values=uF(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){let t;let r=e.constructor;if(r.toJSON!==this.toJSON)t=r.toJSON(e);else{t={name:e.name,times:uF(e.times,Array),values:uF(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}InterpolantFactoryMethodDiscrete(e){return new uW(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new uV(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new uQ(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case rZ:t=this.InterpolantFactoryMethodDiscrete;break;case r0:t=this.InterpolantFactoryMethodLinear;break;case r1:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){let t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(t)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return rZ;case this.InterpolantFactoryMethodLinear:return r0;case this.InterpolantFactoryMethodSmooth:return r1}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]+=e}return this}scale(e){if(1!==e){let t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]*=e}return this}trim(e,t){let r=this.times,i=r.length,n=0,a=i-1;for(;n!==i&&r[n]<e;)++n;for(;-1!==a&&r[a]>t;)--a;if(++a,0!==n||a!==i){n>=a&&(n=(a=Math.max(a,1))-1);let e=this.getValueSize();this.times=r.slice(n,a),this.values=this.values.slice(n*e,a*e)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let r=this.times,i=this.values,n=r.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let t=0;t!==n;t++){let i=r[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==a&&a>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,a),e=!1;break}a=i}if(void 0!==i&&uO(i))for(let t=0,r=i.length;t!==r;++t){let r=i[t];if(isNaN(r)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,r),e=!1;break}}return e}optimize(){let e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),i=this.getInterpolation()===r1,n=e.length-1,a=1;for(let s=1;s<n;++s){let n=!1,o=e[s];if(o!==e[s+1]&&(1!==s||o!==e[0])){if(i)n=!0;else{let e=s*r,i=e-r,a=e+r;for(let s=0;s!==r;++s){let r=t[e+s];if(r!==t[i+s]||r!==t[a+s]){n=!0;break}}}}if(n){if(s!==a){e[a]=e[s];let i=s*r,n=a*r;for(let e=0;e!==r;++e)t[n+e]=t[i+e]}++a}}if(n>0){e[a]=e[n];for(let e=n*r,i=a*r,s=0;s!==r;++s)t[i+s]=t[e+s];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*r)):(this.times=e,this.values=t),this}clone(){let e=this.times.slice(),t=this.values.slice(),r=new this.constructor(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}uj.prototype.ValueTypeName="",uj.prototype.TimeBufferType=Float32Array,uj.prototype.ValueBufferType=Float32Array,uj.prototype.DefaultInterpolation=r0;class uY extends uj{constructor(e,t,r){super(e,t,r)}}uY.prototype.ValueTypeName="bool",uY.prototype.ValueBufferType=Array,uY.prototype.DefaultInterpolation=rZ,uY.prototype.InterpolantFactoryMethodLinear=void 0,uY.prototype.InterpolantFactoryMethodSmooth=void 0;class uK extends uj{constructor(e,t,r,i){super(e,t,r,i)}}uK.prototype.ValueTypeName="color";class uq extends uj{constructor(e,t,r,i){super(e,t,r,i)}}uq.prototype.ValueTypeName="number";class uX extends uH{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){let n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(r-t)/(i-t),l=e*s;for(let e=l+s;l!==e;l+=4)nr.slerpFlat(n,0,a,l-s,a,l,o);return n}}class u$ extends uj{constructor(e,t,r,i){super(e,t,r,i)}InterpolantFactoryMethodLinear(e){return new uX(this.times,this.values,this.getValueSize(),e)}}u$.prototype.ValueTypeName="quaternion",u$.prototype.InterpolantFactoryMethodSmooth=void 0;class uJ extends uj{constructor(e,t,r){super(e,t,r)}}uJ.prototype.ValueTypeName="string",uJ.prototype.ValueBufferType=Array,uJ.prototype.DefaultInterpolation=rZ,uJ.prototype.InterpolantFactoryMethodLinear=void 0,uJ.prototype.InterpolantFactoryMethodSmooth=void 0;class uZ extends uj{constructor(e,t,r,i){super(e,t,r,i)}}uZ.prototype.ValueTypeName="vector";class u0{constructor(e="",t=-1,r=[],i=r5){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=i4(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){let t=[],r=e.tracks,i=1/(e.fps||1);for(let e=0,n=r.length;e!==n;++e)t.push((function(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return uq;case"vector":case"vector2":case"vector3":case"vector4":return uZ;case"color":return uK;case"quaternion":return u$;case"bool":case"boolean":return uY;case"string":return uJ}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){let t=[],r=[];uz(e.keys,t,r,"value"),e.times=t,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)})(r[e]).scale(i));let n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n.userData=JSON.parse(e.userData||"{}"),n}static toJSON(e){let t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let e=0,i=r.length;e!==i;++e)t.push(uj.toJSON(r[e]));return i}static CreateFromMorphTargetSequence(e,t,r,i){let n=t.length,a=[];for(let e=0;e<n;e++){let s=[],o=[];s.push((e+n-1)%n,e,(e+1)%n),o.push(0,1,0);let l=uU(s);s=uN(s,1,l),o=uN(o,1,l),i||0!==s[0]||(s.push(n),o.push(o[0])),a.push(new uq(".morphTargetInfluences["+t[e].name+"]",s,o).scale(1/r))}return new this(e,-1,a)}static findByName(e,t){let r=e;Array.isArray(e)||(r=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<r.length;e++)if(r[e].name===t)return r[e];return null}static CreateClipsFromMorphTargetSequences(e,t,r){let i={},n=/^([\w-]*?)([\d]+)$/;for(let t=0,r=e.length;t<r;t++){let r=e[t],a=r.name.match(n);if(a&&a.length>1){let e=a[1],t=i[e];t||(i[e]=t=[]),t.push(r)}}let a=[];for(let e in i)a.push(this.CreateFromMorphTargetSequence(e,i[e],t,r));return a}static parseAnimation(e,t){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let r=function(e,t,r,i,n){if(0!==r.length){let a=[],s=[];uz(r,a,s,i),0!==a.length&&n.push(new e(t,a,s))}},i=[],n=e.name||"default",a=e.fps||30,s=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let e=0;e<l.length;e++){let n=l[e].keys;if(n&&0!==n.length){if(n[0].morphTargets){let e;let t={};for(e=0;e<n.length;e++)if(n[e].morphTargets)for(let r=0;r<n[e].morphTargets.length;r++)t[n[e].morphTargets[r]]=-1;for(let r in t){let t=[],a=[];for(let i=0;i!==n[e].morphTargets.length;++i){let i=n[e];t.push(i.time),a.push(i.morphTarget===r?1:0)}i.push(new uq(".morphTargetInfluence["+r+"]",t,a))}o=t.length*a}else{let a=".bones["+t[e].name+"]";r(uZ,a+".position",n,"pos",i),r(u$,a+".quaternion",n,"rot",i),r(uZ,a+".scale",n,"scl",i)}}}return 0===i.length?null:new this(n,o,i,s)}resetDuration(){let e=this.tracks,t=0;for(let r=0,i=e.length;r!==i;++r){let e=this.tracks[r];t=Math.max(t,e.times[e.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());let t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}let u1={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class u2{constructor(e,t,r){let i;let n=this,a=!1,s=0,o=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.abortController=new AbortController,this.itemStart=function(e){o++,!1===a&&void 0!==n.onStart&&n.onStart(e,s,o),a=!0},this.itemEnd=function(e){s++,void 0!==n.onProgress&&n.onProgress(e,s,o),s===o&&(a=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){let t=l.indexOf(e);return -1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,r=l.length;t<r;t+=2){let r=l[t],i=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}let u3=new u2;class u4{constructor(e){this.manager=void 0!==e?e:u3,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let r=this;return new Promise(function(i,n){r.load(e,i,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}u4.DEFAULT_MATERIAL_NAME="__DEFAULT";let u5={};class u6 extends Error{constructor(e,t){super(e),this.response=t}}class u8 extends u4{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let n=u1.get(`file:${e}`);if(void 0!==n)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(void 0!==u5[e]){u5[e].push({onLoad:t,onProgress:r,onError:i});return}u5[e]=[],u5[e].push({onLoad:t,onProgress:r,onError:i});let a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:"function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),s=this.mimeType,o=this.responseType;fetch(a).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;let r=u5[e],i=t.body.getReader(),n=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),a=n?parseInt(n):0,s=0!==a,o=0;return new Response(new ReadableStream({start(e){(function t(){i.read().then(({done:i,value:n})=>{if(i)e.close();else{let i=new ProgressEvent("progress",{lengthComputable:s,loaded:o+=n.byteLength,total:a});for(let e=0,t=r.length;e<t;e++){let t=r[e];t.onProgress&&t.onProgress(i)}e.enqueue(n),t()}},t=>{e.error(t)})})()}}))}throw new u6(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)}).then(e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>new DOMParser().parseFromString(e,s));case"json":return e.json();default:if(""===s)return e.text();{let t=/charset="?([^;"\s]*)"?/i.exec(s),r=new TextDecoder(t&&t[1]?t[1].toLowerCase():void 0);return e.arrayBuffer().then(e=>r.decode(e))}}}).then(t=>{u1.add(`file:${e}`,t);let r=u5[e];delete u5[e];for(let e=0,i=r.length;e<i;e++){let i=r[e];i.onLoad&&i.onLoad(t)}}).catch(t=>{let r=u5[e];if(void 0===r)throw this.manager.itemError(e),t;delete u5[e];for(let e=0,i=r.length;e<i;e++){let i=r[e];i.onError&&i.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class u9 extends u4{constructor(e){super(e)}load(e,t,r,i){let n=this,a=new u8(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(r){try{t(n.parse(JSON.parse(r)))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}},r,i)}parse(e){let t=[];for(let r=0;r<e.length;r++){let i=u0.parse(e[r]);t.push(i)}return t}}class u7 extends u4{constructor(e){super(e)}load(e,t,r,i){let n=this,a=[],s=new ld,o=new u8(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(n.withCredentials);let l=0;if(Array.isArray(e))for(let u=0,c=e.length;u<c;++u)!function(u){o.load(e[u],function(e){let r=n.parse(e,!0);a[u]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(l+=1)&&(1===r.mipmapCount&&(s.minFilter=tZ),s.image=a,s.format=r.format,s.needsUpdate=!0,t&&t(s))},r,i)}(u);else o.load(e,function(e){let r=n.parse(e,!0);if(r.isCubemap){let e=r.mipmaps.length/r.mipmapCount;for(let t=0;t<e;t++){a[t]={mipmaps:[]};for(let e=0;e<r.mipmapCount;e++)a[t].mipmaps.push(r.mipmaps[t*r.mipmapCount+e]),a[t].format=r.format,a[t].width=r.width,a[t].height=r.height}s.image=a}else s.image.width=r.width,s.image.height=r.height,s.mipmaps=r.mipmaps;1===r.mipmapCount&&(s.minFilter=tZ),s.format=r.format,s.needsUpdate=!0,t&&t(s)},r,i);return s}}let ce=new WeakMap;class ct extends u4{constructor(e){super(e)}load(e,t,r,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,a=u1.get(`image:${e}`);if(void 0!==a){if(!0===a.complete)n.manager.itemStart(e),setTimeout(function(){t&&t(a),n.manager.itemEnd(e)},0);else{let e=ce.get(a);void 0===e&&(e=[],ce.set(a,e)),e.push({onLoad:t,onError:i})}return a}let s=nh("img");function o(){u(),t&&t(this);let r=ce.get(this)||[];for(let e=0;e<r.length;e++){let t=r[e];t.onLoad&&t.onLoad(this)}ce.delete(this),n.manager.itemEnd(e)}function l(t){u(),i&&i(t),u1.remove(`image:${e}`);let r=ce.get(this)||[];for(let e=0;e<r.length;e++){let i=r[e];i.onError&&i.onError(t)}ce.delete(this),n.manager.itemError(e),n.manager.itemEnd(e)}function u(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),u1.add(`image:${e}`,s),n.manager.itemStart(e),s.src=e,s}}class cr extends u4{constructor(e){super(e)}load(e,t,r,i){let n=new sL;n.colorSpace=il;let a=new ct(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let s=0;for(let r=0;r<e.length;++r)!function(r){a.load(e[r],function(e){n.images[r]=e,6==++s&&(n.needsUpdate=!0,t&&t(n))},void 0,i)}(r);return n}}class ci extends u4{constructor(e){super(e)}load(e,t,r,i){let n=this,a=new oc,s=new u8(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(n.withCredentials),s.load(e,function(e){let r;try{r=n.parse(e)}catch(e){if(void 0!==i)i(e);else{console.error(e);return}}void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:tj,a.wrapT=void 0!==r.wrapT?r.wrapT:tj,a.magFilter=void 0!==r.magFilter?r.magFilter:tZ,a.minFilter=void 0!==r.minFilter?r.minFilter:tZ,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.colorSpace&&(a.colorSpace=r.colorSpace),void 0!==r.flipY&&(a.flipY=r.flipY),void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps,a.minFilter=t2),1===r.mipmapCount&&(a.minFilter=tZ),void 0!==r.generateMipmaps&&(a.generateMipmaps=r.generateMipmaps),a.needsUpdate=!0,t&&t(a,r)},r,i),a}}class cn extends u4{constructor(e){super(e)}load(e,t,r,i){let n=new nC,a=new ct(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)},r,i),n}}class ca extends aS{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new aQ(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}class cs extends ca{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(aS.DEFAULT_UP),this.updateMatrix(),this.groundColor=new aQ(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}let co=new n8,cl=new ni,cu=new ni;class cc{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new nt(512,512),this.mapType=t4,this.map=null,this.mapPass=null,this.matrix=new n8,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new oR,this._frameExtents=new nt(1,1),this._viewportCount=1,this._viewports=[new nT(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,r=this.matrix;cl.setFromMatrixPosition(e.matrixWorld),t.position.copy(cl),cu.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(cu),t.updateMatrixWorld(),co.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(co,t.coordinateSystem,t.reversedDepth),t.reversedDepth?r.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(co)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class ch extends cc{constructor(){super(new sD(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){let t=this.camera,r=2*i3*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,n=e.distance||t.far;(r!==t.fov||i!==t.aspect||n!==t.far)&&(t.fov=r,t.aspect=i,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class cd extends ca{constructor(e,t,r=0,i=Math.PI/3,n=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(aS.DEFAULT_UP),this.updateMatrix(),this.target=new aS,this.distance=r,this.angle=i,this.penumbra=n,this.decay=a,this.map=null,this.shadow=new ch}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}let cf=new n8,cp=new ni,cm=new ni;class cg extends cc{constructor(){super(new sD(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new nt(4,2),this._viewportCount=6,this._viewports=[new nT(2,1,1,1),new nT(0,1,1,1),new nT(3,1,1,1),new nT(1,1,1,1),new nT(3,0,1,1),new nT(1,0,1,1)],this._cubeDirections=[new ni(1,0,0),new ni(-1,0,0),new ni(0,0,1),new ni(0,0,-1),new ni(0,1,0),new ni(0,-1,0)],this._cubeUps=[new ni(0,1,0),new ni(0,1,0),new ni(0,1,0),new ni(0,1,0),new ni(0,0,1),new ni(0,0,-1)]}updateMatrices(e,t=0){let r=this.camera,i=this.matrix,n=e.distance||r.far;n!==r.far&&(r.far=n,r.updateProjectionMatrix()),cp.setFromMatrixPosition(e.matrixWorld),r.position.copy(cp),cm.copy(r.position),cm.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(cm),r.updateMatrixWorld(),i.makeTranslation(-cp.x,-cp.y,-cp.z),cf.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(cf,r.coordinateSystem,r.reversedDepth)}}class cA extends ca{constructor(e,t,r=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new cg}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class cv extends sI{constructor(e=-1,t=1,r=1,i=-1,n=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=n,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,n=r-e,a=r+e,s=i+t,o=i-t;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=e*this.view.offsetX,a=n+e*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(n,a,s,o,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class cy extends cc{constructor(){super(new cv(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class cE extends ca{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(aS.DEFAULT_UP),this.updateMatrix(),this.target=new aS,this.shadow=new cy}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class cx extends ca{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class c_ extends ca{constructor(e,t,r=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class cb{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ni)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let r=e.x,i=e.y,n=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*n),t.addScaledVector(a[3],.488603*r),t.addScaledVector(a[4],r*i*1.092548),t.addScaledVector(a[5],i*n*1.092548),t.addScaledVector(a[6],.315392*(3*n*n-1)),t.addScaledVector(a[7],r*n*1.092548),t.addScaledVector(a[8],.546274*(r*r-i*i)),t}getIrradianceAt(e,t){let r=e.x,i=e.y,n=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*i),t.addScaledVector(a[2],1.023328*n),t.addScaledVector(a[3],1.023328*r),t.addScaledVector(a[4],.858086*r*i),t.addScaledVector(a[5],.858086*i*n),t.addScaledVector(a[6],.743125*n*n-.247708),t.addScaledVector(a[7],.858086*r*n),t.addScaledVector(a[8],.429043*(r*r-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){let r=this.coefficients;for(let i=0;i<9;i++)r[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){let r=this.coefficients;for(let i=0;i<9;i++)r[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){let r=e.x,i=e.y,n=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*n,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*n,t[6]=.315392*(3*n*n-1),t[7]=1.092548*r*n,t[8]=.546274*(r*r-i*i)}}class cS extends ca{constructor(e=new cb,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class cw extends u4{constructor(e){super(e),this.textures={}}load(e,t,r,i){let n=this,a=new u8(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(e,function(r){try{t(n.parse(JSON.parse(r)))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}},r,i)}parse(e){let t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}let i=this.createMaterialFromType(e.type);if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=new aQ().setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(i.dispersion=e.dispersion),void 0!==e.iridescence&&(i.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(i.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(i.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(i.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(i.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(i.depthFunc=e.depthFunc),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(i.blendSrc=e.blendSrc),void 0!==e.blendDst&&(i.blendDst=e.blendDst),void 0!==e.blendEquation&&(i.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(i.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(i.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(i.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(i.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),void 0!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(i.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(let t in e.uniforms){let n=e.uniforms[t];switch(i.uniforms[t]={},n.type){case"t":i.uniforms[t].value=r(n.value);break;case"c":i.uniforms[t].value=new aQ().setHex(n.value);break;case"v2":i.uniforms[t].value=new nt().fromArray(n.value);break;case"v3":i.uniforms[t].value=new ni().fromArray(n.value);break;case"v4":i.uniforms[t].value=new nT().fromArray(n.value);break;case"m3":i.uniforms[t].value=new ns().fromArray(n.value);break;case"m4":i.uniforms[t].value=new n8().fromArray(n.value);break;default:i.uniforms[t].value=n.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(i.glslVersion=e.glslVersion),void 0!==e.extensions)for(let t in e.extensions)i.extensions[t]=e.extensions[t];if(void 0!==e.lights&&(i.lights=e.lights),void 0!==e.clipping&&(i.clipping=e.clipping),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=r(e.map)),void 0!==e.matcap&&(i.matcap=r(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=r(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=new nt().fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=r(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=r(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=r(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=r(e.envMap)),void 0!==e.envMapRotation&&i.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=r(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=r(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=r(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=new nt().fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(i.iridescenceMap=r(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(i.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(i.transmissionMap=r(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=r(e.thicknessMap)),void 0!==e.anisotropyMap&&(i.anisotropyMap=r(e.anisotropyMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=r(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=r(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return cw.createMaterialFromType(e)}static createMaterialFromType(e){return new({ShadowMaterial:uS,SpriteMaterial:sW,RawShaderMaterial:uw,ShaderMaterial:sT,PointsMaterial:lr,MeshPhysicalMaterial:uT,MeshStandardMaterial:uC,MeshPhongMaterial:uI,MeshToonMaterial:uM,MeshNormalMaterial:uR,MeshLambertMaterial:uB,MeshDepthMaterial:uD,MeshDistanceMaterial:uP,MeshBasicMaterial:aY,MeshMatcapMaterial:uL,LineDashedMaterial:uk,LineBasicMaterial:oJ,Material:aj})[e]}}class cC{static extractUrlBase(e){let t=e.lastIndexOf("/");return -1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e))?e:t+e}}class cT extends sl{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class cI extends u4{constructor(e){super(e)}load(e,t,r,i){let n=this,a=new u8(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(e,function(r){try{t(n.parse(JSON.parse(r)))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}},r,i)}parse(e){let t={},r={};function i(e,i){if(void 0!==t[i])return t[i];let n=e.interleavedBuffers[i],a=function(e,t){if(void 0!==r[t])return r[t];let i=new Uint32Array(e.arrayBuffers[t]).buffer;return r[t]=i,i}(e,n.buffer),s=new sH(nc(n.type,a),n.stride);return s.uuid=n.uuid,t[i]=s,s}let n=e.isInstancedBufferGeometry?new cT:new sl,a=e.data.index;if(void 0!==a){let e=nc(a.type,a.array);n.setIndex(new a1(e,1))}let s=e.data.attributes;for(let t in s){let r;let a=s[t];if(a.isInterleavedBufferAttribute)r=new sV(i(e.data,a.data),a.itemSize,a.offset,a.normalized);else{let e=nc(a.type,a.array);r=new(a.isInstancedBufferAttribute?op:a1)(e,a.itemSize,a.normalized)}void 0!==a.name&&(r.name=a.name),void 0!==a.usage&&r.setUsage(a.usage),n.setAttribute(t,r)}let o=e.data.morphAttributes;if(o)for(let t in o){let r=o[t],a=[];for(let t=0,n=r.length;t<n;t++){let n;let s=r[t];n=s.isInterleavedBufferAttribute?new sV(i(e.data,s.data),s.itemSize,s.offset,s.normalized):new a1(nc(s.type,s.array),s.itemSize,s.normalized),void 0!==s.name&&(n.name=s.name),a.push(n)}n.morphAttributes[t]=a}e.data.morphTargetsRelative&&(n.morphTargetsRelative=!0);let l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){let t=l[e];n.addGroup(t.start,t.count,t.materialIndex)}let u=e.data.boundingSphere;return void 0!==u&&(n.boundingSphere=new nJ().fromJSON(u)),e.name&&(n.name=e.name),e.userData&&(n.userData=e.userData),n}}class cM extends u4{constructor(e){super(e)}load(e,t,r,i){let n=this,a=""===this.path?cC.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;let s=new u8(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(r){let a=null;try{a=JSON.parse(r)}catch(t){void 0!==i&&i(t),console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message);return}let s=a.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase()){void 0!==i&&i(Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}n.parse(a,t)},r,i)}async loadAsync(e,t){let r=""===this.path?cC.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;let i=new u8(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);let n=JSON.parse(await i.loadAsync(e,t)),a=n.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(n)}parse(e,t){let r=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,function(){void 0!==t&&t(l)}),s=this.parseTextures(e.textures,a),o=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,n,o,s,r),u=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,u),this.bindLightTargets(l),void 0!==t){let e=!1;for(let t in a)if(a[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){let t=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),n=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,n),s=this.parseMaterials(e.materials,a),o=this.parseObject(e.object,i,s,a,t),l=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,l),this.bindLightTargets(o),o}parseShapes(e){let t={};if(void 0!==e)for(let r=0,i=e.length;r<i;r++){let i=new l$().fromJSON(e[r]);t[i.uuid]=i}return t}parseSkeletons(e,t){let r={},i={};if(t.traverse(function(e){e.isBone&&(i[e.uuid]=e)}),void 0!==e)for(let t=0,n=e.length;t<n;t++){let n=new of().fromJSON(e[t],i);r[n.uuid]=n}return r}parseGeometries(e,t){let r={};if(void 0!==e){let i=new cI;for(let n=0,a=e.length;n<a;n++){let a;let s=e[n];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(s);break;default:s.type in ub?a=ub[s.type].fromJSON(s,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${s.type}"`)}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.userData&&(a.userData=s.userData),r[s.uuid]=a}}return r}parseMaterials(e,t){let r={},i={};if(void 0!==e){let n=new cw;n.setTextures(t);for(let t=0,a=e.length;t<a;t++){let a=e[t];void 0===r[a.uuid]&&(r[a.uuid]=n.parse(a)),i[a.uuid]=r[a.uuid]}}return i}parseAnimations(e){let t={};if(void 0!==e)for(let r=0;r<e.length;r++){let i=e[r],n=u0.parse(i);t[n.uuid]=n}return t}parseImages(e,t){let r;let i=this,n={};function a(e){if("string"==typeof e){var t;return t=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e,i.manager.itemStart(t),r.load(t,function(){i.manager.itemEnd(t)},void 0,function(){i.manager.itemError(t),i.manager.itemEnd(t)})}return e.data?{data:nc(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){(r=new ct(new u2(t))).setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){let r=e[t],i=r.url;if(Array.isArray(i)){let e=[];for(let t=0,r=i.length;t<r;t++){let r=a(i[t]);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new oc(r.data,r.width,r.height)))}n[r.uuid]=new n_(e)}else{let e=a(r.url);n[r.uuid]=new n_(e)}}}return n}async parseImagesAsync(e){let t;let r=this,i={};async function n(e){if("string"==typeof e){let i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:r.resourcePath+e;return await t.loadAsync(i)}return e.data?{data:nc(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){(t=new ct(this.manager)).setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){let r=e[t],a=r.url;if(Array.isArray(a)){let e=[];for(let t=0,r=a.length;t<r;t++){let r=a[t],i=await n(r);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new oc(i.data,i.width,i.height)))}i[r.uuid]=new n_(e)}else{let e=await n(r.url);i[r.uuid]=new n_(e)}}}return i}parseTextures(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}let i={};if(void 0!==e)for(let n=0,a=e.length;n<a;n++){let a;let s=e[n];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);let o=t[s.image],l=o.data;Array.isArray(l)?(a=new sL,6===l.length&&(a.needsUpdate=!0)):(a=l&&l.data?new oc:new nC,l&&(a.needsUpdate=!0)),a.source=o,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=r(s.mapping,cR)),void 0!==s.channel&&(a.channel=s.channel),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=r(s.wrap[0],cB),a.wrapT=r(s.wrap[1],cB)),void 0!==s.format&&(a.format=s.format),void 0!==s.internalFormat&&(a.internalFormat=s.internalFormat),void 0!==s.type&&(a.type=s.type),void 0!==s.colorSpace&&(a.colorSpace=s.colorSpace),void 0!==s.minFilter&&(a.minFilter=r(s.minFilter,cD)),void 0!==s.magFilter&&(a.magFilter=r(s.magFilter,cD)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.generateMipmaps&&(a.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(a.compareFunction=s.compareFunction),void 0!==s.userData&&(a.userData=s.userData),i[s.uuid]=a}return i}parseObject(e,t,r,i,n){let a,s,o;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function u(e){if(void 0!==e){if(Array.isArray(e)){let t=[];for(let i=0,n=e.length;i<n;i++){let n=e[i];void 0===r[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),t.push(r[n])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}function c(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":a=new sG,void 0!==e.background&&(Number.isInteger(e.background)?a.background=new aQ(e.background):a.background=c(e.background)),void 0!==e.environment&&(a.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new sz(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new sN(e.fog.color,e.fog.density)),""!==e.fog.name&&(a.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(a.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(a.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&a.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(a.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new sD(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new cv(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new cx(e.color,e.intensity);break;case"DirectionalLight":(a=new cE(e.color,e.intensity)).target=e.target||"";break;case"PointLight":a=new cA(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new c_(e.color,e.intensity,e.width,e.height);break;case"SpotLight":(a=new cd(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay)).target=e.target||"";break;case"HemisphereLight":a=new cs(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new cS().fromJSON(e);break;case"SkinnedMesh":a=new ol(s=l(e.geometry),o=u(e.material)),void 0!==e.bindMode&&(a.bindMode=e.bindMode),void 0!==e.bindMatrix&&a.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(a.skeleton=e.skeleton);break;case"Mesh":a=new sE(s=l(e.geometry),o=u(e.material));break;case"InstancedMesh":s=l(e.geometry),o=u(e.material);let h=e.count,d=e.instanceMatrix,f=e.instanceColor;(a=new o_(s,o,h)).instanceMatrix=new op(new Float32Array(d.array),16),void 0!==f&&(a.instanceColor=new op(new Float32Array(f.array),f.itemSize));break;case"BatchedMesh":s=l(e.geometry),o=u(e.material),(a=new o$(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,o)).geometry=s,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(e=>{let t=null,r=null;return void 0!==e.boundingBox&&(t=new nL().fromJSON(e.boundingBox)),void 0!==e.boundingSphere&&(r=new nJ().fromJSON(e.boundingSphere)),{...e,boundingBox:t,boundingSphere:r}}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=c(e.matricesTexture.uuid),a._indirectTexture=c(e.indirectTexture.uuid),void 0!==e.colorsTexture&&(a._colorsTexture=c(e.colorsTexture.uuid)),void 0!==e.boundingSphere&&(a.boundingSphere=new nJ().fromJSON(e.boundingSphere)),void 0!==e.boundingBox&&(a.boundingBox=new nL().fromJSON(e.boundingBox));break;case"LOD":a=new s9;break;case"Line":a=new o6(l(e.geometry),u(e.material));break;case"LineLoop":a=new lt(l(e.geometry),u(e.material));break;case"LineSegments":a=new le(l(e.geometry),u(e.material));break;case"PointCloud":case"Points":a=new lo(l(e.geometry),u(e.material));break;case"Sprite":a=new s4(u(e.material));break;case"Group":a=new sF;break;case"Bone":a=new ou;break;default:a=new aS}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.up&&a.up.fromArray(e.up),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.intensity&&(a.shadow.intensity=e.shadow.intensity),void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(a.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children){let s=e.children;for(let e=0;e<s.length;e++)a.add(this.parseObject(s[e],t,r,i,n))}if(void 0!==e.animations){let t=e.animations;for(let e=0;e<t.length;e++){let r=t[e];a.animations.push(n[r])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate);let t=e.levels;for(let e=0;e<t.length;e++){let r=t[e],i=a.getObjectByProperty("uuid",r.object);void 0!==i&&a.addLevel(i,r.distance,r.hysteresis)}}return a}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){let r=t[e.skeleton];void 0===r?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(r,e.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){let r=t.target,i=e.getObjectByProperty("uuid",r);void 0!==i?t.target=i:t.target=new aS}})}}let cR={UVMapping:tN,CubeReflectionMapping:tz,CubeRefractionMapping:tG,EquirectangularReflectionMapping:tH,EquirectangularRefractionMapping:tQ,CubeUVReflectionMapping:tV},cB={RepeatWrapping:tW,ClampToEdgeWrapping:tj,MirroredRepeatWrapping:tY},cD={NearestFilter:tK,NearestMipmapNearestFilter:tq,NearestMipmapLinearFilter:t$,LinearFilter:tZ,LinearMipmapNearestFilter:t0,LinearMipmapLinearFilter:t2},cP=new WeakMap;class cL extends u4{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,a=u1.get(`image-bitmap:${e}`);if(void 0!==a){if(n.manager.itemStart(e),a.then){a.then(r=>{if(!0!==cP.has(a))return t&&t(r),n.manager.itemEnd(e),r;i&&i(cP.get(a)),n.manager.itemError(e),n.manager.itemEnd(e)});return}return setTimeout(function(){t&&t(a),n.manager.itemEnd(e)},0),a}let s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader,s.signal="function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;let o=fetch(e,s).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(r){return u1.add(`image-bitmap:${e}`,r),t&&t(r),n.manager.itemEnd(e),r}).catch(function(t){i&&i(t),cP.set(o,t),u1.remove(`image-bitmap:${e}`),n.manager.itemError(e),n.manager.itemEnd(e)});u1.add(`image-bitmap:${e}`,o),n.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class ck{static getContext(){return void 0===a&&(a=new(window.AudioContext||window.webkitAudioContext)),a}static setContext(e){a=e}}class cF extends u4{constructor(e){super(e)}load(e,t,r,i){let n=this,a=new u8(this.manager);function s(t){i?i(t):console.error(t),n.manager.itemError(e)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(e){try{let r=e.slice(0);ck.getContext().decodeAudioData(r,function(e){t(e)}).catch(s)}catch(e){s(e)}},r,i)}}let cO=new n8,cU=new n8,cN=new n8;class cz{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new sD,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new sD,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){let t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){let r,i;t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,cN.copy(e.projectionMatrix);let n=t.eyeSep/2,a=n*t.near/t.focus,s=t.near*Math.tan(i2*t.fov*.5)/t.zoom;cU.elements[12]=-n,cO.elements[12]=n,r=-s*t.aspect+a,i=s*t.aspect+a,cN.elements[0]=2*t.near/(i-r),cN.elements[8]=(i+r)/(i-r),this.cameraL.projectionMatrix.copy(cN),r=-s*t.aspect-a,i=s*t.aspect-a,cN.elements[0]=2*t.near/(i-r),cN.elements[8]=(i+r)/(i-r),this.cameraR.projectionMatrix.copy(cN)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(cU),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(cO)}}class cG extends sD{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class cH{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}let cQ=new ni,cV=new nr,cW=new ni,cj=new ni,cY=new ni;class cK extends aS{constructor(){super(),this.type="AudioListener",this.context=ck.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new cH}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);let t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(cQ,cV,cW),cj.set(0,0,-1).applyQuaternion(cV),cY.set(0,1,0).applyQuaternion(cV),t.positionX){let e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(cQ.x,e),t.positionY.linearRampToValueAtTime(cQ.y,e),t.positionZ.linearRampToValueAtTime(cQ.z,e),t.forwardX.linearRampToValueAtTime(cj.x,e),t.forwardY.linearRampToValueAtTime(cj.y,e),t.forwardZ.linearRampToValueAtTime(cj.z,e),t.upX.linearRampToValueAtTime(cY.x,e),t.upY.linearRampToValueAtTime(cY.y,e),t.upZ.linearRampToValueAtTime(cY.z,e)}else t.setPosition(cQ.x,cQ.y,cQ.z),t.setOrientation(cj.x,cj.y,cj.z,cY.x,cY.y,cY.z)}}class cq extends aS{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying){console.warn("THREE.Audio: Audio is already playing.");return}if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return(super.copy(e,t),"buffer"!==e.sourceType)?console.warn("THREE.Audio: Audio source type cannot be copied."):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice()),this}clone(e){return new this.constructor(this.listener).copy(this,e)}}let cX=new ni,c$=new nr,cJ=new ni,cZ=new ni;class c0 extends cq{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(cX,c$,cJ),cZ.set(0,0,1).applyQuaternion(c$);let t=this.panner;if(t.positionX){let e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(cX.x,e),t.positionY.linearRampToValueAtTime(cX.y,e),t.positionZ.linearRampToValueAtTime(cX.z,e),t.orientationX.linearRampToValueAtTime(cZ.x,e),t.orientationY.linearRampToValueAtTime(cZ.y,e),t.orientationZ.linearRampToValueAtTime(cZ.z,e)}else t.setPosition(cX.x,cX.y,cX.z),t.setOrientation(cZ.x,cZ.y,cZ.z)}}class c1{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,t=this.getFrequencyData();for(let r=0;r<t.length;r++)e+=t[r];return e/t.length}}class c2{constructor(e,t,r){let i,n,a;switch(this.binding=e,this.valueSize=r,t){case"quaternion":i=this._slerp,n=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":i=this._select,n=this._select,a=this._setAdditiveIdentityOther,this.buffer=Array(5*r);break;default:i=this._lerp,n=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=n,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let r=this.buffer,i=this.valueSize,n=e*i+i,a=this.cumulativeWeight;if(0===a){for(let e=0;e!==i;++e)r[n+e]=r[e];a=t}else{a+=t;let e=t/a;this._mixBufferRegion(r,n,0,e,i)}this.cumulativeWeight=a}accumulateAdditive(e){let t=this.buffer,r=this.valueSize,i=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,r=this.buffer,i=e*t+t,n=this.cumulativeWeight,a=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let e=t*this._origIndex;this._mixBufferRegion(r,i,e,1-n,t)}a>0&&this._mixBufferRegionAdditive(r,i,this._addIndex*t,1,t);for(let e=t,n=t+t;e!==n;++e)if(r[e]!==r[e+t]){s.setValue(r,i);break}}saveOriginalState(){let e=this.binding,t=this.buffer,r=this.valueSize,i=r*this._origIndex;e.getValue(t,i);for(let e=r;e!==i;++e)t[e]=t[i+e%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,i,n){if(i>=.5)for(let i=0;i!==n;++i)e[t+i]=e[r+i]}_slerp(e,t,r,i){nr.slerpFlat(e,t,e,t,e,r,i)}_slerpAdditive(e,t,r,i,n){let a=this._workIndex*n;nr.multiplyQuaternionsFlat(e,a,e,t,e,r),nr.slerpFlat(e,t,e,t,e,a,i)}_lerp(e,t,r,i,n){let a=1-i;for(let s=0;s!==n;++s){let n=t+s;e[n]=e[n]*a+e[r+s]*i}}_lerpAdditive(e,t,r,i,n){for(let a=0;a!==n;++a){let n=t+a;e[n]=e[n]+e[r+a]*i}}}let c3="\\[\\]\\.:\\/",c4=RegExp("["+c3+"]","g"),c5="[^"+c3+"]",c6="[^"+c3.replace("\\.","")+"]",c8=/((?:WC+[\/:])*)/.source.replace("WC",c5),c9=RegExp("^"+c8+/(WCOD+)?/.source.replace("WCOD",c6)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",c5)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",c5)+"$"),c7=["material","materials","bones","map"];class he{constructor(e,t,r){let i=r||ht.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();let r=this._targetGroup.nCachedObjects_,i=this._bindings[r];void 0!==i&&i.getValue(e,t)}setValue(e,t){let r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}class ht{constructor(e,t,r){this.path=t,this.parsedPath=r||ht.parseTrackName(t),this.node=ht.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new ht.Composite(e,t,r):new ht(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(c4,"")}static parseTrackName(e){let t=c9.exec(e);if(null===t)throw Error("PropertyBinding: Cannot parse trackName: "+e);let r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){let e=r.nodeName.substring(i+1);-1!==c7.indexOf(e)&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=e)}if(null===r.propertyName||0===r.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){let r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){let r=function(e){for(let i=0;i<e.length;i++){let n=e[i];if(n.name===t||n.uuid===t)return n;let a=r(n.children);if(a)return a}return null},i=r(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)e[t++]=r[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)r[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,r=t.objectName,i=t.propertyName,n=t.propertyIndex;if(e||(e=ht.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let i=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(void 0===e[r]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(void 0!==i){if(void 0===e[i]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[i]}}let a=e[i];if(void 0===a){console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+i+" but it wasn't found.",e);return}let s=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?s=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(s=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===i){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}void 0!==e.morphTargetDictionary[n]&&(n=e.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=n}else void 0!==a.fromArray&&void 0!==a.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ht.Composite=he,ht.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ht.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ht.prototype.GetterByBindingType=[ht.prototype._getValue_direct,ht.prototype._getValue_array,ht.prototype._getValue_arrayElement,ht.prototype._getValue_toArray],ht.prototype.SetterByBindingTypeAndVersioning=[[ht.prototype._setValue_direct,ht.prototype._setValue_direct_setNeedsUpdate,ht.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ht.prototype._setValue_array,ht.prototype._setValue_array_setNeedsUpdate,ht.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ht.prototype._setValue_arrayElement,ht.prototype._setValue_arrayElement_setNeedsUpdate,ht.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ht.prototype._setValue_fromArray,ht.prototype._setValue_fromArray_setNeedsUpdate,ht.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class hr{constructor(){this.isAnimationObjectGroup=!0,this.uuid=i4(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){let e=this._objects,t=this._indicesByUUID,r=this._paths,i=this._parsedPaths,n=this._bindings,a=n.length,s,o=e.length,l=this.nCachedObjects_;for(let u=0,c=arguments.length;u!==c;++u){let c=arguments[u],h=c.uuid,d=t[h];if(void 0===d){d=o++,t[h]=d,e.push(c);for(let e=0;e!==a;++e)n[e].push(new ht(c,r[e],i[e]))}else if(d<l){s=e[d];let o=--l,u=e[o];t[u.uuid]=d,e[d]=u,t[h]=o,e[o]=c;for(let e=0;e!==a;++e){let t=n[e],a=t[o],s=t[d];t[d]=a,void 0===s&&(s=new ht(c,r[e],i[e])),t[o]=s}}else e[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){let e=this._objects,t=this._indicesByUUID,r=this._bindings,i=r.length,n=this.nCachedObjects_;for(let a=0,s=arguments.length;a!==s;++a){let s=arguments[a],o=s.uuid,l=t[o];if(void 0!==l&&l>=n){let a=n++,u=e[a];t[u.uuid]=l,e[l]=u,t[o]=a,e[a]=s;for(let e=0;e!==i;++e){let t=r[e],i=t[a],n=t[l];t[l]=i,t[a]=n}}}this.nCachedObjects_=n}uncache(){let e=this._objects,t=this._indicesByUUID,r=this._bindings,i=r.length,n=this.nCachedObjects_,a=e.length;for(let s=0,o=arguments.length;s!==o;++s){let o=arguments[s],l=o.uuid,u=t[l];if(void 0!==u){if(delete t[l],u<n){let s=--n,o=e[s],l=--a,c=e[l];t[o.uuid]=u,e[u]=o,t[c.uuid]=s,e[s]=c,e.pop();for(let e=0;e!==i;++e){let t=r[e],i=t[s],n=t[l];t[u]=i,t[s]=n,t.pop()}}else{let n=--a,s=e[n];n>0&&(t[s.uuid]=u),e[u]=s,e.pop();for(let e=0;e!==i;++e){let t=r[e];t[u]=t[n],t.pop()}}}}this.nCachedObjects_=n}subscribe_(e,t){let r=this._bindingsIndicesByPath,i=r[e],n=this._bindings;if(void 0!==i)return n[i];let a=this._paths,s=this._parsedPaths,o=this._objects,l=o.length,u=this.nCachedObjects_,c=Array(l);i=n.length,r[e]=i,a.push(e),s.push(t),n.push(c);for(let r=u,i=o.length;r!==i;++r){let i=o[r];c[r]=new ht(i,e,t)}return c}unsubscribe_(e){let t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){let i=this._paths,n=this._parsedPaths,a=this._bindings,s=a.length-1,o=a[s];t[e[s]]=r,a[r]=o,a.pop(),n[r]=n[s],n.pop(),i[r]=i[s],i.pop()}}}class hi{constructor(e,t,r=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=i;let n=t.tracks,a=n.length,s=Array(a),o={endingStart:r2,endingEnd:r2};for(let e=0;e!==a;++e){let t=n[e].createInterpolant(null);s[e]=t,t.settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=r$,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r=!1){if(e.fadeOut(t),this.fadeIn(t),!0===r){let r=this._clip.duration,i=e._clip.duration;e.warp(1,i/r,t),this.warp(r/i,1,t)}return this}crossFadeTo(e,t,r=!1){return e.crossFadeFrom(this,t,r)}stopFading(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){let i=this._mixer,n=i.time,a=this.timeScale,s=this._timeScaleInterpolant;null===s&&(s=i._lendControlInterpolant(),this._timeScaleInterpolant=s);let o=s.parameterPositions,l=s.sampleValues;return o[0]=n,o[1]=n+r,l[0]=e/a,l[1]=t/a,this}stopWarping(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,i){if(!this.enabled){this._updateWeight(e);return}let n=this._startTime;if(null!==n){let i=(e-n)*r;i<0||0===r?t=0:(this._startTime=null,t=r*i)}t*=this._updateTimeScale(e);let a=this._updateTime(t),s=this._updateWeight(e);if(s>0){let e=this._interpolants,t=this._propertyBindings;if(this.blendMode===r6)for(let r=0,i=e.length;r!==i;++r)e[r].evaluate(a),t[r].accumulateAdditive(s);else for(let r=0,n=e.length;r!==n;++r)e[r].evaluate(a),t[r].accumulate(i,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let r=this._weightInterpolant;if(null!==r){let i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let r=this._timeScaleInterpolant;null!==r&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,r=this.loop,i=this.time+e,n=this._loopCount,a=r===rJ;if(0===e)return -1===n?i:a&&(1&n)==1?t-i:i;if(r===rX){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));n:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break n}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=t||i<0){let r=Math.floor(i/t);i-=t*r,n+=Math.abs(r);let s=this.repetitions-n;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){let t=e<0;this._setEndings(t,!t,a)}else this._setEndings(!1,!1,a);this._loopCount=n,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=i;if(a&&(1&n)==1)return t-i}return i}_setEndings(e,t,r){let i=this._interpolantSettings;r?(i.endingStart=r3,i.endingEnd=r3):(e?i.endingStart=this.zeroSlopeAtStart?r3:r2:i.endingStart=r4,t?i.endingEnd=this.zeroSlopeAtEnd?r3:r2:i.endingEnd=r4)}_scheduleFading(e,t,r){let i=this._mixer,n=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);let s=a.parameterPositions,o=a.sampleValues;return s[0]=n,o[0]=t,s[1]=n+e,o[1]=r,this}}let hn=new Float32Array(1);class ha extends iZ{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let r=e._localRoot||this._root,i=e._clip.tracks,n=i.length,a=e._propertyBindings,s=e._interpolants,o=r.uuid,l=this._bindingsByRootAndName,u=l[o];void 0===u&&(u={},l[o]=u);for(let e=0;e!==n;++e){let n=i[e],l=n.name,c=u[l];if(void 0!==c)++c.referenceCount,a[e]=c;else{if(void 0!==(c=a[e])){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,o,l));continue}let i=t&&t._propertyBindings[e].binding.parsedPath;c=new c2(ht.create(r,l,i),n.ValueTypeName,n.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,o,l),a[e]=c}s[e].resultBuffer=c.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){let t=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t)}let t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){let r=t[e];0==r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){let r=t[e];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,r){let i=this._actions,n=this._actionsByClip,a=n[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=a;else{let t=a.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){let t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;let n=e._clip.uuid,a=this._actionsByClip,s=a[n],o=s.knownActions,l=o[o.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,o[u]=l,o.pop(),e._byClipCacheIndex=null;let c=s.actionByRoot,h=(e._localRoot||this._root).uuid;delete c[h],0===o.length&&delete a[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){let r=t[e];0==--r.referenceCount&&this._removeInactiveBinding(r)}}_lendAction(e){let t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_takeBackAction(e){let t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_addInactiveBinding(e,t,r){let i=this._bindingsByRootAndName,n=this._bindings,a=i[t];void 0===a&&(a={},i[t]=a),a[r]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){let t=this._bindings,r=e.binding,i=r.rootNode.uuid,n=r.path,a=this._bindingsByRootAndName,s=a[i],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete s[n],0===Object.keys(s).length&&delete a[i]}_lendBinding(e){let t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_takeBackBinding(e){let t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new uV(new Float32Array(2),new Float32Array(2),1,hn)).__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){let t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,n=t[i];e.__cacheIndex=i,t[i]=e,n.__cacheIndex=r,t[r]=n}clipAction(e,t,r){let i=t||this._root,n=i.uuid,a="string"==typeof e?u0.findByName(i,e):e,s=null!==a?a.uuid:e,o=this._actionsByClip[s],l=null;if(void 0===r&&(r=null!==a?a.blendMode:r5),void 0!==o){let e=o.actionByRoot[n];if(void 0!==e&&e.blendMode===r)return e;l=o.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;let u=new hi(this,a,t,r);return this._bindAction(u,l),this._addInactiveAction(u,s,n),u}existingAction(e,t){let r=t||this._root,i=r.uuid,n="string"==typeof e?u0.findByName(r,e):e,a=n?n.uuid:e,s=this._actionsByClip[a];return void 0!==s&&s.actionByRoot[i]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let r=t-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;let t=this._actions,r=this._nActiveActions,i=this.time+=e,n=Math.sign(e),a=this._accuIndex^=1;for(let s=0;s!==r;++s)t[s]._update(i,e,n,a);let s=this._bindings,o=this._nActiveBindings;for(let e=0;e!==o;++e)s[e].apply(a);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,r=e.uuid,i=this._actionsByClip,n=i[r];if(void 0!==n){let e=n.knownActions;for(let r=0,i=e.length;r!==i;++r){let i=e[r];this._deactivateAction(i);let n=i._cacheIndex,a=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,a._cacheIndex=n,t[n]=a,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[r]}}uncacheRoot(e){let t=e.uuid,r=this._actionsByClip;for(let e in r){let i=r[e].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}let i=this._bindingsByRootAndName[t];if(void 0!==i)for(let e in i){let t=i[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){let r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class hs extends nI{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isRenderTarget3D=!0,this.depth=r,this.texture=new nD(null,e,t,r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class ho{constructor(e){this.value=e}clone(){return new ho(void 0===this.value.clone?this.value:this.value.clone())}}let hl=0;class hu extends iZ{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:hl++}),this.name="",this.usage=iO,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){let t=this.uniforms.indexOf(e);return -1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;let t=e.uniforms;this.uniforms.length=0;for(let e=0,r=t.length;e<r;e++){let r=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0;e<r.length;e++)this.uniforms.push(r[e].clone())}return this}clone(){return new this.constructor().copy(this)}}class hc extends sH{constructor(e,t,r=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class hh{constructor(e,t,r,i,n,a=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=i,this.count=n,this.normalized=a,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}let hd=new n8;class hf{constructor(e,t,r=0,i=1/0){this.ray=new n6(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new al,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return hd.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(hd),this}intersectObject(e,t=!0,r=[]){return hm(e,this,r,t),r.sort(hp),r}intersectObjects(e,t=!0,r=[]){for(let i=0,n=e.length;i<n;i++)hm(e[i],this,r,t);return r.sort(hp),r}}function hp(e,t){return e.distance-t.distance}function hm(e,t,r,i){let n=!0;if(e.layers.test(t.layers)&&!1===e.raycast(t,r)&&(n=!1),!0===n&&!0===i){let i=e.children;for(let e=0,n=i.length;e<n;e++)hm(i[e],t,r,!0)}}class hg{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,void 0!==e.hidden&&(this._pageVisibilityHandler=hA.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){null!==this._pageVisibilityHandler&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return null!==this._pageVisibilityHandler&&!0===this._document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==e?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function hA(){!1===this._document.hidden&&this.reset()}class hv{constructor(e=1,t=0,r=0){this.radius=e,this.phi=t,this.theta=r}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=i5(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(i5(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class hy{constructor(e=1,t=0,r=0){this.radius=e,this.theta=t,this.y=r}set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}clone(){return new this.constructor().copy(this)}}class hE{constructor(e,t,r,i){hE.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,r,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let r=0;r<4;r++)this.elements[r]=e[r+t];return this}set(e,t,r,i){let n=this.elements;return n[0]=e,n[2]=t,n[1]=r,n[3]=i,this}}let hx=new nt;class h_{constructor(e=new nt(Infinity,Infinity),t=new nt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let r=hx.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,hx).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}let hb=new ni,hS=new ni,hw=new ni,hC=new ni,hT=new ni,hI=new ni,hM=new ni;class hR{constructor(e=new ni,t=new ni){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){hb.subVectors(e,this.start),hS.subVectors(this.end,this.start);let r=hS.dot(hS),i=hS.dot(hb)/r;return t&&(i=i5(i,0,1)),i}closestPointToPoint(e,t,r){let i=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(i).add(this.start)}distanceSqToLine3(e,t=hI,r=hM){let i,n;let a=1e-8*1e-8,s=this.start,o=e.start,l=this.end,u=e.end;hw.subVectors(l,s),hC.subVectors(u,o),hT.subVectors(s,o);let c=hw.dot(hw),h=hC.dot(hC),d=hC.dot(hT);if(c<=a&&h<=a)return t.copy(s),r.copy(o),t.sub(r),t.dot(t);if(c<=a)i=0,n=i5(n=d/h,0,1);else{let e=hw.dot(hT);if(h<=a)n=0,i=i5(-e/c,0,1);else{let t=hw.dot(hC),r=c*h-t*t;i=0!==r?i5((t*d-e*h)/r,0,1):0,(n=(t*i+d)/h)<0?(n=0,i=i5(-e/c,0,1)):n>1&&(n=1,i=i5((t-e)/c,0,1))}}return t.copy(s).add(hw.multiplyScalar(i)),r.copy(o).add(hC.multiplyScalar(n)),t.sub(r),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}let hB=new ni;class hD extends aS{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let r=new sl,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1;e<32;e++,t++){let r=e/32*Math.PI*2,n=t/32*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(n),Math.sin(n),1)}r.setAttribute("position",new se(i,3));let n=new oJ({fog:!1,toneMapped:!1});this.cone=new le(r,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),hB.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(hB),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}let hP=new ni,hL=new n8,hk=new n8;class hF extends le{constructor(e){let t=function e(t){let r=[];!0===t.isBone&&r.push(t);for(let i=0;i<t.children.length;i++)r.push(...e(t.children[i]));return r}(e),r=new sl,i=[],n=[];for(let e=0;e<t.length;e++){let r=t[e];r.parent&&r.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(0,0,0),n.push(0,0,0))}r.setAttribute("position",new se(i,3)),r.setAttribute("color",new se(n,3)),super(r,new oJ({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;let a=new aQ(255),s=new aQ(65280);this.setColors(a,s)}updateMatrixWorld(e){let t=this.bones,r=this.geometry,i=r.getAttribute("position");hk.copy(this.root.matrixWorld).invert();for(let e=0,r=0;e<t.length;e++){let n=t[e];n.parent&&n.parent.isBone&&(hL.multiplyMatrices(hk,n.matrixWorld),hP.setFromMatrixPosition(hL),i.setXYZ(r,hP.x,hP.y,hP.z),hL.multiplyMatrices(hk,n.parent.matrixWorld),hP.setFromMatrixPosition(hL),i.setXYZ(r+1,hP.x,hP.y,hP.z),r+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){let r=this.geometry.getAttribute("color");for(let i=0;i<r.count;i+=2)r.setXYZ(i,e.r,e.g,e.b),r.setXYZ(i+1,t.r,t.g,t.b);return r.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class hO extends sE{constructor(e,t,r){super(new ug(t,4,2),new aY({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}let hU=new ni,hN=new aQ,hz=new aQ;class hG extends aS{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";let i=new ud(t);i.rotateY(.5*Math.PI),this.material=new aY({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);let n=new Float32Array(3*i.getAttribute("position").count);i.setAttribute("color",new a1(n,3)),this.add(new sE(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){let e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{let t=e.geometry.getAttribute("color");hN.copy(this.light.color),hz.copy(this.light.groundColor);for(let e=0,r=t.count;e<r;e++){let i=e<r/2?hN:hz;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(hU.setFromMatrixPosition(this.light.matrixWorld).negate())}}class hH extends le{constructor(e=10,t=10,r=4473924,i=8947848){r=new aQ(r),i=new aQ(i);let n=t/2,a=e/t,s=e/2,o=[],l=[];for(let e=0,u=0,c=-s;e<=t;e++,c+=a){o.push(-s,0,c,s,0,c),o.push(c,0,-s,c,0,s);let t=e===n?r:i;t.toArray(l,u),u+=3,t.toArray(l,u),u+=3,t.toArray(l,u),u+=3,t.toArray(l,u),u+=3}let u=new sl;u.setAttribute("position",new se(o,3)),u.setAttribute("color",new se(l,3)),super(u,new oJ({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class hQ extends le{constructor(e=10,t=16,r=8,i=64,n=4473924,a=8947848){n=new aQ(n),a=new aQ(a);let s=[],o=[];if(t>1)for(let r=0;r<t;r++){let i=r/t*(2*Math.PI),l=Math.sin(i)*e,u=Math.cos(i)*e;s.push(0,0,0),s.push(l,0,u);let c=1&r?n:a;o.push(c.r,c.g,c.b),o.push(c.r,c.g,c.b)}for(let t=0;t<r;t++){let l=1&t?n:a,u=e-e/r*t;for(let e=0;e<i;e++){let t=e/i*(2*Math.PI),r=Math.sin(t)*u,n=Math.cos(t)*u;s.push(r,0,n),o.push(l.r,l.g,l.b),r=Math.sin(t=(e+1)/i*(2*Math.PI))*u,n=Math.cos(t)*u,s.push(r,0,n),o.push(l.r,l.g,l.b)}}let l=new sl;l.setAttribute("position",new se(s,3)),l.setAttribute("color",new se(o,3)),super(l,new oJ({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}let hV=new ni,hW=new ni,hj=new ni;class hY extends aS{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",void 0===t&&(t=1);let i=new sl;i.setAttribute("position",new se([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new oJ({fog:!1,toneMapped:!1});this.lightPlane=new o6(i,n),this.add(this.lightPlane),(i=new sl).setAttribute("position",new se([0,0,0,0,0,1],3)),this.targetLine=new o6(i,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),hV.setFromMatrixPosition(this.light.matrixWorld),hW.setFromMatrixPosition(this.light.target.matrixWorld),hj.subVectors(hW,hV),this.lightPlane.lookAt(hW),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(hW),this.targetLine.scale.z=hj.length()}}let hK=new ni,hq=new sI;class hX extends le{constructor(e){let t=new sl,r=new oJ({color:0xffffff,vertexColors:!0,toneMapped:!1}),i=[],n=[],a={};function s(e,t){o(e),o(t)}function o(e){i.push(0,0,0),n.push(0,0,0),void 0===a[e]&&(a[e]=[]),a[e].push(i.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new se(i,3)),t.setAttribute("color",new se(n,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();let l=new aQ(0xffaa00),u=new aQ(0xff0000),c=new aQ(43775),h=new aQ(0xffffff),d=new aQ(3355443);this.setColors(l,u,c,h,d)}setColors(e,t,r,i,n){let a=this.geometry.getAttribute("color");return a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,r.r,r.g,r.b),a.setXYZ(33,r.r,r.g,r.b),a.setXYZ(34,r.r,r.g,r.b),a.setXYZ(35,r.r,r.g,r.b),a.setXYZ(36,r.r,r.g,r.b),a.setXYZ(37,r.r,r.g,r.b),a.setXYZ(38,i.r,i.g,i.b),a.setXYZ(39,i.r,i.g,i.b),a.setXYZ(40,n.r,n.g,n.b),a.setXYZ(41,n.r,n.g,n.b),a.setXYZ(42,n.r,n.g,n.b),a.setXYZ(43,n.r,n.g,n.b),a.setXYZ(44,n.r,n.g,n.b),a.setXYZ(45,n.r,n.g,n.b),a.setXYZ(46,n.r,n.g,n.b),a.setXYZ(47,n.r,n.g,n.b),a.setXYZ(48,n.r,n.g,n.b),a.setXYZ(49,n.r,n.g,n.b),a.needsUpdate=!0,this}update(){let e,t;let r=this.geometry,i=this.pointMap;if(hq.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),!0===this.camera.reversedDepth)e=1,t=0;else if(this.camera.coordinateSystem===iK)e=-1,t=1;else if(this.camera.coordinateSystem===iq)e=0,t=1;else throw Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);h$("c",i,r,hq,0,0,e),h$("t",i,r,hq,0,0,t),h$("n1",i,r,hq,-1,-1,e),h$("n2",i,r,hq,1,-1,e),h$("n3",i,r,hq,-1,1,e),h$("n4",i,r,hq,1,1,e),h$("f1",i,r,hq,-1,-1,t),h$("f2",i,r,hq,1,-1,t),h$("f3",i,r,hq,-1,1,t),h$("f4",i,r,hq,1,1,t),h$("u1",i,r,hq,.7,1.1,e),h$("u2",i,r,hq,-.7,1.1,e),h$("u3",i,r,hq,0,2,e),h$("cf1",i,r,hq,-1,0,t),h$("cf2",i,r,hq,1,0,t),h$("cf3",i,r,hq,0,-1,t),h$("cf4",i,r,hq,0,1,t),h$("cn1",i,r,hq,-1,0,e),h$("cn2",i,r,hq,1,0,e),h$("cn3",i,r,hq,0,-1,e),h$("cn4",i,r,hq,0,1,e),r.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function h$(e,t,r,i,n,a,s){hK.set(n,a,s).unproject(i);let o=t[e];if(void 0!==o){let e=r.getAttribute("position");for(let t=0,r=o.length;t<r;t++)e.setXYZ(o[t],hK.x,hK.y,hK.z)}}let hJ=new nL;class hZ extends le{constructor(e,t=0xffff00){let r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),n=new sl;n.setIndex(new a1(r,1)),n.setAttribute("position",new a1(i,3)),super(n,new oJ({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&hJ.setFromObject(this.object),hJ.isEmpty())return;let e=hJ.min,t=hJ.max,r=this.geometry.attributes.position,i=r.array;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=e.x,i[4]=t.y,i[5]=t.z,i[6]=e.x,i[7]=e.y,i[8]=t.z,i[9]=t.x,i[10]=e.y,i[11]=t.z,i[12]=t.x,i[13]=t.y,i[14]=e.z,i[15]=e.x,i[16]=t.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=t.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class h0 extends le{constructor(e,t=0xffff00){let r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new sl;i.setIndex(new a1(r,1)),i.setAttribute("position",new se([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new oJ({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class h1 extends o6{constructor(e,t=1,r=0xffff00){let i=new sl;i.setAttribute("position",new se([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new oJ({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;let n=new sl;n.setAttribute("position",new se([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new sE(n,new aY({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}let h2=new ni;class h3 extends aS{constructor(e=new ni(0,0,1),t=new ni(0,0,0),r=1,i=0xffff00,n=.2*r,a=.2*n){super(),this.type="ArrowHelper",void 0===s&&((s=new sl).setAttribute("position",new se([0,0,0,0,1,0],3)),(o=new lx(.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new o6(s,new oJ({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new sE(o,new aY({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,n,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{h2.set(e.z,0,-e.x).normalize();let t=Math.acos(e.y);this.quaternion.setFromAxisAngle(h2,t)}}setLength(e,t=.2*e,r=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class h4 extends le{constructor(e=1){let t=new sl;t.setAttribute("position",new se([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],3)),t.setAttribute("color",new se([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(t,new oJ({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,r){let i=new aQ,n=this.geometry.attributes.color.array;return i.set(e),i.toArray(n,0),i.toArray(n,3),i.set(t),i.toArray(n,6),i.toArray(n,9),i.set(r),i.toArray(n,12),i.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class h5{constructor(){this.type="ShapePath",this.color=new aQ,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new lX,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,i){return this.currentPath.quadraticCurveTo(e,t,r,i),this}bezierCurveTo(e,t,r,i,n,a){return this.currentPath.bezierCurveTo(e,t,r,i,n,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){let t,r,i,n,a;let s=ua.isClockWise,o=this.subPaths;if(0===o.length)return[];let l=[];if(1===o.length)return r=o[0],(i=new l$).curves=r.curves,l.push(i),l;let u=!s(o[0].getPoints());u=e?!u:u;let c=[],h=[],d=[],f=0;h[0]=void 0,d[f]=[];for(let i=0,a=o.length;i<a;i++)t=s(n=(r=o[i]).getPoints()),(t=e?!t:t)?(!u&&h[f]&&f++,h[f]={s:new l$,p:n},h[f].s.curves=r.curves,u&&f++,d[f]=[]):d[f].push({h:r,p:n[0]});if(!h[0])return function(e){let t=[];for(let r=0,i=e.length;r<i;r++){let i=e[r],n=new l$;n.curves=i.curves,t.push(n)}return t}(o);if(h.length>1){let e=!1,t=0;for(let e=0,t=h.length;e<t;e++)c[e]=[];for(let r=0,i=h.length;r<i;r++){let i=d[r];for(let n=0;n<i.length;n++){let a=i[n],s=!0;for(let i=0;i<h.length;i++)(function(e,t){let r=t.length,i=!1;for(let n=r-1,a=0;a<r;n=a++){let r=t[n],s=t[a],o=s.x-r.x,l=s.y-r.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(r=t[a],o=-o,s=t[n],l=-l),e.y<r.y||e.y>s.y)continue;if(e.y===r.y){if(e.x===r.x)return!0}else{let t=l*(e.x-r.x)-o*(e.y-r.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==r.y)continue;if(s.x<=e.x&&e.x<=r.x||r.x<=e.x&&e.x<=s.x)return!0}}return i})(a.p,h[i].p)&&(r!==i&&t++,s?(s=!1,c[i].push(a)):e=!0);s&&c[r].push(a)}}t>0&&!1===e&&(d=c)}for(let e=0,t=h.length;e<t;e++){i=h[e].s,l.push(i),a=d[e];for(let e=0,t=a.length;e<t;e++)i.holes.push(a[e].h)}return l}}class h6 extends iZ{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(void 0===e){console.warn("THREE.Controls: connect() now requires an element.");return}null!==this.domElement&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function h8(e,t,r,i){let n=function(e){switch(e){case t4:case t5:return{byteLength:1,components:1};case t8:case t6:case rt:return{byteLength:2,components:1};case rr:case ri:return{byteLength:2,components:4};case t7:case t9:case re:return{byteLength:4,components:1};case ra:case rs:return{byteLength:4,components:3}}throw Error(`Unknown texture type ${e}.`)}(i);switch(r){case ro:return e*t;case rd:case rf:return e*t/n.components*n.byteLength;case rp:case rm:return e*t*2/n.components*n.byteLength;case rl:return e*t*3/n.components*n.byteLength;case ru:case rA:return e*t*4/n.components*n.byteLength;case rv:case ry:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case rE:case rx:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case rb:case rw:return Math.max(e,16)*Math.max(t,8)/4;case r_:case rS:return Math.max(e,8)*Math.max(t,8)/2;case rC:case rT:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case rI:case rM:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case rR:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case rB:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case rD:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case rP:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case rL:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case rk:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case rF:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case rO:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case rU:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case rN:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case rz:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case rG:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case rH:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case rQ:case rV:case rW:return Math.ceil(e/4)*Math.ceil(t/4)*16;case rj:case rY:return Math.ceil(e/4)*Math.ceil(t/4)*8;case rK:case rq:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw Error(`Unable to determine texture byte length for ${r} format.`)}class h9{static contain(e,t){return function(e,t){let r=e.image&&e.image.width?e.image.width/e.image.height:1;return r>t?(e.repeat.x=1,e.repeat.y=r/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/r,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e}(e,t)}static cover(e,t){return function(e,t){let r=e.image&&e.image.width?e.image.width/e.image.height:1;return r>t?(e.repeat.x=t/r,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=r/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e}(e,t)}static fill(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e}static getByteLength(e,t,r,i){return h8(e,t,r,i)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:eH}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=eH);var h7=r(95944);let de="undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?eN.useEffect:eN.useLayoutEffect,dt=e=>"object"==typeof e&&"function"==typeof e.then,dr=[];function di(e,t,r=(e,t)=>e===t){if(e===t)return!0;if(!e||!t)return!1;let i=e.length;if(t.length!==i)return!1;for(let n=0;n<i;n++)if(!r(e[n],t[n]))return!1;return!0}function dn(e,t=null,r=!1,i={}){for(let n of(null===t&&(t=[e]),dr))if(di(t,n.keys,n.equal)){if(r)return;if(Object.prototype.hasOwnProperty.call(n,"error"))throw n.error;if(Object.prototype.hasOwnProperty.call(n,"response"))return i.lifespan&&i.lifespan>0&&(n.timeout&&clearTimeout(n.timeout),n.timeout=setTimeout(n.remove,i.lifespan)),n.response;if(!r)throw n.promise}let n={keys:t,equal:i.equal,remove:()=>{let e=dr.indexOf(n);-1!==e&&dr.splice(e,1)},promise:(dt(e)?e:e(...t)).then(e=>{n.response=e,i.lifespan&&i.lifespan>0&&(n.timeout=setTimeout(n.remove,i.lifespan))}).catch(e=>n.error=e)};if(dr.push(n),!r)throw n.promise}let da=(e,t,r)=>dn(e,t,!1,r),ds=(e,t,r)=>void dn(e,t,!0,r),dl=e=>{if(void 0===e||0===e.length)dr.splice(0,dr.length);else{let t=dr.find(t=>di(e,t.keys,t.equal));t&&t.remove()}};var du=r(45512),dc=r(49145),dh=r.n(dc),dd=r(43063);let df={},dp=e=>void Object.assign(df,e),dm=e=>"colorSpace"in e||"outputColorSpace"in e,dg=()=>{var e;return null!=(e=df.ColorManagement)?e:null},dA=e=>e&&e.isOrthographicCamera,dv="undefined"!=typeof window&&(null!=(ei=window.document)&&ei.createElement||(null==(en=window.navigator)?void 0:en.product)==="ReactNative")?eN.useLayoutEffect:eN.useEffect;class dy extends eN.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}dy.getDerivedStateFromError=()=>({error:!0});let dE="__default",dx=new Map,d_=e=>e&&!!e.memoized&&!!e.changes;function db(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}let dS={obj:e=>e===Object(e)&&!dS.arr(e)&&"function"!=typeof e,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,boo:e=>"boolean"==typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:n=!0}={}){let a;if(typeof e!=typeof t||!!e!=!!t)return!1;if(dS.str(e)||dS.num(e)||dS.boo(e))return e===t;let s=dS.obj(e);if(s&&"reference"===i)return e===t;let o=dS.arr(e);if(o&&"reference"===r)return e===t;if((o||s)&&e===t)return!0;for(a in e)if(!(a in t))return!1;if(s&&"shallow"===r&&"shallow"===i){for(a in n?t:e)if(!dS.equ(e[a],t[a],{strict:n,objects:"reference"}))return!1}else for(a in n?t:e)if(e[a]!==t[a])return!1;if(dS.und(a)){if(o&&0===e.length&&0===t.length||s&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function dw(e,t){return e.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function dC(e,t){let r=e;if(!t.includes("-"))return{target:r,key:t};{let i=t.split("-"),n=i.pop();return{target:r=i.reduce((e,t)=>e[t],e),key:n}}}let dT=/-\d+$/;function dI(e,t,r){if(dS.str(r)){if(dT.test(r)){let{target:t,key:i}=dC(e,r.replace(dT,""));Array.isArray(t[i])||(t[i]=[])}let{target:i,key:n}=dC(e,r);t.__r3f.previousAttach=i[n],i[n]=t}else t.__r3f.previousAttach=r(e,t)}function dM(e,t,r){var i,n;if(dS.str(r)){let{target:i,key:n}=dC(e,r),a=t.__r3f.previousAttach;void 0===a?delete i[n]:i[n]=a}else null==(i=t.__r3f)||null==i.previousAttach||i.previousAttach(e,t);null==(n=t.__r3f)||delete n.previousAttach}function dR(e,{children:t,key:r,ref:i,...n},{children:a,key:s,ref:o,...l}={},u=!1){let c=e.__r3f,h=Object.entries(n),d=[];if(u){let e=Object.keys(l);for(let t=0;t<e.length;t++)n.hasOwnProperty(e[t])||h.unshift([e[t],dE+"remove"])}h.forEach(([t,r])=>{var i;if(null!=(i=e.__r3f)&&i.primitive&&"object"===t||dS.equ(r,l[t]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(t))return d.push([t,r,!0,[]]);let a=[];for(let e in t.includes("-")&&(a=t.split("-")),d.push([t,r,!1,a]),n){let r=n[e];e.startsWith(`${t}-`)&&d.push([e,r,!1,e.split("-")])}});let f={...n};return null!=c&&c.memoizedProps&&null!=c&&c.memoizedProps.args&&(f.args=c.memoizedProps.args),null!=c&&c.memoizedProps&&null!=c&&c.memoizedProps.attach&&(f.attach=c.memoizedProps.attach),{memoized:f,changes:d}}let dB="undefined"!=typeof process&&!1;function dD(e,t){var r,i,n;let a=e.__r3f,s=null==a?void 0:a.root,o=null==s?void 0:null==s.getState?void 0:s.getState(),{memoized:l,changes:u}=d_(t)?t:dR(e,t),c=null==a?void 0:a.eventCount;e.__r3f&&(e.__r3f.memoizedProps=l);for(let t=0;t<u.length;t++){let[r,s,l,c]=u[t];if(dm(e)){let e="srgb",t="srgb-linear";"encoding"===r?(r="colorSpace",s=3001===s?e:t):"outputEncoding"===r&&(r="outputColorSpace",s=3001===s?e:t)}let h=e,d=h[r];if(c.length&&!((d=c.reduce((e,t)=>e[t],e))&&d.set)){let[t,...i]=c.reverse();h=i.reverse().reduce((e,t)=>e[t],e),r=t}if(s===dE+"remove"){if(h.constructor){let e=dx.get(h.constructor);e||(e=new h.constructor,dx.set(h.constructor,e)),s=e[r]}else s=0}if(l&&a)s?a.handlers[r]=s:delete a.handlers[r],a.eventCount=Object.keys(a.handlers).length;else if(d&&d.set&&(d.copy||d instanceof al)){if(Array.isArray(s))d.fromArray?d.fromArray(s):d.set(...s);else if(d.copy&&s&&s.constructor&&(dB?d.constructor.name===s.constructor.name:d.constructor===s.constructor))d.copy(s);else if(void 0!==s){let e=null==(i=d)?void 0:i.isColor;!e&&d.setScalar?d.setScalar(s):d instanceof al&&s instanceof al?d.mask=s.mask:d.set(s),!dg()&&o&&!o.linear&&e&&d.convertSRGBToLinear()}}else if(h[r]=s,null!=(n=h[r])&&n.isTexture&&h[r].format===ru&&h[r].type===t4&&o){let e=h[r];dm(e)&&dm(o.gl)?e.colorSpace=o.gl.outputColorSpace:e.encoding=o.gl.outputEncoding}dP(e)}if(a&&a.parent&&e.raycast&&c!==a.eventCount){let t=db(e).getState().internal,r=t.interaction.indexOf(e);r>-1&&t.interaction.splice(r,1),a.eventCount&&t.interaction.push(e)}return!(1===u.length&&"onUpdate"===u[0][0])&&u.length&&null!=(r=e.__r3f)&&r.parent&&dL(e),e}function dP(e){var t,r;let i=null==(t=e.__r3f)?void 0:null==(r=t.root)?void 0:null==r.getState?void 0:r.getState();i&&0===i.internal.frames&&i.invalidate()}function dL(e){null==e.onUpdate||e.onUpdate(e)}let dk=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],dF=eN.createContext(null);function dO(e,t){let r={callback:e};return t.add(r),()=>void t.delete(r)}let dU=new Set,dN=new Set,dz=new Set,dG=e=>dO(e,dU),dH=e=>dO(e,dN);function dQ(e,t){if(e.size)for(let{callback:r}of e.values())r(t)}function dV(e,t){switch(e){case"before":return dQ(dU,t);case"after":return dQ(dN,t);case"tail":return dQ(dz,t)}}function dW(e,t,r){let i=t.clock.getDelta();for("never"===t.frameloop&&"number"==typeof e&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),u=t.internal.subscribers,l=0;l<u.length;l++)(c=u[l]).ref.current(c.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function dj(){let e=eN.useContext(dF);if(!e)throw Error("R3F: Hooks can only be used within the Canvas component!");return e}function dY(e=e=>e,t){return dj()(e,t)}function dK(e,t=0){let r=dj(),i=r.getState().internal.subscribe,n=function(e){let t=eN.useRef(e);return dv(()=>void(t.current=e),[e]),t}(e);return dv(()=>i(n,t,r),[t,i,r]),null}let dq=new WeakMap;function dX(e,t){return function(r,...i){let n=dq.get(r);return n||(n=new r,dq.set(r,n)),e&&e(n),Promise.all(i.map(e=>new Promise((r,i)=>n.load(e,e=>{e.scene&&Object.assign(e,function(e){let t={nodes:{},materials:{}};return e&&e.traverse(e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)}),t}(e.scene)),r(e)},t,t=>i(Error(`Could not load ${e}: ${null==t?void 0:t.message}`))))))}}function d$(e,t,r,i){let n=Array.isArray(t)?t:[t],a=da(dX(r,i),[e,...n],{equal:dS.equ});return Array.isArray(t)?a:a[0]}d$.preload=function(e,t,r){let i=Array.isArray(t)?t:[t];return ds(dX(r),[e,...i])},d$.clear=function(e,t){return dl([e,...Array.isArray(t)?t:[t]])};let{invalidate:dJ,advance:dZ}=function(e){let t,r,i,n=!1,a=!1;function s(o){for(let u of(r=requestAnimationFrame(s),n=!0,t=0,dV("before",o),a=!0,e.values())){var l;(i=u.store.getState()).internal.active&&("always"===i.frameloop||i.internal.frames>0)&&!(null!=(l=i.gl.xr)&&l.isPresenting)&&(t+=dW(o,i))}if(a=!1,dV("after",o),0===t)return dV("tail",o),n=!1,cancelAnimationFrame(r)}return{loop:s,invalidate:function t(r,i=1){var o;if(!r)return e.forEach(e=>t(e.store.getState(),i));null!=(o=r.gl.xr)&&o.isPresenting||!r.internal.active||"never"===r.frameloop||(i>1?r.internal.frames=Math.min(60,r.internal.frames+i):a?r.internal.frames=2:r.internal.frames=1,n||(n=!0,requestAnimationFrame(s)))},advance:function(t,r=!0,i,n){if(r&&dV("before",t),i)dW(t,i,n);else for(let r of e.values())dW(t,r.store.getState());r&&dV("after",t)}}}(new Map),{reconciler:d0,applyProps:d1}=function(e,t){function r(e,{args:t=[],attach:r,...i},n){let a,s=`${e[0].toUpperCase()}${e.slice(1)}`;if("primitive"===e){if(void 0===i.object)throw Error("R3F: Primitives without 'object' are invalid!");a=dw(i.object,{type:e,root:n,attach:r,primitive:!0})}else{let i=df[s];if(!i)throw Error(`R3F: ${s} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(t))throw Error("R3F: The args prop must be an array!");a=dw(new i(...t),{type:e,root:n,attach:r,memoizedProps:{args:t}})}return void 0===a.__r3f.attach&&(a.isBufferGeometry?a.__r3f.attach="geometry":a.isMaterial&&(a.__r3f.attach="material")),"inject"!==s&&dD(a,i),a}function i(e,t){let r=!1;if(t){var i,n;null!=(i=t.__r3f)&&i.attach?dI(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),r=!0),r||null==(n=e.__r3f)||n.objects.push(t),t.__r3f||dw(t,{}),t.__r3f.parent=e,dL(t),dP(t)}}function n(e,t,r){let i=!1;if(t){var n,a;if(null!=(n=t.__r3f)&&n.attach)dI(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"}),e.dispatchEvent({type:"childadded",child:t});let n=e.children.filter(e=>e!==t),a=n.indexOf(r);e.children=[...n.slice(0,a),t,...n.slice(a)],i=!0}i||null==(a=e.__r3f)||a.objects.push(t),t.__r3f||dw(t,{}),t.__r3f.parent=e,dL(t),dP(t)}}function a(e,t,r=!1){e&&[...e].forEach(e=>s(t,e,r))}function s(e,t,r){if(t){var i,n,s,o,l;t.__r3f&&(t.__r3f.parent=null),null!=(i=e.__r3f)&&i.objects&&(e.__r3f.objects=e.__r3f.objects.filter(e=>e!==t)),null!=(n=t.__r3f)&&n.attach?dM(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.remove(t),null!=(o=t.__r3f)&&o.root&&function(e,t){let{internal:r}=e.getState();r.interaction=r.interaction.filter(e=>e!==t),r.initialHits=r.initialHits.filter(e=>e!==t),r.hovered.forEach((e,i)=>{(e.eventObject===t||e.object===t)&&r.hovered.delete(i)}),r.capturedMap.forEach((e,i)=>{(function(e,t,r,i){let n=r.get(t);n&&(r.delete(t),0===r.size&&(e.delete(i),n.target.releasePointerCapture(i)))})(r.capturedMap,t,e,i)})}(db(t),t));let u=null==(s=t.__r3f)?void 0:s.primitive,c=!u&&(void 0===r?null!==t.dispose:r);if(u||(a(null==(l=t.__r3f)?void 0:l.objects,t,c),a(t.children,t,c)),delete t.__r3f,c&&t.dispose&&"Scene"!==t.type){let e=()=>{try{t.dispose()}catch(e){}};"undefined"==typeof IS_REACT_ACT_ENVIRONMENT?(0,dd.unstable_scheduleCallback)(dd.unstable_IdlePriority,e):e()}dP(e)}}let o=()=>{};return{reconciler:dh()({createInstance:r,removeChild:s,appendChild:i,appendInitialChild:i,insertBefore:n,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(e,t)=>{if(!t)return;let r=e.getState().scene;r.__r3f&&(r.__r3f.root=e,i(r,t))},removeChildFromContainer:(e,t)=>{t&&s(e.getState().scene,t)},insertInContainerBefore:(e,t,r)=>{if(!t||!r)return;let i=e.getState().scene;i.__r3f&&n(i,t,r)},getRootHostContext:()=>null,getChildHostContext:e=>e,finalizeInitialChildren(e){var t;return!!(null!=(t=null==e?void 0:e.__r3f)?t:{}).handlers},prepareUpdate(e,t,r,i){var n;if((null!=(n=null==e?void 0:e.__r3f)?n:{}).primitive&&i.object&&i.object!==e)return[!0];{let{args:t=[],children:n,...a}=i,{args:s=[],children:o,...l}=r;if(!Array.isArray(t))throw Error("R3F: the args prop must be an array!");if(t.some((e,t)=>e!==s[t]))return[!0];let u=dR(e,a,l,!0);return u.changes.length?[!1,u]:null}},commitUpdate(e,[t,n],a,o,l,u){t?function(e,t,n,a){var o;let l=null==(o=e.__r3f)?void 0:o.parent;if(!l)return;let u=r(t,n,e.__r3f.root);if(e.children){for(let t of e.children)t.__r3f&&i(u,t);e.children=e.children.filter(e=>!e.__r3f)}e.__r3f.objects.forEach(e=>i(u,e)),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||s(l,e),u.parent&&(u.__r3f.autoRemovedBeforeAppend=!0),i(l,u),u.raycast&&u.__r3f.eventCount&&db(u).getState().internal.interaction.push(u),[a,a.alternate].forEach(e=>{null!==e&&(e.stateNode=u,e.ref&&("function"==typeof e.ref?e.ref(u):e.ref.current=u))})}(e,a,l,u):dD(e,n)},commitMount(e,t,r,i){var n;let a=null!=(n=e.__r3f)?n:{};e.raycast&&a.handlers&&a.eventCount&&db(e).getState().internal.interaction.push(e)},getPublicInstance:e=>e,prepareForCommit:()=>null,preparePortalMount:e=>dw(e.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(e){var t;let{attach:r,parent:i}=null!=(t=e.__r3f)?t:{};r&&i&&dM(i,e,r),e.isObject3D&&(e.visible=!1),dP(e)},unhideInstance(e,t){var r;let{attach:i,parent:n}=null!=(r=e.__r3f)?r:{};i&&n&&dI(n,e,i),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),dP(e)},createTextInstance:o,hideTextInstance:o,unhideTextInstance:o,getCurrentEventPriority:()=>t?t():h7.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:"undefined"!=typeof performance&&dS.fun(performance.now)?performance.now:dS.fun(Date.now)?Date.now:()=>0,scheduleTimeout:dS.fun(setTimeout)?setTimeout:void 0,cancelTimeout:dS.fun(clearTimeout)?clearTimeout:void 0}),applyProps:dD}}(0,function(){var e;let t="undefined"!=typeof self&&self||"undefined"!=typeof window&&window;if(!t)return h7.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return h7.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return h7.ContinuousEventPriority;default:return h7.DefaultEventPriority}});function d2(e,t,r){return(0,du.jsx)(d3,{children:e,container:t,state:r},t.uuid)}function d3({state:e={},children:t,container:r}){let{events:i,size:n,...a}=e,s=dj(),[o]=eN.useState(()=>new hf),[l]=eN.useState(()=>new nt),u=eN.useCallback((e,t)=>{let u;let c={...e};if(Object.keys(e).forEach(r=>{(dk.includes(r)||e[r]!==t[r]&&t[r])&&delete c[r]}),t&&n){var h,d;let r=t.camera;u=e.viewport.getCurrentViewport(r,new ni,n),r!==e.camera&&(h=r,d=n,h.manual||(dA(h)?(h.left=-(d.width/2),h.right=d.width/2,h.top=d.height/2,h.bottom=-(d.height/2)):h.aspect=d.width/d.height,h.updateProjectionMatrix(),h.updateMatrixWorld()))}return{...c,scene:r,raycaster:o,pointer:l,mouse:l,previousRoot:s,events:{...e.events,...null==t?void 0:t.events,...i},size:{...e.size,...n},viewport:{...e.viewport,...u},...a}},[e]),[c]=eN.useState(()=>{let e=s.getState();return function(e){let t="function"==typeof e?function(e){let t;let r=new Set,i=(e,i)=>{let n="function"==typeof e?e(t):e;if(n!==t){let e=t;t=i?n:Object.assign({},t,n),r.forEach(r=>r(t,e))}},n=()=>t,a=(e,i=n,a=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let s=i(t);function o(){let r=i(t);if(!a(s,r)){let t=s;e(s=r,t)}}return r.add(o),()=>r.delete(o)},s={setState:i,getState:n,subscribe:(e,t,i)=>t||i?a(e,t,i):(r.add(e),()=>r.delete(e)),destroy:()=>r.clear()};return t=e(i,n,s),s}(e):e,r=(e=t.getState,r=Object.is)=>{let i;let[,n]=(0,eN.useReducer)(e=>e+1,0),a=t.getState(),s=(0,eN.useRef)(a),o=(0,eN.useRef)(e),l=(0,eN.useRef)(r),u=(0,eN.useRef)(!1),c=(0,eN.useRef)();void 0===c.current&&(c.current=e(a));let h=!1;(s.current!==a||o.current!==e||l.current!==r||u.current)&&(i=e(a),h=!r(c.current,i)),de(()=>{h&&(c.current=i),s.current=a,o.current=e,l.current=r,u.current=!1});let d=(0,eN.useRef)(a);de(()=>{let e=()=>{try{let e=t.getState(),r=o.current(e);l.current(c.current,r)||(s.current=e,c.current=r,n())}catch(e){u.current=!0,n()}},r=t.subscribe(e);return t.getState()!==d.current&&e(),r},[]);let f=h?i:c.current;return(0,eN.useDebugValue)(f),f};return Object.assign(r,t),r[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");let e=[r,t];return{next(){let t=e.length<=0;return{value:e.shift(),done:t}}}},r}((t,u)=>({...e,scene:r,raycaster:o,pointer:l,mouse:l,previousRoot:s,events:{...e.events,...i},size:{...e.size,...n},...a,set:t,get:u,setEvents:e=>t(t=>({...t,events:{...t.events,...e}}))}))});return eN.useEffect(()=>{let e=s.subscribe(e=>c.setState(t=>u(e,t)));return()=>{e()}},[u]),eN.useEffect(()=>{c.setState(e=>u(s.getState(),e))},[u]),eN.useEffect(()=>()=>{c.destroy()},[]),(0,du.jsx)(du.Fragment,{children:d0.createPortal((0,du.jsx)(dF.Provider,{value:c,children:t}),c,null)})}d0.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:eN.version}),eN.unstable_act;let d4=new ni,d5=new ni,d6=new ni,d8=new nt;function d9(e,t,r){let i=d4.setFromMatrixPosition(e.matrixWorld);i.project(t);let n=r.width/2,a=r.height/2;return[i.x*n+n,-(i.y*a)+a]}let d7=e=>1e-10>Math.abs(e)?0:e;function fe(e,t,r=""){let i="matrix3d(";for(let r=0;16!==r;r++)i+=d7(t[r]*e.elements[r])+(15!==r?",":")");return r+i}let ft=(et=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>fe(e,et)),fr=(er=e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1],(e,t)=>fe(e,er(t),"translate(-50%,-50%)")),fi=eN.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:n,center:a,fullscreen:s,portal:o,distanceFactor:l,sprite:u=!1,transform:c=!1,occlude:h,onOcclude:d,castShadow:f,receiveShadow:p,material:m,geometry:g,zIndexRange:A=[0x1000037,0],calculatePosition:v=d9,as:y="div",wrapperClass:E,pointerEvents:x="auto",..._},b)=>{let{gl:S,camera:w,scene:C,size:T,raycaster:I,events:M,viewport:R}=dY(),[B]=eN.useState(()=>document.createElement(y)),D=eN.useRef(),P=eN.useRef(null),L=eN.useRef(0),k=eN.useRef([0,0]),F=eN.useRef(null),O=eN.useRef(null),U=(null==o?void 0:o.current)||M.connected||S.domElement.parentNode,N=eN.useRef(null),z=eN.useRef(!1),G=eN.useMemo(()=>h&&"blending"!==h||Array.isArray(h)&&h.length&&function(e){return e&&"object"==typeof e&&"current"in e}(h[0]),[h]);eN.useLayoutEffect(()=>{let e=S.domElement;h&&"blending"===h?(e.style.zIndex=`${Math.floor(A[0]/2)}`,e.style.position="absolute",e.style.pointerEvents="none"):(e.style.zIndex=null,e.style.position=null,e.style.pointerEvents=null)},[h]),eN.useLayoutEffect(()=>{if(P.current){let e=D.current=eG.createRoot(B);if(C.updateMatrixWorld(),c)B.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{let e=v(P.current,w,T);B.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return U&&(n?U.prepend(B):U.appendChild(B)),()=>{U&&U.removeChild(B),e.unmount()}}},[U,c]),eN.useLayoutEffect(()=>{E&&(B.className=E)},[E]);let H=eN.useMemo(()=>c?{position:"absolute",top:0,left:0,width:T.width,height:T.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:a?"translate3d(-50%,-50%,0)":"none",...s&&{top:-T.height/2,left:-T.width/2,width:T.width,height:T.height},...r},[r,a,s,T,c]),Q=eN.useMemo(()=>({position:"absolute",pointerEvents:x}),[x]);eN.useLayoutEffect(()=>{var t,n;z.current=!1,c?null==(t=D.current)||t.render(eN.createElement("div",{ref:F,style:H},eN.createElement("div",{ref:O,style:Q},eN.createElement("div",{ref:b,className:i,style:r,children:e})))):null==(n=D.current)||n.render(eN.createElement("div",{ref:b,style:H,className:i,children:e}))});let V=eN.useRef(!0);dK(e=>{if(P.current){w.updateMatrixWorld(),P.current.updateWorldMatrix(!0,!1);let e=c?k.current:v(P.current,w,T);if(c||Math.abs(L.current-w.zoom)>t||Math.abs(k.current[0]-e[0])>t||Math.abs(k.current[1]-e[1])>t){let t=function(e,t){let r=d4.setFromMatrixPosition(e.matrixWorld),i=d5.setFromMatrixPosition(t.matrixWorld),n=r.sub(i),a=t.getWorldDirection(d6);return n.angleTo(a)>Math.PI/2}(P.current,w),r=!1;G&&(Array.isArray(h)?r=h.map(e=>e.current):"blending"!==h&&(r=[C]));let i=V.current;if(r){let e=function(e,t,r,i){let n=d4.setFromMatrixPosition(e.matrixWorld),a=n.clone();a.project(t),d8.set(a.x,a.y),r.setFromCamera(d8,t);let s=r.intersectObjects(i,!0);if(s.length){let e=s[0].distance;return n.distanceTo(r.ray.origin)<e}return!0}(P.current,w,I,r);V.current=e&&!t}else V.current=!t;i!==V.current&&(d?d(!V.current):B.style.display=V.current?"block":"none");let n=Math.floor(A[0]/2),a=h?G?[A[0],n]:[n-1,0]:A;if(B.style.zIndex=`${function(e,t,r){if(t instanceof sD||t instanceof cv){let i=d4.setFromMatrixPosition(e.matrixWorld),n=d5.setFromMatrixPosition(t.matrixWorld),a=i.distanceTo(n),s=(r[1]-r[0])/(t.far-t.near),o=r[1]-s*t.far;return Math.round(s*a+o)}}(P.current,w,a)}`,c){let[e,t]=[T.width/2,T.height/2],r=w.projectionMatrix.elements[5]*t,{isOrthographicCamera:i,top:n,left:a,bottom:s,right:o}=w,c=ft(w.matrixWorldInverse),h=i?`scale(${r})translate(${d7(-(o+a)/2)}px,${d7((n+s)/2)}px)`:`translateZ(${r}px)`,d=P.current.matrixWorld;u&&((d=w.matrixWorldInverse.clone().transpose().copyPosition(d).scale(P.current.scale)).elements[3]=d.elements[7]=d.elements[11]=0,d.elements[15]=1),B.style.width=T.width+"px",B.style.height=T.height+"px",B.style.perspective=i?"":`${r}px`,F.current&&O.current&&(F.current.style.transform=`${h}${c}translate(${e}px,${t}px)`,O.current.style.transform=fr(d,1/((l||10)/400)))}else{let t=void 0===l?1:function(e,t){if(t instanceof cv)return t.zoom;if(!(t instanceof sD))return 1;{let r=d4.setFromMatrixPosition(e.matrixWorld),i=d5.setFromMatrixPosition(t.matrixWorld);return 1/(2*Math.tan(t.fov*Math.PI/180/2)*r.distanceTo(i))}}(P.current,w)*l;B.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}k.current=e,L.current=w.zoom}}if(!G&&N.current&&!z.current){if(c){if(F.current){let e=F.current.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){let{isOrthographicCamera:t}=w;if(t||g)_.scale&&(Array.isArray(_.scale)?_.scale instanceof ni?N.current.scale.copy(_.scale.clone().divideScalar(1)):N.current.scale.set(1/_.scale[0],1/_.scale[1],1/_.scale[2]):N.current.scale.setScalar(1/_.scale));else{let t=(l||10)/400,r=e.clientWidth*t,i=e.clientHeight*t;N.current.scale.set(r,i,1)}z.current=!0}}}else{let t=B.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){let e=1/R.factor,r=t.clientWidth*e,i=t.clientHeight*e;N.current.scale.set(r,i,1),z.current=!0}N.current.lookAt(e.camera.position)}}});let W=eN.useMemo(()=>({vertexShader:c?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[c]);return eN.createElement("group",eU({},_,{ref:P}),h&&!G&&eN.createElement("mesh",{castShadow:f,receiveShadow:p,ref:N},g||eN.createElement("planeGeometry",null),m||eN.createElement("shaderMaterial",{side:e1,vertexShader:W.vertexShader,fragmentShader:W.fragmentShader})))});function fn({onChanged:e,portal:t,preventDefault:r=!0,scroll:i=!0,keyCode:n=9}){let a=eN.useRef(0),s=dY(e=>e.setEvents),o=dY(e=>e.get),l=dY(e=>e.gl);return eN.useEffect(()=>{var u;let c;let h=[],d=o().events.filter,f=null!==(u=null==t?void 0:t.current)&&void 0!==u?u:l.domElement.parentNode,p=()=>f&&e&&e(h,Math.round(a.current)%h.length);s({filter:(e,t)=>{let r=[...e];r.length===h.length&&h.every(e=>r.map(e=>e.object.uuid).includes(e.object.uuid))||(a.current=0,h=r,p()),d&&(r=d(r,t));for(let e=0;e<Math.round(a.current)%r.length;e++){let e=r.shift();r=[...r,e]}return r}});let m=e=>{var t,r;a.current=e(a.current),null==(t=o().events.handlers)||t.onPointerCancel(void 0),null==(r=o().events.handlers)||r.onPointerMove(c),p()},g=e=>{(e.keyCode||e.which)===n&&(r&&e.preventDefault(),h.length>1&&m(e=>e+1))},A=e=>{r&&e.preventDefault();let t=0;e||(e=window.event),e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),h.length>1&&m(e=>Math.abs(e-t))},v=e=>c=e;return document.addEventListener("pointermove",v,{passive:!0}),i&&document.addEventListener("wheel",A),void 0!==n&&document.addEventListener("keydown",g),()=>{s({filter:d}),void 0!==n&&document.removeEventListener("keydown",g),i&&document.removeEventListener("wheel",A),document.removeEventListener("pointermove",v)}},[l,o,s,r,i,n]),null}function fa(e,t="pointer",r="auto",i=document.body){eN.useEffect(()=>{if(e)return i.style.cursor=t,()=>void(i.style.cursor=r)},[e])}let fs=e=>{let t;let r=new Set,i=(e,i)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=i?i:"object"!=typeof n||null===n)?n:Object.assign({},t,n),r.forEach(r=>r(t,e))}},n=()=>t,a={setState:i,getState:n,getInitialState:()=>s,subscribe:e=>(r.add(e),()=>r.delete(e))},s=t=e(i,n,a);return a},fo=e=>e?fs(e):fs,fl=e=>e,fu=e=>{let t=fo(e),r=e=>(function(e,t=fl){let r=eN.useSyncExternalStore(e.subscribe,eN.useCallback(()=>t(e.getState()),[e,t]),eN.useCallback(()=>t(e.getInitialState()),[e,t]));return eN.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},fc=e=>e?fu(e):fu,fh=0,fd=fc(e=>(u3.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-fh)/(i-fh)*100})},u3.onLoad=()=>{e({active:!1})},u3.onError=t=>e(e=>({errors:[...e.errors,t]})),u3.onProgress=(t,r,i)=>{r===i&&(fh=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-fh)/(i-fh)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function ff({children:e}){let t=fd();return eN.createElement(eN.Fragment,null,null==e?void 0:e(t))}let fp=e=>`Loading ${e.toFixed(2)}%`;function fm({containerStyles:e,innerStyles:t,barStyles:r,dataStyles:i,dataInterpolation:n=fp,initialState:a=e=>e}){let{active:s,progress:o}=fd(),l=eN.useRef(0),u=eN.useRef(0),c=eN.useRef(null),[h,d]=eN.useState(a(s));eN.useEffect(()=>{let e;return s!==h&&(e=setTimeout(()=>d(s),300)),()=>clearTimeout(e)},[h,s]);let f=eN.useCallback(()=>{c.current&&(l.current+=(o-l.current)/2,(l.current>.95*o||100===o)&&(l.current=o),c.current.innerText=n(l.current),l.current<o&&(u.current=requestAnimationFrame(f)))},[n,o]);return eN.useEffect(()=>(f(),()=>cancelAnimationFrame(u.current)),[f]),h?eN.createElement("div",{style:{...fg.container,opacity:s?1:0,...e}},eN.createElement("div",null,eN.createElement("div",{style:{...fg.inner,...t}},eN.createElement("div",{style:{...fg.bar,transform:`scaleX(${o/100})`,...r}}),eN.createElement("span",{ref:c,style:{...fg.data,...i}})))):null}let fg={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}},fA={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function fv(e,t,r){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*r):e*t*r/(t+r*e)}function fy(e,t,r,i=.15){return 0===i?Math.max(t,Math.min(e,r)):e<t?-fv(t-e,r-t,i)+t:e>r?+fv(e-r,r-t,i)+r:e}function fE(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fx(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function f_(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fx(Object(r),!0).forEach(function(t){fE(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fx(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let fb={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function fS(e){return e?e[0].toUpperCase()+e.slice(1):""}let fw=["enter","leave"],fC=["gotpointercapture","lostpointercapture"];function fT(e){return"touches"in e}function fI(e){return fT(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function fM(e){return fT(e)?("touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches)[0]:e}function fR(e,t){try{let r=t.clientX-e.clientX,i=t.clientY-e.clientY,n=(t.clientX+e.clientX)/2,a=(t.clientY+e.clientY)/2,s=Math.hypot(r,i);return{angle:-(180*Math.atan2(r,i))/Math.PI,distance:s,origin:[n,a]}}catch(e){}return null}function fB(e,t){let[r,i]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return fR(r,i)}function fD(e){let t=fM(e);return fT(e)?t.identifier:t.pointerId}function fP(e){let t=fM(e);return[t.clientX,t.clientY]}function fL(e){let{deltaX:t,deltaY:r,deltaMode:i}=e;return 1===i?(t*=40,r*=40):2===i&&(t*=800,r*=800),[t,r]}function fk(e,...t){return"function"==typeof e?e(...t):e}function fF(){}function fO(e,t){return Object.assign({},t,e||{})}class fU{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:e,shared:t,ingKey:r,args:i}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){let t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?fk(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){let t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){let e=this.state;e._initial=e._values,e.initial=e.values}compute(e){let{state:t,config:r,shared:i}=this;t.args=this.args;let n=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,function(e){let t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){let{shiftKey:r,altKey:i,metaKey:n,ctrlKey:a}=e;Object.assign(t,{shiftKey:r,altKey:i,metaKey:n,ctrlKey:a})}return t}(e)),i.down=i.pressed=i.buttons%2==1||i.touches>0,n=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){let e=t._delta.map(Math.abs);fA.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);let[a,s]=t._movement,[o,l]=r.threshold,{_step:u,values:c}=t;if(r.hasCustomTransform?(!1===u[0]&&(u[0]=Math.abs(a)>=o&&c[0]),!1===u[1]&&(u[1]=Math.abs(s)>=l&&c[1])):(!1===u[0]&&(u[0]=Math.abs(a)>=o&&Math.sign(a)*o),!1===u[1]&&(u[1]=Math.abs(s)>=l&&Math.sign(s)*l)),t.intentional=!1!==u[0]||!1!==u[1],!t.intentional)return;let h=[0,0];if(r.hasCustomTransform){let[e,t]=c;h[0]=!1!==u[0]?e-u[0]:0,h[1]=!1!==u[1]?t-u[1]:0}else h[0]=!1!==u[0]?a-u[0]:0,h[1]=!1!==u[1]?s-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);let d=t.offset,f=t._active&&!t._blocked||t.active;f&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=fk(r.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));let[p,m]=t.offset,[[g,A],[v,y]]=t._bounds;t.overflow=[p<g?-1:p>A?1:0,m<v?-1:m>y?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);let E=t._active&&r.rubberband||[0,0];if(t.offset=function(e,[t,r],[i,n]){let[[a,s],[o,l]]=e;return[fy(t,a,s,i),fy(r,o,l,n)]}(t._bounds,t.offset,E),t.delta=fA.sub(t.offset,d),this.computeMovement(),f&&(!t.last||n>32)){t.delta=fA.sub(t.offset,d);let e=t.delta.map(Math.abs);fA.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&n>0&&(t.velocity=[e[0]/n,e[1]/n],t.timeDelta=n)}}emit(){let e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;let i=this.handler(f_(f_(f_({},t),e),{},{[this.aliasKey]:e.values}));void 0!==i&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class fN extends fU{constructor(...e){super(...e),fE(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=fA.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=fA.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){let t=this.state,r=this.config;if(!t.axis&&e){let i="object"==typeof r.axisThreshold?r.axisThreshold[fI(e)]:r.axisThreshold;t.axis=function([e,t],r){let i=Math.abs(e),n=Math.abs(t);return i>n&&i>r?"x":n>i&&n>r?"y":void 0}(t._movement,i)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}let fz=e=>e,fG={enabled:(e=!0)=>e,eventOptions:(e,t,r)=>f_(f_({},r.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return fA.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?fA.toVector(e):void 0,transform(e,t,r){let i=e||r.shared.transform;return this.hasCustomTransform=!!i,i||fz},threshold:e=>fA.toVector(e,0)},fH=0,fQ=f_(f_({},fG),{},{axis(e,t,{axis:r}){if(this.lockDirection="lock"===r,!this.lockDirection)return r},axisThreshold:(e=fH)=>e,bounds(e={}){if("function"==typeof e)return t=>fQ.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;let{left:t=-1/0,right:r=1/0,top:i=-1/0,bottom:n=1/0}=e;return[[t,r],[i,n]]}}),fV={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};class fW extends fN{constructor(...e){super(...e),fE(this,"ingKey","dragging")}reset(){super.reset();let e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){let e=this.state;if(e._bounds instanceof HTMLElement){let t=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),i={left:t.left-r.left+e.offset[0],right:t.right-r.right+e.offset[0],top:t.top-r.top+e.offset[1],bottom:t.bottom-r.bottom+e.offset[1]};e._bounds=fQ.bounds(i)}}cancel(){let e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){let t=this.config,r=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;let i=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),i&&i.size>1&&r._pointerActive||(this.start(e),this.setupPointer(e),r._pointerId=fD(e),r._pointerActive=!0,this.computeValues(fP(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==fI(e)?(r._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){let t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){let t=this.state,r=this.config;if(!t._pointerActive)return;let i=fD(e);if(void 0!==t._pointerId&&i!==t._pointerId)return;let n=fP(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=fA.sub(n,t._values),this.computeValues(n)),fA.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(r.preventScrollAxis&&!t._preventScroll){if(!t.axis)return;if(t.axis===r.preventScrollAxis||"xy"===r.preventScrollAxis){t._active=!1,this.clean();return}this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch(e){}let t=this.state,r=this.config;if(!t._active||!t._pointerActive)return;let i=fD(e);if(void 0!==t._pointerId&&i!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);let[n,a]=t._distance;if(t.tap=n<=r.tapsThreshold&&a<=r.tapsThreshold,t.tap&&r.filterTaps)t._force=!0;else{let[e,i]=t._delta,[n,a]=t._movement,[s,o]=r.swipe.velocity,[l,u]=r.swipe.distance,c=r.swipe.duration;if(t.elapsedTime<c){let r=Math.abs(e/t.timeDelta),c=Math.abs(i/t.timeDelta);r>s&&Math.abs(n)>l&&(t.swipe[0]=Math.sign(e)),c>o&&Math.abs(a)>u&&(t.swipe[1]=Math.sign(i))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){let t=this.config,r=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,"persist"in e&&"function"==typeof e.persist&&e.persist();let t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){let t=fV[e.key];if(t){let r=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),r._delta=t(this.config.keyboardDisplacement,i),r._keyboardActive=!0,fA.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in fV&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){let t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}let fj="undefined"!=typeof window&&window.document&&window.document.createElement;function fY(){return fj&&"ontouchstart"in window}let fK={isBrowser:fj,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:fY(),touchscreen:fY()||fj&&window.navigator.maxTouchPoints>1,pointer:fj&&"onpointerdown"in window,pointerLock:fj&&"exitPointerLock"in window.document},fq=10,fX={mouse:0,touch:0,pen:8},f$=f_(f_({},fQ),{},{device(e,t,{pointer:{touch:r=!1,lock:i=!1,mouse:n=!1}={}}){return(this.pointerLock=i&&fK.pointerLock,fK.touch&&r)?"touch":this.pointerLock?"mouse":fK.pointer&&!n?"pointer":fK.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:r}){if(this.preventScrollDelay="number"==typeof r?r:r||void 0===r&&e?250:void 0,fK.touchscreen&&!1!==r)return e||(void 0!==r?"y":void 0)},pointerCapture(e,t,{pointer:{capture:r=!0,buttons:i=1,keys:n=!0}={}}){return this.pointerButtons=i,this.keys=n,!this.pointerLock&&"pointer"===this.device&&r},threshold(e,t,{filterTaps:r=!1,tapsThreshold:i=3,axis:n}){let a=fA.toVector(e,r?i:n?1:0);return this.filterTaps=r,this.tapsThreshold=i,a},swipe({velocity:e=.5,distance:t=50,duration:r=250}={}){return{velocity:this.transform(fA.toVector(e)),distance:this.transform(fA.toVector(t)),duration:r}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?f_(f_({},fX),e):fX,keyboardDisplacement:(e=fq)=>e});function fJ(e){let[t,r]=e.overflow,[i,n]=e._delta,[a,s]=e._direction;(t<0&&i>0&&a<0||t>0&&i<0&&a>0)&&(e._movement[0]=e._movementBound[0]),(r<0&&n>0&&s<0||r>0&&n<0&&s>0)&&(e._movement[1]=e._movementBound[1])}class fZ extends fU{constructor(...e){super(...e),fE(this,"ingKey","pinching"),fE(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){let{type:e,movement:t,lastOffset:r}=this.state;"wheel"===e?this.state.offset=fA.add(t,r):this.state.offset=[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){let{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){let e=this.state,[t,r]=e._movement;if(!e.axis){let i=30*Math.abs(t)-Math.abs(r);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){let e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);let t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>r.has(e))||r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);let i=fB(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);let t=this.state,r=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(e=>i.has(e))||(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);let n=fR(...Array.from(r.values()));n&&this.pinchStart(e,n)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;let t=fB(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){let t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;let r=fR(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){let r=this.state,i=r._values[1],n=t.angle-i,a=0;Math.abs(n)>270&&(a+=Math.sign(n)),this.computeValues([t.distance,t.angle-360*a]),r.origin=t.origin,r.turns=a,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){let t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(e){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();let t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;let t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];let r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=fA.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){let t=this.config.modifierKey;(!t||(Array.isArray(t)?t.find(t=>e[t]):e[t]))&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||!e.cancelable||e.preventDefault();let t=this.state;t._delta=[-fL(e)[1]/100*t.offset[0],0],fA.addTo(t._movement,t._delta),fJ(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){let t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}let f0=f_(f_({},fG),{},{device(e,t,{shared:r,pointer:{touch:i=!1}={}}){if(r.target&&!fK.touch&&fK.gesture)return"gesture";if(fK.touch&&i)return"touch";if(fK.touchscreen){if(fK.pointer)return"pointer";if(fK.touch)return"touch"}},bounds(e,t,{scaleBounds:r={},angleBounds:i={}}){let n=e=>{let t=fO(fk(r,e),{min:-1/0,max:1/0});return[t.min,t.max]},a=e=>{let t=fO(fk(i,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof r&&"function"!=typeof i?[n(),a()]:e=>[n(e),a(e)]},threshold(e,t,r){return this.lockDirection="lock"===r.axis,fA.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});class f1 extends fN{constructor(...e){super(...e),fE(this,"ingKey","moving")}move(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(e){this.start(e),this.computeValues(fP(e)),this.compute(e),this.computeInitial(),this.emit()}moveChange(e){if(!this.state._active)return;let t=fP(e),r=this.state;r._delta=fA.sub(t,r._values),fA.addTo(r._movement,r._delta),this.computeValues(t),this.compute(e),this.emit()}moveEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}bind(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}}let f2=f_(f_({},fQ),{},{mouseOnly:(e=!0)=>e});class f3 extends fN{constructor(...e){super(...e),fE(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();let t=this.state,r=function(e){var t,r;let{scrollX:i,scrollY:n,scrollLeft:a,scrollTop:s}=e.currentTarget;return[null!==(t=null!=i?i:a)&&void 0!==t?t:0,null!==(r=null!=n?n:s)&&void 0!==r?r:0]}(e);t._delta=fA.sub(r,t._values),fA.addTo(t._movement,t._delta),this.computeValues(r),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}class f4 extends fN{constructor(...e){super(...e),fE(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){let t=this.state;t._delta=fL(e),fA.addTo(t._movement,t._delta),fJ(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}class f5 extends fN{constructor(...e){super(...e),fE(this,"ingKey","hovering")}enter(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.start(e),this.computeValues(fP(e)),this.compute(e),this.emit())}leave(e){if(this.config.mouseOnly&&"mouse"!==e.pointerType)return;let t=this.state;if(!t._active)return;t._active=!1;let r=fP(e);t._movement=t._delta=fA.sub(r,t._values),this.computeValues(r),this.compute(e),t.delta=t.movement,this.emit()}bind(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}}let f6=f_(f_({},fQ),{},{mouseOnly:(e=!0)=>e}),f8=new Map,f9=new Map;function f7(e){f8.set(e.key,e.engine),f9.set(e.key,e.resolver)}let pe={key:"drag",engine:fW,resolver:f$},pt={key:"hover",engine:f5,resolver:f6},pr={key:"move",engine:f1,resolver:f2},pi={key:"pinch",engine:fZ,resolver:f0},pn={key:"scroll",engine:f3,resolver:fQ},pa={key:"wheel",engine:f4,resolver:fQ},ps={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=fK.isBrowser?window:void 0)=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},po=["target","eventOptions","window","enabled","transform"];function pl(e={},t){let r={};for(let[i,n]of Object.entries(t))switch(typeof n){case"function":r[i]=n.call(r,e[i],i,e);break;case"object":r[i]=pl(e[i],n);break;case"boolean":n&&(r[i]=e[i])}return r}class pu{constructor(e,t){fE(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,i,n){let a=this._listeners,s=function(e,t=""){let r=fb[e];return e+(r&&r[t]||t)}(t,r),o=f_(f_({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),n);e.addEventListener(s,i,o);let l=()=>{e.removeEventListener(s,i,o),a.delete(l)};return a.add(l),l}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class pc{constructor(){fE(this,"_timeouts",new Map)}add(e,t,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...i))}remove(e){let t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class ph{constructor(e){fE(this,"gestures",new Set),fE(this,"_targetEventStore",new pu(this)),fE(this,"gestureEventStores",{}),fE(this,"gestureTimeoutStores",{}),fE(this,"handlers",{}),fE(this,"config",{}),fE(this,"pointerIds",new Set),fE(this,"touchIds",new Set),fE(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(e,t){t.drag&&pd(e,"drag"),t.wheel&&pd(e,"wheel"),t.scroll&&pd(e,"scroll"),t.move&&pd(e,"move"),t.pinch&&pd(e,"pinch"),t.hover&&pd(e,"hover")}(this,e)}setEventIds(e){return fT(e)?(this.touchIds=new Set(Array.from(e.touches).filter(t=>{var r,i;return t.target===e.currentTarget||(null===(r=e.currentTarget)||void 0===r||null===(i=r.contains)||void 0===i?void 0:i.call(r,t.target))}).map(e=>e.identifier)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t,r={}){let{target:i,eventOptions:n,window:a,enabled:s,transform:o}=e,l=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r,i,n={},a=Object.keys(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,po);if(r.shared=pl({target:i,eventOptions:n,window:a,enabled:s,transform:o},ps),t){let e=f9.get(t);r[t]=pl(f_({shared:r.shared},l),e)}else for(let e in l){let t=f9.get(e);t&&(r[e]=pl(f_({shared:r.shared},l[e]),t))}return r}(e,t,this.config)}clean(){for(let e of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){let t;let r=this.config.shared,i={};if(!r.target||(t=r.target())){if(r.enabled){for(let r of this.gestures){let n=this.config[r],a=pf(i,n.eventOptions,!!t);n.enabled&&new(f8.get(r))(this,e,r).bind(a)}let n=pf(i,r.eventOptions,!!t);for(let t in this.nativeHandlers)n(t,"",r=>this.nativeHandlers[t](f_(f_({},this.state.shared),{},{event:r,args:e})),void 0,!0)}for(let e in i)i[e]=function(...e){return 0===e.length?fF:1===e.length?e[0]:function(){let t;for(let r of e)t=r.apply(this,arguments)||t;return t}}(...i[e]);if(!t)return i;for(let e in i){let{device:r,capture:n,passive:a}=function(e){let t=e.substring(2).toLowerCase(),r=!!~t.indexOf("passive");r&&(t=t.replace("passive",""));let i=fC.includes(t)?"capturecapture":"capture",n=!!~t.indexOf(i);return n&&(t=t.replace("capture","")),{device:t,capture:n,passive:r}}(e);this._targetEventStore.add(t,r,"",i[e],{capture:n,passive:a})}}}}function pd(e,t){e.gestures.add(t),e.gestureEventStores[t]=new pu(e,t),e.gestureTimeoutStores[t]=new pc}let pf=(e,t,r)=>(i,n,a,s={},o=!1)=>{var l,u;let c=null!==(l=s.capture)&&void 0!==l?l:t.capture,h=null!==(u=s.passive)&&void 0!==u?u:t.passive,d=o?i:function(e,t="",r=!1){let i=fb[e],n=i&&i[t]||t;return"on"+fS(e)+fS(n)+(!function(e=!1,t){return e&&!fw.includes(t)}(r,n)?"":"Capture")}(i,n,c);r&&h&&(d+="Passive"),e[d]=e[d]||[],e[d].push(a)},pp=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function pm(e,t,r,i,n,a){if(!e.has(r)||!f8.has(i))return;let s=r+"Start",o=r+"End";n[i]=e=>{let i;return e.first&&s in t&&t[s](e),r in t&&(i=t[r](e)),e.last&&o in t&&t[o](e),i},a[i]=a[i]||{}}function pg(e,t){return([pe,pi,pn,pa,pr,pt].forEach(f7),function(e,t){let{handlers:r,nativeHandlers:i,config:n}=function(e,t){let[r,i,n]=function(e){let t={},r={},i=new Set;for(let n in e)pp.test(n)?(i.add(RegExp.lastMatch),r[n]=e[n]):t[n]=e[n];return[r,t,i]}(e),a={};return pm(n,r,"onDrag","drag",a,t),pm(n,r,"onWheel","wheel",a,t),pm(n,r,"onScroll","scroll",a,t),pm(n,r,"onPinch","pinch",a,t),pm(n,r,"onMove","move",a,t),pm(n,r,"onHover","hover",a,t),{handlers:a,config:t,nativeHandlers:i}}(e,t||{});return function(e,t={},r,i){let n=ez().useMemo(()=>new ph(e),[]);if(n.applyHandlers(e,i),n.applyConfig(t,r),ez().useEffect(n.effect.bind(n)),ez().useEffect(()=>n.clean.bind(n),[]),void 0===t.target)return n.bind.bind(n)}(r,n,void 0,i)})(e,t||{})}let pA=new ni,pv=new nt,py=new ni,pE=new ni,px=new ni,p_=new oC,pb=eN.forwardRef(({autoTransform:e=!0,matrix:t,axisLock:r,dragLimits:i,onHover:n,onDragStart:a,onDrag:s,onDragEnd:o,children:l,dragConfig:u,...c},h)=>{let d=dY(e=>e.controls),{camera:f,size:p,raycaster:m,invalidate:g}=dY(),A=eN.useRef(null),v=pg({onHover:({hovering:e})=>n&&n(null!=e&&e),onDragStart:({event:e})=>{d&&(d.enabled=!1);let{point:t}=e;A.current.matrix.decompose(pA,new nr,new ni),py.copy(t),pE.copy(py).sub(pA),a&&a(pA),g()},onDrag:({xy:[t,n],intentional:a})=>{if(!a)return;let o=(t-p.left)/p.width*2-1,l=-(2*((n-p.top)/p.height))+1;if(pv.set(o,l),m.setFromCamera(pv,f),r)switch(r){case"x":px.set(1,0,0);break;case"y":px.set(0,1,0);break;case"z":px.set(0,0,1)}else f.getWorldDirection(px).negate();p_.setFromNormalAndCoplanarPoint(px,py),m.ray.intersectPlane(p_,py);let u=A.current.matrix.clone(),c=A.current.matrixWorld.clone(),h=new ni(py.x-pE.x,py.y-pE.y,py.z-pE.z);if(i&&(h.x=i[0]?Math.max(Math.min(h.x,i[0][1]),i[0][0]):h.x,h.y=i[1]?Math.max(Math.min(h.y,i[1][1]),i[1][0]):h.y,h.z=i[2]?Math.max(Math.min(h.z,i[2][1]),i[2][0]):h.z),e){A.current.matrix.setPosition(h);let e=A.current.matrix.clone().multiply(u.invert()),t=A.current.matrix.clone().multiply(c.invert());s&&s(A.current.matrix,e,A.current.matrixWorld,t)}else{let e=new n8().copy(A.current.matrix);e.setPosition(h);let t=e.clone().multiply(u.invert()),r=e.clone().multiply(c.invert());s&&s(e,t,A.current.matrixWorld,r)}g()},onDragEnd:()=>{d&&(d.enabled=!0),o&&o(),g()}},{drag:{filterTaps:!0,threshold:1,..."object"==typeof u?u:{}}});return eN.useImperativeHandle(h,()=>A.current,[]),eN.useLayoutEffect(()=>{t&&(A.current.matrix=t)},[t]),eN.createElement("group",eU({ref:A},v(),{matrix:t,matrixAutoUpdate:!1},c),l)});function pS(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pw(e,t){return(pw=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pC(e,t){for(var r=[],i=e.toArray(),n=t.toArray(),a=0;a<i.length;a++)r[a]=i[a]+n[a];return new ns().fromArray(r)}function pT(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function pI(e,t){if(e){if("string"==typeof e)return pT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pT(e,t)}}function pM(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,i,n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}}(e,t)||pI(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pR(e){return function(e){if(Array.isArray(e))return pT(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||pI(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pB(e,t,r){return(pB=!function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&pw(n,r.prototype),n}:Reflect.construct).apply(null,arguments)}var pD=new nt,pP=new nt;function pL(e){var t,r,i,n,a,s,o,l,u=pM(e.map(function(e){return Array.isArray(e)?pB(nt,pR(e)):e}),3),c=u[0],h=u[1],d=u[2];if(0===(i=(r=pM((t=e)[0],2))[0],n=r[1],s=(a=pM(t[1],2))[0],o=a[1],function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8];return i*o*h+n*l*u+a*s*c-a*o*u-n*s*h-i*l*c}(i,n,1,s,o,1,(l=pM(t[2],2))[0],l[1],1)))return!1;var f=pD.subVectors(h,c);return pP.subVectors(d,c).cross(f)>0}function pk(e,t,r){return Math.max(t,Math.min(r,e))}function pF(e,t){return pk(e-Math.floor(e/t)*t,0,t)}function pO(e,t){var r=pF(t-e,2*Math.PI);return r>Math.PI&&(r-=2*Math.PI),r}function pU(e,t){return e.x===t.x?void 0!==e.z&&e.y===t.y?e.z-t.z:e.y-t.y:e.x-t.x}function pN(e,t,r){return(r-e)/(t-e)}function pz(e,t){var r=new ni().crossVectors(e,t),i=e.dot(t),n=new ns().identity(),a=new ns().set(0,-r.z,r.y,r.z,0,-r.x,-r.y,r.x,0),s=new ns().multiplyMatrices(a,a).multiplyScalar(1/(1+i));return pC(pC(n,a),s)}var pG=Object.freeze({__proto__:null,clamp:pk,repeat:pF,deltaAngle:pO,degToRad:function(e){return e/180*Math.PI},radToDeg:function(e){return 180*e/Math.PI},fibonacciOnSphere:function(e,t){for(var r=t.radius,i=void 0===r?1:r,n=e.length/3,a=2/n,s=Math.PI*(3-2.2360679775),o=0;o<e.length;o+=3){var l=o*a-1+a/2,u=Math.sqrt(1-Math.pow(l,2)),c=o%n*s,h=Math.cos(c)*u,d=Math.sin(c)*u;e[o]=h*i,e[o+1]=l*i,e[o+2]=d*i}},vectorEquals:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return Math.abs(e.x-t.x)<r&&Math.abs(e.y-t.y)<r&&Math.abs(e.z-t.z)<r},lexicographic:pU,convexHull:function(e){for(var t=e.sort(pU),r=[t[0],t[1]],i=2;i<t.length;i++)for(r.push(t[i]);r.length>2&&pL(pR(r.slice(-3)));)r.splice(r.length-2,1);for(var n=[t[t.length-1],t[t.length-2]],a=t.length-3;a>=0;a--)for(n.push(t[a]);n.length>2&&pL(pR(n.slice(-3)));)n.splice(n.length-2,1);return n.splice(0,1),n.splice(n.length-1,1),[].concat(r,n)},remap:function(e,t,r){var i=pM(t,2),n=i[0],a=i[1],s=pM(r,2),o=s[0];return o+(e-n)*(s[1]-o)/(a-n)},fade:function(e){return e*e*e*(e*(6*e-15)+10)},lerp:function(e,t,r){return e*(1-r)+t*r},inverseLerp:pN,normalize:function(e,t,r){var i=Math.sqrt(e*e+t*t+r*r);return[e/i,t/i,r/i]},pointOnCubeToPointOnSphere:function(e,t,r){var i=e*e,n=t*t,a=r*r;return[e*Math.sqrt(1-(n+a)/2+n*a/3),t*Math.sqrt(1-(a+i)/2+a*i/3),r*Math.sqrt(1-(i+n)/2+i*n/3)]},rotateVectorOnVector:pz,pointToCoordinate:function(e,t,r){return[Math.asin(t),Math.atan2(e,-r)]},coordinateToPoint:function(e,t){var r=Math.sin(e),i=Math.cos(e);return[Math.sin(t)*i,r,-Math.cos(t)*i]},planeSegmentIntersection:function(e,t){var r=pM(t,2),i=r[0],n=r[1],a=pz(e.normal,new ni(0,1,0)),s=pN(i.clone().applyMatrix3(a).y,n.clone().applyMatrix3(a).y,0);return new ni().lerpVectors(i,n,s)},pointToPlaneDistance:function(e,t){return t.normal.dot(e)},getIndexFrom3D:function(e,t){var r=pM(e,3),i=r[0],n=r[1],a=r[2],s=pM(t,2),o=s[0];return a*o*s[1]+n*o+i},get3DFromIndex:function(e,t){var r=pM(t,2),i=r[0],n=i*r[1],a=e/n,s=e-n*a;return[s%i,s/i,a]},getIndexFrom2D:function(e,t){return e[0]+t[0]*e[1]},get2DFromIndex:function(e,t){var r=Math.floor(e/t);return[e%t,r]}});function pH(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var pQ=function e(t,r,i){var n=this;pH(this,e),pS(this,"dot2",function(e,t){return n.x*e+n.y*t}),pS(this,"dot3",function(e,t,r){return n.x*e+n.y*t+n.z*r}),this.x=t,this.y=r,this.z=i},pV=[new pQ(1,1,0),new pQ(-1,1,0),new pQ(1,-1,0),new pQ(-1,-1,0),new pQ(1,0,1),new pQ(-1,0,1),new pQ(1,0,-1),new pQ(-1,0,-1),new pQ(0,1,1),new pQ(0,-1,1),new pQ(0,1,-1),new pQ(0,-1,-1)],pW=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],pj=Array(512),pY=Array(512);(function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t,r=0;r<256;r++)t=1&r?pW[r]^255&e:pW[r]^e>>8&255,pj[r]=pj[r+256]=t,pY[r]=pY[r+256]=pV[t%12]})(0);function pK(e){var t=function(e){if("number"==typeof e)e=Math.abs(e);else if("string"==typeof e){var t=e;e=0;for(var r=0;r<t.length;r++)e=(e+(r+1)*(t.charCodeAt(r)%96))%0x7fffffff}return 0===e&&(e=311),e}(e);return function(){var e=48271*t%0x7fffffff;return t=e,e/0x7fffffff}}new function e(t){var r=this;pH(this,e),pS(this,"seed",0),pS(this,"init",function(e){r.seed=e,r.value=pK(e)}),pS(this,"value",pK(this.seed)),this.init(t)}(Math.random());var pq=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function pX(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.25,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.01,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:pq,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.001,l="velocity_"+t;if(void 0===e.__damp&&(e.__damp={}),void 0===e.__damp[l]&&(e.__damp[l]=0),Math.abs(e[t]-r)<=o)return e[t]=r,!1;var u=2/(i=Math.max(1e-4,i)),c=s(u*n),h=e[t]-r,d=r,f=a*i;h=Math.min(Math.max(h,-f),f),r=e[t]-h;var p=(e.__damp[l]+u*h)*n;e.__damp[l]=(e.__damp[l]-u*p)*c;var m=r+(h+p)*c;return d-e[t]>0==m>d&&(m=d,e.__damp[l]=(m-d)/n),e[t]=m,!0}var p$=new ni,pJ=new nr,pZ=new nr,p0=new n8,p1=new ni;function p2(e,t,r,i,n,a,s,o){return pX(e,t,e[t]+pO(e[t],r),i,n,a,s,o)}var p3=new nt,p4=new ni;function p5(e,t,r,i,n,a,s){return"number"==typeof t?p4.setScalar(t):Array.isArray(t)?p4.set(t[0],t[1],t[2]):p4.copy(t),eo=pX(e,"x",p4.x,r,i,n,a,s),el=pX(e,"y",p4.y,r,i,n,a,s),eu=pX(e,"z",p4.z,r,i,n,a,s),eo||el||eu}var p6=new nT,p8=new ao,p9=new aQ,p7=new nr,me=new nT,mt=new nT,mr=new nT;function mi(e,t,r,i,n,a,s){Array.isArray(t)?p7.set(t[0],t[1],t[2],t[3]):p7.copy(t);var o=e.dot(p7)>0?1:-1;return p7.x*=o,p7.y*=o,p7.z*=o,p7.w*=o,eE=pX(e,"x",p7.x,r,i,n,a,s),ex=pX(e,"y",p7.y,r,i,n,a,s),e_=pX(e,"z",p7.z,r,i,n,a,s),eb=pX(e,"w",p7.w,r,i,n,a,s),me.set(e.x,e.y,e.z,e.w).normalize(),mt.set(e.__damp.velocity_x,e.__damp.velocity_y,e.__damp.velocity_z,e.__damp.velocity_w),mr.copy(me).multiplyScalar(mt.dot(me)/me.dot(me)),e.__damp.velocity_x-=mr.x,e.__damp.velocity_y-=mr.y,e.__damp.velocity_z-=mr.z,e.__damp.velocity_w-=mr.w,e.set(me.x,me.y,me.z,me.w),eE||ex||e_||eb}var mn=new hv,ma=new n8,ms=new ni,mo=new nr,ml=new ni,mu=Object.freeze({__proto__:null,rsqw:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*i)/t)},exp:pq,linear:function(e){return e},sine:{in:function(e){return 1-Math.cos(e*Math.PI/2)},out:function(e){return Math.sin(e*Math.PI/2)},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},cubic:{in:function(e){return e*e*e},out:function(e){return 1-Math.pow(1-e,3)},inOut:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}},quint:{in:function(e){return e*e*e*e*e},out:function(e){return 1-Math.pow(1-e,5)},inOut:function(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}},circ:{in:function(e){return 1-Math.sqrt(1-Math.pow(e,2))},out:function(e){return Math.sqrt(1-Math.pow(e-1,2))},inOut:function(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}},quart:{in:function(e){return e*e*e*e},out:function(e){return 1- --e*e*e*e},inOut:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}},expo:{in:function(e){return 0===e?0:Math.pow(2,10*e-10)},out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},inOut:function(e){return 0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}},damp:pX,dampLookAt:function(e,t,r,i,n,a,s){"number"==typeof t?p$.setScalar(t):Array.isArray(t)?p$.set(t[0],t[1],t[2]):p$.copy(t);var o=e.parent;(e.updateWorldMatrix(!0,!1),p1.setFromMatrixPosition(e.matrixWorld),e&&e.isCamera||e&&e.isLight)?p0.lookAt(p1,p$,e.up):p0.lookAt(p$,p1,e.up),mi(e.quaternion,pZ.setFromRotationMatrix(p0),r,i,n,a,s),o&&(p0.extractRotation(o.matrixWorld),pJ.setFromRotationMatrix(p0),mi(e.quaternion,pZ.copy(e.quaternion).premultiply(pJ.invert()),r,i,n,a,s))},dampAngle:p2,damp2:function(e,t,r,i,n,a,s){return"number"==typeof t?p3.setScalar(t):Array.isArray(t)?p3.set(t[0],t[1]):p3.copy(t),ea=pX(e,"x",p3.x,r,i,n,a,s),es=pX(e,"y",p3.y,r,i,n,a,s),ea||es},damp3:p5,damp4:function(e,t,r,i,n,a,s){return"number"==typeof t?p6.setScalar(t):Array.isArray(t)?p6.set(t[0],t[1],t[2],t[3]):p6.copy(t),ec=pX(e,"x",p6.x,r,i,n,a,s),eh=pX(e,"y",p6.y,r,i,n,a,s),ed=pX(e,"z",p6.z,r,i,n,a,s),ef=pX(e,"w",p6.w,r,i,n,a,s),ec||eh||ed||ef},dampE:function(e,t,r,i,n,a,s){return Array.isArray(t)?p8.set(t[0],t[1],t[2],t[3]):p8.copy(t),ep=p2(e,"x",p8.x,r,i,n,a,s),em=p2(e,"y",p8.y,r,i,n,a,s),eg=p2(e,"z",p8.z,r,i,n,a,s),ep||em||eg},dampC:function(e,t,r,i,n,a,s){return t instanceof aQ?p9.copy(t):Array.isArray(t)?p9.setRGB(t[0],t[1],t[2]):p9.set(t),eA=pX(e,"r",p9.r,r,i,n,a,s),ev=pX(e,"g",p9.g,r,i,n,a,s),ey=pX(e,"b",p9.b,r,i,n,a,s),eA||ev||ey},dampQ:mi,dampS:function(e,t,r,i,n,a,s){return Array.isArray(t)?mn.set(t[0],t[1],t[2]):mn.copy(t),eS=pX(e,"radius",mn.radius,r,i,n,a,s),ew=p2(e,"phi",mn.phi,r,i,n,a,s),eC=p2(e,"theta",mn.theta,r,i,n,a,s),eS||ew||eC},dampM:function(e,t,r,i,n,a,s){return void 0===e.__damp&&(e.__damp={position:new ni,rotation:new nr,scale:new ni},e.decompose(e.__damp.position,e.__damp.rotation,e.__damp.scale)),Array.isArray(t)?ma.set.apply(ma,pR(t)):ma.copy(t),ma.decompose(ms,mo,ml),eT=p5(e.__damp.position,ms,r,i,n,a,s),eI=mi(e.__damp.rotation,mo,r,i,n,a,s),eM=p5(e.__damp.scale,ml,r,i,n,a,s),e.compose(e.__damp.position,e.__damp.rotation,e.__damp.scale),eT||eI||eM}});let mc=eN.createContext(null);function mh(){return eN.useContext(mc)}function md({eps:e=1e-5,enabled:t=!0,infinite:r,horizontal:i,pages:n=1,distance:a=1,damping:s=.25,maxSpeed:o=1/0,prepend:l=!1,style:u={},children:c}){let{get:h,setEvents:d,gl:f,size:p,invalidate:m,events:g}=dY(),[A]=eN.useState(()=>document.createElement("div")),[v]=eN.useState(()=>document.createElement("div")),[y]=eN.useState(()=>document.createElement("div")),E=f.domElement.parentNode,x=eN.useRef(0),_=eN.useMemo(()=>({el:A,eps:e,fill:v,fixed:y,horizontal:i,damping:s,offset:0,delta:0,scroll:x,pages:n,range(e,t,r=0){let i=e-r,n=i+t+2*r;return this.offset<i?0:this.offset>n?1:(this.offset-i)/(n-i)},curve(e,t,r=0){return Math.sin(this.range(e,t,r)*Math.PI)},visible(e,t,r=0){let i=e-r;return this.offset>=i&&this.offset<=i+t+2*r}}),[e,s,i,n]);eN.useEffect(()=>{for(let e in A.style.position="absolute",A.style.width="100%",A.style.height="100%",A.style[i?"overflowX":"overflowY"]="auto",A.style[i?"overflowY":"overflowX"]="hidden",A.style.top="0px",A.style.left="0px",u)A.style[e]=u[e];y.style.position="sticky",y.style.top="0px",y.style.left="0px",y.style.width="100%",y.style.height="100%",y.style.overflow="hidden",A.appendChild(y),v.style.height=i?"100%":`${n*a*100}%`,v.style.width=i?`${n*a*100}%`:"100%",v.style.pointerEvents="none",A.appendChild(v),l?E.prepend(A):E.appendChild(A),A[i?"scrollLeft":"scrollTop"]=1;let e=g.connected||f.domElement;requestAnimationFrame(()=>null==g.connect?void 0:g.connect(A));let t=h().events.compute;return d({compute(e,t){let{left:r,top:i}=E.getBoundingClientRect(),n=e.clientX-r,a=e.clientY-i;t.pointer.set(n/t.size.width*2-1,-(2*(a/t.size.height))+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{E.removeChild(A),d({compute:t}),null==g.connect||g.connect(e)}},[n,a,i,A,v,y,E]),eN.useEffect(()=>{if(g.connected===A){let e=p[i?"width":"height"],n=A[i?"scrollWidth":"scrollHeight"],a=n-e,s=0,o=!0,l=!0,u=()=>{if(t&&!l&&(m(),s=A[i?"scrollLeft":"scrollTop"],x.current=s/a,r)){if(!o){if(s>=a){let e=1-_.offset;A[i?"scrollLeft":"scrollTop"]=1,x.current=_.offset=-e,o=!0}else if(s<=0){let e=1+_.offset;A[i?"scrollLeft":"scrollTop"]=n,x.current=_.offset=e,o=!0}}o&&setTimeout(()=>o=!1,40)}};A.addEventListener("scroll",u,{passive:!0}),requestAnimationFrame(()=>l=!1);let c=e=>A.scrollLeft+=e.deltaY/2;return i&&A.addEventListener("wheel",c,{passive:!0}),()=>{A.removeEventListener("scroll",u),i&&A.removeEventListener("wheel",c)}}},[A,g,p,r,_,m,i,t]);let b=0;return dK((t,r)=>{b=_.offset,mu.damp(_,"offset",x.current,s,r,o,void 0,e),mu.damp(_,"delta",Math.abs(b-_.offset),s,r,o,void 0,e),_.delta>e&&m()}),eN.createElement(mc.Provider,{value:_},c)}let mf=eN.forwardRef(({children:e},t)=>{let r=eN.useRef(null);eN.useImperativeHandle(t,()=>r.current,[]);let i=mh(),{width:n,height:a}=dY(e=>e.viewport);return dK(()=>{r.current.position.x=i.horizontal?-n*(i.pages-1)*i.offset:0,r.current.position.y=i.horizontal?0:a*(i.pages-1)*i.offset}),eN.createElement("group",{ref:r},e)}),mp=eN.forwardRef(({children:e,style:t,...r},i)=>{let n=mh(),a=eN.useRef(null);eN.useImperativeHandle(i,()=>a.current,[]);let{width:s,height:o}=dY(e=>e.size),l=eN.useContext(dF),u=eN.useMemo(()=>eG.createRoot(n.fixed),[n.fixed]);return dK(()=>{n.delta>n.eps&&(a.current.style.transform=`translate3d(${n.horizontal?-s*(n.pages-1)*n.offset:0}px,${n.horizontal?0:-(o*(n.pages-1)*n.offset)}px,0)`)}),u.render(eN.createElement("div",eU({ref:a,style:{...t,position:"absolute",top:0,left:0,willChange:"transform"}},r),eN.createElement(mc.Provider,{value:n},eN.createElement(dF.Provider,{value:l},e)))),null}),mm=eN.forwardRef(({html:e,...t},r)=>eN.createElement(e?mp:mf,eU({ref:r},t)));var mg=mD(),mA=e=>mI(e,mg),mv=mD();mA.write=e=>mI(e,mv);var my=mD();mA.onStart=e=>mI(e,my);var mE=mD();mA.onFrame=e=>mI(e,mE);var mx=mD();mA.onFinish=e=>mI(e,mx);var m_=[];mA.setTimeout=(e,t)=>{let r=mA.now()+t,i=()=>{let e=m_.findIndex(e=>e.cancel==i);~e&&m_.splice(e,1),mC-=~e?1:0},n={time:r,handler:e,cancel:i};return m_.splice(mb(r),0,n),mC+=1,mM(),n};var mb=e=>~(~m_.findIndex(t=>t.time>e)||~m_.length);mA.cancel=e=>{my.delete(e),mE.delete(e),mx.delete(e),mg.delete(e),mv.delete(e)},mA.sync=e=>{mT=!0,mA.batchedUpdates(e),mT=!1},mA.throttle=e=>{let t;function r(){try{e(...t)}finally{t=null}}function i(...e){t=e,mA.onStart(r)}return i.handler=e,i.cancel=()=>{my.delete(r),t=null},i};var mS="undefined"!=typeof window?window.requestAnimationFrame:()=>{};mA.use=e=>mS=e,mA.now="undefined"!=typeof performance?()=>performance.now():Date.now,mA.batchedUpdates=e=>e(),mA.catch=console.error,mA.frameLoop="always",mA.advance=()=>{"demand"!==mA.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):mB()};var mw=-1,mC=0,mT=!1;function mI(e,t){mT?(t.delete(e),e(0)):(t.add(e),mM())}function mM(){mw<0&&(mw=0,"demand"!==mA.frameLoop&&mS(mR))}function mR(){~mw&&(mS(mR),mA.batchedUpdates(mB))}function mB(){let e=mw,t=mb(mw=mA.now());if(t&&(mP(m_.splice(0,t),e=>e.handler()),mC-=t),!mC){mw=-1;return}my.flush(),mg.flush(e?Math.min(64,mw-e):16.667),mE.flush(),mv.flush(),mx.flush()}function mD(){let e=new Set,t=e;return{add(r){mC+=t!=e||e.has(r)?0:1,e.add(r)},delete:r=>(mC-=t==e&&e.has(r)?1:0,e.delete(r)),flush(r){t.size&&(e=new Set,mC-=t.size,mP(t,t=>t(r)&&e.add(t)),mC+=e.size,t=e)}}}function mP(e,t){e.forEach(e=>{try{t(e)}catch(e){mA.catch(e)}})}var mL=Object.defineProperty,mk={};function mF(){}((e,t)=>{for(var r in t)mL(e,r,{get:t[r],enumerable:!0})})(mk,{assign:()=>mq,colors:()=>mj,createStringInterpolator:()=>eR,skipAnimation:()=>mY,to:()=>eB,willAdvance:()=>mK});var mO=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),mU={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};function mN(e,t){if(mU.arr(e)){if(!mU.arr(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return e===t}var mz=(e,t)=>e.forEach(t);function mG(e,t,r){if(mU.arr(e)){for(let i=0;i<e.length;i++)t.call(r,e[i],`${i}`);return}for(let i in e)e.hasOwnProperty(i)&&t.call(r,e[i],i)}var mH=e=>mU.und(e)?[]:mU.arr(e)?e:[e];function mQ(e,t){if(e.size){let r=Array.from(e);e.clear(),mz(r,t)}}var mV=(e,...t)=>mQ(e,e=>e(...t)),mW=()=>"undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),mj=null,mY=!1,mK=mF,mq=e=>{e.to&&(eB=e.to),e.now&&(mA.now=e.now),void 0!==e.colors&&(mj=e.colors),null!=e.skipAnimation&&(mY=e.skipAnimation),e.createStringInterpolator&&(eR=e.createStringInterpolator),e.requestAnimationFrame&&mA.use(e.requestAnimationFrame),e.batchedUpdates&&(mA.batchedUpdates=e.batchedUpdates),e.willAdvance&&(mK=e.willAdvance),e.frameLoop&&(mA.frameLoop=e.frameLoop)},mX=new Set,m$=[],mJ=[],mZ=0,m0={get idle(){return!mX.size&&!m$.length},start(e){mZ>e.priority?(mX.add(e),mA.onStart(m1)):(m2(e),mA(m4))},advance:m4,sort(e){if(mZ)mA.onFrame(()=>m0.sort(e));else{let t=m$.indexOf(e);~t&&(m$.splice(t,1),m3(e))}},clear(){m$=[],mX.clear()}};function m1(){mX.forEach(m2),mX.clear(),mA(m4)}function m2(e){m$.includes(e)||m3(e)}function m3(e){m$.splice(function(e,t){let r=e.findIndex(t);return r<0?e.length:r}(m$,t=>t.priority>e.priority),0,e)}function m4(e){let t=mJ;for(let r=0;r<m$.length;r++){let i=m$[r];mZ=i.priority,i.idle||(mK(i),i.advance(e),i.idle||t.push(i))}return mZ=0,(mJ=m$).length=0,(m$=t).length>0}var m5="[-+]?\\d*\\.?\\d+",m6=m5+"%";function m8(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}var m9=RegExp("rgb"+m8(m5,m5,m5)),m7=RegExp("rgba"+m8(m5,m5,m5,m5)),ge=RegExp("hsl"+m8(m5,m6,m6)),gt=RegExp("hsla"+m8(m5,m6,m6,m5)),gr=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,gi=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,gn=/^#([0-9a-fA-F]{6})$/,ga=/^#([0-9a-fA-F]{8})$/;function gs(e,t,r){return(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function go(e,t,r){let i=r<.5?r*(1+t):r+t-r*t,n=2*r-i;return Math.round(255*gs(n,i,e+1/3))<<24|Math.round(255*gs(n,i,e))<<16|Math.round(255*gs(n,i,e-1/3))<<8}function gl(e){let t=parseInt(e,10);return t<0?0:t>255?255:t}function gu(e){return(parseFloat(e)%360+360)%360/360}function gc(e){let t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function gh(e){let t=parseFloat(e);return t<0?0:t>100?1:t/100}function gd(e){let t;let r="number"==typeof e?e>>>0===e&&e>=0&&e<=0xffffffff?e:null:(t=gn.exec(e))?parseInt(t[1]+"ff",16)>>>0:mj&&void 0!==mj[e]?mj[e]:(t=m9.exec(e))?(gl(t[1])<<24|gl(t[2])<<16|gl(t[3])<<8|255)>>>0:(t=m7.exec(e))?(gl(t[1])<<24|gl(t[2])<<16|gl(t[3])<<8|gc(t[4]))>>>0:(t=gr.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=ga.exec(e))?parseInt(t[1],16)>>>0:(t=gi.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=ge.exec(e))?(255|go(gu(t[1]),gh(t[2]),gh(t[3])))>>>0:(t=gt.exec(e))?(go(gu(t[1]),gh(t[2]),gh(t[3]))|gc(t[4]))>>>0:null;if(null===r)return e;let i=(0xff000000&(r=r||0))>>>24,n=(0xff0000&r)>>>16,a=(65280&r)>>>8,s=(255&r)/255;return`rgba(${i}, ${n}, ${a}, ${s})`}var gf=(e,t,r)=>{if(mU.fun(e))return e;if(mU.arr(e))return gf({range:e,output:t,extrapolate:r});if(mU.str(e.output[0]))return eR(e);let i=e.output,n=e.range||[0,1],a=e.extrapolateLeft||e.extrapolate||"extend",s=e.extrapolateRight||e.extrapolate||"extend",o=e.easing||(e=>e);return t=>{let r=function(e,t){for(var r=1;r<t.length-1&&!(t[r]>=e);++r);return r-1}(t,n);return function(e,t,r,i,n,a,s,o,l){let u=l?l(e):e;if(u<t){if("identity"===s)return u;"clamp"===s&&(u=t)}if(u>r){if("identity"===o)return u;"clamp"===o&&(u=r)}return i===n?i:t===r?e<=t?i:n:(t===-1/0?u=-u:r===1/0?u-=t:u=(u-t)/(r-t),u=a(u),i===-1/0?u=-u:n===1/0?u+=i:u=u*(n-i)+i,u)}(t,n[r],n[r+1],i[r],i[r+1],o,a,s,e.map)}},gp=Symbol.for("FluidValue.get"),gm=Symbol.for("FluidValue.observers"),gg=e=>!!(e&&e[gp]),gA=e=>e&&e[gp]?e[gp]():e,gv=e=>e[gm]||null;function gy(e,t){let r=e[gm];r&&r.forEach(e=>{e.eventObserved?e.eventObserved(t):e(t)})}var gE=class{constructor(e){if(!e&&!(e=this.get))throw Error("Unknown getter");gx(this,e)}},gx=(e,t)=>gS(e,gp,t);function g_(e,t){if(e[gp]){let r=e[gm];r||gS(e,gm,r=new Set),!r.has(t)&&(r.add(t),e.observerAdded&&e.observerAdded(r.size,t))}return t}function gb(e,t){let r=e[gm];if(r&&r.has(t)){let i=r.size-1;i?r.delete(t):e[gm]=null,e.observerRemoved&&e.observerRemoved(i,t)}}var gS=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),gw=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,gC=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,gT=RegExp(`(${gw.source})(%|[a-z]+)`,"i"),gI=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,gM=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,gR=e=>{let[t,r]=gB(e);if(!t||mW())return e;let i=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(i)return i.trim();if(r&&r.startsWith("--")){let e=window.getComputedStyle(document.documentElement).getPropertyValue(r);if(e)return e}else if(r&&gM.test(r))return gR(r);else if(r)return r;return e},gB=e=>{let t=gM.exec(e);if(!t)return[,];let[,r,i]=t;return[r,i]},gD=(e,t,r,i,n)=>`rgba(${Math.round(t)}, ${Math.round(r)}, ${Math.round(i)}, ${n})`,gP=e=>{eD||(eD=mj?RegExp(`(${Object.keys(mj).join("|")})(?!\\w)`,"g"):/^\b$/);let t=e.output.map(e=>gA(e).replace(gM,gR).replace(gC,gd).replace(eD,gd)),r=t.map(e=>e.match(gw).map(Number)),i=r[0].map((e,t)=>r.map(e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})).map(t=>gf({...e,output:t}));return e=>{let r=!gT.test(t[0])&&t.find(e=>gT.test(e))?.replace(gw,""),n=0;return t[0].replace(gw,()=>`${i[n++](e)}${r||""}`).replace(gI,gD)}},gL="react-spring: ",gk=e=>{let t=!1;if("function"!=typeof e)throw TypeError(`${gL}once requires a function parameter`);return(...r)=>{t||(e(...r),t=!0)}},gF=gk(console.warn),gO=gk(console.warn);function gU(e){return mU.str(e)&&("#"==e[0]||/\d/.test(e)||!mW()&&gM.test(e)||e in(mj||{}))}var gN=new WeakMap,gz=new Set,gG=()=>{let e=()=>{gz.forEach(e=>e({width:window.innerWidth,height:window.innerHeight}))};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},gH=mW()?eN.useEffect:eN.useLayoutEffect,gQ=()=>{let e=(0,eN.useRef)(!1);return gH(()=>(e.current=!0,()=>{e.current=!1}),[]),e};function gV(){let e=(0,eN.useState)()[1],t=gQ();return()=>{t.current&&e(Math.random())}}var gW=e=>(0,eN.useEffect)(e,gj),gj=[];function gY(e){let t=(0,eN.useRef)();return(0,eN.useEffect)(()=>{t.current=e}),t.current}var gK=Symbol.for("Animated:node"),gq=e=>!!e&&e[gK]===e,gX=e=>e&&e[gK],g$=(e,t)=>mO(e,gK,t),gJ=e=>e&&e[gK]&&e[gK].getPayload(),gZ=class{constructor(){g$(this,this)}getPayload(){return this.payload||[]}},g0=class extends gZ{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,mU.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new g0(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return mU.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){let{done:e}=this;this.done=!1,mU.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},g1=class extends g0{constructor(e){super(0),this._string=null,this._toString=gf({output:[e,e]})}static create(e){return new g1(e)}getValue(){let e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(mU.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=gf({output:[this.getValue(),e]})),this._value=0,super.reset()}},g2={dependencies:null},g3=class extends gZ{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){let t={};return mG(this.source,(r,i)=>{gq(r)?t[i]=r.getValue(e):gg(r)?t[i]=gA(r):e||(t[i]=r)}),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&mz(this.payload,e=>e.reset())}_makePayload(e){if(e){let t=new Set;return mG(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){g2.dependencies&&gg(e)&&g2.dependencies.add(e);let t=gJ(e);t&&mz(t,e=>this.add(e))}},g4=class extends g3{constructor(e){super(e)}static create(e){return new g4(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){let t=this.getPayload();return e.length==t.length?t.map((t,r)=>t.setValue(e[r])).some(Boolean):(super.setValue(e.map(g5)),!0)}};function g5(e){return(gU(e)?g1:g0).create(e)}function g6(e){let t=gX(e);return t?t.constructor:mU.arr(e)?g4:gU(e)?g1:g0}var g8=(e,t)=>{let r=!mU.fun(e)||e.prototype&&e.prototype.isReactComponent;return(0,eN.forwardRef)((i,n)=>{let a=(0,eN.useRef)(null),s=r&&(0,eN.useCallback)(e=>{a.current=function(e,t){return e&&(mU.fun(e)?e(t):e.current=t),t}(n,e)},[n]),[o,l]=function(e,t){let r=new Set;return g2.dependencies=r,e.style&&(e={...e,style:t.createAnimatedStyle(e.style)}),e=new g3(e),g2.dependencies=null,[e,r]}(i,t),u=gV(),c=()=>{let e=a.current;(!r||e)&&!1===(!!e&&t.applyAnimatedValues(e,o.getValue(!0)))&&u()},h=new g9(c,l),d=(0,eN.useRef)();gH(()=>(d.current=h,mz(l,e=>g_(e,h)),()=>{d.current&&(mz(d.current.deps,e=>gb(e,d.current)),mA.cancel(d.current.update))})),(0,eN.useEffect)(c,[]),gW(()=>()=>{let e=d.current;mz(e.deps,t=>gb(t,e))});let f=t.getComponentProps(o.getValue());return eN.createElement(e,{...f,ref:s})})},g9=class{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&mA.write(this.update)}},g7=Symbol.for("AnimatedComponent"),Ae=e=>mU.str(e)?e:e&&mU.str(e.displayName)?e.displayName:mU.fun(e)&&e.name||null;function At(e,...t){return mU.fun(e)?e(...t):e}var Ar=(e,t)=>!0===e||!!(t&&e&&(mU.fun(e)?e(t):mH(e).includes(t))),Ai=(e,t)=>mU.obj(e)?t&&e[t]:e,An=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,Aa=e=>e,As=(e,t=Aa)=>{let r=Ao;e.default&&!0!==e.default&&(r=Object.keys(e=e.default));let i={};for(let n of r){let r=t(e[n],n);mU.und(r)||(i[n]=r)}return i},Ao=["config","onProps","onStart","onChange","onPause","onResume","onRest"],Al={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function Au(e){let t=function(e){let t={},r=0;if(mG(e,(e,i)=>{!Al[i]&&(t[i]=e,r++)}),r)return t}(e);if(t){let r={to:t};return mG(e,(e,i)=>i in t||(r[i]=e)),r}return{...e}}function Ac(e){return e=gA(e),mU.arr(e)?e.map(Ac):gU(e)?mk.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function Ah(e){return mU.fun(e)||mU.arr(e)&&mU.obj(e[0])}var Ad={tension:170,friction:26,mass:1,damping:1,easing:e=>e,clamp:!1},Af=class{constructor(){this.velocity=0,Object.assign(this,Ad)}};function Ap(e,t){if(mU.und(t.decay)){let r=!mU.und(t.tension)||!mU.und(t.friction);!r&&mU.und(t.frequency)&&mU.und(t.damping)&&mU.und(t.mass)||(e.duration=void 0,e.decay=void 0),r&&(e.frequency=void 0)}else e.duration=void 0}var Am=[],Ag=class{constructor(){this.changed=!1,this.values=Am,this.toValues=null,this.fromValues=Am,this.config=new Af,this.immediate=!1}};function AA(e,{key:t,props:r,defaultProps:i,state:n,actions:a}){return new Promise((s,o)=>{let l,u;let c=Ar(r.cancel??i?.cancel,t);if(c)f();else{mU.und(r.pause)||(n.paused=Ar(r.pause,t));let e=i?.pause;!0!==e&&(e=n.paused||Ar(e,t)),l=At(r.delay||0,t),e?(n.resumeQueue.add(d),a.pause()):(a.resume(),d())}function h(){n.resumeQueue.add(d),n.timeouts.delete(u),u.cancel(),l=u.time-mA.now()}function d(){l>0&&!mk.skipAnimation?(n.delayed=!0,u=mA.setTimeout(f,l),n.pauseQueue.add(h),n.timeouts.add(u)):f()}function f(){n.delayed&&(n.delayed=!1),n.pauseQueue.delete(h),n.timeouts.delete(u),e<=(n.cancelId||0)&&(c=!0);try{a.start({...r,callId:e,cancel:c},s)}catch(e){o(e)}}})}var Av=(e,t)=>1==t.length?t[0]:t.some(e=>e.cancelled)?Ax(e.get()):t.every(e=>e.noop)?Ay(e.get()):AE(e.get(),t.every(e=>e.finished)),Ay=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),AE=(e,t,r=!1)=>({value:e,finished:t,cancelled:r}),Ax=e=>({value:e,cancelled:!0,finished:!1});function A_(e,t,r,i){let{callId:n,parentId:a,onRest:s}=t,{asyncTo:o,promise:l}=r;return a||e!==o||t.reset?r.promise=(async()=>{let u,c,h;r.asyncId=n,r.asyncTo=e;let d=As(t,(e,t)=>"onRest"===t?void 0:e),f=new Promise((e,t)=>(u=e,c=t)),p=e=>{let t=n<=(r.cancelId||0)&&Ax(i)||n!==r.asyncId&&AE(i,!1);if(t)throw e.result=t,c(e),e},m=(e,t)=>{let a=new AS,s=new Aw;return(async()=>{if(mk.skipAnimation)throw Ab(r),s.result=AE(i,!1),c(s),s;p(a);let o=mU.obj(e)?{...e}:{...t,to:e};o.parentId=n,mG(d,(e,t)=>{mU.und(o[t])&&(o[t]=e)});let l=await i.start(o);return p(a),r.paused&&await new Promise(e=>{r.resumeQueue.add(e)}),l})()};if(mk.skipAnimation)return Ab(r),AE(i,!1);try{let t;t=mU.arr(e)?(async e=>{for(let t of e)await m(t)})(e):Promise.resolve(e(m,i.stop.bind(i))),await Promise.all([t.then(u),f]),h=AE(i.get(),!0,!1)}catch(e){if(e instanceof AS)h=e.result;else if(e instanceof Aw)h=e.result;else throw e}finally{n==r.asyncId&&(r.asyncId=a,r.asyncTo=a?o:void 0,r.promise=a?l:void 0)}return mU.fun(s)&&mA.batchedUpdates(()=>{s(h,i,i.item)}),h})():l}function Ab(e,t){mQ(e.timeouts,e=>e.cancel()),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}var AS=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},Aw=class extends Error{constructor(){super("SkipAnimationSignal")}},AC=e=>e instanceof AI,AT=1,AI=class extends gE{constructor(){super(...arguments),this.id=AT++,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){let e=gX(this);return e&&e.getValue()}to(...e){return mk.to(this,e)}interpolate(...e){return gF(`${gL}The "interpolate" function is deprecated in v9 (use "to" instead)`),mk.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){gy(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||m0.sort(this),gy(this,{type:"priority",parent:this,priority:e})}},AM=Symbol.for("SpringPhase"),AR=e=>(1&e[AM])>0,AB=e=>(2&e[AM])>0,AD=e=>(4&e[AM])>0,AP=(e,t)=>t?e[AM]|=3:e[AM]&=-3,AL=(e,t)=>t?e[AM]|=4:e[AM]&=-5,Ak=class extends AI{constructor(e,t){if(super(),this.animation=new Ag,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!mU.und(e)||!mU.und(t)){let r=mU.obj(e)?{...e}:{...t,from:e};mU.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!(AB(this)||this._state.asyncTo)||AD(this)}get goal(){return gA(this.animation.to)}get velocity(){let e=gX(this);return e instanceof g0?e.lastVelocity||0:e.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return AR(this)}get isAnimating(){return AB(this)}get isPaused(){return AD(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,r=!1,i=this.animation,{toValues:n}=i,{config:a}=i,s=gJ(i.to);!s&&gg(i.to)&&(n=mH(gA(i.to))),i.values.forEach((o,l)=>{if(o.done)return;let u=o.constructor==g1?1:s?s[l].lastPosition:n[l],c=i.immediate,h=u;if(!c){let t;if(h=o.lastPosition,a.tension<=0){o.done=!0;return}let r=o.elapsedTime+=e,n=i.fromValues[l],s=null!=o.v0?o.v0:o.v0=mU.arr(a.velocity)?a.velocity[l]:a.velocity,d=a.precision||(n==u?.005:Math.min(1,.001*Math.abs(u-n)));if(mU.und(a.duration)){if(a.decay){let e=!0===a.decay?.998:a.decay,i=Math.exp(-(1-e)*r);h=n+s/(1-e)*(1-i),c=Math.abs(o.lastPosition-h)<=d,t=s*i}else{t=null==o.lastVelocity?s:o.lastVelocity;let r=a.restVelocity||d/10,i=a.clamp?0:a.bounce,l=!mU.und(i),f=n==u?o.v0>0:n<u,p=Math.ceil(e/1);for(let e=0;e<p&&!(!(Math.abs(t)>r)&&(c=Math.abs(u-h)<=d));++e){l&&(h==u||h>u==f)&&(t=-t*i,h=u);let e=(-(1e-6*a.tension)*(h-u)+-(.001*a.friction)*t)/a.mass;t+=1*e,h+=1*t}}}else{let i=1;a.duration>0&&(this._memoizedDuration!==a.duration&&(this._memoizedDuration=a.duration,o.durationProgress>0&&(o.elapsedTime=a.duration*o.durationProgress,r=o.elapsedTime+=e)),i=(i=(a.progress||0)+r/this._memoizedDuration)>1?1:i<0?0:i,o.durationProgress=i),t=((h=n+a.easing(i)*(u-n))-o.lastPosition)/e,c=1==i}o.lastVelocity=t,Number.isNaN(h)&&(console.warn("Got NaN while animating:",this),c=!0)}s&&!s[l].done&&(c=!1),c?o.done=!0:t=!1,o.setValue(h,a.round)&&(r=!0)});let o=gX(this),l=o.getValue();if(t){let e=gA(i.to);(l!==e||r)&&!a.decay?(o.setValue(e),this._onChange(e)):r&&a.decay&&this._onChange(l),this._stop()}else r&&this._onChange(l)}set(e){return mA.batchedUpdates(()=>{this._stop(),this._focus(e),this._set(e)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(AB(this)){let{to:e,config:t}=this.animation;mA.batchedUpdates(()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()})}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let r;return mU.und(e)?(r=this.queue||[],this.queue=[]):r=[mU.obj(e)?e:{...t,to:e}],Promise.all(r.map(e=>this._update(e))).then(e=>Av(this,e))}stop(e){let{to:t}=this.animation;return this._focus(this.get()),Ab(this._state,e&&this._lastCallId),mA.batchedUpdates(()=>this._stop(t,e)),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){let t=this.key||"",{to:r,from:i}=e;(null==(r=mU.obj(r)?r[t]:r)||Ah(r))&&(r=void 0),null==(i=mU.obj(i)?i[t]:i)&&(i=void 0);let n={to:r,from:i};return AR(this)||(e.reverse&&([r,i]=[i,r]),i=gA(i),mU.und(i)?gX(this)||this._set(r):this._set(i)),n}_update({...e},t){let{key:r,defaultProps:i}=this;e.default&&Object.assign(i,As(e,(e,t)=>/^on/.test(t)?Ai(e,r):e)),AG(this,e,"onProps"),AH(this,"onProps",e,this);let n=this._prepareNode(e);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");let a=this._state;return AA(++this._lastCallId,{key:r,props:e,defaultProps:i,state:a,actions:{pause:()=>{AD(this)||(AL(this,!0),mV(a.pauseQueue),AH(this,"onPause",AE(this,AF(this,this.animation.to)),this))},resume:()=>{AD(this)&&(AL(this,!1),AB(this)&&this._resume(),mV(a.resumeQueue),AH(this,"onResume",AE(this,AF(this,this.animation.to)),this))},start:this._merge.bind(this,n)}}).then(r=>{if(e.loop&&r.finished&&!(t&&r.noop)){let t=AO(e);if(t)return this._update(t,!0)}return r})}_merge(e,t,r){if(t.cancel)return this.stop(!0),r(Ax(this));let i=!mU.und(e.to),n=!mU.und(e.from);if(i||n){if(!(t.callId>this._lastToId))return r(Ax(this));this._lastToId=t.callId}let{key:a,defaultProps:s,animation:o}=this,{to:l,from:u}=o,{to:c=l,from:h=u}=e;n&&!i&&(!t.default||mU.und(c))&&(c=h),t.reverse&&([c,h]=[h,c]);let d=!mN(h,u);d&&(o.from=h),h=gA(h);let f=!mN(c,l);f&&this._focus(c);let p=Ah(t.to),{config:m}=o,{decay:g,velocity:A}=m;(i||n)&&(m.velocity=0),t.config&&!p&&function(e,t,r){for(let i in r&&(Ap(r={...r},t),t={...r,...t}),Ap(e,t),Object.assign(e,t),Ad)null==e[i]&&(e[i]=Ad[i]);let{frequency:i,damping:n}=e,{mass:a}=e;mU.und(i)||(i<.01&&(i=.01),n<0&&(n=0),e.tension=Math.pow(2*Math.PI/i,2)*a,e.friction=4*Math.PI*n*a/i)}(m,At(t.config,a),t.config!==s.config?At(s.config,a):void 0);let v=gX(this);if(!v||mU.und(c))return r(AE(this,!0));let y=mU.und(t.reset)?n&&!t.default:!mU.und(h)&&Ar(t.reset,a),E=y?h:this.get(),x=Ac(c),_=mU.num(x)||mU.arr(x)||gU(x),b=!p&&(!_||Ar(s.immediate||t.immediate,a));if(f){let e=g6(c);if(e!==v.constructor){if(b)v=this._set(x);else throw Error(`Cannot animate between ${v.constructor.name} and ${e.name}, as the "to" prop suggests`)}}let S=v.constructor,w=gg(c),C=!1;if(!w){let e=y||!AR(this)&&d;(f||e)&&(w=!(C=mN(Ac(E),x))),(mN(o.immediate,b)||b)&&mN(m.decay,g)&&mN(m.velocity,A)||(w=!0)}if(C&&AB(this)&&(o.changed&&!y?w=!0:w||this._stop(l)),!p&&((w||gg(l))&&(o.values=v.getPayload(),o.toValues=gg(c)?null:S==g1?[1]:mH(x)),o.immediate==b||(o.immediate=b,b||y||this._set(l)),w)){let{onRest:e}=o;mz(Az,e=>AG(this,t,e));let i=AE(this,AF(this,l));mV(this._pendingCalls,i),this._pendingCalls.add(r),o.changed&&mA.batchedUpdates(()=>{o.changed=!y,e?.(i,this),y?At(s.onRest,i):o.onStart?.(i,this)})}y&&this._set(E),p?r(A_(t.to,t,this._state,this)):w?this._start():AB(this)&&!f?this._pendingCalls.add(r):r(Ay(E))}_focus(e){let t=this.animation;e!==t.to&&(gv(this)&&this._detach(),t.to=e,gv(this)&&this._attach())}_attach(){let e=0,{to:t}=this.animation;gg(t)&&(g_(t,this),AC(t)&&(e=t.priority+1)),this.priority=e}_detach(){let{to:e}=this.animation;gg(e)&&gb(e,this)}_set(e,t=!0){let r=gA(e);if(!mU.und(r)){let e=gX(this);if(!e||!mN(r,e.getValue())){let i=g6(r);e&&e.constructor==i?e.setValue(r):g$(this,i.create(r)),e&&mA.batchedUpdates(()=>{this._onChange(r,t)})}}return gX(this)}_onStart(){let e=this.animation;e.changed||(e.changed=!0,AH(this,"onStart",AE(this,AF(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),At(this.animation.onChange,e,this)),At(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){let e=this.animation;gX(this).reset(gA(e.to)),e.immediate||(e.fromValues=e.values.map(e=>e.lastPosition)),AB(this)||(AP(this,!0),AD(this)||this._resume())}_resume(){mk.skipAnimation?this.finish():m0.start(this)}_stop(e,t){if(AB(this)){AP(this,!1);let r=this.animation;mz(r.values,e=>{e.done=!0}),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),gy(this,{type:"idle",parent:this});let i=t?Ax(this.get()):AE(this.get(),AF(this,e??r.to));mV(this._pendingCalls,i),r.changed&&(r.changed=!1,AH(this,"onRest",i,this))}}};function AF(e,t){let r=Ac(t);return mN(Ac(e.get()),r)}function AO(e,t=e.loop,r=e.to){let i=At(t);if(i){let n=!0!==i&&Au(i),a=(n||e).reverse,s=!n||n.reset;return AU({...e,loop:t,default:!1,pause:void 0,to:!a||Ah(r)?r:void 0,from:s?e.from:void 0,reset:s,...n})}}function AU(e){let{to:t,from:r}=e=Au(e),i=new Set;return mU.obj(t)&&AN(t,i),mU.obj(r)&&AN(r,i),e.keys=i.size?Array.from(i):null,e}function AN(e,t){mG(e,(e,r)=>null!=e&&t.add(r))}var Az=["onStart","onRest","onChange","onPause","onResume"];function AG(e,t,r){e.animation[r]=t[r]!==An(t,r)?Ai(t[r],e.key):void 0}function AH(e,t,...r){e.animation[t]?.(...r),e.defaultProps[t]?.(...r)}var AQ=["onStart","onChange","onRest"],AV=1,AW=class{constructor(e,t){this.id=AV++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){let e={};return this.each((t,r)=>e[r]=t.get()),e}set(e){for(let t in e){let r=e[t];mU.und(r)||this.springs[t].set(r)}}update(e){return e&&this.queue.push(AU(e)),this}start(e){let{queue:t}=this;return(e?t=mH(e).map(AU):this.queue=[],this._flush)?this._flush(this,t):(AJ(this,t),Aj(this,t))}stop(e,t){if(!!e!==e&&(t=e),t){let r=this.springs;mz(mH(t),t=>r[t].stop(!!e))}else Ab(this._state,this._lastAsyncId),this.each(t=>t.stop(!!e));return this}pause(e){if(mU.und(e))this.start({pause:!0});else{let t=this.springs;mz(mH(e),e=>t[e].pause())}return this}resume(e){if(mU.und(e))this.start({pause:!1});else{let t=this.springs;mz(mH(e),e=>t[e].resume())}return this}each(e){mG(this.springs,e)}_onFrame(){let{onStart:e,onChange:t,onRest:r}=this._events,i=this._active.size>0,n=this._changed.size>0;(i&&!this._started||n&&!this._started)&&(this._started=!0,mQ(e,([e,t])=>{t.value=this.get(),e(t,this,this._item)}));let a=!i&&this._started,s=n||a&&r.size?this.get():null;n&&t.size&&mQ(t,([e,t])=>{t.value=s,e(t,this,this._item)}),a&&(this._started=!1,mQ(r,([e,t])=>{t.value=s,e(t,this,this._item)}))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}mA.onFrame(this._onFrame)}};function Aj(e,t){return Promise.all(t.map(t=>AY(e,t))).then(t=>Av(e,t))}async function AY(e,t,r){let{keys:i,to:n,from:a,loop:s,onRest:o,onResolve:l}=t,u=mU.obj(t.default)&&t.default;s&&(t.loop=!1),!1===n&&(t.to=null),!1===a&&(t.from=null);let c=mU.arr(n)||mU.fun(n)?n:void 0;c?(t.to=void 0,t.onRest=void 0,u&&(u.onRest=void 0)):mz(AQ,r=>{let i=t[r];if(mU.fun(i)){let n=e._events[r];t[r]=({finished:e,cancelled:t})=>{let r=n.get(i);r?(e||(r.finished=!1),t&&(r.cancelled=!0)):n.set(i,{value:null,finished:e||!1,cancelled:t||!1})},u&&(u[r]=t[r])}});let h=e._state;!h.paused===t.pause?(h.paused=t.pause,mV(t.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(t.pause=!0);let d=(i||Object.keys(e.springs)).map(r=>e.springs[r].start(t)),f=!0===t.cancel||!0===An(t,"cancel");(c||f&&h.asyncId)&&d.push(AA(++e._lastAsyncId,{props:t,state:h,actions:{pause:mF,resume:mF,start(t,r){f?(Ab(h,e._lastAsyncId),r(Ax(e))):(t.onRest=o,r(A_(c,t,h,e)))}}})),h.paused&&await new Promise(e=>{h.resumeQueue.add(e)});let p=Av(e,await Promise.all(d));if(s&&p.finished&&!(r&&p.noop)){let r=AO(t,s,n);if(r)return AJ(e,[r]),AY(e,r,!0)}return l&&mA.batchedUpdates(()=>l(p,e,e.item)),p}function AK(e,t){let r={...e.springs};return t&&mz(mH(t),e=>{mU.und(e.keys)&&(e=AU(e)),mU.obj(e.to)||(e={...e,to:void 0}),A$(r,e,e=>AX(e))}),Aq(e,r),r}function Aq(e,t){mG(t,(t,r)=>{e.springs[r]||(e.springs[r]=t,g_(t,e))})}function AX(e,t){let r=new Ak;return r.key=e,t&&g_(r,t),r}function A$(e,t,r){t.keys&&mz(t.keys,i=>{(e[i]||(e[i]=r(i)))._prepareNode(t)})}function AJ(e,t){mz(t,t=>{A$(e.springs,t,t=>AX(t,e))})}var AZ=({children:e,...t})=>{let r=(0,eN.useContext)(A0),i=t.pause||!!r.pause,n=t.immediate||!!r.immediate;t=function(e,t){let[r]=(0,eN.useState)(()=>({inputs:t,result:e()})),i=(0,eN.useRef)(),n=i.current,a=n;return a?t&&a.inputs&&function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(t,a.inputs)||(a={inputs:t,result:e()}):a=r,(0,eN.useEffect)(()=>{i.current=a,n==r&&(r.inputs=r.result=void 0)},[a]),a.result}(()=>({pause:i,immediate:n}),[i,n]);let{Provider:a}=A0;return eN.createElement(a,{value:t},e)},A0=function(e,t){return Object.assign(e,eN.createContext(t)),e.Provider._context=e,e.Consumer._context=e,e}(AZ,{});AZ.Provider=A0.Provider,AZ.Consumer=A0.Consumer;var A1=()=>{let e=[],t=function(t){gO(`${gL}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`);let i=[];return mz(e,(e,n)=>{if(mU.und(t))i.push(e.start());else{let a=r(t,e,n);a&&i.push(e.start(a))}}),i};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){let r=e.indexOf(t);~r&&e.splice(r,1)},t.pause=function(){return mz(e,e=>e.pause(...arguments)),this},t.resume=function(){return mz(e,e=>e.resume(...arguments)),this},t.set=function(t){mz(e,(e,r)=>{let i=mU.fun(t)?t(r,e):t;i&&e.set(i)})},t.start=function(t){let r=[];return mz(e,(e,i)=>{if(mU.und(t))r.push(e.start());else{let n=this._getProps(t,e,i);n&&r.push(e.start(n))}}),r},t.stop=function(){return mz(e,e=>e.stop(...arguments)),this},t.update=function(t){return mz(e,(e,r)=>e.update(this._getProps(t,e,r))),this};let r=function(e,t,r){return mU.fun(e)?e(r,t):e};return t._getProps=r,t},A2=class extends AI{constructor(e,t){super(),this.source=e,this.idle=!0,this._active=new Set,this.calc=gf(...t);let r=this._get();g$(this,g6(r).create(r))}advance(e){let t=this._get();mN(t,this.get())||(gX(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&A4(this._active)&&A5(this)}_get(){let e=mU.arr(this.source)?this.source.map(gA):mH(gA(this.source));return this.calc(...e)}_start(){this.idle&&!A4(this._active)&&(this.idle=!1,mz(gJ(this),e=>{e.done=!1}),mk.skipAnimation?(mA.batchedUpdates(()=>this.advance()),A5(this)):m0.start(this))}_attach(){let e=1;mz(mH(this.source),t=>{gg(t)&&g_(t,this),AC(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))}),this.priority=e,this._start()}_detach(){mz(mH(this.source),e=>{gg(e)&&gb(e,this)}),this._active.clear(),A5(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=mH(this.source).reduce((e,t)=>Math.max(e,(AC(t)?t.priority:0)+1),0))}};function A3(e){return!1!==e.idle}function A4(e){return!e.size||Array.from(e).every(A3)}function A5(e){e.idle||(e.idle=!0,mz(gJ(e),e=>{e.done=!0}),gy(e,{type:"idle",parent:e}))}function A6(){let e=null,t=!1,r=null,i=null;function n(t,a){r(t,a),i=e.requestAnimationFrame(n)}return{start:function(){!0!==t&&null!==r&&(i=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function A8(e){let t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);let i=t.get(r);i&&(e.deleteBuffer(i.buffer),t.delete(r))},update:function(r,i){if(r.isInterleavedBufferAttribute&&(r=r.data),r.isGLBufferAttribute){let e=t.get(r);(!e||e.version<r.version)&&t.set(r,{buffer:r.buffer,type:r.type,bytesPerElement:r.elementSize,version:r.version});return}let n=t.get(r);if(void 0===n)t.set(r,function(t,r){let i;let n=t.array,a=t.usage,s=n.byteLength,o=e.createBuffer();if(e.bindBuffer(r,o),e.bufferData(r,n,a),t.onUploadCallback(),n instanceof Float32Array)i=e.FLOAT;else if("undefined"!=typeof Float16Array&&n instanceof Float16Array)i=e.HALF_FLOAT;else if(n instanceof Uint16Array)i=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(n instanceof Int16Array)i=e.SHORT;else if(n instanceof Uint32Array)i=e.UNSIGNED_INT;else if(n instanceof Int32Array)i=e.INT;else if(n instanceof Int8Array)i=e.BYTE;else if(n instanceof Uint8Array)i=e.UNSIGNED_BYTE;else if(n instanceof Uint8ClampedArray)i=e.UNSIGNED_BYTE;else throw Error("THREE.WebGLAttributes: Unsupported buffer data format: "+n);return{buffer:o,type:i,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version,size:s}}(r,i));else if(n.version<r.version){if(n.size!==r.array.byteLength)throw Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function(t,r,i){let n=r.array,a=r.updateRanges;if(e.bindBuffer(i,t),0===a.length)e.bufferSubData(i,0,n);else{a.sort((e,t)=>e.start-t.start);let t=0;for(let e=1;e<a.length;e++){let r=a[t],i=a[e];i.start<=r.start+r.count+1?r.count=Math.max(r.count,i.start+i.count-r.start):a[++t]=i}a.length=t+1;for(let t=0,r=a.length;t<r;t++){let r=a[t];e.bufferSubData(i,r.start*n.BYTES_PER_ELEMENT,n,r.start,r.count)}r.clearUpdateRanges()}r.onUploadCallback()})(n.buffer,r,i),n.version=r.version}}}}mk.assign({createStringInterpolator:gP,to:(e,t)=>new A2(e,t)}),m0.advance;let A9={alphahash_fragment:"#ifdef USE_ALPHAHASH\n	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n	const float ALPHA_HASH_SCALE = 0.05;\n	float hash2D( vec2 value ) {\n		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n	}\n	float hash3D( vec3 value ) {\n		return hash2D( vec2( hash2D( value.xy ), value.z ) );\n	}\n	float getAlphaHashThreshold( vec3 position ) {\n		float maxDeriv = max(\n			length( dFdx( position.xyz ) ),\n			length( dFdy( position.xyz ) )\n		);\n		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n		vec2 pixScales = vec2(\n			exp2( floor( log2( pixScale ) ) ),\n			exp2( ceil( log2( pixScale ) ) )\n		);\n		vec2 alpha = vec2(\n			hash3D( floor( pixScales.x * position.xyz ) ),\n			hash3D( floor( pixScales.y * position.xyz ) )\n		);\n		float lerpFactor = fract( log2( pixScale ) );\n		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n		float a = min( lerpFactor, 1.0 - lerpFactor );\n		vec3 cases = vec3(\n			x * x / ( 2.0 * a * ( 1.0 - a ) ),\n			( x - 0.5 * a ) / ( 1.0 - a ),\n			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n		);\n		float threshold = ( x < ( 1.0 - a ) )\n			? ( ( x < a ) ? cases.x : cases.y )\n			: cases.z;\n		return clamp( threshold , 1.0e-6, 1.0 );\n	}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n	#ifdef ALPHA_TO_COVERAGE\n	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n	if ( diffuseColor.a == 0.0 ) discard;\n	#else\n	if ( diffuseColor.a < alphaTest ) discard;\n	#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n	uniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n	reflectedLight.indirectDiffuse *= ambientOcclusion;\n	#if defined( USE_CLEARCOAT ) \n		clearcoatSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_SHEEN ) \n		sheenSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD )\n		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n	#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n	#if ! defined( GL_ANGLE_multi_draw )\n	#define gl_DrawID _gl_DrawID\n	uniform int _gl_DrawID;\n	#endif\n	uniform highp sampler2D batchingTexture;\n	uniform highp usampler2D batchingIdTexture;\n	mat4 getBatchingMatrix( const in float i ) {\n		int size = textureSize( batchingTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n	float getIndirectIndex( const in int i ) {\n		int size = textureSize( batchingIdTexture, 0 ).x;\n		int x = i % size;\n		int y = i / size;\n		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n	}\n#endif\n#ifdef USE_BATCHING_COLOR\n	uniform sampler2D batchingColorTexture;\n	vec3 getBatchingColor( const in float i ) {\n		int size = textureSize( batchingColorTexture, 0 ).x;\n		int j = int( i );\n		int x = j % size;\n		int y = j / size;\n		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n	}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n	vPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n	vec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n	return 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n	float G = G_BlinnPhong_Implicit( );\n	float D = D_BlinnPhong( shininess, dotNH );\n	return F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n	const mat3 XYZ_TO_REC709 = mat3(\n		 3.2404542, -0.9692660,  0.0556434,\n		-1.5371385,  1.8760108, -0.2040259,\n		-0.4985314,  0.0415560,  1.0572252\n	);\n	vec3 Fresnel0ToIor( vec3 fresnel0 ) {\n		vec3 sqrtF0 = sqrt( fresnel0 );\n		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n	}\n	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n	}\n	float IorToFresnel0( float transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n	}\n	vec3 evalSensitivity( float OPD, vec3 shift ) {\n		float phase = 2.0 * PI * OPD * 1.0e-9;\n		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n		xyz /= 1.0685e-7;\n		vec3 rgb = XYZ_TO_REC709 * xyz;\n		return rgb;\n	}\n	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n		vec3 I;\n		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n		float cosTheta2Sq = 1.0 - sinTheta2Sq;\n		if ( cosTheta2Sq < 0.0 ) {\n			return vec3( 1.0 );\n		}\n		float cosTheta2 = sqrt( cosTheta2Sq );\n		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n		float R12 = F_Schlick( R0, 1.0, cosTheta1 );\n		float T121 = 1.0 - R12;\n		float phi12 = 0.0;\n		if ( iridescenceIOR < outsideIOR ) phi12 = PI;\n		float phi21 = PI - phi12;\n		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n		vec3 phi23 = vec3( 0.0 );\n		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n		vec3 phi = vec3( phi21 ) + phi23;\n		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n		vec3 r123 = sqrt( R123 );\n		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n		vec3 C0 = R12 + Rs;\n		I = C0;\n		vec3 Cm = Rs - T121;\n		for ( int m = 1; m <= 2; ++ m ) {\n			Cm *= r123;\n			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n			I += Cm * Sm;\n		}\n		return max( I, vec3( 0.0 ) );\n	}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd() {\n		vec2 dSTdx = dFdx( vBumpMapUv );\n		vec2 dSTdy = dFdy( vBumpMapUv );\n		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 ) * faceDirection;\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n	vec4 plane;\n	#ifdef ALPHA_TO_COVERAGE\n		float distanceToPlane, distanceGradient;\n		float clipOpacity = 1.0;\n		#pragma unroll_loop_start\n		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n			distanceGradient = fwidth( distanceToPlane ) / 2.0;\n			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n			if ( clipOpacity == 0.0 ) discard;\n		}\n		#pragma unroll_loop_end\n		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n			float unionClipOpacity = 1.0;\n			#pragma unroll_loop_start\n			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n				plane = clippingPlanes[ i ];\n				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n				distanceGradient = fwidth( distanceToPlane ) / 2.0;\n				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n			}\n			#pragma unroll_loop_end\n			clipOpacity *= 1.0 - unionClipOpacity;\n		#endif\n		diffuseColor.a *= clipOpacity;\n		if ( diffuseColor.a == 0.0 ) discard;\n	#else\n		#pragma unroll_loop_start\n		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n		}\n		#pragma unroll_loop_end\n		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n			bool clipped = true;\n			#pragma unroll_loop_start\n			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n				plane = clippingPlanes[ i ];\n				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n			}\n			#pragma unroll_loop_end\n			if ( clipped ) discard;\n		#endif\n	#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n	vClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n	diffuseColor *= vColor;\n#elif defined( USE_COLOR )\n	diffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR )\n	varying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n	varying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n	vColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n	vColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n	vColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n	vColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n	vColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n	const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n	return fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n	float precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n	float precisionSafeLength( vec3 v ) {\n		float maxComponent = max3( abs( v ) );\n		return length( v / maxComponent ) * maxComponent;\n	}\n#endif\nstruct IncidentLight {\n	vec3 color;\n	vec3 direction;\n	bool visible;\n};\nstruct ReflectedLight {\n	vec3 directDiffuse;\n	vec3 directSpecular;\n	vec3 indirectDiffuse;\n	vec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n	varying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n	mat3 tmp;\n	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n	return tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n	return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n	return vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n	return RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n	#define cubeUV_minMipLevel 4.0\n	#define cubeUV_minTileSize 16.0\n	float getFace( vec3 direction ) {\n		vec3 absDirection = abs( direction );\n		float face = - 1.0;\n		if ( absDirection.x > absDirection.z ) {\n			if ( absDirection.x > absDirection.y )\n				face = direction.x > 0.0 ? 0.0 : 3.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		} else {\n			if ( absDirection.z > absDirection.y )\n				face = direction.z > 0.0 ? 2.0 : 5.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		}\n		return face;\n	}\n	vec2 getUV( vec3 direction, float face ) {\n		vec2 uv;\n		if ( face == 0.0 ) {\n			uv = vec2( direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 1.0 ) {\n			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n		} else if ( face == 2.0 ) {\n			uv = vec2( - direction.x, direction.y ) / abs( direction.z );\n		} else if ( face == 3.0 ) {\n			uv = vec2( - direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 4.0 ) {\n			uv = vec2( - direction.x, direction.z ) / abs( direction.y );\n		} else {\n			uv = vec2( direction.x, direction.y ) / abs( direction.z );\n		}\n		return 0.5 * ( uv + 1.0 );\n	}\n	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n		float face = getFace( direction );\n		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n		mipInt = max( mipInt, cubeUV_minMipLevel );\n		float faceSize = exp2( mipInt );\n		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n		if ( face > 2.0 ) {\n			uv.y += faceSize;\n			face -= 3.0;\n		}\n		uv.x += face * faceSize;\n		uv.x += filterInt * 3.0 * cubeUV_minTileSize;\n		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n		uv.x *= CUBEUV_TEXEL_WIDTH;\n		uv.y *= CUBEUV_TEXEL_HEIGHT;\n		#ifdef texture2DGradEXT\n			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n		#else\n			return texture2D( envMap, uv ).rgb;\n		#endif\n	}\n	#define cubeUV_r0 1.0\n	#define cubeUV_m0 - 2.0\n	#define cubeUV_r1 0.8\n	#define cubeUV_m1 - 1.0\n	#define cubeUV_r4 0.4\n	#define cubeUV_m4 2.0\n	#define cubeUV_r5 0.305\n	#define cubeUV_m5 3.0\n	#define cubeUV_r6 0.21\n	#define cubeUV_m6 4.0\n	float roughnessToMip( float roughness ) {\n		float mip = 0.0;\n		if ( roughness >= cubeUV_r1 ) {\n			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n		} else if ( roughness >= cubeUV_r4 ) {\n			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n		} else if ( roughness >= cubeUV_r5 ) {\n			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n		} else if ( roughness >= cubeUV_r6 ) {\n			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n		} else {\n			mip = - 2.0 * log2( 1.16 * roughness );		}\n		return mip;\n	}\n	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n		float mipF = fract( mip );\n		float mipInt = floor( mip );\n		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n		if ( mipF == 0.0 ) {\n			return vec4( color0, 1.0 );\n		} else {\n			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n			return vec4( mix( color0, color1, mipF ), 1.0 );\n		}\n	}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n	vec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n	mat3 bm = mat3( batchingMatrix );\n	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n	transformedNormal = bm * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = bm * transformedTangent;\n	#endif\n#endif\n#ifdef USE_INSTANCING\n	mat3 im = mat3( instanceMatrix );\n	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n	transformedNormal = im * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = im * transformedTangent;\n	#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n	transformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n	#ifdef FLIP_SIDED\n		transformedTangent = - transformedTangent;\n	#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n		emissiveColor = sRGBTransferEOTF( emissiveColor );\n	#endif\n	totalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n	uniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n	return value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vec3 cameraToFrag;\n		if ( isOrthographic ) {\n			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToFrag = normalize( vWorldPosition - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vec3 reflectVec = reflect( cameraToFrag, worldNormal );\n		#else\n			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n		#endif\n	#else\n		vec3 reflectVec = vReflect;\n	#endif\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#else\n		vec4 envColor = vec4( 0.0 );\n	#endif\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_MIX )\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_ADD )\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n	#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float envMapIntensity;\n	uniform float flipEnvMap;\n	uniform mat3 envMapRotation;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float reflectivity;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		varying vec3 vWorldPosition;\n		uniform float refractionRatio;\n	#else\n		varying vec3 vReflect;\n	#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		\n		varying vec3 vWorldPosition;\n	#else\n		varying vec3 vReflect;\n		uniform float refractionRatio;\n	#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n	vec3 getIBLIrradiance( const in vec3 normal ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n			return PI * envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 reflectVec = reflect( - viewDir, normal );\n			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n			return envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	#ifdef USE_ANISOTROPY\n		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n			#ifdef ENVMAP_TYPE_CUBE_UV\n				vec3 bentNormal = cross( bitangent, viewDir );\n				bentNormal = normalize( cross( bentNormal, bitangent ) );\n				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n				return getIBLRadiance( viewDir, bentNormal, roughness );\n			#else\n				return vec3( 0.0 );\n			#endif\n		}\n	#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vWorldPosition = worldPosition.xyz;\n	#else\n		vec3 cameraToVertex;\n		if ( isOrthographic ) {\n			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vReflect = reflect( cameraToVertex, worldNormal );\n		#else\n			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n		#endif\n	#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n	vFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n	varying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n	#ifdef FOG_EXP2\n		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n	#else\n		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n	#endif\n	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n	uniform vec3 fogColor;\n	varying float vFogDepth;\n	#ifdef FOG_EXP2\n		uniform float fogDensity;\n	#else\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n	uniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n	float dotNL = dot( normal, lightDirection );\n	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n	#ifdef USE_GRADIENTMAP\n		return vec3( texture2D( gradientMap, coord ).r );\n	#else\n		vec2 fw = fwidth( coord ) * 0.5;\n		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n	#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n	vec3 diffuseColor;\n	float specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Lambert\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n	uniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n	float x = normal.x, y = normal.y, z = normal.z;\n	vec3 result = shCoefficients[ 0 ] * 0.886227;\n	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n	return result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n	return irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n	vec3 irradiance = ambientLightColor;\n	return irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n	if ( cutoffDistance > 0.0 ) {\n		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n	}\n	return distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n	return smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n	struct DirectionalLight {\n		vec3 direction;\n		vec3 color;\n	};\n	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n		light.color = directionalLight.color;\n		light.direction = directionalLight.direction;\n		light.visible = true;\n	}\n#endif\n#if NUM_POINT_LIGHTS > 0\n	struct PointLight {\n		vec3 position;\n		vec3 color;\n		float distance;\n		float decay;\n	};\n	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = pointLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float lightDistance = length( lVector );\n		light.color = pointLight.color;\n		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n		light.visible = ( light.color != vec3( 0.0 ) );\n	}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n	struct SpotLight {\n		vec3 position;\n		vec3 direction;\n		vec3 color;\n		float distance;\n		float decay;\n		float coneCos;\n		float penumbraCos;\n	};\n	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = spotLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float angleCos = dot( light.direction, spotLight.direction );\n		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n		if ( spotAttenuation > 0.0 ) {\n			float lightDistance = length( lVector );\n			light.color = spotLight.color * spotAttenuation;\n			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n			light.visible = ( light.color != vec3( 0.0 ) );\n		} else {\n			light.color = vec3( 0.0 );\n			light.visible = false;\n		}\n	}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n	struct RectAreaLight {\n		vec3 color;\n		vec3 position;\n		vec3 halfWidth;\n		vec3 halfHeight;\n	};\n	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;\n	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n	struct HemisphereLight {\n		vec3 direction;\n		vec3 skyColor;\n		vec3 groundColor;\n	};\n	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n		float dotNL = dot( normal, hemiLight.direction );\n		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n		return irradiance;\n	}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n	vec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Toon\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n	vec3 diffuseColor;\n	vec3 specularColor;\n	float specularShininess;\n	float specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n	material.ior = ior;\n	#ifdef USE_SPECULAR\n		float specularIntensityFactor = specularIntensity;\n		vec3 specularColorFactor = specularColor;\n		#ifdef USE_SPECULAR_COLORMAP\n			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n		#endif\n		#ifdef USE_SPECULAR_INTENSITYMAP\n			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n		#endif\n		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n	#else\n		float specularIntensityFactor = 1.0;\n		vec3 specularColorFactor = vec3( 1.0 );\n		material.specularF90 = 1.0;\n	#endif\n	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n	material.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n	material.clearcoat = clearcoat;\n	material.clearcoatRoughness = clearcoatRoughness;\n	material.clearcoatF0 = vec3( 0.04 );\n	material.clearcoatF90 = 1.0;\n	#ifdef USE_CLEARCOATMAP\n		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n	#endif\n	#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n	#endif\n	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n	material.clearcoatRoughness += geometryRoughness;\n	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n	material.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n	material.iridescence = iridescence;\n	material.iridescenceIOR = iridescenceIOR;\n	#ifdef USE_IRIDESCENCEMAP\n		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n	#endif\n	#ifdef USE_IRIDESCENCE_THICKNESSMAP\n		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n	#else\n		material.iridescenceThickness = iridescenceThicknessMaximum;\n	#endif\n#endif\n#ifdef USE_SHEEN\n	material.sheenColor = sheenColor;\n	#ifdef USE_SHEEN_COLORMAP\n		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n	#endif\n	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	#ifdef USE_ANISOTROPYMAP\n		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n	#else\n		vec2 anisotropyV = anisotropyVector;\n	#endif\n	material.anisotropy = length( anisotropyV );\n	if( material.anisotropy == 0.0 ) {\n		anisotropyV = vec2( 1.0, 0.0 );\n	} else {\n		anisotropyV /= material.anisotropy;\n		material.anisotropy = saturate( material.anisotropy );\n	}\n	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n	vec3 diffuseColor;\n	float roughness;\n	vec3 specularColor;\n	float specularF90;\n	float dispersion;\n	#ifdef USE_CLEARCOAT\n		float clearcoat;\n		float clearcoatRoughness;\n		vec3 clearcoatF0;\n		float clearcoatF90;\n	#endif\n	#ifdef USE_IRIDESCENCE\n		float iridescence;\n		float iridescenceIOR;\n		float iridescenceThickness;\n		vec3 iridescenceFresnel;\n		vec3 iridescenceF0;\n	#endif\n	#ifdef USE_SHEEN\n		vec3 sheenColor;\n		float sheenRoughness;\n	#endif\n	#ifdef IOR\n		float ior;\n	#endif\n	#ifdef USE_TRANSMISSION\n		float transmission;\n		float transmissionAlpha;\n		float thickness;\n		float attenuationDistance;\n		vec3 attenuationColor;\n	#endif\n	#ifdef USE_ANISOTROPY\n		float anisotropy;\n		float alphaT;\n		vec3 anisotropyT;\n		vec3 anisotropyB;\n	#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n	float a2 = pow2( alpha );\n	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n	return 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n	float a2 = pow2( alpha );\n	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n	return RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n		float v = 0.5 / ( gv + gl );\n		return saturate(v);\n	}\n	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n		float a2 = alphaT * alphaB;\n		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n		highp float v2 = dot( v, v );\n		float w2 = a2 / v2;\n		return RECIPROCAL_PI * a2 * pow2 ( w2 );\n	}\n#endif\n#ifdef USE_CLEARCOAT\n	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n		vec3 f0 = material.clearcoatF0;\n		float f90 = material.clearcoatF90;\n		float roughness = material.clearcoatRoughness;\n		float alpha = pow2( roughness );\n		vec3 halfDir = normalize( lightDir + viewDir );\n		float dotNL = saturate( dot( normal, lightDir ) );\n		float dotNV = saturate( dot( normal, viewDir ) );\n		float dotNH = saturate( dot( normal, halfDir ) );\n		float dotVH = saturate( dot( viewDir, halfDir ) );\n		vec3 F = F_Schlick( f0, f90, dotVH );\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n		return F * ( V * D );\n	}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n	vec3 f0 = material.specularColor;\n	float f90 = material.specularF90;\n	float roughness = material.roughness;\n	float alpha = pow2( roughness );\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( f0, f90, dotVH );\n	#ifdef USE_IRIDESCENCE\n		F = mix( F, material.iridescenceFresnel, material.iridescence );\n	#endif\n	#ifdef USE_ANISOTROPY\n		float dotTL = dot( material.anisotropyT, lightDir );\n		float dotTV = dot( material.anisotropyT, viewDir );\n		float dotTH = dot( material.anisotropyT, halfDir );\n		float dotBL = dot( material.anisotropyB, lightDir );\n		float dotBV = dot( material.anisotropyB, viewDir );\n		float dotBH = dot( material.anisotropyB, halfDir );\n		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n	#else\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n	#endif\n	return F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n	const float LUT_SIZE = 64.0;\n	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n	const float LUT_BIAS = 0.5 / LUT_SIZE;\n	float dotNV = saturate( dot( N, V ) );\n	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n	uv = uv * LUT_SCALE + LUT_BIAS;\n	return uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n	float l = length( f );\n	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n	float x = dot( v1, v2 );\n	float y = abs( x );\n	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n	float b = 3.4175940 + ( 4.1616724 + y ) * y;\n	float v = a / b;\n	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n	return cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n	vec3 lightNormal = cross( v1, v2 );\n	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n	vec3 T1, T2;\n	T1 = normalize( V - N * dot( V, N ) );\n	T2 = - cross( N, T1 );\n	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n	vec3 coords[ 4 ];\n	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n	coords[ 0 ] = normalize( coords[ 0 ] );\n	coords[ 1 ] = normalize( coords[ 1 ] );\n	coords[ 2 ] = normalize( coords[ 2 ] );\n	coords[ 3 ] = normalize( coords[ 3 ] );\n	vec3 vectorFormFactor = vec3( 0.0 );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n	return vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n	float alpha = pow2( roughness );\n	float invAlpha = 1.0 / alpha;\n	float cos2h = dotNH * dotNH;\n	float sin2h = max( 1.0 - cos2h, 0.0078125 );\n	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float D = D_Charlie( sheenRoughness, dotNH );\n	float V = V_Neubelt( dotNV, dotNL );\n	return sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float r2 = roughness * roughness;\n	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n	return saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n	vec4 r = roughness * c0 + c1;\n	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n	return fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	return specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	#ifdef USE_IRIDESCENCE\n		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n	#else\n		vec3 Fr = specularColor;\n	#endif\n	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n	float Ess = fab.x + fab.y;\n	float Ems = 1.0 - Ess;\n	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n	singleScatter += FssEss;\n	multiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n		vec3 normal = geometryNormal;\n		vec3 viewDir = geometryViewDir;\n		vec3 position = geometryPosition;\n		vec3 lightPos = rectAreaLight.position;\n		vec3 halfWidth = rectAreaLight.halfWidth;\n		vec3 halfHeight = rectAreaLight.halfHeight;\n		vec3 lightColor = rectAreaLight.color;\n		float roughness = material.roughness;\n		vec3 rectCoords[ 4 ];\n		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n		vec2 uv = LTC_Uv( normal, viewDir, roughness );\n		vec4 t1 = texture2D( ltc_1, uv );\n		vec4 t2 = texture2D( ltc_2, uv );\n		mat3 mInv = mat3(\n			vec3( t1.x, 0, t1.y ),\n			vec3(    0, 1,    0 ),\n			vec3( t1.z, 0, t1.w )\n		);\n		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n	}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	#ifdef USE_CLEARCOAT\n		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n		vec3 ccIrradiance = dotNLcc * directLight.color;\n		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n	#endif\n	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n	#ifdef USE_CLEARCOAT\n		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n	#endif\n	vec3 singleScattering = vec3( 0.0 );\n	vec3 multiScattering = vec3( 0.0 );\n	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n	#ifdef USE_IRIDESCENCE\n		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n	#else\n		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n	#endif\n	vec3 totalScattering = singleScattering + multiScattering;\n	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n	reflectedLight.indirectSpecular += radiance * singleScattering;\n	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct				RE_Direct_Physical\n#define RE_Direct_RectArea		RE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular		RE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n	geometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n	float dotNVi = saturate( dot( normal, geometryViewDir ) );\n	if ( material.iridescenceThickness == 0.0 ) {\n		material.iridescence = 0.0;\n	} else {\n		material.iridescence = saturate( material.iridescence );\n	}\n	if ( material.iridescence > 0.0 ) {\n		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n	}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n	PointLight pointLight;\n	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n		pointLight = pointLights[ i ];\n		getPointLightInfo( pointLight, geometryPosition, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n		pointLightShadow = pointLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n	SpotLight spotLight;\n	vec4 spotColor;\n	vec3 spotLightCoord;\n	bool inSpotLightMap;\n	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n		spotLight = spotLights[ i ];\n		getSpotLightInfo( spotLight, geometryPosition, directLight );\n		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n		#else\n		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#endif\n		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n		#endif\n		#undef SPOT_LIGHT_MAP_INDEX\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		spotLightShadow = spotLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n	DirectionalLight directionalLight;\n	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n		directionalLight = directionalLights[ i ];\n		getDirectionalLightInfo( directionalLight, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n		directionalLightShadow = directionalLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n	RectAreaLight rectAreaLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n		rectAreaLight = rectAreaLights[ i ];\n		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n	vec3 iblIrradiance = vec3( 0.0 );\n	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n	#if defined( USE_LIGHT_PROBES )\n		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n	#endif\n	#if ( NUM_HEMI_LIGHTS > 0 )\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if defined( RE_IndirectSpecular )\n	vec3 radiance = vec3( 0.0 );\n	vec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n		irradiance += lightMapIrradiance;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n		iblIrradiance += getIBLIrradiance( geometryNormal );\n	#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n	#ifdef USE_ANISOTROPY\n		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n	#else\n		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n	#endif\n	#ifdef USE_CLEARCOAT\n		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n	#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n	uniform float logDepthBufFC;\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n	vFragDepth = 1.0 + gl_Position.w;\n	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n	vec4 sampledDiffuseColor = texture2D( map, vMapUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n	#endif\n	diffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n	#if defined( USE_POINTS_UV )\n		vec2 uv = vUv;\n	#else\n		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n	#endif\n#endif\n#ifdef USE_MAP\n	diffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n	varying vec2 vUv;\n#else\n	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n		uniform mat3 uvTransform;\n	#endif\n#endif\n#ifdef USE_MAP\n	uniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n	metalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n	uniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n	float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n	}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n	vColor *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		#if defined( USE_COLOR_ALPHA )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n		#elif defined( USE_COLOR )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n		#endif\n	}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n	objectNormal *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n	}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n	#ifndef USE_INSTANCING_MORPH\n		uniform float morphTargetBaseInfluence;\n		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n	#endif\n	uniform sampler2DArray morphTargetsTexture;\n	uniform ivec2 morphTargetsTextureSize;\n	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n		int y = texelIndex / morphTargetsTextureSize.x;\n		int x = texelIndex - y * morphTargetsTextureSize.x;\n		ivec3 morphUV = ivec3( x, y, morphTargetIndex );\n		return texelFetch( morphTargetsTexture, morphUV, 0 );\n	}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n	transformed *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n	}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n#else\n	vec3 normal = normalize( vNormal );\n	#ifdef DOUBLE_SIDED\n		normal *= faceDirection;\n	#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n	#ifdef USE_TANGENT\n		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn = getTangentFrame( - vViewPosition, normal,\n		#if defined( USE_NORMALMAP )\n			vNormalMapUv\n		#elif defined( USE_CLEARCOAT_NORMALMAP )\n			vClearcoatNormalMapUv\n		#else\n			vUv\n		#endif\n		);\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn[0] *= faceDirection;\n		tbn[1] *= faceDirection;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	#ifdef USE_TANGENT\n		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn2[0] *= faceDirection;\n		tbn2[1] *= faceDirection;\n	#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	#ifdef FLIP_SIDED\n		normal = - normal;\n	#endif\n	#ifdef DOUBLE_SIDED\n		normal = normal * faceDirection;\n	#endif\n	normal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	mapN.xy *= normalScale;\n	normal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n	vNormal = normalize( transformedNormal );\n	#ifdef USE_TANGENT\n		vTangent = normalize( transformedTangent );\n		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n	#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n	uniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( uv.st );\n		vec2 st1 = dFdy( uv.st );\n		vec3 N = surf_norm;\n		vec3 q1perp = cross( q1, N );\n		vec3 q0perp = cross( N, q0 );\n		vec3 T = q1perp * st0.x + q0perp * st1.x;\n		vec3 B = q1perp * st0.y + q0perp * st1.y;\n		float det = max( dot( T, T ), dot( B, B ) );\n		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n		return mat3( T * scale, B * scale, N );\n	}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n	vec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n	clearcoatMapN.xy *= clearcoatNormalScale;\n	clearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n	uniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform sampler2D clearcoatNormalMap;\n	uniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n	uniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n	return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n	return 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n	if( v <= 0.0 )\n		return vec4( 0., 0., 0., 0. );\n	if( v >= 1.0 )\n		return vec4( 1., 1., 1., 1. );\n	float vuf;\n	float af = modf( v * PackFactors.a, vuf );\n	float bf = modf( vuf * ShiftRight8, vuf );\n	float gf = modf( vuf * ShiftRight8, vuf );\n	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n	if( v <= 0.0 )\n		return vec3( 0., 0., 0. );\n	if( v >= 1.0 )\n		return vec3( 1., 1., 1. );\n	float vuf;\n	float bf = modf( v * PackFactors.b, vuf );\n	float gf = modf( vuf * ShiftRight8, vuf );\n	return vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n	if( v <= 0.0 )\n		return vec2( 0., 0. );\n	if( v >= 1.0 )\n		return vec2( 1., 1. );\n	float vuf;\n	float gf = modf( v * 256., vuf );\n	return vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n	return dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n	return dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n	gl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n	mvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n	mvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n	gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n	vec3 dithering( vec3 color ) {\n		float grid_position = rand( gl_FragCoord.xy );\n		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n		return color + dither_shift_RGB;\n	}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n	roughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n	uniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n		struct SpotLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );\n		#ifdef USE_REVERSED_DEPTH_BUFFER\n			return step( depth, compare );\n		#else\n			return step( compare, depth );\n		#endif\n	}\n	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n		return unpackRGBATo2Half( texture2D( shadow, uv ) );\n	}\n	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {\n		float occlusion = 1.0;\n		vec2 distribution = texture2DDistribution( shadow, uv );\n		#ifdef USE_REVERSED_DEPTH_BUFFER\n			float hard_shadow = step( distribution.x, compare );\n		#else\n			float hard_shadow = step( compare, distribution.x );\n		#endif\n		if ( hard_shadow != 1.0 ) {\n			float distance = compare - distribution.x;\n			float variance = max( 0.00000, distribution.y * distribution.y );\n			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n		}\n		return occlusion;\n	}\n	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n		float shadow = 1.0;\n		shadowCoord.xyz /= shadowCoord.w;\n		shadowCoord.z += shadowBias;\n		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n		if ( frustumTest ) {\n		#if defined( SHADOWMAP_TYPE_PCF )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx0 = - texelSize.x * shadowRadius;\n			float dy0 = - texelSize.y * shadowRadius;\n			float dx1 = + texelSize.x * shadowRadius;\n			float dy1 = + texelSize.y * shadowRadius;\n			float dx2 = dx0 / 2.0;\n			float dy2 = dy0 / 2.0;\n			float dx3 = dx1 / 2.0;\n			float dy3 = dy1 / 2.0;\n			shadow = (\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n			) * ( 1.0 / 17.0 );\n		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx = texelSize.x;\n			float dy = texelSize.y;\n			vec2 uv = shadowCoord.xy;\n			vec2 f = fract( uv * shadowMapSize + 0.5 );\n			uv -= f * texelSize;\n			shadow = (\n				texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n						  f.x ),\n					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n						  f.x ),\n					 f.y )\n			) * ( 1.0 / 9.0 );\n		#elif defined( SHADOWMAP_TYPE_VSM )\n			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#else\n			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#endif\n		}\n		return mix( 1.0, shadow, shadowIntensity );\n	}\n	vec2 cubeToUV( vec3 v, float texelSizeY ) {\n		vec3 absV = abs( v );\n		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n		absV *= scaleToCube;\n		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n		vec2 planar = v.xy;\n		float almostATexel = 1.5 * texelSizeY;\n		float almostOne = 1.0 - almostATexel;\n		if ( absV.z >= almostOne ) {\n			if ( v.z > 0.0 )\n				planar.x = 4.0 - v.x;\n		} else if ( absV.x >= almostOne ) {\n			float signX = sign( v.x );\n			planar.x = v.z * signX + 2.0 * signX;\n		} else if ( absV.y >= almostOne ) {\n			float signY = sign( v.y );\n			planar.x = v.x + 2.0 * signY + 2.0;\n			planar.y = v.z * signY - 2.0;\n		}\n		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n	}\n	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n		float shadow = 1.0;\n		vec3 lightToPosition = shadowCoord.xyz;\n		\n		float lightToPositionLength = length( lightToPosition );\n		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;\n			vec3 bd3D = normalize( lightToPosition );\n			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n				shadow = (\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n				) * ( 1.0 / 9.0 );\n			#else\n				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n			#endif\n		}\n		return mix( 1.0, shadow, shadowIntensity );\n	}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		struct SpotLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n	vec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n		shadowWorldPosition = worldPosition;\n		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n		#endif\n		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n	float shadow = 1.0;\n	#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n		directionalLight = directionalLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n		spotLight = spotLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n		pointLight = pointLightShadows[ i ];\n		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#endif\n	return shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n	uniform highp sampler2D boneTexture;\n	mat4 getBoneMatrix( const in float i ) {\n		int size = textureSize( boneTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	transformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n	#ifdef USE_TANGENT\n		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n	#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n	specularStrength = texelSpecular.r;\n#else\n	specularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n	return saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	return saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	color = max( vec3( 0.0 ), color - 0.004 );\n	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n	return a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n	const mat3 ACESInputMat = mat3(\n		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),\n		vec3( 0.04823, 0.01566, 0.83777 )\n	);\n	const mat3 ACESOutputMat = mat3(\n		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),\n		vec3( -0.07367, -0.00605,  1.07602 )\n	);\n	color *= toneMappingExposure / 0.6;\n	color = ACESInputMat * color;\n	color = RRTAndODTFit( color );\n	color = ACESOutputMat * color;\n	return saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n	vec3( 1.6605, - 0.1246, - 0.0182 ),\n	vec3( - 0.5876, 1.1329, - 0.1006 ),\n	vec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n	vec3( 0.6274, 0.0691, 0.0164 ),\n	vec3( 0.3293, 0.9195, 0.0880 ),\n	vec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n	vec3 x2 = x * x;\n	vec3 x4 = x2 * x2;\n	return + 15.5 * x4 * x2\n		- 40.14 * x4 * x\n		+ 31.96 * x4\n		- 6.868 * x2 * x\n		+ 0.4298 * x2\n		+ 0.1191 * x\n		- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n	const mat3 AgXInsetMatrix = mat3(\n		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n	);\n	const mat3 AgXOutsetMatrix = mat3(\n		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n	);\n	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;\n	color *= toneMappingExposure;\n	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n	color = AgXInsetMatrix * color;\n	color = max( color, 1e-10 );	color = log2( color );\n	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n	color = clamp( color, 0.0, 1.0 );\n	color = agxDefaultContrastApprox( color );\n	color = AgXOutsetMatrix * color;\n	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n	color = clamp( color, 0.0, 1.0 );\n	return color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n	const float StartCompression = 0.8 - 0.04;\n	const float Desaturation = 0.15;\n	color *= toneMappingExposure;\n	float x = min( color.r, min( color.g, color.b ) );\n	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n	color -= offset;\n	float peak = max( color.r, max( color.g, color.b ) );\n	if ( peak < StartCompression ) return color;\n	float d = 1. - StartCompression;\n	float newPeak = 1. - d * d / ( peak + d - StartCompression );\n	color *= newPeak / peak;\n	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n	return mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n	material.transmission = transmission;\n	material.transmissionAlpha = 1.0;\n	material.thickness = thickness;\n	material.attenuationDistance = attenuationDistance;\n	material.attenuationColor = attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n	#endif\n	vec3 pos = vWorldPosition;\n	vec3 v = normalize( cameraPosition - pos );\n	vec3 n = inverseTransformDirection( normal, viewMatrix );\n	vec4 transmitted = getIBLVolumeRefraction(\n		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n		material.attenuationColor, material.attenuationDistance );\n	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n	uniform float transmission;\n	uniform float thickness;\n	uniform float attenuationDistance;\n	uniform vec3 attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		uniform sampler2D transmissionMap;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		uniform sampler2D thicknessMap;\n	#endif\n	uniform vec2 transmissionSamplerSize;\n	uniform sampler2D transmissionSamplerMap;\n	uniform mat4 modelMatrix;\n	uniform mat4 projectionMatrix;\n	varying vec3 vWorldPosition;\n	float w0( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n	}\n	float w1( float a ) {\n		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n	}\n	float w2( float a ){\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n	}\n	float w3( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * a * a );\n	}\n	float g0( float a ) {\n		return w0( a ) + w1( a );\n	}\n	float g1( float a ) {\n		return w2( a ) + w3( a );\n	}\n	float h0( float a ) {\n		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n	}\n	float h1( float a ) {\n		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n	}\n	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n		uv = uv * texelSize.zw + 0.5;\n		vec2 iuv = floor( uv );\n		vec2 fuv = fract( uv );\n		float g0x = g0( fuv.x );\n		float g1x = g1( fuv.x );\n		float h0x = h0( fuv.x );\n		float h1x = h1( fuv.x );\n		float h0y = h0( fuv.y );\n		float h1y = h1( fuv.y );\n		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n	}\n	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n		vec2 fLodSizeInv = 1.0 / fLodSize;\n		vec2 cLodSizeInv = 1.0 / cLodSize;\n		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n		return mix( fSample, cSample, fract( lod ) );\n	}\n	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n		vec3 modelScale;\n		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n		return normalize( refractionVector ) * thickness * modelScale;\n	}\n	float applyIorToRoughness( const in float roughness, const in float ior ) {\n		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n	}\n	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n	}\n	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n		if ( isinf( attenuationDistance ) ) {\n			return vec3( 1.0 );\n		} else {\n			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;\n		}\n	}\n	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n		const in vec3 attenuationColor, const in float attenuationDistance ) {\n		vec4 transmittedLight;\n		vec3 transmittance;\n		#ifdef USE_DISPERSION\n			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n			for ( int i = 0; i < 3; i ++ ) {\n				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n				vec3 refractedRayExit = position + transmissionRay;\n				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n				vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n				refractionCoords += 1.0;\n				refractionCoords /= 2.0;\n				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n				transmittedLight[ i ] = transmissionSample[ i ];\n				transmittedLight.a += transmissionSample.a;\n				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n			}\n			transmittedLight.a /= 3.0;\n		#else\n			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n			vec3 refractedRayExit = position + transmissionRay;\n			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n			vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n			refractionCoords += 1.0;\n			refractionCoords /= 2.0;\n			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n		#endif\n		vec3 attenuatedColor = transmittance * transmittedLight.rgb;\n		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n	}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	uniform mat3 mapTransform;\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform mat3 alphaMapTransform;\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	uniform mat3 lightMapTransform;\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	uniform mat3 aoMapTransform;\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	uniform mat3 bumpMapTransform;\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	uniform mat3 normalMapTransform;\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	uniform mat3 displacementMapTransform;\n	varying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	uniform mat3 emissiveMapTransform;\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	uniform mat3 metalnessMapTransform;\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	uniform mat3 roughnessMapTransform;\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	uniform mat3 anisotropyMapTransform;\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	uniform mat3 clearcoatMapTransform;\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform mat3 clearcoatNormalMapTransform;\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform mat3 clearcoatRoughnessMapTransform;\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	uniform mat3 sheenColorMapTransform;\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	uniform mat3 sheenRoughnessMapTransform;\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	uniform mat3 iridescenceMapTransform;\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform mat3 iridescenceThicknessMapTransform;\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	uniform mat3 specularMapTransform;\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	uniform mat3 specularColorMapTransform;\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	uniform mat3 specularIntensityMapTransform;\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	vUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n	vec4 worldPosition = vec4( transformed, 1.0 );\n	#ifdef USE_BATCHING\n		worldPosition = batchingMatrix * worldPosition;\n	#endif\n	#ifdef USE_INSTANCING\n		worldPosition = instanceMatrix * worldPosition;\n	#endif\n	worldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	gl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texColor = texture2D( t2D, vUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n	uniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n	uniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n	#elif defined( ENVMAP_TYPE_CUBE_UV )\n		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n	#else\n		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n	gl_FragColor = texColor;\n	gl_FragColor.a *= opacity;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n	uniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#if DEPTH_PACKING == 3200\n		diffuseColor.a = opacity;\n	#endif\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <logdepthbuf_fragment>\n	#ifdef USE_REVERSED_DEPTH_BUFFER\n		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];\n	#else\n		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;\n	#endif\n	#if DEPTH_PACKING == 3200\n		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n	#elif DEPTH_PACKING == 3201\n		gl_FragColor = packDepthToRGBA( fragCoordZ );\n	#elif DEPTH_PACKING == 3202\n		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n	#elif DEPTH_PACKING == 3203\n		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n	#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <clipping_planes_vertex>\n	vWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	float dist = length( vWorldPosition - referencePosition );\n	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n	dist = saturate( dist );\n	gl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vec3 direction = normalize( vWorldDirection );\n	vec2 sampleUV = equirectUv( direction );\n	gl_FragColor = texture2D( tEquirect, sampleUV );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	vLineDistance = scale * lineDistance;\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinbase_vertex>\n		#include <skinnormal_vertex>\n		#include <defaultnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n	#else\n		reflectedLight.indirectDiffuse += vec3( 1.0 );\n	#endif\n	#include <aomap_fragment>\n	reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n	vec3 outgoingLight = reflectedLight.indirectDiffuse;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_lambert_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n	vViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	vec3 viewDir = normalize( vViewPosition );\n	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n	vec3 y = cross( viewDir, x );\n	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n	#ifdef USE_MATCAP\n		vec4 matcapColor = texture2D( matcap, uv );\n	#else\n		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n	#endif\n	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	vViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n	#ifdef OPAQUE\n		gl_FragColor.a = 1.0;\n	#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_phong_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n	varying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n	vWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n	#define IOR\n	#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n	uniform float ior;\n#endif\n#ifdef USE_SPECULAR\n	uniform float specularIntensity;\n	uniform vec3 specularColor;\n	#ifdef USE_SPECULAR_COLORMAP\n		uniform sampler2D specularColorMap;\n	#endif\n	#ifdef USE_SPECULAR_INTENSITYMAP\n		uniform sampler2D specularIntensityMap;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT\n	uniform float clearcoat;\n	uniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n	uniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n	uniform float iridescence;\n	uniform float iridescenceIOR;\n	uniform float iridescenceThicknessMinimum;\n	uniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n	uniform vec3 sheenColor;\n	uniform float sheenRoughness;\n	#ifdef USE_SHEEN_COLORMAP\n		uniform sampler2D sheenColorMap;\n	#endif\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		uniform sampler2D sheenRoughnessMap;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	uniform vec2 anisotropyVector;\n	#ifdef USE_ANISOTROPYMAP\n		uniform sampler2D anisotropyMap;\n	#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <roughnessmap_fragment>\n	#include <metalnessmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <clearcoat_normal_fragment_begin>\n	#include <clearcoat_normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_physical_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n	#include <transmission_fragment>\n	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n	#ifdef USE_SHEEN\n		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n	#endif\n	#ifdef USE_CLEARCOAT\n		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n	#endif\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_toon_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n	varying vec2 vUv;\n	uniform mat3 uvTransform;\n#endif\nvoid main() {\n	#ifdef USE_POINTS_UV\n		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	#endif\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	gl_PointSize = size;\n	#ifdef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n	#endif\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_particle_fragment>\n	#include <color_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n	#include <logdepthbuf_fragment>\n	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	vec4 mvPosition = modelViewMatrix[ 3 ];\n	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n	#ifndef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) scale *= - mvPosition.z;\n	#endif\n	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n	vec2 rotatedPosition;\n	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n	mvPosition.xy += rotatedPosition;\n	gl_Position = projectionMatrix * mvPosition;\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}"},A7={common:{diffuse:{value:new aQ(0xffffff)},opacity:{value:1},map:{value:null},mapTransform:{value:new ns},alphaMap:{value:null},alphaMapTransform:{value:new ns},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ns}},envmap:{envMap:{value:null},envMapRotation:{value:new ns},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ns}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ns}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ns},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ns},normalScale:{value:new nt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ns},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ns}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ns}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ns}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new aQ(0xffffff)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new aQ(0xffffff)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ns},alphaTest:{value:0},uvTransform:{value:new ns}},sprite:{diffuse:{value:new aQ(0xffffff)},opacity:{value:1},center:{value:new nt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ns},alphaMap:{value:null},alphaMapTransform:{value:new ns},alphaTest:{value:0}}},ve={basic:{uniforms:sS([A7.common,A7.specularmap,A7.envmap,A7.aomap,A7.lightmap,A7.fog]),vertexShader:A9.meshbasic_vert,fragmentShader:A9.meshbasic_frag},lambert:{uniforms:sS([A7.common,A7.specularmap,A7.envmap,A7.aomap,A7.lightmap,A7.emissivemap,A7.bumpmap,A7.normalmap,A7.displacementmap,A7.fog,A7.lights,{emissive:{value:new aQ(0)}}]),vertexShader:A9.meshlambert_vert,fragmentShader:A9.meshlambert_frag},phong:{uniforms:sS([A7.common,A7.specularmap,A7.envmap,A7.aomap,A7.lightmap,A7.emissivemap,A7.bumpmap,A7.normalmap,A7.displacementmap,A7.fog,A7.lights,{emissive:{value:new aQ(0)},specular:{value:new aQ(1118481)},shininess:{value:30}}]),vertexShader:A9.meshphong_vert,fragmentShader:A9.meshphong_frag},standard:{uniforms:sS([A7.common,A7.envmap,A7.aomap,A7.lightmap,A7.emissivemap,A7.bumpmap,A7.normalmap,A7.displacementmap,A7.roughnessmap,A7.metalnessmap,A7.fog,A7.lights,{emissive:{value:new aQ(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:A9.meshphysical_vert,fragmentShader:A9.meshphysical_frag},toon:{uniforms:sS([A7.common,A7.aomap,A7.lightmap,A7.emissivemap,A7.bumpmap,A7.normalmap,A7.displacementmap,A7.gradientmap,A7.fog,A7.lights,{emissive:{value:new aQ(0)}}]),vertexShader:A9.meshtoon_vert,fragmentShader:A9.meshtoon_frag},matcap:{uniforms:sS([A7.common,A7.bumpmap,A7.normalmap,A7.displacementmap,A7.fog,{matcap:{value:null}}]),vertexShader:A9.meshmatcap_vert,fragmentShader:A9.meshmatcap_frag},points:{uniforms:sS([A7.points,A7.fog]),vertexShader:A9.points_vert,fragmentShader:A9.points_frag},dashed:{uniforms:sS([A7.common,A7.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:A9.linedashed_vert,fragmentShader:A9.linedashed_frag},depth:{uniforms:sS([A7.common,A7.displacementmap]),vertexShader:A9.depth_vert,fragmentShader:A9.depth_frag},normal:{uniforms:sS([A7.common,A7.bumpmap,A7.normalmap,A7.displacementmap,{opacity:{value:1}}]),vertexShader:A9.meshnormal_vert,fragmentShader:A9.meshnormal_frag},sprite:{uniforms:sS([A7.sprite,A7.fog]),vertexShader:A9.sprite_vert,fragmentShader:A9.sprite_frag},background:{uniforms:{uvTransform:{value:new ns},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:A9.background_vert,fragmentShader:A9.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new ns}},vertexShader:A9.backgroundCube_vert,fragmentShader:A9.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:A9.cube_vert,fragmentShader:A9.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:A9.equirect_vert,fragmentShader:A9.equirect_frag},distanceRGBA:{uniforms:sS([A7.common,A7.displacementmap,{referencePosition:{value:new ni},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:A9.distanceRGBA_vert,fragmentShader:A9.distanceRGBA_frag},shadow:{uniforms:sS([A7.lights,A7.fog,{color:{value:new aQ(0)},opacity:{value:1}}]),vertexShader:A9.shadow_vert,fragmentShader:A9.shadow_frag}};ve.physical={uniforms:sS([ve.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ns},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ns},clearcoatNormalScale:{value:new nt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ns},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ns},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ns},sheen:{value:0},sheenColor:{value:new aQ(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ns},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ns},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ns},transmissionSamplerSize:{value:new nt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ns},attenuationDistance:{value:0},attenuationColor:{value:new aQ(0)},specularColor:{value:new aQ(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ns},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ns},anisotropyVector:{value:new nt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ns}}]),vertexShader:A9.meshphysical_vert,fragmentShader:A9.meshphysical_frag};let vt={r:0,b:0,g:0},vr=new ao,vi=new n8;function vn(e,t,r,i,n,a,s){let o,l;let u=new aQ(0),c=!0===a?0:1,h=null,d=0,f=null;function p(e){let i=!0===e.isScene?e.background:null;return i&&i.isTexture&&(i=(e.backgroundBlurriness>0?r:t).get(i)),i}function m(t,r){t.getRGB(vt,sw(e)),i.buffers.color.setClear(vt.r,vt.g,vt.b,r,s)}return{getClearColor:function(){return u},setClearColor:function(e,t=1){u.set(e),m(u,c=t)},getClearAlpha:function(){return c},setClearAlpha:function(e){m(u,c=e)},render:function(t){let r=!1,n=p(t);null===n?m(u,c):n&&n.isColor&&(m(n,1),r=!0);let a=e.xr.getEnvironmentBlendMode();"additive"===a?i.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===a&&i.buffers.color.setClear(0,0,0,0,s),(e.autoClear||r)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,r){let i=p(r);i&&(i.isCubeTexture||i.mapping===tV)?(void 0===l&&((l=new sE(new s_(1,1,1),new sT({name:"BackgroundCubeMaterial",uniforms:sb(ve.backgroundCube.uniforms),vertexShader:ve.backgroundCube.vertexShader,fragmentShader:ve.backgroundCube.fragmentShader,side:e0,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1}))).geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),vr.copy(r.backgroundRotation),vr.x*=-1,vr.y*=-1,vr.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(vr.y*=-1,vr.z*=-1),l.material.uniforms.envMap.value=i,l.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=r.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=r.backgroundIntensity,l.material.uniforms.backgroundRotation.value.setFromMatrix4(vi.makeRotationFromEuler(vr)),l.material.toneMapped=nA.getTransfer(i.colorSpace)!==ih,(h!==i||d!==i.version||f!==e.toneMapping)&&(l.material.needsUpdate=!0,h=i,d=i.version,f=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null)):i&&i.isTexture&&(void 0===o&&((o=new sE(new uf(2,2),new sT({name:"BackgroundMaterial",uniforms:sb(ve.background.uniforms),vertexShader:ve.background.vertexShader,fragmentShader:ve.background.fragmentShader,side:eZ,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=i,o.material.uniforms.backgroundIntensity.value=r.backgroundIntensity,o.material.toneMapped=nA.getTransfer(i.colorSpace)!==ih,!0===i.matrixAutoUpdate&&i.updateMatrix(),o.material.uniforms.uvTransform.value.copy(i.matrix),(h!==i||d!==i.version||f!==e.toneMapping)&&(o.material.needsUpdate=!0,h=i,d=i.version,f=e.toneMapping),o.layers.enableAll(),t.unshift(o,o.geometry,o.material,0,0,null))},dispose:function(){void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0),void 0!==o&&(o.geometry.dispose(),o.material.dispose(),o=void 0)}}}function va(e,t){let r=e.getParameter(e.MAX_VERTEX_ATTRIBS),i={},n=u(null),a=n,s=!1;function o(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function u(e){let t=[],i=[],n=[];for(let e=0;e<r;e++)t[e]=0,i[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function c(){let e=a.newAttributes;for(let t=0,r=e.length;t<r;t++)e[t]=0}function h(e){d(e,0)}function d(t,r){let i=a.newAttributes,n=a.enabledAttributes,s=a.attributeDivisors;i[t]=1,0===n[t]&&(e.enableVertexAttribArray(t),n[t]=1),s[t]!==r&&(e.vertexAttribDivisor(t,r),s[t]=r)}function f(){let t=a.newAttributes,r=a.enabledAttributes;for(let i=0,n=r.length;i<n;i++)r[i]!==t[i]&&(e.disableVertexAttribArray(i),r[i]=0)}function p(t,r,i,n,a,s,o){!0===o?e.vertexAttribIPointer(t,r,i,a,s):e.vertexAttribPointer(t,r,i,n,a,s)}function m(){g(),s=!0,a!==n&&o((a=n).object)}function g(){n.geometry=null,n.program=null,n.wireframe=!1}return{setup:function(r,n,l,m,g){let A=!1,v=function(t,r,n){let a=!0===n.wireframe,s=i[t.id];void 0===s&&(s={},i[t.id]=s);let o=s[r.id];void 0===o&&(o={},s[r.id]=o);let l=o[a];return void 0===l&&(l=u(e.createVertexArray()),o[a]=l),l}(m,l,n);a!==v&&o((a=v).object),(A=function(e,t,r,i){let n=a.attributes,s=t.attributes,o=0,l=r.getAttributes();for(let t in l)if(l[t].location>=0){let r=n[t],i=s[t];if(void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor)),void 0===r||r.attribute!==i||i&&r.data!==i.data)return!0;o++}return a.attributesNum!==o||a.index!==i}(r,m,l,g))&&function(e,t,r,i){let n={},s=t.attributes,o=0,l=r.getAttributes();for(let t in l)if(l[t].location>=0){let r=s[t];void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor));let i={};i.attribute=r,r&&r.data&&(i.data=r.data),n[t]=i,o++}a.attributes=n,a.attributesNum=o,a.index=i}(r,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(A||s)&&(s=!1,function(r,i,n,a){c();let s=a.attributes,o=n.getAttributes(),l=i.defaultAttributeValues;for(let i in o){let n=o[i];if(n.location>=0){let o=s[i];if(void 0===o&&("instanceMatrix"===i&&r.instanceMatrix&&(o=r.instanceMatrix),"instanceColor"===i&&r.instanceColor&&(o=r.instanceColor)),void 0!==o){let i=o.normalized,s=o.itemSize,l=t.get(o);if(void 0===l)continue;let u=l.buffer,c=l.type,f=l.bytesPerElement,m=c===e.INT||c===e.UNSIGNED_INT||o.gpuType===t9;if(o.isInterleavedBufferAttribute){let t=o.data,l=t.stride,g=o.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<n.locationSize;e++)d(n.location+e,t.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<n.locationSize;e++)h(n.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<n.locationSize;e++)p(n.location+e,s/n.locationSize,c,i,l*f,(g+s/n.locationSize*e)*f,m)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<n.locationSize;e++)d(n.location+e,o.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<n.locationSize;e++)h(n.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<n.locationSize;e++)p(n.location+e,s/n.locationSize,c,i,s*f,s/n.locationSize*e*f,m)}}else if(void 0!==l){let t=l[i];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(n.location,t);break;case 3:e.vertexAttrib3fv(n.location,t);break;case 4:e.vertexAttrib4fv(n.location,t);break;default:e.vertexAttrib1fv(n.location,t)}}}}f()}(r,n,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){for(let e in m(),i){let t=i[e];for(let e in t){let r=t[e];for(let e in r)l(r[e].object),delete r[e];delete t[e]}delete i[e]}},releaseStatesOfGeometry:function(e){if(void 0===i[e.id])return;let t=i[e.id];for(let e in t){let r=t[e];for(let e in r)l(r[e].object),delete r[e];delete t[e]}delete i[e.id]},releaseStatesOfProgram:function(e){for(let t in i){let r=i[t];if(void 0===r[e.id])continue;let n=r[e.id];for(let e in n)l(n[e].object),delete n[e];delete r[e.id]}},initAttributes:c,enableAttribute:h,disableUnusedAttributes:f}}function vs(e,t,r){let i;function n(t,n,a){0!==a&&(e.drawArraysInstanced(i,t,n,a),r.update(n,i,a))}this.setMode=function(e){i=e},this.render=function(t,n){e.drawArrays(i,t,n),r.update(n,i,1)},this.renderInstances=n,this.renderMultiDraw=function(e,n,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,e,0,n,0,a);let s=0;for(let e=0;e<a;e++)s+=n[e];r.update(s,i,1)},this.renderMultiDrawInstances=function(e,a,s,o){if(0===s)return;let l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)n(e[t],a[t],o[t]);else{l.multiDrawArraysInstancedWEBGL(i,e,0,a,0,o,0,s);let t=0;for(let e=0;e<s;e++)t+=a[e]*o[e];r.update(t,i,1)}}}function vo(e,t,r,i){let n;function a(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let s=void 0!==r.precision?r.precision:"highp",o=a(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);let l=!0===r.logarithmicDepthBuffer,u=!0===r.reversedDepthBuffer&&t.has("EXT_clip_control"),c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),f=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){let r=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:a,textureFormatReadable:function(t){return t===ru||i.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(r){let n=r===rt&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return r===t4||i.convert(r)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)||r===re||!!n},precision:s,logarithmicDepthBuffer:l,reversedDepthBuffer:u,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:m,maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function vl(e){let t=this,r=null,i=0,n=!1,a=!1,s=new oC,o=new ns,l={value:null,needsUpdate:!1};function u(e,r,i,n){let a=null!==e?e.length:0,u=null;if(0!==a){if(u=l.value,!0!==n||null===u){let t=i+4*a,n=r.matrixWorldInverse;o.getNormalMatrix(n),(null===u||u.length<t)&&(u=new Float32Array(t));for(let t=0,r=i;t!==a;++t,r+=4)s.copy(e[t]).applyMatrix4(n,o),s.normal.toArray(u,r),u[r+3]=s.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){let r=0!==e.length||t||0!==i||n;return n=t,i=e.length,r},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){r=u(e,t,0)},this.setState=function(s,o,c){let h=s.clippingPlanes,d=s.clipIntersection,f=s.clipShadows,p=e.get(s);if(n&&null!==h&&0!==h.length&&(!a||f)){let e=a?0:i,t=4*e,n=p.clippingState||null;l.value=n,n=u(h,o,t,c);for(let e=0;e!==t;++e)n[e]=r[e];p.clippingState=n,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}else a?u(null):(l.value!==r&&(l.value=r,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0)}}function vu(e){let t=new WeakMap;function r(e,t){return t===tH?e.mapping=tz:t===tQ&&(e.mapping=tG),e}function i(e){let r=e.target;r.removeEventListener("dispose",i);let n=t.get(r);void 0!==n&&(t.delete(r),n.dispose())}return{get:function(n){if(n&&n.isTexture){let a=n.mapping;if(a===tH||a===tQ){if(t.has(n))return r(t.get(n).texture,n.mapping);{let a=n.image;if(!a||!(a.height>0))return null;{let s=new sk(a.height);return s.fromEquirectangularTexture(e,n),t.set(n,s),n.addEventListener("dispose",i),r(s.texture,n.mapping)}}}}return n},dispose:function(){t=new WeakMap}}}let vc=[.125,.215,.35,.446,.526,.582],vh=new cv,vd=new aQ,vf=null,vp=0,vm=0,vg=!1,vA=(1+Math.sqrt(5))/2,vv=1/vA,vy=[new ni(-vA,vv,0),new ni(vA,vv,0),new ni(-vv,0,vA),new ni(vv,0,vA),new ni(0,vA,-vv),new ni(0,vA,vv),new ni(-1,1,-1),new ni(1,1,-1),new ni(-1,1,1),new ni(1,1,1)],vE=new ni;class vx{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100,n={}){let{size:a=256,position:s=vE}=n;vf=this._renderer.getRenderTarget(),vp=this._renderer.getActiveCubeFace(),vm=this._renderer.getActiveMipmapLevel(),vg=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);let o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,r,i,o,s),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=vw(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=vS(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(vf,vp,vm),this._renderer.xr.enabled=vg,e.scissorTest=!1,vb(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===tz||e.mapping===tG?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),vf=this._renderer.getRenderTarget(),vp=this._renderer.getActiveCubeFace(),vm=this._renderer.getActiveMipmapLevel(),vg=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;let r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:tZ,minFilter:tZ,generateMipmaps:!1,type:rt,format:ru,colorSpace:iu,depthBuffer:!1},i=v_(e,t,r);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=v_(e,t,r);let{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){let t=[],r=[],i=[],n=e,a=e-4+1+vc.length;for(let s=0;s<a;s++){let a=Math.pow(2,n);r.push(a);let o=1/a;s>e-4?o=vc[s-e+4-1]:0===s&&(o=0),i.push(o);let l=1/(a-2),u=-l,c=1+l,h=[u,u,c,u,c,c,u,u,c,c,u,c],d=new Float32Array(108),f=new Float32Array(72),p=new Float32Array(36);for(let e=0;e<6;e++){let t=e%3*2/3-1,r=e>2?0:-1,i=[t,r,0,t+2/3,r,0,t+2/3,r+1,0,t,r,0,t+2/3,r+1,0,t,r+1,0];d.set(i,18*e),f.set(h,12*e);let n=[e,e,e,e,e,e];p.set(n,6*e)}let m=new sl;m.setAttribute("position",new a1(d,3)),m.setAttribute("uv",new a1(f,2)),m.setAttribute("faceIndex",new a1(p,1)),t.push(m),n>4&&n--}return{lodPlanes:t,sizeLods:r,sigmas:i}}(i)),this._blurMaterial=new sT({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(20)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new ni(0,1,0)}},vertexShader:vC(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:e2,depthTest:!1,depthWrite:!1})}return i}_compileMaterial(e){let t=new sE(this._lodPlanes[0],e);this._renderer.compile(t,vh)}_sceneToCubeUV(e,t,r,i,n){let a=new sD(90,1,t,r),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,u=l.autoClear,c=l.toneMapping;l.getClearColor(vd),l.toneMapping=tM,l.autoClear=!1,l.state.buffers.depth.getReversed()&&(l.setRenderTarget(i),l.clearDepth(),l.setRenderTarget(null));let h=new aY({name:"PMREM.Background",side:e0,depthWrite:!1,depthTest:!1}),d=new sE(new s_,h),f=!1,p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,f=!0):(h.color.copy(vd),f=!0);for(let t=0;t<6;t++){let r=t%3;0===r?(a.up.set(0,s[t],0),a.position.set(n.x,n.y,n.z),a.lookAt(n.x+o[t],n.y,n.z)):1===r?(a.up.set(0,0,s[t]),a.position.set(n.x,n.y,n.z),a.lookAt(n.x,n.y+o[t],n.z)):(a.up.set(0,s[t],0),a.position.set(n.x,n.y,n.z),a.lookAt(n.x,n.y,n.z+o[t]));let u=this._cubeSize;vb(i,r*u,t>2?u:0,u,u),l.setRenderTarget(i),f&&l.render(d,a),l.render(e,a)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=c,l.autoClear=u,e.background=p}_textureToCubeUV(e,t){let r=this._renderer,i=e.mapping===tz||e.mapping===tG;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=vw()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=vS());let n=i?this._cubemapMaterial:this._equirectMaterial,a=new sE(this._lodPlanes[0],n);n.uniforms.envMap.value=e;let s=this._cubeSize;vb(t,0,0,3*s,2*s),r.setRenderTarget(t),r.render(a,vh)}_applyPMREM(e){let t=this._renderer,r=t.autoClear;t.autoClear=!1;let i=this._lodPlanes.length;for(let t=1;t<i;t++){let r=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),n=vy[(i-t-1)%vy.length];this._blur(e,t-1,t,r,n)}t.autoClear=r}_blur(e,t,r,i,n){let a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,i,"latitudinal",n),this._halfBlur(a,e,r,r,i,"longitudinal",n)}_halfBlur(e,t,r,i,n,a,s){let o=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");let u=new sE(this._lodPlanes[i],l),c=l.uniforms,h=this._sizeLods[r]-1,d=isFinite(n)?Math.PI/(2*h):2*Math.PI/39,f=n/d,p=isFinite(n)?1+Math.floor(3*f):20;p>20&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);let m=[],g=0;for(let e=0;e<20;++e){let t=e/f,r=Math.exp(-t*t/2);m.push(r),0===e?g+=r:e<p&&(g+=2*r)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;c.envMap.value=e.texture,c.samples.value=p,c.weights.value=m,c.latitudinal.value="latitudinal"===a,s&&(c.poleAxis.value=s);let{_lodMax:A}=this;c.dTheta.value=d,c.mipInt.value=A-r;let v=this._sizeLods[i],y=4*(this._cubeSize-v);vb(t,3*v*(i>A-4?i-A+4:0),y,3*v,2*v),o.setRenderTarget(t),o.render(u,vh)}}function v_(e,t,r){let i=new nM(e,t,r);return i.texture.mapping=tV,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function vb(e,t,r,i,n){e.viewport.set(t,r,i,n),e.scissor.set(t,r,i,n)}function vS(){return new sT({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:vC(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:e2,depthTest:!1,depthWrite:!1})}function vw(){return new sT({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:vC(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:e2,depthTest:!1,depthWrite:!1})}function vC(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function vT(e){let t=new WeakMap,r=null;function i(e){let r=e.target;r.removeEventListener("dispose",i);let n=t.get(r);void 0!==n&&(t.delete(r),n.dispose())}return{get:function(n){if(n&&n.isTexture){let a=n.mapping,s=a===tH||a===tQ,o=a===tz||a===tG;if(s||o){let a=t.get(n),l=void 0!==a?a.texture.pmremVersion:0;if(n.isRenderTargetTexture&&n.pmremVersion!==l)return null===r&&(r=new vx(e)),(a=s?r.fromEquirectangular(n,a):r.fromCubemap(n,a)).texture.pmremVersion=n.pmremVersion,t.set(n,a),a.texture;if(void 0!==a)return a.texture;{let l=n.image;return s&&l&&l.height>0||o&&l&&function(e){let t=0;for(let r=0;r<6;r++)void 0!==e[r]&&t++;return 6===t}(l)?(null===r&&(r=new vx(e)),(a=s?r.fromEquirectangular(n):r.fromCubemap(n)).texture.pmremVersion=n.pmremVersion,t.set(n,a),n.addEventListener("dispose",i),a.texture):null}}}return n},dispose:function(){t=new WeakMap,null!==r&&(r.dispose(),r=null)}}}function vI(e){let t={};function r(r){let i;if(void 0!==t[r])return t[r];switch(r){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(r)}return t[r]=i,i}return{has:function(e){return null!==r(e)},init:function(){r("EXT_color_buffer_float"),r("WEBGL_clip_cull_distance"),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float"),r("WEBGL_multisampled_render_to_texture"),r("WEBGL_render_shared_exponent")},get:function(e){let t=r(e);return null===t&&np("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function vM(e,t,r,i){let n={},a=new WeakMap;function s(e){let o=e.target;for(let e in null!==o.index&&t.remove(o.index),o.attributes)t.remove(o.attributes[e]);o.removeEventListener("dispose",s),delete n[o.id];let l=a.get(o);l&&(t.remove(l),a.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,r.memory.geometries--}function o(e){let r=[],i=e.index,n=e.attributes.position,s=0;if(null!==i){let e=i.array;s=i.version;for(let t=0,i=e.length;t<i;t+=3){let i=e[t+0],n=e[t+1],a=e[t+2];r.push(i,n,n,a,a,i)}}else{if(void 0===n)return;let e=n.array;s=n.version;for(let t=0,i=e.length/3-1;t<i;t+=3){let e=t+0,i=t+1,n=t+2;r.push(e,i,i,n,n,e)}}let o=new(nl(r)?a9:a6)(r,1);o.version=s;let l=a.get(e);l&&t.remove(l),a.set(e,o)}return{get:function(e,t){return!0===n[t.id]||(t.addEventListener("dispose",s),n[t.id]=!0,r.memory.geometries++),t},update:function(r){let i=r.attributes;for(let r in i)t.update(i[r],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){let t=a.get(e);if(t){let r=e.index;null!==r&&t.version<r.version&&o(e)}else o(e);return a.get(e)}}}function vR(e,t,r){let i,n,a;function s(t,s,o){0!==o&&(e.drawElementsInstanced(i,s,n,t*a,o),r.update(s,i,o))}this.setMode=function(e){i=e},this.setIndex=function(e){n=e.type,a=e.bytesPerElement},this.render=function(t,s){e.drawElements(i,s,n,t*a),r.update(s,i,1)},this.renderInstances=s,this.renderMultiDraw=function(e,a,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,a,0,n,e,0,s);let o=0;for(let e=0;e<s;e++)o+=a[e];r.update(o,i,1)},this.renderMultiDrawInstances=function(e,o,l,u){if(0===l)return;let c=t.get("WEBGL_multi_draw");if(null===c)for(let t=0;t<e.length;t++)s(e[t]/a,o[t],u[t]);else{c.multiDrawElementsInstancedWEBGL(i,o,0,n,e,0,u,0,l);let t=0;for(let e=0;e<l;e++)t+=o[e]*u[e];r.update(t,i,1)}}}function vB(e){let t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(r,i,n){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r/3*n;break;case e.LINES:t.lines+=r/2*n;break;case e.LINE_STRIP:t.lines+=n*(r-1);break;case e.LINE_LOOP:t.lines+=n*r;break;case e.POINTS:t.points+=n*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function vD(e,t,r){let i=new WeakMap,n=new nT;return{update:function(a,s,o){let l=a.morphTargetInfluences,u=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,c=void 0!==u?u.length:0,h=i.get(s);if(void 0===h||h.count!==c){void 0!==h&&h.texture.dispose();let e=void 0!==s.morphAttributes.position,r=void 0!==s.morphAttributes.normal,a=void 0!==s.morphAttributes.color,o=s.morphAttributes.position||[],l=s.morphAttributes.normal||[],u=s.morphAttributes.color||[],d=0;!0===e&&(d=1),!0===r&&(d=2),!0===a&&(d=3);let f=s.attributes.position.count*d,p=1;f>t.maxTextureSize&&(p=Math.ceil(f/t.maxTextureSize),f=t.maxTextureSize);let m=new Float32Array(f*p*4*c),g=new nR(m,f,p,c);g.type=re,g.needsUpdate=!0;let A=4*d;for(let t=0;t<c;t++){let i=o[t],s=l[t],c=u[t],h=f*p*4*t;for(let t=0;t<i.count;t++){let o=t*A;!0===e&&(n.fromBufferAttribute(i,t),m[h+o+0]=n.x,m[h+o+1]=n.y,m[h+o+2]=n.z,m[h+o+3]=0),!0===r&&(n.fromBufferAttribute(s,t),m[h+o+4]=n.x,m[h+o+5]=n.y,m[h+o+6]=n.z,m[h+o+7]=0),!0===a&&(n.fromBufferAttribute(c,t),m[h+o+8]=n.x,m[h+o+9]=n.y,m[h+o+10]=n.z,m[h+o+11]=4===c.itemSize?n.w:1)}}h={count:c,texture:g,size:new nt(f,p)},i.set(s,h),s.addEventListener("dispose",function e(){g.dispose(),i.delete(s),s.removeEventListener("dispose",e)})}if(!0===a.isInstancedMesh&&null!==a.morphTexture)o.getUniforms().setValue(e,"morphTexture",a.morphTexture,r);else{let t=0;for(let e=0;e<l.length;e++)t+=l[e];let r=s.morphTargetsRelative?1:1-t;o.getUniforms().setValue(e,"morphTargetBaseInfluence",r),o.getUniforms().setValue(e,"morphTargetInfluences",l)}o.getUniforms().setValue(e,"morphTargetsTexture",h.texture,r),o.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}}}function vP(e,t,r,i){let n=new WeakMap;function a(e){let t=e.target;t.removeEventListener("dispose",a),r.remove(t.instanceMatrix),null!==t.instanceColor&&r.remove(t.instanceColor)}return{update:function(s){let o=i.render.frame,l=s.geometry,u=t.get(s,l);if(n.get(u)!==o&&(t.update(u),n.set(u,o)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",a)&&s.addEventListener("dispose",a),n.get(s)!==o&&(r.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&r.update(s.instanceColor,e.ARRAY_BUFFER),n.set(s,o))),s.isSkinnedMesh){let e=s.skeleton;n.get(e)!==o&&(e.update(),n.set(e,o))}return u},dispose:function(){n=new WeakMap}}}let vL=new nC,vk=new lg(1,1),vF=new nR,vO=new nD,vU=new sL,vN=[],vz=[],vG=new Float32Array(16),vH=new Float32Array(9),vQ=new Float32Array(4);function vV(e,t,r){let i=e[0];if(i<=0||i>0)return e;let n=t*r,a=vN[n];if(void 0===a&&(a=new Float32Array(n),vN[n]=a),0!==t){i.toArray(a,0);for(let i=1,n=0;i!==t;++i)n+=r,e[i].toArray(a,n)}return a}function vW(e,t){if(e.length!==t.length)return!1;for(let r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function vj(e,t){for(let r=0,i=t.length;r<i;r++)e[r]=t[r]}function vY(e,t){let r=vz[t];void 0===r&&(r=new Int32Array(t),vz[t]=r);for(let i=0;i!==t;++i)r[i]=e.allocateTextureUnit();return r}function vK(e,t){let r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function vq(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(vW(r,t))return;e.uniform2fv(this.addr,t),vj(r,t)}}function vX(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)(r[0]!==t.r||r[1]!==t.g||r[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(vW(r,t))return;e.uniform3fv(this.addr,t),vj(r,t)}}function v$(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(vW(r,t))return;e.uniform4fv(this.addr,t),vj(r,t)}}function vJ(e,t){let r=this.cache,i=t.elements;if(void 0===i){if(vW(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),vj(r,t)}else{if(vW(r,i))return;vQ.set(i),e.uniformMatrix2fv(this.addr,!1,vQ),vj(r,i)}}function vZ(e,t){let r=this.cache,i=t.elements;if(void 0===i){if(vW(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),vj(r,t)}else{if(vW(r,i))return;vH.set(i),e.uniformMatrix3fv(this.addr,!1,vH),vj(r,i)}}function v0(e,t){let r=this.cache,i=t.elements;if(void 0===i){if(vW(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),vj(r,t)}else{if(vW(r,i))return;vG.set(i),e.uniformMatrix4fv(this.addr,!1,vG),vj(r,i)}}function v1(e,t){let r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function v2(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(vW(r,t))return;e.uniform2iv(this.addr,t),vj(r,t)}}function v3(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else{if(vW(r,t))return;e.uniform3iv(this.addr,t),vj(r,t)}}function v4(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(vW(r,t))return;e.uniform4iv(this.addr,t),vj(r,t)}}function v5(e,t){let r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function v6(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(vW(r,t))return;e.uniform2uiv(this.addr,t),vj(r,t)}}function v8(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else{if(vW(r,t))return;e.uniform3uiv(this.addr,t),vj(r,t)}}function v9(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(vW(r,t))return;e.uniform4uiv(this.addr,t),vj(r,t)}}function v7(e,t,r){let i;let n=this.cache,a=r.allocateTextureUnit();n[0]!==a&&(e.uniform1i(this.addr,a),n[0]=a),this.type===e.SAMPLER_2D_SHADOW?(vk.compareFunction=iD,i=vk):i=vL,r.setTexture2D(t||i,a)}function ye(e,t,r){let i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture3D(t||vO,n)}function yt(e,t,r){let i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTextureCube(t||vU,n)}function yr(e,t,r){let i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2DArray(t||vF,n)}function yi(e,t){e.uniform1fv(this.addr,t)}function yn(e,t){let r=vV(t,this.size,2);e.uniform2fv(this.addr,r)}function ya(e,t){let r=vV(t,this.size,3);e.uniform3fv(this.addr,r)}function ys(e,t){let r=vV(t,this.size,4);e.uniform4fv(this.addr,r)}function yo(e,t){let r=vV(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function yl(e,t){let r=vV(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function yu(e,t){let r=vV(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function yc(e,t){e.uniform1iv(this.addr,t)}function yh(e,t){e.uniform2iv(this.addr,t)}function yd(e,t){e.uniform3iv(this.addr,t)}function yf(e,t){e.uniform4iv(this.addr,t)}function yp(e,t){e.uniform1uiv(this.addr,t)}function ym(e,t){e.uniform2uiv(this.addr,t)}function yg(e,t){e.uniform3uiv(this.addr,t)}function yA(e,t){e.uniform4uiv(this.addr,t)}function yv(e,t,r){let i=this.cache,n=t.length,a=vY(r,n);vW(i,a)||(e.uniform1iv(this.addr,a),vj(i,a));for(let e=0;e!==n;++e)r.setTexture2D(t[e]||vL,a[e])}function yy(e,t,r){let i=this.cache,n=t.length,a=vY(r,n);vW(i,a)||(e.uniform1iv(this.addr,a),vj(i,a));for(let e=0;e!==n;++e)r.setTexture3D(t[e]||vO,a[e])}function yE(e,t,r){let i=this.cache,n=t.length,a=vY(r,n);vW(i,a)||(e.uniform1iv(this.addr,a),vj(i,a));for(let e=0;e!==n;++e)r.setTextureCube(t[e]||vU,a[e])}function yx(e,t,r){let i=this.cache,n=t.length,a=vY(r,n);vW(i,a)||(e.uniform1iv(this.addr,a),vj(i,a));for(let e=0;e!==n;++e)r.setTexture2DArray(t[e]||vF,a[e])}class y_{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return vK;case 35664:return vq;case 35665:return vX;case 35666:return v$;case 35674:return vJ;case 35675:return vZ;case 35676:return v0;case 5124:case 35670:return v1;case 35667:case 35671:return v2;case 35668:case 35672:return v3;case 35669:case 35673:return v4;case 5125:return v5;case 36294:return v6;case 36295:return v8;case 36296:return v9;case 35678:case 36198:case 36298:case 36306:case 35682:return v7;case 35679:case 36299:case 36307:return ye;case 35680:case 36300:case 36308:case 36293:return yt;case 36289:case 36303:case 36311:case 36292:return yr}}(t.type)}}class yb{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return yi;case 35664:return yn;case 35665:return ya;case 35666:return ys;case 35674:return yo;case 35675:return yl;case 35676:return yu;case 5124:case 35670:return yc;case 35667:case 35671:return yh;case 35668:case 35672:return yd;case 35669:case 35673:return yf;case 5125:return yp;case 36294:return ym;case 36295:return yg;case 36296:return yA;case 35678:case 36198:case 36298:case 36306:case 35682:return yv;case 35679:case 36299:case 36307:return yy;case 35680:case 36300:case 36308:case 36293:return yE;case 36289:case 36303:case 36311:case 36292:return yx}}(t.type)}}class yS{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){let i=this.seq;for(let n=0,a=i.length;n!==a;++n){let a=i[n];a.setValue(e,t[a.id],r)}}}let yw=/(\w+)(\])?(\[|\.)?/g;function yC(e,t){e.seq.push(t),e.map[t.id]=t}class yT{constructor(e,t){this.seq=[],this.map={};let r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){let r=e.getActiveUniform(t,i),n=e.getUniformLocation(t,r.name);!function(e,t,r){let i=e.name,n=i.length;for(yw.lastIndex=0;;){let a=yw.exec(i),s=yw.lastIndex,o=a[1],l="]"===a[2],u=a[3];if(l&&(o|=0),void 0===u||"["===u&&s+2===n){yC(r,void 0===u?new y_(o,e,t):new yb(o,e,t));break}{let e=r.map[o];void 0===e&&yC(r,e=new yS(o)),r=e}}}(r,n,this)}}setValue(e,t,r,i){let n=this.map[t];void 0!==n&&n.setValue(e,r,i)}setOptional(e,t,r){let i=t[r];void 0!==i&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let n=0,a=t.length;n!==a;++n){let a=t[n],s=r[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,i)}}static seqWithValue(e,t){let r=[];for(let i=0,n=e.length;i!==n;++i){let n=e[i];n.id in t&&r.push(n)}return r}}function yI(e,t,r){let i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),i}let yM=0,yR=new ns;function yB(e,t,r){let i=e.getShaderParameter(t,e.COMPILE_STATUS),n=(e.getShaderInfoLog(t)||"").trim();if(i&&""===n)return"";let a=/ERROR: 0:(\d+)/.exec(n);if(!a)return n;{let i=parseInt(a[1]);return r.toUpperCase()+"\n\n"+n+"\n\n"+function(e,t){let r=e.split("\n"),i=[],n=Math.max(t-6,0),a=Math.min(t+6,r.length);for(let e=n;e<a;e++){let n=e+1;i.push(`${n===t?">":" "} ${n}: ${r[e]}`)}return i.join("\n")}(e.getShaderSource(t),i)}}let yD=new ni;function yP(e){return""!==e}function yL(e,t){let r=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,r).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function yk(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}let yF=/^[ \t]*#include +<([\w\d./]+)>/gm;function yO(e){return e.replace(yF,yN)}let yU=new Map;function yN(e,t){let r=A9[t];if(void 0===r){let e=yU.get(t);if(void 0!==e)r=A9[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e);else throw Error("Can not resolve #include <"+t+">")}return yO(r)}let yz=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function yG(e){return e.replace(yz,yH)}function yH(e,t,r,i){let n="";for(let e=parseInt(t);e<parseInt(r);e++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return n}function yQ(e){let t=`precision ${e.precision} float;
	precision ${e.precision} int;
	precision ${e.precision} sampler2D;
	precision ${e.precision} samplerCube;
	precision ${e.precision} sampler3D;
	precision ${e.precision} sampler2DArray;
	precision ${e.precision} sampler2DShadow;
	precision ${e.precision} samplerCubeShadow;
	precision ${e.precision} sampler2DArrayShadow;
	precision ${e.precision} isampler2D;
	precision ${e.precision} isampler3D;
	precision ${e.precision} isamplerCube;
	precision ${e.precision} isampler2DArray;
	precision ${e.precision} usampler2D;
	precision ${e.precision} usampler3D;
	precision ${e.precision} usamplerCube;
	precision ${e.precision} usampler2DArray;
	`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function yV(e,t,r,i){let n,a,s,o,l,u;let c=e.getContext(),h=r.defines,d=r.vertexShader,f=r.fragmentShader,p=(l="SHADOWMAP_TYPE_BASIC",r.shadowMapType===eX?l="SHADOWMAP_TYPE_PCF":r.shadowMapType===e$?l="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===eJ&&(l="SHADOWMAP_TYPE_VSM"),l),m=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case tz:case tG:t="ENVMAP_TYPE_CUBE";break;case tV:t="ENVMAP_TYPE_CUBE_UV"}return t}(r),g=(u="ENVMAP_MODE_REFLECTION",r.envMap&&r.envMapMode===tG&&(u="ENVMAP_MODE_REFRACTION"),u),A=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case tC:t="ENVMAP_BLENDING_MULTIPLY";break;case tT:t="ENVMAP_BLENDING_MIX";break;case tI:t="ENVMAP_BLENDING_ADD"}return t}(r),v=function(e){let t=e.envMapCubeUVHeight;if(null===t)return null;let r=Math.log2(t)-2;return{texelWidth:1/(3*Math.max(Math.pow(2,r),112)),texelHeight:1/t,maxMip:r}}(r),y=[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",r.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(yP).join("\n"),E=function(e){let t=[];for(let r in e){let i=e[r];!1!==i&&t.push("#define "+r+" "+i)}return t.join("\n")}(h),x=c.createProgram(),_=r.glslVersion?"#version "+r.glslVersion+"\n":"";r.isRawShaderMaterial?((n=["#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,E].filter(yP).join("\n")).length>0&&(n+="\n"),(a=["#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,E].filter(yP).join("\n")).length>0&&(a+="\n")):(n=[yQ(r),"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,E,r.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",r.batching?"#define USE_BATCHING":"",r.batchingColor?"#define USE_BATCHING_COLOR":"",r.instancing?"#define USE_INSTANCING":"",r.instancingColor?"#define USE_INSTANCING_COLOR":"",r.instancingMorph?"#define USE_INSTANCING_MORPH":"",r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+g:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",r.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",r.displacementMap?"#define USE_DISPLACEMENTMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.anisotropy?"#define USE_ANISOTROPY":"",r.anisotropyMap?"#define USE_ANISOTROPYMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",r.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaHash?"#define USE_ALPHAHASH":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",r.mapUv?"#define MAP_UV "+r.mapUv:"",r.alphaMapUv?"#define ALPHAMAP_UV "+r.alphaMapUv:"",r.lightMapUv?"#define LIGHTMAP_UV "+r.lightMapUv:"",r.aoMapUv?"#define AOMAP_UV "+r.aoMapUv:"",r.emissiveMapUv?"#define EMISSIVEMAP_UV "+r.emissiveMapUv:"",r.bumpMapUv?"#define BUMPMAP_UV "+r.bumpMapUv:"",r.normalMapUv?"#define NORMALMAP_UV "+r.normalMapUv:"",r.displacementMapUv?"#define DISPLACEMENTMAP_UV "+r.displacementMapUv:"",r.metalnessMapUv?"#define METALNESSMAP_UV "+r.metalnessMapUv:"",r.roughnessMapUv?"#define ROUGHNESSMAP_UV "+r.roughnessMapUv:"",r.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+r.anisotropyMapUv:"",r.clearcoatMapUv?"#define CLEARCOATMAP_UV "+r.clearcoatMapUv:"",r.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+r.clearcoatNormalMapUv:"",r.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+r.clearcoatRoughnessMapUv:"",r.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+r.iridescenceMapUv:"",r.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+r.iridescenceThicknessMapUv:"",r.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+r.sheenColorMapUv:"",r.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+r.sheenRoughnessMapUv:"",r.specularMapUv?"#define SPECULARMAP_UV "+r.specularMapUv:"",r.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+r.specularColorMapUv:"",r.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+r.specularIntensityMapUv:"",r.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+r.transmissionMapUv:"",r.thicknessMapUv?"#define THICKNESSMAP_UV "+r.thicknessMapUv:"",r.vertexTangents&&!1===r.flatShading?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUv1s?"#define USE_UV1":"",r.vertexUv2s?"#define USE_UV2":"",r.vertexUv3s?"#define USE_UV3":"",r.pointsUvs?"#define USE_POINTS_UV":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.morphColors?"#define USE_MORPHCOLORS":"",r.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+r.morphTextureStride:"",r.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+r.morphTargetsCount:"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+p:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.numLightProbes>0?"#define USE_LIGHT_PROBES":"",r.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",r.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(yP).join("\n"),a=[yQ(r),"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,E,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+m:"",r.envMap?"#define "+g:"",r.envMap?"#define "+A:"",v?"#define CUBEUV_TEXEL_WIDTH "+v.texelWidth:"",v?"#define CUBEUV_TEXEL_HEIGHT "+v.texelHeight:"",v?"#define CUBEUV_MAX_MIP "+v.maxMip+".0":"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",r.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.anisotropy?"#define USE_ANISOTROPY":"",r.anisotropyMap?"#define USE_ANISOTROPYMAP":"",r.clearcoat?"#define USE_CLEARCOAT":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.dispersion?"#define USE_DISPERSION":"",r.iridescence?"#define USE_IRIDESCENCE":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",r.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaTest?"#define USE_ALPHATEST":"",r.alphaHash?"#define USE_ALPHAHASH":"",r.sheen?"#define USE_SHEEN":"",r.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.vertexTangents&&!1===r.flatShading?"#define USE_TANGENT":"",r.vertexColors||r.instancingColor||r.batchingColor?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUv1s?"#define USE_UV1":"",r.vertexUv2s?"#define USE_UV2":"",r.vertexUv3s?"#define USE_UV3":"",r.pointsUvs?"#define USE_POINTS_UV":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+p:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.numLightProbes>0?"#define USE_LIGHT_PROBES":"",r.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",r.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",r.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",r.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==tM?"#define TONE_MAPPING":"",r.toneMapping!==tM?A9.tonemapping_pars_fragment:"",r.toneMapping!==tM?function(e,t){let r;switch(t){case tR:r="Linear";break;case tB:r="Reinhard";break;case tD:r="Cineon";break;case tP:r="ACESFilmic";break;case tk:r="AgX";break;case tF:r="Neutral";break;case tL:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),r="Linear"}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.opaque?"#define OPAQUE":"",A9.colorspace_pars_fragment,function(e,t){let r=function(e){nA._getMatrix(yR,nA.workingColorSpace,e);let t=`mat3( ${yR.elements.map(e=>e.toFixed(4))} )`;switch(nA.getTransfer(e)){case ic:return[t,"LinearTransferOETF"];case ih:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) {
	return ${r[1]}( vec4( value.rgb * ${r[0]}, value.a ) );
}`}("linearToOutputTexel",r.outputColorSpace),function(){nA.getLuminanceCoefficients(yD);let e=yD.x.toFixed(4),t=yD.y.toFixed(4),r=yD.z.toFixed(4);return`float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( ${e}, ${t}, ${r} );
	return dot( weights, rgb );
}`}(),r.useDepthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(yP).join("\n")),d=yk(d=yL(d=yO(d),r),r),f=yk(f=yL(f=yO(f),r),r),d=yG(d),f=yG(f),!0!==r.isRawShaderMaterial&&(_="#version 300 es\n",n=[y,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+n,a=["#define varying in",r.glslVersion===iY?"":"layout(location = 0) out highp vec4 pc_fragColor;",r.glslVersion===iY?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);let b=_+n+d,S=_+a+f,w=yI(c,c.VERTEX_SHADER,b),C=yI(c,c.FRAGMENT_SHADER,S);function T(t){if(e.debug.checkShaderErrors){let r=c.getProgramInfoLog(x)||"",i=c.getShaderInfoLog(w)||"",s=c.getShaderInfoLog(C)||"",o=r.trim(),l=i.trim(),u=s.trim(),h=!0,d=!0;if(!1===c.getProgramParameter(x,c.LINK_STATUS)){if(h=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(c,x,w,C);else{let e=yB(c,w,"vertex"),r=yB(c,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+c.getError()+" - VALIDATE_STATUS "+c.getProgramParameter(x,c.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+o+"\n"+e+"\n"+r)}}else""!==o?console.warn("THREE.WebGLProgram: Program Info Log:",o):(""===l||""===u)&&(d=!1);d&&(t.diagnostics={runnable:h,programLog:o,vertexShader:{log:l,prefix:n},fragmentShader:{log:u,prefix:a}})}c.deleteShader(w),c.deleteShader(C),s=new yT(c,x),o=function(e,t){let r={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){let i=e.getActiveAttrib(t,n),a=i.name,s=1;i.type===e.FLOAT_MAT2&&(s=2),i.type===e.FLOAT_MAT3&&(s=3),i.type===e.FLOAT_MAT4&&(s=4),r[a]={type:i.type,location:e.getAttribLocation(t,a),locationSize:s}}return r}(c,x)}c.attachShader(x,w),c.attachShader(x,C),void 0!==r.index0AttributeName?c.bindAttribLocation(x,0,r.index0AttributeName):!0===r.morphTargets&&c.bindAttribLocation(x,0,"position"),c.linkProgram(x),this.getUniforms=function(){return void 0===s&&T(this),s},this.getAttributes=function(){return void 0===o&&T(this),o};let I=!1===r.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===I&&(I=c.getProgramParameter(x,37297)),I},this.destroy=function(){i.releaseStatesOfProgram(this),c.deleteProgram(x),this.program=void 0},this.type=r.shaderType,this.name=r.shaderName,this.id=yM++,this.cacheKey=t,this.usedTimes=1,this.program=x,this.vertexShader=w,this.fragmentShader=C,this}let yW=0;class yj{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),n=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return!1===a.has(i)&&(a.add(i),i.usedTimes++),!1===a.has(n)&&(a.add(n),n.usedTimes++),this}remove(e){for(let t of this.materialCache.get(e))t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,r=t.get(e);return void 0===r&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){let t=this.shaderCache,r=t.get(e);return void 0===r&&(r=new yY(e),t.set(e,r)),r}}class yY{constructor(e){this.id=yW++,this.code=e,this.usedTimes=0}}function yK(e,t,r,i,n,a,s){let o=new al,l=new yj,u=new Set,c=[],h=n.logarithmicDepthBuffer,d=n.vertexTextures,f=n.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return(u.add(e),0===e)?"uv":`uv${e}`}return{getParameters:function(a,o,c,g,A){let v,y,E,x;let _=g.fog,b=A.geometry,S=a.isMeshStandardMaterial?g.environment:null,w=(a.isMeshStandardMaterial?r:t).get(a.envMap||S),C=w&&w.mapping===tV?w.image.height:null,T=p[a.type];null!==a.precision&&(f=n.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",f,"instead.");let I=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,M=void 0!==I?I.length:0,R=0;if(void 0!==b.morphAttributes.position&&(R=1),void 0!==b.morphAttributes.normal&&(R=2),void 0!==b.morphAttributes.color&&(R=3),T){let e=ve[T];v=e.vertexShader,y=e.fragmentShader}else v=a.vertexShader,y=a.fragmentShader,l.update(a),E=l.getVertexShaderID(a),x=l.getFragmentShaderID(a);let B=e.getRenderTarget(),D=e.state.buffers.depth.getReversed(),P=!0===A.isInstancedMesh,L=!0===A.isBatchedMesh,k=!!a.map,F=!!a.matcap,O=!!w,U=!!a.aoMap,N=!!a.lightMap,z=!!a.bumpMap,G=!!a.normalMap,H=!!a.displacementMap,Q=!!a.emissiveMap,V=!!a.metalnessMap,W=!!a.roughnessMap,j=a.anisotropy>0,Y=a.clearcoat>0,K=a.dispersion>0,q=a.iridescence>0,X=a.sheen>0,$=a.transmission>0,J=j&&!!a.anisotropyMap,Z=Y&&!!a.clearcoatMap,ee=Y&&!!a.clearcoatNormalMap,et=Y&&!!a.clearcoatRoughnessMap,er=q&&!!a.iridescenceMap,ei=q&&!!a.iridescenceThicknessMap,en=X&&!!a.sheenColorMap,ea=X&&!!a.sheenRoughnessMap,es=!!a.specularMap,eo=!!a.specularColorMap,el=!!a.specularIntensityMap,eu=$&&!!a.transmissionMap,ec=$&&!!a.thicknessMap,eh=!!a.gradientMap,ed=!!a.alphaMap,ef=a.alphaTest>0,ep=!!a.alphaHash,em=!!a.extensions,eg=tM;a.toneMapped&&(null===B||!0===B.isXRRenderTarget)&&(eg=e.toneMapping);let eA={shaderID:T,shaderType:a.type,shaderName:a.name,vertexShader:v,fragmentShader:y,defines:a.defines,customVertexShaderID:E,customFragmentShaderID:x,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:f,batching:L,batchingColor:L&&null!==A._colorsTexture,instancing:P,instancingColor:P&&null!==A.instanceColor,instancingMorph:P&&null!==A.morphTexture,supportsVertexTextures:d,outputColorSpace:null===B?e.outputColorSpace:!0===B.isXRRenderTarget?B.texture.colorSpace:iu,alphaToCoverage:!!a.alphaToCoverage,map:k,matcap:F,envMap:O,envMapMode:O&&w.mapping,envMapCubeUVHeight:C,aoMap:U,lightMap:N,bumpMap:z,normalMap:G,displacementMap:d&&H,emissiveMap:Q,normalMapObjectSpace:G&&a.normalMapType===is,normalMapTangentSpace:G&&a.normalMapType===ia,metalnessMap:V,roughnessMap:W,anisotropy:j,anisotropyMap:J,clearcoat:Y,clearcoatMap:Z,clearcoatNormalMap:ee,clearcoatRoughnessMap:et,dispersion:K,iridescence:q,iridescenceMap:er,iridescenceThicknessMap:ei,sheen:X,sheenColorMap:en,sheenRoughnessMap:ea,specularMap:es,specularColorMap:eo,specularIntensityMap:el,transmission:$,transmissionMap:eu,thicknessMap:ec,gradientMap:eh,opaque:!1===a.transparent&&a.blending===e3&&!1===a.alphaToCoverage,alphaMap:ed,alphaTest:ef,alphaHash:ep,combine:a.combine,mapUv:k&&m(a.map.channel),aoMapUv:U&&m(a.aoMap.channel),lightMapUv:N&&m(a.lightMap.channel),bumpMapUv:z&&m(a.bumpMap.channel),normalMapUv:G&&m(a.normalMap.channel),displacementMapUv:H&&m(a.displacementMap.channel),emissiveMapUv:Q&&m(a.emissiveMap.channel),metalnessMapUv:V&&m(a.metalnessMap.channel),roughnessMapUv:W&&m(a.roughnessMap.channel),anisotropyMapUv:J&&m(a.anisotropyMap.channel),clearcoatMapUv:Z&&m(a.clearcoatMap.channel),clearcoatNormalMapUv:ee&&m(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:et&&m(a.clearcoatRoughnessMap.channel),iridescenceMapUv:er&&m(a.iridescenceMap.channel),iridescenceThicknessMapUv:ei&&m(a.iridescenceThicknessMap.channel),sheenColorMapUv:en&&m(a.sheenColorMap.channel),sheenRoughnessMapUv:ea&&m(a.sheenRoughnessMap.channel),specularMapUv:es&&m(a.specularMap.channel),specularColorMapUv:eo&&m(a.specularColorMap.channel),specularIntensityMapUv:el&&m(a.specularIntensityMap.channel),transmissionMapUv:eu&&m(a.transmissionMap.channel),thicknessMapUv:ec&&m(a.thicknessMap.channel),alphaMapUv:ed&&m(a.alphaMap.channel),vertexTangents:!!b.attributes.tangent&&(G||j),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,pointsUvs:!0===A.isPoints&&!!b.attributes.uv&&(k||ed),fog:!!_,useFog:!0===a.fog,fogExp2:!!_&&_.isFogExp2,flatShading:!0===a.flatShading&&!1===a.wireframe,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:h,reversedDepthBuffer:D,skinning:!0===A.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:M,morphTextureStride:R,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:eg,decodeVideoTexture:k&&!0===a.map.isVideoTexture&&nA.getTransfer(a.map.colorSpace)===ih,decodeVideoTextureEmissive:Q&&!0===a.emissiveMap.isVideoTexture&&nA.getTransfer(a.emissiveMap.colorSpace)===ih,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===e1,flipSided:a.side===e0,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionClipCullDistance:em&&!0===a.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(em&&!0===a.extensions.multiDraw||L)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return eA.vertexUv1s=u.has(1),eA.vertexUv2s=u.has(2),eA.vertexUv3s=u.has(3),u.clear(),eA},getProgramCacheKey:function(t){let r=[];if(t.shaderID?r.push(t.shaderID):(r.push(t.customVertexShaderID),r.push(t.customFragmentShaderID)),void 0!==t.defines)for(let e in t.defines)r.push(e),r.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(r.push(t.precision),r.push(t.outputColorSpace),r.push(t.envMapMode),r.push(t.envMapCubeUVHeight),r.push(t.mapUv),r.push(t.alphaMapUv),r.push(t.lightMapUv),r.push(t.aoMapUv),r.push(t.bumpMapUv),r.push(t.normalMapUv),r.push(t.displacementMapUv),r.push(t.emissiveMapUv),r.push(t.metalnessMapUv),r.push(t.roughnessMapUv),r.push(t.anisotropyMapUv),r.push(t.clearcoatMapUv),r.push(t.clearcoatNormalMapUv),r.push(t.clearcoatRoughnessMapUv),r.push(t.iridescenceMapUv),r.push(t.iridescenceThicknessMapUv),r.push(t.sheenColorMapUv),r.push(t.sheenRoughnessMapUv),r.push(t.specularMapUv),r.push(t.specularColorMapUv),r.push(t.specularIntensityMapUv),r.push(t.transmissionMapUv),r.push(t.thicknessMapUv),r.push(t.combine),r.push(t.fogExp2),r.push(t.sizeAttenuation),r.push(t.morphTargetsCount),r.push(t.morphAttributeCount),r.push(t.numDirLights),r.push(t.numPointLights),r.push(t.numSpotLights),r.push(t.numSpotLightMaps),r.push(t.numHemiLights),r.push(t.numRectAreaLights),r.push(t.numDirLightShadows),r.push(t.numPointLightShadows),r.push(t.numSpotLightShadows),r.push(t.numSpotLightShadowsWithMaps),r.push(t.numLightProbes),r.push(t.shadowMapType),r.push(t.toneMapping),r.push(t.numClippingPlanes),r.push(t.numClipIntersection),r.push(t.depthPacking),o.disableAll(),t.supportsVertexTextures&&o.enable(0),t.instancing&&o.enable(1),t.instancingColor&&o.enable(2),t.instancingMorph&&o.enable(3),t.matcap&&o.enable(4),t.envMap&&o.enable(5),t.normalMapObjectSpace&&o.enable(6),t.normalMapTangentSpace&&o.enable(7),t.clearcoat&&o.enable(8),t.iridescence&&o.enable(9),t.alphaTest&&o.enable(10),t.vertexColors&&o.enable(11),t.vertexAlphas&&o.enable(12),t.vertexUv1s&&o.enable(13),t.vertexUv2s&&o.enable(14),t.vertexUv3s&&o.enable(15),t.vertexTangents&&o.enable(16),t.anisotropy&&o.enable(17),t.alphaHash&&o.enable(18),t.batching&&o.enable(19),t.dispersion&&o.enable(20),t.batchingColor&&o.enable(21),t.gradientMap&&o.enable(22),r.push(o.mask),o.disableAll(),t.fog&&o.enable(0),t.useFog&&o.enable(1),t.flatShading&&o.enable(2),t.logarithmicDepthBuffer&&o.enable(3),t.reversedDepthBuffer&&o.enable(4),t.skinning&&o.enable(5),t.morphTargets&&o.enable(6),t.morphNormals&&o.enable(7),t.morphColors&&o.enable(8),t.premultipliedAlpha&&o.enable(9),t.shadowMapEnabled&&o.enable(10),t.doubleSided&&o.enable(11),t.flipSided&&o.enable(12),t.useDepthPacking&&o.enable(13),t.dithering&&o.enable(14),t.transmission&&o.enable(15),t.sheen&&o.enable(16),t.opaque&&o.enable(17),t.pointsUvs&&o.enable(18),t.decodeVideoTexture&&o.enable(19),t.decodeVideoTextureEmissive&&o.enable(20),t.alphaToCoverage&&o.enable(21),r.push(o.mask),r.push(e.outputColorSpace)),r.push(t.customProgramCacheKey),r.join()},getUniforms:function(e){let t;let r=p[e.type];if(r){let e=ve[r];t=sC.clone(e.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,r){let i;for(let e=0,t=c.length;e<t;e++){let t=c[e];if(t.cacheKey===r){i=t,++i.usedTimes;break}}return void 0===i&&(i=new yV(e,r,t,a),c.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){let t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function yq(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,i){e.get(t)[r]=i},dispose:function(){e=new WeakMap}}}function yX(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function y$(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function yJ(){let e=[],t=0,r=[],i=[],n=[];function a(r,i,n,a,s,o){let l=e[t];return void 0===l?(l={id:r.id,object:r,geometry:i,material:n,groupOrder:a,renderOrder:r.renderOrder,z:s,group:o},e[t]=l):(l.id=r.id,l.object=r,l.geometry=i,l.material=n,l.groupOrder=a,l.renderOrder=r.renderOrder,l.z=s,l.group=o),t++,l}return{opaque:r,transmissive:i,transparent:n,init:function(){t=0,r.length=0,i.length=0,n.length=0},push:function(e,t,s,o,l,u){let c=a(e,t,s,o,l,u);s.transmission>0?i.push(c):!0===s.transparent?n.push(c):r.push(c)},unshift:function(e,t,s,o,l,u){let c=a(e,t,s,o,l,u);s.transmission>0?i.unshift(c):!0===s.transparent?n.unshift(c):r.unshift(c)},finish:function(){for(let r=t,i=e.length;r<i;r++){let t=e[r];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){r.length>1&&r.sort(e||yX),i.length>1&&i.sort(t||y$),n.length>1&&n.sort(t||y$)}}}function yZ(){let e=new WeakMap;return{get:function(t,r){let i;let n=e.get(t);return void 0===n?(i=new yJ,e.set(t,[i])):r>=n.length?(i=new yJ,n.push(i)):i=n[r],i},dispose:function(){e=new WeakMap}}}function y0(){let e={};return{get:function(t){let r;if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":r={direction:new ni,color:new aQ};break;case"SpotLight":r={position:new ni,direction:new ni,color:new aQ,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new ni,color:new aQ,distance:0,decay:0};break;case"HemisphereLight":r={direction:new ni,skyColor:new aQ,groundColor:new aQ};break;case"RectAreaLight":r={color:new aQ,position:new ni,halfWidth:new ni,halfHeight:new ni}}return e[t.id]=r,r}}}let y1=0;function y2(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function y3(e){let t=new y0,r=function(){let e={};return{get:function(t){let r;if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":case"SpotLight":r={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nt};break;case"PointLight":r={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nt,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=r,r}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)i.probe.push(new ni);let n=new ni,a=new n8,s=new n8;return{setup:function(n){let a=0,s=0,o=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let l=0,u=0,c=0,h=0,d=0,f=0,p=0,m=0,g=0,A=0,v=0;n.sort(y2);for(let e=0,y=n.length;e<y;e++){let y=n[e],E=y.color,x=y.intensity,_=y.distance,b=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)a+=E.r*x,s+=E.g*x,o+=E.b*x;else if(y.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(y.sh.coefficients[e],x);v++}else if(y.isDirectionalLight){let e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),y.castShadow){let e=y.shadow,t=r.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,i.directionalShadow[l]=t,i.directionalShadowMap[l]=b,i.directionalShadowMatrix[l]=y.shadow.matrix,f++}i.directional[l]=e,l++}else if(y.isSpotLight){let e=t.get(y);e.position.setFromMatrixPosition(y.matrixWorld),e.color.copy(E).multiplyScalar(x),e.distance=_,e.coneCos=Math.cos(y.angle),e.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),e.decay=y.decay,i.spot[c]=e;let n=y.shadow;if(y.map&&(i.spotLightMap[g]=y.map,g++,n.updateMatrices(y),y.castShadow&&A++),i.spotLightMatrix[c]=n.matrix,y.castShadow){let e=r.get(y);e.shadowIntensity=n.intensity,e.shadowBias=n.bias,e.shadowNormalBias=n.normalBias,e.shadowRadius=n.radius,e.shadowMapSize=n.mapSize,i.spotShadow[c]=e,i.spotShadowMap[c]=b,m++}c++}else if(y.isRectAreaLight){let e=t.get(y);e.color.copy(E).multiplyScalar(x),e.halfWidth.set(.5*y.width,0,0),e.halfHeight.set(0,.5*y.height,0),i.rectArea[h]=e,h++}else if(y.isPointLight){let e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),e.distance=y.distance,e.decay=y.decay,y.castShadow){let e=y.shadow,t=r.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,i.pointShadow[u]=t,i.pointShadowMap[u]=b,i.pointShadowMatrix[u]=y.shadow.matrix,p++}i.point[u]=e,u++}else if(y.isHemisphereLight){let e=t.get(y);e.skyColor.copy(y.color).multiplyScalar(x),e.groundColor.copy(y.groundColor).multiplyScalar(x),i.hemi[d]=e,d++}}h>0&&(!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=A7.LTC_FLOAT_1,i.rectAreaLTC2=A7.LTC_FLOAT_2):(i.rectAreaLTC1=A7.LTC_HALF_1,i.rectAreaLTC2=A7.LTC_HALF_2)),i.ambient[0]=a,i.ambient[1]=s,i.ambient[2]=o;let y=i.hash;(y.directionalLength!==l||y.pointLength!==u||y.spotLength!==c||y.rectAreaLength!==h||y.hemiLength!==d||y.numDirectionalShadows!==f||y.numPointShadows!==p||y.numSpotShadows!==m||y.numSpotMaps!==g||y.numLightProbes!==v)&&(i.directional.length=l,i.spot.length=c,i.rectArea.length=h,i.point.length=u,i.hemi.length=d,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=p,i.pointShadowMap.length=p,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=p,i.spotLightMatrix.length=m+g-A,i.spotLightMap.length=g,i.numSpotLightShadowsWithMaps=A,i.numLightProbes=v,y.directionalLength=l,y.pointLength=u,y.spotLength=c,y.rectAreaLength=h,y.hemiLength=d,y.numDirectionalShadows=f,y.numPointShadows=p,y.numSpotShadows=m,y.numSpotMaps=g,y.numLightProbes=v,i.version=y1++)},setupView:function(e,t){let r=0,o=0,l=0,u=0,c=0,h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){let d=e[t];if(d.isDirectionalLight){let e=i.directional[r];e.direction.setFromMatrixPosition(d.matrixWorld),n.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(n),e.direction.transformDirection(h),r++}else if(d.isSpotLight){let e=i.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),n.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(n),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){let e=i.rectArea[u];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),s.identity(),a.copy(d.matrixWorld),a.premultiply(h),s.extractRotation(a),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),u++}else if(d.isPointLight){let e=i.point[o];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),o++}else if(d.isHemisphereLight){let e=i.hemi[c];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),c++}}},state:i}}function y4(e){let t=new y3(e),r=[],i=[],n={lightsArray:r,shadowsArray:i,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){n.camera=e,r.length=0,i.length=0},state:n,setupLights:function(){t.setup(r)},setupLightsView:function(e){t.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function y5(e){let t=new WeakMap;return{get:function(r,i=0){let n;let a=t.get(r);return void 0===a?(n=new y4(e),t.set(r,[n])):i>=a.length?(n=new y4(e),a.push(n)):n=a[i],n},dispose:function(){t=new WeakMap}}}function y6(e,t,r){let i=new oR,n=new nt,a=new nt,s=new nT,o=new uD({depthPacking:it}),l=new uP,u={},c=r.maxTextureSize,h={[eZ]:e0,[e0]:eZ,[e1]:e1},d=new sT({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new nt},radius:{value:4}},vertexShader:"void main() {\n	gl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n	const float samples = float( VSM_SAMPLES );\n	float mean = 0.0;\n	float squared_mean = 0.0;\n	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n	for ( float i = 0.0; i < samples; i ++ ) {\n		float uvOffset = uvStart + i * uvStride;\n		#ifdef HORIZONTAL_PASS\n			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n			mean += distribution.x;\n			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n		#else\n			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n			mean += depth;\n			squared_mean += depth * depth;\n		#endif\n	}\n	mean = mean / samples;\n	squared_mean = squared_mean / samples;\n	float std_dev = sqrt( squared_mean - mean * mean );\n	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;let p=new sl;p.setAttribute("position",new a1(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new sE(p,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=eX;let A=this.type;function v(t,r,i,n){let a=null,s=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)a=s;else if(a=!0===i.isPointLight?l:o,e.localClippingEnabled&&!0===r.clipShadows&&Array.isArray(r.clippingPlanes)&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&r.alphaTest>0||r.map&&r.alphaTest>0||!0===r.alphaToCoverage){let e=a.uuid,t=r.uuid,i=u[e];void 0===i&&(i={},u[e]=i);let n=i[t];void 0===n&&(n=a.clone(),i[t]=n,r.addEventListener("dispose",y)),a=n}return a.visible=r.visible,a.wireframe=r.wireframe,n===eJ?a.side=null!==r.shadowSide?r.shadowSide:r.side:a.side=null!==r.shadowSide?r.shadowSide:h[r.side],a.alphaMap=r.alphaMap,a.alphaTest=!0===r.alphaToCoverage?.5:r.alphaTest,a.map=r.map,a.clipShadows=r.clipShadows,a.clippingPlanes=r.clippingPlanes,a.clipIntersection=r.clipIntersection,a.displacementMap=r.displacementMap,a.displacementScale=r.displacementScale,a.displacementBias=r.displacementBias,a.wireframeLinewidth=r.wireframeLinewidth,a.linewidth=r.linewidth,!0===i.isPointLight&&!0===a.isMeshDistanceMaterial&&(e.properties.get(a).light=i),a}function y(e){for(let t in e.target.removeEventListener("dispose",y),u){let r=u[t],i=e.target.uuid;i in r&&(r[i].dispose(),delete r[i])}}this.render=function(r,o,l){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===r.length)return;let u=e.getRenderTarget(),h=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),y=e.state;y.setBlending(e2),!0===y.buffers.depth.getReversed()?y.buffers.color.setClear(0,0,0,0):y.buffers.color.setClear(1,1,1,1),y.buffers.depth.setTest(!0),y.setScissorTest(!1);let E=A!==eJ&&this.type===eJ,x=A===eJ&&this.type!==eJ;for(let u=0,h=r.length;u<h;u++){let h=r[u],p=h.shadow;if(void 0===p){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===p.autoUpdate&&!1===p.needsUpdate)continue;n.copy(p.mapSize);let g=p.getFrameExtents();if(n.multiply(g),a.copy(p.mapSize),(n.x>c||n.y>c)&&(n.x>c&&(a.x=Math.floor(c/g.x),n.x=a.x*g.x,p.mapSize.x=a.x),n.y>c&&(a.y=Math.floor(c/g.y),n.y=a.y*g.y,p.mapSize.y=a.y)),null===p.map||!0===E||!0===x){let e=this.type!==eJ?{minFilter:tK,magFilter:tK}:{};null!==p.map&&p.map.dispose(),p.map=new nM(n.x,n.y,e),p.map.texture.name=h.name+".shadowMap",p.camera.updateProjectionMatrix()}e.setRenderTarget(p.map),e.clear();let A=p.getViewportCount();for(let r=0;r<A;r++){let n=p.getViewport(r);s.set(a.x*n.x,a.y*n.y,a.x*n.z,a.y*n.w),y.viewport(s),p.updateMatrices(h,r),i=p.getFrustum(),function r(n,a,s,o,l){if(!1===n.visible)return;if(n.layers.test(a.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&l===eJ)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);let r=t.update(n),i=n.material;if(Array.isArray(i)){let t=r.groups;for(let u=0,c=t.length;u<c;u++){let c=t[u],h=i[c.materialIndex];if(h&&h.visible){let t=v(n,h,o,l);n.onBeforeShadow(e,n,a,s,r,t,c),e.renderBufferDirect(s,null,r,t,n,c),n.onAfterShadow(e,n,a,s,r,t,c)}}}else if(i.visible){let t=v(n,i,o,l);n.onBeforeShadow(e,n,a,s,r,t,null),e.renderBufferDirect(s,null,r,t,n,null),n.onAfterShadow(e,n,a,s,r,t,null)}}let u=n.children;for(let e=0,t=u.length;e<t;e++)r(u[e],a,s,o,l)}(o,l,p.camera,h,this.type)}!0!==p.isPointLightShadow&&this.type===eJ&&function(r,i){let a=t.update(m);d.defines.VSM_SAMPLES!==r.blurSamples&&(d.defines.VSM_SAMPLES=r.blurSamples,f.defines.VSM_SAMPLES=r.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),null===r.mapPass&&(r.mapPass=new nM(n.x,n.y)),d.uniforms.shadow_pass.value=r.map.texture,d.uniforms.resolution.value=r.mapSize,d.uniforms.radius.value=r.radius,e.setRenderTarget(r.mapPass),e.clear(),e.renderBufferDirect(i,null,a,d,m,null),f.uniforms.shadow_pass.value=r.mapPass.texture,f.uniforms.resolution.value=r.mapSize,f.uniforms.radius.value=r.radius,e.setRenderTarget(r.map),e.clear(),e.renderBufferDirect(i,null,a,f,m,null)}(p,l),p.needsUpdate=!1}A=this.type,g.needsUpdate=!1,e.setRenderTarget(u,h,p)}}let y8={[tv]:ty,[tE]:tS,[t_]:tw,[tx]:tb,[ty]:tv,[tS]:tE,[tw]:t_,[tb]:tx};function y9(e,t){let r=new function(){let t=!1,r=new nT,i=null,n=new nT(0,0,0,0);return{setMask:function(r){i===r||t||(e.colorMask(r,r,r,r),i=r)},setLocked:function(e){t=e},setClear:function(t,i,a,s,o){!0===o&&(t*=s,i*=s,a*=s),r.set(t,i,a,s),!1===n.equals(r)&&(e.clearColor(t,i,a,s),n.copy(r))},reset:function(){t=!1,i=null,n.set(-1,0,0,0)}}},i=new function(){let r=!1,i=!1,n=null,a=null,s=null;return{setReversed:function(e){if(i!==e){let r=t.get("EXT_clip_control");e?r.clipControlEXT(r.LOWER_LEFT_EXT,r.ZERO_TO_ONE_EXT):r.clipControlEXT(r.LOWER_LEFT_EXT,r.NEGATIVE_ONE_TO_ONE_EXT),i=e;let n=s;s=null,this.setClear(n)}},getReversed:function(){return i},setTest:function(t){t?N(e.DEPTH_TEST):z(e.DEPTH_TEST)},setMask:function(t){n===t||r||(e.depthMask(t),n=t)},setFunc:function(t){if(i&&(t=y8[t]),a!==t){switch(t){case tv:e.depthFunc(e.NEVER);break;case ty:e.depthFunc(e.ALWAYS);break;case tE:e.depthFunc(e.LESS);break;case tx:e.depthFunc(e.LEQUAL);break;case t_:e.depthFunc(e.EQUAL);break;case tb:e.depthFunc(e.GEQUAL);break;case tS:e.depthFunc(e.GREATER);break;case tw:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}a=t}},setLocked:function(e){r=e},setClear:function(t){s!==t&&(i&&(t=1-t),e.clearDepth(t),s=t)},reset:function(){r=!1,n=null,a=null,s=null,i=!1}}},n=new function(){let t=!1,r=null,i=null,n=null,a=null,s=null,o=null,l=null,u=null;return{setTest:function(r){t||(r?N(e.STENCIL_TEST):z(e.STENCIL_TEST))},setMask:function(i){r===i||t||(e.stencilMask(i),r=i)},setFunc:function(t,r,s){(i!==t||n!==r||a!==s)&&(e.stencilFunc(t,r,s),i=t,n=r,a=s)},setOp:function(t,r,i){(s!==t||o!==r||l!==i)&&(e.stencilOp(t,r,i),s=t,o=r,l=i)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,r=null,i=null,n=null,a=null,s=null,o=null,l=null,u=null}}},a=new WeakMap,s=new WeakMap,o={},l={},u=new WeakMap,c=[],h=null,d=!1,f=null,p=null,m=null,g=null,A=null,v=null,y=null,E=new aQ(0,0,0),x=0,_=!1,b=null,S=null,w=null,C=null,T=null,I=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),M=!1,R=e.getParameter(e.VERSION);-1!==R.indexOf("WebGL")?M=parseFloat(/^WebGL (\d)/.exec(R)[1])>=1:-1!==R.indexOf("OpenGL ES")&&(M=parseFloat(/^OpenGL ES (\d)/.exec(R)[1])>=2);let B=null,D={},P=e.getParameter(e.SCISSOR_BOX),L=e.getParameter(e.VIEWPORT),k=new nT().fromArray(P),F=new nT().fromArray(L);function O(t,r,i,n){let a=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let s=0;s<i;s++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(r,0,e.RGBA,1,1,n,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage2D(r+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a);return s}let U={};function N(t){!0!==o[t]&&(e.enable(t),o[t]=!0)}function z(t){!1!==o[t]&&(e.disable(t),o[t]=!1)}U[e.TEXTURE_2D]=O(e.TEXTURE_2D,e.TEXTURE_2D,1),U[e.TEXTURE_CUBE_MAP]=O(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),U[e.TEXTURE_2D_ARRAY]=O(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),U[e.TEXTURE_3D]=O(e.TEXTURE_3D,e.TEXTURE_3D,1,1),r.setClear(0,0,0,1),i.setClear(1),n.setClear(0),N(e.DEPTH_TEST),i.setFunc(tx),V(!1),W(ej),N(e.CULL_FACE),Q(e2);let G={[e9]:e.FUNC_ADD,[e7]:e.FUNC_SUBTRACT,[te]:e.FUNC_REVERSE_SUBTRACT};G[tt]=e.MIN,G[tr]=e.MAX;let H={[ti]:e.ZERO,[tn]:e.ONE,[ta]:e.SRC_COLOR,[to]:e.SRC_ALPHA,[tf]:e.SRC_ALPHA_SATURATE,[th]:e.DST_COLOR,[tu]:e.DST_ALPHA,[ts]:e.ONE_MINUS_SRC_COLOR,[tl]:e.ONE_MINUS_SRC_ALPHA,[td]:e.ONE_MINUS_DST_COLOR,[tc]:e.ONE_MINUS_DST_ALPHA,[tp]:e.CONSTANT_COLOR,[tm]:e.ONE_MINUS_CONSTANT_COLOR,[tg]:e.CONSTANT_ALPHA,[tA]:e.ONE_MINUS_CONSTANT_ALPHA};function Q(t,r,i,n,a,s,o,l,u,c){if(t===e2){!0===d&&(z(e.BLEND),d=!1);return}if(!1===d&&(N(e.BLEND),d=!0),t!==e8){if(t!==f||c!==_){if((p!==e9||A!==e9)&&(e.blendEquation(e.FUNC_ADD),p=e9,A=e9),c)switch(t){case e3:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case e4:e.blendFunc(e.ONE,e.ONE);break;case e5:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case e6:e.blendFuncSeparate(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ZERO,e.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case e3:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case e4:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE,e.ONE,e.ONE);break;case e5:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case e6:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,g=null,v=null,y=null,E.set(0,0,0),x=0,f=t,_=c}return}a=a||r,s=s||i,o=o||n,(r!==p||a!==A)&&(e.blendEquationSeparate(G[r],G[a]),p=r,A=a),(i!==m||n!==g||s!==v||o!==y)&&(e.blendFuncSeparate(H[i],H[n],H[s],H[o]),m=i,g=n,v=s,y=o),(!1===l.equals(E)||u!==x)&&(e.blendColor(l.r,l.g,l.b,u),E.copy(l),x=u),f=t,_=!1}function V(t){b!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),b=t)}function W(t){t!==eW?(N(e.CULL_FACE),t!==S&&(t===ej?e.cullFace(e.BACK):t===eY?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):z(e.CULL_FACE),S=t}function j(t,r,i){t?(N(e.POLYGON_OFFSET_FILL),(C!==r||T!==i)&&(e.polygonOffset(r,i),C=r,T=i)):z(e.POLYGON_OFFSET_FILL)}return{buffers:{color:r,depth:i,stencil:n},enable:N,disable:z,bindFramebuffer:function(t,r){return l[t]!==r&&(e.bindFramebuffer(t,r),l[t]=r,t===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=r),t===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=r),!0)},drawBuffers:function(t,r){let i=c,n=!1;if(t){void 0===(i=u.get(r))&&(i=[],u.set(r,i));let a=t.textures;if(i.length!==a.length||i[0]!==e.COLOR_ATTACHMENT0){for(let t=0,r=a.length;t<r;t++)i[t]=e.COLOR_ATTACHMENT0+t;i.length=a.length,n=!0}}else i[0]!==e.BACK&&(i[0]=e.BACK,n=!0);n&&e.drawBuffers(i)},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:Q,setMaterial:function(t,a){t.side===e1?z(e.CULL_FACE):N(e.CULL_FACE);let s=t.side===e0;a&&(s=!s),V(s),t.blending===e3&&!1===t.transparent?Q(e2):Q(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),i.setFunc(t.depthFunc),i.setTest(t.depthTest),i.setMask(t.depthWrite),r.setMask(t.colorWrite);let o=t.stencilWrite;n.setTest(o),o&&(n.setMask(t.stencilWriteMask),n.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),n.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),j(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?N(e.SAMPLE_ALPHA_TO_COVERAGE):z(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:V,setCullFace:W,setLineWidth:function(t){t!==w&&(M&&e.lineWidth(t),w=t)},setPolygonOffset:j,setScissorTest:function(t){t?N(e.SCISSOR_TEST):z(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+I-1),B!==t&&(e.activeTexture(t),B=t)},bindTexture:function(t,r,i){void 0===i&&(i=null===B?e.TEXTURE0+I-1:B);let n=D[i];void 0===n&&(n={type:void 0,texture:void 0},D[i]=n),(n.type!==t||n.texture!==r)&&(B!==i&&(e.activeTexture(i),B=i),e.bindTexture(t,r||U[t]),n.type=t,n.texture=r)},unbindTexture:function(){let t=D[B];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,r){let i=s.get(r);void 0===i&&(i=new WeakMap,s.set(r,i));let n=i.get(t);void 0===n&&(n=e.getUniformBlockIndex(r,t.name),i.set(t,n))},uniformBlockBinding:function(t,r){let i=s.get(r).get(t);a.get(r)!==i&&(e.uniformBlockBinding(r,i,t.__bindingPointIndex),a.set(r,i))},texStorage2D:function(){try{e.texStorage2D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===k.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),k.copy(t))},viewport:function(t){!1===F.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),F.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),i.setReversed(!1),e.clearDepth(1),e.stencilMask(0xffffffff),e.stencilFunc(e.ALWAYS,0,0xffffffff),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),o={},B=null,D={},l={},u=new WeakMap,c=[],h=null,d=!1,f=null,p=null,m=null,g=null,A=null,v=null,y=null,E=new aQ(0,0,0),x=0,_=!1,b=null,S=null,w=null,C=null,T=null,k.set(0,0,e.canvas.width,e.canvas.height),F.set(0,0,e.canvas.width,e.canvas.height),r.reset(),i.reset(),n.reset()}}}function y7(e,t,r,i,n,a,s){let o;let l=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,u="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new nt,h=new WeakMap,d=new WeakMap,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function p(e,t){return f?new OffscreenCanvas(e,t):nh("canvas")}function m(e,t,r){let i=1,n=H(e);if((n.width>r||n.height>r)&&(i=r/Math.max(n.width,n.height)),i<1){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){let r=Math.floor(i*n.width),a=Math.floor(i*n.height);void 0===o&&(o=p(r,a));let s=t?p(r,a):o;return s.width=r,s.height=a,s.getContext("2d").drawImage(e,0,0,r,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+n.width+"x"+n.height+") to ("+r+"x"+a+")."),s}"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+n.width+"x"+n.height+").")}return e}function g(e){return e.generateMipmaps}function A(t){e.generateMipmap(t)}function v(r,i,n,a,s=!1){if(null!==r){if(void 0!==e[r])return e[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}let o=i;if(i===e.RED&&(n===e.FLOAT&&(o=e.R32F),n===e.HALF_FLOAT&&(o=e.R16F),n===e.UNSIGNED_BYTE&&(o=e.R8)),i===e.RED_INTEGER&&(n===e.UNSIGNED_BYTE&&(o=e.R8UI),n===e.UNSIGNED_SHORT&&(o=e.R16UI),n===e.UNSIGNED_INT&&(o=e.R32UI),n===e.BYTE&&(o=e.R8I),n===e.SHORT&&(o=e.R16I),n===e.INT&&(o=e.R32I)),i===e.RG&&(n===e.FLOAT&&(o=e.RG32F),n===e.HALF_FLOAT&&(o=e.RG16F),n===e.UNSIGNED_BYTE&&(o=e.RG8)),i===e.RG_INTEGER&&(n===e.UNSIGNED_BYTE&&(o=e.RG8UI),n===e.UNSIGNED_SHORT&&(o=e.RG16UI),n===e.UNSIGNED_INT&&(o=e.RG32UI),n===e.BYTE&&(o=e.RG8I),n===e.SHORT&&(o=e.RG16I),n===e.INT&&(o=e.RG32I)),i===e.RGB_INTEGER&&(n===e.UNSIGNED_BYTE&&(o=e.RGB8UI),n===e.UNSIGNED_SHORT&&(o=e.RGB16UI),n===e.UNSIGNED_INT&&(o=e.RGB32UI),n===e.BYTE&&(o=e.RGB8I),n===e.SHORT&&(o=e.RGB16I),n===e.INT&&(o=e.RGB32I)),i===e.RGBA_INTEGER&&(n===e.UNSIGNED_BYTE&&(o=e.RGBA8UI),n===e.UNSIGNED_SHORT&&(o=e.RGBA16UI),n===e.UNSIGNED_INT&&(o=e.RGBA32UI),n===e.BYTE&&(o=e.RGBA8I),n===e.SHORT&&(o=e.RGBA16I),n===e.INT&&(o=e.RGBA32I)),i===e.RGB&&(n===e.UNSIGNED_INT_5_9_9_9_REV&&(o=e.RGB9_E5),n===e.UNSIGNED_INT_10F_11F_11F_REV&&(o=e.R11F_G11F_B10F)),i===e.RGBA){let t=s?ic:nA.getTransfer(a);n===e.FLOAT&&(o=e.RGBA32F),n===e.HALF_FLOAT&&(o=e.RGBA16F),n===e.UNSIGNED_BYTE&&(o=t===ih?e.SRGB8_ALPHA8:e.RGBA8),n===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),n===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return(o===e.R16F||o===e.R32F||o===e.RG16F||o===e.RG32F||o===e.RGBA16F||o===e.RGBA32F)&&t.get("EXT_color_buffer_float"),o}function y(t,r){let i;return t?null===r||r===t7||r===rn?i=e.DEPTH24_STENCIL8:r===re?i=e.DEPTH32F_STENCIL8:r===t8&&(i=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===r||r===t7||r===rn?i=e.DEPTH_COMPONENT24:r===re?i=e.DEPTH_COMPONENT32F:r===t8&&(i=e.DEPTH_COMPONENT16),i}function E(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==tK&&e.minFilter!==tZ?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function x(e){let t=e.target;t.removeEventListener("dispose",x),function(e){let t=i.get(e);if(void 0===t.__webglInit)return;let r=e.source,n=d.get(r);if(n){let i=n[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&b(e),0===Object.keys(n).length&&d.delete(r)}i.remove(e)}(t),t.isVideoTexture&&h.delete(t)}function _(t){let r=t.target;r.removeEventListener("dispose",_),function(t){let r=i.get(t);if(t.depthTexture&&(t.depthTexture.dispose(),i.remove(t.depthTexture)),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(r.__webglFramebuffer[t]))for(let i=0;i<r.__webglFramebuffer[t].length;i++)e.deleteFramebuffer(r.__webglFramebuffer[t][i]);else e.deleteFramebuffer(r.__webglFramebuffer[t]);r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t])}else{if(Array.isArray(r.__webglFramebuffer))for(let t=0;t<r.__webglFramebuffer.length;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer);if(r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}let n=t.textures;for(let t=0,r=n.length;t<r;t++){let r=i.get(n[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),s.memory.textures--),i.remove(n[t])}i.remove(t)}(r)}function b(t){let r=i.get(t);e.deleteTexture(r.__webglTexture);let n=t.source,a=d.get(n);delete a[r.__cacheKey],s.memory.textures--}let S=0;function w(t,n){let a=i.get(t);if(t.isVideoTexture&&function(e){let t=s.render.frame;h.get(e)!==t&&(h.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&!0!==t.isExternalTexture&&t.version>0&&a.__version!==t.version){let e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(!1===e.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{D(a,t,n);return}}else t.isExternalTexture&&(a.__webglTexture=t.sourceTexture?t.sourceTexture:null);r.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+n)}let C={[tW]:e.REPEAT,[tj]:e.CLAMP_TO_EDGE,[tY]:e.MIRRORED_REPEAT},T={[tK]:e.NEAREST,[tq]:e.NEAREST_MIPMAP_NEAREST,[t$]:e.NEAREST_MIPMAP_LINEAR,[tZ]:e.LINEAR,[t0]:e.LINEAR_MIPMAP_NEAREST,[t2]:e.LINEAR_MIPMAP_LINEAR},I={[iM]:e.NEVER,[iF]:e.ALWAYS,[iR]:e.LESS,[iD]:e.LEQUAL,[iB]:e.EQUAL,[ik]:e.GEQUAL,[iP]:e.GREATER,[iL]:e.NOTEQUAL};function M(r,a){if(a.type===re&&!1===t.has("OES_texture_float_linear")&&(a.magFilter===tZ||a.magFilter===t0||a.magFilter===t$||a.magFilter===t2||a.minFilter===tZ||a.minFilter===t0||a.minFilter===t$||a.minFilter===t2)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(r,e.TEXTURE_WRAP_S,C[a.wrapS]),e.texParameteri(r,e.TEXTURE_WRAP_T,C[a.wrapT]),(r===e.TEXTURE_3D||r===e.TEXTURE_2D_ARRAY)&&e.texParameteri(r,e.TEXTURE_WRAP_R,C[a.wrapR]),e.texParameteri(r,e.TEXTURE_MAG_FILTER,T[a.magFilter]),e.texParameteri(r,e.TEXTURE_MIN_FILTER,T[a.minFilter]),a.compareFunction&&(e.texParameteri(r,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(r,e.TEXTURE_COMPARE_FUNC,I[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")&&a.magFilter!==tK&&(a.minFilter===t$||a.minFilter===t2)&&(a.type!==re||!1!==t.has("OES_texture_float_linear"))&&(a.anisotropy>1||i.get(a).__currentAnisotropy)){let s=t.get("EXT_texture_filter_anisotropic");e.texParameterf(r,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,n.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy}}function R(t,r){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",x));let n=r.source,a=d.get(n);void 0===a&&(a={},d.set(n,a));let o=function(e){let t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(r);if(o!==t.__cacheKey){void 0===a[o]&&(a[o]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,i=!0),a[o].usedTimes++;let n=a[t.__cacheKey];void 0!==n&&(a[t.__cacheKey].usedTimes--,0===n.usedTimes&&b(r)),t.__cacheKey=o,t.__webglTexture=a[o].texture}return i}function B(e,t,r){return Math.floor(Math.floor(e/r)/t)}function D(t,s,o){let l=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(l=e.TEXTURE_3D);let u=R(t,s),c=s.source;r.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);let h=i.get(c);if(c.version!==h.__version||!0===u){let t;r.activeTexture(e.TEXTURE0+o);let i=nA.getPrimaries(nA.workingColorSpace),d=s.colorSpace===io?null:nA.getPrimaries(s.colorSpace),f=s.colorSpace===io||i===d?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,f);let p=m(s.image,!1,n.maxTextureSize);p=G(s,p);let x=a.convert(s.format,s.colorSpace),_=a.convert(s.type),b=v(s.internalFormat,x,_,s.colorSpace,s.isVideoTexture);M(l,s);let S=s.mipmaps,w=!0!==s.isVideoTexture,C=void 0===h.__version||!0===u,T=c.dataReady,I=E(s,p);if(s.isDepthTexture)b=y(s.format===rh,s.type),C&&(w?r.texStorage2D(e.TEXTURE_2D,1,b,p.width,p.height):r.texImage2D(e.TEXTURE_2D,0,b,p.width,p.height,0,x,_,null));else if(s.isDataTexture){if(S.length>0){w&&C&&r.texStorage2D(e.TEXTURE_2D,I,b,S[0].width,S[0].height);for(let i=0,n=S.length;i<n;i++)t=S[i],w?T&&r.texSubImage2D(e.TEXTURE_2D,i,0,0,t.width,t.height,x,_,t.data):r.texImage2D(e.TEXTURE_2D,i,b,t.width,t.height,0,x,_,t.data);s.generateMipmaps=!1}else w?(C&&r.texStorage2D(e.TEXTURE_2D,I,b,p.width,p.height),T&&function(t,i,n,a){let s=t.updateRanges;if(0===s.length)r.texSubImage2D(e.TEXTURE_2D,0,0,0,i.width,i.height,n,a,i.data);else{s.sort((e,t)=>e.start-t.start);let o=0;for(let e=1;e<s.length;e++){let t=s[o],r=s[e],n=t.start+t.count,a=B(r.start,i.width,4),l=B(t.start,i.width,4);r.start<=n+1&&a===l&&B(r.start+r.count-1,i.width,4)===a?t.count=Math.max(t.count,r.start+r.count-t.start):s[++o]=r}s.length=o+1;let l=e.getParameter(e.UNPACK_ROW_LENGTH),u=e.getParameter(e.UNPACK_SKIP_PIXELS),c=e.getParameter(e.UNPACK_SKIP_ROWS);e.pixelStorei(e.UNPACK_ROW_LENGTH,i.width);for(let t=0,o=s.length;t<o;t++){let o=s[t],l=Math.floor(o.start/4),u=Math.ceil(o.count/4),c=l%i.width,h=Math.floor(l/i.width);e.pixelStorei(e.UNPACK_SKIP_PIXELS,c),e.pixelStorei(e.UNPACK_SKIP_ROWS,h),r.texSubImage2D(e.TEXTURE_2D,0,c,h,u,1,n,a,i.data)}t.clearUpdateRanges(),e.pixelStorei(e.UNPACK_ROW_LENGTH,l),e.pixelStorei(e.UNPACK_SKIP_PIXELS,u),e.pixelStorei(e.UNPACK_SKIP_ROWS,c)}}(s,p,x,_)):r.texImage2D(e.TEXTURE_2D,0,b,p.width,p.height,0,x,_,p.data)}else if(s.isCompressedTexture){if(s.isCompressedArrayTexture){w&&C&&r.texStorage3D(e.TEXTURE_2D_ARRAY,I,b,S[0].width,S[0].height,p.depth);for(let i=0,n=S.length;i<n;i++)if(t=S[i],s.format!==ru){if(null!==x){if(w){if(T){if(s.layerUpdates.size>0){let n=h8(t.width,t.height,s.format,s.type);for(let a of s.layerUpdates){let s=t.data.subarray(a*n/t.data.BYTES_PER_ELEMENT,(a+1)*n/t.data.BYTES_PER_ELEMENT);r.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,i,0,0,a,t.width,t.height,1,x,s)}s.clearLayerUpdates()}else r.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,i,0,0,0,t.width,t.height,p.depth,x,t.data)}}else r.compressedTexImage3D(e.TEXTURE_2D_ARRAY,i,b,t.width,t.height,p.depth,0,t.data,0,0)}else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}else w?T&&r.texSubImage3D(e.TEXTURE_2D_ARRAY,i,0,0,0,t.width,t.height,p.depth,x,_,t.data):r.texImage3D(e.TEXTURE_2D_ARRAY,i,b,t.width,t.height,p.depth,0,x,_,t.data)}else{w&&C&&r.texStorage2D(e.TEXTURE_2D,I,b,S[0].width,S[0].height);for(let i=0,n=S.length;i<n;i++)t=S[i],s.format!==ru?null!==x?w?T&&r.compressedTexSubImage2D(e.TEXTURE_2D,i,0,0,t.width,t.height,x,t.data):r.compressedTexImage2D(e.TEXTURE_2D,i,b,t.width,t.height,0,t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):w?T&&r.texSubImage2D(e.TEXTURE_2D,i,0,0,t.width,t.height,x,_,t.data):r.texImage2D(e.TEXTURE_2D,i,b,t.width,t.height,0,x,_,t.data)}}else if(s.isDataArrayTexture){if(w){if(C&&r.texStorage3D(e.TEXTURE_2D_ARRAY,I,b,p.width,p.height,p.depth),T){if(s.layerUpdates.size>0){let t=h8(p.width,p.height,s.format,s.type);for(let i of s.layerUpdates){let n=p.data.subarray(i*t/p.data.BYTES_PER_ELEMENT,(i+1)*t/p.data.BYTES_PER_ELEMENT);r.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,i,p.width,p.height,1,x,_,n)}s.clearLayerUpdates()}else r.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,x,_,p.data)}}else r.texImage3D(e.TEXTURE_2D_ARRAY,0,b,p.width,p.height,p.depth,0,x,_,p.data)}else if(s.isData3DTexture)w?(C&&r.texStorage3D(e.TEXTURE_3D,I,b,p.width,p.height,p.depth),T&&r.texSubImage3D(e.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,x,_,p.data)):r.texImage3D(e.TEXTURE_3D,0,b,p.width,p.height,p.depth,0,x,_,p.data);else if(s.isFramebufferTexture){if(C){if(w)r.texStorage2D(e.TEXTURE_2D,I,b,p.width,p.height);else{let t=p.width,i=p.height;for(let n=0;n<I;n++)r.texImage2D(e.TEXTURE_2D,n,b,t,i,0,x,_,null),t>>=1,i>>=1}}}else if(S.length>0){if(w&&C){let t=H(S[0]);r.texStorage2D(e.TEXTURE_2D,I,b,t.width,t.height)}for(let i=0,n=S.length;i<n;i++)t=S[i],w?T&&r.texSubImage2D(e.TEXTURE_2D,i,0,0,x,_,t):r.texImage2D(e.TEXTURE_2D,i,b,x,_,t);s.generateMipmaps=!1}else if(w){if(C){let t=H(p);r.texStorage2D(e.TEXTURE_2D,I,b,t.width,t.height)}T&&r.texSubImage2D(e.TEXTURE_2D,0,0,0,x,_,p)}else r.texImage2D(e.TEXTURE_2D,0,b,x,_,p);g(s)&&A(l),h.__version=c.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function P(t,n,s,o,u,c){let h=a.convert(s.format,s.colorSpace),d=a.convert(s.type),f=v(s.internalFormat,h,d,s.colorSpace),p=i.get(n),m=i.get(s);if(m.__renderTarget=n,!p.__hasExternalTextures){let t=Math.max(1,n.width>>c),i=Math.max(1,n.height>>c);u===e.TEXTURE_3D||u===e.TEXTURE_2D_ARRAY?r.texImage3D(u,c,f,t,i,n.depth,0,h,d,null):r.texImage2D(u,c,f,t,i,0,h,d,null)}r.bindFramebuffer(e.FRAMEBUFFER,t),z(n)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,o,u,m.__webglTexture,0,N(n)):(u===e.TEXTURE_2D||u>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&u<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,o,u,m.__webglTexture,c),r.bindFramebuffer(e.FRAMEBUFFER,null)}function L(t,r,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),r.depthBuffer){let n=r.depthTexture,a=n&&n.isDepthTexture?n.type:null,s=y(r.stencilBuffer,a),o=r.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=N(r);z(r)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,s,r.width,r.height):i?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,s,r.width,r.height):e.renderbufferStorage(e.RENDERBUFFER,s,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,o,e.RENDERBUFFER,t)}else{let t=r.textures;for(let n=0;n<t.length;n++){let s=t[n],o=a.convert(s.format,s.colorSpace),u=a.convert(s.type),c=v(s.internalFormat,o,u,s.colorSpace),h=N(r);i&&!1===z(r)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,c,r.width,r.height):z(r)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,c,r.width,r.height):e.renderbufferStorage(e.RENDERBUFFER,c,r.width,r.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function k(t,n){if(n&&n.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");if(r.bindFramebuffer(e.FRAMEBUFFER,t),!(n.depthTexture&&n.depthTexture.isDepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");let a=i.get(n.depthTexture);a.__renderTarget=n,a.__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),w(n.depthTexture,0);let s=a.__webglTexture,o=N(n);if(n.depthTexture.format===rc)z(n)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else if(n.depthTexture.format===rh)z(n)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,o):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0);else throw Error("Unknown depthTexture format")}function F(t){let n=i.get(t),a=!0===t.isWebGLCubeRenderTarget;if(n.__boundDepthTexture!==t.depthTexture){let e=t.depthTexture;if(n.__depthDisposeCallback&&n.__depthDisposeCallback(),e){let t=()=>{delete n.__boundDepthTexture,delete n.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),n.__depthDisposeCallback=t}n.__boundDepthTexture=e}if(t.depthTexture&&!n.__autoAllocateDepthBuffer){if(a)throw Error("target.depthTexture not supported in Cube render targets");let e=t.texture.mipmaps;e&&e.length>0?k(n.__webglFramebuffer[0],t):k(n.__webglFramebuffer,t)}else if(a){n.__webglDepthbuffer=[];for(let i=0;i<6;i++)if(r.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer[i]),void 0===n.__webglDepthbuffer[i])n.__webglDepthbuffer[i]=e.createRenderbuffer(),L(n.__webglDepthbuffer[i],t,!1);else{let r=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,a=n.__webglDepthbuffer[i];e.bindRenderbuffer(e.RENDERBUFFER,a),e.framebufferRenderbuffer(e.FRAMEBUFFER,r,e.RENDERBUFFER,a)}}else{let i=t.texture.mipmaps;if(i&&i.length>0?r.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer[0]):r.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer),void 0===n.__webglDepthbuffer)n.__webglDepthbuffer=e.createRenderbuffer(),L(n.__webglDepthbuffer,t,!1);else{let r=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,i=n.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,r,e.RENDERBUFFER,i)}}r.bindFramebuffer(e.FRAMEBUFFER,null)}let O=[],U=[];function N(e){return Math.min(n.maxSamples,e.samples)}function z(e){let r=i.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==r.__useRenderToTexture}function G(e,t){let r=e.colorSpace,i=e.format,n=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||r!==iu&&r!==io&&(nA.getTransfer(r)===ih?(i!==ru||n!==t4)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",r)),t}function H(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){let e=S;return e>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+n.maxTextures),S+=1,e},this.resetTextureUnits=function(){S=0},this.setTexture2D=w,this.setTexture2DArray=function(t,n){let a=i.get(t);if(!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){D(a,t,n);return}r.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+n)},this.setTexture3D=function(t,n){let a=i.get(t);if(!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){D(a,t,n);return}r.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+n)},this.setTextureCube=function(t,s){let o=i.get(t);if(t.version>0&&o.__version!==t.version){(function(t,s,o){if(6!==s.image.length)return;let l=R(t,s),u=s.source;r.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);let c=i.get(u);if(u.version!==c.__version||!0===l){let t;r.activeTexture(e.TEXTURE0+o);let i=nA.getPrimaries(nA.workingColorSpace),h=s.colorSpace===io?null:nA.getPrimaries(s.colorSpace),d=s.colorSpace===io||i===h?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let f=s.isCompressedTexture||s.image[0].isCompressedTexture,p=s.image[0]&&s.image[0].isDataTexture,y=[];for(let e=0;e<6;e++)f||p?y[e]=p?s.image[e].image:s.image[e]:y[e]=m(s.image[e],!0,n.maxCubemapSize),y[e]=G(s,y[e]);let x=y[0],_=a.convert(s.format,s.colorSpace),b=a.convert(s.type),S=v(s.internalFormat,_,b,s.colorSpace),w=!0!==s.isVideoTexture,C=void 0===c.__version||!0===l,T=u.dataReady,I=E(s,x);if(M(e.TEXTURE_CUBE_MAP,s),f){w&&C&&r.texStorage2D(e.TEXTURE_CUBE_MAP,I,S,x.width,x.height);for(let i=0;i<6;i++){t=y[i].mipmaps;for(let n=0;n<t.length;n++){let a=t[n];s.format!==ru?null!==_?w?T&&r.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,n,0,0,a.width,a.height,_,a.data):r.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,n,S,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):w?T&&r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,n,0,0,a.width,a.height,_,b,a.data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,n,S,a.width,a.height,0,_,b,a.data)}}}else{if(t=s.mipmaps,w&&C){t.length>0&&I++;let i=H(y[0]);r.texStorage2D(e.TEXTURE_CUBE_MAP,I,S,i.width,i.height)}for(let i=0;i<6;i++)if(p){w?T&&r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,0,0,y[i].width,y[i].height,_,b,y[i].data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,S,y[i].width,y[i].height,0,_,b,y[i].data);for(let n=0;n<t.length;n++){let a=t[n].image[i].image;w?T&&r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,n+1,0,0,a.width,a.height,_,b,a.data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,n+1,S,a.width,a.height,0,_,b,a.data)}}else{w?T&&r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,0,0,_,b,y[i]):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,S,_,b,y[i]);for(let n=0;n<t.length;n++){let a=t[n];w?T&&r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,n+1,0,0,_,b,a.image[i]):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,n+1,S,_,b,a.image[i])}}}g(s)&&A(e.TEXTURE_CUBE_MAP),c.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version})(o,t,s);return}r.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,r,n){let a=i.get(t);void 0!==r&&P(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==n&&F(t)},this.setupRenderTarget=function(t){let n=t.texture,o=i.get(t),l=i.get(n);t.addEventListener("dispose",_);let u=t.textures,c=!0===t.isWebGLCubeRenderTarget,h=u.length>1;if(!h&&(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=n.version,s.memory.textures++),c){o.__webglFramebuffer=[];for(let t=0;t<6;t++)if(n.mipmaps&&n.mipmaps.length>0){o.__webglFramebuffer[t]=[];for(let r=0;r<n.mipmaps.length;r++)o.__webglFramebuffer[t][r]=e.createFramebuffer()}else o.__webglFramebuffer[t]=e.createFramebuffer()}else{if(n.mipmaps&&n.mipmaps.length>0){o.__webglFramebuffer=[];for(let t=0;t<n.mipmaps.length;t++)o.__webglFramebuffer[t]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(h)for(let t=0,r=u.length;t<r;t++){let r=i.get(u[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),s.memory.textures++)}if(t.samples>0&&!1===z(t)){o.__webglMultisampledFramebuffer=e.createFramebuffer(),o.__webglColorRenderbuffer=[],r.bindFramebuffer(e.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let r=0;r<u.length;r++){let i=u[r];o.__webglColorRenderbuffer[r]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,o.__webglColorRenderbuffer[r]);let n=a.convert(i.format,i.colorSpace),s=a.convert(i.type),l=v(i.internalFormat,n,s,i.colorSpace,!0===t.isXRRenderTarget),c=N(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,c,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+r,e.RENDERBUFFER,o.__webglColorRenderbuffer[r])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(o.__webglDepthRenderbuffer=e.createRenderbuffer(),L(o.__webglDepthRenderbuffer,t,!0)),r.bindFramebuffer(e.FRAMEBUFFER,null)}}if(c){r.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),M(e.TEXTURE_CUBE_MAP,n);for(let r=0;r<6;r++)if(n.mipmaps&&n.mipmaps.length>0)for(let i=0;i<n.mipmaps.length;i++)P(o.__webglFramebuffer[r][i],t,n,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,i);else P(o.__webglFramebuffer[r],t,n,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0);g(n)&&A(e.TEXTURE_CUBE_MAP),r.unbindTexture()}else if(h){for(let n=0,a=u.length;n<a;n++){let a=u[n],s=i.get(a),l=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),r.bindTexture(l,s.__webglTexture),M(l,a),P(o.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+n,l,0),g(a)&&A(l)}r.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),r.bindTexture(i,l.__webglTexture),M(i,n),n.mipmaps&&n.mipmaps.length>0)for(let r=0;r<n.mipmaps.length;r++)P(o.__webglFramebuffer[r],t,n,e.COLOR_ATTACHMENT0,i,r);else P(o.__webglFramebuffer,t,n,e.COLOR_ATTACHMENT0,i,0);g(n)&&A(i),r.unbindTexture()}t.depthBuffer&&F(t)},this.updateRenderTargetMipmap=function(t){let n=t.textures;for(let a=0,s=n.length;a<s;a++){let s=n[a];if(g(s)){let n=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D,a=i.get(s).__webglTexture;r.bindTexture(n,a),A(n),r.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0){if(!1===z(t)){let n=t.textures,a=t.width,s=t.height,o=e.COLOR_BUFFER_BIT,l=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=i.get(t),h=n.length>1;if(h)for(let t=0;t<n.length;t++)r.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),r.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);r.bindFramebuffer(e.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer);let d=t.texture.mipmaps;d&&d.length>0?r.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglFramebuffer[0]):r.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglFramebuffer);for(let r=0;r<n.length;r++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),h){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,c.__webglColorRenderbuffer[r]);let t=i.get(n[r]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,s,0,0,a,s,o,e.NEAREST),!0===u&&(O.length=0,U.length=0,O.push(e.COLOR_ATTACHMENT0+r),t.depthBuffer&&!1===t.resolveDepthBuffer&&(O.push(l),U.push(l),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,U)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,O))}if(r.bindFramebuffer(e.READ_FRAMEBUFFER,null),r.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<n.length;t++){r.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,c.__webglColorRenderbuffer[t]);let a=i.get(n[t]).__webglTexture;r.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}r.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&u){let r=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[r])}}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=P,this.useMultisampledRTT=z}function Ee(e,t){return{convert:function(r,i=io){let n;let a=nA.getTransfer(i);if(r===t4)return e.UNSIGNED_BYTE;if(r===rr)return e.UNSIGNED_SHORT_4_4_4_4;if(r===ri)return e.UNSIGNED_SHORT_5_5_5_1;if(r===ra)return e.UNSIGNED_INT_5_9_9_9_REV;if(r===rs)return e.UNSIGNED_INT_10F_11F_11F_REV;if(r===t5)return e.BYTE;if(r===t6)return e.SHORT;if(r===t8)return e.UNSIGNED_SHORT;if(r===t9)return e.INT;if(r===t7)return e.UNSIGNED_INT;if(r===re)return e.FLOAT;if(r===rt)return e.HALF_FLOAT;if(r===ro)return e.ALPHA;if(r===rl)return e.RGB;if(r===ru)return e.RGBA;if(r===rc)return e.DEPTH_COMPONENT;if(r===rh)return e.DEPTH_STENCIL;if(r===rd)return e.RED;if(r===rf)return e.RED_INTEGER;if(r===rp)return e.RG;if(r===rm)return e.RG_INTEGER;if(r===rA)return e.RGBA_INTEGER;if(r===rv||r===ry||r===rE||r===rx){if(a===ih){if(null===(n=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(r===rv)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===ry)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===rE)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===rx)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(r===rv)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===ry)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===rE)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===rx)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}}if(r===r_||r===rb||r===rS||r===rw){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(r===r_)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===rb)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===rS)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===rw)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===rC||r===rT||r===rI){if(null===(n=t.get("WEBGL_compressed_texture_etc")))return null;if(r===rC||r===rT)return a===ih?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(r===rI)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC}if(r===rM||r===rR||r===rB||r===rD||r===rP||r===rL||r===rk||r===rF||r===rO||r===rU||r===rN||r===rz||r===rG||r===rH){if(null===(n=t.get("WEBGL_compressed_texture_astc")))return null;if(r===rM)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===rR)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===rB)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===rD)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===rP)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===rL)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===rk)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===rF)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===rO)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===rU)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===rN)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===rz)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===rG)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===rH)return a===ih?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}if(r===rQ||r===rV||r===rW){if(null===(n=t.get("EXT_texture_compression_bptc")))return null;if(r===rQ)return a===ih?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===rV)return n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===rW)return n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(r===rj||r===rY||r===rK||r===rq){if(null===(n=t.get("EXT_texture_compression_rgtc")))return null;if(r===rj)return n.COMPRESSED_RED_RGTC1_EXT;if(r===rY)return n.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===rK)return n.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===rq)return n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return r===rn?e.UNSIGNED_INT_24_8:void 0!==e[r]?e[r]:null}}}let Et=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Er=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Ei{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(null===this.texture){let r=new lA(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=r}}getMesh(e){if(null!==this.texture&&null===this.mesh){let t=e.cameras[0].viewport,r=new sT({vertexShader:Et,fragmentShader:Er,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new sE(new uf(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class En extends iZ{constructor(e,t){super();let r=this,i=null,n=1,a=null,s="local-floor",o=1,l=null,u=null,c=null,h=null,d=null,f=null,p="undefined"!=typeof XRWebGLBinding,m=new Ei,g={},A=t.getContextAttributes(),v=null,y=null,E=[],x=[],_=new nt,b=null,S=new sD;S.viewport=new nT;let w=new sD;w.viewport=new nT;let C=[S,w],T=new cG,I=null,M=null;function R(e){let t=x.indexOf(e.inputSource);if(-1===t)return;let r=E[t];void 0!==r&&(r.update(e.inputSource,e.frame,l||a),r.dispatchEvent({type:e.type,data:e.inputSource}))}function B(){i.removeEventListener("select",R),i.removeEventListener("selectstart",R),i.removeEventListener("selectend",R),i.removeEventListener("squeeze",R),i.removeEventListener("squeezestart",R),i.removeEventListener("squeezeend",R),i.removeEventListener("end",B),i.removeEventListener("inputsourceschange",D);for(let e=0;e<E.length;e++){let t=x[e];null!==t&&(x[e]=null,E[e].disconnect(t))}for(let e in I=null,M=null,m.reset(),g)delete g[e];e.setRenderTarget(v),d=null,h=null,c=null,i=null,y=null,O.stop(),r.isPresenting=!1,e.setPixelRatio(b),e.setSize(_.width,_.height,!1),r.dispatchEvent({type:"sessionend"})}function D(e){for(let t=0;t<e.removed.length;t++){let r=e.removed[t],i=x.indexOf(r);i>=0&&(x[i]=null,E[i].disconnect(r))}for(let t=0;t<e.added.length;t++){let r=e.added[t],i=x.indexOf(r);if(-1===i){for(let e=0;e<E.length;e++){if(e>=x.length){x.push(r),i=e;break}if(null===x[e]){x[e]=r,i=e;break}}if(-1===i)break}let n=E[i];n&&n.connect(r)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=E[e];return void 0===t&&(t=new sU,E[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=E[e];return void 0===t&&(t=new sU,E[e]=t),t.getGripSpace()},this.getHand=function(e){let t=E[e];return void 0===t&&(t=new sU,E[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){n=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return null===c&&p&&(c=new XRWebGLBinding(i,t)),c},this.getFrame=function(){return f},this.getSession=function(){return i},this.setSession=async function(u){if(null!==(i=u)){if(v=e.getRenderTarget(),i.addEventListener("select",R),i.addEventListener("selectstart",R),i.addEventListener("selectend",R),i.addEventListener("squeeze",R),i.addEventListener("squeezestart",R),i.addEventListener("squeezeend",R),i.addEventListener("end",B),i.addEventListener("inputsourceschange",D),!0!==A.xrCompatible&&await t.makeXRCompatible(),b=e.getPixelRatio(),e.getSize(_),p&&"createProjectionLayer"in XRWebGLBinding.prototype){let r=null,a=null,s=null;A.depth&&(s=A.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,r=A.stencil?rh:rc,a=A.stencil?rn:t7);let o={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:n};h=(c=this.getBinding()).createProjectionLayer(o),i.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),y=new nM(h.textureWidth,h.textureHeight,{format:ru,type:t4,depthTexture:new lg(h.textureWidth,h.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,r),stencilBuffer:A.stencil,colorSpace:e.outputColorSpace,samples:A.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues,resolveStencilBuffer:!1===h.ignoreDepthValues})}else{let r={antialias:A.antialias,alpha:!0,depth:A.depth,stencil:A.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(i,t,r),i.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),y=new nM(d.framebufferWidth,d.framebufferHeight,{format:ru,type:t4,colorSpace:e.outputColorSpace,stencilBuffer:A.stencil,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}y.isXRRenderTarget=!0,this.setFoveation(o),l=null,a=await i.requestReferenceSpace(s),O.setContext(i),O.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};let P=new ni,L=new ni;function k(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;let t=e.near,r=e.far;null!==m.texture&&(m.depthNear>0&&(t=m.depthNear),m.depthFar>0&&(r=m.depthFar)),T.near=w.near=S.near=t,T.far=w.far=S.far=r,(I!==T.near||M!==T.far)&&(i.updateRenderState({depthNear:T.near,depthFar:T.far}),I=T.near,M=T.far),T.layers.mask=6|e.layers.mask,S.layers.mask=3&T.layers.mask,w.layers.mask=5&T.layers.mask;let n=e.parent,a=T.cameras;k(T,n);for(let e=0;e<a.length;e++)k(a[e],n);2===a.length?function(e,t,r){P.setFromMatrixPosition(t.matrixWorld),L.setFromMatrixPosition(r.matrixWorld);let i=P.distanceTo(L),n=t.projectionMatrix.elements,a=r.projectionMatrix.elements,s=n[14]/(n[10]-1),o=n[14]/(n[10]+1),l=(n[9]+1)/n[5],u=(n[9]-1)/n[5],c=(n[8]-1)/n[0],h=(a[8]+1)/a[0],d=i/(-c+h),f=-(d*c);if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===n[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{let t=s+d,r=o+d;e.projectionMatrix.makePerspective(s*c-f,s*h+(i-f),l*o/r*t,u*o/r*t,t,r),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(T,S,w):T.projectionMatrix.copy(S.projectionMatrix),null===n?e.matrix.copy(T.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(T.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(T.projectionMatrix),e.projectionMatrixInverse.copy(T.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*i3*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)},this.getCamera=function(){return T},this.getFoveation=function(){if(null!==h||null!==d)return o},this.setFoveation=function(e){o=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==m.texture},this.getDepthSensingMesh=function(){return m.getMesh(T)},this.getCameraTexture=function(e){return g[e]};let F=null,O=new A6;O.setAnimationLoop(function(t,n){if(u=n.getViewerPose(l||a),f=n,null!==u){let t=u.views;null!==d&&(e.setRenderTargetFramebuffer(y,d.framebuffer),e.setRenderTarget(y));let n=!1;t.length!==T.cameras.length&&(T.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){let i=t[r],a=null;if(null!==d)a=d.getViewport(i);else{let t=c.getViewSubImage(h,i);a=t.viewport,0===r&&(e.setRenderTargetTextures(y,t.colorTexture,t.depthStencilTexture),e.setRenderTarget(y))}let s=C[r];void 0===s&&((s=new sD).layers.enable(r),s.viewport=new nT,C[r]=s),s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(i.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(a.x,a.y,a.width,a.height),0===r&&(T.matrix.copy(s.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),!0===n&&T.cameras.push(s)}let a=i.enabledFeatures;if(a&&a.includes("depth-sensing")&&"gpu-optimized"==i.depthUsage&&p){let e=(c=r.getBinding()).getDepthInformation(t[0]);e&&e.isValid&&e.texture&&m.init(e,i.renderState)}if(a&&a.includes("camera-access")&&p){e.state.unbindTexture(),c=r.getBinding();for(let e=0;e<t.length;e++){let r=t[e].camera;if(r){let e=g[r];e||(e=new lA,g[r]=e);let t=c.getCameraImage(r);e.sourceTexture=t}}}}for(let e=0;e<E.length;e++){let t=x[e],r=E[e];null!==t&&void 0!==r&&r.update(t,n,l||a)}F&&F(t,n),n.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:n}),f=null}),this.setAnimationLoop=function(e){F=e},this.dispose=function(){}}}let Ea=new ao,Es=new n8;function Eo(e,t){function r(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map,r(i.map,e.mapTransform)),i.alphaMap&&(e.alphaMap.value=i.alphaMap,r(i.alphaMap,e.alphaMapTransform)),i.bumpMap&&(e.bumpMap.value=i.bumpMap,r(i.bumpMap,e.bumpMapTransform),e.bumpScale.value=i.bumpScale,i.side===e0&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,r(i.normalMap,e.normalMapTransform),e.normalScale.value.copy(i.normalScale),i.side===e0&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,r(i.displacementMap,e.displacementMapTransform),e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap,r(i.emissiveMap,e.emissiveMapTransform)),i.specularMap&&(e.specularMap.value=i.specularMap,r(i.specularMap,e.specularMapTransform)),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);let n=t.get(i),a=n.envMap,s=n.envMapRotation;a&&(e.envMap.value=a,Ea.copy(s),Ea.x*=-1,Ea.y*=-1,Ea.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(Ea.y*=-1,Ea.z*=-1),e.envMapRotation.value.setFromMatrix4(Es.makeRotationFromEuler(Ea)),e.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity,r(i.lightMap,e.lightMapTransform)),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity,r(i.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,r){r.color.getRGB(t.fogColor.value,sw(e)),r.isFog?(t.fogNear.value=r.near,t.fogFar.value=r.far):r.isFogExp2&&(t.fogDensity.value=r.density)},refreshMaterialUniforms:function(e,n,a,s,o){n.isMeshBasicMaterial?i(e,n):n.isMeshLambertMaterial?i(e,n):n.isMeshToonMaterial?(i(e,n),n.gradientMap&&(e.gradientMap.value=n.gradientMap)):n.isMeshPhongMaterial?(i(e,n),e.specular.value.copy(n.specular),e.shininess.value=Math.max(n.shininess,1e-4)):n.isMeshStandardMaterial?(i(e,n),e.metalness.value=n.metalness,n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap,r(n.metalnessMap,e.metalnessMapTransform)),e.roughness.value=n.roughness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap,r(n.roughnessMap,e.roughnessMapTransform)),n.envMap&&(e.envMapIntensity.value=n.envMapIntensity),n.isMeshPhysicalMaterial&&(e.ior.value=n.ior,n.sheen>0&&(e.sheenColor.value.copy(n.sheenColor).multiplyScalar(n.sheen),e.sheenRoughness.value=n.sheenRoughness,n.sheenColorMap&&(e.sheenColorMap.value=n.sheenColorMap,r(n.sheenColorMap,e.sheenColorMapTransform)),n.sheenRoughnessMap&&(e.sheenRoughnessMap.value=n.sheenRoughnessMap,r(n.sheenRoughnessMap,e.sheenRoughnessMapTransform))),n.clearcoat>0&&(e.clearcoat.value=n.clearcoat,e.clearcoatRoughness.value=n.clearcoatRoughness,n.clearcoatMap&&(e.clearcoatMap.value=n.clearcoatMap,r(n.clearcoatMap,e.clearcoatMapTransform)),n.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=n.clearcoatRoughnessMap,r(n.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),n.clearcoatNormalMap&&(e.clearcoatNormalMap.value=n.clearcoatNormalMap,r(n.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(n.clearcoatNormalScale),n.side===e0&&e.clearcoatNormalScale.value.negate())),n.dispersion>0&&(e.dispersion.value=n.dispersion),n.iridescence>0&&(e.iridescence.value=n.iridescence,e.iridescenceIOR.value=n.iridescenceIOR,e.iridescenceThicknessMinimum.value=n.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=n.iridescenceThicknessRange[1],n.iridescenceMap&&(e.iridescenceMap.value=n.iridescenceMap,r(n.iridescenceMap,e.iridescenceMapTransform)),n.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=n.iridescenceThicknessMap,r(n.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),n.transmission>0&&(e.transmission.value=n.transmission,e.transmissionSamplerMap.value=o.texture,e.transmissionSamplerSize.value.set(o.width,o.height),n.transmissionMap&&(e.transmissionMap.value=n.transmissionMap,r(n.transmissionMap,e.transmissionMapTransform)),e.thickness.value=n.thickness,n.thicknessMap&&(e.thicknessMap.value=n.thicknessMap,r(n.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=n.attenuationDistance,e.attenuationColor.value.copy(n.attenuationColor)),n.anisotropy>0&&(e.anisotropyVector.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation)),n.anisotropyMap&&(e.anisotropyMap.value=n.anisotropyMap,r(n.anisotropyMap,e.anisotropyMapTransform))),e.specularIntensity.value=n.specularIntensity,e.specularColor.value.copy(n.specularColor),n.specularColorMap&&(e.specularColorMap.value=n.specularColorMap,r(n.specularColorMap,e.specularColorMapTransform)),n.specularIntensityMap&&(e.specularIntensityMap.value=n.specularIntensityMap,r(n.specularIntensityMap,e.specularIntensityMapTransform)))):n.isMeshMatcapMaterial?(i(e,n),n.matcap&&(e.matcap.value=n.matcap)):n.isMeshDepthMaterial?i(e,n):n.isMeshDistanceMaterial?(i(e,n),function(e,r){let i=t.get(r).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,n)):n.isMeshNormalMaterial?i(e,n):n.isLineBasicMaterial?(e.diffuse.value.copy(n.color),e.opacity.value=n.opacity,n.map&&(e.map.value=n.map,r(n.map,e.mapTransform)),n.isLineDashedMaterial&&(e.dashSize.value=n.dashSize,e.totalSize.value=n.dashSize+n.gapSize,e.scale.value=n.scale)):n.isPointsMaterial?(e.diffuse.value.copy(n.color),e.opacity.value=n.opacity,e.size.value=n.size*a,e.scale.value=.5*s,n.map&&(e.map.value=n.map,r(n.map,e.uvTransform)),n.alphaMap&&(e.alphaMap.value=n.alphaMap,r(n.alphaMap,e.alphaMapTransform)),n.alphaTest>0&&(e.alphaTest.value=n.alphaTest)):n.isSpriteMaterial?(e.diffuse.value.copy(n.color),e.opacity.value=n.opacity,e.rotation.value=n.rotation,n.map&&(e.map.value=n.map,r(n.map,e.mapTransform)),n.alphaMap&&(e.alphaMap.value=n.alphaMap,r(n.alphaMap,e.alphaMapTransform)),n.alphaTest>0&&(e.alphaTest.value=n.alphaTest)):n.isShadowMaterial?(e.color.value.copy(n.color),e.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function El(e,t,r,i){let n={},a={},s=[],o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e){let t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){let r=t.target;r.removeEventListener("dispose",u);let i=s.indexOf(r.__bindingPointIndex);s.splice(i,1),e.deleteBuffer(n[r.id]),delete n[r.id],delete a[r.id]}return{bind:function(e,t){let r=t.program;i.uniformBlockBinding(e,r)},update:function(r,c){let h=n[r.id];void 0===h&&(function(e){let t=e.uniforms,r=0;for(let e=0,i=t.length;e<i;e++){let i=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0,t=i.length;e<t;e++){let t=i[e],n=Array.isArray(t.value)?t.value:[t.value];for(let e=0,i=n.length;e<i;e++){let i=l(n[e]),a=r%16,s=a%i.boundary,o=a+s;r+=s,0!==o&&16-o<i.storage&&(r+=16-o),t.__data=new Float32Array(i.storage/Float32Array.BYTES_PER_ELEMENT),t.__offset=r,r+=i.storage}}}let i=r%16;i>0&&(r+=16-i),e.__size=r,e.__cache={}}(r),h=function(t){let r=function(){for(let e=0;e<o;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=r;let i=e.createBuffer(),n=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,n,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,r,i),i}(r),n[r.id]=h,r.addEventListener("dispose",u));let d=c.program;i.updateUBOMapping(r,d);let f=t.render.frame;a[r.id]!==f&&(function(t){let r=n[t.id],i=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,r);for(let t=0,r=i.length;t<r;t++){let r=Array.isArray(i[t])?i[t]:[i[t]];for(let i=0,n=r.length;i<n;i++){let n=r[i];if(!0===function(e,t,r,i){let n=e.value,a=t+"_"+r;if(void 0===i[a])return"number"==typeof n||"boolean"==typeof n?i[a]=n:i[a]=n.clone(),!0;{let e=i[a];if("number"==typeof n||"boolean"==typeof n){if(e!==n)return i[a]=n,!0}else if(!1===e.equals(n))return e.copy(n),!0}return!1}(n,t,i,a)){let t=n.__offset,r=Array.isArray(n.value)?n.value:[n.value],i=0;for(let a=0;a<r.length;a++){let s=r[a],o=l(s);"number"==typeof s||"boolean"==typeof s?(n.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+i,n.__data)):s.isMatrix3?(n.__data[0]=s.elements[0],n.__data[1]=s.elements[1],n.__data[2]=s.elements[2],n.__data[3]=0,n.__data[4]=s.elements[3],n.__data[5]=s.elements[4],n.__data[6]=s.elements[5],n.__data[7]=0,n.__data[8]=s.elements[6],n.__data[9]=s.elements[7],n.__data[10]=s.elements[8],n.__data[11]=0):(s.toArray(n.__data,i),i+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,n.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(r),a[r.id]=f)},dispose:function(){for(let t in n)e.deleteBuffer(n[t]);s=[],n={},a={}}}}class Eu{constructor(e={}){let t,r,i,n,a,s,o,l,u,c,h,d,f,p,m,g,A,v,y,E,x,_,b,S,w;let{canvas:C=nd(),context:T=null,depth:I=!0,stencil:M=!1,alpha:R=!1,antialias:B=!1,premultipliedAlpha:D=!0,preserveDrawingBuffer:P=!1,powerPreference:L="default",failIfMajorPerformanceCaveat:k=!1,reversedDepthBuffer:F=!1}=e;if(this.isWebGLRenderer=!0,null!==T){if("undefined"!=typeof WebGLRenderingContext&&T instanceof WebGLRenderingContext)throw Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");t=T.getContextAttributes().alpha}else t=R;let O=new Uint32Array(4),U=new Int32Array(4),N=null,z=null,G=[],H=[];this.domElement=C,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=tM,this.toneMappingExposure=1,this.transmissionResolutionScale=1;let Q=this,V=!1;this._outputColorSpace=il;let W=0,j=0,Y=null,K=-1,q=null,X=new nT,$=new nT,J=null,Z=new aQ(0),ee=0,et=C.width,er=C.height,ei=1,en=null,ea=null,es=new nT(0,0,et,er),eo=new nT(0,0,et,er),el=!1,eu=new oR,ec=!1,eh=!1,ed=new n8,ef=new ni,ep=new nT,em={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0},eg=!1;function eA(){return null===Y?ei:1}let ev=T;function ey(e,t){return C.getContext(e,t)}try{if("setAttribute"in C&&C.setAttribute("data-engine",`three.js r${eH}`),C.addEventListener("webglcontextlost",e_,!1),C.addEventListener("webglcontextrestored",eb,!1),C.addEventListener("webglcontextcreationerror",eS,!1),null===ev){let e="webgl2";if(ev=ey(e,{alpha:!0,depth:I,stencil:M,antialias:B,premultipliedAlpha:D,preserveDrawingBuffer:P,powerPreference:L,failIfMajorPerformanceCaveat:k}),null===ev){if(ey(e))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}}}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function eE(){(r=new vI(ev)).init(),b=new Ee(ev,r),i=new vo(ev,r,e,b),n=new y9(ev,r),i.reversedDepthBuffer&&F&&n.buffers.depth.setReversed(!0),a=new vB(ev),s=new yq,o=new y7(ev,r,n,s,i,b,a),l=new vu(Q),u=new vT(Q),c=new A8(ev),S=new va(ev,c),h=new vM(ev,c,a,S),d=new vP(ev,h,c,a),E=new vD(ev,i,o),A=new vl(s),f=new yK(Q,l,u,r,i,S,A),p=new Eo(Q,s),m=new yZ,g=new y5(r),y=new vn(Q,l,u,n,d,t,D),v=new y6(Q,d,i),w=new El(ev,a,i,n),x=new vs(ev,r,a),_=new vR(ev,r,a),a.programs=f.programs,Q.capabilities=i,Q.extensions=r,Q.properties=s,Q.renderLists=m,Q.shadowMap=v,Q.state=n,Q.info=a}eE();let ex=new En(Q,ev);function e_(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),V=!0}function eb(){console.log("THREE.WebGLRenderer: Context Restored."),V=!1;let e=a.autoReset,t=v.enabled,r=v.autoUpdate,i=v.needsUpdate,n=v.type;eE(),a.autoReset=e,v.enabled=t,v.autoUpdate=r,v.needsUpdate=i,v.type=n}function eS(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function ew(e){let t=e.target;t.removeEventListener("dispose",ew),function(e){let t=s.get(e).programs;void 0!==t&&(t.forEach(function(e){f.releaseProgram(e)}),e.isShaderMaterial&&f.releaseShaderCache(e))}(t),s.remove(t)}function eC(e,t,r){!0===e.transparent&&e.side===e1&&!1===e.forceSinglePass?(e.side=e0,e.needsUpdate=!0,eF(e,t,r),e.side=eZ,e.needsUpdate=!0,eF(e,t,r),e.side=e1):eF(e,t,r)}this.xr=ex,this.getContext=function(){return ev},this.getContextAttributes=function(){return ev.getContextAttributes()},this.forceContextLoss=function(){let e=r.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){let e=r.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return ei},this.setPixelRatio=function(e){void 0!==e&&(ei=e,this.setSize(et,er,!1))},this.getSize=function(e){return e.set(et,er)},this.setSize=function(e,t,r=!0){if(ex.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}et=e,er=t,C.width=Math.floor(e*ei),C.height=Math.floor(t*ei),!0===r&&(C.style.width=e+"px",C.style.height=t+"px"),this.setViewport(0,0,e,t)},this.getDrawingBufferSize=function(e){return e.set(et*ei,er*ei).floor()},this.setDrawingBufferSize=function(e,t,r){et=e,er=t,ei=r,C.width=Math.floor(e*r),C.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(X)},this.getViewport=function(e){return e.copy(es)},this.setViewport=function(e,t,r,i){e.isVector4?es.set(e.x,e.y,e.z,e.w):es.set(e,t,r,i),n.viewport(X.copy(es).multiplyScalar(ei).round())},this.getScissor=function(e){return e.copy(eo)},this.setScissor=function(e,t,r,i){e.isVector4?eo.set(e.x,e.y,e.z,e.w):eo.set(e,t,r,i),n.scissor($.copy(eo).multiplyScalar(ei).round())},this.getScissorTest=function(){return el},this.setScissorTest=function(e){n.setScissorTest(el=e)},this.setOpaqueSort=function(e){en=e},this.setTransparentSort=function(e){ea=e},this.getClearColor=function(e){return e.copy(y.getClearColor())},this.setClearColor=function(){y.setClearColor(...arguments)},this.getClearAlpha=function(){return y.getClearAlpha()},this.setClearAlpha=function(){y.setClearAlpha(...arguments)},this.clear=function(e=!0,t=!0,r=!0){let i=0;if(e){let e=!1;if(null!==Y){let t=Y.texture.format;e=t===rA||t===rm||t===rf}if(e){let e=Y.texture.type,t=e===t4||e===t7||e===t8||e===rn||e===rr||e===ri,r=y.getClearColor(),i=y.getClearAlpha(),n=r.r,a=r.g,s=r.b;t?(O[0]=n,O[1]=a,O[2]=s,O[3]=i,ev.clearBufferuiv(ev.COLOR,0,O)):(U[0]=n,U[1]=a,U[2]=s,U[3]=i,ev.clearBufferiv(ev.COLOR,0,U))}else i|=ev.COLOR_BUFFER_BIT}t&&(i|=ev.DEPTH_BUFFER_BIT),r&&(i|=ev.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(0xffffffff)),ev.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){C.removeEventListener("webglcontextlost",e_,!1),C.removeEventListener("webglcontextrestored",eb,!1),C.removeEventListener("webglcontextcreationerror",eS,!1),y.dispose(),m.dispose(),g.dispose(),s.dispose(),l.dispose(),u.dispose(),d.dispose(),S.dispose(),w.dispose(),f.dispose(),ex.dispose(),ex.removeEventListener("sessionstart",eI),ex.removeEventListener("sessionend",eM),eR.stop()},this.renderBufferDirect=function(e,t,a,d,f,m){let g;null===t&&(t=em);let v=f.isMesh&&0>f.matrixWorld.determinant(),y=function(e,t,r,a,c){var h;!0!==t.isScene&&(t=em),o.resetTextureUnits();let d=t.fog,f=a.isMeshStandardMaterial?t.environment:null,m=null===Y?Q.outputColorSpace:!0===Y.isXRRenderTarget?Y.texture.colorSpace:iu,g=(a.isMeshStandardMaterial?u:l).get(a.envMap||f),v=!0===a.vertexColors&&!!r.attributes.color&&4===r.attributes.color.itemSize,y=!!r.attributes.tangent&&(!!a.normalMap||a.anisotropy>0),x=!!r.morphAttributes.position,_=!!r.morphAttributes.normal,b=!!r.morphAttributes.color,S=tM;a.toneMapped&&(null===Y||!0===Y.isXRRenderTarget)&&(S=Q.toneMapping);let C=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,T=void 0!==C?C.length:0,I=s.get(a),M=z.state.lights;if(!0===ec&&(!0===eh||e!==q)){let t=e===q&&a.id===K;A.setState(a,e,t)}let R=!1;a.version===I.__version?I.needsLights&&I.lightsStateVersion!==M.state.version?R=!0:I.outputColorSpace!==m?R=!0:c.isBatchedMesh&&!1===I.batching?R=!0:c.isBatchedMesh||!0!==I.batching?c.isBatchedMesh&&!0===I.batchingColor&&null===c.colorTexture?R=!0:c.isBatchedMesh&&!1===I.batchingColor&&null!==c.colorTexture?R=!0:c.isInstancedMesh&&!1===I.instancing?R=!0:c.isInstancedMesh||!0!==I.instancing?c.isSkinnedMesh&&!1===I.skinning?R=!0:c.isSkinnedMesh||!0!==I.skinning?c.isInstancedMesh&&!0===I.instancingColor&&null===c.instanceColor?R=!0:c.isInstancedMesh&&!1===I.instancingColor&&null!==c.instanceColor?R=!0:c.isInstancedMesh&&!0===I.instancingMorph&&null===c.morphTexture?R=!0:c.isInstancedMesh&&!1===I.instancingMorph&&null!==c.morphTexture?R=!0:I.envMap!==g?R=!0:!0===a.fog&&I.fog!==d?R=!0:void 0!==I.numClippingPlanes&&(I.numClippingPlanes!==A.numPlanes||I.numIntersection!==A.numIntersection)?R=!0:I.vertexAlphas!==v?R=!0:I.vertexTangents!==y?R=!0:I.morphTargets!==x?R=!0:I.morphNormals!==_?R=!0:I.morphColors!==b?R=!0:I.toneMapping!==S?R=!0:I.morphTargetsCount!==T&&(R=!0):R=!0:R=!0:R=!0:(R=!0,I.__version=a.version);let B=I.currentProgram;!0===R&&(B=eF(a,t,c));let D=!1,P=!1,L=!1,k=B.getUniforms(),F=I.uniforms;if(n.useProgram(B.program)&&(D=!0,P=!0,L=!0),a.id!==K&&(K=a.id,P=!0),D||q!==e){n.buffers.depth.getReversed()&&!0!==e.reversedDepth&&(e._reversedDepth=!0,e.updateProjectionMatrix()),k.setValue(ev,"projectionMatrix",e.projectionMatrix),k.setValue(ev,"viewMatrix",e.matrixWorldInverse);let t=k.map.cameraPosition;void 0!==t&&t.setValue(ev,ef.setFromMatrixPosition(e.matrixWorld)),i.logarithmicDepthBuffer&&k.setValue(ev,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(a.isMeshPhongMaterial||a.isMeshToonMaterial||a.isMeshLambertMaterial||a.isMeshBasicMaterial||a.isMeshStandardMaterial||a.isShaderMaterial)&&k.setValue(ev,"isOrthographic",!0===e.isOrthographicCamera),q!==e&&(q=e,P=!0,L=!0)}if(c.isSkinnedMesh){k.setOptional(ev,c,"bindMatrix"),k.setOptional(ev,c,"bindMatrixInverse");let e=c.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),k.setValue(ev,"boneTexture",e.boneTexture,o))}c.isBatchedMesh&&(k.setOptional(ev,c,"batchingTexture"),k.setValue(ev,"batchingTexture",c._matricesTexture,o),k.setOptional(ev,c,"batchingIdTexture"),k.setValue(ev,"batchingIdTexture",c._indirectTexture,o),k.setOptional(ev,c,"batchingColorTexture"),null!==c._colorsTexture&&k.setValue(ev,"batchingColorTexture",c._colorsTexture,o));let O=r.morphAttributes;if((void 0!==O.position||void 0!==O.normal||void 0!==O.color)&&E.update(c,r,B),(P||I.receiveShadow!==c.receiveShadow)&&(I.receiveShadow=c.receiveShadow,k.setValue(ev,"receiveShadow",c.receiveShadow)),a.isMeshGouraudMaterial&&null!==a.envMap&&(F.envMap.value=g,F.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1),a.isMeshStandardMaterial&&null===a.envMap&&null!==t.environment&&(F.envMapIntensity.value=t.environmentIntensity),P&&(k.setValue(ev,"toneMappingExposure",Q.toneMappingExposure),I.needsLights&&(h=L,F.ambientLightColor.needsUpdate=h,F.lightProbe.needsUpdate=h,F.directionalLights.needsUpdate=h,F.directionalLightShadows.needsUpdate=h,F.pointLights.needsUpdate=h,F.pointLightShadows.needsUpdate=h,F.spotLights.needsUpdate=h,F.spotLightShadows.needsUpdate=h,F.rectAreaLights.needsUpdate=h,F.hemisphereLights.needsUpdate=h),d&&!0===a.fog&&p.refreshFogUniforms(F,d),p.refreshMaterialUniforms(F,a,ei,er,z.state.transmissionRenderTarget[e.id]),yT.upload(ev,eO(I),F,o)),a.isShaderMaterial&&!0===a.uniformsNeedUpdate&&(yT.upload(ev,eO(I),F,o),a.uniformsNeedUpdate=!1),a.isSpriteMaterial&&k.setValue(ev,"center",c.center),k.setValue(ev,"modelViewMatrix",c.modelViewMatrix),k.setValue(ev,"normalMatrix",c.normalMatrix),k.setValue(ev,"modelMatrix",c.matrixWorld),a.isShaderMaterial||a.isRawShaderMaterial){let e=a.uniformsGroups;for(let t=0,r=e.length;t<r;t++){let r=e[t];w.update(r,B),w.bind(r,B)}}return B}(e,t,a,d,f);n.setMaterial(d,v);let b=a.index,C=1;if(!0===d.wireframe){if(void 0===(b=h.getWireframeAttribute(a)))return;C=2}let T=a.drawRange,I=a.attributes.position,M=T.start*C,R=(T.start+T.count)*C;null!==m&&(M=Math.max(M,m.start*C),R=Math.min(R,(m.start+m.count)*C)),null!==b?(M=Math.max(M,0),R=Math.min(R,b.count)):null!=I&&(M=Math.max(M,0),R=Math.min(R,I.count));let B=R-M;if(B<0||B===1/0)return;S.setup(f,d,y,a,b);let D=x;if(null!==b&&(g=c.get(b),(D=_).setIndex(g)),f.isMesh)!0===d.wireframe?(n.setLineWidth(d.wireframeLinewidth*eA()),D.setMode(ev.LINES)):D.setMode(ev.TRIANGLES);else if(f.isLine){let e=d.linewidth;void 0===e&&(e=1),n.setLineWidth(e*eA()),f.isLineSegments?D.setMode(ev.LINES):f.isLineLoop?D.setMode(ev.LINE_LOOP):D.setMode(ev.LINE_STRIP)}else f.isPoints?D.setMode(ev.POINTS):f.isSprite&&D.setMode(ev.TRIANGLES);if(f.isBatchedMesh){if(null!==f._multiDrawInstances)np("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),D.renderMultiDrawInstances(f._multiDrawStarts,f._multiDrawCounts,f._multiDrawCount,f._multiDrawInstances);else if(r.get("WEBGL_multi_draw"))D.renderMultiDraw(f._multiDrawStarts,f._multiDrawCounts,f._multiDrawCount);else{let e=f._multiDrawStarts,t=f._multiDrawCounts,r=f._multiDrawCount,i=b?c.get(b).bytesPerElement:1,n=s.get(d).currentProgram.getUniforms();for(let a=0;a<r;a++)n.setValue(ev,"_gl_DrawID",a),D.render(e[a]/i,t[a])}}else if(f.isInstancedMesh)D.renderInstances(M,B,f.count);else if(a.isInstancedBufferGeometry){let e=void 0!==a._maxInstanceCount?a._maxInstanceCount:1/0,t=Math.min(a.instanceCount,e);D.renderInstances(M,B,t)}else D.render(M,B)},this.compile=function(e,t,r=null){null===r&&(r=e),(z=g.get(r)).init(t),H.push(z),r.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(z.pushLight(e),e.castShadow&&z.pushShadow(e))}),e!==r&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(z.pushLight(e),e.castShadow&&z.pushShadow(e))}),z.setupLights();let i=new Set;return e.traverse(function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;let t=e.material;if(t){if(Array.isArray(t))for(let n=0;n<t.length;n++){let a=t[n];eC(a,r,e),i.add(a)}else eC(t,r,e),i.add(t)}}),z=H.pop(),i},this.compileAsync=function(e,t,i=null){let n=this.compile(e,t,i);return new Promise(t=>{function i(){if(n.forEach(function(e){s.get(e).currentProgram.isReady()&&n.delete(e)}),0===n.size){t(e);return}setTimeout(i,10)}null!==r.get("KHR_parallel_shader_compile")?i():setTimeout(i,10)})};let eT=null;function eI(){eR.stop()}function eM(){eR.start()}let eR=new A6;function eB(e,t,r,i){if(!1===e.visible)return;if(e.layers.test(t.layers)){if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)z.pushLight(e),e.castShadow&&z.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||eu.intersectsSprite(e)){i&&ep.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ed);let t=d.update(e),n=e.material;n.visible&&N.push(e,t,n,r,ep.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||eu.intersectsObject(e))){let t=d.update(e),n=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),ep.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),ep.copy(t.boundingSphere.center)),ep.applyMatrix4(e.matrixWorld).applyMatrix4(ed)),Array.isArray(n)){let i=t.groups;for(let a=0,s=i.length;a<s;a++){let s=i[a],o=n[s.materialIndex];o&&o.visible&&N.push(e,t,o,r,ep.z,s)}}else n.visible&&N.push(e,t,n,r,ep.z,null)}}let n=e.children;for(let e=0,a=n.length;e<a;e++)eB(n[e],t,r,i)}function eD(e,t,r,i){let a=e.opaque,s=e.transmissive,o=e.transparent;z.setupLightsView(r),!0===ec&&A.setGlobalState(Q.clippingPlanes,r),i&&n.viewport(X.copy(i)),a.length>0&&eL(a,t,r),s.length>0&&eL(s,t,r),o.length>0&&eL(o,t,r),n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),n.setPolygonOffset(!1)}function eP(e,t,i,n){if(null!==(!0===i.isScene?i.overrideMaterial:null))return;void 0===z.state.transmissionRenderTarget[n.id]&&(z.state.transmissionRenderTarget[n.id]=new nM(1,1,{generateMipmaps:!0,type:r.has("EXT_color_buffer_half_float")||r.has("EXT_color_buffer_float")?rt:t4,minFilter:t2,samples:4,stencilBuffer:M,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:nA.workingColorSpace}));let a=z.state.transmissionRenderTarget[n.id],s=n.viewport||X;a.setSize(s.z*Q.transmissionResolutionScale,s.w*Q.transmissionResolutionScale);let l=Q.getRenderTarget(),u=Q.getActiveCubeFace(),c=Q.getActiveMipmapLevel();Q.setRenderTarget(a),Q.getClearColor(Z),(ee=Q.getClearAlpha())<1&&Q.setClearColor(0xffffff,.5),Q.clear(),eg&&y.render(i);let h=Q.toneMapping;Q.toneMapping=tM;let d=n.viewport;if(void 0!==n.viewport&&(n.viewport=void 0),z.setupLightsView(n),!0===ec&&A.setGlobalState(Q.clippingPlanes,n),eL(e,i,n),o.updateMultisampleRenderTarget(a),o.updateRenderTargetMipmap(a),!1===r.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let r=0,a=t.length;r<a;r++){let a=t[r],s=a.object,o=a.geometry,l=a.material,u=a.group;if(l.side===e1&&s.layers.test(n.layers)){let t=l.side;l.side=e0,l.needsUpdate=!0,ek(s,i,n,o,l,u),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(o.updateMultisampleRenderTarget(a),o.updateRenderTargetMipmap(a))}Q.setRenderTarget(l,u,c),Q.setClearColor(Z,ee),void 0!==d&&(n.viewport=d),Q.toneMapping=h}function eL(e,t,r){let i=!0===t.isScene?t.overrideMaterial:null;for(let n=0,a=e.length;n<a;n++){let a=e[n],s=a.object,o=a.geometry,l=a.group,u=a.material;!0===u.allowOverride&&null!==i&&(u=i),s.layers.test(r.layers)&&ek(s,t,r,o,u,l)}}function ek(e,t,r,i,n,a){e.onBeforeRender(Q,t,r,i,n,a),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),n.onBeforeRender(Q,t,r,i,e,a),!0===n.transparent&&n.side===e1&&!1===n.forceSinglePass?(n.side=e0,n.needsUpdate=!0,Q.renderBufferDirect(r,t,i,n,e,a),n.side=eZ,n.needsUpdate=!0,Q.renderBufferDirect(r,t,i,n,e,a),n.side=e1):Q.renderBufferDirect(r,t,i,n,e,a),e.onAfterRender(Q,t,r,i,n,a)}function eF(e,t,r){!0!==t.isScene&&(t=em);let i=s.get(e),n=z.state.lights,a=z.state.shadowsArray,o=n.state.version,c=f.getParameters(e,n.state,a,t,r),h=f.getProgramCacheKey(c),d=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?u:l).get(e.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===d&&(e.addEventListener("dispose",ew),d=new Map,i.programs=d);let p=d.get(h);if(void 0!==p){if(i.currentProgram===p&&i.lightsStateVersion===o)return eU(e,c),p}else c.uniforms=f.getUniforms(e),e.onBeforeCompile(c,Q),p=f.acquireProgram(c,h),d.set(h,p),i.uniforms=c.uniforms;let m=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(m.clippingPlanes=A.uniform),eU(e,c),i.needsLights=e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights,i.lightsStateVersion=o,i.needsLights&&(m.ambientLightColor.value=n.state.ambient,m.lightProbe.value=n.state.probe,m.directionalLights.value=n.state.directional,m.directionalLightShadows.value=n.state.directionalShadow,m.spotLights.value=n.state.spot,m.spotLightShadows.value=n.state.spotShadow,m.rectAreaLights.value=n.state.rectArea,m.ltc_1.value=n.state.rectAreaLTC1,m.ltc_2.value=n.state.rectAreaLTC2,m.pointLights.value=n.state.point,m.pointLightShadows.value=n.state.pointShadow,m.hemisphereLights.value=n.state.hemi,m.directionalShadowMap.value=n.state.directionalShadowMap,m.directionalShadowMatrix.value=n.state.directionalShadowMatrix,m.spotShadowMap.value=n.state.spotShadowMap,m.spotLightMatrix.value=n.state.spotLightMatrix,m.spotLightMap.value=n.state.spotLightMap,m.pointShadowMap.value=n.state.pointShadowMap,m.pointShadowMatrix.value=n.state.pointShadowMatrix),i.currentProgram=p,i.uniformsList=null,p}function eO(e){if(null===e.uniformsList){let t=e.currentProgram.getUniforms();e.uniformsList=yT.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function eU(e,t){let r=s.get(e);r.outputColorSpace=t.outputColorSpace,r.batching=t.batching,r.batchingColor=t.batchingColor,r.instancing=t.instancing,r.instancingColor=t.instancingColor,r.instancingMorph=t.instancingMorph,r.skinning=t.skinning,r.morphTargets=t.morphTargets,r.morphNormals=t.morphNormals,r.morphColors=t.morphColors,r.morphTargetsCount=t.morphTargetsCount,r.numClippingPlanes=t.numClippingPlanes,r.numIntersection=t.numClipIntersection,r.vertexAlphas=t.vertexAlphas,r.vertexTangents=t.vertexTangents,r.toneMapping=t.toneMapping}eR.setAnimationLoop(function(e){eT&&eT(e)}),"undefined"!=typeof self&&eR.setContext(self),this.setAnimationLoop=function(e){eT=e,ex.setAnimationLoop(e),null===e?eR.stop():eR.start()},ex.addEventListener("sessionstart",eI),ex.addEventListener("sessionend",eM),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!0===V)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===ex.enabled&&!0===ex.isPresenting&&(!0===ex.cameraAutoUpdate&&ex.updateCamera(t),t=ex.getCamera()),!0===e.isScene&&e.onBeforeRender(Q,e,t,Y),(z=g.get(e,H.length)).init(t),H.push(z),ed.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),eu.setFromProjectionMatrix(ed,iK,t.reversedDepth),eh=this.localClippingEnabled,ec=A.init(this.clippingPlanes,eh),(N=m.get(e,G.length)).init(),G.push(N),!0===ex.enabled&&!0===ex.isPresenting){let e=Q.xr.getDepthSensingMesh();null!==e&&eB(e,t,-1/0,Q.sortObjects)}eB(e,t,0,Q.sortObjects),N.finish(),!0===Q.sortObjects&&N.sort(en,ea),(eg=!1===ex.enabled||!1===ex.isPresenting||!1===ex.hasDepthSensing())&&y.addToRenderList(N,e),this.info.render.frame++,!0===ec&&A.beginShadows();let r=z.state.shadowsArray;v.render(r,e,t),!0===ec&&A.endShadows(),!0===this.info.autoReset&&this.info.reset();let i=N.opaque,n=N.transmissive;if(z.setupLights(),t.isArrayCamera){let r=t.cameras;if(n.length>0)for(let t=0,a=r.length;t<a;t++)eP(i,n,e,r[t]);eg&&y.render(e);for(let t=0,i=r.length;t<i;t++){let i=r[t];eD(N,e,i,i.viewport)}}else n.length>0&&eP(i,n,e,t),eg&&y.render(e),eD(N,e,t);null!==Y&&0===j&&(o.updateMultisampleRenderTarget(Y),o.updateRenderTargetMipmap(Y)),!0===e.isScene&&e.onAfterRender(Q,e,t),S.resetDefaultState(),K=-1,q=null,H.pop(),H.length>0?(z=H[H.length-1],!0===ec&&A.setGlobalState(Q.clippingPlanes,z.state.camera)):z=null,G.pop(),N=G.length>0?G[G.length-1]:null},this.getActiveCubeFace=function(){return W},this.getActiveMipmapLevel=function(){return j},this.getRenderTarget=function(){return Y},this.setRenderTargetTextures=function(e,t,r){let i=s.get(e);i.__autoAllocateDepthBuffer=!1===e.resolveDepthBuffer,!1===i.__autoAllocateDepthBuffer&&(i.__useRenderToTexture=!1),s.get(e.texture).__webglTexture=t,s.get(e.depthTexture).__webglTexture=i.__autoAllocateDepthBuffer?void 0:r,i.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(e,t){let r=s.get(e);r.__webglFramebuffer=t,r.__useDefaultFramebuffer=void 0===t};let eN=ev.createFramebuffer();this.setRenderTarget=function(e,t=0,r=0){Y=e,W=t,j=r;let i=!0,a=null,l=!1,u=!1;if(e){let c=s.get(e);if(void 0!==c.__useDefaultFramebuffer)n.bindFramebuffer(ev.FRAMEBUFFER,null),i=!1;else if(void 0===c.__webglFramebuffer)o.setupRenderTarget(e);else if(c.__hasExternalTextures)o.rebindTextures(e,s.get(e.texture).__webglTexture,s.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){let t=e.depthTexture;if(c.__boundDepthTexture!==t){if(null!==t&&s.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");o.setupDepthRenderbuffer(e)}}let h=e.texture;(h.isData3DTexture||h.isDataArrayTexture||h.isCompressedArrayTexture)&&(u=!0);let d=s.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(a=Array.isArray(d[t])?d[t][r]:d[t],l=!0):a=e.samples>0&&!1===o.useMultisampledRTT(e)?s.get(e).__webglMultisampledFramebuffer:Array.isArray(d)?d[r]:d,X.copy(e.viewport),$.copy(e.scissor),J=e.scissorTest}else X.copy(es).multiplyScalar(ei).floor(),$.copy(eo).multiplyScalar(ei).floor(),J=el;if(0!==r&&(a=eN),n.bindFramebuffer(ev.FRAMEBUFFER,a)&&i&&n.drawBuffers(e,a),n.viewport(X),n.scissor($),n.setScissorTest(J),l){let i=s.get(e.texture);ev.framebufferTexture2D(ev.FRAMEBUFFER,ev.COLOR_ATTACHMENT0,ev.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,r)}else if(u)for(let i=0;i<e.textures.length;i++){let n=s.get(e.textures[i]);ev.framebufferTextureLayer(ev.FRAMEBUFFER,ev.COLOR_ATTACHMENT0+i,n.__webglTexture,r,t)}else if(null!==e&&0!==r){let t=s.get(e.texture);ev.framebufferTexture2D(ev.FRAMEBUFFER,ev.COLOR_ATTACHMENT0,ev.TEXTURE_2D,t.__webglTexture,r)}K=-1},this.readRenderTargetPixels=function(e,t,r,a,o,l,u,c=0){if(!(e&&e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let h=s.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==u&&(h=h[u]),h){n.bindFramebuffer(ev.FRAMEBUFFER,h);try{let n=e.textures[c],s=n.format,u=n.type;if(!i.textureFormatReadable(s)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!i.textureTypeReadable(u)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}t>=0&&t<=e.width-a&&r>=0&&r<=e.height-o&&(e.textures.length>1&&ev.readBuffer(ev.COLOR_ATTACHMENT0+c),ev.readPixels(t,r,a,o,b.convert(s),b.convert(u),l))}finally{let e=null!==Y?s.get(Y).__webglFramebuffer:null;n.bindFramebuffer(ev.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,r,a,o,l,u,c=0){if(!(e&&e.isWebGLRenderTarget))throw Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let h=s.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==u&&(h=h[u]),h){if(t>=0&&t<=e.width-a&&r>=0&&r<=e.height-o){var d;n.bindFramebuffer(ev.FRAMEBUFFER,h);let u=e.textures[c],f=u.format,p=u.type;if(!i.textureFormatReadable(f))throw Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!i.textureTypeReadable(p))throw Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");let m=ev.createBuffer();ev.bindBuffer(ev.PIXEL_PACK_BUFFER,m),ev.bufferData(ev.PIXEL_PACK_BUFFER,l.byteLength,ev.STREAM_READ),e.textures.length>1&&ev.readBuffer(ev.COLOR_ATTACHMENT0+c),ev.readPixels(t,r,a,o,b.convert(f),b.convert(p),0);let g=null!==Y?s.get(Y).__webglFramebuffer:null;n.bindFramebuffer(ev.FRAMEBUFFER,g);let A=ev.fenceSync(ev.SYNC_GPU_COMMANDS_COMPLETE,0);return ev.flush(),await (d=ev,new Promise(function(e,t){setTimeout(function r(){switch(d.clientWaitSync(A,d.SYNC_FLUSH_COMMANDS_BIT,0)){case d.WAIT_FAILED:t();break;case d.TIMEOUT_EXPIRED:setTimeout(r,4);break;default:e()}},4)})),ev.bindBuffer(ev.PIXEL_PACK_BUFFER,m),ev.getBufferSubData(ev.PIXEL_PACK_BUFFER,0,l),ev.deleteBuffer(m),ev.deleteSync(A),l}throw Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e,t=null,r=0){let i=Math.pow(2,-r),a=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i),l=null!==t?t.x:0,u=null!==t?t.y:0;o.setTexture2D(e,0),ev.copyTexSubImage2D(ev.TEXTURE_2D,r,0,0,l,u,a,s),n.unbindTexture()};let ez=ev.createFramebuffer(),eG=ev.createFramebuffer();this.copyTextureToTexture=function(e,t,r=null,i=null,a=0,l=null){let u,c,h,d,f,p,m,g,A,v;null===l&&(0!==a?(np("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),l=a,a=0):l=0);let y=e.isCompressedTexture?e.mipmaps[l]:e.image;if(null!==r)u=r.max.x-r.min.x,c=r.max.y-r.min.y,h=r.isBox3?r.max.z-r.min.z:1,d=r.min.x,f=r.min.y,p=r.isBox3?r.min.z:0;else{let t=Math.pow(2,-a);u=Math.floor(y.width*t),c=Math.floor(y.height*t),h=e.isDataArrayTexture?y.depth:e.isData3DTexture?Math.floor(y.depth*t):1,d=0,f=0,p=0}null!==i?(m=i.x,g=i.y,A=i.z):(m=0,g=0,A=0);let E=b.convert(t.format),x=b.convert(t.type);t.isData3DTexture?(o.setTexture3D(t,0),v=ev.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(o.setTexture2DArray(t,0),v=ev.TEXTURE_2D_ARRAY):(o.setTexture2D(t,0),v=ev.TEXTURE_2D),ev.pixelStorei(ev.UNPACK_FLIP_Y_WEBGL,t.flipY),ev.pixelStorei(ev.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ev.pixelStorei(ev.UNPACK_ALIGNMENT,t.unpackAlignment);let _=ev.getParameter(ev.UNPACK_ROW_LENGTH),S=ev.getParameter(ev.UNPACK_IMAGE_HEIGHT),w=ev.getParameter(ev.UNPACK_SKIP_PIXELS),C=ev.getParameter(ev.UNPACK_SKIP_ROWS),T=ev.getParameter(ev.UNPACK_SKIP_IMAGES);ev.pixelStorei(ev.UNPACK_ROW_LENGTH,y.width),ev.pixelStorei(ev.UNPACK_IMAGE_HEIGHT,y.height),ev.pixelStorei(ev.UNPACK_SKIP_PIXELS,d),ev.pixelStorei(ev.UNPACK_SKIP_ROWS,f),ev.pixelStorei(ev.UNPACK_SKIP_IMAGES,p);let I=e.isDataArrayTexture||e.isData3DTexture,M=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){let r=s.get(e),i=s.get(t),o=s.get(r.__renderTarget),v=s.get(i.__renderTarget);n.bindFramebuffer(ev.READ_FRAMEBUFFER,o.__webglFramebuffer),n.bindFramebuffer(ev.DRAW_FRAMEBUFFER,v.__webglFramebuffer);for(let r=0;r<h;r++)I&&(ev.framebufferTextureLayer(ev.READ_FRAMEBUFFER,ev.COLOR_ATTACHMENT0,s.get(e).__webglTexture,a,p+r),ev.framebufferTextureLayer(ev.DRAW_FRAMEBUFFER,ev.COLOR_ATTACHMENT0,s.get(t).__webglTexture,l,A+r)),ev.blitFramebuffer(d,f,u,c,m,g,u,c,ev.DEPTH_BUFFER_BIT,ev.NEAREST);n.bindFramebuffer(ev.READ_FRAMEBUFFER,null),n.bindFramebuffer(ev.DRAW_FRAMEBUFFER,null)}else if(0!==a||e.isRenderTargetTexture||s.has(e)){let r=s.get(e),i=s.get(t);n.bindFramebuffer(ev.READ_FRAMEBUFFER,ez),n.bindFramebuffer(ev.DRAW_FRAMEBUFFER,eG);for(let e=0;e<h;e++)I?ev.framebufferTextureLayer(ev.READ_FRAMEBUFFER,ev.COLOR_ATTACHMENT0,r.__webglTexture,a,p+e):ev.framebufferTexture2D(ev.READ_FRAMEBUFFER,ev.COLOR_ATTACHMENT0,ev.TEXTURE_2D,r.__webglTexture,a),M?ev.framebufferTextureLayer(ev.DRAW_FRAMEBUFFER,ev.COLOR_ATTACHMENT0,i.__webglTexture,l,A+e):ev.framebufferTexture2D(ev.DRAW_FRAMEBUFFER,ev.COLOR_ATTACHMENT0,ev.TEXTURE_2D,i.__webglTexture,l),0!==a?ev.blitFramebuffer(d,f,u,c,m,g,u,c,ev.COLOR_BUFFER_BIT,ev.NEAREST):M?ev.copyTexSubImage3D(v,l,m,g,A+e,d,f,u,c):ev.copyTexSubImage2D(v,l,m,g,d,f,u,c);n.bindFramebuffer(ev.READ_FRAMEBUFFER,null),n.bindFramebuffer(ev.DRAW_FRAMEBUFFER,null)}else M?e.isDataTexture||e.isData3DTexture?ev.texSubImage3D(v,l,m,g,A,u,c,h,E,x,y.data):t.isCompressedArrayTexture?ev.compressedTexSubImage3D(v,l,m,g,A,u,c,h,E,y.data):ev.texSubImage3D(v,l,m,g,A,u,c,h,E,x,y):e.isDataTexture?ev.texSubImage2D(ev.TEXTURE_2D,l,m,g,u,c,E,x,y.data):e.isCompressedTexture?ev.compressedTexSubImage2D(ev.TEXTURE_2D,l,m,g,y.width,y.height,E,y.data):ev.texSubImage2D(ev.TEXTURE_2D,l,m,g,u,c,E,x,y);ev.pixelStorei(ev.UNPACK_ROW_LENGTH,_),ev.pixelStorei(ev.UNPACK_IMAGE_HEIGHT,S),ev.pixelStorei(ev.UNPACK_SKIP_PIXELS,w),ev.pixelStorei(ev.UNPACK_SKIP_ROWS,C),ev.pixelStorei(ev.UNPACK_SKIP_IMAGES,T),0===l&&t.generateMipmaps&&ev.generateMipmap(v),n.unbindTexture()},this.initRenderTarget=function(e){void 0===s.get(e).__webglFramebuffer&&o.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?o.setTextureCube(e,0):e.isData3DTexture?o.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?o.setTexture2DArray(e,0):o.setTexture2D(e,0),n.unbindTexture()},this.resetState=function(){W=0,j=0,Y=null,n.reset(),S.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return iK}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;let t=this.getContext();t.drawingBufferColorSpace=nA._getDrawingBufferColorSpace(e),t.unpackColorSpace=nA._getUnpackColorSpace()}}var Ec=["primitive"].concat(Object.keys(eO).filter(e=>/^[A-Z]/.test(e)).map(e=>e[0].toLowerCase()+e.slice(1)));mk.assign({createStringInterpolator:gP,colors:{transparent:0,aliceblue:0xf0f8ffff,antiquewhite:0xfaebd7ff,aqua:0xffffff,aquamarine:0x7fffd4ff,azure:0xf0ffffff,beige:0xf5f5dcff,bisque:0xffe4c4ff,black:255,blanchedalmond:0xffebcdff,blue:65535,blueviolet:0x8a2be2ff,brown:0xa52a2aff,burlywood:0xdeb887ff,burntsienna:0xea7e5dff,cadetblue:0x5f9ea0ff,chartreuse:0x7fff00ff,chocolate:0xd2691eff,coral:0xff7f50ff,cornflowerblue:0x6495edff,cornsilk:0xfff8dcff,crimson:0xdc143cff,cyan:0xffffff,darkblue:35839,darkcyan:9145343,darkgoldenrod:0xb8860bff,darkgray:0xa9a9a9ff,darkgreen:6553855,darkgrey:0xa9a9a9ff,darkkhaki:0xbdb76bff,darkmagenta:0x8b008bff,darkolivegreen:0x556b2fff,darkorange:0xff8c00ff,darkorchid:0x9932ccff,darkred:0x8b0000ff,darksalmon:0xe9967aff,darkseagreen:0x8fbc8fff,darkslateblue:0x483d8bff,darkslategray:0x2f4f4fff,darkslategrey:0x2f4f4fff,darkturquoise:0xced1ff,darkviolet:0x9400d3ff,deeppink:0xff1493ff,deepskyblue:0xbfffff,dimgray:0x696969ff,dimgrey:0x696969ff,dodgerblue:0x1e90ffff,firebrick:0xb22222ff,floralwhite:0xfffaf0ff,forestgreen:0x228b22ff,fuchsia:0xff00ffff,gainsboro:0xdcdcdcff,ghostwhite:0xf8f8ffff,gold:0xffd700ff,goldenrod:0xdaa520ff,gray:0x808080ff,green:8388863,greenyellow:0xadff2fff,grey:0x808080ff,honeydew:0xf0fff0ff,hotpink:0xff69b4ff,indianred:0xcd5c5cff,indigo:0x4b0082ff,ivory:0xfffff0ff,khaki:0xf0e68cff,lavender:0xe6e6faff,lavenderblush:0xfff0f5ff,lawngreen:0x7cfc00ff,lemonchiffon:0xfffacdff,lightblue:0xadd8e6ff,lightcoral:0xf08080ff,lightcyan:0xe0ffffff,lightgoldenrodyellow:0xfafad2ff,lightgray:0xd3d3d3ff,lightgreen:0x90ee90ff,lightgrey:0xd3d3d3ff,lightpink:0xffb6c1ff,lightsalmon:0xffa07aff,lightseagreen:0x20b2aaff,lightskyblue:0x87cefaff,lightslategray:0x778899ff,lightslategrey:0x778899ff,lightsteelblue:0xb0c4deff,lightyellow:0xffffe0ff,lime:0xff00ff,limegreen:0x32cd32ff,linen:0xfaf0e6ff,magenta:0xff00ffff,maroon:0x800000ff,mediumaquamarine:0x66cdaaff,mediumblue:52735,mediumorchid:0xba55d3ff,mediumpurple:0x9370dbff,mediumseagreen:0x3cb371ff,mediumslateblue:0x7b68eeff,mediumspringgreen:0xfa9aff,mediumturquoise:0x48d1ccff,mediumvioletred:0xc71585ff,midnightblue:0x191970ff,mintcream:0xf5fffaff,mistyrose:0xffe4e1ff,moccasin:0xffe4b5ff,navajowhite:0xffdeadff,navy:33023,oldlace:0xfdf5e6ff,olive:0x808000ff,olivedrab:0x6b8e23ff,orange:0xffa500ff,orangered:0xff4500ff,orchid:0xda70d6ff,palegoldenrod:0xeee8aaff,palegreen:0x98fb98ff,paleturquoise:0xafeeeeff,palevioletred:0xdb7093ff,papayawhip:0xffefd5ff,peachpuff:0xffdab9ff,peru:0xcd853fff,pink:0xffc0cbff,plum:0xdda0ddff,powderblue:0xb0e0e6ff,purple:0x800080ff,rebeccapurple:0x663399ff,red:0xff0000ff,rosybrown:0xbc8f8fff,royalblue:0x4169e1ff,saddlebrown:0x8b4513ff,salmon:0xfa8072ff,sandybrown:0xf4a460ff,seagreen:0x2e8b57ff,seashell:0xfff5eeff,sienna:0xa0522dff,silver:0xc0c0c0ff,skyblue:0x87ceebff,slateblue:0x6a5acdff,slategray:0x708090ff,slategrey:0x708090ff,snow:0xfffafaff,springgreen:0xff7fff,steelblue:0x4682b4ff,tan:0xd2b48cff,teal:8421631,thistle:0xd8bfd8ff,tomato:0xff6347ff,turquoise:0x40e0d0ff,violet:0xee82eeff,wheat:0xf5deb3ff,white:0xffffffff,whitesmoke:0xf5f5f5ff,yellow:0xffff00ff,yellowgreen:0x9acd32ff},frameLoop:"demand"}),dG(()=>{mA.advance()});var Eh=((e,{applyAnimatedValues:t=()=>!1,createAnimatedStyle:r=e=>new g3(e),getComponentProps:i=e=>e}={})=>{let n={applyAnimatedValues:t,createAnimatedStyle:r,getComponentProps:i},a=e=>{let t=Ae(e)||"Anonymous";return(e=mU.str(e)?a[e]||(a[e]=g8(e,n)):e[g7]||(e[g7]=g8(e,n))).displayName=`Animated(${t})`,e};return mG(e,(t,r)=>{mU.arr(e)&&(r=Ae(t)),a[r]=a(t)}),{animated:a}})(Ec,{applyAnimatedValues:d1}).animated;function Ed({enabled:e=!0,snap:t,global:r,domElement:i,cursor:n=!0,children:a,speed:s=1,rotation:o=[0,0,0],zoom:l=1,polar:u=[0,Math.PI/2],azimuth:c=[-1/0,1/0],config:h={mass:1,tension:170,friction:26}}){let d=dY(e=>e.events),f=dY(e=>e.gl),p=i||d.connected||f.domElement,{size:m}=dY(),g=eN.useMemo(()=>[o[0]+u[0],o[0]+u[1]],[o[0],u[0],u[1]]),A=eN.useMemo(()=>[o[1]+c[0],o[1]+c[1]],[o[1],c[0],c[1]]),v=eN.useMemo(()=>[ne.clamp(o[0],...g),ne.clamp(o[1],...A),o[2]],[o[0],o[1],o[2],g,A]),[y,E]=function(e,t){let r=mU.fun(e),[[i],n]=function(e,t,r){let i=mU.fun(t)&&t;i&&!r&&(r=[]);let n=(0,eN.useMemo)(()=>i||3==arguments.length?A1():void 0,[]),a=(0,eN.useRef)(0),s=gV(),o=(0,eN.useMemo)(()=>({ctrls:[],queue:[],flush(e,t){let r=AK(e,t);return!(a.current>0)||o.queue.length||Object.keys(r).some(t=>!e.springs[t])?new Promise(i=>{Aq(e,r),o.queue.push(()=>{i(Aj(e,t))}),s()}):Aj(e,t)}}),[]),l=(0,eN.useRef)([...o.ctrls]),u=[],c=gY(e)||0;function h(e,r){for(let n=e;n<r;n++){let e=l.current[n]||(l.current[n]=new AW(null,o.flush)),r=i?i(n,e):t[n];r&&(u[n]=function(e){let t=AU(e);return mU.und(t.default)&&(t.default=As(t)),t}(r))}}(0,eN.useMemo)(()=>{mz(l.current.slice(e,c),e=>{e.ref?.delete(e),n?.delete(e),e.stop(!0)}),l.current.length=e,h(c,e)},[e]),(0,eN.useMemo)(()=>{h(0,Math.min(c,e))},r);let d=l.current.map((e,t)=>AK(e,u[t])),f=(0,eN.useContext)(AZ),p=gY(f),m=f!==p&&function(e){for(let t in e)return!0;return!1}(f);gH(()=>{a.current++,o.ctrls=l.current;let{queue:e}=o;e.length&&(o.queue=[],mz(e,e=>e())),mz(l.current,(e,t)=>{var r;n?.add(e),m&&e.start({default:f});let i=u[t];i&&((r=i.ref)&&e.ref!==r&&(e.ref?.delete(e),r.add(e),e.ref=r),e.ref?e.queue.push(i):e.start(i))})}),gW(()=>()=>{mz(o.ctrls,e=>e.stop(!0))});let g=d.map(e=>({...e}));return n?[g,n]:g}(1,r?e:[e],r?t||[]:t);return r||2==arguments.length?[i,n]:i}(()=>({scale:1,rotation:v,config:h}));eN.useEffect(()=>void E.start({scale:1,rotation:v,config:h}),[v]),eN.useEffect(()=>{if(r&&n&&e)return p.style.cursor="grab",f.domElement.style.cursor="",()=>{p.style.cursor="default",f.domElement.style.cursor="default"}},[r,n,p,e]);let x=pg({onHover:({last:t})=>{n&&!r&&e&&(p.style.cursor=t?"auto":"grab")},onDrag:({down:r,delta:[i,a],memo:[o,u]=y.rotation.animation.to||v})=>{if(!e)return[a,i];n&&(p.style.cursor=r?"grabbing":"grab"),i=ne.clamp(u+i/m.width*Math.PI*s,...A),a=ne.clamp(o+a/m.height*Math.PI*s,...g);let c=t&&!r&&"boolean"!=typeof t?t:h;return E.start({scale:r&&a>g[1]/2?l:1,rotation:t&&!r?v:[a,i,0],config:e=>"scale"===e?{...c,friction:3*c.friction}:c}),[a,i]}},{target:r?p:void 0});return eN.createElement(Eh.group,eU({},null==x?void 0:x(),y),a)}let Ef=e=>(t,r,i)=>{let n=i.subscribe;return i.subscribe=(e,t,r)=>{let a=e;if(t){let n=(null==r?void 0:r.equalityFn)||Object.is,s=e(i.getState());a=r=>{let i=e(r);if(!n(s,i)){let e=s;t(s=i,e)}},(null==r?void 0:r.fireImmediately)&&t(s,s)}return n(a)},e(t,r,i)},Ep=eN.createContext(null);function Em({map:e,children:t,onChange:r,domElement:i}){let n=e.map(e=>e.name+e.keys).join("-"),a=eN.useMemo(()=>fc(Ef(()=>e.reduce((e,t)=>({...e,[t.name]:!1}),{}))),[n]),s=eN.useMemo(()=>[a.subscribe,a.getState,a],[n]),o=a.setState;return eN.useEffect(()=>{let t=e.map(({name:e,keys:t,up:i})=>({keys:t,up:i,fn:t=>{o({[e]:t}),r&&r(e,t,s[1]())}})).reduce((e,{keys:t,fn:r,up:i=!0})=>(t.forEach(t=>e[t]={fn:r,pressed:!1,up:i}),e),{}),n=({key:e,code:r})=>{let i=t[e]||t[r];if(!i)return;let{fn:n,pressed:a,up:s}=i;i.pressed=!0,(s||!a)&&n(!0)},a=({key:e,code:r})=>{let i=t[e]||t[r];if(!i)return;let{fn:n,up:a}=i;i.pressed=!1,a&&n(!1)},l=i||window;return l.addEventListener("keydown",n,{passive:!0}),l.addEventListener("keyup",a,{passive:!0}),()=>{l.removeEventListener("keydown",n),l.removeEventListener("keyup",a)}},[i,n]),eN.createElement(Ep.Provider,{value:s,children:t})}function Eg(e){let[t,r,i]=eN.useContext(Ep);return e?i(e):[t,r]}let EA=new oR,Ev=new ni,Ey=new ni,EE=new ni,Ex=new ni,E_=new ni,Eb=new ni,ES=new ni,Ew=new ni,EC=new ni,ET=new ni,EI=new ni,EM=new ni,ER=new ni,EB=new ni;class ED{constructor(e,t,r){this.camera=e,this.scene=t,this.startPoint=new ni,this.endPoint=new ni,this.collection=[],this.deep=r||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(EA,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){Ey.copy(e),Ey.x=Math.min(e.x,t.x),Ey.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),EE.setFromMatrixPosition(this.camera.matrixWorld),Ex.copy(Ey),E_.set(t.x,Ey.y,0),Eb.copy(t),ES.set(Ey.x,t.y,0),Ex.unproject(this.camera),E_.unproject(this.camera),Eb.unproject(this.camera),ES.unproject(this.camera),EM.copy(Ex).sub(EE),ER.copy(E_).sub(EE),EB.copy(Eb).sub(EE),EM.normalize(),ER.normalize(),EB.normalize(),EM.multiplyScalar(this.deep),ER.multiplyScalar(this.deep),EB.multiplyScalar(this.deep),EM.add(EE),ER.add(EE),EB.add(EE);var r=EA.planes;r[0].setFromCoplanarPoints(EE,Ex,E_),r[1].setFromCoplanarPoints(EE,E_,Eb),r[2].setFromCoplanarPoints(Eb,ES,EE),r[3].setFromCoplanarPoints(ES,Ex,EE),r[4].setFromCoplanarPoints(E_,Eb,ES),r[5].setFromCoplanarPoints(EB,ER,EM),r[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){let i=Math.min(e.x,t.x),n=Math.max(e.y,t.y),a=Math.max(e.x,t.x),s=Math.min(e.y,t.y);Ex.set(i,n,-1),E_.set(a,n,-1),Eb.set(a,s,-1),ES.set(i,s,-1),Ew.set(i,n,1),EC.set(a,n,1),ET.set(a,s,1),EI.set(i,s,1),Ex.unproject(this.camera),E_.unproject(this.camera),Eb.unproject(this.camera),ES.unproject(this.camera),Ew.unproject(this.camera),EC.unproject(this.camera),ET.unproject(this.camera),EI.unproject(this.camera);var r=EA.planes;r[0].setFromCoplanarPoints(Ex,Ew,EC),r[1].setFromCoplanarPoints(E_,EC,ET),r[2].setFromCoplanarPoints(ET,EI,ES),r[3].setFromCoplanarPoints(EI,Ew,Ex),r[4].setFromCoplanarPoints(E_,Eb,ES),r[5].setFromCoplanarPoints(ET,EC,Ew),r[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&void 0!==t.material&&(null===t.geometry.boundingSphere&&t.geometry.computeBoundingSphere(),Ev.copy(t.geometry.boundingSphere.center),Ev.applyMatrix4(t.matrixWorld),e.containsPoint(Ev)&&this.collection.push(t)),t.children.length>0)for(let r=0;r<t.children.length;r++)this.searchChildInFrustum(e,t.children[r])}}let EP=e=>Symbol.iterator in e,EL=e=>"entries"in e,Ek=(e,t)=>{let r=e instanceof Map?e:new Map(e.entries()),i=t instanceof Map?t:new Map(t.entries());if(r.size!==i.size)return!1;for(let[e,t]of r)if(!i.has(e)||!Object.is(t,i.get(e)))return!1;return!0},EF=(e,t)=>{let r=e[Symbol.iterator](),i=t[Symbol.iterator](),n=r.next(),a=i.next();for(;!n.done&&!a.done;){if(!Object.is(n.value,a.value))return!1;n=r.next(),a=i.next()}return!!n.done&&!!a.done},EO=eN.createContext([]);function EU({box:e,multiple:t,children:r,onChange:i,onChangePointerUp:n,border:a="1px solid #55aaff",backgroundColor:s="rgba(75, 160, 255, 0.1)",filter:o=e=>e,...l}){let[u,c]=eN.useState(!1),{setEvents:h,camera:d,raycaster:f,gl:p,controls:m,size:g,get:A}=dY(),[v,y]=eN.useState(!1),[E,x]=eN.useReducer((e,{object:t,shift:r})=>void 0===t?[]:Array.isArray(t)?t:r?e.includes(t)?e.filter(e=>e!==t):[t,...e]:e[0]===t?[]:[t],[]);eN.useEffect(()=>{u?null==i||i(E):null==n||n(E)},[E,u]);let _=eN.useCallback(e=>{e.stopPropagation(),x({object:o([e.object])[0],shift:t&&e.shiftKey})},[]),b=eN.useCallback(e=>!v&&x({}),[v]),S=eN.useRef(null);return eN.useEffect(()=>{if(!e||!t)return;let r=new ED(d,S.current),i=document.createElement("div");i.style.pointerEvents="none",i.style.border=a,i.style.backgroundColor=s,i.style.position="fixed";let n=new nt,l=new nt,u=new nt,f=A().events.enabled,v=null==m?void 0:m.enabled,y=!1;function E(e,t){let{offsetX:r,offsetY:i}=e,{width:n,height:a}=g;t.set(r/n*2-1,-(i/a*2)+1)}function _(e){if(e.shiftKey){var t;m&&(m.enabled=!1),h({enabled:!1}),c(y=!0),null==(t=p.domElement.parentElement)||t.appendChild(i),i.style.left=`${e.clientX}px`,i.style.top=`${e.clientY}px`,i.style.width="0px",i.style.height="0px",n.x=e.clientX,n.y=e.clientY,E(e,r.startPoint)}}let b=[];function w(e){if(y){var t;u.x=Math.max(n.x,e.clientX),u.y=Math.max(n.y,e.clientY),l.x=Math.min(n.x,e.clientX),l.y=Math.min(n.y,e.clientY),i.style.left=`${l.x}px`,i.style.top=`${l.y}px`,i.style.width=`${u.x-l.x}px`,i.style.height=`${u.y-l.y}px`,E(e,r.endPoint);let a=r.select().sort(e=>e.uuid).filter(e=>e.isMesh);Object.is(a,t=b)||"object"==typeof a&&null!==a&&"object"==typeof t&&null!==t&&Object.getPrototypeOf(a)===Object.getPrototypeOf(t)&&(EP(a)&&EP(t)?EL(a)&&EL(t)?Ek(a,t):EF(a,t):Ek({entries:()=>Object.entries(a)},{entries:()=>Object.entries(t)}))||(b=a,x({object:o(a)}))}}function C(e){y&&function(){if(y){var e;m&&(m.enabled=v),h({enabled:f}),c(y=!1),null==(e=i.parentElement)||e.removeChild(i)}}()}return document.addEventListener("pointerdown",_,{passive:!0}),document.addEventListener("pointermove",w,{passive:!0,capture:!0}),document.addEventListener("pointerup",C,{passive:!0}),()=>{document.removeEventListener("pointerdown",_),document.removeEventListener("pointermove",w,!0),document.removeEventListener("pointerup",C)}},[g.width,g.height,f,d,m,p]),eN.createElement("group",eU({ref:S,onClick:_,onPointerOver:()=>y(!0),onPointerOut:()=>y(!1),onPointerMissed:b},l),eN.createElement(EO.Provider,{value:E},r))}function EN(){return eN.useContext(EO)}let Ez=eN.forwardRef(function({children:e,follow:t=!0,lockX:r=!1,lockY:i=!1,lockZ:n=!1,...a},s){let o=eN.useRef(null),l=eN.useRef(null),u=new nr;return dK(({camera:e})=>{if(!t||!l.current)return;let a=o.current.rotation.clone();l.current.updateMatrix(),l.current.updateWorldMatrix(!1,!1),l.current.getWorldQuaternion(u),e.getWorldQuaternion(o.current.quaternion).premultiply(u.invert()),r&&(o.current.rotation.x=a.x),i&&(o.current.rotation.y=a.y),n&&(o.current.rotation.z=a.z)}),eN.useImperativeHandle(s,()=>l.current,[]),eN.createElement("group",eU({ref:l},a),eN.createElement("group",{ref:o},e))}),EG=eN.forwardRef(({children:e,depth:t=-1,...r},i)=>{let n=eN.useRef(null);return eN.useImperativeHandle(i,()=>n.current,[]),dK(({camera:e})=>{n.current.quaternion.copy(e.quaternion),n.current.position.copy(e.position)}),eN.createElement("group",eU({ref:n},r),eN.createElement("group",{"position-z":-t},e))}),EH=new ni,EQ=new ni,EV=new ni,EW=(e,t,r)=>{let i=r.width/2,n=r.height/2;t.updateMatrixWorld(!1);let a=e.project(t);return a.x=a.x*i+i,a.y=-(a.y*n)+n,a},Ej=(e,t,r,i=1)=>{let n=EH.set(e.x/r.width*2-1,-(2*(e.y/r.height))+1,i);return n.unproject(t),n},EY=(e,t,r,i)=>{let n=EW(EV.copy(e),r,i),a=0;for(let s=0;s<2;++s){let o=EQ.copy(n).setComponent(s,n.getComponent(s)+t),l=Ej(o,r,i,o.z);a=Math.max(a,e.distanceTo(l))}return a},EK=new ni,Eq=(0,eN.forwardRef)(({scale:e=1,...t},r)=>{let i=(0,eN.useRef)(null);return eN.useImperativeHandle(r,()=>i.current,[]),dK(t=>{let r=i.current;if(!r)return;let n=EY(r.getWorldPosition(EK),e,t.camera,t.size);r.scale.setScalar(n*e)}),eN.createElement("object3D",eU({ref:i},t))}),EX=new nL,E$=new ni;class EJ extends cT{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new se([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new se([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){let t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let r=new hc(t,6,1);return this.setAttribute("instanceStart",new sV(r,3,0)),this.setAttribute("instanceEnd",new sV(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e,t=3){let r;e instanceof Float32Array?r=e:Array.isArray(e)&&(r=new Float32Array(e));let i=new hc(r,2*t,1);return this.setAttribute("instanceColorStart",new sV(i,t,0)),this.setAttribute("instanceColorEnd",new sV(i,t,t)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new ux(e.geometry)),this}fromLineSegments(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new nL);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),EX.setFromBufferAttribute(t),this.boundingBox.union(EX))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new nJ),null===this.boundingBox&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){let r=this.boundingSphere.center;this.boundingBox.getCenter(r);let i=0;for(let n=0,a=e.count;n<a;n++)E$.fromBufferAttribute(e,n),i=Math.max(i,r.distanceToSquared(E$)),E$.fromBufferAttribute(t,n),i=Math.max(i,r.distanceToSquared(E$));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}let EZ=parseInt(eH.replace(/\D+/g,""));class E0 extends sT{constructor(e){super({type:"LineMaterial",uniforms:sC.clone(sC.merge([A7.common,A7.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new nt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${EZ>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(e){!!e!="USE_DASH"in this.defines&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(e){!!e!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}let E1=EZ>=125?"uv1":"uv2",E2=new nT,E3=new ni,E4=new ni,E5=new nT,E6=new nT,E8=new nT,E9=new ni,E7=new n8,xe=new hR,xt=new ni,xr=new nL,xi=new nJ,xn=new nT;function xa(e,t,r){return xn.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),xn.multiplyScalar(1/xn.w),xn.x=d/r.width,xn.y=d/r.height,xn.applyMatrix4(e.projectionMatrixInverse),xn.multiplyScalar(1/xn.w),Math.abs(Math.max(xn.x,xn.y))}class xs extends sE{constructor(e=new EJ,t=new E0({color:0xffffff*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let e=0,n=0,a=t.count;e<a;e++,n+=2)E3.fromBufferAttribute(t,e),E4.fromBufferAttribute(r,e),i[n]=0===n?0:i[n-1],i[n+1]=i[n]+E3.distanceTo(E4);let n=new hc(i,2,1);return e.setAttribute("instanceDistanceStart",new sV(n,1,0)),e.setAttribute("instanceDistanceEnd",new sV(n,1,1)),this}raycast(e,t){let r,i;let n=this.material.worldUnits,a=e.camera;null!==a||n||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');let s=void 0!==e.params.Line2&&e.params.Line2.threshold||0;h=e.ray;let o=this.matrixWorld,l=this.geometry,u=this.material;if(d=u.linewidth+s,null===l.boundingSphere&&l.computeBoundingSphere(),xi.copy(l.boundingSphere).applyMatrix4(o),n)r=.5*d;else{let e=Math.max(a.near,xi.distanceToPoint(h.origin));r=xa(a,e,u.resolution)}if(xi.radius+=r,!1!==h.intersectsSphere(xi)){if(null===l.boundingBox&&l.computeBoundingBox(),xr.copy(l.boundingBox).applyMatrix4(o),n)i=.5*d;else{let e=Math.max(a.near,xr.distanceToPoint(h.origin));i=xa(a,e,u.resolution)}xr.expandByScalar(i),!1!==h.intersectsBox(xr)&&(n?function(e,t){let r=e.matrixWorld,i=e.geometry,n=i.attributes.instanceStart,a=i.attributes.instanceEnd,s=Math.min(i.instanceCount,n.count);for(let i=0;i<s;i++){xe.start.fromBufferAttribute(n,i),xe.end.fromBufferAttribute(a,i),xe.applyMatrix4(r);let s=new ni,o=new ni;h.distanceSqToSegment(xe.start,xe.end,o,s),o.distanceTo(s)<.5*d&&t.push({point:o,pointOnLine:s,distance:h.origin.distanceTo(o),object:e,face:null,faceIndex:i,uv:null,[E1]:null})}}(this,t):function(e,t,r){let i=t.projectionMatrix,n=e.material.resolution,a=e.matrixWorld,s=e.geometry,o=s.attributes.instanceStart,l=s.attributes.instanceEnd,u=Math.min(s.instanceCount,o.count),c=-t.near;h.at(1,E8),E8.w=1,E8.applyMatrix4(t.matrixWorldInverse),E8.applyMatrix4(i),E8.multiplyScalar(1/E8.w),E8.x*=n.x/2,E8.y*=n.y/2,E8.z=0,E9.copy(E8),E7.multiplyMatrices(t.matrixWorldInverse,a);for(let t=0;t<u;t++){if(E5.fromBufferAttribute(o,t),E6.fromBufferAttribute(l,t),E5.w=1,E6.w=1,E5.applyMatrix4(E7),E6.applyMatrix4(E7),E5.z>c&&E6.z>c)continue;if(E5.z>c){let e=E5.z-E6.z,t=(E5.z-c)/e;E5.lerp(E6,t)}else if(E6.z>c){let e=E6.z-E5.z,t=(E6.z-c)/e;E6.lerp(E5,t)}E5.applyMatrix4(i),E6.applyMatrix4(i),E5.multiplyScalar(1/E5.w),E6.multiplyScalar(1/E6.w),E5.x*=n.x/2,E5.y*=n.y/2,E6.x*=n.x/2,E6.y*=n.y/2,xe.start.copy(E5),xe.start.z=0,xe.end.copy(E6),xe.end.z=0;let s=xe.closestPointToPointParameter(E9,!0);xe.at(s,xt);let u=ne.lerp(E5.z,E6.z,s),f=u>=-1&&u<=1,p=E9.distanceTo(xt)<.5*d;if(f&&p){xe.start.fromBufferAttribute(o,t),xe.end.fromBufferAttribute(l,t),xe.start.applyMatrix4(a),xe.end.applyMatrix4(a);let i=new ni,n=new ni;h.distanceSqToSegment(xe.start,xe.end,n,i),r.push({point:n,pointOnLine:i,distance:h.origin.distanceTo(n),object:e,face:null,faceIndex:t,uv:null,[E1]:null})}}}(this,a,t))}}onBeforeRender(e){let t=this.material.uniforms;t&&t.resolution&&(e.getViewport(E2),this.material.uniforms.resolution.value.set(E2.z,E2.w))}}class xo extends EJ{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){let t=e.length-3,r=new Float32Array(2*t);for(let i=0;i<t;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return super.setPositions(r),this}setColors(e,t=3){let r=e.length-t,i=new Float32Array(2*r);if(3===t)for(let n=0;n<r;n+=t)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];else for(let n=0;n<r;n+=t)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5],i[2*n+6]=e[n+6],i[2*n+7]=e[n+7];return super.setColors(i,t),this}fromLine(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class xl extends xs{constructor(e=new xo,t=new E0({color:0xffffff*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}let xu=eN.forwardRef(function({points:e,color:t=0xffffff,vertexColors:r,linewidth:i,lineWidth:n,segments:a,dashed:s,...o},l){var u,c;let h=dY(e=>e.size),d=eN.useMemo(()=>a?new xs:new xl,[a]),[f]=eN.useState(()=>new E0),p=(null==r||null==(u=r[0])?void 0:u.length)===4?4:3,m=eN.useMemo(()=>{let i=a?new EJ:new xo,n=e.map(e=>{let t=Array.isArray(e);return e instanceof ni||e instanceof nT?[e.x,e.y,e.z]:e instanceof nt?[e.x,e.y,0]:t&&3===e.length?[e[0],e[1],e[2]]:t&&2===e.length?[e[0],e[1],0]:e});if(i.setPositions(n.flat()),r){t=0xffffff;let e=r.map(e=>e instanceof aQ?e.toArray():e);i.setColors(e.flat(),p)}return i},[e,a,r,p]);return eN.useLayoutEffect(()=>{d.computeLineDistances()},[e,d]),eN.useLayoutEffect(()=>{s?f.defines.USE_DASH="":delete f.defines.USE_DASH,f.needsUpdate=!0},[s,f]),eN.useEffect(()=>()=>{m.dispose(),f.dispose()},[m]),eN.createElement("primitive",eU({object:d,ref:l},o),eN.createElement("primitive",{object:m,attach:"geometry"}),eN.createElement("primitive",eU({object:f,attach:"material",color:t,vertexColors:!!r,resolution:[h.width,h.height],linewidth:null!==(c=null!=i?i:n)&&void 0!==c?c:1,dashed:s,transparent:4===p},o)))}),xc=new ni,xh=eN.forwardRef(function({start:e=[0,0,0],end:t=[0,0,0],mid:r,segments:i=20,...n},a){let s=eN.useRef(null);eN.useImperativeHandle(a,()=>s.current);let[o]=eN.useState(()=>new lj(void 0,void 0,void 0)),l=eN.useCallback((e,t,r,i=20)=>(e instanceof ni?o.v0.copy(e):o.v0.set(...e),t instanceof ni?o.v2.copy(t):o.v2.set(...t),r instanceof ni?o.v1.copy(r):Array.isArray(r)?o.v1.set(...r):o.v1.copy(o.v0.clone().add(o.v2.clone().sub(o.v0)).add(xc.set(0,o.v0.y-o.v2.y,0))),o.getPoints(i)),[]);eN.useLayoutEffect(()=>{s.current.setPoints=(e,t,r)=>{let i=l(e,t,r);s.current.geometry&&s.current.geometry.setPositions(i.map(e=>e.toArray()).flat())}},[]);let u=eN.useMemo(()=>l(e,t,r,i),[e,t,r,i]);return eN.createElement(xu,eU({ref:s,points:u},n))}),xd=eN.forwardRef(function({start:e,end:t,midA:r,midB:i,segments:n=20,...a},s){let o=eN.useMemo(()=>{let a=e instanceof ni?e:new ni(...e),s=t instanceof ni?t:new ni(...t);return new lH(a,r instanceof ni?r:new ni(...r),i instanceof ni?i:new ni(...i),s).getPoints(n)},[e,t,r,i,n]);return eN.createElement(xu,eU({ref:s,points:o},a))}),xf=eN.forwardRef(function({points:e,closed:t=!1,curveType:r="centripetal",tension:i=.5,segments:n=20,vertexColors:a,...s},o){let l=eN.useMemo(()=>new lO(e.map(e=>e instanceof ni?e:new ni(...e)),t,r,i),[e,t,r,i]),u=eN.useMemo(()=>l.getPoints(n),[l,n]),c=eN.useMemo(()=>{if(!a||a.length<2)return;if(a.length===n+1)return a;let e=a.map(e=>e instanceof aQ?e:new aQ(...e));t&&e.push(e[0].clone());let r=[e[0]],i=n/(e.length-1);for(let t=1;t<n;t++){let n=t%i/i,a=Math.floor(t/i);r.push(e[a].clone().lerp(e[a+1],n))}return r.push(e[e.length-1]),r},[a,n]);return eN.createElement(xu,eU({ref:o,points:u,vertexColors:c},s))}),xp=eN.forwardRef(({url:e,distance:t=1,loop:r=!0,autoplay:i,...n},a)=>{let s=eN.useRef(null);eN.useImperativeHandle(a,()=>s.current,[]);let o=dY(({camera:e})=>e),[l]=eN.useState(()=>new cK),u=d$(cF,e);return eN.useEffect(()=>{let e=s.current;e&&(e.setBuffer(u),e.setRefDistance(t),e.setLoop(r),i&&!e.isPlaying&&e.play())},[u,o,t,r]),eN.useEffect(()=>{let e=s.current;return o.add(l),()=>{o.remove(l),e&&(e.isPlaying&&e.stop(),e.source&&e.source._connected&&e.disconnect())}},[]),eN.createElement("positionalAudio",eU({ref:s,args:[l]},n))});function xm(){var e=Object.create(null);function t(e,t){var r=void 0;self.troikaDefine=function(e){return r=e};var i=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(i)}catch(e){console.error(e)}return URL.revokeObjectURL(i),delete self.troikaDefine,r}self.addEventListener("message",function(r){var i=r.data,n=i.messageId,a=i.action,s=i.data;try{"registerModule"===a&&function r(i,n){var a=i.id,s=i.name,o=i.dependencies;void 0===o&&(o=[]);var l=i.init;void 0===l&&(l=function(){});var u=i.getTransferables;if(void 0===u&&(u=null),!e[a])try{o=o.map(function(t){return t&&t.isWorkerModule&&(r(t,function(e){if(e instanceof Error)throw e}),t=e[t.id].value),t}),l=t("<"+s+">.init",l),u&&(u=t("<"+s+">.getTransferables",u));var c=null;"function"==typeof l?c=l.apply(void 0,o):console.error("worker module init function failed to rehydrate"),e[a]={id:a,value:c,getTransferables:u},n(c)}catch(e){e&&e.noLog||console.error(e),n(e)}}(s,function(e){e instanceof Error?postMessage({messageId:n,success:!1,error:e.message}):postMessage({messageId:n,success:!0,result:{isCallable:"function"==typeof e}})}),"callModule"===a&&function(t,r){var i,n=t.id,a=t.args;e[n]&&"function"==typeof e[n].value||r(Error("Worker module "+n+": not found or its 'init' did not return a function"));try{var s=(i=e[n]).value.apply(i,a);s&&"function"==typeof s.then?s.then(o,function(e){return r(e instanceof Error?e:Error(""+e))}):o(s)}catch(e){r(e)}function o(t){try{var i=e[n].getTransferables&&e[n].getTransferables(t);i&&Array.isArray(i)&&i.length||(i=void 0),r(t,i)}catch(e){console.error(e),r(e)}}}(s,function(e,t){e instanceof Error?postMessage({messageId:n,success:!1,error:e.message}):postMessage({messageId:n,success:!0,result:e},t||void 0)})}catch(e){postMessage({messageId:n,success:!1,error:e.stack})}})}var xg=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+e.message+"]")}return xg=function(){return e},e},xA=0,xv=0,xy=!1,xE=Object.create(null),xx=Object.create(null),x_=Object.create(null);function xb(e){if((!e||"function"!=typeof e.init)&&!xy)throw Error("requires `options.init` function");var t,r=e.dependencies,i=e.init,n=e.getTransferables,a=e.workerId,s=((t=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return t._getInitResult().then(function(t){if("function"==typeof t)return t.apply(void 0,e);throw Error("Worker module function was called but `init` did not return a callable function")})})._getInitResult=function(){var r=e.dependencies,i=e.init,n=Promise.all(r=Array.isArray(r)?r.map(function(e){return e&&(e=e.onMainThread||e)._getInitResult&&(e=e._getInitResult()),e}):[]).then(function(e){return i.apply(null,e)});return t._getInitResult=function(){return n},n},t);null==a&&(a="#default");var o="workerModule"+ ++xA,l=e.name||o,u=null;function c(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!xg())return s.apply(void 0,e);if(!u){u=xw(a,"registerModule",c.workerModuleData);var r=function(){u=null,xx[a].delete(r)};(xx[a]||(xx[a]=new Set)).add(r)}return u.then(function(t){if(t.isCallable)return xw(a,"callModule",{id:o,args:e});throw Error("Worker module function was called but `init` did not return a callable function")})}return r=r&&r.map(function(e){return"function"!=typeof e||e.workerModuleData||(xy=!0,e=xb({workerId:a,name:"<"+l+"> function dependency: "+e.name,init:"function(){return (\n"+xS(e)+"\n)}"}),xy=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e}),c.workerModuleData={isWorkerModule:!0,id:o,name:l,dependencies:r,init:xS(i),getTransferables:n&&xS(n)},c.onMainThread=s,c}function xS(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function xw(e,t,r){return new Promise(function(i,n){var a=++xv;x_[a]=function(e){e.success?i(e.result):n(Error("Error in worker "+t+" call: "+e.error))},(function(e){var t=xE[e];if(!t){var r=xS(xm);(t=xE[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,r=t.messageId,i=x_[r];if(!i)throw Error("WorkerModule response with empty or unknown messageId");delete x_[r],i(t)}}return t})(e).postMessage({messageId:a,action:t,data:r})})}function xC(){return function(e){function t(e,t){for(var r,i,n,a,s,o=/([MLQCZ])([^MLQCZ]*)/g;r=o.exec(e);){var l=r[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(e){return parseFloat(e)});switch(r[1]){case"M":a=i=l[0],s=n=l[1];break;case"L":(l[0]!==a||l[1]!==s)&&t("L",a,s,a=l[0],s=l[1]);break;case"Q":t("Q",a,s,a=l[2],s=l[3],l[0],l[1]);break;case"C":t("C",a,s,a=l[4],s=l[5],l[0],l[1],l[2],l[3]);break;case"Z":(a!==i||s!==n)&&t("L",a,s,i,n)}}}function r(e,r,i){void 0===i&&(i=16);var n={x:0,y:0};t(e,function(e,t,a,s,o,l,u,c,h){switch(e){case"L":r(t,a,s,o);break;case"Q":for(var d=t,f=a,p=1;p<i;p++)(function(e,t,r,i,n,a,s,o){var l=1-s;o.x=l*l*e+2*l*s*r+s*s*n,o.y=l*l*t+2*l*s*i+s*s*a})(t,a,l,u,s,o,p/(i-1),n),r(d,f,n.x,n.y),d=n.x,f=n.y;break;case"C":for(var m=t,g=a,A=1;A<i;A++)(function(e,t,r,i,n,a,s,o,l,u){var c=1-l;u.x=c*c*c*e+3*c*c*l*r+3*c*l*l*n+l*l*l*s,u.y=c*c*c*t+3*c*c*l*i+3*c*l*l*a+l*l*l*o})(t,a,l,u,c,h,s,o,A/(i-1),n),r(m,g,n.x,n.y),m=n.x,g=n.y}})}var i="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",n=new WeakMap,a={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(e,t){var r=e.getContext?e.getContext("webgl",a):e,i=n.get(r);if(!i){var s="undefined"!=typeof WebGL2RenderingContext&&r instanceof WebGL2RenderingContext,o={},l={},u={},c=-1,h=[];function d(e){var t=o[e];if(!t&&!(t=o[e]=r.getExtension(e)))throw Error(e+" not supported");return t}function f(e,t){var i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function p(){o={},l={},u={},c=-1,h.length=0}r.canvas.addEventListener("webglcontextlost",function(e){p(),e.preventDefault()},!1),n.set(r,i={gl:r,isWebGL2:s,getExtension:d,withProgram:function(e,t,i,n){if(!l[e]){var a={},o={},u=r.createProgram();r.attachShader(u,f(t,r.VERTEX_SHADER)),r.attachShader(u,f(i,r.FRAGMENT_SHADER)),r.linkProgram(u),l[e]={program:u,transaction:function(e){r.useProgram(u),e({setUniform:function(e,t){for(var i=[],n=arguments.length-2;n-- >0;)i[n]=arguments[n+2];var a=o[t]||(o[t]=r.getUniformLocation(u,t));r["uniform"+e].apply(r,[a].concat(i))},setAttribute:function(e,t,i,n,o){var l=a[e];l||(l=a[e]={buf:r.createBuffer(),loc:r.getAttribLocation(u,e),data:null}),r.bindBuffer(r.ARRAY_BUFFER,l.buf),r.vertexAttribPointer(l.loc,t,r.FLOAT,!1,0,0),r.enableVertexAttribArray(l.loc),s?r.vertexAttribDivisor(l.loc,n):d("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,n),o!==l.data&&(r.bufferData(r.ARRAY_BUFFER,o,i),l.data=o)}})}}}l[e].transaction(n)},withTexture:function(e,t){c++;try{r.activeTexture(r.TEXTURE0+c);var i=u[e];i||(i=u[e]=r.createTexture(),r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.bindTexture(r.TEXTURE_2D,i),t(i,c)}finally{c--}},withTextureFramebuffer:function(e,t,i){var n=r.createFramebuffer();h.push(n),r.bindFramebuffer(r.FRAMEBUFFER,n),r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);try{i(n)}finally{r.deleteFramebuffer(n),r.bindFramebuffer(r.FRAMEBUFFER,h[--h.length-1]||null)}},handleContextLoss:p})}t(i)}function o(e,t,r,n,a,o,l,u){void 0===l&&(l=15),void 0===u&&(u=null),s(e,function(e){var s=e.gl,c=e.withProgram;(0,e.withTexture)("copy",function(e,h){s.texImage2D(s.TEXTURE_2D,0,s.RGBA,a,o,0,s.RGBA,s.UNSIGNED_BYTE,t),c("copy",i,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,s.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",h),s.bindFramebuffer(s.FRAMEBUFFER,u||null),s.disable(s.BLEND),s.colorMask(8&l,4&l,2&l,1&l),s.viewport(r,n,a,o),s.scissor(r,n,a,o),s.drawArrays(s.TRIANGLES,0,3)})})})}var l=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:o,resizeWebGLCanvasWithoutClearing:function(e,t,r){var i=e.width,n=e.height;s(e,function(a){var s=a.gl,l=new Uint8Array(i*n*4);s.readPixels(0,0,i,n,s.RGBA,s.UNSIGNED_BYTE,l),e.width=t,e.height=r,o(s,l,0,0,i,n)})}});function u(e,t,i,n,a,s){void 0===s&&(s=1);var o=new Uint8Array(e*t),l=n[2]-n[0],u=n[3]-n[1],c=[];r(i,function(e,t,r,i){c.push({x1:e,y1:t,x2:r,y2:i,minX:Math.min(e,r),minY:Math.min(t,i),maxX:Math.max(e,r),maxY:Math.max(t,i)})}),c.sort(function(e,t){return e.maxX-t.maxX});for(var h=0;h<e;h++)for(var d=0;d<t;d++){var f=function(e,t){for(var r=1/0,i=1/0,n=c.length;n--;){var a=c[n];if(a.maxX+i<=e)break;if(e+i>a.minX&&t-i<a.maxY&&t+i>a.minY){var s=function(e,t,r,i,n,a){var s=n-r,o=a-i,l=s*s+o*o,u=l?Math.max(0,Math.min(1,((e-r)*s+(t-i)*o)/l)):0,c=e-(r+u*s),h=t-(i+u*o);return c*c+h*h}(e,t,a.x1,a.y1,a.x2,a.y2);s<r&&(i=Math.sqrt(r=s))}}return function(e,t){for(var r=0,i=c.length;i--;){var n=c[i];if(n.maxX<=e)break;n.y1>t!=n.y2>t&&e<(n.x2-n.x1)*(t-n.y1)/(n.y2-n.y1)+n.x1&&(r+=n.y1<n.y2?1:-1)}return 0!==r}(e,t)&&(i=-i),i}(n[0]+l*(h+.5)/e,n[1]+u*(d+.5)/t),p=Math.pow(1-Math.abs(f)/a,s)/2;f<0&&(p=1-p),p=Math.max(0,Math.min(255,Math.round(255*p))),o[d*e+h]=p}return o}function c(e,t,r,i,n,a,s,o,l,u){void 0===a&&(a=1),void 0===o&&(o=0),void 0===l&&(l=0),void 0===u&&(u=0),h(e,t,r,i,n,a,s,null,o,l,u)}function h(e,t,r,i,n,a,s,l,c,h,d){void 0===a&&(a=1),void 0===c&&(c=0),void 0===h&&(h=0),void 0===d&&(d=0);for(var f=u(e,t,r,i,n,a),p=new Uint8Array(4*f.length),m=0;m<f.length;m++)p[4*m+d]=f[m];o(s,p,c,h,e,t,1<<3-d,l)}var d=Object.freeze({__proto__:null,generate:u,generateIntoCanvas:c,generateIntoFramebuffer:h}),f=new Float32Array([0,0,2,0,0,2]),p=null,m=!1,g={},A=new WeakMap;function v(e){if(!m&&!_(e))throw Error("WebGL generation not supported")}function y(e,t,r,i,n,a,o){if(void 0===a&&(a=1),void 0===o&&(o=null),!o&&!(o=p)){var l="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!l)throw Error("OffscreenCanvas or DOM canvas not supported");o=p=l.getContext("webgl",{depth:!1})}v(o);var u=new Uint8Array(e*t*4);s(o,function(s){var o=s.gl,l=s.withTexture,c=s.withTextureFramebuffer;l("readable",function(s,l){o.texImage2D(o.TEXTURE_2D,0,o.RGBA,e,t,0,o.RGBA,o.UNSIGNED_BYTE,null),c(s,l,function(s){x(e,t,r,i,n,a,o,s,0,0,0),o.readPixels(0,0,e,t,o.RGBA,o.UNSIGNED_BYTE,u)})})});for(var c=new Uint8Array(e*t),h=0,d=0;h<u.length;h+=4)c[d++]=u[h];return c}function E(e,t,r,i,n,a,s,o,l,u){void 0===a&&(a=1),void 0===o&&(o=0),void 0===l&&(l=0),void 0===u&&(u=0),x(e,t,r,i,n,a,s,null,o,l,u)}function x(e,t,n,a,o,l,u,c,h,d,p){void 0===l&&(l=1),void 0===h&&(h=0),void 0===d&&(d=0),void 0===p&&(p=0),v(u);var m=[];r(n,function(e,t,r,i){m.push(e,t,r,i)}),m=new Float32Array(m),s(u,function(r){var n=r.gl,s=r.isWebGL2,u=r.getExtension,g=r.withProgram,A=r.withTexture,v=r.withTextureFramebuffer,y=r.handleContextLoss;if(A("rawDistances",function(r,A){(e!==r._lastWidth||t!==r._lastHeight)&&n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r._lastWidth=e,r._lastHeight=t,0,n.RGBA,n.UNSIGNED_BYTE,null),g("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",function(i){var c=i.setAttribute,h=i.setUniform,d=!s&&u("ANGLE_instanced_arrays"),p=!s&&u("EXT_blend_minmax");c("aUV",2,n.STATIC_DRAW,0,f),c("aLineSegment",4,n.DYNAMIC_DRAW,1,m),h.apply(void 0,["4f","uGlyphBounds"].concat(a)),h("1f","uMaxDistance",o),h("1f","uExponent",l),v(r,A,function(r){n.enable(n.BLEND),n.colorMask(!0,!0,!0,!0),n.viewport(0,0,e,t),n.scissor(0,0,e,t),n.blendFunc(n.ONE,n.ONE),n.blendEquationSeparate(n.FUNC_ADD,s?n.MAX:p.MAX_EXT),n.clear(n.COLOR_BUFFER_BIT),s?n.drawArraysInstanced(n.TRIANGLES,0,3,m.length/4):d.drawArraysInstancedANGLE(n.TRIANGLES,0,3,m.length/4)})}),g("post",i,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",function(r){r.setAttribute("aUV",2,n.STATIC_DRAW,0,f),r.setUniform("1i","tex",A),n.bindFramebuffer(n.FRAMEBUFFER,c),n.disable(n.BLEND),n.colorMask(0===p,1===p,2===p,3===p),n.viewport(h,d,e,t),n.scissor(h,d,e,t),n.drawArrays(n.TRIANGLES,0,3)})}),n.isContextLost())throw y(),Error("webgl context lost")})}function _(e){var t=e&&e!==p?e.canvas||e:g,r=A.get(t);if(void 0===r){m=!0;var i=null;try{var n=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],a=y(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);(r=a&&n.length===a.length&&a.every(function(e,t){return e===n[t]}))||(i="bad trial run results",console.info(n,a))}catch(e){r=!1,i=e.message}i&&console.warn("WebGL SDF generation not supported:",i),m=!1,A.set(t,r)}return r}var b=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:E,generateIntoFramebuffer:x,isSupported:_});return e.forEachPathCommand=t,e.generate=function(e,t,r,i,n,a){void 0===n&&(n=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===a&&(a=1);try{return y.apply(b,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),u.apply(d,arguments)}},e.generateIntoCanvas=function(e,t,r,i,n,a,s,o,l,u){void 0===n&&(n=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===a&&(a=1),void 0===o&&(o=0),void 0===l&&(l=0),void 0===u&&(u=0);try{return E.apply(b,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),c.apply(d,arguments)}},e.javascript=d,e.pathToLineSegments=r,e.webgl=b,e.webglUtils=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}let xT=/\bvoid\s+main\s*\(\s*\)\s*{/g;function xI(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){let r=A9[t];return r?xI(r):e})}let xM=[];for(let e=0;e<256;e++)xM[e]=(e<16?"0":"")+e.toString(16);let xR=Object.assign||function(){let e=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let r=arguments[t];if(r)for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},xB=Date.now(),xD=new WeakMap,xP=new Map,xL=1e10;function xk(e,t,r,i,n){return(i||n||r)&&(e=e.replace(xT,`
${r}
void troikaOrigMain${t}() {`)+`
void main() {
  ${i}
  troikaOrigMain${t}();
  ${n}
}`),e}function xF(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}let xO=0,xU=new Map,xN=xb({name:"Typr Font Parser",dependencies:[function(){var e,t,r;return"undefined"==typeof window&&(self.window=self),(e={},(t={parse:function(e){var r=t._bin,i=new Uint8Array(e);if("ttcf"==r.readASCII(i,0,4)){var n=4;r.readUshort(i,n),n+=2,r.readUshort(i,n),n+=2;var a=r.readUint(i,n);n+=4;for(var s=[],o=0;o<a;o++){var l=r.readUint(i,n);n+=4,s.push(t._readFont(i,l))}return s}return[t._readFont(i,0)]},_readFont:function(e,r){var i=t._bin,n=r;i.readFixed(e,r),r+=4;var a=i.readUshort(e,r);r+=2,i.readUshort(e,r),r+=2,i.readUshort(e,r),r+=2,i.readUshort(e,r),r+=2;for(var s=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],o={_data:e,_offset:n},l={},u=0;u<a;u++){var c=i.readASCII(e,r,4);r+=4,i.readUint(e,r),r+=4;var h=i.readUint(e,r);r+=4;var d=i.readUint(e,r);r+=4,l[c]={offset:h,length:d}}for(u=0;u<s.length;u++){var f=s[u];l[f]&&(o[f.trim()]=t[f.trim()].parse(e,l[f].offset,l[f].length,o))}return o},_tabOffset:function(e,r,i){for(var n=t._bin,a=n.readUshort(e,i+4),s=i+12,o=0;o<a;o++){var l=n.readASCII(e,s,4);s+=4,n.readUint(e,s),s+=4;var u=n.readUint(e,s);if(s+=4,n.readUint(e,s),s+=4,l==r)return u}return 0}})._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,r){return t._bin.readShort(e,r)/16384},readInt:function(e,r){return t._bin._view(e).getInt32(r)},readInt8:function(e,r){return t._bin._view(e).getInt8(r)},readShort:function(e,r){return t._bin._view(e).getInt16(r)},readUshort:function(e,r){return t._bin._view(e).getUint16(r)},readUshorts:function(e,r,i){for(var n=[],a=0;a<i;a++)n.push(t._bin.readUshort(e,r+2*a));return n},readUint:function(e,r){return t._bin._view(e).getUint32(r)},readUint64:function(e,r){return 0x100000000*t._bin.readUint(e,r)+t._bin.readUint(e,r+4)},readASCII:function(e,t,r){for(var i="",n=0;n<r;n++)i+=String.fromCharCode(e[t+n]);return i},readUnicode:function(e,t,r){for(var i="",n=0;n<r;n++)i+=String.fromCharCode(e[t++]<<8|e[t++]);return i},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,r,i){var n=t._bin._tdec;return n&&0==r&&i==e.length?n.decode(e):t._bin.readASCII(e,r,i)},readBytes:function(e,t,r){for(var i=[],n=0;n<r;n++)i.push(e[t+n]);return i},readASCIIArray:function(e,t,r){for(var i=[],n=0;n<r;n++)i.push(String.fromCharCode(e[t+n]));return i},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,r,i,n,a){var s=t._bin,o={},l=r;s.readFixed(e,r),r+=4;var u=s.readUshort(e,r);r+=2;var c=s.readUshort(e,r);r+=2;var h=s.readUshort(e,r);return r+=2,o.scriptList=t._lctf.readScriptList(e,l+u),o.featureList=t._lctf.readFeatureList(e,l+c),o.lookupList=t._lctf.readLookupList(e,l+h,a),o},t._lctf.readLookupList=function(e,r,i){var n=t._bin,a=r,s=[],o=n.readUshort(e,r);r+=2;for(var l=0;l<o;l++){var u=n.readUshort(e,r);r+=2;var c=t._lctf.readLookupTable(e,a+u,i);s.push(c)}return s},t._lctf.readLookupTable=function(e,r,i){var n=t._bin,a=r,s={tabs:[]};s.ltype=n.readUshort(e,r),r+=2,s.flag=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2;for(var l=s.ltype,u=0;u<o;u++){var c=n.readUshort(e,r);r+=2;var h=i(e,l,a+c,s);s.tabs.push(h)}return s},t._lctf.numOfOnes=function(e){for(var t=0,r=0;r<32;r++)0!=(e>>>r&1)&&t++;return t},t._lctf.readClassDef=function(e,r){var i=t._bin,n=[],a=i.readUshort(e,r);if(r+=2,1==a){var s=i.readUshort(e,r);r+=2;var o=i.readUshort(e,r);r+=2;for(var l=0;l<o;l++)n.push(s+l),n.push(s+l),n.push(i.readUshort(e,r)),r+=2}if(2==a){var u=i.readUshort(e,r);for(r+=2,l=0;l<u;l++)n.push(i.readUshort(e,r)),r+=2,n.push(i.readUshort(e,r)),r+=2,n.push(i.readUshort(e,r)),r+=2}return n},t._lctf.getInterval=function(e,t){for(var r=0;r<e.length;r+=3){var i=e[r],n=e[r+1];if(e[r+2],i<=t&&t<=n)return r}return -1},t._lctf.readCoverage=function(e,r){var i=t._bin,n={};n.fmt=i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);return r+=2,1==n.fmt&&(n.tab=i.readUshorts(e,r,a)),2==n.fmt&&(n.tab=i.readUshorts(e,r,3*a)),n},t._lctf.coverageIndex=function(e,r){var i=e.tab;if(1==e.fmt)return i.indexOf(r);if(2==e.fmt){var n=t._lctf.getInterval(i,r);if(-1!=n)return i[n+2]+(r-i[n])}return -1},t._lctf.readFeatureList=function(e,r){var i=t._bin,n=r,a=[],s=i.readUshort(e,r);r+=2;for(var o=0;o<s;o++){var l=i.readASCII(e,r,4);r+=4;var u=i.readUshort(e,r);r+=2;var c=t._lctf.readFeatureTable(e,n+u);c.tag=l.trim(),a.push(c)}return a},t._lctf.readFeatureTable=function(e,r){var i=t._bin,n=r,a={},s=i.readUshort(e,r);r+=2,s>0&&(a.featureParams=n+s);var o=i.readUshort(e,r);r+=2,a.tab=[];for(var l=0;l<o;l++)a.tab.push(i.readUshort(e,r+2*l));return a},t._lctf.readScriptList=function(e,r){var i=t._bin,n=r,a={},s=i.readUshort(e,r);r+=2;for(var o=0;o<s;o++){var l=i.readASCII(e,r,4);r+=4;var u=i.readUshort(e,r);r+=2,a[l.trim()]=t._lctf.readScriptTable(e,n+u)}return a},t._lctf.readScriptTable=function(e,r){var i=t._bin,n=r,a={},s=i.readUshort(e,r);r+=2,s>0&&(a.default=t._lctf.readLangSysTable(e,n+s));var o=i.readUshort(e,r);r+=2;for(var l=0;l<o;l++){var u=i.readASCII(e,r,4);r+=4;var c=i.readUshort(e,r);r+=2,a[u.trim()]=t._lctf.readLangSysTable(e,n+c)}return a},t._lctf.readLangSysTable=function(e,r){var i=t._bin,n={};i.readUshort(e,r),r+=2,n.reqFeature=i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);return r+=2,n.features=i.readUshorts(e,r,a),n},t.CFF={},t.CFF.parse=function(e,r,i){var n=t._bin;(e=new Uint8Array(e.buffer,r,i))[r=0],e[++r],e[++r],e[++r],r++;var a=[];r=t.CFF.readIndex(e,r,a);for(var s=[],o=0;o<a.length-1;o++)s.push(n.readASCII(e,r+a[o],a[o+1]-a[o]));r+=a[a.length-1];var l=[];r=t.CFF.readIndex(e,r,l);var u=[];for(o=0;o<l.length-1;o++)u.push(t.CFF.readDict(e,r+l[o],r+l[o+1]));r+=l[l.length-1];var c=u[0],h=[];r=t.CFF.readIndex(e,r,h);var d=[];for(o=0;o<h.length-1;o++)d.push(n.readASCII(e,r+h[o],h[o+1]-h[o]));if(r+=h[h.length-1],t.CFF.readSubrs(e,r,c),c.CharStrings){r=c.CharStrings,h=[],r=t.CFF.readIndex(e,r,h);var f=[];for(o=0;o<h.length-1;o++)f.push(n.readBytes(e,r+h[o],h[o+1]-h[o]));c.CharStrings=f}if(c.ROS){r=c.FDArray;var p=[];for(r=t.CFF.readIndex(e,r,p),c.FDArray=[],o=0;o<p.length-1;o++){var m=t.CFF.readDict(e,r+p[o],r+p[o+1]);t.CFF._readFDict(e,m,d),c.FDArray.push(m)}r+=p[p.length-1],r=c.FDSelect,c.FDSelect=[];var g=e[r];if(r++,3!=g)throw g;var A=n.readUshort(e,r);for(r+=2,o=0;o<A+1;o++)c.FDSelect.push(n.readUshort(e,r),e[r+2]),r+=3}return c.Encoding&&(c.Encoding=t.CFF.readEncoding(e,c.Encoding,c.CharStrings.length)),c.charset&&(c.charset=t.CFF.readCharset(e,c.charset,c.CharStrings.length)),t.CFF._readFDict(e,c,d),c},t.CFF._readFDict=function(e,r,i){var n;for(var a in r.Private&&(n=r.Private[1],r.Private=t.CFF.readDict(e,n,n+r.Private[0]),r.Private.Subrs&&t.CFF.readSubrs(e,n+r.Private.Subrs,r.Private)),r)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(a)&&(r[a]=i[r[a]-426+35])},t.CFF.readSubrs=function(e,r,i){var n=t._bin,a=[];r=t.CFF.readIndex(e,r,a);var s,o=a.length;s=o<1240?107:o<33900?1131:32768,i.Bias=s,i.Subrs=[];for(var l=0;l<a.length-1;l++)i.Subrs.push(n.readBytes(e,r+a[l],a[l+1]-a[l]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var r=0;r<e.charset.length;r++)if(e.charset[r]==t)return r;return -1},t.CFF.glyphBySE=function(e,r){return r<0||r>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[r])},t.CFF.readEncoding=function(e,r,i){t._bin;var n=[".notdef"],a=e[r];if(r++,0!=a)throw"error: unknown encoding format: "+a;var s=e[r];r++;for(var o=0;o<s;o++)n.push(e[r+o]);return n},t.CFF.readCharset=function(e,r,i){var n=t._bin,a=[".notdef"],s=e[r];if(r++,0==s)for(var o=0;o<i;o++){var l=n.readUshort(e,r);r+=2,a.push(l)}else{if(1!=s&&2!=s)throw"error: format: "+s;for(;a.length<i;){l=n.readUshort(e,r),r+=2;var u=0;for(1==s?(u=e[r],r++):(u=n.readUshort(e,r),r+=2),o=0;o<=u;o++)a.push(l),l++}}return a},t.CFF.readIndex=function(e,r,i){var n=t._bin,a=n.readUshort(e,r)+1,s=e[r+=2];if(r++,1==s)for(var o=0;o<a;o++)i.push(e[r+o]);else if(2==s)for(o=0;o<a;o++)i.push(n.readUshort(e,r+2*o));else if(3==s)for(o=0;o<a;o++)i.push(0xffffff&n.readUint(e,r+3*o-1));else if(1!=a)throw"unsupported offset size: "+s+", count: "+a;return(r+=a*s)-1},t.CFF.getCharString=function(e,r,i){var n=t._bin,a=e[r],s=e[r+1];e[r+2],e[r+3],e[r+4];var o=1,l=null,u=null;a<=20&&(l=a,o=1),12==a&&(l=100*a+s,o=2),21<=a&&a<=27&&(l=a,o=1),28==a&&(u=n.readShort(e,r+1),o=3),29<=a&&a<=31&&(l=a,o=1),32<=a&&a<=246&&(u=a-139,o=1),247<=a&&a<=250&&(u=256*(a-247)+s+108,o=2),251<=a&&a<=254&&(u=-(256*(a-251))-s-108,o=2),255==a&&(u=n.readInt(e,r+1)/65535,o=5),i.val=null!=u?u:"o"+l,i.size=o},t.CFF.readCharString=function(e,r,i){for(var n=r+i,a=t._bin,s=[];r<n;){var o=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var u=1,c=null,h=null;o<=20&&(c=o,u=1),12==o&&(c=100*o+l,u=2),19!=o&&20!=o||(c=o,u=2),21<=o&&o<=27&&(c=o,u=1),28==o&&(h=a.readShort(e,r+1),u=3),29<=o&&o<=31&&(c=o,u=1),32<=o&&o<=246&&(h=o-139,u=1),247<=o&&o<=250&&(h=256*(o-247)+l+108,u=2),251<=o&&o<=254&&(h=-(256*(o-251))-l-108,u=2),255==o&&(h=a.readInt(e,r+1)/65535,u=5),s.push(null!=h?h:"o"+c),r+=u}return s},t.CFF.readDict=function(e,r,i){for(var n=t._bin,a={},s=[];r<i;){var o=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var u=1,c=null,h=null;if(28==o&&(h=n.readShort(e,r+1),u=3),29==o&&(h=n.readInt(e,r+1),u=5),32<=o&&o<=246&&(h=o-139,u=1),247<=o&&o<=250&&(h=256*(o-247)+l+108,u=2),251<=o&&o<=254&&(h=-(256*(o-251))-l-108,u=2),255==o)throw h=n.readInt(e,r+1)/65535,u=5,"unknown number";if(30==o){var d=[];for(u=1;;){var f=e[r+u];u++;var p=f>>4,m=15&f;if(15!=p&&d.push(p),15!=m&&d.push(m),15==m)break}for(var g="",A=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],v=0;v<d.length;v++)g+=A[d[v]];h=parseFloat(g)}o<=21&&(c=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][o],u=1,12==o&&(c=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],u=2)),null!=c?(a[c]=1==s.length?s[0]:s,s=[]):s.push(h),r+=u}return a},t.cmap={},t.cmap.parse=function(e,r,i){e=new Uint8Array(e.buffer,r,i),r=0;var n=t._bin,a={};n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2;var o=[];a.tables=[];for(var l=0;l<s;l++){var u=n.readUshort(e,r);r+=2;var c=n.readUshort(e,r);r+=2;var h=n.readUint(e,r);r+=4;var d="p"+u+"e"+c,f=o.indexOf(h);if(-1==f){f=a.tables.length,o.push(h);var p,m=n.readUshort(e,h);0==m?p=t.cmap.parse0(e,h):4==m?p=t.cmap.parse4(e,h):6==m?p=t.cmap.parse6(e,h):12==m?p=t.cmap.parse12(e,h):console.debug("unknown format: "+m,u,c,h),a.tables.push(p)}if(null!=a[d])throw"multiple tables for one platform+encoding";a[d]=f}return a},t.cmap.parse0=function(e,r){var i=t._bin,n={};n.format=i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);r+=2,i.readUshort(e,r),r+=2,n.map=[];for(var s=0;s<a-6;s++)n.map.push(e[r+s]);return n},t.cmap.parse4=function(e,r){var i=t._bin,n=r,a={};a.format=i.readUshort(e,r),r+=2;var s=i.readUshort(e,r);r+=2,i.readUshort(e,r),r+=2;var o=i.readUshort(e,r);r+=2;var l=o/2;a.searchRange=i.readUshort(e,r),r+=2,a.entrySelector=i.readUshort(e,r),r+=2,a.rangeShift=i.readUshort(e,r),r+=2,a.endCount=i.readUshorts(e,r,l),r+=2*l+2,a.startCount=i.readUshorts(e,r,l),r+=2*l,a.idDelta=[];for(var u=0;u<l;u++)a.idDelta.push(i.readShort(e,r)),r+=2;for(a.idRangeOffset=i.readUshorts(e,r,l),r+=2*l,a.glyphIdArray=[];r<n+s;)a.glyphIdArray.push(i.readUshort(e,r)),r+=2;return a},t.cmap.parse6=function(e,r){var i=t._bin,n={};n.format=i.readUshort(e,r),r+=2,i.readUshort(e,r),r+=2,i.readUshort(e,r),r+=2,n.firstCode=i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);r+=2,n.glyphIdArray=[];for(var s=0;s<a;s++)n.glyphIdArray.push(i.readUshort(e,r)),r+=2;return n},t.cmap.parse12=function(e,r){var i=t._bin,n={};n.format=i.readUshort(e,r),r+=4,i.readUint(e,r),r+=4,i.readUint(e,r),r+=4;var a=i.readUint(e,r);r+=4,n.groups=[];for(var s=0;s<a;s++){var o=r+12*s,l=i.readUint(e,o+0),u=i.readUint(e,o+4),c=i.readUint(e,o+8);n.groups.push([l,u,c])}return n},t.glyf={},t.glyf.parse=function(e,t,r,i){for(var n=[],a=0;a<i.maxp.numGlyphs;a++)n.push(null);return n},t.glyf._parseGlyf=function(e,r){var i,n=t._bin,a=e._data,s=t._tabOffset(a,"glyf",e._offset)+e.loca[r];if(e.loca[r]==e.loca[r+1])return null;var o={};if(o.noc=n.readShort(a,s),s+=2,o.xMin=n.readShort(a,s),s+=2,o.yMin=n.readShort(a,s),s+=2,o.xMax=n.readShort(a,s),s+=2,o.yMax=n.readShort(a,s),s+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var l=0;l<o.noc;l++)o.endPts.push(n.readUshort(a,s)),s+=2;var u=n.readUshort(a,s);if(s+=2,a.length-s<u)return null;o.instructions=n.readBytes(a,s,u),s+=u;var c=o.endPts[o.noc-1]+1;for(l=0,o.flags=[];l<c;l++){var h=a[s];if(s++,o.flags.push(h),0!=(8&h)){var d=a[s];s++;for(var f=0;f<d;f++)o.flags.push(h),l++}}for(l=0,o.xs=[];l<c;l++){var p=0!=(2&o.flags[l]),m=0!=(16&o.flags[l]);p?(o.xs.push(m?a[s]:-a[s]),s++):m?o.xs.push(0):(o.xs.push(n.readShort(a,s)),s+=2)}for(l=0,o.ys=[];l<c;l++)p=0!=(4&o.flags[l]),m=0!=(32&o.flags[l]),p?(o.ys.push(m?a[s]:-a[s]),s++):m?o.ys.push(0):(o.ys.push(n.readShort(a,s)),s+=2);var g=0,A=0;for(l=0;l<c;l++)g+=o.xs[l],A+=o.ys[l],o.xs[l]=g,o.ys[l]=A}else{o.parts=[];do{i=n.readUshort(a,s),s+=2;var v={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(v),v.glyphIndex=n.readUshort(a,s),s+=2,1&i){var y=n.readShort(a,s);s+=2;var E=n.readShort(a,s);s+=2}else y=n.readInt8(a,s),s++,E=n.readInt8(a,s),s++;2&i?(v.m.tx=y,v.m.ty=E):(v.p1=y,v.p2=E),8&i?(v.m.a=v.m.d=n.readF2dot14(a,s),s+=2):64&i?(v.m.a=n.readF2dot14(a,s),s+=2,v.m.d=n.readF2dot14(a,s),s+=2):128&i&&(v.m.a=n.readF2dot14(a,s),s+=2,v.m.b=n.readF2dot14(a,s),s+=2,v.m.c=n.readF2dot14(a,s),s+=2,v.m.d=n.readF2dot14(a,s),s+=2)}while(32&i);if(256&i){var x=n.readUshort(a,s);for(s+=2,o.instr=[],l=0;l<x;l++)o.instr.push(a[s]),s++}}return o},t.GDEF={},t.GDEF.parse=function(e,r,i,n){var a=r;r+=4;var s=t._bin.readUshort(e,r);return{glyphClassDef:0===s?null:t._lctf.readClassDef(e,a+s)}},t.GPOS={},t.GPOS.parse=function(e,r,i,n){return t._lctf.parse(e,r,i,n,t.GPOS.subt)},t.GPOS.subt=function(e,r,i,n){var a=t._bin,s=i,o={};if(o.fmt=a.readUshort(e,i),i+=2,1==r||2==r||3==r||7==r||8==r&&o.fmt<=2){var l=a.readUshort(e,i);i+=2,o.coverage=t._lctf.readCoverage(e,l+s)}if(1==r&&1==o.fmt){var u=a.readUshort(e,i);i+=2,0!=u&&(o.pos=t.GPOS.readValueRecord(e,i,u))}else if(2==r&&o.fmt>=1&&o.fmt<=2){u=a.readUshort(e,i),i+=2;var c=a.readUshort(e,i);i+=2;var h=t._lctf.numOfOnes(u),d=t._lctf.numOfOnes(c);if(1==o.fmt){o.pairsets=[];var f=a.readUshort(e,i);i+=2;for(var p=0;p<f;p++){var m=s+a.readUshort(e,i);i+=2;var g=a.readUshort(e,m);m+=2;for(var A=[],v=0;v<g;v++){var y=a.readUshort(e,m);m+=2,0!=u&&(w=t.GPOS.readValueRecord(e,m,u),m+=2*h),0!=c&&(C=t.GPOS.readValueRecord(e,m,c),m+=2*d),A.push({gid2:y,val1:w,val2:C})}o.pairsets.push(A)}}if(2==o.fmt){var E=a.readUshort(e,i);i+=2;var x=a.readUshort(e,i);i+=2;var _=a.readUshort(e,i);i+=2;var b=a.readUshort(e,i);for(i+=2,o.classDef1=t._lctf.readClassDef(e,s+E),o.classDef2=t._lctf.readClassDef(e,s+x),o.matrix=[],p=0;p<_;p++){var S=[];for(v=0;v<b;v++){var w=null,C=null;0!=u&&(w=t.GPOS.readValueRecord(e,i,u),i+=2*h),0!=c&&(C=t.GPOS.readValueRecord(e,i,c),i+=2*d),S.push({val1:w,val2:C})}o.matrix.push(S)}}}else if(4==r&&1==o.fmt)o.markCoverage=t._lctf.readCoverage(e,a.readUshort(e,i)+s),o.baseCoverage=t._lctf.readCoverage(e,a.readUshort(e,i+2)+s),o.markClassCount=a.readUshort(e,i+4),o.markArray=t.GPOS.readMarkArray(e,a.readUshort(e,i+6)+s),o.baseArray=t.GPOS.readBaseArray(e,a.readUshort(e,i+8)+s,o.markClassCount);else if(6==r&&1==o.fmt)o.mark1Coverage=t._lctf.readCoverage(e,a.readUshort(e,i)+s),o.mark2Coverage=t._lctf.readCoverage(e,a.readUshort(e,i+2)+s),o.markClassCount=a.readUshort(e,i+4),o.mark1Array=t.GPOS.readMarkArray(e,a.readUshort(e,i+6)+s),o.mark2Array=t.GPOS.readBaseArray(e,a.readUshort(e,i+8)+s,o.markClassCount);else{if(9==r&&1==o.fmt){var T=a.readUshort(e,i);i+=2;var I=a.readUint(e,i);if(i+=4,9==n.ltype)n.ltype=T;else if(n.ltype!=T)throw"invalid extension substitution";return t.GPOS.subt(e,n.ltype,s+I)}console.debug("unsupported GPOS table LookupType",r,"format",o.fmt)}return o},t.GPOS.readValueRecord=function(e,r,i){var n=t._bin,a=[];return a.push(1&i?n.readShort(e,r):0),r+=1&i?2:0,a.push(2&i?n.readShort(e,r):0),r+=2&i?2:0,a.push(4&i?n.readShort(e,r):0),r+=4&i?2:0,a.push(8&i?n.readShort(e,r):0),r+=8&i?2:0,a},t.GPOS.readBaseArray=function(e,r,i){var n=t._bin,a=[],s=r,o=n.readUshort(e,r);r+=2;for(var l=0;l<o;l++){for(var u=[],c=0;c<i;c++)u.push(t.GPOS.readAnchorRecord(e,s+n.readUshort(e,r))),r+=2;a.push(u)}return a},t.GPOS.readMarkArray=function(e,r){var i=t._bin,n=[],a=r,s=i.readUshort(e,r);r+=2;for(var o=0;o<s;o++){var l=t.GPOS.readAnchorRecord(e,i.readUshort(e,r+2)+a);l.markClass=i.readUshort(e,r),n.push(l),r+=4}return n},t.GPOS.readAnchorRecord=function(e,r){var i=t._bin,n={};return n.fmt=i.readUshort(e,r),n.x=i.readShort(e,r+2),n.y=i.readShort(e,r+4),n},t.GSUB={},t.GSUB.parse=function(e,r,i,n){return t._lctf.parse(e,r,i,n,t.GSUB.subt)},t.GSUB.subt=function(e,r,i,n){var a=t._bin,s=i,o={};if(o.fmt=a.readUshort(e,i),i+=2,1!=r&&2!=r&&4!=r&&5!=r&&6!=r)return null;if(1==r||2==r||4==r||5==r&&o.fmt<=2||6==r&&o.fmt<=2){var l=a.readUshort(e,i);i+=2,o.coverage=t._lctf.readCoverage(e,s+l)}if(1==r&&o.fmt>=1&&o.fmt<=2){if(1==o.fmt)o.delta=a.readShort(e,i),i+=2;else if(2==o.fmt){var u=a.readUshort(e,i);i+=2,o.newg=a.readUshorts(e,i,u),i+=2*o.newg.length}}else if(2==r&&1==o.fmt){u=a.readUshort(e,i),i+=2,o.seqs=[];for(var c=0;c<u;c++){var h=a.readUshort(e,i)+s;i+=2;var d=a.readUshort(e,h);o.seqs.push(a.readUshorts(e,h+2,d))}}else if(4==r)for(o.vals=[],u=a.readUshort(e,i),i+=2,c=0;c<u;c++){var f=a.readUshort(e,i);i+=2,o.vals.push(t.GSUB.readLigatureSet(e,s+f))}else if(5==r&&2==o.fmt){if(2==o.fmt){var p=a.readUshort(e,i);i+=2,o.cDef=t._lctf.readClassDef(e,s+p),o.scset=[];var m=a.readUshort(e,i);for(i+=2,c=0;c<m;c++){var g=a.readUshort(e,i);i+=2,o.scset.push(0==g?null:t.GSUB.readSubClassSet(e,s+g))}}}else if(6==r&&3==o.fmt){if(3==o.fmt){for(c=0;c<3;c++){u=a.readUshort(e,i),i+=2;for(var A=[],v=0;v<u;v++)A.push(t._lctf.readCoverage(e,s+a.readUshort(e,i+2*v)));i+=2*u,0==c&&(o.backCvg=A),1==c&&(o.inptCvg=A),2==c&&(o.ahedCvg=A)}u=a.readUshort(e,i),i+=2,o.lookupRec=t.GSUB.readSubstLookupRecords(e,i,u)}}else{if(7==r&&1==o.fmt){var y=a.readUshort(e,i);i+=2;var E=a.readUint(e,i);if(i+=4,9==n.ltype)n.ltype=y;else if(n.ltype!=y)throw"invalid extension substitution";return t.GSUB.subt(e,n.ltype,s+E)}console.debug("unsupported GSUB table LookupType",r,"format",o.fmt)}return o},t.GSUB.readSubClassSet=function(e,r){var i=t._bin.readUshort,n=r,a=[],s=i(e,r);r+=2;for(var o=0;o<s;o++){var l=i(e,r);r+=2,a.push(t.GSUB.readSubClassRule(e,n+l))}return a},t.GSUB.readSubClassRule=function(e,r){var i=t._bin.readUshort,n={},a=i(e,r),s=i(e,r+=2);r+=2,n.input=[];for(var o=0;o<a-1;o++)n.input.push(i(e,r)),r+=2;return n.substLookupRecords=t.GSUB.readSubstLookupRecords(e,r,s),n},t.GSUB.readSubstLookupRecords=function(e,r,i){for(var n=t._bin.readUshort,a=[],s=0;s<i;s++)a.push(n(e,r),n(e,r+2)),r+=4;return a},t.GSUB.readChainSubClassSet=function(e,r){var i=t._bin,n=r,a=[],s=i.readUshort(e,r);r+=2;for(var o=0;o<s;o++){var l=i.readUshort(e,r);r+=2,a.push(t.GSUB.readChainSubClassRule(e,n+l))}return a},t.GSUB.readChainSubClassRule=function(e,r){for(var i=t._bin,n={},a=["backtrack","input","lookahead"],s=0;s<a.length;s++){var o=i.readUshort(e,r);r+=2,1==s&&o--,n[a[s]]=i.readUshorts(e,r,o),r+=2*n[a[s]].length}return o=i.readUshort(e,r),r+=2,n.subst=i.readUshorts(e,r,2*o),r+=2*n.subst.length,n},t.GSUB.readLigatureSet=function(e,r){var i=t._bin,n=r,a=[],s=i.readUshort(e,r);r+=2;for(var o=0;o<s;o++){var l=i.readUshort(e,r);r+=2,a.push(t.GSUB.readLigature(e,n+l))}return a},t.GSUB.readLigature=function(e,r){var i=t._bin,n={chain:[]};n.nglyph=i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);r+=2;for(var s=0;s<a-1;s++)n.chain.push(i.readUshort(e,r)),r+=2;return n},t.head={},t.head.parse=function(e,r,i){var n=t._bin,a={};return n.readFixed(e,r),r+=4,a.fontRevision=n.readFixed(e,r),r+=4,n.readUint(e,r),r+=4,n.readUint(e,r),r+=4,a.flags=n.readUshort(e,r),r+=2,a.unitsPerEm=n.readUshort(e,r),r+=2,a.created=n.readUint64(e,r),r+=8,a.modified=n.readUint64(e,r),r+=8,a.xMin=n.readShort(e,r),r+=2,a.yMin=n.readShort(e,r),r+=2,a.xMax=n.readShort(e,r),r+=2,a.yMax=n.readShort(e,r),r+=2,a.macStyle=n.readUshort(e,r),r+=2,a.lowestRecPPEM=n.readUshort(e,r),r+=2,a.fontDirectionHint=n.readShort(e,r),r+=2,a.indexToLocFormat=n.readShort(e,r),r+=2,a.glyphDataFormat=n.readShort(e,r),r+=2,a},t.hhea={},t.hhea.parse=function(e,r,i){var n=t._bin,a={};return n.readFixed(e,r),r+=4,a.ascender=n.readShort(e,r),r+=2,a.descender=n.readShort(e,r),r+=2,a.lineGap=n.readShort(e,r),r+=2,a.advanceWidthMax=n.readUshort(e,r),r+=2,a.minLeftSideBearing=n.readShort(e,r),r+=2,a.minRightSideBearing=n.readShort(e,r),r+=2,a.xMaxExtent=n.readShort(e,r),r+=2,a.caretSlopeRise=n.readShort(e,r),r+=2,a.caretSlopeRun=n.readShort(e,r),r+=2,a.caretOffset=n.readShort(e,r),r+=10,a.metricDataFormat=n.readShort(e,r),r+=2,a.numberOfHMetrics=n.readUshort(e,r),r+=2,a},t.hmtx={},t.hmtx.parse=function(e,r,i,n){for(var a=t._bin,s={aWidth:[],lsBearing:[]},o=0,l=0,u=0;u<n.maxp.numGlyphs;u++)u<n.hhea.numberOfHMetrics&&(o=a.readUshort(e,r),r+=2,l=a.readShort(e,r),r+=2),s.aWidth.push(o),s.lsBearing.push(l);return s},t.kern={},t.kern.parse=function(e,r,i,n){var a=t._bin,s=a.readUshort(e,r);if(r+=2,1==s)return t.kern.parseV1(e,r-2,i,n);var o=a.readUshort(e,r);r+=2;for(var l={glyph1:[],rval:[]},u=0;u<o;u++){r+=2,i=a.readUshort(e,r),r+=2;var c=a.readUshort(e,r);r+=2;var h=c>>>8;if(0!=(h&=15))throw"unknown kern table format: "+h;r=t.kern.readFormat0(e,r,l)}return l},t.kern.parseV1=function(e,r,i,n){var a=t._bin;a.readFixed(e,r),r+=4;var s=a.readUint(e,r);r+=4;for(var o={glyph1:[],rval:[]},l=0;l<s;l++){a.readUint(e,r),r+=4;var u=a.readUshort(e,r);r+=2,a.readUshort(e,r),r+=2;var c=u>>>8;if(0!=(c&=15))throw"unknown kern table format: "+c;r=t.kern.readFormat0(e,r,o)}return o},t.kern.readFormat0=function(e,r,i){var n=t._bin,a=-1,s=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2;for(var o=0;o<s;o++){var l=n.readUshort(e,r);r+=2;var u=n.readUshort(e,r);r+=2;var c=n.readShort(e,r);r+=2,l!=a&&(i.glyph1.push(l),i.rval.push({glyph2:[],vals:[]}));var h=i.rval[i.rval.length-1];h.glyph2.push(u),h.vals.push(c),a=l}return r},t.loca={},t.loca.parse=function(e,r,i,n){var a=t._bin,s=[],o=n.head.indexToLocFormat,l=n.maxp.numGlyphs+1;if(0==o)for(var u=0;u<l;u++)s.push(a.readUshort(e,r+(u<<1))<<1);if(1==o)for(u=0;u<l;u++)s.push(a.readUint(e,r+(u<<2)));return s},t.maxp={},t.maxp.parse=function(e,r,i){var n=t._bin,a={},s=n.readUint(e,r);return r+=4,a.numGlyphs=n.readUshort(e,r),r+=2,65536==s&&(a.maxPoints=n.readUshort(e,r),r+=2,a.maxContours=n.readUshort(e,r),r+=2,a.maxCompositePoints=n.readUshort(e,r),r+=2,a.maxCompositeContours=n.readUshort(e,r),r+=2,a.maxZones=n.readUshort(e,r),r+=2,a.maxTwilightPoints=n.readUshort(e,r),r+=2,a.maxStorage=n.readUshort(e,r),r+=2,a.maxFunctionDefs=n.readUshort(e,r),r+=2,a.maxInstructionDefs=n.readUshort(e,r),r+=2,a.maxStackElements=n.readUshort(e,r),r+=2,a.maxSizeOfInstructions=n.readUshort(e,r),r+=2,a.maxComponentElements=n.readUshort(e,r),r+=2,a.maxComponentDepth=n.readUshort(e,r),r+=2),a},t.name={},t.name.parse=function(e,r,i){var n=t._bin,a={};n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2,n.readUshort(e,r);for(var o,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],u=r+=2,c=0;c<s;c++){var h=n.readUshort(e,r);r+=2;var d=n.readUshort(e,r);r+=2;var f=n.readUshort(e,r);r+=2;var p=n.readUshort(e,r);r+=2;var m=n.readUshort(e,r);r+=2;var g=n.readUshort(e,r);r+=2;var A,v=l[p],y=u+12*s+g;if(0==h)A=n.readUnicode(e,y,m/2);else if(3==h&&0==d)A=n.readUnicode(e,y,m/2);else if(0==d)A=n.readASCII(e,y,m);else if(1==d)A=n.readUnicode(e,y,m/2);else if(3==d)A=n.readUnicode(e,y,m/2);else{if(1!=h)throw"unknown encoding "+d+", platformID: "+h;A=n.readASCII(e,y,m),console.debug("reading unknown MAC encoding "+d+" as ASCII")}var E="p"+h+","+f.toString(16);null==a[E]&&(a[E]={}),a[E][void 0!==v?v:p]=A,a[E]._lang=f}for(var x in a)if(null!=a[x].postScriptName&&1033==a[x]._lang)return a[x];for(var x in a)if(null!=a[x].postScriptName&&0==a[x]._lang)return a[x];for(var x in a)if(null!=a[x].postScriptName&&3084==a[x]._lang)return a[x];for(var x in a)if(null!=a[x].postScriptName)return a[x];for(var x in a){o=x;break}return console.debug("returning name table with languageID "+a[o]._lang),a[o]},t["OS/2"]={},t["OS/2"].parse=function(e,r,i){var n=t._bin.readUshort(e,r);r+=2;var a={};if(0==n)t["OS/2"].version0(e,r,a);else if(1==n)t["OS/2"].version1(e,r,a);else if(2==n||3==n||4==n)t["OS/2"].version2(e,r,a);else{if(5!=n)throw"unknown OS/2 table version: "+n;t["OS/2"].version5(e,r,a)}return a},t["OS/2"].version0=function(e,r,i){var n=t._bin;return i.xAvgCharWidth=n.readShort(e,r),r+=2,i.usWeightClass=n.readUshort(e,r),r+=2,i.usWidthClass=n.readUshort(e,r),r+=2,i.fsType=n.readUshort(e,r),r+=2,i.ySubscriptXSize=n.readShort(e,r),r+=2,i.ySubscriptYSize=n.readShort(e,r),r+=2,i.ySubscriptXOffset=n.readShort(e,r),r+=2,i.ySubscriptYOffset=n.readShort(e,r),r+=2,i.ySuperscriptXSize=n.readShort(e,r),r+=2,i.ySuperscriptYSize=n.readShort(e,r),r+=2,i.ySuperscriptXOffset=n.readShort(e,r),r+=2,i.ySuperscriptYOffset=n.readShort(e,r),r+=2,i.yStrikeoutSize=n.readShort(e,r),r+=2,i.yStrikeoutPosition=n.readShort(e,r),r+=2,i.sFamilyClass=n.readShort(e,r),r+=2,i.panose=n.readBytes(e,r,10),r+=10,i.ulUnicodeRange1=n.readUint(e,r),r+=4,i.ulUnicodeRange2=n.readUint(e,r),r+=4,i.ulUnicodeRange3=n.readUint(e,r),r+=4,i.ulUnicodeRange4=n.readUint(e,r),r+=4,i.achVendID=[n.readInt8(e,r),n.readInt8(e,r+1),n.readInt8(e,r+2),n.readInt8(e,r+3)],r+=4,i.fsSelection=n.readUshort(e,r),r+=2,i.usFirstCharIndex=n.readUshort(e,r),r+=2,i.usLastCharIndex=n.readUshort(e,r),r+=2,i.sTypoAscender=n.readShort(e,r),r+=2,i.sTypoDescender=n.readShort(e,r),r+=2,i.sTypoLineGap=n.readShort(e,r),r+=2,i.usWinAscent=n.readUshort(e,r),r+=2,i.usWinDescent=n.readUshort(e,r),r+=2},t["OS/2"].version1=function(e,r,i){var n=t._bin;return r=t["OS/2"].version0(e,r,i),i.ulCodePageRange1=n.readUint(e,r),r+=4,i.ulCodePageRange2=n.readUint(e,r),r+=4},t["OS/2"].version2=function(e,r,i){var n=t._bin;return r=t["OS/2"].version1(e,r,i),i.sxHeight=n.readShort(e,r),r+=2,i.sCapHeight=n.readShort(e,r),r+=2,i.usDefault=n.readUshort(e,r),r+=2,i.usBreak=n.readUshort(e,r),r+=2,i.usMaxContext=n.readUshort(e,r),r+=2},t["OS/2"].version5=function(e,r,i){var n=t._bin;return r=t["OS/2"].version2(e,r,i),i.usLowerOpticalPointSize=n.readUshort(e,r),r+=2,i.usUpperOpticalPointSize=n.readUshort(e,r),r+=2},t.post={},t.post.parse=function(e,r,i){var n=t._bin,a={};return a.version=n.readFixed(e,r),r+=4,a.italicAngle=n.readFixed(e,r),r+=4,a.underlinePosition=n.readShort(e,r),r+=2,a.underlineThickness=n.readShort(e,r),r+=2,a},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var r=e.cmap,i=-1;if(null!=r.p0e4?i=r.p0e4:null!=r.p3e1?i=r.p3e1:null!=r.p1e0?i=r.p1e0:null!=r.p0e3&&(i=r.p0e3),-1==i)throw"no familiar platform and encoding!";var n=r.tables[i];if(0==n.format)return t>=n.map.length?0:n.map[t];if(4==n.format){for(var a=-1,s=0;s<n.endCount.length;s++)if(t<=n.endCount[s]){a=s;break}return -1==a||n.startCount[a]>t?0:65535&(0!=n.idRangeOffset[a]?n.glyphIdArray[t-n.startCount[a]+(n.idRangeOffset[a]>>1)-(n.idRangeOffset.length-a)]:t+n.idDelta[a])}if(12==n.format){if(t>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var o=n.groups[s];if(o[0]<=t&&t<=o[1])return o[2]+(t-o[0])}return 0}throw"unknown cmap table format "+n.format},t.U.glyphToPath=function(e,r){var i={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[r]){var n=e.SVG.entries[r];return null==n?i:("string"==typeof n&&(n=t.SVG.toPath(n),e.SVG.entries[r]=n),n)}if(e.CFF){var a={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},s=e.CFF,o=e.CFF.Private;if(s.ROS){for(var l=0;s.FDSelect[l+2]<=r;)l+=2;o=s.FDArray[s.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[r],a,s,o,i)}else e.glyf&&t.U._drawGlyf(r,e,i);return i},t.U._drawGlyf=function(e,r,i){var n=r.glyf[e];null==n&&(n=r.glyf[e]=t.glyf._parseGlyf(r,e)),null!=n&&(n.noc>-1?t.U._simpleGlyph(n,i):t.U._compoGlyph(n,r,i))},t.U._simpleGlyph=function(e,r){for(var i=0;i<e.noc;i++){for(var n=0==i?0:e.endPts[i-1]+1,a=e.endPts[i],s=n;s<=a;s++){var o=s==n?a:s-1,l=s==a?n:s+1,u=1&e.flags[s],c=1&e.flags[o],h=1&e.flags[l],d=e.xs[s],f=e.ys[s];if(s==n){if(u){if(!c){t.U.P.moveTo(r,d,f);continue}t.U.P.moveTo(r,e.xs[o],e.ys[o])}else c?t.U.P.moveTo(r,e.xs[o],e.ys[o]):t.U.P.moveTo(r,(e.xs[o]+d)/2,(e.ys[o]+f)/2)}u?c&&t.U.P.lineTo(r,d,f):h?t.U.P.qcurveTo(r,d,f,e.xs[l],e.ys[l]):t.U.P.qcurveTo(r,d,f,(d+e.xs[l])/2,(f+e.ys[l])/2)}t.U.P.closePath(r)}},t.U._compoGlyph=function(e,r,i){for(var n=0;n<e.parts.length;n++){var a={cmds:[],crds:[]},s=e.parts[n];t.U._drawGlyf(s.glyphIndex,r,a);for(var o=s.m,l=0;l<a.crds.length;l+=2){var u=a.crds[l],c=a.crds[l+1];i.crds.push(u*o.a+c*o.b+o.tx),i.crds.push(u*o.c+c*o.d+o.ty)}for(l=0;l<a.cmds.length;l++)i.cmds.push(a.cmds[l])}},t.U._getGlyphClass=function(e,r){var i=t._lctf.getInterval(r,e);return -1==i?0:r[i+2]},t.U._applySubs=function(e,r,i,n){for(var a=e.length-r-1,s=0;s<i.tabs.length;s++)if(null!=i.tabs[s]){var o,l=i.tabs[s];if(!l.coverage||-1!=(o=t._lctf.coverageIndex(l.coverage,e[r]))){if(1==i.ltype)e[r],1==l.fmt?e[r]=e[r]+l.delta:e[r]=l.newg[o];else if(4==i.ltype)for(var u=l.vals[o],c=0;c<u.length;c++){var h=u[c],d=h.chain.length;if(!(d>a)){for(var f=!0,p=0,m=0;m<d;m++){for(;-1==e[r+p+(1+m)];)p++;h.chain[m]!=e[r+p+(1+m)]&&(f=!1)}if(f){for(m=0,e[r]=h.nglyph;m<d+p;m++)e[r+m+1]=-1;break}}}else if(5==i.ltype&&2==l.fmt)for(var g=t._lctf.getInterval(l.cDef,e[r]),A=l.cDef[g+2],v=l.scset[A],y=0;y<v.length;y++){var E=v[y],x=E.input;if(!(x.length>a)){for(f=!0,m=0;m<x.length;m++){var _=t._lctf.getInterval(l.cDef,e[r+1+m]);if(-1==g&&l.cDef[_+2]!=x[m]){f=!1;break}}if(f){var b=E.substLookupRecords;for(c=0;c<b.length;c+=2)b[c],b[c+1]}}}else if(6==i.ltype&&3==l.fmt){if(!t.U._glsCovered(e,l.backCvg,r-l.backCvg.length)||!t.U._glsCovered(e,l.inptCvg,r)||!t.U._glsCovered(e,l.ahedCvg,r+l.inptCvg.length))continue;var S=l.lookupRec;for(y=0;y<S.length;y+=2){g=S[y];var w=n[S[y+1]];t.U._applySubs(e,r+g,w,n)}}}}},t.U._glsCovered=function(e,r,i){for(var n=0;n<r.length;n++)if(-1==t._lctf.coverageIndex(r[n],e[i+n]))return!1;return!0},t.U.glyphsToPath=function(e,r,i){for(var n={cmds:[],crds:[]},a=0,s=0;s<r.length;s++){var o=r[s];if(-1!=o){for(var l=s<r.length-1&&-1!=r[s+1]?r[s+1]:0,u=t.U.glyphToPath(e,o),c=0;c<u.crds.length;c+=2)n.crds.push(u.crds[c]+a),n.crds.push(u.crds[c+1]);for(i&&n.cmds.push(i),c=0;c<u.cmds.length;c++)n.cmds.push(u.cmds[c]);i&&n.cmds.push("X"),a+=e.hmtx.aWidth[o],s<r.length-1&&(a+=t.U.getPairAdjustment(e,o,l))}}return n},t.U.P={},t.U.P.moveTo=function(e,t,r){e.cmds.push("M"),e.crds.push(t,r)},t.U.P.lineTo=function(e,t,r){e.cmds.push("L"),e.crds.push(t,r)},t.U.P.curveTo=function(e,t,r,i,n,a,s){e.cmds.push("C"),e.crds.push(t,r,i,n,a,s)},t.U.P.qcurveTo=function(e,t,r,i,n){e.cmds.push("Q"),e.crds.push(t,r,i,n)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,r,i,n,a){for(var s=r.stack,o=r.nStems,l=r.haveWidth,u=r.width,c=r.open,h=0,d=r.x,f=r.y,p=0,m=0,g=0,A=0,v=0,y=0,E=0,x=0,_=0,b=0,S={val:0,size:0};h<e.length;){t.CFF.getCharString(e,h,S);var w=S.val;if(h+=S.size,"o1"==w||"o18"==w)s.length%2==0||l||(u=s.shift()+n.nominalWidthX),o+=s.length>>1,s.length=0,l=!0;else if("o3"==w||"o23"==w)s.length%2==0||l||(u=s.shift()+n.nominalWidthX),o+=s.length>>1,s.length=0,l=!0;else if("o4"==w)s.length>1&&!l&&(u=s.shift()+n.nominalWidthX,l=!0),c&&t.U.P.closePath(a),f+=s.pop(),t.U.P.moveTo(a,d,f),c=!0;else if("o5"==w)for(;s.length>0;)d+=s.shift(),f+=s.shift(),t.U.P.lineTo(a,d,f);else if("o6"==w||"o7"==w)for(var C=s.length,T="o6"==w,I=0;I<C;I++){var M=s.shift();T?d+=M:f+=M,T=!T,t.U.P.lineTo(a,d,f)}else if("o8"==w||"o24"==w){C=s.length;for(var R=0;R+6<=C;)p=d+s.shift(),m=f+s.shift(),g=p+s.shift(),A=m+s.shift(),d=g+s.shift(),f=A+s.shift(),t.U.P.curveTo(a,p,m,g,A,d,f),R+=6;"o24"==w&&(d+=s.shift(),f+=s.shift(),t.U.P.lineTo(a,d,f))}else{if("o11"==w)break;if("o1234"==w||"o1235"==w||"o1236"==w||"o1237"==w)"o1234"==w&&(m=f,g=(p=d+s.shift())+s.shift(),b=A=m+s.shift(),y=A,x=f,d=(E=(v=(_=g+s.shift())+s.shift())+s.shift())+s.shift(),t.U.P.curveTo(a,p,m,g,A,_,b),t.U.P.curveTo(a,v,y,E,x,d,f)),"o1235"==w&&(p=d+s.shift(),m=f+s.shift(),g=p+s.shift(),A=m+s.shift(),_=g+s.shift(),b=A+s.shift(),v=_+s.shift(),y=b+s.shift(),E=v+s.shift(),x=y+s.shift(),d=E+s.shift(),f=x+s.shift(),s.shift(),t.U.P.curveTo(a,p,m,g,A,_,b),t.U.P.curveTo(a,v,y,E,x,d,f)),"o1236"==w&&(p=d+s.shift(),m=f+s.shift(),g=p+s.shift(),b=A=m+s.shift(),y=A,E=(v=(_=g+s.shift())+s.shift())+s.shift(),x=y+s.shift(),d=E+s.shift(),t.U.P.curveTo(a,p,m,g,A,_,b),t.U.P.curveTo(a,v,y,E,x,d,f)),"o1237"==w&&(p=d+s.shift(),m=f+s.shift(),g=p+s.shift(),A=m+s.shift(),_=g+s.shift(),b=A+s.shift(),v=_+s.shift(),y=b+s.shift(),Math.abs((E=v+s.shift())-d)>Math.abs((x=y+s.shift())-f)?d=E+s.shift():f=x+s.shift(),t.U.P.curveTo(a,p,m,g,A,_,b),t.U.P.curveTo(a,v,y,E,x,d,f));else if("o14"==w){if(s.length>0&&!l&&(u=s.shift()+i.nominalWidthX,l=!0),4==s.length){var B=s.shift(),D=s.shift(),P=s.shift(),L=s.shift(),k=t.CFF.glyphBySE(i,P),F=t.CFF.glyphBySE(i,L);t.U._drawCFF(i.CharStrings[k],r,i,n,a),r.x=B,r.y=D,t.U._drawCFF(i.CharStrings[F],r,i,n,a)}c&&(t.U.P.closePath(a),c=!1)}else if("o19"==w||"o20"==w)s.length%2==0||l||(u=s.shift()+n.nominalWidthX),o+=s.length>>1,s.length=0,l=!0,h+=o+7>>3;else if("o21"==w)s.length>2&&!l&&(u=s.shift()+n.nominalWidthX,l=!0),f+=s.pop(),d+=s.pop(),c&&t.U.P.closePath(a),t.U.P.moveTo(a,d,f),c=!0;else if("o22"==w)s.length>1&&!l&&(u=s.shift()+n.nominalWidthX,l=!0),d+=s.pop(),c&&t.U.P.closePath(a),t.U.P.moveTo(a,d,f),c=!0;else if("o25"==w){for(;s.length>6;)d+=s.shift(),f+=s.shift(),t.U.P.lineTo(a,d,f);p=d+s.shift(),m=f+s.shift(),g=p+s.shift(),A=m+s.shift(),d=g+s.shift(),f=A+s.shift(),t.U.P.curveTo(a,p,m,g,A,d,f)}else if("o26"==w)for(s.length%2&&(d+=s.shift());s.length>0;)p=d,m=f+s.shift(),d=g=p+s.shift(),f=(A=m+s.shift())+s.shift(),t.U.P.curveTo(a,p,m,g,A,d,f);else if("o27"==w)for(s.length%2&&(f+=s.shift());s.length>0;)m=f,g=(p=d+s.shift())+s.shift(),A=m+s.shift(),d=g+s.shift(),f=A,t.U.P.curveTo(a,p,m,g,A,d,f);else if("o10"==w||"o29"==w){var O="o10"==w?n:i;if(0==s.length)console.debug("error: empty stack");else{var U=s.pop(),N=O.Subrs[U+O.Bias];r.x=d,r.y=f,r.nStems=o,r.haveWidth=l,r.width=u,r.open=c,t.U._drawCFF(N,r,i,n,a),d=r.x,f=r.y,o=r.nStems,l=r.haveWidth,u=r.width,c=r.open}}else if("o30"==w||"o31"==w){var z=s.length,G=(R=0,"o31"==w);for(R+=z-(C=-3&z);R<C;)G?(m=f,g=(p=d+s.shift())+s.shift(),f=(A=m+s.shift())+s.shift(),C-R==5?(d=g+s.shift(),R++):d=g,G=!1):(p=d,m=f+s.shift(),g=p+s.shift(),A=m+s.shift(),d=g+s.shift(),C-R==5?(f=A+s.shift(),R++):f=A,G=!0),t.U.P.curveTo(a,p,m,g,A,d,f),R+=4}else{if("o"==(w+"").charAt(0))throw console.debug("Unknown operation: "+w,e),w;s.push(w)}}}r.x=d,r.y=f,r.nStems=o,r.haveWidth=l,r.width=u,r.open=c},r=t,e.Typr=r,e.default={Typr:r},Object.defineProperty(e,"__esModule",{value:!0}),e).Typr},function(){return function(e){var t=Uint8Array,r=Uint16Array,i=Uint32Array,n=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),s=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(e,t){for(var n=new r(31),a=0;a<31;++a)n[a]=t+=1<<e[a-1];var s=new i(n[30]);for(a=1;a<30;++a)for(var o=n[a];o<n[a+1];++o)s[o]=o-n[a]<<5|a;return[n,s]},l=o(n,2),u=l[0],c=l[1];u[28]=258,c[258]=28;for(var h=o(a,0)[0],d=new r(32768),f=0;f<32768;++f){var p=(43690&f)>>>1|(21845&f)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,d[f]=((65280&p)>>>8|(255&p)<<8)>>>1}var m=function(e,t,i){for(var n=e.length,a=0,s=new r(t);a<n;++a)++s[e[a]-1];var o,l=new r(t);for(a=0;a<t;++a)l[a]=l[a-1]+s[a-1]<<1;if(i){o=new r(1<<t);var u=15-t;for(a=0;a<n;++a)if(e[a])for(var c=a<<4|e[a],h=t-e[a],f=l[e[a]-1]++<<h,p=f|(1<<h)-1;f<=p;++f)o[d[f]>>>u]=c}else for(o=new r(n),a=0;a<n;++a)e[a]&&(o[a]=d[l[e[a]-1]++]>>>15-e[a]);return o},g=new t(288);for(f=0;f<144;++f)g[f]=8;for(f=144;f<256;++f)g[f]=9;for(f=256;f<280;++f)g[f]=7;for(f=280;f<288;++f)g[f]=8;var A=new t(32);for(f=0;f<32;++f)A[f]=5;var v=m(g,9,1),y=m(A,5,1),E=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},x=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&r},_=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},b=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],S=function(e,t,r){var i=Error(t||b[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,S),!r)throw i;return i},w=function(e,o,l){var c,d,f,p,g=e.length;if(!g||l&&!l.l&&g<5)return o||new t(0);var A=!o||l,b=!l||l.i;l||(l={}),o||(o=new t(3*g));var w,C=function(e){var r=o.length;if(e>r){var i=new t(Math.max(2*r,e));i.set(o),o=i}},T=l.f||0,I=l.p||0,M=l.b||0,R=l.l,B=l.d,D=l.m,P=l.n,L=8*g;do{if(!R){l.f=T=x(e,I,1);var k=x(e,I+1,3);if(I+=3,!k){var F=e[(Y=((w=I)/8|0)+(7&w&&1)+4)-4]|e[Y-3]<<8,O=Y+F;if(O>g){b&&S(0);break}A&&C(M+F),o.set(e.subarray(Y,O),M),l.b=M+=F,l.p=I=8*O;continue}if(1==k)R=v,B=y,D=9,P=5;else if(2==k){var U=x(e,I,31)+257,N=x(e,I+10,15)+4,z=U+x(e,I+5,31)+1;I+=14;for(var G=new t(z),H=new t(19),Q=0;Q<N;++Q)H[s[Q]]=x(e,I+3*Q,7);I+=3*N;var V=E(H),W=(1<<V)-1,j=m(H,V,1);for(Q=0;Q<z;){var Y,K=j[x(e,I,W)];if(I+=15&K,(Y=K>>>4)<16)G[Q++]=Y;else{var q=0,X=0;for(16==Y?(X=3+x(e,I,3),I+=2,q=G[Q-1]):17==Y?(X=3+x(e,I,7),I+=3):18==Y&&(X=11+x(e,I,127),I+=7);X--;)G[Q++]=q}}var $=G.subarray(0,U),J=G.subarray(U);D=E($),P=E(J),R=m($,D,1),B=m(J,P,1)}else S(1);if(I>L){b&&S(0);break}}A&&C(M+131072);for(var Z=(1<<D)-1,ee=(1<<P)-1,et=I;;et=I){var er=(q=R[_(e,I)&Z])>>>4;if((I+=15&q)>L){b&&S(0);break}if(q||S(2),er<256)o[M++]=er;else{if(256==er){et=I,R=null;break}var ei=er-254;if(er>264){var en=n[Q=er-257];ei=x(e,I,(1<<en)-1)+u[Q],I+=en}var ea=B[_(e,I)&ee],es=ea>>>4;if(ea||S(3),I+=15&ea,J=h[es],es>3&&(en=a[es],J+=_(e,I)&(1<<en)-1,I+=en),I>L){b&&S(0);break}A&&C(M+131072);for(var eo=M+ei;M<eo;M+=4)o[M]=o[M-J],o[M+1]=o[M+1-J],o[M+2]=o[M+2-J],o[M+3]=o[M+3-J];M=eo}}l.l=R,l.p=et,l.b=M,R&&(T=1,l.m=D,l.d=B,l.n=P)}while(!T);return M==o.length?o:(c=o,(d=0)<0&&(d=0),(null==(f=M)||f>c.length)&&(f=c.length),(p=new(c instanceof r?r:c instanceof i?i:t)(f-d)).set(c.subarray(d,f)),p)},C=new t(0),T="undefined"!=typeof TextDecoder&&new TextDecoder;try{T.decode(C,{stream:!0})}catch(e){}return e.convert_streams=function(e){var t=new DataView(e),r=0;function i(){var e=t.getUint16(r);return r+=2,e}function n(){var e=t.getUint32(r);return r+=4,e}function a(e){A.setUint16(v,e),v+=2}function s(e){A.setUint32(v,e),v+=4}for(var o={signature:n(),flavor:n(),length:n(),numTables:i(),reserved:i(),totalSfntSize:n(),majorVersion:i(),minorVersion:i(),metaOffset:n(),metaLength:n(),metaOrigLength:n(),privOffset:n(),privLength:n()},l=0;Math.pow(2,l)<=o.numTables;)l++;l--;for(var u=16*Math.pow(2,l),c=16*o.numTables-u,h=12,d=[],f=0;f<o.numTables;f++)d.push({tag:n(),offset:n(),compLength:n(),origLength:n(),origChecksum:n()}),h+=16;var p,m=new Uint8Array(12+16*d.length+d.reduce(function(e,t){return e+t.origLength+4},0)),g=m.buffer,A=new DataView(g),v=0;return s(o.flavor),a(o.numTables),a(u),a(l),a(c),d.forEach(function(e){s(e.tag),s(e.origChecksum),s(h),s(e.origLength),e.outOffset=h,(h+=e.origLength)%4!=0&&(h+=4-h%4)}),d.forEach(function(t){var r=e.slice(t.offset,t.offset+t.compLength);if(t.compLength!=t.origLength){var i=new Uint8Array(t.origLength);w(new Uint8Array(r,2),i)}else i=new Uint8Array(r);m.set(i,t.outOffset);var n=0;(h=t.outOffset+t.origLength)%4!=0&&(n=4-h%4),m.set(new Uint8Array(n).buffer,t.outOffset+t.origLength),p=h+n}),g.slice(0,p)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){let r;let i={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},a=[null,"isol","init","fina","medi"];function s(t,r){let i=t.GDEF&&t.GDEF.glyphClassDef;return i?e.U._getGlyphClass(r,i):0}function o(...e){for(let t=0;t<e.length;t++)if("number"==typeof e[t])return e[t]}return function(l){let u=new Uint8Array(l,0,4),c=e._bin.readASCII(u,0,4);if("wOFF"===c)l=t(l);else if("wOF2"===c)throw Error("woff2 fonts not supported");return function(t){let l=Object.create(null),u=t["OS/2"],c=t.hhea,h=t.head.unitsPerEm,d=o(u&&u.sTypoAscender,c&&c.ascender,h),f={unitsPerEm:h,ascender:d,descender:o(u&&u.sTypoDescender,c&&c.descender,0),capHeight:o(u&&u.sCapHeight,d),xHeight:o(u&&u.sxHeight,d),lineGap:o(u&&u.sTypoLineGap,c&&c.lineGap),supportsCodePoint:r=>e.U.codeToGlyph(t,r)>0,forEachGlyph(o,u,c,h){let d=0,p=1/f.unitsPerEm*u,m=function(t,i){let s=[];for(let r=0;r<i.length;r++){let n=i.codePointAt(r);n>65535&&r++,s.push(e.U.codeToGlyph(t,n))}let o=t.GSUB;if(o){let t;let{lookupList:l,featureList:u}=o,c=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,h=[];u.forEach(o=>{if(c.test(o.tag))for(let u=0;u<o.tab.length;u++){if(h[o.tab[u]])continue;h[o.tab[u]]=!0;let c=l[o.tab[u]],d=/^(isol|init|fina|medi)$/.test(o.tag);d&&!t&&(t=function(e){let t=new Uint8Array(e.length),i=32,a=1,s=-1;for(let o=0;o<e.length;o++){let l=e.codePointAt(o),u=0|function(e){if(!r){let e={R:2,L:1,D:4,C:16,U:32,T:8};for(let t in r=new Map,n){let i=0;n[t].split(",").forEach(n=>{let[a,s]=n.split("+");a=parseInt(a,36),s=s?parseInt(s,36):0,r.set(i+=a,e[t]);for(let n=s;n--;)r.set(++i,e[t])})}}return r.get(e)||32}(l),c=1;!(8&u)&&(21&i?22&u?(c=3,(1===a||3===a)&&t[s]++):33&u&&(2===a||4===a)&&t[s]--:34&i&&(2===a||4===a)&&t[s]--,a=t[o]=c,i=u,s=o,l>65535&&o++)}return t}(i));for(let r=0;r<s.length;r++)t&&d&&a[t[r]]!==o.tag||e.U._applySubs(s,r,c,l)}})}return s}(t,o),g=0,A=function(t,r){let i=new Int16Array(3*r.length),n=0;for(;n<r.length;n++){let u=r[n];if(-1===u)continue;i[3*n+2]=t.hmtx.aWidth[u];let c=t.GPOS;if(c){let h=c.lookupList;for(let c=0;c<h.length;c++){let d=h[c];for(let c=0;c<d.tabs.length;c++){let h=d.tabs[c];if(1===d.ltype){if(-1!==e._lctf.coverageIndex(h.coverage,u)&&h.pos){l(h.pos,n);break}}else if(2===d.ltype){let t=null,i=a();if(-1!==i){let a=e._lctf.coverageIndex(h.coverage,r[i]);if(-1!==a){if(1===h.fmt){let e=h.pairsets[a];for(let r=0;r<e.length;r++)e[r].gid2===u&&(t=e[r])}else if(2===h.fmt){let n=e.U._getGlyphClass(r[i],h.classDef1),a=e.U._getGlyphClass(u,h.classDef2);t=h.matrix[n][a]}if(t){t.val1&&l(t.val1,i),t.val2&&l(t.val2,n);break}}}}else if(4===d.ltype){let t=e._lctf.coverageIndex(h.markCoverage,u);if(-1!==t){let s=a(o),l=-1===s?-1:e._lctf.coverageIndex(h.baseCoverage,r[s]);if(-1!==l){let e=h.markArray[t],r=h.baseArray[l][e.markClass];i[3*n]=r.x-e.x+i[3*s]-i[3*s+2],i[3*n+1]=r.y-e.y+i[3*s+1];break}}}else if(6===d.ltype){let o=e._lctf.coverageIndex(h.mark1Coverage,u);if(-1!==o){let l=a();if(-1!==l){let a=r[l];if(3===s(t,a)){let t=e._lctf.coverageIndex(h.mark2Coverage,a);if(-1!==t){let e=h.mark1Array[o],r=h.mark2Array[t][e.markClass];i[3*n]=r.x-e.x+i[3*l]-i[3*l+2],i[3*n+1]=r.y-e.y+i[3*l+1];break}}}}}}}}else if(t.kern&&!t.cff){let e=a();if(-1!==e){let n=t.kern.glyph1.indexOf(r[e]);if(-1!==n){let r=t.kern.rval[n].glyph2.indexOf(u);-1!==r&&(i[3*e+2]+=t.kern.rval[n].vals[r])}}}}return i;function a(e){for(let t=n-1;t>=0;t--)if(-1!==r[t]&&(!e||e(r[t])))return t;return -1}function o(e){return 1===s(t,e)}function l(e,t){for(let r=0;r<3;r++)i[3*t+r]+=e[r]||0}}(t,m);return m.forEach((r,n)=>{if(-1!==r){let a=l[r];if(!a){let n,s,o,u;let{cmds:c,crds:h}=e.U.glyphToPath(t,r),d="",f=0;for(let e=0,t=c.length;e<t;e++){let t=i[c[e]];d+=c[e];for(let e=1;e<=t;e++)d+=(e>1?",":"")+h[f++]}if(h.length){n=s=1/0,o=u=-1/0;for(let e=0,t=h.length;e<t;e+=2){let t=h[e],r=h[e+1];t<n&&(n=t),r<s&&(s=r),t>o&&(o=t),r>u&&(u=r)}}else n=o=s=u=0;a=l[r]={index:r,advanceWidth:t.hmtx.aWidth[r],xMin:n,yMin:s,xMax:o,yMax:u,path:d}}h.call(null,a,d+A[3*n]*p,A[3*n+1]*p,g),d+=A[3*n+2]*p,c&&(d+=c*u)}g+=o.codePointAt(g)>65535?2:1}),d}};return f}(e.parse(l)[0])}}],init:(e,t,r)=>r(e(),t())}),xz=xb({name:"FontResolver",dependencies:[function(e,t){let r=Object.create(null),i=Object.create(null);function n(t,n){let a=r[t];a?n(a):i[t]?i[t].push(n):(i[t]=[n],function(t,r){let i=e=>{console.error(`Failure loading font ${t}`,e)};try{let n=new XMLHttpRequest;n.open("get",t,!0),n.responseType="arraybuffer",n.onload=function(){if(n.status>=400)i(Error(n.statusText));else if(n.status>0)try{let i=e(n.response);i.src=t,r(i)}catch(e){i(e)}},n.onerror=i,n.send()}catch(e){i(e)}}(t,e=>{e.src=t,r[t]=e,i[t].forEach(t=>t(e)),delete i[t]}))}return function(e,i,{lang:a,fonts:s=[],style:o="normal",weight:l="normal",unicodeFontsURL:u}={}){let c=new Uint8Array(e.length),h=[];e.length||m();let d=new Map,f=[];if("italic"!==o&&(o="normal"),"number"!=typeof l&&(l="bold"===l?700:400),s&&!Array.isArray(s)&&(s=[s]),(s=s.slice().filter(e=>!e.lang||e.lang.test(a)).reverse()).length){let t=0;!function i(a=0){for(let o=a,l=e.length;o<l;o++){let a=e.codePointAt(o);if(1===t&&h[c[o-1]].supportsCodePoint(a)||o>0&&/\s/.test(e[o]))c[o]=c[o-1],2===t&&(f[f.length-1][1]=o);else for(let e=c[o],l=s.length;e<=l;e++)if(e===l)(2===t?f[f.length-1]:f[f.length]=[o,o])[1]=o,t=2;else{c[o]=e;let{src:l,unicodeRange:u}=s[e];if(!u||function(e,t){for(let r=0;r<t.length;r++){let[i,n=i]=t[r];if(i<=e&&e<=n)return!0}return!1}(a,u)){let e=r[l];if(!e){n(l,()=>{i(o)});return}if(e.supportsCodePoint(a)){let r=d.get(e);"number"!=typeof r&&(r=h.length,h.push(e),d.set(e,r)),c[o]=r,t=1;break}}}a>65535&&o+1<l&&(c[o+1]=c[o],o++,2===t&&(f[f.length-1][1]=o))}p()}()}else f.push([0,e.length-1]),p();function p(){if(f.length){let r=f.map(t=>e.substring(t[0],t[1]+1)).join("\n");t.getFontsForString(r,{lang:a||void 0,style:o,weight:l,dataUrl:u}).then(({fontUrls:e,chars:t})=>{let r=h.length,i=0;f.forEach(e=>{for(let n=0,a=e[1]-e[0];n<=a;n++)c[e[0]+n]=t[i++]+r;i++});let a=0;e.forEach((t,i)=>{n(t,t=>{h[i+r]=t,++a===e.length&&m()})})})}else m()}function m(){i({chars:c,fonts:h})}}},xN,function(){return function(e){var t=function(){this.buckets=new Map};function r(e,t){var r=255&e,i=t.codePointAt(r/6|0);return 0!=((i=(i||48)-48)&1<<r%6)}function i(e,t){!function(e,t){e.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(e){return e.split("-").map(function(e){return parseInt(e.trim(),16)})}).forEach(function(e){var r=e[0],i=e[1];void 0===i&&(i=r),t(r,i)})}(e,function(e,r){for(var i=e;i<=r;i++)t(i)})}t.prototype.add=function(e){var t=e>>5;this.buckets.set(t,(this.buckets.get(t)||0)|1<<(31&e))},t.prototype.has=function(e){var t=this.buckets.get(e>>5);return void 0!==t&&0!=(t&1<<(31&e))},t.prototype.serialize=function(){var e=[];return this.buckets.forEach(function(t,r){e.push((+r).toString(36)+":"+t.toString(36))}),e.join(",")},t.prototype.deserialize=function(e){var t=this;this.buckets.clear(),e.split(",").forEach(function(e){var r=e.split(":");t.buckets.set(parseInt(r[0],36),parseInt(r[1],36))})};var n,a={},s={},o=new WeakMap,l="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data",u=new Map;function c(e,t,r){return e[t]?t:e[r]?r:function(e){for(var t in e)return t}(e)}return e.CodePointSet=t,e.clearCache=function(){a={},s={}},e.getFontsForString=function(e,h){void 0===h&&(h={});var d=h.lang;void 0===d&&(d=/\p{Script=Hangul}/u.test(e)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(e)?"ja":"en");var f=h.category;void 0===f&&(f="sans-serif");var p=h.style;void 0===p&&(p="normal");var m=h.weight;void 0===m&&(m=400);var g=(h.dataUrl||l).replace(/\/$/g,""),A=new Map,v=new Uint8Array(e.length),y={},E={},x=Array(e.length),_=new Map,b=!1;function S(e){var t=u.get(e);return t||(t=fetch(g+"/"+e).then(function(e){if(!e.ok)throw Error(e.statusText);return e.json().then(function(e){if(!Array.isArray(e)||1!==e[0])throw Error("Incorrect schema version; need 1, got "+e[0]);return e[1]})}).catch(function(t){if(g!==l)return b||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+g+'", trying default CDN. '+t.message),b=!0),g=l,u.delete(e),S(e);throw t}),u.set(e,t)),t}for(var w=0;w<e.length;w++)(function(t){var r=e.codePointAt(t),i=function(e){var t=(-256&e).toString(16),r=((-256&e)+256-1).toString(16);return"codepoint-index/plane"+(e>>16)+"/"+t+"-"+r+".json"}(r);x[t]=i,a[i]||_.has(i)||_.set(i,S(i).then(function(e){a[i]=e})),r>65535&&(w=++t)})(w);return Promise.all(_.values()).then(function(){_.clear();for(var t=0;t<e.length;t++)(function(i){var n=e.codePointAt(i),o=null,l=a[x[i]],u=void 0;for(var c in l){var h=E[c];if(void 0===h&&(h=E[c]=new RegExp(c).test(d||"en")),h){for(var f in u=c,l[c])if(r(n,l[c][f])){o=f;break}break}}if(!o){a:for(var p in l)if(p!==u){for(var m in l[p])if(r(n,l[p][m])){o=m;break a}}}o||(console.debug("No font coverage for U+"+n.toString(16)),o="latin"),x[i]=o,s[o]||_.has(o)||_.set(o,S("font-meta/"+o+".json").then(function(e){s[o]=e})),n>65535&&(t=++i)})(t);return Promise.all(_.values())}).then(function(){for(var r,a=null,l=0;l<e.length;l++){var u=e.codePointAt(l);if(a&&(n||(n=new Set,i("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(e){n.add(e)})),n.has(u)||(function(e){var r=o.get(e);return r||(r=new t,i(e.ranges,function(e){return r.add(e)}),o.set(e,r)),r})(a).has(u)))v[l]=v[l-1];else{var h=y[(a=s[x[l]]).id];if(!h){var d=a.typeforms,E=c(d,f,"sans-serif"),_=c(d[E],p,"normal"),b=function(e,t){var r=t;if(!e.includes(r)){r=1/0;for(var i=0;i<e.length;i++)Math.abs(e[i]-t)<Math.abs(r-t)&&(r=e[i])}return r}(null===(r=d[E])||void 0===r?void 0:r[_],m);h=y[a.id]=g+"/font-files/"+a.id+"/"+E+"."+_+"."+b+".woff"}var S=A.get(h);null==S&&(S=A.size,A.set(h,S)),v[l]=S}u>65535&&(v[++l]=v[l-1])}return{fontUrls:Array.from(A.keys()),chars:v}})},Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,t,r)=>e(t,r())}),xG=()=>(self.performance||Date).now(),xH=xC(),xQ=[],xV=0;function xW(){let e=xG();for(;xQ.length&&xG()-e<5;)xQ.shift()();xV=xQ.length?setTimeout(xW,0):0}let xj=(...e)=>new Promise((t,r)=>{xQ.push(()=>{let i=xG();try{xH.webgl.generateIntoCanvas(...e),t({timing:xG()-i})}catch(e){r(e)}}),xV||(xV=setTimeout(xW,0))}),xY={},xK=0;function xq(e,t,r,i,n,a,s,o,l,u){let c="TroikaTextSDFGenerator_JS_"+xK++%4,h=xY[c];return h||(h=xY[c]={workerModule:xb({name:c,workerId:c,dependencies:[xC,xG],init(e,t){let r=e().javascript.generate;return function(...e){let i=t();return{textureData:r(...e),timing:t()-i}}},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(e,t,r,i,n,a).then(({textureData:r,timing:i})=>{let n=xG(),a=new Uint8Array(4*r.length);for(let e=0;e<r.length;e++)a[4*e+u]=r[e];return xH.webglUtils.renderImageData(s,a,o,l,e,t,1<<3-u),i+=xG()-n,0==--h.requests&&(h.idleTimer=setTimeout(()=>{xx[c]&&xx[c].forEach(function(e){e()}),xE[c]&&(xE[c].terminate(),delete xE[c])},2e3)),{timing:i}})}let xX=xH.webglUtils.resizeWebGLCanvasWithoutClearing,x$={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048,useWorker:!0},xJ=new aQ;function xZ(){return(self.performance||Date).now()}let x0=Object.create(null);function x1(e,t){e=function(e,t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}({},e);let r=xZ(),{defaultFontURL:i}=x$,n=[];if(i&&n.push({label:"default",src:x3(i)}),e.font&&n.push({label:"user",src:x3(e.font)}),e.font=n,e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||x$.sdfGlyphSize,e.unicodeFontsURL=e.unicodeFontsURL||x$.unicodeFontsURL,null!=e.colorRanges){let t={};for(let r in e.colorRanges)if(e.colorRanges.hasOwnProperty(r)){let i=e.colorRanges[r];"number"!=typeof i&&(i=xJ.set(i).getHex()),t[r]=i}e.colorRanges=t}Object.freeze(e);let{textureWidth:a,sdfExponent:s}=x$,{sdfGlyphSize:o}=e,l=a/o*4,u=x0[o];if(!u){let e=document.createElement("canvas");e.width=a,e.height=256*o/l,(u=x0[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:e,sdfTexture:new nC(e,void 0,void 0,void 0,tZ,tZ),contextLost:!1,glyphsByFont:new Map}).sdfTexture.generateMipmaps=!1,function(e){let t=e.sdfCanvas;t.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),e.contextLost=!0}),t.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),e.contextLost=!1;let r=[];e.glyphsByFont.forEach(t=>{t.forEach(t=>{r.push(x2(t,e,!0))})}),Promise.all(r).then(()=>{x4(e),e.sdfTexture.needsUpdate=!0})})}(u)}let{sdfTexture:c,sdfCanvas:h}=u;(x$.useWorker?x6:x8)(e).then(i=>{let{glyphIds:n,glyphFontIndices:d,fontData:f,glyphPositions:p,fontSize:m,timings:g}=i,A=[],v=new Float32Array(4*n.length),y=0,E=0,x=xZ(),_=f.map(e=>{let t=u.glyphsByFont.get(e.src);return t||u.glyphsByFont.set(e.src,t=new Map),t});n.forEach((e,t)=>{let r=d[t],{src:a,unitsPerEm:s}=f[r],l=_[r].get(e);if(!l){let{path:t,pathBounds:n}=i.glyphData[a][e],s=Math.max(n[2]-n[0],n[3]-n[1])/o*(x$.sdfMargin*o+.5),c=u.glyphCount++,h=[n[0]-s,n[1]-s,n[2]+s,n[3]+s];_[r].set(e,l={path:t,atlasIndex:c,sdfViewBox:h}),A.push(l)}let{sdfViewBox:c}=l,h=p[E++],g=p[E++],x=m/s;v[y++]=h+c[0]*x,v[y++]=g+c[1]*x,v[y++]=h+c[2]*x,v[y++]=g+c[3]*x,n[t]=l.atlasIndex}),g.quads=(g.quads||0)+(xZ()-x);let b=xZ();g.sdf={};let S=h.height,w=Math.pow(2,Math.ceil(Math.log2(Math.ceil(u.glyphCount/l)*o)));w>S&&(console.info(`Increasing SDF texture size ${S}->${w}`),xX(h,a,w),c.dispose()),Promise.all(A.map(t=>x2(t,u,e.gpuAccelerateSDF).then(({timing:e})=>{g.sdf[t.atlasIndex]=e}))).then(()=>{A.length&&!u.contextLost&&(x4(u),c.needsUpdate=!0),g.sdfTotal=xZ()-b,g.total=xZ()-r,t(Object.freeze({parameters:e,sdfTexture:c,sdfGlyphSize:o,sdfExponent:s,glyphBounds:v,glyphAtlasIndices:n,glyphColors:i.glyphColors,caretPositions:i.caretPositions,chunkedBounds:i.chunkedBounds,ascender:i.ascender,descender:i.descender,lineHeight:i.lineHeight,capHeight:i.capHeight,xHeight:i.xHeight,topBaseline:i.topBaseline,blockBounds:i.blockBounds,visibleBounds:i.visibleBounds,timings:i.timings}))})}),Promise.resolve().then(()=>{!u.contextLost&&(h._warm||(xH.webgl.isSupported(h),h._warm=!0))})}function x2({path:e,atlasIndex:t,sdfViewBox:r},{sdfGlyphSize:i,sdfCanvas:n,contextLost:a},s){if(a)return Promise.resolve({timing:-1});let{textureWidth:o,sdfExponent:l}=x$,u=Math.max(r[2]-r[0],r[3]-r[1]),c=Math.floor(t/4),h=c%(o/i)*i,d=Math.floor(c/(o/i))*i;return function(e,t,r,i,n,a,s,o,l,u,c=!0){return c?xj(e,t,r,i,n,a,s,o,l,u).then(null,c=>(f||(console.warn("WebGL SDF generation failed, falling back to JS",c),f=!0),xq(e,t,r,i,n,a,s,o,l,u))):xq(e,t,r,i,n,a,s,o,l,u)}(i,i,e,r,u,l,n,h,d,t%4,s)}function x3(e){return p||(p="undefined"==typeof document?{}:document.createElement("a")),p.href=e,p.href}function x4(e){if("function"!=typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");let{sdfCanvas:t,sdfTexture:r}=e,{width:i,height:n}=t,a=e.sdfCanvas.getContext("webgl"),s=r.image.data;s&&s.length===i*n*4||(s=new Uint8Array(i*n*4),r.image={width:i,height:n,data:s},r.flipY=!1,r.isDataTexture=!0),a.readPixels(0,0,i,n,a.RGBA,a.UNSIGNED_BYTE,s)}}let x5=xb({name:"Typesetter",dependencies:[function(e,t){let r=1/0,i=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,n=`[^\\S\\u00A0]`,a=RegExp(`${n}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function s({text:s="",font:h,lang:d,sdfGlyphSize:f=64,fontSize:p=400,fontWeight:m=1,fontStyle:g="normal",letterSpacing:A=0,lineHeight:v="normal",maxWidth:y=r,direction:E,textAlign:x="left",textIndent:_=0,whiteSpace:b="normal",overflowWrap:S="normal",anchorX:w=0,anchorY:C=0,metricsOnly:T=!1,unicodeFontsURL:I,preResolvedFonts:M=null,includeCaretPositions:R=!1,chunkedBoundsSize:B=8192,colorRanges:D=null},P){let L=u(),k={fontLoad:0,typesetting:0};s.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),s=s.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),p=+p,A=+A,y=+y,v=v||"normal",_=+_,function({text:t,lang:r,fonts:i,style:n,weight:a,preResolvedFonts:s,unicodeFontsURL:o},l){let u=({chars:e,fonts:t})=>{let r,i;let n=[];for(let a=0;a<e.length;a++)e[a]!==i?(i=e[a],n.push(r={start:a,end:a,fontObj:t[e[a]]})):r.end=a;l(n)};s?u(s):e(t,u,{lang:r,fonts:i,style:n,weight:a,unicodeFontsURL:o})}({text:s,lang:d,style:g,weight:m,fonts:"string"==typeof h?[{src:h}]:h,unicodeFontsURL:I,preResolvedFonts:M},e=>{k.fontLoad=u()-L;let h=isFinite(y),d=null,f=null,m=null,g=null,I=null,M=null,F=null,O=null,U=0,N=0,z="nowrap"!==b,G=new Map,H=u(),Q=_,V=0,W=new c,j=[W];e.forEach(e=>{let t,r;let{fontObj:o}=e,{ascender:l,descender:u,unitsPerEm:d,lineGap:f,capHeight:m,xHeight:g}=o,E=G.get(o);if(!E){let e=p/d,t="normal"===v?(l-u+f)*e:v*p,r=(t-(l-u)*e)/2,i=Math.min(t,(l-u)*e),n=(l+u)/2*e+i/2;E={index:G.size,src:o.src,fontObj:o,fontSizeMult:e,unitsPerEm:d,ascender:l*e,descender:u*e,capHeight:m*e,xHeight:g*e,lineHeight:t,baseline:-r-l*e,caretTop:n,caretBottom:n-i},G.set(o,E)}let{fontSizeMult:x}=E,b=s.slice(e.start,e.end+1);o.forEachGlyph(b,p,A,(o,l,u,d)=>{let f;l+=V,d+=e.start,t=l,r=o;let m=s.charAt(d),g=o.advanceWidth*x,v=W.count;if("isEmpty"in o||(o.isWhitespace=!!m&&new RegExp(n).test(m),o.canBreakAfter=!!m&&a.test(m),o.isEmpty=o.xMin===o.xMax||o.yMin===o.yMax||i.test(m)),!o.isWhitespace&&!o.isEmpty&&N++,z&&h&&!o.isWhitespace&&l+g+Q>y&&v){if(W.glyphAt(v-1).glyphObj.canBreakAfter)f=new c,Q=-l;else for(let e=v;e--;){if(0===e&&"break-word"===S){f=new c,Q=-l;break}if(W.glyphAt(e).glyphObj.canBreakAfter){let t=(f=W.splitAt(e+1)).glyphAt(0).x;Q-=t;for(let e=f.count;e--;)f.glyphAt(e).x-=t;break}}f&&(W.isSoftWrapped=!0,W=f,j.push(W),U=y)}let b=W.glyphAt(W.count);b.glyphObj=o,b.x=l+Q,b.y=u,b.width=g,b.charIndex=d,b.fontData=E,"\n"===m&&(W=new c,j.push(W),Q=-(l+g+A*p)+_)}),V=t+r.advanceWidth*x+A*p});let Y=0;j.forEach(e=>{let t=!0;for(let r=e.count;r--;){let i=e.glyphAt(r);t&&!i.glyphObj.isWhitespace&&(e.width=i.x+i.width,e.width>U&&(U=e.width),t=!1);let{lineHeight:n,capHeight:a,xHeight:s,baseline:o}=i.fontData;n>e.lineHeight&&(e.lineHeight=n);let l=o-e.baseline;l<0&&(e.baseline+=l,e.cap+=l,e.ex+=l),e.cap=Math.max(e.cap,e.baseline+a),e.ex=Math.max(e.ex,e.baseline+s)}e.baseline-=Y,e.cap-=Y,e.ex-=Y,Y+=e.lineHeight});let K=0,q=0;if(w&&("number"==typeof w?K=-w:"string"==typeof w&&(K=-U*("left"===w?0:"center"===w?.5:"right"===w?1:o(w)))),C&&("number"==typeof C?q=-C:"string"==typeof C&&(q="top"===C?0:"top-baseline"===C?-j[0].baseline:"top-cap"===C?-j[0].cap:"top-ex"===C?-j[0].ex:"middle"===C?Y/2:"bottom"===C?Y:"bottom-baseline"===C?-j[j.length-1].baseline:o(C)*Y)),!T){let e,i;let n=t.getEmbeddingLevels(s,E);d=new Uint16Array(N),f=new Uint8Array(N),m=new Float32Array(2*N),g={},F=[r,r,-r,-r],O=[],R&&(M=new Float32Array(4*s.length)),D&&(I=new Uint8Array(3*N));let a=0,o=-1,u=-1;if(j.forEach((c,h)=>{let{count:p,width:A}=c;if(p>0){let h,v=0;for(let e=p;e--&&c.glyphAt(e).glyphObj.isWhitespace;)v++;let y=0,E=0;if("center"===x)y=(U-A)/2;else if("right"===x)y=U-A;else if("justify"===x&&c.isSoftWrapped){let e=0;for(let t=p-v;t--;)c.glyphAt(t).glyphObj.isWhitespace&&e++;E=(U-A)/e}if(E||y){let e=0;for(let t=0;t<p;t++){let r=c.glyphAt(t),i=r.glyphObj;r.x+=y+e,0!==E&&i.isWhitespace&&t<p-v&&(e+=E,r.width+=E)}}let _=t.getReorderSegments(s,n,c.glyphAt(0).charIndex,c.glyphAt(c.count-1).charIndex);for(let e=0;e<_.length;e++){let[t,r]=_[e],i=1/0,n=-1/0;for(let e=0;e<p;e++)if(c.glyphAt(e).charIndex>=t){let t=e,a=e;for(;a<p;a++){let e=c.glyphAt(a);if(e.charIndex>r)break;a<p-v&&(i=Math.min(i,e.x),n=Math.max(n,e.x+e.width))}for(let e=t;e<a;e++){let t=c.glyphAt(e);t.x=n-(t.x+t.width-i)}break}}let b=e=>h=e;for(let A=0;A<p;A++){let p=c.glyphAt(A),v=(h=p.glyphObj).index,y=1&n.levels[p.charIndex];if(y){let e=t.getMirroredCharacter(s[p.charIndex]);e&&p.fontData.fontObj.forEachGlyph(e,0,0,b)}if(R){let{charIndex:e,fontData:t}=p,r=p.x+K,i=p.x+p.width+K;M[4*e]=y?i:r,M[4*e+1]=y?r:i,M[4*e+2]=c.baseline+t.caretBottom+q,M[4*e+3]=c.baseline+t.caretTop+q;let n=e-o;n>1&&l(M,o,n),o=e}if(D){let{charIndex:e}=p;for(;e>u;)u++,D.hasOwnProperty(u)&&(i=D[u])}if(!h.isWhitespace&&!h.isEmpty){let t=a++,{fontSizeMult:n,src:s,index:o}=p.fontData,l=g[s]||(g[s]={});l[v]||(l[v]={path:h.path,pathBounds:[h.xMin,h.yMin,h.xMax,h.yMax]});let u=p.x+K,A=p.y+c.baseline+q;m[2*t]=u,m[2*t+1]=A;let y=u+h.xMin*n,E=A+h.yMin*n,x=u+h.xMax*n,_=A+h.yMax*n;y<F[0]&&(F[0]=y),E<F[1]&&(F[1]=E),x>F[2]&&(F[2]=x),_>F[3]&&(F[3]=_),t%B==0&&(e={start:t,end:t,rect:[r,r,-r,-r]},O.push(e)),e.end++;let b=e.rect;if(y<b[0]&&(b[0]=y),E<b[1]&&(b[1]=E),x>b[2]&&(b[2]=x),_>b[3]&&(b[3]=_),d[t]=v,f[t]=o,D){let e=3*t;I[e]=i>>16&255,I[e+1]=i>>8&255,I[e+2]=255&i}}}}}),M){let e=s.length-o;e>1&&l(M,o,e)}}let X=[];G.forEach(({index:e,src:t,unitsPerEm:r,ascender:i,descender:n,lineHeight:a,capHeight:s,xHeight:o})=>{X[e]={src:t,unitsPerEm:r,ascender:i,descender:n,lineHeight:a,capHeight:s,xHeight:o}}),k.typesetting=u()-H,P({glyphIds:d,glyphFontIndices:f,glyphPositions:m,glyphData:g,fontData:X,caretPositions:M,glyphColors:I,chunkedBounds:O,fontSize:p,topBaseline:q+j[0].baseline,blockBounds:[K,q-Y,K+U,q],visibleBounds:F,timings:k})})}function o(e){let t=e.match(/^([\d.]+)%$/),r=t?parseFloat(t[1]):NaN;return isNaN(r)?0:r/100}function l(e,t,r){let i=e[4*t],n=e[4*t+1],a=e[4*t+2],s=e[4*t+3],o=(n-i)/r;for(let n=0;n<r;n++){let r=(t+n)*4;e[r]=i+o*n,e[r+1]=i+o*(n+1),e[r+2]=a,e[r+3]=s}}function u(){return(self.performance||Date).now()}function c(){this.data=[]}let h=["glyphObj","x","y","width","charIndex","fontData"];return c.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt(e){let t=c.flyweight;return t.data=this.data,t.index=e,t},splitAt(e){let t=new c;return t.data=this.data.splice(e*h.length),t}},c.flyweight=h.reduce((e,t,r,i)=>(Object.defineProperty(e,t,{get(){return this.data[this.index*h.length+r]},set(e){this.data[this.index*h.length+r]=e}}),e),{data:null,index:0}),{typeset:s,measure:function(e,t){s({...e,metricsOnly:!0},e=>{let[r,i,n,a]=e.blockBounds;t({width:n-r,height:a-i})})}}},xz,function(){return function(e){var t,r,i,n,a={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},s={},o={};s.L=1,o[1]="L",Object.keys(a).forEach(function(e,t){s[e]=1<<t+1,o[s[e]]=e}),Object.freeze(s);var l=s.LRI|s.RLI|s.FSI,u=s.L|s.R|s.AL,c=s.B|s.S|s.WS|s.ON|s.FSI|s.LRI|s.RLI|s.PDI,h=s.BN|s.RLE|s.LRE|s.RLO|s.LRO|s.PDF,d=s.S|s.WS|s.B|l|s.PDI|h,f=null;function p(e){return function(){if(!f){f=new Map;var e=function(e){if(a.hasOwnProperty(e)){var t=0;a[e].split(",").forEach(function(r){var i=r.split("+"),n=i[0],a=i[1];n=parseInt(n,36),a=a?parseInt(a,36):0,f.set(t+=n,s[e]);for(var o=0;o<a;o++)f.set(++t,s[e])})}};for(var t in a)e(t)}}(),f.get(e.codePointAt(0))||s.L}var m={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function g(e,t){var r,i=0,n=new Map,a=t&&new Map;return e.split(",").forEach(function e(s){if(-1!==s.indexOf("+"))for(var o=+s;o--;)e(r);else{r=s;var l=s.split(">"),u=l[0],c=l[1];u=String.fromCodePoint(i+=parseInt(u,36)),c=String.fromCodePoint(i+=parseInt(c,36)),n.set(u,c),t&&a.set(c,u)}}),{map:n,reverseMap:a}}function A(){if(!t){var e=g(m.pairs,!0),n=e.map,a=e.reverseMap;t=n,r=a,i=g(m.canonical,!1).map}}function v(e){return A(),t.get(e)||null}function y(e){return A(),r.get(e)||null}function E(e){return A(),i.get(e)||null}var x=s.L,_=s.R,b=s.EN,S=s.ES,w=s.ET,C=s.AN,T=s.CS,I=s.B,M=s.S,R=s.ON,B=s.BN,D=s.NSM,P=s.AL,L=s.LRO,k=s.RLO,F=s.LRE,O=s.RLE,U=s.PDF,N=s.LRI,z=s.RLI,G=s.FSI,H=s.PDI;function Q(e){return function(){if(!n){var e=g("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach(function(e,r){t.set(r,e)}),n=t}}(),n.get(e)||null}function V(e,t,r,i){var n=e.length;r=Math.max(0,null==r?0:+r),i=Math.min(n-1,null==i?n-1:+i);var a=[];return t.paragraphs.forEach(function(n){var s=Math.max(r,n.start),o=Math.min(i,n.end);if(s<o){for(var l=t.levels.slice(s,o+1),u=o;u>=s&&p(e[u])&d;u--)l[u]=n.level;for(var c=n.level,h=1/0,f=0;f<l.length;f++){var m=l[f];m>c&&(c=m),m<h&&(h=1|m)}for(var g=c;g>=h;g--)for(var A=0;A<l.length;A++)if(l[A]>=g){for(var v=A;A+1<l.length&&l[A+1]>=g;)A++;A>v&&a.push([v+s,A+s])}}}),a}function W(e,t,r,i){for(var n=V(e,t,r,i),a=[],s=0;s<e.length;s++)a[s]=s;return n.forEach(function(e){for(var t=e[0],r=e[1],i=a.slice(t,r+1),n=i.length;n--;)a[r-n]=i[n]}),a}return e.closingToOpeningBracket=y,e.getBidiCharType=p,e.getBidiCharTypeName=function(e){return o[p(e)]},e.getCanonicalBracket=E,e.getEmbeddingLevels=function(e,t){for(var r=new Uint32Array(e.length),i=0;i<e.length;i++)r[i]=p(e[i]);var n=new Map;function a(e,t){var i=r[e];r[e]=t,n.set(i,n.get(i)-1),i&c&&n.set(c,n.get(c)-1),n.set(t,(n.get(t)||0)+1),t&c&&n.set(c,(n.get(c)||0)+1)}for(var s=new Uint8Array(e.length),o=new Map,f=[],m=null,g=0;g<e.length;g++)m||f.push(m={start:g,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:tR(g,!1)}),r[g]&I&&(m.end=g,m=null);for(var A=O|F|k|L|l|H|U|I,Q=function(e){return e+(1&e?1:2)},V=function(e){return e+(1&e?2:1)},W=0;W<f.length;W++){var j=[{_level:(m=f[W]).level,_override:0,_isolate:0}],Y=void 0,K=0,q=0,X=0;n.clear();for(var $=m.start;$<=m.end;$++){var J=r[$];if(Y=j[j.length-1],n.set(J,(n.get(J)||0)+1),J&c&&n.set(c,(n.get(c)||0)+1),J&A){if(J&(O|F)){s[$]=Y._level;var Z=(J===O?V:Q)(Y._level);!(Z<=125)||K||q?!K&&q++:j.push({_level:Z,_override:0,_isolate:0})}else if(J&(k|L)){s[$]=Y._level;var ee=(J===k?V:Q)(Y._level);!(ee<=125)||K||q?!K&&q++:j.push({_level:ee,_override:J&k?_:x,_isolate:0})}else if(J&l){J&G&&(J=1===tR($+1,!0)?z:N),s[$]=Y._level,Y._override&&a($,Y._override);var et=(J===z?V:Q)(Y._level);et<=125&&0===K&&0===q?(X++,j.push({_level:et,_override:0,_isolate:1,_isolInitIndex:$})):K++}else if(J&H){if(K>0)K--;else if(X>0){for(q=0;!j[j.length-1]._isolate;)j.pop();var er=j[j.length-1]._isolInitIndex;null!=er&&(o.set(er,$),o.set($,er)),j.pop(),X--}Y=j[j.length-1],s[$]=Y._level,Y._override&&a($,Y._override)}else J&U?(0===K&&(q>0?q--:!Y._isolate&&j.length>1&&(j.pop(),Y=j[j.length-1])),s[$]=Y._level):J&I&&(s[$]=m.level)}else s[$]=Y._level,Y._override&&J!==B&&a($,Y._override)}for(var ei=[],en=null,ea=m.start;ea<=m.end;ea++){var es=r[ea];if(!(es&h)){var eo=s[ea],el=es&l,eu=es===H;en&&eo===en._level?(en._end=ea,en._endsWithIsolInit=el):ei.push(en={_start:ea,_end:ea,_level:eo,_startsWithPDI:eu,_endsWithIsolInit:el})}}for(var ec=[],eh=0;eh<ei.length;eh++){var ed=ei[eh];if(!ed._startsWithPDI||ed._startsWithPDI&&!o.has(ed._start)){for(var ef=[en=ed],ep=void 0;en&&en._endsWithIsolInit&&null!=(ep=o.get(en._end));)for(var em=eh+1;em<ei.length;em++)if(ei[em]._start===ep){ef.push(en=ei[em]);break}for(var eg=[],eA=0;eA<ef.length;eA++)for(var ev=ef[eA],ey=ev._start;ey<=ev._end;ey++)eg.push(ey);for(var eE=s[eg[0]],ex=m.level,e_=eg[0]-1;e_>=0;e_--)if(!(r[e_]&h)){ex=s[e_];break}var eb=eg[eg.length-1],eS=s[eb],ew=m.level;if(!(r[eb]&l)){for(var eC=eb+1;eC<=m.end;eC++)if(!(r[eC]&h)){ew=s[eC];break}}ec.push({_seqIndices:eg,_sosType:Math.max(ex,eE)%2?_:x,_eosType:Math.max(ew,eS)%2?_:x})}}for(var eT=0;eT<ec.length;eT++){var eI=ec[eT],eM=eI._seqIndices,eR=eI._sosType,eB=eI._eosType,eD=1&s[eM[0]]?_:x;if(n.get(D))for(var eP=0;eP<eM.length;eP++){var eL=eM[eP];if(r[eL]&D){for(var ek=eR,eF=eP-1;eF>=0;eF--)if(!(r[eM[eF]]&h)){ek=r[eM[eF]];break}a(eL,ek&(l|H)?R:ek)}}if(n.get(b))for(var eO=0;eO<eM.length;eO++){var eU=eM[eO];if(r[eU]&b)for(var eN=eO-1;eN>=-1;eN--){var ez=-1===eN?eR:r[eM[eN]];if(ez&u){ez===P&&a(eU,C);break}}}if(n.get(P))for(var eG=0;eG<eM.length;eG++){var eH=eM[eG];r[eH]&P&&a(eH,_)}if(n.get(S)||n.get(T))for(var eQ=1;eQ<eM.length-1;eQ++){var eV=eM[eQ];if(r[eV]&(S|T)){for(var eW=0,ej=0,eY=eQ-1;eY>=0&&(eW=r[eM[eY]])&h;eY--);for(var eK=eQ+1;eK<eM.length&&(ej=r[eM[eK]])&h;eK++);eW===ej&&(r[eV]===S?eW===b:eW&(b|C))&&a(eV,eW)}}if(n.get(b)){for(var eq=0;eq<eM.length;eq++)if(r[eM[eq]]&b){for(var eX=eq-1;eX>=0&&r[eM[eX]]&(w|h);eX--)a(eM[eX],b);for(eq++;eq<eM.length&&r[eM[eq]]&(w|h|b);eq++)r[eM[eq]]!==b&&a(eM[eq],b)}}if(n.get(w)||n.get(S)||n.get(T))for(var e$=0;e$<eM.length;e$++){var eJ=eM[e$];if(r[eJ]&(w|S|T)){a(eJ,R);for(var eZ=e$-1;eZ>=0&&r[eM[eZ]]&h;eZ--)a(eM[eZ],R);for(var e0=e$+1;e0<eM.length&&r[eM[e0]]&h;e0++)a(eM[e0],R)}}if(n.get(b))for(var e1=0,e2=eR;e1<eM.length;e1++){var e3=eM[e1],e4=r[e3];e4&b?e2===x&&a(e3,x):e4&u&&(e2=e4)}if(n.get(c)){for(var e5=_|b|C,e6=e5|x,e8=[],e9=[],e7=0;e7<eM.length;e7++)if(r[eM[e7]]&c){var te=e[eM[e7]],tt=void 0;if(null!==v(te)){if(e9.length<63)e9.push({char:te,seqIndex:e7});else break}else if(null!==(tt=y(te)))for(var tr=e9.length-1;tr>=0;tr--){var ti=e9[tr].char;if(ti===tt||ti===y(E(te))||v(E(ti))===te){e8.push([e9[tr].seqIndex,e7]),e9.length=tr;break}}}e8.sort(function(e,t){return e[0]-t[0]});for(var tn=0;tn<e8.length;tn++){for(var ta=e8[tn],ts=ta[0],to=ta[1],tl=!1,tu=0,tc=ts+1;tc<to;tc++){var th=eM[tc];if(r[th]&e6){tl=!0;var td=r[th]&e5?_:x;if(td===eD){tu=td;break}}}if(tl&&!tu){tu=eR;for(var tf=ts-1;tf>=0;tf--){var tp=eM[tf];if(r[tp]&e6){var tm=r[tp]&e5?_:x;tu=tm!==eD?tm:eD;break}}}if(tu){if(r[eM[ts]]=r[eM[to]]=tu,tu!==eD){for(var tg=ts+1;tg<eM.length;tg++)if(!(r[eM[tg]]&h)){p(e[eM[tg]])&D&&(r[eM[tg]]=tu);break}}if(tu!==eD){for(var tA=to+1;tA<eM.length;tA++)if(!(r[eM[tA]]&h)){p(e[eM[tA]])&D&&(r[eM[tA]]=tu);break}}}}for(var tv=0;tv<eM.length;tv++)if(r[eM[tv]]&c){for(var ty=tv,tE=tv,tx=eR,t_=tv-1;t_>=0;t_--)if(r[eM[t_]]&h)ty=t_;else{tx=r[eM[t_]]&e5?_:x;break}for(var tb=eB,tS=tv+1;tS<eM.length;tS++)if(r[eM[tS]]&(c|h))tE=tS;else{tb=r[eM[tS]]&e5?_:x;break}for(var tw=ty;tw<=tE;tw++)r[eM[tw]]=tx===tb?tx:eD;tv=tE}}}for(var tC=m.start;tC<=m.end;tC++){var tT=s[tC],tI=r[tC];if(1&tT?tI&(x|b|C)&&s[tC]++:tI&_?s[tC]++:tI&(C|b)&&(s[tC]+=2),tI&h&&(s[tC]=0===tC?m.level:s[tC-1]),tC===m.end||p(e[tC])&(M|I))for(var tM=tC;tM>=0&&p(e[tM])&d;tM--)s[tM]=m.level}}return{levels:s,paragraphs:f};function tR(t,i){for(var n=t;n<e.length;n++){var a=r[n];if(a&(_|P))return 1;if(a&(I|x)||i&&a===H)break;if(a&l){var s=function(t){for(var i=1,n=t+1;n<e.length;n++){var a=r[n];if(a&I)break;if(a&H){if(0==--i)return n}else a&l&&i++}return -1}(n);n=-1===s?e.length:s}}return 0}},e.getMirroredCharacter=Q,e.getMirroredCharactersMap=function(e,t,r,i){var n=e.length;r=Math.max(0,null==r?0:+r),i=Math.min(n-1,null==i?n-1:+i);for(var a=new Map,s=r;s<=i;s++)if(1&t[s]){var o=Q(e[s]);null!==o&&a.set(s,o)}return a},e.getReorderSegments=V,e.getReorderedIndices=W,e.getReorderedString=function(e,t,r,i){var n=W(e,t,r,i),a=[].concat(e);return n.forEach(function(r,i){a[i]=(1&t.levels[r]?Q(e[r]):null)||e[r]}),a.join("")},e.openingToClosingBracket=v,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,t,r)=>e(t,r())}),x6=xb({name:"Typesetter",dependencies:[x5],init:e=>function(t){return new Promise(r=>{e.typeset(t,r)})},getTransferables(e){let t=[];for(let r in e)e[r]&&e[r].buffer&&t.push(e[r].buffer);return t}}),x8=x6.onMainThread,x9={},x7="aTroikaGlyphIndex";class _e extends cT{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new nJ,this.boundingBox=new nL}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){var t;let r;this._detail=e,("number"!=typeof e||e<1)&&(e=1);let i=((r=x9[t=e])||(r=x9[t]=new uf(1,1,t,t).translate(.5,.5,0)),r);["position","normal","uv"].forEach(e=>{this.attributes[e]=i.attributes[e].clone()}),this.setIndex(i.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,r,i,n){this.updateAttributeData("aTroikaGlyphBounds",e,4),this.updateAttributeData(x7,t,1),this.updateAttributeData("aTroikaGlyphColor",n,3),this._blockBounds=r,this._chunkedBounds=i,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){let e=this._blockBounds;if(e){let{curveRadius:t,boundingBox:r}=this;if(t){let{PI:i,floor:n,min:a,max:s,sin:o,cos:l}=Math,u=i/2,c=2*i,h=Math.abs(t),d=e[0]/h,f=e[2]/h,p=n((d+u)/c)!==n((f+u)/c)?-h:a(o(d)*h,o(f)*h),m=n((d-u)/c)!==n((f-u)/c)?h:s(o(d)*h,o(f)*h),g=n((d+i)/c)!==n((f+i)/c)?2*h:s(h-l(d)*h,h-l(f)*h);r.min.set(p,e[1],t<0?-g:0),r.max.set(m,e[3],t<0?0:g)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(x7).count,r=this._chunkedBounds;if(r)for(let i=r.length;i--;){t=r[i].end;let n=r[i].rect;if(n[1]<e.w&&n[3]>e.y&&n[0]<e.z&&n[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,r){let i=this.getAttribute(e);t?i&&i.array.length===t.length?(i.array.set(t),i.needsUpdate=!0):(this.setAttribute(e,new op(t,r)),delete this._maxInstanceCount,this.dispose()):i&&this.deleteAttribute(e)}}let _t=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,_r=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,_i=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,_n=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`,_a=new aY({color:0xffffff,side:e1,transparent:!0}),_s=new n8,_o=new ni,_l=new ni,_u=[],_c=new ni,_h="+x+y";function _d(e){return Array.isArray(e)?e[0]:e}let _f=()=>{let e=new sE(new uf(1,1),_a);return _f=()=>e,e},_p=()=>{let e=new sE(new uf(1,1,32,1),_a);return _p=()=>e,e},_m={type:"syncstart"},_g={type:"synccomplete"},_A=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],_v=_A.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class _y extends sE{constructor(){super(new _e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=8421504,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=_h,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(_m),x1({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);let r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{r.forEach(e=>e&&e())})),this.dispatchEvent(_g),e&&e()})))}onBeforeRender(e,t,r,i,n,a){this.sync(),n.isTroikaTextMaterial&&this._prepareForRender(n)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return function(e){let t=function e(t,r){let i=function(e){let t=JSON.stringify(e,xF),r=xU.get(t);return null==r&&xU.set(t,r=++xO),r}(r),n=xD.get(t);if(n||xD.set(t,n=Object.create(null)),n[i])return new n[i];let a=`_onBeforeCompile${i}`,s=function(e,n){t.onBeforeCompile.call(this,e,n);let s=this.customProgramCacheKey()+"|"+e.vertexShader+"|"+e.fragmentShader,o=xP[s];if(!o){let t=function(e,{vertexShader:t,fragmentShader:r},i,n){let{vertexDefs:a,vertexMainIntro:s,vertexMainOutro:o,vertexTransform:l,fragmentDefs:u,fragmentMainIntro:c,fragmentMainOutro:h,fragmentColorTransform:d,customRewriter:f,timeUniform:p}=i;if(a=a||"",s=s||"",o=o||"",u=u||"",c=c||"",h=h||"",(l||f)&&(t=xI(t)),(d||f)&&(r=xI(r=r.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n"))),f){let e=f({vertexShader:t,fragmentShader:r});t=e.vertexShader,r=e.fragmentShader}if(d){let e=[];r=r.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,t=>(e.push(t),"")),h=`${d}
${e.join("\n")}
${h}`}if(p){let e=`
uniform float ${p};
`;a=e+a,u=e+u}return l&&(t=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${t}
`,a=`${a}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,s=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${s}
`,t=t.replace(/\b(position|normal|uv)\b/g,(e,t,r,i)=>/\battribute\s+vec[23]\s+$/.test(i.substr(0,r))?t:`troika_${t}_${n}`),e.map&&e.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),{vertexShader:t=xk(t,n,a,s,o),fragmentShader:r=xk(r,n,u,c,h)}}(this,e,r,i);o=xP[s]=t}e.vertexShader=o.vertexShader,e.fragmentShader=o.fragmentShader,xR(e.uniforms,this.uniforms),r.timeUniform&&(e.uniforms[r.timeUniform]={get value(){return Date.now()-xB}}),this[a]&&this[a](e)},o=function(){return l(r.chained?t:t.clone())},l=function(e){let n=Object.create(e,u);return Object.defineProperty(n,"baseMaterial",{value:t}),Object.defineProperty(n,"id",{value:xL++}),n.uuid=function(){let e=0xffffffff*Math.random()|0,t=0xffffffff*Math.random()|0,r=0xffffffff*Math.random()|0,i=0xffffffff*Math.random()|0;return(xM[255&e]+xM[e>>8&255]+xM[e>>16&255]+xM[e>>24&255]+"-"+xM[255&t]+xM[t>>8&255]+"-"+xM[t>>16&15|64]+xM[t>>24&255]+"-"+xM[63&r|128]+xM[r>>8&255]+"-"+xM[r>>16&255]+xM[r>>24&255]+xM[255&i]+xM[i>>8&255]+xM[i>>16&255]+xM[i>>24&255]).toUpperCase()}(),n.uniforms=xR({},e.uniforms,r.uniforms),n.defines=xR({},e.defines,r.defines),n.defines[`TROIKA_DERIVED_MATERIAL_${i}`]="",n.extensions=xR({},e.extensions,r.extensions),n._listeners=void 0,n},u={constructor:{value:o},isDerivedMaterial:{value:!0},type:{get:()=>t.type,set:e=>{t.type=e}},isDerivedFrom:{writable:!0,configurable:!0,value:function(e){let t=this.baseMaterial;return e===t||t.isDerivedMaterial&&t.isDerivedFrom(e)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return t.customProgramCacheKey()+"|"+i}},onBeforeCompile:{get:()=>s,set(e){this[a]=e}},copy:{writable:!0,configurable:!0,value:function(e){return t.copy.call(this,e),t.isShaderMaterial||t.isDerivedMaterial||(xR(this.extensions,e.extensions),xR(this.defines,e.defines),xR(this.uniforms,sC.clone(e.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){return l(new t.constructor).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let i=this._depthMaterial;return i||((i=this._depthMaterial=e(t.isDerivedMaterial?t.getDepthMaterial():new uD({depthPacking:it}),r)).defines.IS_DEPTH_MATERIAL="",i.uniforms=this.uniforms),i}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let i=this._distanceMaterial;return i||((i=this._distanceMaterial=e(t.isDerivedMaterial?t.getDistanceMaterial():new uP,r)).defines.IS_DISTANCE_MATERIAL="",i.uniforms=this.uniforms),i}},dispose:{writable:!0,configurable:!0,value(){let{_depthMaterial:e,_distanceMaterial:r}=this;e&&e.dispose(),r&&r.dispose(),t.dispose.call(this)}}};return n[i]=o,new o}(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new nt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new nT(0,0,0,0)},uTroikaClipRect:{value:new nT(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new nt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new aQ},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new ns},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:_t,vertexTransform:_r,fragmentDefs:_i,fragmentColorTransform:_n,customRewriter({vertexShader:e,fragmentShader:t}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(t)&&(t=t.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(e)||(e=e.replace(xT,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:t}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}(e)}get material(){let e=this._derivedMaterial,t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=_a.clone());if(e&&e.isDerivedFrom(t)||(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),e.dispose()})),!this.hasOutline())return e;{let t=e._outlineMtl;return t||((t=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}})).isTextOutlineMaterial=!0,t.depthWrite=!1,t.map=null,e.addEventListener("dispose",function r(){e.removeEventListener("dispose",r),t.dispose()})),[t,e]}}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return _d(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return _d(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){let t=e.isTextOutlineMaterial,r=e.uniforms,i=this.textRenderInfo;if(i){let e,n,a;let{sdfTexture:s,blockBounds:o}=i;r.uTroikaSDFTexture.value=s,r.uTroikaSDFTextureSize.value.set(s.image.width,s.image.height),r.uTroikaSDFGlyphSize.value=i.sdfGlyphSize,r.uTroikaSDFExponent.value=i.sdfExponent,r.uTroikaTotalBounds.value.fromArray(o),r.uTroikaUseGlyphColors.value=!t&&!!i.glyphColors;let l=0,u=0,c=0,h=0,d=0;if(t){let{outlineWidth:t,outlineOffsetX:r,outlineOffsetY:i,outlineBlur:n,outlineOpacity:a}=this;l=this._parsePercent(t)||0,u=Math.max(0,this._parsePercent(n)||0),e=a,h=this._parsePercent(r)||0,d=this._parsePercent(i)||0}else(c=Math.max(0,this._parsePercent(this.strokeWidth)||0))&&(a=this.strokeColor,r.uTroikaStrokeColor.value.set(null==a?8421504:a),null==(n=this.strokeOpacity)&&(n=1)),e=this.fillOpacity;r.uTroikaEdgeOffset.value=l,r.uTroikaPositionOffset.value.set(h,d),r.uTroikaBlurRadius.value=u,r.uTroikaStrokeWidth.value=c,r.uTroikaStrokeOpacity.value=n,r.uTroikaFillOpacity.value=null==e?1:e,r.uTroikaCurveRadius.value=this.curveRadius||0;let f=this.clipRect;if(f&&Array.isArray(f)&&4===f.length)r.uTroikaClipRect.value.fromArray(f);else{let e=100*(this.fontSize||.1);r.uTroikaClipRect.value.set(o[0]-e,o[1]-e,o[2]+e,o[3]+e)}this.geometry.applyClipRect(r.uTroikaClipRect.value)}r.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;let n=t?this.outlineColor||0:this.color;if(null==n)delete e.color;else{let t=e.hasOwnProperty("color")?e.color:e.color=new aQ;(n!==t._input||"object"==typeof n)&&t.set(t._input=n)}let a=this.orientation||_h;if(a!==e._orientation){let t=r.uTroikaOrient.value,i=(a=a.replace(/[^-+xyz]/g,""))!==_h&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(i){let[,e,r,n,a]=i;_o.set(0,0,0)[r]="-"===e?1:-1,_l.set(0,0,0)[a]="-"===n?-1:1,_s.lookAt(_c,_o.cross(_l),_l),t.setFromMatrix4(_s)}else t.identity();e._orientation=a}}_parsePercent(e){if("string"==typeof e){let t=e.match(/^(-?[\d.]+)%$/),r=t?parseFloat(t[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new nt){t.copy(e);let r=this.curveRadius;return r&&(t.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),t}worldPositionToTextCoords(e,t=new nt){return _o.copy(e),this.localPositionToTextCoords(this.worldToLocal(_o),t)}raycast(e,t){let{textRenderInfo:r,curveRadius:i}=this;if(r){let n=r.blockBounds,a=i?_p():_f(),s=a.geometry,{position:o,uv:l}=s.attributes;for(let e=0;e<l.count;e++){let t=n[0]+l.getX(e)*(n[2]-n[0]),r=n[1]+l.getY(e)*(n[3]-n[1]),a=0;i&&(a=i-Math.cos(t/i)*i,t=Math.sin(t/i)*i),o.setXYZ(e,t,r,a)}s.boundingSphere=this.geometry.boundingSphere,s.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,_u.length=0,a.raycast(e,_u);for(let e=0;e<_u.length;e++)_u[e].object=this,t.push(_u[e])}}copy(e){let t=this.geometry;return super.copy(e),this.geometry=t,_v.forEach(t=>{this[t]=e[t]}),this}clone(){return new this.constructor().copy(this)}}_A.forEach(e=>{let t="_private_"+e;Object.defineProperty(_y.prototype,e,{get(){return this[t]},set(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}),new nL,new aQ,new WeakMap,new WeakMap;let _E=eN.forwardRef(({sdfGlyphSize:e=64,anchorX:t="center",anchorY:r="middle",font:i,fontSize:n=1,children:a,characters:s,onSync:o,...l},u)=>{let c=dY(({invalidate:e})=>e),[h]=eN.useState(()=>new _y),[d,f]=eN.useMemo(()=>{let e=[],t="";return eN.Children.forEach(a,r=>{"string"==typeof r||"number"==typeof r?t+=r:e.push(r)}),[e,t]},[a]);return da(()=>new Promise(e=>(function({font:e,characters:t,sdfGlyphSize:r},i){x1({font:e,sdfGlyphSize:r,text:Array.isArray(t)?t.join("\n"):""+t},i)})({font:i,characters:s},e)),["troika-text",i,s]),eN.useLayoutEffect(()=>void h.sync(()=>{c(),o&&o(h)})),eN.useEffect(()=>()=>h.dispose(),[h]),eN.createElement("primitive",eU({object:h,ref:u,font:i,text:f,anchorX:t,anchorY:r,fontSize:n,sdfGlyphSize:e},l),d)});class _x extends ul{constructor(e,t={}){let{bevelEnabled:r=!1,bevelSize:i=8,bevelThickness:n=10,font:a,height:s=50,size:o=100,lineHeight:l=1,letterSpacing:u=0,...c}=t;void 0===a?super():super(a.generateShapes(e,o,{lineHeight:l,letterSpacing:u}),{...c,bevelEnabled:r,bevelSize:i,bevelThickness:n,depth:s}),this.type="TextGeometry"}}function __(e,t){if(t===r8)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t!==r7&&t!==r9)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e;{let r=e.getIndex();if(null===r){let t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}let i=r.count-2,n=[];if(r){if(t===r7)for(let e=1;e<=i;e++)n.push(r.getX(0)),n.push(r.getX(e)),n.push(r.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(n.push(r.getX(e)),n.push(r.getX(e+1)),n.push(r.getX(e+2))):(n.push(r.getX(e+2)),n.push(r.getX(e+1)),n.push(r.getX(e)))}n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let a=e.clone();return a.setIndex(n),a.clearGroups(),a}}function _b(e,t=Math.PI/3){let r=Math.cos(t),i=(1+1e-10)*100,n=[new ni,new ni,new ni],a=new ni,s=new ni,o=new ni,l=new ni;function u(e){let t=~~(e.x*i),r=~~(e.y*i),n=~~(e.z*i);return`${t},${r},${n}`}let c=e.index?e.toNonIndexed():e,h=c.attributes.position,d={};for(let e=0,t=h.count/3;e<t;e++){let t=3*e,r=n[0].fromBufferAttribute(h,t+0),i=n[1].fromBufferAttribute(h,t+1),o=n[2].fromBufferAttribute(h,t+2);a.subVectors(o,i),s.subVectors(r,i);let l=new ni().crossVectors(a,s).normalize();for(let e=0;e<3;e++){let t=u(n[e]);t in d||(d[t]=[]),d[t].push(l)}}let f=new a1(new Float32Array(3*h.count),3,!1);for(let e=0,t=h.count/3;e<t;e++){let t=3*e,i=n[0].fromBufferAttribute(h,t+0),c=n[1].fromBufferAttribute(h,t+1),p=n[2].fromBufferAttribute(h,t+2);a.subVectors(p,c),s.subVectors(i,c),o.crossVectors(a,s).normalize();for(let e=0;e<3;e++){let i=d[u(n[e])];l.set(0,0,0);for(let e=0,t=i.length;e<t;e++){let t=i[e];o.dot(t)>r&&l.add(t)}l.normalize(),f.setXYZ(t+e,l.x,l.y,l.z)}}return c.setAttribute("normal",f),c}var _S=Object.defineProperty,_w=(e,t,r)=>t in e?_S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_C=(e,t,r)=>(_w(e,"symbol"!=typeof t?t+"":t,r),r);class _T extends u4{constructor(e){super(e)}load(e,t,r,i){let n=new u8(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,e=>{if("string"!=typeof e)throw Error("unsupported data type");let r=JSON.parse(e),i=this.parse(r);t&&t(i)},r,i)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new _I(e)}}class _I{constructor(e){_C(this,"data"),_C(this,"isFont",!0),_C(this,"type","Font"),this.data=e}generateShapes(e,t=100,r){let i=[],n={letterSpacing:0,lineHeight:1,...r},a=function(e,t,r,i){let n=Array.from(e),a=t/r.resolution,s=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*a,o=[],l=0,u=0;for(let e=0;e<n.length;e++){let t=n[e];if("\n"===t)l=0,u-=s*i.lineHeight;else{let e=function(e,t,r,i,n){let a,s,o,l,u,c,h,d;let f=n.glyphs[e]||n.glyphs["?"];if(!f){console.error('THREE.Font: character "'+e+'" does not exists in font family '+n.familyName+".");return}let p=new h5;if(f.o){let e=f._cachedOutline||(f._cachedOutline=f.o.split(" "));for(let n=0,f=e.length;n<f;)switch(e[n++]){case"m":a=parseInt(e[n++])*t+r,s=parseInt(e[n++])*t+i,p.moveTo(a,s);break;case"l":a=parseInt(e[n++])*t+r,s=parseInt(e[n++])*t+i,p.lineTo(a,s);break;case"q":o=parseInt(e[n++])*t+r,l=parseInt(e[n++])*t+i,u=parseInt(e[n++])*t+r,c=parseInt(e[n++])*t+i,p.quadraticCurveTo(u,c,o,l);break;case"b":o=parseInt(e[n++])*t+r,l=parseInt(e[n++])*t+i,u=parseInt(e[n++])*t+r,c=parseInt(e[n++])*t+i,h=parseInt(e[n++])*t+r,d=parseInt(e[n++])*t+i,p.bezierCurveTo(u,c,h,d,o,l)}}return{offsetX:f.ha*t,path:p}}(t,a,l,u,r);e&&(l+=e.offsetX+i.letterSpacing,o.push(e.path))}}return o}(e,t,this.data,n);for(let e=0,t=a.length;e<t;e++)Array.prototype.push.apply(i,a[e].toShapes(!1));return i}}let _M=null;async function _R(e){return"string"==typeof e?await (await fetch(e)).json():e}async function _B(e){var t;return t=await _R(e),_M||(_M=new _T),_M.parse(t)}function _D(e){return da(_B,[e])}_D.preload=e=>ds(_B,[e]),_D.clear=e=>dl([e]);let _P=["string","number"],_L=e=>{let t="",r=[];return eN.Children.forEach(e,e=>{_P.includes(typeof e)?t+=e+"":r.push(e)}),[t,...r]},_k=eN.forwardRef(({font:e,letterSpacing:t=0,lineHeight:r=1,size:i=1,height:n=.2,bevelThickness:a=.1,bevelSize:s=.01,bevelEnabled:o=!1,bevelOffset:l=0,bevelSegments:u=4,curveSegments:c=8,smooth:h,children:d,...f},p)=>{eN.useMemo(()=>dp({RenamedTextGeometry:_x}),[]);let m=eN.useRef(null),g=_D(e),A=(0,eN.useMemo)(()=>({font:g,size:i,height:n,bevelThickness:a,bevelSize:s,bevelEnabled:o,bevelSegments:u,bevelOffset:l,curveSegments:c,letterSpacing:t,lineHeight:r}),[g,i,n,a,s,o,u,l,c,t,r]),[v,...y]=(0,eN.useMemo)(()=>_L(d),[d]),E=eN.useMemo(()=>[v,A],[v,A]);return eN.useLayoutEffect(()=>{h&&(m.current.geometry=function(e,t=1e-4){t=Math.max(t,Number.EPSILON);let r={},i=e.getIndex(),n=e.getAttribute("position"),a=i?i.count:n.count,s=0,o=Object.keys(e.attributes),l={},u={},c=[],h=["getX","getY","getZ","getW"];for(let t=0,r=o.length;t<r;t++){let r=o[t];l[r]=[];let i=e.morphAttributes[r];i&&(u[r]=Array(i.length).fill(0).map(()=>[]))}let d=Math.pow(10,Math.log10(1/t));for(let t=0;t<a;t++){let n=i?i.getX(t):t,a="";for(let t=0,r=o.length;t<r;t++){let r=o[t],i=e.getAttribute(r),s=i.itemSize;for(let e=0;e<s;e++)a+=`${~~(i[h[e]](n)*d)},`}if(a in r)c.push(r[a]);else{for(let t=0,r=o.length;t<r;t++){let r=o[t],i=e.getAttribute(r),a=e.morphAttributes[r],s=i.itemSize,c=l[r],d=u[r];for(let e=0;e<s;e++){let t=h[e];if(c.push(i[t](n)),a)for(let e=0,r=a.length;e<r;e++)d[e].push(a[e][t](n))}}r[a]=s,c.push(s),s++}}let f=e.clone();for(let t=0,r=o.length;t<r;t++){let r=o[t],i=e.getAttribute(r),n=new a1(new i.array.constructor(l[r]),i.itemSize,i.normalized);if(f.setAttribute(r,n),r in u)for(let t=0;t<u[r].length;t++){let i=e.morphAttributes[r][t],n=new a1(new i.array.constructor(u[r][t]),i.itemSize,i.normalized);f.morphAttributes[r][t]=n}}return f.setIndex(c),f}(m.current.geometry,h),m.current.geometry.computeVertexNormals())},[E,h]),eN.useImperativeHandle(p,()=>m.current,[]),eN.createElement("mesh",eU({},f,{ref:m}),eN.createElement("renamedTextGeometry",{args:E}),y)}),_F={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform float opacity;

    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 texel = texture2D( tDiffuse, vUv );
    	gl_FragColor = opacity * texel;

    }
  `};var _O=Object.defineProperty,_U=(e,t,r)=>t in e?_O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_N=(e,t,r)=>(_U(e,"symbol"!=typeof t?t+"":t,r),r);class _z{constructor(){_N(this,"enabled",!0),_N(this,"needsSwap",!0),_N(this,"clear",!1),_N(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,r,i,n){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}class _G{constructor(e){_N(this,"camera",new cv(-1,1,1,-1,0,1)),_N(this,"geometry",new uf(2,2)),_N(this,"mesh"),this.mesh=new sE(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}var _H=Object.defineProperty,_Q=(e,t,r)=>t in e?_H(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_V=(e,t,r)=>(_Q(e,"symbol"!=typeof t?t+"":t,r),r);class _W extends _z{constructor(e,t="tDiffuse"){super(),_V(this,"textureID"),_V(this,"uniforms"),_V(this,"material"),_V(this,"fsQuad"),this.textureID=t,e instanceof sT?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=sC.clone(e.uniforms),this.material=new sT({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new _G(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}dispose(){this.fsQuad.dispose(),this.material.dispose()}}var _j=Object.defineProperty,_Y=(e,t,r)=>t in e?_j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_K=(e,t,r)=>(_Y(e,"symbol"!=typeof t?t+"":t,r),r);class _q extends _z{constructor(e,t){super(),_K(this,"scene"),_K(this,"camera"),_K(this,"inverse"),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){let i,n;let a=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(i=0,n=1):(i=1,n=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),s.buffers.stencil.setFunc(a.ALWAYS,i,0xffffffff),s.buffers.stencil.setClear(n),s.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(a.EQUAL,1,0xffffffff),s.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),s.buffers.stencil.setLocked(!0)}}class _X extends _z{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}var _$=Object.defineProperty,_J=(e,t,r)=>t in e?_$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_Z=(e,t,r)=>(_J(e,"symbol"!=typeof t?t+"":t,r),r);class _0{constructor(e,t){if(_Z(this,"renderer"),_Z(this,"_pixelRatio"),_Z(this,"_width"),_Z(this,"_height"),_Z(this,"renderTarget1"),_Z(this,"renderTarget2"),_Z(this,"writeBuffer"),_Z(this,"readBuffer"),_Z(this,"renderToScreen"),_Z(this,"passes",[]),_Z(this,"copyPass"),_Z(this,"clock"),this.renderer=e,void 0===t){let r=e.getSize(new nt);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,(t=new nM(this._width*this._pixelRatio,this._height*this._pixelRatio,{minFilter:tZ,magFilter:tZ,format:ru})).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,void 0===_F&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===_W&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new _W(_F),this.copyPass.material.blending=e2,this.clock=new cH}swapBuffers(){let e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){let t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());let t=this.renderer.getRenderTarget(),r=!1,i=this.passes.length;for(let t=0;t<i;t++){let i=this.passes[t];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),i.needsSwap){if(r){let t=this.renderer.getContext(),r=this.renderer.state.buffers.stencil;r.setFunc(t.NOTEQUAL,1,0xffffffff),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),r.setFunc(t.EQUAL,1,0xffffffff)}this.swapBuffers()}void 0!==_q&&(i instanceof _q?r=!0:i instanceof _X&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){let t=this.renderer.getSize(new nt);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;let r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}var _1=Object.defineProperty,_2=(e,t,r)=>t in e?_1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_3=(e,t,r)=>(_2(e,"symbol"!=typeof t?t+"":t,r),r);class _4 extends _z{constructor(e,t,r,i,n=0){super(),_3(this,"scene"),_3(this,"camera"),_3(this,"overrideMaterial"),_3(this,"clearColor"),_3(this,"clearAlpha"),_3(this,"clearDepth",!1),_3(this,"_oldClearColor",new aQ),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=n,this.clear=!0,this.needsSwap=!1}render(e,t,r){let i,n=e.autoClear;e.autoClear=!1;let a=null;void 0!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=n}}let _5={uniforms:{tDiffuse:{value:null}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 tex = texture2D( tDiffuse, vUv );

    	#ifdef LinearTosRGB
    		gl_FragColor = LinearTosRGB( tex );
    	#else
    		gl_FragColor = sRGBTransferOETF( tex );
    	#endif

    }
  `},_6=()=>{try{var e=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&e.getContext("webgl2"))}catch(e){return!1}},_8=eN.forwardRef(({children:e,multisamping:t=8,renderIndex:r=1,disableRender:i,disableGamma:n,disableRenderPass:a,depthBuffer:s=!0,stencilBuffer:o=!1,anisotropy:l=1,encoding:u,type:c,...h},d)=>{eN.useMemo(()=>dp({EffectComposer:_0,RenderPass:_4,ShaderPass:_W}),[]);let f=eN.useRef(null);eN.useImperativeHandle(d,()=>f.current,[]);let{scene:p,camera:m,gl:g,size:A,viewport:v}=dY(),[y]=eN.useState(()=>{let e=new nM(A.width,A.height,{type:c||rt,format:ru,depthBuffer:s,stencilBuffer:o,anisotropy:l});return c===t4&&null!=u&&("colorSpace"in e?e.texture.colorSpace=u:e.texture.encoding=u),e.samples=t,e});eN.useEffect(()=>{var e,t;null==(e=f.current)||e.setSize(A.width,A.height),null==(t=f.current)||t.setPixelRatio(v.dpr)},[g,A,v.dpr]),dK(()=>{var e;i||null==(e=f.current)||e.render()},r);let E=[];return a||E.push(eN.createElement("renderPass",{key:"renderpass",attach:`passes-${E.length}`,args:[p,m]})),n||E.push(eN.createElement("shaderPass",{attach:`passes-${E.length}`,key:"gammapass",args:[_5]})),eN.Children.forEach(e,e=>{e&&E.push(eN.cloneElement(e,{key:E.length,attach:`passes-${E.length}`}))}),eN.createElement("effectComposer",eU({ref:f,args:[g,y]},h),E)}),_9=function(e){return e.Linear="linear",e.Radial="radial",e}({});function _7({stops:e,colors:t,size:r=1024,width:i=16,type:n=_9.Linear,innerCircleRadius:a=0,outerCircleRadius:s="auto",...o}){let l=dY(e=>e.gl),u=eN.useMemo(()=>{let o;let l=document.createElement("canvas"),u=l.getContext("2d");if(l.width=i,l.height=r,n===_9.Linear)o=u.createLinearGradient(0,0,0,r);else{let e=l.width/2,t=l.height/2,r="auto"!==s?Math.abs(Number(s)):Math.sqrt(e**2+t**2);o=u.createRadialGradient(e,t,Math.abs(a),e,t,r)}let c=new aQ,h=e.length;for(;h--;)o.addColorStop(e[h],c.set(t[h]).getStyle());return u.save(),u.fillStyle=o,u.fillRect(0,0,i,r),u.restore(),l},[e]);return eN.createElement("canvasTexture",eU({colorSpace:l.outputColorSpace,args:[u],attach:"map"},o))}function be(e,t,r,i){let n=class extends sT{constructor(n={}){let a=Object.entries(e);super({uniforms:a.reduce((e,[t,r])=>{let i=sC.clone({[t]:{value:r}});return{...e,...i}},{}),vertexShader:t,fragmentShader:r}),this.key="",a.forEach(([e])=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t})),Object.assign(this,n),i&&i(this)}};return n.key=ne.generateUUID(),n}let bt=e=>e===Object(e)&&!Array.isArray(e)&&"function"!=typeof e;function br(e,t){let r=dY(e=>e.gl),i=d$(cn,bt(e)?Object.values(e):e);return(0,eN.useLayoutEffect)(()=>{null==t||t(i)},[t]),(0,eN.useEffect)(()=>{if("initTexture"in r){let e=[];Array.isArray(i)?e=i:i instanceof nC?e=[i]:bt(i)&&(e=Object.values(i)),e.forEach(e=>{e instanceof nC&&r.initTexture(e)})}},[r,i]),(0,eN.useMemo)(()=>{if(!bt(e))return i;{let t={},r=0;for(let n in e)t[n]=i[r++];return t}},[e,i])}br.preload=e=>d$.preload(cn,e),br.clear=e=>d$.clear(cn,e);let bi=({children:e,input:t,onLoad:r})=>{let i=br(t,r);return eN.createElement(eN.Fragment,null,null==e?void 0:e(i))},bn=parseInt(eH.replace(/\D+/g,"")),ba=be({color:new aQ("white"),scale:new nt(1,1),imageBounds:new nt(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},`
  varying vec2 vUv;
  varying vec2 vPos;
  void main() {
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
    vUv = uv;
    vPos = position.xy;
  }
`,`
  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44
  varying vec2 vUv;
  varying vec2 vPos;
  uniform vec2 scale;
  uniform vec2 imageBounds;
  uniform float resolution;
  uniform vec3 color;
  uniform sampler2D map;
  uniform float radius;
  uniform float zoom;
  uniform float grayscale;
  uniform float opacity;
  const vec3 luma = vec3(.299, 0.587, 0.114);
  vec4 toGrayscale(vec4 color, float intensity) {
    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);
  }
  vec2 aspect(vec2 size) {
    return size / min(size.x, size.y);
  }
  
  const float PI = 3.14159265;
    
  // from https://iquilezles.org/articles/distfunctions
  float udRoundBox( vec2 p, vec2 b, float r ) {
    return length(max(abs(p)-b+r,0.0))-r;
  }

  void main() {
    vec2 s = aspect(scale);
    vec2 i = aspect(imageBounds);
    float rs = s.x / s.y;
    float ri = i.x / i.y;
    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
    vec2 uv = vUv * s / new + offset;
    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);

    vec2 res = vec2(scale * resolution);
    vec2 halfRes = 0.5 * res;
    float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    
	  vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));
    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);
    
    #include <tonemapping_fragment>
    #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`),bs=eN.forwardRef(({children:e,color:t,segments:r=1,scale:i=1,zoom:n=1,grayscale:a=0,opacity:s=1,radius:o=0,texture:l,toneMapped:u,transparent:c,side:h,...d},f)=>{dp({ImageMaterial:ba});let p=eN.useRef(null),m=dY(e=>e.size),g=Array.isArray(i)?[i[0],i[1]]:[i,i],A=[l.image.width,l.image.height],v=Math.max(m.width,m.height);return eN.useImperativeHandle(f,()=>p.current,[]),eN.useLayoutEffect(()=>{p.current.geometry.parameters&&p.current.material.scale.set(g[0]*p.current.geometry.parameters.width,g[1]*p.current.geometry.parameters.height)},[g[0],g[1]]),eN.createElement("mesh",eU({ref:p,scale:Array.isArray(i)?[...i,1]:i},d),eN.createElement("planeGeometry",{args:[1,1,r,r]}),eN.createElement("imageMaterial",{color:t,map:l,zoom:n,grayscale:a,opacity:s,scale:g,imageBounds:A,resolution:v,radius:o,toneMapped:u,transparent:c,side:h,key:ba.key}),e)}),bo=eN.forwardRef(({url:e,...t},r)=>{let i=br(e);return eN.createElement(bs,eU({},t,{texture:i,ref:r}))}),bl=eN.forwardRef(({url:e,...t},r)=>eN.createElement(bs,eU({},t,{ref:r}))),bu=eN.forwardRef((e,t)=>{if(e.url)return eN.createElement(bo,eU({},e,{ref:t}));if(e.texture)return eN.createElement(bl,eU({},e,{ref:t}));throw Error("<Image /> requires a url or texture")}),bc=eN.forwardRef(({threshold:e=15,geometry:t,...r},i)=>{let n=eN.useRef(null);eN.useImperativeHandle(i,()=>n.current,[]);let a=eN.useMemo(()=>[0,0,0,1,0,0],[]),s=eN.useRef(),o=eN.useRef();return eN.useLayoutEffect(()=>{let r=n.current.parent,i=null!=t?t:null==r?void 0:r.geometry;if(!i||s.current===i&&o.current===e)return;s.current=i,o.current=e;let a=new lI(i,e).attributes.position.array;n.current.geometry.setPositions(a),n.current.geometry.attributes.instanceStart.needsUpdate=!0,n.current.geometry.attributes.instanceEnd.needsUpdate=!0,n.current.computeLineDistances()}),eN.createElement(xu,eU({segments:!0,points:a,ref:n,raycast:()=>null},r))}),bh=be({screenspace:!1,color:new aQ("black"),opacity:1,thickness:.05,size:new nt},`#include <common>
   #include <morphtarget_pars_vertex>
   #include <skinning_pars_vertex>
   #include <clipping_planes_pars_vertex>
   uniform float thickness;
   uniform bool screenspace;
   uniform vec2 size;
   void main() {
     #if defined (USE_SKINNING)
	     #include <beginnormal_vertex>
       #include <morphnormal_vertex>
       #include <skinbase_vertex>
       #include <skinnormal_vertex>
       #include <defaultnormal_vertex>
     #endif
     #include <begin_vertex>
	   #include <morphtarget_vertex>
	   #include <skinning_vertex>
     #include <project_vertex>
     #include <clipping_planes_vertex>
     vec4 tNormal = vec4(normal, 0.0);
     vec4 tPosition = vec4(transformed, 1.0);
     #ifdef USE_INSTANCING
       tNormal = instanceMatrix * tNormal;
       tPosition = instanceMatrix * tPosition;
     #endif
     if (screenspace) {
       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;
       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); 
     } else {
       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;
       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;
       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;
       clipPosition.xy += offset;
       gl_Position = clipPosition;
     }
   }`,`uniform vec3 color;
   uniform float opacity;
   #include <clipping_planes_pars_fragment>
   void main(){
     #include <clipping_planes_fragment>
     gl_FragColor = vec4(color, opacity);
     #include <tonemapping_fragment>
     #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
   }`);function bd({color:e="black",opacity:t=1,transparent:r=!1,screenspace:i=!1,toneMapped:n=!0,polygonOffset:a=!1,polygonOffsetFactor:s=0,renderOrder:o=0,thickness:l=.05,angle:u=Math.PI,clippingPlanes:c,...h}){let d=eN.useRef(),[f]=eN.useState(()=>new bh({side:e0})),{gl:p}=dY(),m=p.getDrawingBufferSize(new nt);eN.useMemo(()=>dp({OutlinesMaterial:bh}),[]);let g=eN.useRef(0),A=eN.useRef();return eN.useLayoutEffect(()=>{let e=d.current;if(!e)return;let t=e.parent;if(t&&t.geometry&&(g.current!==u||A.current!==t.geometry)){var r;g.current=u,A.current=t.geometry;let i=null==(r=e.children)?void 0:r[0];i&&(u&&i.geometry.dispose(),e.remove(i)),t.skeleton?((i=new ol).material=f,i.bind(t.skeleton,t.bindMatrix)):t.isInstancedMesh?(i=new o_(t.geometry,f,t.count)).instanceMatrix=t.instanceMatrix:(i=new sE).material=f,e.add(i),i.geometry=u?_b(t.geometry,u):t.geometry,i.morphTargetInfluences=t.morphTargetInfluences,i.morphTargetDictionary=t.morphTargetDictionary}}),eN.useLayoutEffect(()=>{let u=d.current;if(!u)return;let h=u.children[0];if(h){h.renderOrder=o;let d=u.parent;d1(h,{morphTargetInfluences:d.morphTargetInfluences,morphTargetDictionary:d.morphTargetDictionary}),d1(h.material,{transparent:r,thickness:l,color:e,opacity:t,size:m,screenspace:i,toneMapped:n,polygonOffset:a,polygonOffsetFactor:s,clippingPlanes:c,clipping:c&&c.length>0})}}),eN.useEffect(()=>()=>{let e=d.current;if(!e)return;let t=e.children[0];t&&(u&&t.geometry.dispose(),e.remove(t))},[]),eN.createElement("group",eU({ref:d},h))}var bf=Object.defineProperty,bp=(e,t,r)=>t in e?bf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bm=(e,t,r)=>(bp(e,"symbol"!=typeof t?t+"":t,r),r);function bg(e,t,r,i,n){let a;if(e=e.subarray||e.slice?e:e.buffer,r=r.subarray||r.slice?r:r.buffer,e=t?e.subarray?e.subarray(t,n&&t+n):e.slice(t,n&&t+n):e,r.set)r.set(e,i);else for(a=0;a<e.length;a++)r[a+i]=e[a];return r}class bA extends sl{constructor(){super(),bm(this,"type","MeshLine"),bm(this,"isMeshLine",!0),bm(this,"positions",[]),bm(this,"previous",[]),bm(this,"next",[]),bm(this,"side",[]),bm(this,"width",[]),bm(this,"indices_array",[]),bm(this,"uvs",[]),bm(this,"counters",[]),bm(this,"widthCallback",null),bm(this,"_attributes"),bm(this,"_points",[]),bm(this,"points"),bm(this,"matrixWorld",new n8),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(e){this.setPoints(e,this.widthCallback)}}})}setMatrixWorld(e){this.matrixWorld=e}setPoints(e,t){var r;if(e=(r=e)instanceof Float32Array?r:r instanceof sl?r.getAttribute("position").array:r.map(e=>{let t=Array.isArray(e);return e instanceof ni?[e.x,e.y,e.z]:e instanceof nt?[e.x,e.y,0]:t&&3===e.length?[e[0],e[1],e[2]]:t&&2===e.length?[e[0],e[1],0]:e}).flat(),this._points=e,this.widthCallback=null!=t?t:null,this.positions=[],this.counters=[],e.length&&e[0]instanceof ni)for(let t=0;t<e.length;t++){let r=e[t],i=t/(e.length-1);this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(i),this.counters.push(i)}else for(let t=0;t<e.length;t+=3){let r=t/(e.length-1);this.positions.push(e[t],e[t+1],e[t+2]),this.positions.push(e[t],e[t+1],e[t+2]),this.counters.push(r),this.counters.push(r)}this.process()}compareV3(e,t){let r=6*e,i=6*t;return this.positions[r]===this.positions[i]&&this.positions[r+1]===this.positions[i+1]&&this.positions[r+2]===this.positions[i+2]}copyV3(e){let t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}process(){let e,t;let r=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,r-1)?this.copyV3(r-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(let i=0;i<r;i++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(i/(r-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(i/(r-1),0),this.uvs.push(i/(r-1),1),i<r-1){t=this.copyV3(i),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);let e=2*i;this.indices_array.push(e,e+1,e+2),this.indices_array.push(e+2,e+1,e+3)}i>0&&(t=this.copyV3(i),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]))}t=this.compareV3(r-1,0)?this.copyV3(1):this.copyV3(r-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this._attributes&&this._attributes.position.count===this.counters.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new a1(new Float32Array(this.positions),3),previous:new a1(new Float32Array(this.previous),3),next:new a1(new Float32Array(this.next),3),side:new a1(new Float32Array(this.side),1),width:new a1(new Float32Array(this.width),1),uv:new a1(new Float32Array(this.uvs),2),index:new a1(new Uint16Array(this.indices_array),1),counters:new a1(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:e,y:t,z:r}){let i=this._attributes.position.array,n=this._attributes.previous.array,a=this._attributes.next.array,s=i.length;bg(i,0,n,0,s),bg(i,6,i,0,s-6),i[s-6]=e,i[s-5]=t,i[s-4]=r,i[s-3]=e,i[s-2]=t,i[s-1]=r,bg(i,6,a,0,s-6),a[s-6]=e,a[s-5]=t,a[s-4]=r,a[s-3]=e,a[s-2]=t,a[s-1]=r,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}let bv=`
  #include <common>
  #include <logdepthbuf_pars_vertex>
  #include <fog_pars_vertex>
  #include <clipping_planes_pars_vertex>

  attribute vec3 previous;
  attribute vec3 next;
  attribute float side;
  attribute float width;
  attribute float counters;
  
  uniform vec2 resolution;
  uniform float lineWidth;
  uniform vec3 color;
  uniform float opacity;
  uniform float sizeAttenuation;
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
  }
  
  void main() {
    float aspect = resolution.x / resolution.y;
    vColor = vec4(color, opacity);
    vUV = uv;
    vCounters = counters;
  
    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4(position, 1.0) * aspect;
    vec4 prevPos = m * vec4(previous, 1.0);
    vec4 nextPos = m * vec4(next, 1.0);
  
    vec2 currentP = fix(finalPosition, aspect);
    vec2 prevP = fix(prevPos, aspect);
    vec2 nextP = fix(nextPos, aspect);
  
    float w = lineWidth * width;
  
    vec2 dir;
    if (nextP == currentP) dir = normalize(currentP - prevP);
    else if (prevP == currentP) dir = normalize(nextP - currentP);
    else {
      vec2 dir1 = normalize(currentP - prevP);
      vec2 dir2 = normalize(nextP - currentP);
      dir = normalize(dir1 + dir2);
  
      vec2 perp = vec2(-dir1.y, dir1.x);
      vec2 miter = vec2(-dir.y, dir.x);
      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);
    }
  
    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;
    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);
    normal.xy *= .5 * w;
    //normal *= projectionMatrix;
    if (sizeAttenuation == 0.) {
      normal.xy *= finalPosition.w;
      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;
    }
  
    finalPosition.xy += normal.xy * side;
    gl_Position = finalPosition;
    #include <logdepthbuf_vertex>
    #include <fog_vertex>
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    #include <clipping_planes_vertex>
    #include <fog_vertex>
  }
`,by=parseInt(eH.replace(/\D+/g,"")),bE=`
  #include <fog_pars_fragment>
  #include <logdepthbuf_pars_fragment>
  #include <clipping_planes_pars_fragment>
  
  uniform sampler2D map;
  uniform sampler2D alphaMap;
  uniform float useGradient;
  uniform float useMap;
  uniform float useAlphaMap;
  uniform float useDash;
  uniform float dashArray;
  uniform float dashOffset;
  uniform float dashRatio;
  uniform float visibility;
  uniform float alphaTest;
  uniform vec2 repeat;
  uniform vec3 gradient[2];
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  void main() {
    #include <logdepthbuf_fragment>
    vec4 diffuseColor = vColor;
    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);
    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);
    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;
    if (diffuseColor.a < alphaTest) discard;
    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));
    diffuseColor.a *= step(vCounters, visibility);
    #include <clipping_planes_fragment>
    gl_FragColor = diffuseColor;     
    #include <fog_fragment>
    #include <tonemapping_fragment>
    #include <${by>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`;class bx extends sT{constructor(e){super({uniforms:{...A7.fog,lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new aQ(0xffffff)},gradient:{value:[new aQ(0xff0000),new aQ(65280)]},opacity:{value:1},resolution:{value:new nt(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new nt(1,1)}},vertexShader:bv,fragmentShader:bE}),bm(this,"lineWidth"),bm(this,"map"),bm(this,"useMap"),bm(this,"alphaMap"),bm(this,"useAlphaMap"),bm(this,"color"),bm(this,"gradient"),bm(this,"resolution"),bm(this,"sizeAttenuation"),bm(this,"dashArray"),bm(this,"dashOffset"),bm(this,"dashRatio"),bm(this,"useDash"),bm(this,"useGradient"),bm(this,"visibility"),bm(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(e){this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(e){this.uniforms.color.value=e}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(e){this.uniforms.gradient.value=e}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(e){this.uniforms.sizeAttenuation.value=e}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(e){this.uniforms.dashArray.value=e,this.useDash=0!==e?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(e){this.uniforms.dashOffset.value=e}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(e){this.uniforms.dashRatio.value=e}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(e){this.uniforms.useDash.value=e}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(e){this.uniforms.useGradient.value=e}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(e){this.uniforms.repeat.value.copy(e)}}}),this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.gradient=e.gradient,this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.useGradient=e.useGradient,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}let b_={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},bb=(e,t=1)=>(e.set(e.subarray(t)),e.fill(-1/0,-t),e);function bS(e,t){let{length:r,local:i,decay:n,interval:a,stride:s}={...b_,...t},o=eN.useRef(),[l]=eN.useState(()=>new ni);eN.useLayoutEffect(()=>{e&&(o.current=Float32Array.from({length:30*r},(t,r)=>e.position.getComponent(r%3)))},[r,e]);let u=eN.useRef(new ni),c=eN.useRef(0);return dK(()=>{if(e&&o.current){if(0===c.current){let t;i?t=e.position:(e.getWorldPosition(l),t=l);let r=1*n;for(let e=0;e<r;e++)t.distanceTo(u.current)<s||(bb(o.current,3),o.current.set(t.toArray(),o.current.length-3));u.current.copy(t)}c.current++,c.current=c.current%a}}),o}let bw=eN.forwardRef((e,t)=>{let{children:r}=e,{width:i,length:n,decay:a,local:s,stride:o,interval:l}={...b_,...e},{color:u="hotpink",attenuation:c,target:h}=e,d=dY(e=>e.size),f=dY(e=>e.scene),p=eN.useRef(null),[m,g]=eN.useState(null),A=bS(m,{length:n,decay:a,local:s,stride:o,interval:l});eN.useEffect(()=>{let e=(null==h?void 0:h.current)||p.current.children.find(e=>e instanceof aS);e&&g(e)},[A,h]);let v=eN.useMemo(()=>new bA,[]),y=eN.useMemo(()=>{var e;let t;let n=new bx({lineWidth:.1*i,color:u,sizeAttenuation:1,resolution:new nt(d.width,d.height)});return r&&(Array.isArray(r)?t=r.find(e=>"string"==typeof e.type&&"meshLineMaterial"===e.type):"string"==typeof r.type&&"meshLineMaterial"===r.type&&(t=r)),"object"==typeof(null==(e=t)?void 0:e.props)&&n.setValues(t.props),n},[i,u,d,r]);return eN.useEffect(()=>{y.uniforms.resolution.value.set(d.width,d.height)},[d]),dK(()=>{A.current&&v.setPoints(A.current,c)}),eN.createElement("group",null,d2(eN.createElement("mesh",{ref:t,geometry:v,material:y}),f),eN.createElement("group",{ref:p},r))}),bC=new aU,bT=new ni;class bI{constructor(e){let t=e.geometry;t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,r=new Float32Array(e.count/3);for(let i=0;i<e.count;i+=3){let n=1;t&&(n=t.getX(i)+t.getX(i+1)+t.getX(i+2)),bC.a.fromBufferAttribute(e,i),bC.b.fromBufferAttribute(e,i+1),bC.c.fromBufferAttribute(e,i+2),n*=bC.getArea(),r[i/3]=n}this.distribution=new Float32Array(e.count/3);let i=0;for(let e=0;e<r.length;e++)i+=r[e],this.distribution[e]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,r){let i=this.sampleFaceIndex();return this.sampleFace(i,e,t,r)}sampleFaceIndex(){let e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){let t=this.distribution,r=0,i=t.length-1,n=-1;for(;r<=i;){let a=Math.ceil((r+i)/2);if(0===a||t[a-1]<=e&&t[a]>e){n=a;break}e<t[a]?i=a-1:r=a+1}return n}sampleFace(e,t,r,i){let n=this.randomFunction(),a=this.randomFunction();return n+a>1&&(n=1-n,a=1-a),bC.a.fromBufferAttribute(this.positionAttribute,3*e),bC.b.fromBufferAttribute(this.positionAttribute,3*e+1),bC.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(bC.a,n).addScaledVector(bC.b,a).addScaledVector(bC.c,1-(n+a)),void 0!==r&&bC.getNormal(r),void 0!==i&&void 0!==this.colorAttribute&&(bC.a.fromBufferAttribute(this.colorAttribute,3*e),bC.b.fromBufferAttribute(this.colorAttribute,3*e+1),bC.c.fromBufferAttribute(this.colorAttribute,3*e+2),bT.set(0,0,0).addScaledVector(bC.a,n).addScaledVector(bC.b,a).addScaledVector(bC.c,1-(n+a)),i.r=bT.x,i.g=bT.y,i.b=bT.z),this}}function bM(e,t=16,r,i,n){let[a,s]=eN.useState(()=>{let e=Array.from({length:t},()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]).flat();return new op(Float32Array.from(e),16)});return eN.useLayoutEffect(()=>{if(void 0===e.current)return;let o=new bI(e.current);i&&o.setWeightAttribute(i),o.build();let l=new ni,u=new ni,c=new aQ,h=new aS;e.current.updateMatrixWorld(!0);for(let i=0;i<t;i++)o.sample(l,u,c),"function"==typeof r?r({dummy:h,sampledMesh:e.current,position:l,normal:u,color:c},i):h.position.copy(l),h.updateMatrix(),null!=n&&n.current&&n.current.setMatrixAt(i,h.matrix),h.matrix.toArray(a.array,16*i);null!=n&&n.current&&(n.current.instanceMatrix.needsUpdate=!0),a.needsUpdate=!0,s(new op(a.array,a.itemSize).copy(a))},[e,n,i,t,r]),a}function bR({children:e,weight:t,transform:r,instances:i,mesh:n,count:a=16,...s}){let o=eN.useRef(null),l=eN.useRef(null),u=eN.useRef(null);return eN.useLayoutEffect(()=>{var e,t;l.current=null!==(e=null==i?void 0:i.current)&&void 0!==e?e:o.current.children.find(e=>e.hasOwnProperty("instanceMatrix")),u.current=null!==(t=null==n?void 0:n.current)&&void 0!==t?t:o.current.children.find(e=>"Mesh"===e.type)},[e,null==n?void 0:n.current,null==i?void 0:i.current]),bM(u,a,r,t,l),eN.createElement("group",eU({ref:o},s),e)}let bB=({compute:e,name:t,...r})=>{let[i]=eN.useState(()=>new a1(new Float32Array(0),1)),n=eN.useRef(null);return eN.useLayoutEffect(()=>{if(n.current){var t;let r=e(null!==(t=n.current.parent)&&void 0!==t?t:n.current.__r3f.parent);n.current.copy(r)}},[e]),eN.createElement("primitive",eU({ref:n,object:i,attach:`attributes-${t}`},r))},bD={clone:function(e){let t=new Map,r=new Map,i=e.clone();return function e(t,r,i){i(t,r);for(let n=0;n<t.children.length;n++)e(t.children[n],r.children[n],i)}(e,i,function(e,i){t.set(i,e),r.set(e,i)}),i.traverse(function(e){if(!e.isSkinnedMesh)return;let i=t.get(e),n=i.skeleton.bones;e.skeleton=i.skeleton.clone(),e.bindMatrix.copy(i.bindMatrix),e.skeleton.bones=n.map(function(e){return r.get(e)}),e.bind(e.skeleton,e.bindMatrix)}),i}},bP=eN.forwardRef(({isChild:e=!1,object:t,children:r,deep:i,castShadow:n,receiveShadow:a,inject:s,keys:o,...l},u)=>{let c={keys:o,deep:i,inject:s,castShadow:n,receiveShadow:a};if(Array.isArray(t=eN.useMemo(()=>{if(!1===e&&!Array.isArray(t)){let e=!1;if(t.traverse(t=>{t.isSkinnedMesh&&(e=!0)}),e)return bD.clone(t)}return t},[t,e])))return eN.createElement("group",eU({},l,{ref:u}),t.map(e=>eN.createElement(bP,eU({key:e.uuid,object:e},c))),r);let{children:h,...d}=function(e,{keys:t=["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData","bindMode","bindMatrix","bindMatrixInverse","skeleton"],deep:r,inject:i,castShadow:n,receiveShadow:a}){let s={};for(let r of t)s[r]=e[r];return r&&(s.geometry&&"materialsOnly"!==r&&(s.geometry=s.geometry.clone()),s.material&&"geometriesOnly"!==r&&(s.material=s.material.clone())),i&&(s="function"==typeof i?{...s,children:i(e)}:eN.isValidElement(i)?{...s,children:i}:{...s,...i}),e instanceof sE&&(n&&(s.castShadow=!0),a&&(s.receiveShadow=!0)),s}(t,c),f=t.type[0].toLowerCase()+t.type.slice(1);return eN.createElement(f,eU({},d,l,{ref:u}),t.children.map(e=>"Bone"===e.type?eN.createElement("primitive",eU({key:e.uuid,object:e},c)):eN.createElement(bP,eU({key:e.uuid,object:e},c,{isChild:!0}))),r,h)});class bL extends sE{constructor(e,t,r=!1,i=!1,n=1e4){let a=new sl;super(a,t),this.isMarchingCubes=!0;let s=this,o=new Float32Array(36),l=new Float32Array(36),u=new Float32Array(36);function c(e,t,r,i,n,a,c,h,d,f){var p,m,g,A,v,y;let E=(r-c)/(h-c),x=s.normal_cache;o[t+0]=i+E*s.delta,o[t+1]=n,o[t+2]=a,l[t+0]=(p=x[e+0])+(x[e+3]-p)*E,l[t+1]=(m=x[e+1])+(x[e+4]-m)*E,l[t+2]=(g=x[e+2])+(x[e+5]-g)*E,u[t+0]=(A=s.palette[3*d+0])+(s.palette[3*f+0]-A)*E,u[t+1]=(v=s.palette[3*d+1])+(s.palette[3*f+1]-v)*E,u[t+2]=(y=s.palette[3*d+2])+(s.palette[3*f+2]-y)*E}function h(e,t,r,i,n,a,c,h,d,f){var p,m,g,A,v,y;let E=(r-c)/(h-c),x=s.normal_cache;o[t+0]=i,o[t+1]=n+E*s.delta,o[t+2]=a;let _=e+3*s.yd;l[t+0]=(p=x[e+0])+(x[_+0]-p)*E,l[t+1]=(m=x[e+1])+(x[_+1]-m)*E,l[t+2]=(g=x[e+2])+(x[_+2]-g)*E,u[t+0]=(A=s.palette[3*d+0])+(s.palette[3*f+0]-A)*E,u[t+1]=(v=s.palette[3*d+1])+(s.palette[3*f+1]-v)*E,u[t+2]=(y=s.palette[3*d+2])+(s.palette[3*f+2]-y)*E}function d(e,t,r,i,n,a,c,h,d,f){var p,m,g,A,v,y;let E=(r-c)/(h-c),x=s.normal_cache;o[t+0]=i,o[t+1]=n,o[t+2]=a+E*s.delta;let _=e+3*s.zd;l[t+0]=(p=x[e+0])+(x[_+0]-p)*E,l[t+1]=(m=x[e+1])+(x[_+1]-m)*E,l[t+2]=(g=x[e+2])+(x[_+2]-g)*E,u[t+0]=(A=s.palette[3*d+0])+(s.palette[3*f+0]-A)*E,u[t+1]=(v=s.palette[3*d+1])+(s.palette[3*f+1]-v)*E,u[t+2]=(y=s.palette[3*d+2])+(s.palette[3*f+2]-y)*E}function f(e){let t=3*e;0===s.normal_cache[t]&&(s.normal_cache[t+0]=s.field[e-1]-s.field[e+1],s.normal_cache[t+1]=s.field[e-s.yd]-s.field[e+s.yd],s.normal_cache[t+2]=s.field[e-s.zd]-s.field[e+s.zd])}this.enableUvs=r,this.enableColors=i,this.init=function(e){this.resolution=e,this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.palette=new Float32Array(3*this.size3),this.count=0;let t=3*n;this.positionArray=new Float32Array(3*t);let r=new a1(this.positionArray,3);r.setUsage(iU),a.setAttribute("position",r),this.normalArray=new Float32Array(3*t);let i=new a1(this.normalArray,3);if(i.setUsage(iU),a.setAttribute("normal",i),this.enableUvs){this.uvArray=new Float32Array(2*t);let e=new a1(this.uvArray,2);e.setUsage(iU),a.setAttribute("uv",e)}if(this.enableColors){this.colorArray=new Float32Array(3*t);let e=new a1(this.colorArray,3);e.setUsage(iU),a.setAttribute("color",e)}a.boundingSphere=new nJ(new ni,1)},this.addBall=function(e,t,r,i,n,a){let s,o,l,u,c,h,d,f,p,m,g;let A=Math.sign(i);i=Math.abs(i);let v=null!=a,y=new aQ(e,t,r);if(v)try{y=a instanceof aQ?a:Array.isArray(a)?new aQ(Math.min(Math.abs(a[0]),1),Math.min(Math.abs(a[1]),1),Math.min(Math.abs(a[2]),1)):new aQ(a)}catch(i){y=new aQ(e,t,r)}let E=this.size*Math.sqrt(i/n),x=r*this.size,_=t*this.size,b=e*this.size,S=Math.floor(x-E);S<1&&(S=1);let w=Math.floor(x+E);w>this.size-1&&(w=this.size-1);let C=Math.floor(_-E);C<1&&(C=1);let T=Math.floor(_+E);T>this.size-1&&(T=this.size-1);let I=Math.floor(b-E);I<1&&(I=1);let M=Math.floor(b+E);for(M>this.size-1&&(M=this.size-1),l=S;l<w;l++)for(c=this.size2*l,p=(f=l/this.size-r)*f,o=C;o<T;o++)for(u=c+this.size*o,m=(d=o/this.size-t)*d,s=I;s<M;s++)if((g=i/(1e-6+(h=s/this.size-e)*h+m+p)-n)>0){this.field[u+s]+=g*A;let e=Math.sqrt((s-b)*(s-b)+(o-_)*(o-_)+(l-x)*(l-x))/E,t=1-e*e*e*(e*(6*e-15)+10);this.palette[(u+s)*3+0]+=y.r*t,this.palette[(u+s)*3+1]+=y.g*t,this.palette[(u+s)*3+2]+=y.b*t}},this.addPlaneX=function(e,t){let r=this.size,i=this.yd,n=this.zd,a=this.field,s,o,l,u,c,h,d=r*Math.sqrt(e/t);for(d>r&&(d=r),s=0;s<d;s++)if((u=e/(1e-4+(c=s/r)*c)-t)>0)for(o=0;o<r;o++)for(l=0,h=s+o*i;l<r;l++)a[n*l+h]+=u},this.addPlaneY=function(e,t){let r=this.size,i=this.yd,n=this.zd,a=this.field,s,o,l,u,c,h,d,f=r*Math.sqrt(e/t);for(f>r&&(f=r),o=0;o<f;o++)if((u=e/(1e-4+(c=o/r)*c)-t)>0)for(s=0,h=o*i;s<r;s++)for(l=0,d=h+s;l<r;l++)a[n*l+d]+=u},this.addPlaneZ=function(e,t){let r=this.size,i=this.yd,n=this.zd,a=this.field,s,o,l,u,c,h,d,f=r*Math.sqrt(e/t);for(f>r&&(f=r),l=0;l<f;l++)if((u=e/(1e-4+(c=l/r)*c)-t)>0)for(o=0,h=n*l;o<r;o++)for(s=0,d=h+o*i;s<r;s++)a[d+s]+=u},this.setCell=function(e,t,r,i){let n=this.size2*r+this.size*t+e;this.field[n]=i},this.getCell=function(e,t,r){let i=this.size2*r+this.size*t+e;return this.field[i]},this.blur=function(e=1){let t=this.field,r=t.slice(),i=this.size,n=this.size2;for(let a=0;a<i;a++)for(let s=0;s<i;s++)for(let o=0;o<i;o++){let l=n*o+i*s+a,u=r[l],c=1;for(let t=-1;t<=1;t+=2){let l=t+a;if(!(l<0)&&!(l>=i))for(let t=-1;t<=1;t+=2){let a=t+s;if(!(a<0)&&!(a>=i))for(let t=-1;t<=1;t+=2){let s=t+o;if(s<0||s>=i)continue;let h=r[n*s+i*a+l];c++,u+=e*(h-u)/c}}}t[l]=u}},this.reset=function(){for(let e=0;e<this.size3;e++)this.normal_cache[3*e]=0,this.field[e]=0,this.palette[3*e]=this.palette[3*e+1]=this.palette[3*e+2]=0},this.update=function(){this.count=0;let e=this.size-2;for(let t=1;t<e;t++){let r=this.size2*t,i=(t-this.halfsize)/this.halfsize;for(let t=1;t<e;t++){let n=r+this.size*t,a=(t-this.halfsize)/this.halfsize;for(let t=1;t<e;t++)!function(e,t,r,i,n){let a=i+1,p=i+s.yd,m=i+s.zd,g=a+s.yd,A=a+s.zd,v=i+s.yd+s.zd,y=a+s.yd+s.zd,E=0,x=s.field[i],_=s.field[a],b=s.field[p],S=s.field[g],w=s.field[m],C=s.field[A],T=s.field[v],I=s.field[y];x<n&&(E|=1),_<n&&(E|=2),b<n&&(E|=8),S<n&&(E|=4),w<n&&(E|=16),C<n&&(E|=32),T<n&&(E|=128),I<n&&(E|=64);let M=bk[E];if(0===M)return;let R=s.delta,B=e+R,D=t+R,P=r+R;1&M&&(f(i),f(a),c(3*i,0,n,e,t,r,x,_,i,a)),2&M&&(f(a),f(g),h(3*a,3,n,B,t,r,_,S,a,g)),4&M&&(f(p),f(g),c(3*p,6,n,e,D,r,b,S,p,g)),8&M&&(f(i),f(p),h(3*i,9,n,e,t,r,x,b,i,p)),16&M&&(f(m),f(A),c(3*m,12,n,e,t,P,w,C,m,A)),32&M&&(f(A),f(y),h(3*A,15,n,B,t,P,C,I,A,y)),64&M&&(f(v),f(y),c(3*v,18,n,e,D,P,T,I,v,y)),128&M&&(f(m),f(v),h(3*m,21,n,e,t,P,w,T,m,v)),256&M&&(f(i),f(m),d(3*i,24,n,e,t,r,x,w,i,m)),512&M&&(f(a),f(A),d(3*a,27,n,B,t,r,_,C,a,A)),1024&M&&(f(g),f(y),d(3*g,30,n,B,D,r,S,I,g,y)),2048&M&&(f(p),f(v),d(3*p,33,n,e,D,r,b,T,p,v)),E<<=4;let L,k,F,O=0;for(;-1!=bF[E+O];)k=(L=E+O)+1,F=L+2,function(e,t,r,i,n,a){let o=3*s.count;if(s.positionArray[o+0]=e[i],s.positionArray[o+1]=e[i+1],s.positionArray[o+2]=e[i+2],s.positionArray[o+3]=e[n],s.positionArray[o+4]=e[n+1],s.positionArray[o+5]=e[n+2],s.positionArray[o+6]=e[a],s.positionArray[o+7]=e[a+1],s.positionArray[o+8]=e[a+2],!0===s.material.flatShading){let e=(t[i+0]+t[n+0]+t[a+0])/3,r=(t[i+1]+t[n+1]+t[a+1])/3,l=(t[i+2]+t[n+2]+t[a+2])/3;s.normalArray[o+0]=e,s.normalArray[o+1]=r,s.normalArray[o+2]=l,s.normalArray[o+3]=e,s.normalArray[o+4]=r,s.normalArray[o+5]=l,s.normalArray[o+6]=e,s.normalArray[o+7]=r,s.normalArray[o+8]=l}else s.normalArray[o+0]=t[i+0],s.normalArray[o+1]=t[i+1],s.normalArray[o+2]=t[i+2],s.normalArray[o+3]=t[n+0],s.normalArray[o+4]=t[n+1],s.normalArray[o+5]=t[n+2],s.normalArray[o+6]=t[a+0],s.normalArray[o+7]=t[a+1],s.normalArray[o+8]=t[a+2];if(s.enableUvs){let t=2*s.count;s.uvArray[t+0]=e[i+0],s.uvArray[t+1]=e[i+2],s.uvArray[t+2]=e[n+0],s.uvArray[t+3]=e[n+2],s.uvArray[t+4]=e[a+0],s.uvArray[t+5]=e[a+2]}s.enableColors&&(s.colorArray[o+0]=r[i+0],s.colorArray[o+1]=r[i+1],s.colorArray[o+2]=r[i+2],s.colorArray[o+3]=r[n+0],s.colorArray[o+4]=r[n+1],s.colorArray[o+5]=r[n+2],s.colorArray[o+6]=r[a+0],s.colorArray[o+7]=r[a+1],s.colorArray[o+8]=r[a+2]),s.count+=3}(o,l,u,3*bF[L],3*bF[k],3*bF[F]),O+=3}((t-this.halfsize)/this.halfsize,a,i,n+t,this.isolation)}}this.geometry.setDrawRange(0,this.count),a.getAttribute("position").needsUpdate=!0,a.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(a.getAttribute("uv").needsUpdate=!0),this.enableColors&&(a.getAttribute("color").needsUpdate=!0),this.count/3>n&&console.warn("THREE.MarchingCubes: Geometry buffers too small for rendering. Please create an instance with a higher poly count.")},this.init(e)}}let bk=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),bF=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),bO=eN.createContext(null),bU=eN.forwardRef(({resolution:e=28,maxPolyCount:t=1e4,enableUvs:r=!1,enableColors:i=!1,children:n,...a},s)=>{let o=eN.useRef(null);eN.useImperativeHandle(s,()=>o.current,[]);let l=eN.useMemo(()=>new bL(e,null,r,i,t),[e,t,r,i]),u=eN.useMemo(()=>({getParent:()=>o}),[]);return dK(()=>{l.update(),l.reset()},-1),eN.createElement(eN.Fragment,null,eN.createElement("primitive",eU({object:l,ref:o},a),eN.createElement(bO.Provider,{value:u},n)))}),bN=eN.forwardRef(({strength:e=.5,subtract:t=12,color:r,...i},n)=>{let{getParent:a}=eN.useContext(bO),s=eN.useMemo(()=>a(),[a]),o=eN.useRef(null);eN.useImperativeHandle(n,()=>o.current,[]);let l=new ni;return dK(i=>{s.current&&o.current&&(o.current.getWorldPosition(l),s.current.addBall(.5+.5*l.x,.5+.5*l.y,.5+.5*l.z,e,t,r))}),eN.createElement("group",eU({ref:o},i))}),bz=eN.forwardRef(({planeType:e="x",strength:t=.5,subtract:r=12,...i},n)=>{let{getParent:a}=eN.useContext(bO),s=eN.useMemo(()=>a(),[a]),o=eN.useRef(null);eN.useImperativeHandle(n,()=>o.current,[]);let l=eN.useMemo(()=>"x"===e?"addPlaneX":"y"===e?"addPlaneY":"addPlaneZ",[e]);return dK(()=>{s.current&&o.current&&s.current[l](t,r)}),eN.createElement("group",eU({ref:o},i))});class bG extends sl{constructor(e,t,r,i){super();let n=[],a=[],s=[],o=new ni,l=new n8;l.makeRotationFromEuler(r),l.setPosition(t);let u=new n8;function c(t,r,i){r.applyMatrix4(e.matrixWorld),r.applyMatrix4(u),i.transformDirection(e.matrixWorld),t.push(new bH(r.clone(),i.clone()))}function h(e,t){let r=[],n=.5*Math.abs(i.dot(t));for(let i=0;i<e.length;i+=3){let a,s,o,l,u,c,h;let f=e[i+0].position.dot(t)-n,p=e[i+1].position.dot(t)-n,m=e[i+2].position.dot(t)-n;switch(((u=f>0)?1:0)+((c=p>0)?1:0)+((h=m>0)?1:0)){case 0:r.push(e[i]),r.push(e[i+1]),r.push(e[i+2]);break;case 1:if(u&&(a=e[i+1],s=e[i+2],o=d(e[i],a,t,n),l=d(e[i],s,t,n)),c){a=e[i],s=e[i+2],o=d(e[i+1],a,t,n),l=d(e[i+1],s,t,n),r.push(o),r.push(s.clone()),r.push(a.clone()),r.push(s.clone()),r.push(o.clone()),r.push(l);break}h&&(a=e[i],s=e[i+1],o=d(e[i+2],a,t,n),l=d(e[i+2],s,t,n)),r.push(a.clone()),r.push(s.clone()),r.push(o),r.push(l),r.push(o.clone()),r.push(s.clone());break;case 2:u||(s=d(a=e[i].clone(),e[i+1],t,n),o=d(a,e[i+2],t,n),r.push(a),r.push(s),r.push(o)),c||(s=d(a=e[i+1].clone(),e[i+2],t,n),o=d(a,e[i],t,n),r.push(a),r.push(s),r.push(o)),h||(s=d(a=e[i+2].clone(),e[i],t,n),o=d(a,e[i+1],t,n),r.push(a),r.push(s),r.push(o))}}return r}function d(e,t,r,i){let n=e.position.dot(r)-i,a=n/(n-(t.position.dot(r)-i));return new bH(new ni(e.position.x+a*(t.position.x-e.position.x),e.position.y+a*(t.position.y-e.position.y),e.position.z+a*(t.position.z-e.position.z)),new ni(e.normal.x+a*(t.normal.x-e.normal.x),e.normal.y+a*(t.normal.y-e.normal.y),e.normal.z+a*(t.normal.z-e.normal.z)))}u.copy(l).invert(),function(){let t;let r=[],u=new ni,d=new ni;if(!0===e.geometry.isGeometry){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}let f=e.geometry,p=f.attributes.position,m=f.attributes.normal;if(null!==f.index){let e=f.index;for(t=0;t<e.count;t++)u.fromBufferAttribute(p,e.getX(t)),d.fromBufferAttribute(m,e.getX(t)),c(r,u,d)}else for(t=0;t<p.count;t++)u.fromBufferAttribute(p,t),d.fromBufferAttribute(m,t),c(r,u,d);for(t=0,r=h(r,o.set(1,0,0)),r=h(r,o.set(-1,0,0)),r=h(r,o.set(0,1,0)),r=h(r,o.set(0,-1,0)),r=h(r,o.set(0,0,1)),r=h(r,o.set(0,0,-1));t<r.length;t++){let e=r[t];s.push(.5+e.position.x/i.x,.5+e.position.y/i.y),e.position.applyMatrix4(l),n.push(e.position.x,e.position.y,e.position.z),a.push(e.normal.x,e.normal.y,e.normal.z)}}(),this.setAttribute("position",new se(n,3)),this.setAttribute("normal",new se(a,3)),this.setAttribute("uv",new se(s,2))}}class bH{constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}function bQ(e=[0,0,0]){return Array.isArray(e)?e:e instanceof ni||e instanceof ao?[e.x,e.y,e.z]:[e,e,e]}let bV=eN.forwardRef(function({debug:e,depthTest:t=!1,polygonOffsetFactor:r=-10,map:i,mesh:n,children:a,position:s,rotation:o,scale:l,...u},c){let h=eN.useRef(null);eN.useImperativeHandle(c,()=>h.current);let d=eN.useRef(null),f=eN.useRef({position:new ni,rotation:new ao,scale:new ni(1,1,1)});return eN.useLayoutEffect(()=>{let e=(null==n?void 0:n.current)||h.current.parent,t=h.current;if(!(e instanceof sE))throw Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(e){d1(f.current,{position:s,scale:l});let r=e.matrixWorld.clone();if(e.matrixWorld.identity(),o&&"number"!=typeof o)d1(f.current,{rotation:o});else{let t=new aS;t.position.copy(f.current.position);let r=e.geometry.attributes.position.array;void 0===e.geometry.attributes.normal&&e.geometry.computeVertexNormals();let i=e.geometry.attributes.normal.array,n=1/0;new ni;let a=new ni,s=t.position.x,l=t.position.y,u=t.position.z,c=r.length,h=-1;for(let e=0;e<c;e+=3){let t=r[e],i=r[e+1],a=r[e+2],o=t-s,c=i-l,d=a-u,f=o*o+c*c+d*d;f<n&&(n=f,h=e)}a.fromArray(i,h),t.lookAt(t.position.clone().add(a)),t.rotateZ(Math.PI),t.rotateY(Math.PI),"number"==typeof o&&t.rotateZ(o),d1(f.current,{rotation:t.rotation})}return t.geometry=new bG(e,f.current.position,f.current.rotation,f.current.scale),e.matrixWorld=r,()=>{t.geometry.dispose()}}},[n,...bQ(s),...bQ(l),...bQ(o)]),eN.useLayoutEffect(()=>{d.current&&(d1(d.current,f.current),d.current.traverse(e=>e.raycast=()=>null))},[e]),eN.createElement("mesh",eU({ref:h,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":r,"material-depthTest":t,"material-map":i},u),a,e&&eN.createElement("mesh",{ref:d},eN.createElement("boxGeometry",null),eN.createElement("meshNormalMaterial",{wireframe:!0}),eN.createElement("axesHelper",null)))}),bW=(()=>{class e extends u4{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,r,i){let n=this,a=new u8(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(e,function(r){try{t(n.parse(r))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}},r,i)}parse(e){let t=this;function r(e,t,r,n,a,s,o,l){if(0==t||0==r){e.lineTo(l.x,l.y);return}n=n*Math.PI/180,t=Math.abs(t),r=Math.abs(r);let u=(o.x-l.x)/2,c=(o.y-l.y)/2,h=Math.cos(n)*u+Math.sin(n)*c,d=-Math.sin(n)*u+Math.cos(n)*c,f=t*t,p=r*r,m=h*h,g=d*d,A=m/f+g/p;if(A>1){let e=Math.sqrt(A);t*=e,r*=e,f=t*t,p=r*r}let v=f*g+p*m,y=Math.sqrt(Math.max(0,(f*p-v)/v));a===s&&(y=-y);let E=y*t*d/r,x=-y*r*h/t,_=Math.cos(n)*E-Math.sin(n)*x+(o.x+l.x)/2,b=Math.sin(n)*E+Math.cos(n)*x+(o.y+l.y)/2,S=i(1,0,(h-E)/t,(d-x)/r),w=i((h-E)/t,(d-x)/r,(-h-E)/t,(-d-x)/r)%(2*Math.PI);e.currentPath.absellipse(_,b,t,r,S,S+w,0===s,n)}function i(e,t,r,i){let n=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+i*i),a=Math.acos(Math.max(-1,Math.min(1,(e*r+t*i)/n)));return e*i-t*r<0&&(a=-a),a}function n(e,t){t=Object.assign({},t);let r={};if(e.hasAttribute("class")){let t=e.getAttribute("class").split(/\s/).filter(Boolean).map(e=>e.trim());for(let e=0;e<t.length;e++)r=Object.assign(r,f["."+t[e]])}function i(i,n,a){void 0===a&&(a=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(i)&&(t[n]=a(e.getAttribute(i))),r[i]&&(t[n]=a(r[i])),e.style&&""!==e.style[i]&&(t[n]=a(e.style[i]))}function n(e){return Math.max(0,Math.min(1,l(e)))}function a(e){return Math.max(0,l(e))}return e.hasAttribute("id")&&(r=Object.assign(r,f["#"+e.getAttribute("id")])),i("fill","fill"),i("fill-opacity","fillOpacity",n),i("fill-rule","fillRule"),i("opacity","opacity",n),i("stroke","stroke"),i("stroke-opacity","strokeOpacity",n),i("stroke-width","strokeWidth",a),i("stroke-linejoin","strokeLineJoin"),i("stroke-linecap","strokeLineCap"),i("stroke-miterlimit","strokeMiterLimit",a),i("visibility","visibility"),t}function a(e,t,r){let i;if("string"!=typeof e)throw TypeError("Invalid input: "+typeof e);let n={WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},a=0,s=!0,o="",l="",u=[];function c(e,t,r){let i=SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw i.partial=r,i}function h(){""!==o&&(""===l?u.push(Number(o)):u.push(Number(o)*Math.pow(10,Number(l)))),o="",l=""}let d=e.length;for(let f=0;f<d;f++){if(i=e[f],Array.isArray(t)&&t.includes(u.length%r)&&n.FLAGS.test(i)){a=1,o=i,h();continue}if(0===a){if(n.WHITESPACE.test(i))continue;if(n.DIGIT.test(i)||n.SIGN.test(i)){a=1,o=i;continue}if(n.POINT.test(i)){a=2,o=i;continue}n.COMMA.test(i)&&(s&&c(i,f,u),s=!0)}if(1===a){if(n.DIGIT.test(i)){o+=i;continue}if(n.POINT.test(i)){o+=i,a=2;continue}if(n.EXP.test(i)){a=3;continue}n.SIGN.test(i)&&1===o.length&&n.SIGN.test(o[0])&&c(i,f,u)}if(2===a){if(n.DIGIT.test(i)){o+=i;continue}if(n.EXP.test(i)){a=3;continue}n.POINT.test(i)&&"."===o[o.length-1]&&c(i,f,u)}if(3===a){if(n.DIGIT.test(i)){l+=i;continue}if(n.SIGN.test(i)){if(""===l){l+=i;continue}1===l.length&&n.SIGN.test(l)&&c(i,f,u)}}n.WHITESPACE.test(i)?(h(),a=0,s=!1):n.COMMA.test(i)?(h(),a=0,s=!0):n.SIGN.test(i)?(h(),a=1,o=i):n.POINT.test(i)?(h(),a=2,o=i):c(i,f,u)}return h(),u}let s=["mm","cm","in","pt","pc","px"],o={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function l(e){let r,i="px";if("string"==typeof e||e instanceof String)for(let t=0,r=s.length;t<r;t++){let r=s[t];if(e.endsWith(r)){i=r,e=e.substring(0,e.length-r.length);break}}return"px"===i&&"px"!==t.defaultUnit?r=o.in[t.defaultUnit]/t.defaultDPI:(r=o[i][t.defaultUnit])<0&&(r=o[i].in*t.defaultDPI),r*parseFloat(e)}function u(e){let t=e.elements;return t[0]*t[4]-t[1]*t[3]<0}function c(e){let t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function h(e){let t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}let d=[],f={},p=[],m=new ns,g=new ns,A=new ns,v=new ns,y=new nt,E=new ni,x=new ns,_=new DOMParser().parseFromString(e,"image/svg+xml");return function e(t,i){if(1!==t.nodeType)return;let s=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;let t=function(e){let t=new ns;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){let r=l(e.getAttribute("x")),i=l(e.getAttribute("y"));t.translate(r,i)}if(e.hasAttribute("transform")){let r=e.getAttribute("transform").split(")");for(let e=r.length-1;e>=0;e--){let i=r[e].trim();if(""===i)continue;let n=i.indexOf("("),s=i.length;if(n>0&&n<s){let e=i.slice(0,n),t=a(i.slice(n+1));switch(m.identity(),e){case"translate":if(t.length>=1){let e=t[0],r=0;t.length>=2&&(r=t[1]),m.translate(e,r)}break;case"rotate":if(t.length>=1){let e=0,r=0,i=0;e=t[0]*Math.PI/180,t.length>=3&&(r=t[1],i=t[2]),g.makeTranslation(-r,-i),A.makeRotation(e),v.multiplyMatrices(A,g),g.makeTranslation(r,i),m.multiplyMatrices(g,v)}break;case"scale":if(t.length>=1){let e=t[0],r=e;t.length>=2&&(r=t[1]),m.scale(e,r)}break;case"skewX":1===t.length&&m.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&m.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&m.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(m)}}return t}(e);return p.length>0&&t.premultiply(p[p.length-1]),x.copy(t),p.push(t),t}(t),o=!1,_=null;switch(t.nodeName){case"svg":case"g":i=n(t,i);break;case"style":(function(e){if(e.sheet&&e.sheet.cssRules&&e.sheet.cssRules.length)for(let t=0;t<e.sheet.cssRules.length;t++){let r=e.sheet.cssRules[t];if(1!==r.type)continue;let i=r.selectorText.split(/,/gm).filter(Boolean).map(e=>e.trim());for(let e=0;e<i.length;e++){let t=Object.fromEntries(Object.entries(r.style).filter(([,e])=>""!==e));f[i[e]]=Object.assign(f[i[e]]||{},t)}}})(t);break;case"path":i=n(t,i),t.hasAttribute("d")&&(_=function(e){let t=new h5,i=new nt,n=new nt,s=new nt,o=!0,l=!1,u=e.getAttribute("d");if(""===u||"none"===u)return null;let c=u.match(/[a-df-z][^a-df-z]*/gi);for(let e=0,u=c.length;e<u;e++){var h,d,f,p,m,g,A,v;let u;let y=c[e],E=y.charAt(0),x=y.slice(1).trim();switch(!0===o&&(l=!0,o=!1),E){case"M":u=a(x);for(let e=0,r=u.length;e<r;e+=2)i.x=u[e+0],i.y=u[e+1],n.x=i.x,n.y=i.y,0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===e&&s.copy(i);break;case"H":u=a(x);for(let e=0,r=u.length;e<r;e++)i.x=u[e],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&s.copy(i);break;case"V":u=a(x);for(let e=0,r=u.length;e<r;e++)i.y=u[e],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&s.copy(i);break;case"L":u=a(x);for(let e=0,r=u.length;e<r;e+=2)i.x=u[e+0],i.y=u[e+1],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&s.copy(i);break;case"C":u=a(x);for(let e=0,r=u.length;e<r;e+=6)t.bezierCurveTo(u[e+0],u[e+1],u[e+2],u[e+3],u[e+4],u[e+5]),n.x=u[e+2],n.y=u[e+3],i.x=u[e+4],i.y=u[e+5],0===e&&!0===l&&s.copy(i);break;case"S":u=a(x);for(let e=0,r=u.length;e<r;e+=4)t.bezierCurveTo((h=i.x)-(n.x-h),(d=i.y)-(n.y-d),u[e+0],u[e+1],u[e+2],u[e+3]),n.x=u[e+0],n.y=u[e+1],i.x=u[e+2],i.y=u[e+3],0===e&&!0===l&&s.copy(i);break;case"Q":u=a(x);for(let e=0,r=u.length;e<r;e+=4)t.quadraticCurveTo(u[e+0],u[e+1],u[e+2],u[e+3]),n.x=u[e+0],n.y=u[e+1],i.x=u[e+2],i.y=u[e+3],0===e&&!0===l&&s.copy(i);break;case"T":u=a(x);for(let e=0,r=u.length;e<r;e+=2){let r=(f=i.x)-(n.x-f),a=(p=i.y)-(n.y-p);t.quadraticCurveTo(r,a,u[e+0],u[e+1]),n.x=r,n.y=a,i.x=u[e+0],i.y=u[e+1],0===e&&!0===l&&s.copy(i)}break;case"A":u=a(x,[3,4],7);for(let e=0,a=u.length;e<a;e+=7){if(u[e+5]==i.x&&u[e+6]==i.y)continue;let a=i.clone();i.x=u[e+5],i.y=u[e+6],n.x=i.x,n.y=i.y,r(t,u[e],u[e+1],u[e+2],u[e+3],u[e+4],a,i),0===e&&!0===l&&s.copy(i)}break;case"m":u=a(x);for(let e=0,r=u.length;e<r;e+=2)i.x+=u[e+0],i.y+=u[e+1],n.x=i.x,n.y=i.y,0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===e&&s.copy(i);break;case"h":u=a(x);for(let e=0,r=u.length;e<r;e++)i.x+=u[e],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&s.copy(i);break;case"v":u=a(x);for(let e=0,r=u.length;e<r;e++)i.y+=u[e],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&s.copy(i);break;case"l":u=a(x);for(let e=0,r=u.length;e<r;e+=2)i.x+=u[e+0],i.y+=u[e+1],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&s.copy(i);break;case"c":u=a(x);for(let e=0,r=u.length;e<r;e+=6)t.bezierCurveTo(i.x+u[e+0],i.y+u[e+1],i.x+u[e+2],i.y+u[e+3],i.x+u[e+4],i.y+u[e+5]),n.x=i.x+u[e+2],n.y=i.y+u[e+3],i.x+=u[e+4],i.y+=u[e+5],0===e&&!0===l&&s.copy(i);break;case"s":u=a(x);for(let e=0,r=u.length;e<r;e+=4)t.bezierCurveTo((m=i.x)-(n.x-m),(g=i.y)-(n.y-g),i.x+u[e+0],i.y+u[e+1],i.x+u[e+2],i.y+u[e+3]),n.x=i.x+u[e+0],n.y=i.y+u[e+1],i.x+=u[e+2],i.y+=u[e+3],0===e&&!0===l&&s.copy(i);break;case"q":u=a(x);for(let e=0,r=u.length;e<r;e+=4)t.quadraticCurveTo(i.x+u[e+0],i.y+u[e+1],i.x+u[e+2],i.y+u[e+3]),n.x=i.x+u[e+0],n.y=i.y+u[e+1],i.x+=u[e+2],i.y+=u[e+3],0===e&&!0===l&&s.copy(i);break;case"t":u=a(x);for(let e=0,r=u.length;e<r;e+=2){let r=(A=i.x)-(n.x-A),a=(v=i.y)-(n.y-v);t.quadraticCurveTo(r,a,i.x+u[e+0],i.y+u[e+1]),n.x=r,n.y=a,i.x=i.x+u[e+0],i.y=i.y+u[e+1],0===e&&!0===l&&s.copy(i)}break;case"a":u=a(x,[3,4],7);for(let e=0,a=u.length;e<a;e+=7){if(0==u[e+5]&&0==u[e+6])continue;let a=i.clone();i.x+=u[e+5],i.y+=u[e+6],n.x=i.x,n.y=i.y,r(t,u[e],u[e+1],u[e+2],u[e+3],u[e+4],a,i),0===e&&!0===l&&s.copy(i)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(i.copy(s),t.currentPath.currentPoint.copy(i),o=!0);break;default:console.warn(y)}l=!1}return t}(t));break;case"rect":i=n(t,i),_=function(e){let t=l(e.getAttribute("x")||0),r=l(e.getAttribute("y")||0),i=l(e.getAttribute("rx")||e.getAttribute("ry")||0),n=l(e.getAttribute("ry")||e.getAttribute("rx")||0),a=l(e.getAttribute("width")),s=l(e.getAttribute("height")),o=new h5;return o.moveTo(t+i,r),o.lineTo(t+a-i,r),(0!==i||0!==n)&&o.bezierCurveTo(t+a-.448084975506*i,r,t+a,r+.448084975506*n,t+a,r+n),o.lineTo(t+a,r+s-n),(0!==i||0!==n)&&o.bezierCurveTo(t+a,r+s-.448084975506*n,t+a-.448084975506*i,r+s,t+a-i,r+s),o.lineTo(t+i,r+s),(0!==i||0!==n)&&o.bezierCurveTo(t+.448084975506*i,r+s,t,r+s-.448084975506*n,t,r+s-n),o.lineTo(t,r+n),(0!==i||0!==n)&&o.bezierCurveTo(t,r+.448084975506*n,t+.448084975506*i,r,t+i,r),o}(t);break;case"polygon":i=n(t,i),_=function(e){let t=new h5,r=0;return e.getAttribute("points").replace(/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,function(e,i,n){let a=l(i),s=l(n);0===r?t.moveTo(a,s):t.lineTo(a,s),r++}),t.currentPath.autoClose=!0,t}(t);break;case"polyline":i=n(t,i),_=function(e){let t=new h5,r=0;return e.getAttribute("points").replace(/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,function(e,i,n){let a=l(i),s=l(n);0===r?t.moveTo(a,s):t.lineTo(a,s),r++}),t.currentPath.autoClose=!1,t}(t);break;case"circle":i=n(t,i),_=function(e){let t=l(e.getAttribute("cx")||0),r=l(e.getAttribute("cy")||0),i=l(e.getAttribute("r")||0),n=new lX;n.absarc(t,r,i,0,2*Math.PI);let a=new h5;return a.subPaths.push(n),a}(t);break;case"ellipse":i=n(t,i),_=function(e){let t=l(e.getAttribute("cx")||0),r=l(e.getAttribute("cy")||0),i=l(e.getAttribute("rx")||0),n=l(e.getAttribute("ry")||0),a=new lX;a.absellipse(t,r,i,n,0,2*Math.PI);let s=new h5;return s.subPaths.push(a),s}(t);break;case"line":i=n(t,i),_=function(e){let t=l(e.getAttribute("x1")||0),r=l(e.getAttribute("y1")||0),i=l(e.getAttribute("x2")||0),n=l(e.getAttribute("y2")||0),a=new h5;return a.moveTo(t,r),a.lineTo(i,n),a.currentPath.autoClose=!1,a}(t);break;case"defs":o=!0;break;case"use":i=n(t,i);let b=(t.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),S=t.viewportElement.getElementById(b);S?e(S,i):console.warn("SVGLoader: 'use node' references non-existent node id: "+b)}_&&(void 0!==i.fill&&"none"!==i.fill&&_.color.setStyle(i.fill,"srgb"),function(e,t){function r(e){E.set(e.x,e.y,1).applyMatrix3(t),e.set(E.x,E.y)}let i=e.subPaths;for(let e=0,n=i.length;e<n;e++){let n=i[e].curves;for(let e=0;e<n.length;e++){let i=n[e];i.isLineCurve?(r(i.v1),r(i.v2)):i.isCubicBezierCurve?(r(i.v0),r(i.v1),r(i.v2),r(i.v3)):i.isQuadraticBezierCurve?(r(i.v0),r(i.v1),r(i.v2)):i.isEllipseCurve&&(y.set(i.aX,i.aY),r(y),i.aX=y.x,i.aY=y.y,function(e){let t=e.elements,r=t[0]*t[3]+t[1]*t[4];return 0!==r&&Math.abs(r/(c(e)*h(e)))>Number.EPSILON}(t)?function(e){let r=e.xRadius,i=e.yRadius,n=Math.cos(e.aRotation),a=Math.sin(e.aRotation),s=new ni(r*n,r*a,0),o=new ni(-i*a,i*n,0),l=s.applyMatrix3(t),c=o.applyMatrix3(t),h=m.set(l.x,c.x,0,l.y,c.y,0,0,0,1),d=g.copy(h).invert(),f=A.copy(d).transpose().multiply(d).elements,p=function(e,t,r){let i,n,a,s,o;let l=e+r,u=e-r,c=Math.sqrt(u*u+4*t*t);return l>0?n=e*(o=1/(i=.5*(l+c)))*r-t*o*t:l<0?n=.5*(l-c):(i=.5*c,n=-.5*c),Math.abs(a=u>0?u+c:u-c)>2*Math.abs(t)?(s=1/Math.sqrt(1+(o=-2*t/a)*o),a=o*s):0===Math.abs(t)?(a=1,s=0):(a=1/Math.sqrt(1+(o=-.5*a/t)*o),s=o*a),u>0&&(o=a,a=-s,s=o),{rt1:i,rt2:n,cs:a,sn:s}}(f[0],f[1],f[4]),v=Math.sqrt(p.rt1),y=Math.sqrt(p.rt2);if(e.xRadius=1/v,e.yRadius=1/y,e.aRotation=Math.atan2(p.sn,p.cs),!((e.aEndAngle-e.aStartAngle)%(2*Math.PI)<Number.EPSILON)){let r=g.set(v,0,0,0,y,0,0,0,1),i=A.set(p.cs,p.sn,0,-p.sn,p.cs,0,0,0,1),n=r.multiply(i).multiply(h),a=e=>{let{x:t,y:r}=new ni(Math.cos(e),Math.sin(e),0).applyMatrix3(n);return Math.atan2(r,t)};e.aStartAngle=a(e.aStartAngle),e.aEndAngle=a(e.aEndAngle),u(t)&&(e.aClockwise=!e.aClockwise)}}(i):function(e){let r=c(t),i=h(t);e.xRadius*=r,e.yRadius*=i;let n=r>Number.EPSILON?Math.atan2(t.elements[1],t.elements[0]):Math.atan2(-t.elements[3],t.elements[4]);e.aRotation+=n,u(t)&&(e.aStartAngle*=-1,e.aEndAngle*=-1,e.aClockwise=!e.aClockwise)}(i))}}}(_,x),d.push(_),_.userData={node:t,style:i});let w=t.childNodes;for(let t=0;t<w.length;t++){let r=w[t];o&&"style"!==r.nodeName&&"defs"!==r.nodeName||e(r,i)}s&&(p.pop(),p.length>0?x.copy(p[p.length-1]):x.identity())}(_.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:d,xml:_.documentElement}}static createShapes(e){let t={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},r={loc:t.ORIGIN,t:0};function i(e,i,n){let a;let s=n.x-i.x,o=n.y-i.y,l=e.x-i.x,u=e.y-i.y,c=s*u-l*o;if(e.x===i.x&&e.y===i.y){r.loc=t.ORIGIN,r.t=0;return}if(e.x===n.x&&e.y===n.y){r.loc=t.DESTINATION,r.t=1;return}if(c<-Number.EPSILON){r.loc=t.LEFT;return}if(c>Number.EPSILON){r.loc=t.RIGHT;return}if(s*l<0||o*u<0){r.loc=t.BEHIND;return}if(Math.sqrt(s*s+o*o)<Math.sqrt(l*l+u*u)){r.loc=t.BEYOND;return}a=0!==s?l/s:u/o,r.loc=t.BETWEEN,r.t=a}let n=0x3b9ac9ff,a=-0x3b9ac9ff,s=e.subPaths.map(e=>{let t=e.getPoints(),r=-0x3b9ac9ff,i=0x3b9ac9ff,s=-0x3b9ac9ff,o=0x3b9ac9ff;for(let e=0;e<t.length;e++){let n=t[e];n.y>r&&(r=n.y),n.y<i&&(i=n.y),n.x>s&&(s=n.x),n.x<o&&(o=n.x)}return a<=s&&(a=s+1),n>=o&&(n=o-1),{curves:e.curves,points:t,isCW:ua.isClockWise(t),identifier:-1,boundingBox:new h_(new nt(o,i),new nt(s,r))}});s=s.filter(e=>e.points.length>1);for(let e=0;e<s.length;e++)s[e].identifier=e;let o=s.map(o=>(function(e,n,a,s,o){(null==o||""===o)&&(o="nonzero");let l=new nt;e.boundingBox.getCenter(l);let u=function(e,n,a){let s=new nt;n.getCenter(s);let o=[];return a.forEach(n=>{n.boundingBox.containsPoint(s)&&(function(e,n){let a=[],s=[];for(let o=1;o<e.length;o++){let l=e[o-1],u=e[o];for(let e=1;e<n.length;e++){let o=function(e,n,a,s){let o=e.x,l=n.x,u=a.x,c=s.x,h=e.y,d=n.y,f=a.y,p=s.y,m=(c-u)*(h-f)-(p-f)*(o-u),g=(p-f)*(l-o)-(c-u)*(d-h),A=m/g,v=((l-o)*(h-f)-(d-h)*(o-u))/g;if(0===g&&0!==m||A<=0||A>=1||v<0||v>1)return null;if(0===m&&0===g){for(let u=0;u<2;u++){if(i(0===u?a:s,e,n),r.loc==t.ORIGIN){let e=0===u?a:s;return{x:e.x,y:e.y,t:r.t}}if(r.loc==t.BETWEEN)return{x:+(o+r.t*(l-o)).toPrecision(10),y:+(h+r.t*(d-h)).toPrecision(10),t:r.t}}return null}for(let o=0;o<2;o++)if(i(0===o?a:s,e,n),r.loc==t.ORIGIN){let e=0===o?a:s;return{x:e.x,y:e.y,t:r.t}}return{x:+(o+A*(l-o)).toPrecision(10),y:+(h+A*(d-h)).toPrecision(10),t:A}}(l,u,n[e-1],n[e]);null!==o&&void 0===a.find(e=>e.t<=o.t+Number.EPSILON&&e.t>=o.t-Number.EPSILON)&&(a.push(o),s.push(new nt(o.x,o.y)))}}return s})(e,n.points).forEach(e=>{o.push({identifier:n.identifier,isCW:n.isCW,point:e})})}),o.sort((e,t)=>e.point.x-t.point.x),o}([new nt(a,l.y),new nt(s,l.y)],e.boundingBox,n);u.sort((e,t)=>e.point.x-t.point.x);let c=[],h=[];u.forEach(t=>{t.identifier===e.identifier?c.push(t):h.push(t)});let d=c[0].point.x,f=[],p=0;for(;p<h.length&&h[p].point.x<d;)f.length>0&&f[f.length-1]===h[p].identifier?f.pop():f.push(h[p].identifier),p++;if(f.push(e.identifier),"evenodd"===o){let t=f.length%2==0,r=f[f.length-2];return{identifier:e.identifier,isHole:t,for:r}}if("nonzero"===o){let t=!0,r=null,i=null;for(let e=0;e<f.length;e++){let a=f[e];t?(i=n[a].isCW,t=!1,r=a):i!==n[a].isCW&&(i=n[a].isCW,t=!0)}return{identifier:e.identifier,isHole:t,for:r}}console.warn('fill-rule: "'+o+'" is currently not implemented.')})(o,s,n,a,e.userData?e.userData.style.fillRule:void 0)),l=[];return s.forEach(e=>{if(!o[e.identifier].isHole){let t=new l$;t.curves=e.curves,o.filter(t=>t.isHole&&t.for===e.identifier).forEach(e=>{let r=s[e.identifier],i=new lX;i.curves=r.curves,t.holes.push(i)}),l.push(t)}}),l}static getStrokeStyle(e,t,r,i,n){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:i=void 0!==i?i:"butt",strokeMiterLimit:n=void 0!==n?n:4}}static pointsToStroke(t,r,i,n){let a=[],s=[],o=[];if(0===e.pointsToStrokeWithBuffers(t,r,i,n,a,s,o))return null;let l=new sl;return l.setAttribute("position",new se(a,3)),l.setAttribute("normal",new se(s,3)),l.setAttribute("uv",new se(o,2)),l}static pointsToStrokeWithBuffers(e,t,r,i,n,a,s,o){let l,u,c,h,d;let f=new nt,p=new nt,m=new nt,g=new nt,A=new nt,v=new nt,y=new nt,E=new nt,x=new nt,_=new nt,b=new nt,S=new nt,w=new nt,C=new nt,T=new nt,I=new nt,M=new nt;r=void 0!==r?r:12,i=void 0!==i?i:.001,o=void 0!==o?o:0;let R=(e=function(e){let t=!1;for(let r=1,n=e.length-1;r<n;r++)if(e[r].distanceTo(e[r+1])<i){t=!0;break}if(!t)return e;let r=[];r.push(e[0]);for(let t=1,n=e.length-1;t<n;t++)e[t].distanceTo(e[t+1])>=i&&r.push(e[t]);return r.push(e[e.length-1]),r}(e)).length;if(R<2)return 0;let B=e[0].equals(e[R-1]),D=e[0],P=t.strokeWidth/2,L=1/(R-1),k=0,F,O=!1,U=0,N=3*o,z=2*o;G(e[0],e[1],f).multiplyScalar(P),E.copy(e[0]).sub(f),x.copy(e[0]).add(f),_.copy(E),b.copy(x);for(let r=1;r<R;r++){if(l=e[r],u=r===R-1?B?e[1]:void 0:e[r+1],G(D,l,f),m.copy(f).multiplyScalar(P),S.copy(l).sub(m),w.copy(l).add(m),F=k+L,c=!1,void 0!==u){G(l,u,p),m.copy(p).multiplyScalar(P),C.copy(l).sub(m),T.copy(l).add(m),h=!0,m.subVectors(u,D),0>f.dot(m)&&(h=!1),1===r&&(O=h),m.subVectors(u,l),m.normalize();let e=Math.abs(f.dot(m));if(e>Number.EPSILON){let r=P/e;m.multiplyScalar(-r),g.subVectors(l,D),A.copy(g).setLength(r).add(m),I.copy(A).negate();let i=A.length(),n=g.length();g.divideScalar(n),v.subVectors(u,l);let a=v.length();switch(v.divideScalar(a),g.dot(I)<n&&v.dot(I)<a&&(c=!0),M.copy(A).add(l),I.add(l),d=!1,c?h?(T.copy(I),w.copy(I)):(C.copy(I),S.copy(I)):V(),t.strokeLineJoin){case"bevel":W(h,c,F);break;case"round":j(h,c),h?Q(l,S,C,F,0):Q(l,T,w,F,1);break;default:let s=P*t.strokeMiterLimit/i;s<1?"miter-clip"!==t.strokeLineJoin?W(h,c,F):(j(h,c),h?(v.subVectors(M,S).multiplyScalar(s).add(S),y.subVectors(M,C).multiplyScalar(s).add(C),H(S,F,0),H(v,F,0),H(l,F,.5),H(l,F,.5),H(v,F,0),H(y,F,0),H(l,F,.5),H(y,F,0),H(C,F,0)):(v.subVectors(M,w).multiplyScalar(s).add(w),y.subVectors(M,T).multiplyScalar(s).add(T),H(w,F,1),H(v,F,1),H(l,F,.5),H(l,F,.5),H(v,F,1),H(y,F,1),H(l,F,.5),H(y,F,1),H(T,F,1))):(c?(h?(H(x,k,1),H(E,k,0),H(M,F,0),H(x,k,1),H(M,F,0),H(I,F,1)):(H(x,k,1),H(E,k,0),H(M,F,1),H(E,k,0),H(I,F,0),H(M,F,1)),h?C.copy(M):T.copy(M)):h?(H(S,F,0),H(M,F,0),H(l,F,.5),H(l,F,.5),H(M,F,0),H(C,F,0)):(H(w,F,1),H(M,F,1),H(l,F,.5),H(l,F,.5),H(M,F,1),H(T,F,1)),d=!0)}}else V()}else V();B||r!==R-1||Y(e[0],_,b,h,!0,k),k=F,D=l,E.copy(C),x.copy(T)}if(B){if(c&&n){let e=M,t=I;O!==h&&(e=I,t=M),h?(d||O)&&(t.toArray(n,0),t.toArray(n,9),d&&e.toArray(n,3)):(d||!O)&&(t.toArray(n,3),t.toArray(n,9),d&&e.toArray(n,0))}}else Y(l,S,w,h,!1,F);return U;function G(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function H(e,t,r){n&&(n[N]=e.x,n[N+1]=e.y,n[N+2]=0,a&&(a[N]=0,a[N+1]=0,a[N+2]=1),N+=3,s&&(s[z]=t,s[z+1]=r,z+=2)),U+=3}function Q(e,t,i,n,a){f.copy(t).sub(e).normalize(),p.copy(i).sub(e).normalize();let s=Math.PI,o=f.dot(p);1>Math.abs(o)&&(s=Math.abs(Math.acos(o))),s/=r,m.copy(t);for(let t=0,i=r-1;t<i;t++)g.copy(m).rotateAround(e,s),H(m,n,a),H(g,n,a),H(e,n,.5),m.copy(g);H(g,n,a),H(i,n,a),H(e,n,.5)}function V(){H(x,k,1),H(E,k,0),H(S,F,0),H(x,k,1),H(S,F,0),H(w,F,1)}function W(e,t,r){t?e?(H(x,k,1),H(E,k,0),H(S,F,0),H(x,k,1),H(S,F,0),H(I,F,1),H(S,r,0),H(C,r,0),H(I,r,.5)):(H(x,k,1),H(E,k,0),H(w,F,1),H(E,k,0),H(I,F,0),H(w,F,1),H(w,r,1),H(I,r,0),H(T,r,1)):(e?(H(S,r,0),H(C,r,0)):(H(w,r,1),H(T,r,0)),H(l,r,.5))}function j(e,t){t&&(e?(H(x,k,1),H(E,k,0),H(S,F,0),H(x,k,1),H(S,F,0),H(I,F,1),H(S,k,0),H(l,F,.5),H(I,F,1),H(l,F,.5),H(C,k,0),H(I,F,1)):(H(x,k,1),H(E,k,0),H(w,F,1),H(E,k,0),H(I,F,0),H(w,F,1),H(w,k,1),H(I,F,0),H(l,F,.5),H(l,F,.5),H(I,F,0),H(T,k,1)))}function Y(e,r,i,a,o,l){switch(t.strokeLineCap){case"round":o?Q(e,i,r,l,.5):Q(e,r,i,l,.5);break;case"square":if(o)f.subVectors(r,e),p.set(f.y,-f.x),m.addVectors(f,p).add(e),g.subVectors(p,f).add(e),a?(m.toArray(n,3),g.toArray(n,0),g.toArray(n,9)):(m.toArray(n,3),1===s[7]?g.toArray(n,9):m.toArray(n,9),g.toArray(n,0));else{f.subVectors(i,e),p.set(f.y,-f.x),m.addVectors(f,p).add(e),g.subVectors(p,f).add(e);let t=n.length;a?(m.toArray(n,t-3),g.toArray(n,t-6)):(g.toArray(n,t-6),m.toArray(n,t-3)),g.toArray(n,t-12)}}}}}return e})(),bj=(0,eN.forwardRef)(function({src:e,skipFill:t,skipStrokes:r,fillMaterial:i,strokeMaterial:n,fillMeshProps:a,strokeMeshProps:s,...o},l){let u=d$(bW,e.startsWith("<svg")?`data:image/svg+xml;utf8,${e}`:e),c=(0,eN.useMemo)(()=>r?[]:u.paths.map(e=>{var t;return(null==(t=e.userData)?void 0:t.style.stroke)===void 0||"none"===e.userData.style.stroke?null:e.subPaths.map(t=>bW.pointsToStroke(t.getPoints(),e.userData.style))}),[u,r]);(0,eN.useEffect)(()=>()=>c.forEach(e=>e&&e.map(e=>e.dispose())),[c]);let h=0;return eN.createElement("object3D",eU({ref:l},o),eN.createElement("object3D",{scale:[1,-1,1]},u.paths.map((e,o)=>{var l,u;return eN.createElement(eN.Fragment,{key:o},!t&&(null==(l=e.userData)?void 0:l.style.fill)!==void 0&&"none"!==e.userData.style.fill&&bW.createShapes(e).map((t,r)=>eN.createElement("mesh",eU({key:r},a,{renderOrder:h++}),eN.createElement("shapeGeometry",{args:[t]}),eN.createElement("meshBasicMaterial",eU({color:e.userData.style.fill,opacity:e.userData.style.fillOpacity,transparent:!0,side:e1,depthWrite:!1},i)))),!r&&(null==(u=e.userData)?void 0:u.style.stroke)!==void 0&&"none"!==e.userData.style.stroke&&e.subPaths.map((t,r)=>eN.createElement("mesh",eU({key:r,geometry:c[o][r]},s,{renderOrder:h++}),eN.createElement("meshBasicMaterial",eU({color:e.userData.style.stroke,opacity:e.userData.style.strokeOpacity,transparent:!0,side:e1,depthWrite:!1},n)))))})))}),bY=new WeakMap;class bK extends u4{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){let n=new u8(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,e=>{let r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,r).then(t).catch(i)},r,i)}decodeDracoFile(e,t,r,i){let n={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let r;for(let e in t.attributeTypes){let r=t.attributeTypes[e];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[e]=r.name)}let i=JSON.stringify(t);if(bY.has(e)){let t=bY.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n=this.workerNextTaskID++,a=e.byteLength,s=this._getWorker(n,a).then(i=>(r=i,new Promise((i,a)=>{r._callbacks[n]={resolve:i,reject:a},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return s.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),bY.set(e,{key:i,promise:s}),s}_createGeometry(e){let t=new sl;e.index&&t.setIndex(new a1(e.index.array,1));for(let r=0;r<e.attributes.length;r++){let i=e.attributes[r],n=i.name,a=i.array,s=i.itemSize;t.setAttribute(n,new a1(a,s))}return t}_loadLibrary(e,t){let r=new u8(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((t,i)=>{r.load(e,t,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{let r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);let i=bq.toString(),n=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){let r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});let r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function bq(){let e,t;onmessage=function(r){let i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":let n=i.buffer,a=i.taskConfig;t.then(e=>{let t=e.draco,r=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(n),n.byteLength);try{let e=function(e,t,r,i){let n,a;let s=i.attributeIDs,o=i.attributeTypes,l=t.GetEncodedGeometryType(r);if(l===e.TRIANGULAR_MESH)n=new e.Mesh,a=t.DecodeBufferToMesh(r,n);else if(l===e.POINT_CLOUD)n=new e.PointCloud,a=t.DecodeBufferToPointCloud(r,n);else throw Error("THREE.DRACOLoader: Unexpected geometry type.");if(!a.ok()||0===n.ptr)throw Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());let u={index:null,attributes:[]};for(let r in s){let a,l;let c=self[o[r]];if(i.useUniqueIDs)l=s[r],a=t.GetAttributeByUniqueId(n,l);else{if(-1===(l=t.GetAttributeId(n,e[s[r]])))continue;a=t.GetAttribute(n,l)}u.attributes.push(function(e,t,r,i,n,a){let s=a.num_components(),o=r.num_points()*s,l=o*n.BYTES_PER_ELEMENT,u=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),c=e._malloc(l);t.GetAttributeDataArrayForAllPoints(r,a,u,l,c);let h=new n(e.HEAPF32.buffer,c,o).slice();return e._free(c),{name:i,array:h,itemSize:s}}(e,t,n,r,c,a))}return l===e.TRIANGULAR_MESH&&(u.index=function(e,t,r){let i=3*r.num_faces(),n=4*i,a=e._malloc(n);t.GetTrianglesUInt32Array(r,n,a);let s=new Uint32Array(e.HEAPF32.buffer,a,i).slice();return e._free(a),{array:s,itemSize:1}}(e,t,n)),e.destroy(n),u}(t,r,s,a),n=e.attributes.map(e=>e.array.buffer);e.index&&n.push(e.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:e},n)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(s),t.destroy(r)}})}}}let bX=()=>{let e;if(m)return m;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if("object"!=typeof WebAssembly)return{supported:!1};let i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";WebAssembly.validate(t)&&(i="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB");let n=WebAssembly.instantiate(function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;++r){let i=e.charCodeAt(r);t[r]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let i=0;for(let n=0;n<e.length;++n)t[i++]=t[n]<60?r[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,i)}(i),{}).then(t=>{(e=t.instance).exports.__wasm_call_ctors()});function a(t,r,i,n,a,s){let o=e.exports.sbrk,l=i+3&-4,u=o(l*n),c=o(a.length),h=new Uint8Array(e.exports.memory.buffer);h.set(a,c);let d=t(u,i,n,c,a.length);if(0===d&&s&&s(u,l,n),r.set(h.subarray(u,u+i*n)),o(u-o(0)),0!==d)throw Error(`Malformed buffer data: ${d}`)}let s={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},o={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return m={ready:n,supported:!0,decodeVertexBuffer(t,r,i,n,o){a(e.exports.meshopt_decodeVertexBuffer,t,r,i,n,e.exports[s[o]])},decodeIndexBuffer(t,r,i,n){a(e.exports.meshopt_decodeIndexBuffer,t,r,i,n)},decodeIndexSequence(t,r,i,n){a(e.exports.meshopt_decodeIndexSequence,t,r,i,n)},decodeGltfBuffer(t,r,i,n,l,u){a(e.exports[o[l]],t,r,i,n,e.exports[s[u]])}}};function b$(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let t="";for(let r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}let bJ="srgb",bZ="srgb-linear";class b0 extends u4{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new b6(e)}),this.register(function(e){return new b8(e)}),this.register(function(e){return new Ss(e)}),this.register(function(e){return new So(e)}),this.register(function(e){return new Sl(e)}),this.register(function(e){return new b7(e)}),this.register(function(e){return new Se(e)}),this.register(function(e){return new St(e)}),this.register(function(e){return new Sr(e)}),this.register(function(e){return new b5(e)}),this.register(function(e){return new Si(e)}),this.register(function(e){return new b9(e)}),this.register(function(e){return new Sa(e)}),this.register(function(e){return new Sn(e)}),this.register(function(e){return new b3(e)}),this.register(function(e){return new Su(e)}),this.register(function(e){return new Sc(e)})}load(e,t,r,i){let n;let a=this;if(""!==this.resourcePath)n=this.resourcePath;else if(""!==this.path){let t=cC.extractUrlBase(e);n=cC.resolveURL(t,this.path)}else n=cC.extractUrlBase(e);this.manager.itemStart(e);let s=function(t){i?i(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},o=new u8(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(r){try{a.parse(r,n,function(r){t(r),a.manager.itemEnd(e)},s)}catch(e){s(e)}},r,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let n;let a={},s={};if("string"==typeof e)n=JSON.parse(e);else if(e instanceof ArrayBuffer){if(b$(new Uint8Array(e.slice(0,4)))===Sh){try{a[b2.KHR_BINARY_GLTF]=new Sf(e)}catch(e){i&&i(e);return}n=JSON.parse(a[b2.KHR_BINARY_GLTF].content)}else n=JSON.parse(b$(new Uint8Array(e)))}else n=e;if(void 0===n.asset||n.asset.version[0]<2){i&&i(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let o=new SL(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});o.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](o);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),s[t.name]=t,a[t.name]=!0}if(n.extensionsUsed)for(let e=0;e<n.extensionsUsed.length;++e){let t=n.extensionsUsed[e],r=n.extensionsRequired||[];switch(t){case b2.KHR_MATERIALS_UNLIT:a[t]=new b4;break;case b2.KHR_DRACO_MESH_COMPRESSION:a[t]=new Sp(n,this.dracoLoader);break;case b2.KHR_TEXTURE_TRANSFORM:a[t]=new Sm;break;case b2.KHR_MESH_QUANTIZATION:a[t]=new Sg;break;default:r.indexOf(t)>=0&&void 0===s[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}o.setExtensions(a),o.setPlugins(s),o.parse(r,i)}parseAsync(e,t){let r=this;return new Promise(function(i,n){r.parse(e,t,i,n)})}}function b1(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}let b2={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class b3{constructor(e){this.parser=e,this.name=b2.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let r=0,i=t.length;r<i;r++){let i=t[r];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){let t;let r=this.parser,i="light:"+e,n=r.cache.get(i);if(n)return n;let a=r.json,s=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],o=new aQ(0xffffff);void 0!==s.color&&o.setRGB(s.color[0],s.color[1],s.color[2],bZ);let l=void 0!==s.range?s.range:0;switch(s.type){case"directional":(t=new cE(o)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new cA(o)).distance=l;break;case"spot":(t=new cd(o)).distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,t.angle=s.spot.outerConeAngle,t.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return t.position.set(0,0,0),t.decay=2,SR(t,s),void 0!==s.intensity&&(t.intensity=s.intensity),t.name=r.createUniqueName(s.name||"light_"+e),n=Promise.resolve(t),r.cache.add(i,n),n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){let t=this,r=this.parser,i=r.json.nodes[e],n=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then(function(e){return r._getNodeRef(t.cache,n,e)})}}class b4{constructor(){this.name=b2.KHR_MATERIALS_UNLIT}getMaterialType(){return aY}extendParams(e,t,r){let i=[];e.color=new aQ(1,1,1),e.opacity=1;let n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){let t=n.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],bZ),e.opacity=t[3]}void 0!==n.baseColorTexture&&i.push(r.assignTexture(e,"map",n.baseColorTexture,bJ))}return Promise.all(i)}}class b5{constructor(e){this.parser=e,this.name=b2.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class b6{constructor(e){this.parser=e,this.name=b2.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?uT:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&n.push(r.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&n.push(r.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(n.push(r.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){let e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new nt(e,e)}return Promise.all(n)}}class b8{constructor(e){this.parser=e,this.name=b2.KHR_MATERIALS_DISPERSION}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?uT:null}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name];return t.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}}class b9{constructor(e){this.parser=e,this.name=b2.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?uT:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&n.push(r.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&n.push(r.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(n)}}class b7{constructor(e){this.parser=e,this.name=b2.KHR_MATERIALS_SHEEN}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?uT:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[];t.sheenColor=new aQ(0,0,0),t.sheenRoughness=0,t.sheen=1;let a=i.extensions[this.name];if(void 0!==a.sheenColorFactor){let e=a.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],bZ)}return void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&n.push(r.assignTexture(t,"sheenColorMap",a.sheenColorTexture,bJ)),void 0!==a.sheenRoughnessTexture&&n.push(r.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(n)}}class Se{constructor(e){this.parser=e,this.name=b2.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?uT:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&n.push(r.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(n)}}class St{constructor(e){this.parser=e,this.name=b2.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?uT:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&n.push(r.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;let s=a.attenuationColor||[1,1,1];return t.attenuationColor=new aQ().setRGB(s[0],s[1],s[2],bZ),Promise.all(n)}}class Sr{constructor(e){this.parser=e,this.name=b2.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?uT:null}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class Si{constructor(e){this.parser=e,this.name=b2.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?uT:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&n.push(r.assignTexture(t,"specularIntensityMap",a.specularTexture));let s=a.specularColorFactor||[1,1,1];return t.specularColor=new aQ().setRGB(s[0],s[1],s[2],bZ),void 0!==a.specularColorTexture&&n.push(r.assignTexture(t,"specularColorMap",a.specularColorTexture,bJ)),Promise.all(n)}}class Sn{constructor(e){this.parser=e,this.name=b2.EXT_MATERIALS_BUMP}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?uT:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return t.bumpScale=void 0!==a.bumpFactor?a.bumpFactor:1,void 0!==a.bumpTexture&&n.push(r.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(n)}}class Sa{constructor(e){this.parser=e,this.name=b2.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?uT:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.anisotropyStrength&&(t.anisotropy=a.anisotropyStrength),void 0!==a.anisotropyRotation&&(t.anisotropyRotation=a.anisotropyRotation),void 0!==a.anisotropyTexture&&n.push(r.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(n)}}class Ss{constructor(e){this.parser=e,this.name=b2.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;let n=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(!(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return t.loadTextureImage(e,n.source,a)}}class So{constructor(e){this.parser=e,this.name=b2.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,r=this.parser,i=r.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;let a=n.extensions[t],s=i.images[a.source],o=r.textureLoader;if(s.uri){let e=r.options.manager.getHandler(s.uri);null!==e&&(o=e)}return this.detectSupport().then(function(n){if(n)return r.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Sl{constructor(e){this.parser=e,this.name=b2.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,r=this.parser,i=r.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;let a=n.extensions[t],s=i.images[a.source],o=r.textureLoader;if(s.uri){let e=r.options.manager.getHandler(s.uri);null!==e&&(o=e)}return this.detectSupport().then(function(n){if(n)return r.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Su{constructor(e){this.name=b2.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,r=t.bufferViews[e];if(!r.extensions||!r.extensions[this.name])return null;{let e=r.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return i.then(function(t){let r=e.byteOffset||0,i=e.byteLength||0,a=e.count,s=e.byteStride,o=new Uint8Array(t,r,i);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(a,s,o,e.mode,e.filter).then(function(e){return e.buffer}):n.ready.then(function(){let t=new ArrayBuffer(a*s);return n.decodeGltfBuffer(new Uint8Array(t),a,s,o,e.mode,e.filter),t})})}}}class Sc{constructor(e){this.name=b2.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;for(let e of t.meshes[r.mesh].primitives)if(e.mode!==SE.TRIANGLES&&e.mode!==SE.TRIANGLE_STRIP&&e.mode!==SE.TRIANGLE_FAN&&void 0!==e.mode)return null;let i=r.extensions[this.name].attributes,n=[],a={};for(let e in i)n.push(this.parser.getDependency("accessor",i[e]).then(t=>(a[e]=t,a[e])));return n.length<1?null:(n.push(this.parser.createNodeMesh(e)),Promise.all(n).then(e=>{let t=e.pop(),r=t.isGroup?t.children:[t],i=e[0].count,n=[];for(let e of r){let t=new n8,r=new ni,s=new nr,o=new ni(1,1,1),l=new o_(e.geometry,e.material,i);for(let e=0;e<i;e++)a.TRANSLATION&&r.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&s.fromBufferAttribute(a.ROTATION,e),a.SCALE&&o.fromBufferAttribute(a.SCALE,e),l.setMatrixAt(e,t.compose(r,s,o));for(let t in a)if("_COLOR_0"===t){let e=a[t];l.instanceColor=new op(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);aS.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),n.push(l)}return t.isGroup?(t.clear(),t.add(...n),t):n[0]}))}}let Sh="glTF",Sd={JSON:0x4e4f534a,BIN:5130562};class Sf{constructor(e){this.name=b2.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,12);if(this.header={magic:b$(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Sh)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let r=this.header.length-12,i=new DataView(e,12),n=0;for(;n<r;){let t=i.getUint32(n,!0);n+=4;let r=i.getUint32(n,!0);if(n+=4,r===Sd.JSON){let r=new Uint8Array(e,12+n,t);this.content=b$(r)}else if(r===Sd.BIN){let r=12+n;this.body=e.slice(r,r+t)}n+=t}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}}class Sp{constructor(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=b2.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let r=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,s={},o={},l={};for(let e in a)s[Sw[e]||e.toLowerCase()]=a[e];for(let t in e.attributes){let i=Sw[t]||t.toLowerCase();if(void 0!==a[t]){let n=r.accessors[e.attributes[t]],a=Sx[n.componentType];l[i]=a.name,o[i]=!0===n.normalized}}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t,r){i.decodeDracoFile(e,function(e){for(let t in e.attributes){let r=e.attributes[t],i=o[t];void 0!==i&&(r.normalized=i)}t(e)},s,l,bZ,r)})})}}class Sm{constructor(){this.name=b2.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Sg{constructor(){this.name=b2.KHR_MESH_QUANTIZATION}}class SA extends uH{constructor(e,t,r,i){super(e,t,r,i)}copySampleValue_(e){let t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let e=0;e!==i;e++)t[e]=r[n+e];return t}interpolate_(e,t,r,i){let n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=2*s,l=3*s,u=i-t,c=(r-t)/u,h=c*c,d=h*c,f=e*l,p=f-l,m=-2*d+3*h,g=d-h,A=1-m,v=g-h+c;for(let e=0;e!==s;e++){let t=a[p+e+s],r=a[p+e+o]*u,i=a[f+e+s],l=a[f+e]*u;n[e]=A*t+v*r+m*i+g*l}return n}}let Sv=new nr;class Sy extends SA{interpolate_(e,t,r,i){let n=super.interpolate_(e,t,r,i);return Sv.fromArray(n).normalize().toArray(n),n}}let SE={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Sx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},S_={9728:tK,9729:tZ,9984:tq,9985:t0,9986:t$,9987:t2},Sb={33071:tj,33648:tY,10497:tW},SS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Sw={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...EZ>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},SC={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ST={CUBICSPLINE:void 0,LINEAR:r0,STEP:rZ},SI={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function SM(e,t,r){for(let i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function SR(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function SB(e){let t="",r=Object.keys(e).sort();for(let i=0,n=r.length;i<n;i++)t+=r[i]+":"+e[r[i]]+";";return t}function SD(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}let SP=new n8;class SL{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new b1,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,i=!1,n=-1;"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=(i=navigator.userAgent.indexOf("Firefox")>-1)?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||r||i&&n<98?this.textureLoader=new cn(this.options.manager):this.textureLoader=new cL(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new u8(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let r=this,i=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(t){let a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:r,userData:{}};return SM(n,a,i),SR(a,i),Promise.all(r._invokeAll(function(e){return e.afterRoot&&e.afterRoot(a)})).then(function(){for(let e of a.scenes)e.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){let i=t[r].joints;for(let t=0,r=i.length;t<r;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){let i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(r[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;let i=r.clone(),n=(e,t)=>{let r=this.associations.get(e);for(let[i,a]of(null!=r&&this.associations.set(t,r),e.children.entries()))n(a,t.children[i])};return n(r,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){let i=e(t[r]);if(i)return i}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let r=[];for(let i=0;i<t.length;i++){let n=e(t[i]);n&&r.push(n)}return r}getDependency(e,t){let r=e+":"+t,i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(!(i=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)})))throw Error("Unknown type: "+e)}this.cache.add(r,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){let r=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(t,i){return r.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[b2.KHR_BINARY_GLTF].body);let i=this.options;return new Promise(function(e,n){r.load(cC.resolveURL(t.uri,i.path),e,void 0,function(){n(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){let r=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+r)})}loadAccessor(e){let t=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){let e=SS[i.type],t=Sx[i.componentType],r=!0===i.normalized;return Promise.resolve(new a1(new t(i.count*e),e,r))}let n=[];return void 0!==i.bufferView?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then(function(e){let n;let a=e[0],s=SS[i.type],o=Sx[i.componentType],l=o.BYTES_PER_ELEMENT,u=l*s,c=i.byteOffset||0,h=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;if(h&&h!==u){let e=Math.floor(c/h),r="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count,u=t.cache.get(r);u||(u=new sH(new o(a,e*h,i.count*h/l),h/l),t.cache.add(r,u)),n=new sV(u,s,c%h/l,d)}else n=new a1(null===a?new o(i.count*s):new o(a,c,i.count*s),s,d);if(void 0!==i.sparse){let t=SS.SCALAR,r=Sx[i.sparse.indices.componentType],l=i.sparse.indices.byteOffset||0,u=i.sparse.values.byteOffset||0,c=new r(e[1],l,i.sparse.count*t),h=new o(e[2],u,i.sparse.count*s);null!==a&&(n=new a1(n.array.slice(),n.itemSize,n.normalized));for(let e=0,t=c.length;e<t;e++){let t=c[e];if(n.setX(t,h[e*s]),s>=2&&n.setY(t,h[e*s+1]),s>=3&&n.setZ(t,h[e*s+2]),s>=4&&n.setW(t,h[e*s+3]),s>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return n})}loadTexture(e){let t=this.json,r=this.options,i=t.textures[e].source,n=t.images[i],a=this.textureLoader;if(n.uri){let e=r.manager.getHandler(n.uri);null!==e&&(a=e)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,r){let i=this,n=this.json,a=n.textures[e],s=n.images[t],o=(s.uri||s.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];let l=this.loadImageSource(t,r).then(function(t){t.flipY=!1,t.name=a.name||s.name||"",""===t.name&&"string"==typeof s.uri&&!1===s.uri.startsWith("data:image/")&&(t.name=s.uri);let r=(n.samplers||{})[a.sampler]||{};return t.magFilter=S_[r.magFilter]||tZ,t.minFilter=S_[r.minFilter]||t2,t.wrapS=Sb[r.wrapS]||tW,t.wrapT=Sb[r.wrapT]||tW,i.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[o]=l,l}loadImageSource(e,t){let r=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let n=r.images[e],a=self.URL||self.webkitURL,s=n.uri||"",o=!1;if(void 0!==n.bufferView)s=this.getDependency("bufferView",n.bufferView).then(function(e){o=!0;let t=new Blob([e],{type:n.mimeType});return s=a.createObjectURL(t)});else if(void 0===n.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let l=Promise.resolve(s).then(function(e){return new Promise(function(r,n){let a=r;!0===t.isImageBitmapLoader&&(a=function(e){let t=new nC(e);t.needsUpdate=!0,r(t)}),t.load(cC.resolveURL(e,i.path),a,void 0,n)})}).then(function(e){var t;return!0===o&&a.revokeObjectURL(s),SR(e,n),e.userData.mimeType=n.mimeType||((t=n.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",s),e});return this.sourceCache[e]=l,l}assignTexture(e,t,r,i){let n=this;return this.getDependency("texture",r.index).then(function(a){if(!a)return null;if(void 0!==r.texCoord&&r.texCoord>0&&((a=a.clone()).channel=r.texCoord),n.extensions[b2.KHR_TEXTURE_TRANSFORM]){let e=void 0!==r.extensions?r.extensions[b2.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=n.associations.get(a);a=n.extensions[b2.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),n.associations.set(a,t)}}return void 0!==i&&("number"==typeof i&&(i=3001===i?bJ:bZ),"colorSpace"in a?a.colorSpace=i:a.encoding=i===bJ?3001:3e3),e[t]=a,a})}assignFinalMaterial(e){let t=e.geometry,r=e.material,i=void 0===t.attributes.tangent,n=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new lr,aj.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){let e="LineBasicMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new oJ,aj.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,this.cache.add(e,t)),r=t}if(i||n||a){let e="ClonedMaterial:"+r.uuid+":";i&&(e+="derivative-tangents:"),n&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),n&&(t.vertexColors=!0),a&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}e.material=r}getMaterialType(){return uC}loadMaterial(e){let t;let r=this,i=this.json,n=this.extensions,a=i.materials[e],s={},o=a.extensions||{},l=[];if(o[b2.KHR_MATERIALS_UNLIT]){let e=n[b2.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),l.push(e.extendParams(s,a,r))}else{let i=a.pbrMetallicRoughness||{};if(s.color=new aQ(1,1,1),s.opacity=1,Array.isArray(i.baseColorFactor)){let e=i.baseColorFactor;s.color.setRGB(e[0],e[1],e[2],bZ),s.opacity=e[3]}void 0!==i.baseColorTexture&&l.push(r.assignTexture(s,"map",i.baseColorTexture,bJ)),s.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,s.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(l.push(r.assignTexture(s,"metalnessMap",i.metallicRoughnessTexture)),l.push(r.assignTexture(s,"roughnessMap",i.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)})))}!0===a.doubleSided&&(s.side=e1);let u=a.alphaMode||SI.OPAQUE;if(u===SI.BLEND?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,u===SI.MASK&&(s.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==aY&&(l.push(r.assignTexture(s,"normalMap",a.normalTexture)),s.normalScale=new nt(1,1),void 0!==a.normalTexture.scale)){let e=a.normalTexture.scale;s.normalScale.set(e,e)}if(void 0!==a.occlusionTexture&&t!==aY&&(l.push(r.assignTexture(s,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(s.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==aY){let e=a.emissiveFactor;s.emissive=new aQ().setRGB(e[0],e[1],e[2],bZ)}return void 0!==a.emissiveTexture&&t!==aY&&l.push(r.assignTexture(s,"emissiveMap",a.emissiveTexture,bJ)),Promise.all(l).then(function(){let i=new t(s);return a.name&&(i.name=a.name),SR(i,a),r.associations.set(i,{materials:e}),a.extensions&&SM(n,i,a),i})}createUniqueName(e){let t=ht.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,r=this.extensions,i=this.primitiveCache,n=[];for(let a=0,s=e.length;a<s;a++){let s=e[a],o=function(e){let t;let r=e.extensions&&e.extensions[b2.KHR_DRACO_MESH_COMPRESSION];if(t=r?"draco:"+r.bufferView+":"+r.indices+":"+SB(r.attributes):e.indices+":"+SB(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,i=e.targets.length;r<i;r++)t+=":"+SB(e.targets[r]);return t}(s),l=i[o];if(l)n.push(l.promise);else{let e;e=s.extensions&&s.extensions[b2.KHR_DRACO_MESH_COMPRESSION]?function(e){return r[b2.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(r){return Sk(r,e,t)})}(s):Sk(new sl,s,t),i[o]={primitive:s,promise:e},n.push(e)}}return Promise.all(n)}loadMesh(e){let t=this,r=this.json,i=this.extensions,n=r.meshes[e],a=n.primitives,s=[];for(let e=0,t=a.length;e<t;e++){var o;let t=void 0===a[e].material?(void 0===(o=this.cache).DefaultMaterial&&(o.DefaultMaterial=new uC({color:0xffffff,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:eZ})),o.DefaultMaterial):this.getDependency("material",a[e].material);s.push(t)}return s.push(t.loadGeometries(a)),Promise.all(s).then(function(r){let s=r.slice(0,r.length-1),o=r[r.length-1],l=[];for(let r=0,u=o.length;r<u;r++){let u;let c=o[r],h=a[r],d=s[r];if(h.mode===SE.TRIANGLES||h.mode===SE.TRIANGLE_STRIP||h.mode===SE.TRIANGLE_FAN||void 0===h.mode)!0===(u=!0===n.isSkinnedMesh?new ol(c,d):new sE(c,d)).isSkinnedMesh&&u.normalizeSkinWeights(),h.mode===SE.TRIANGLE_STRIP?u.geometry=__(u.geometry,r9):h.mode===SE.TRIANGLE_FAN&&(u.geometry=__(u.geometry,r7));else if(h.mode===SE.LINES)u=new le(c,d);else if(h.mode===SE.LINE_STRIP)u=new o6(c,d);else if(h.mode===SE.LINE_LOOP)u=new lt(c,d);else if(h.mode===SE.POINTS)u=new lo(c,d);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);Object.keys(u.geometry.morphAttributes).length>0&&function(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,i=t.weights.length;r<i;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){let r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,i=r.length;t<i;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(u,n),u.name=t.createUniqueName(n.name||"mesh_"+e),SR(u,n),h.extensions&&SM(i,u,h),t.assignFinalMaterial(u),l.push(u)}for(let r=0,i=l.length;r<i;r++)t.associations.set(l[r],{meshes:e,primitives:r});if(1===l.length)return n.extensions&&SM(i,l[0],n),l[0];let u=new sF;n.extensions&&SM(i,u,n),t.associations.set(u,{meshes:e});for(let e=0,t=l.length;e<t;e++)u.add(l[e]);return u})}loadCamera(e){let t;let r=this.json.cameras[e],i=r[r.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===r.type?t=new sD(ne.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new cv(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),SR(t,r),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],r=[];for(let e=0,i=t.joints.length;e<i;e++)r.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(e){let r=e.pop(),i=[],n=[];for(let a=0,s=e.length;a<s;a++){let s=e[a];if(s){i.push(s);let e=new n8;null!==r&&e.fromArray(r.array,16*a),n.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}return new of(i,n)})}loadAnimation(e){let t=this.json,r=this,i=t.animations[e],n=i.name?i.name:"animation_"+e,a=[],s=[],o=[],l=[],u=[];for(let e=0,t=i.channels.length;e<t;e++){let t=i.channels[e],r=i.samplers[t.sampler],n=t.target,c=n.node,h=void 0!==i.parameters?i.parameters[r.input]:r.input,d=void 0!==i.parameters?i.parameters[r.output]:r.output;void 0!==n.node&&(a.push(this.getDependency("node",c)),s.push(this.getDependency("accessor",h)),o.push(this.getDependency("accessor",d)),l.push(r),u.push(n))}return Promise.all([Promise.all(a),Promise.all(s),Promise.all(o),Promise.all(l),Promise.all(u)]).then(function(e){let t=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=[];for(let e=0,n=t.length;e<n;e++){let n=t[e],u=i[e],c=a[e],h=s[e],d=o[e];if(void 0===n)continue;n.updateMatrix&&n.updateMatrix();let f=r._createAnimationTracks(n,u,c,h,d);if(f)for(let e=0;e<f.length;e++)l.push(f[e])}return new u0(n,void 0,l)})}createNodeMesh(e){let t=this.json,r=this,i=t.nodes[e];return void 0===i.mesh?null:r.getDependency("mesh",i.mesh).then(function(e){let t=r._getNodeRef(r.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,r=i.weights.length;t<r;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){let t=this.json.nodes[e],r=this._loadNodeShallow(e),i=[],n=t.children||[];for(let e=0,t=n.length;e<t;e++)i.push(this.getDependency("node",n[e]));let a=void 0===t.skin?Promise.resolve(null):this.getDependency("skin",t.skin);return Promise.all([r,Promise.all(i),a]).then(function(e){let t=e[0],r=e[1],i=e[2];null!==i&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(i,SP)});for(let e=0,i=r.length;e<i;e++)t.add(r[e]);return t})}_loadNodeShallow(e){let t=this.json,r=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];let n=t.nodes[e],a=n.name?i.createUniqueName(n.name):"",s=[],o=i._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return o&&s.push(o),void 0!==n.camera&&s.push(i.getDependency("camera",n.camera).then(function(e){return i._getNodeRef(i.cameraCache,n.camera,e)})),i._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){s.push(e)}),this.nodeCache[e]=Promise.all(s).then(function(t){let s;if((s=!0===n.isBone?new ou:t.length>1?new sF:1===t.length?t[0]:new aS)!==t[0])for(let e=0,r=t.length;e<r;e++)s.add(t[e]);if(n.name&&(s.userData.name=n.name,s.name=a),SR(s,n),n.extensions&&SM(r,s,n),void 0!==n.matrix){let e=new n8;e.fromArray(n.matrix),s.applyMatrix4(e)}else void 0!==n.translation&&s.position.fromArray(n.translation),void 0!==n.rotation&&s.quaternion.fromArray(n.rotation),void 0!==n.scale&&s.scale.fromArray(n.scale);return i.associations.has(s)||i.associations.set(s,{}),i.associations.get(s).nodes=e,s}),this.nodeCache[e]}loadScene(e){let t=this.extensions,r=this.json.scenes[e],i=this,n=new sF;r.name&&(n.name=i.createUniqueName(r.name)),SR(n,r),r.extensions&&SM(t,n,r);let a=r.nodes||[],s=[];for(let e=0,t=a.length;e<t;e++)s.push(i.getDependency("node",a[e]));return Promise.all(s).then(function(e){for(let t=0,r=e.length;t<r;t++)n.add(e[t]);return i.associations=(e=>{let t=new Map;for(let[e,r]of i.associations)(e instanceof aj||e instanceof nC)&&t.set(e,r);return e.traverse(e=>{let r=i.associations.get(e);null!=r&&t.set(e,r)}),t})(n),n})}_createAnimationTracks(e,t,r,i,n){let a;let s=[],o=e.name?e.name:e.uuid,l=[];switch(SC[n.path]===SC.weights?e.traverse(function(e){e.morphTargetInfluences&&l.push(e.name?e.name:e.uuid)}):l.push(o),SC[n.path]){case SC.weights:a=uq;break;case SC.rotation:a=u$;break;case SC.position:case SC.scale:a=uZ;break;default:a=1===r.itemSize?uq:uZ}let u=void 0!==i.interpolation?ST[i.interpolation]:r0,c=this._getArrayFromAccessor(r);for(let e=0,r=l.length;e<r;e++){let r=new a(l[e]+"."+SC[n.path],t.array,c,u);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(r),s.push(r)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){let e=SD(t.constructor),r=new Float32Array(t.length);for(let i=0,n=t.length;i<n;i++)r[i]=t[i]*e;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof u$?Sy:SA)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Sk(e,t,r){let i=t.attributes,n=[];for(let t in i){let a=Sw[t]||t.toLowerCase();a in e.attributes||n.push(function(t,i){return r.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}(i[t],a))}if(void 0!==t.indices&&!e.index){let i=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});n.push(i)}return SR(e,t),function(e,t,r){let i=t.attributes,n=new nL;if(void 0===i.POSITION)return;{let e=r.json.accessors[i.POSITION],t=e.min,a=e.max;if(void 0!==t&&void 0!==a){if(n.set(new ni(t[0],t[1],t[2]),new ni(a[0],a[1],a[2])),e.normalized){let t=SD(Sx[e.componentType]);n.min.multiplyScalar(t),n.max.multiplyScalar(t)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let a=t.targets;if(void 0!==a){let e=new ni,t=new ni;for(let i=0,n=a.length;i<n;i++){let n=a[i];if(void 0!==n.POSITION){let i=r.json.accessors[n.POSITION],a=i.min,s=i.max;if(void 0!==a&&void 0!==s){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(s[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(s[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(s[2]))),i.normalized){let e=SD(Sx[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(e)}e.boundingBox=n;let s=new nJ;n.getCenter(s.center),s.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=s}(e,t,r),Promise.all(n).then(function(){return void 0!==t.targets?function(e,t,r){let i=!1,n=!1,a=!1;for(let e=0,r=t.length;e<r;e++){let r=t[e];if(void 0!==r.POSITION&&(i=!0),void 0!==r.NORMAL&&(n=!0),void 0!==r.COLOR_0&&(a=!0),i&&n&&a)break}if(!i&&!n&&!a)return Promise.resolve(e);let s=[],o=[],l=[];for(let u=0,c=t.length;u<c;u++){let c=t[u];if(i){let t=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION):e.attributes.position;s.push(t)}if(n){let t=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL):e.attributes.normal;o.push(t)}if(a){let t=void 0!==c.COLOR_0?r.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(l)]).then(function(t){let r=t[0],s=t[1],o=t[2];return i&&(e.morphAttributes.position=r),n&&(e.morphAttributes.normal=s),a&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e})}(e,t.targets,r):e})}let SF=null,SO="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function SU(e=!0,t=!0,r){return i=>{r&&r(i),e&&(SF||(SF=new bK),SF.setDecoderPath("string"==typeof e?e:SO),i.setDRACOLoader(SF)),t&&i.setMeshoptDecoder("function"==typeof bX?bX():bX)}}let SN=(e,t,r,i)=>d$(b0,e,SU(t,r,i));SN.preload=(e,t,r,i)=>d$.preload(b0,e,SU(t,r,i)),SN.clear=e=>d$.clear(b0,e),SN.setDecoderPath=e=>{SO=e};let Sz=eN.forwardRef(({src:e,useDraco:t,useMeshOpt:r,extendLoader:i,...n},a)=>{let{scene:s}=SN(e,t,r,i);return eN.createElement(bP,eU({ref:a},n,{object:s}))});class SG{constructor(e,t=" .:-=+*#%@",r={}){let i,n,a,s,o;let l=r.resolution||.15,u=r.scale||1,c=r.color||!1,h=r.alpha||!1,d=r.block||!1,f=r.invert||!1,p=r.strResolution||"low",m=document.createElement("div");m.style.cursor="default";let g=document.createElement("table");m.appendChild(g),this.setSize=function(t,r){i=t,n=r,e.setSize(t,r),function(){a=Math.floor(i*l),s=Math.floor(n*l),y.width=a,y.height=s,(o=e.domElement).style.backgroundColor&&(g.rows[0].cells[0].style.backgroundColor=o.style.backgroundColor,g.rows[0].cells[0].style.color=o.style.color),g.cellSpacing=0,g.cellPadding=0;let t=g.style;t.whiteSpace="pre",t.margin="0px",t.padding="0px",t.letterSpacing=S+"px",t.fontFamily=A,t.fontSize=_+"px",t.lineHeight=b+"px",t.textAlign="left",t.textDecoration="none"}()},this.render=function(t,r){e.render(t,r),function(e){E.clearRect(0,0,a,s),E.drawImage(v,0,0,a,s);let t=E.getImageData(0,0,a,s).data,r="";for(let e=0;e<s;e+=2){for(let i=0;i<a;i++){let n,s;let o=(e*a+i)*4,l=t[o],u=t[o+1],p=t[o+2],m=t[o+3];s=(.3*l+.59*u+.11*p)/255,0==m&&(s=1),n=Math.floor((1-s)*(x.length-1)),f&&(n=x.length-n-1);let g=x[n];(void 0===g||" "==g)&&(g="&nbsp;"),c?r+="<span style='color:rgb("+l+","+u+","+p+");"+(d?"background-color:rgb("+l+","+u+","+p+");":"")+(h?"opacity:"+m/255+";":"")+"'>"+g+"</span>":r+=g}r+="<br/>"}e.innerHTML=`<tr><td style="display:block;width:${i}px;height:${n}px;overflow:hidden">${r}</td></tr>`}(g)},this.domElement=m;let A="courier new, monospace",v=e.domElement,y=document.createElement("canvas");if(!y.getContext)return;let E=y.getContext("2d");if(!E.getImageData)return;let x=c?" CGO08@".split(""):" .,:;i1tfLCG08@".split("");t&&(x=t);let _=2/l*u,b=2/l*u,S=0;if("low"==p)switch(u){case 1:S=-1;break;case 2:case 3:S=-2.1;break;case 4:S=-3.1;break;case 5:S=-4.15}if("medium"==p)switch(u){case 1:S=0;break;case 2:S=-1;break;case 3:S=-1.04;break;case 4:case 5:S=-2.1}if("high"==p)switch(u){case 1:case 2:S=0;break;case 3:case 4:case 5:S=-1}}}function SH({renderIndex:e=1,bgColor:t="black",fgColor:r="white",characters:i=" .:-+*=%@#",invert:n=!0,color:a=!1,resolution:s=.15}){let{size:o,gl:l,scene:u,camera:c}=dY(),h=eN.useMemo(()=>{let e=new SG(l,i,{invert:n,color:a,resolution:s});return e.domElement.style.position="absolute",e.domElement.style.top="0px",e.domElement.style.left="0px",e.domElement.style.pointerEvents="none",e},[i,n,a,s]);return eN.useLayoutEffect(()=>{h.domElement.style.color=r,h.domElement.style.backgroundColor=t},[r,t]),eN.useEffect(()=>(l.domElement.style.opacity="0",l.domElement.parentNode.appendChild(h.domElement),()=>{l.domElement.style.opacity="1",l.domElement.parentNode.removeChild(h.domElement)}),[h]),eN.useEffect(()=>{h.setSize(o.width,o.height)},[h,o]),dK(e=>{h.render(u,c)},e),eN.createElement(eN.Fragment,null)}let SQ=be({alphaTest:0,viewport:new nt(1980,1080),focal:1e3,centerAndScaleTexture:null,covAndColorTexture:null},`
    precision highp sampler2D;
    precision highp usampler2D;
    out vec4 vColor;
    out vec3 vPosition;
    uniform vec2 resolution;
    uniform vec2 viewport;
    uniform float focal;
    attribute uint splatIndex;
    uniform sampler2D centerAndScaleTexture;
    uniform usampler2D covAndColorTexture;    

    vec2 unpackInt16(in uint value) {
      int v = int(value);
      int v0 = v >> 16;
      int v1 = (v & 0xFFFF);
      if((v & 0x8000) != 0)
        v1 |= 0xFFFF0000;
      return vec2(float(v1), float(v0));
    }

    void main () {
      ivec2 texSize = textureSize(centerAndScaleTexture, 0);
      ivec2 texPos = ivec2(splatIndex%uint(texSize.x), splatIndex/uint(texSize.x));
      vec4 centerAndScaleData = texelFetch(centerAndScaleTexture, texPos, 0);
      vec4 center = vec4(centerAndScaleData.xyz, 1);
      vec4 camspace = modelViewMatrix * center;
      vec4 pos2d = projectionMatrix * camspace;

      float bounds = 1.2 * pos2d.w;
      if (pos2d.z < -pos2d.w || pos2d.x < -bounds || pos2d.x > bounds
        || pos2d.y < -bounds || pos2d.y > bounds) {
        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);
        return;
      }

      uvec4 covAndColorData = texelFetch(covAndColorTexture, texPos, 0);
      vec2 cov3D_M11_M12 = unpackInt16(covAndColorData.x) * centerAndScaleData.w;
      vec2 cov3D_M13_M22 = unpackInt16(covAndColorData.y) * centerAndScaleData.w;
      vec2 cov3D_M23_M33 = unpackInt16(covAndColorData.z) * centerAndScaleData.w;
      mat3 Vrk = mat3(
        cov3D_M11_M12.x, cov3D_M11_M12.y, cov3D_M13_M22.x,
        cov3D_M11_M12.y, cov3D_M13_M22.y, cov3D_M23_M33.x,
        cov3D_M13_M22.x, cov3D_M23_M33.x, cov3D_M23_M33.y
      );

      mat3 J = mat3(
        focal / camspace.z, 0., -(focal * camspace.x) / (camspace.z * camspace.z),
        0., focal / camspace.z, -(focal * camspace.y) / (camspace.z * camspace.z),
        0., 0., 0.
      );

      mat3 W = transpose(mat3(modelViewMatrix));
      mat3 T = W * J;
      mat3 cov = transpose(T) * Vrk * T;
      vec2 vCenter = vec2(pos2d) / pos2d.w;
      float diagonal1 = cov[0][0] + 0.3;
      float offDiagonal = cov[0][1];
      float diagonal2 = cov[1][1] + 0.3;
      float mid = 0.5 * (diagonal1 + diagonal2);
      float radius = length(vec2((diagonal1 - diagonal2) / 2.0, offDiagonal));
      float lambda1 = mid + radius;
      float lambda2 = max(mid - radius, 0.1);
      vec2 diagonalVector = normalize(vec2(offDiagonal, lambda1 - diagonal1));
      vec2 v1 = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;
      vec2 v2 = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);
      uint colorUint = covAndColorData.w;
      vColor = vec4(
        float(colorUint & uint(0xFF)) / 255.0,
        float((colorUint >> uint(8)) & uint(0xFF)) / 255.0,
        float((colorUint >> uint(16)) & uint(0xFF)) / 255.0,
        float(colorUint >> uint(24)) / 255.0
      );
      vPosition = position;

      gl_Position = vec4(
        vCenter 
          + position.x * v2 / viewport * 2.0 
          + position.y * v1 / viewport * 2.0, pos2d.z / pos2d.w, 1.0);
    }
    `,`
    #include <alphatest_pars_fragment>
    #include <alphahash_pars_fragment>
    in vec4 vColor;
    in vec3 vPosition;
    void main () {
      float A = -dot(vPosition.xy, vPosition.xy);
      if (A < -4.0) discard;
      float B = exp(A) * vColor.a;
      vec4 diffuseColor = vec4(vColor.rgb, B);
      #include <alphatest_fragment>
      #include <alphahash_fragment>
      gl_FragColor = diffuseColor;
      #include <tonemapping_fragment>
      #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `);function SV(e){let t=null,r=0;e.onmessage=i=>{if("push"==i.data.method){0===r&&(t=new Float32Array(i.data.length));let e=new Float32Array(i.data.matrices);t.set(e,r),r+=e.length}else if("sort"==i.data.method&&null!==t){let r=function(e,r=!1){let i=t.length/16,n=-1/0,a=1/0,s=new Float32Array(i),o=new Int32Array(s.buffer),l=new Int32Array(i),u=0;for(let o=0;o<i;o++){let i=e[0]*t[16*o+12]+e[1]*t[16*o+13]+e[2]*t[16*o+14]+e[3];(r||i<0&&t[16*o+15]>-1e-4*i)&&(s[u]=i,l[u]=o,u++,i>n&&(n=i),i<a&&(a=i))}let c=65535/(n-a),h=new Uint32Array(65536);for(let e=0;e<u;e++)o[e]=(s[e]-a)*c|0,h[o[e]]++;let d=new Uint32Array(65536);for(let e=1;e<65536;e++)d[e]=d[e-1]+h[e-1];let f=new Uint32Array(u);for(let e=0;e<u;e++)f[d[o[e]]++]=l[e];return f}(new Float32Array(i.data.view),i.data.hashed);e.postMessage({indices:r,key:i.data.key},[r.buffer])}}}class SW extends u4{constructor(...e){super(...e),this.gl=null,this.chunkSize=25e3}load(e,t,r,i){let n={gl:this.gl,url:this.manager.resolveURL(e),worker:new Worker(URL.createObjectURL(new Blob(["(",SV.toString(),")(self)"],{type:"application/javascript"}))),manager:this.manager,update:(e,t,r)=>(function(e,t,r,i){if(e.updateMatrixWorld(),t.gl.getCurrentViewport(r.viewport),r.material.viewport.x=r.viewport.z,r.material.viewport.y=r.viewport.w,r.material.focal=r.viewport.w/2*Math.abs(e.projectionMatrix.elements[5]),r.ready){if(i&&r.sorted)return;r.ready=!1;let e=new Float32Array([r.modelViewMatrix.elements[2],-r.modelViewMatrix.elements[6],r.modelViewMatrix.elements[10],r.modelViewMatrix.elements[14]]);t.worker.postMessage({method:"sort",src:t.url,key:r.uuid,view:e.buffer,hashed:i},[e.buffer]),i&&t.loaded&&(r.sorted=!0)}})(t,n,e,r),connect:e=>(function(e,t){e.loading||SY(e),t.ready=!1,t.pm=new n8,t.vm1=new n8,t.vm2=new n8,t.viewport=new nT;let r=new op(new Uint32Array(e.bufferTextureWidth*e.bufferTextureHeight),1,!1);r.setUsage(iU);let i=t.geometry=new cT,n=new a1(new Float32Array(18),3);function a(e){if(t&&e.data.key===t.uuid){let r=new Uint32Array(e.data.indices);i.attributes.splatIndex.set(r),i.attributes.splatIndex.needsUpdate=!0,i.instanceCount=r.length,t.ready=!0}}return i.setAttribute("position",n),n.setXYZ(2,-2,2,0),n.setXYZ(1,2,2,0),n.setXYZ(0,-2,-2,0),n.setXYZ(5,-2,-2,0),n.setXYZ(4,2,2,0),n.setXYZ(3,2,-2,0),n.needsUpdate=!0,i.setAttribute("splatIndex",r),i.instanceCount=1,e.worker.addEventListener("message",a),async function(){for(;;){let t=e.gl.properties.get(e.centerAndScaleTexture),r=e.gl.properties.get(e.covAndColorTexture);if(null!=t&&t.__webglTexture&&null!=r&&r.__webglTexture&&e.loadedVertexCount>0)break;await new Promise(e=>setTimeout(e,10))}t.ready=!0}(),()=>e.worker.removeEventListener("message",a)})(n,e),loading:!1,loaded:!1,loadedVertexCount:0,chunkSize:this.chunkSize,totalDownloadBytes:0,numVertices:0,rowLength:32,maxVertexes:0,bufferTextureWidth:0,bufferTextureHeight:0,stream:null,centerAndScaleData:null,covAndColorData:null,covAndColorTexture:null,centerAndScaleTexture:null,onProgress:r};Sj(n).then(t).catch(e=>{null==i||i(e),n.manager.itemError(n.url)})}}async function Sj(e){e.manager.itemStart(e.url);let t=await fetch(e.url);if(null===t.body)throw"Failed to fetch file";let r=t.headers.get("Content-Length"),i=r?parseInt(r):void 0;if(void 0==i)throw"Failed to get content length";e.stream=t.body.getReader(),e.totalDownloadBytes=i,e.numVertices=Math.floor(e.totalDownloadBytes/e.rowLength);let n=e.gl.getContext(),a=n.getParameter(n.MAX_TEXTURE_SIZE);return e.maxVertexes=a*a,e.numVertices>e.maxVertexes&&(e.numVertices=e.maxVertexes),e.bufferTextureWidth=a,e.bufferTextureHeight=Math.floor((e.numVertices-1)/a)+1,e.centerAndScaleData=new Float32Array(e.bufferTextureWidth*e.bufferTextureHeight*4),e.covAndColorData=new Uint32Array(e.bufferTextureWidth*e.bufferTextureHeight*4),e.centerAndScaleTexture=new oc(e.centerAndScaleData,e.bufferTextureWidth,e.bufferTextureHeight,ru,re),e.centerAndScaleTexture.needsUpdate=!0,e.covAndColorTexture=new oc(e.covAndColorData,e.bufferTextureWidth,e.bufferTextureHeight,rA,t7),e.covAndColorTexture.internalFormat="RGBA32UI",e.covAndColorTexture.needsUpdate=!0,e}async function SY(e){e.loading=!0;let t=0,r=0,i=[],n=0,a=0!==e.totalDownloadBytes;for(;;)try{let{value:s,done:o}=await e.stream.read();if(o)break;if(t+=s.length,void 0!=e.totalDownloadBytes){let r=t/e.totalDownloadBytes*100;if(e.onProgress&&r-n>1){let i=new ProgressEvent("progress",{lengthComputable:a,loaded:t,total:e.totalDownloadBytes});e.onProgress(i),n=r}}i.push(s);let l=t-r;if(void 0!=e.totalDownloadBytes&&l>e.rowLength*e.chunkSize){let t=Math.floor(l/e.rowLength),n=new Uint8Array(l),s=0;for(let e of i)n.set(e,s),s+=e.length;if(i.length=0,l>t*e.rowLength){let r=new Uint8Array(l-t*e.rowLength);r.set(n.subarray(l-r.length,l),0),i.push(r)}let o=new Uint8Array(t*e.rowLength);o.set(n.subarray(0,o.byteLength),0);let u=SK(e,o.buffer,t);if(e.worker.postMessage({method:"push",src:e.url,length:16*e.numVertices,matrices:u.buffer},[u.buffer]),r+=t*e.rowLength,e.onProgress){let t=new ProgressEvent("progress",{lengthComputable:a,loaded:e.totalDownloadBytes,total:e.totalDownloadBytes});e.onProgress(t)}}}catch(e){console.error(e);break}if(t-r>0){let t=new Uint8Array(i.reduce((e,t)=>e+t.length,0)),r=0;for(let e of i)t.set(e,r),r+=e.length;let n=Math.floor(t.byteLength/e.rowLength),a=SK(e,t.buffer,n);e.worker.postMessage({method:"push",src:e.url,length:16*n,matrices:a.buffer},[a.buffer])}e.loaded=!0,e.manager.itemEnd(e.url)}function SK(e,t,r){let i=e.gl.getContext();if(e.loadedVertexCount+r>e.maxVertexes&&(r=e.maxVertexes-e.loadedVertexCount),r<=0)throw"Failed to parse file";let n=new Uint8Array(t),a=new Float32Array(t),s=new Float32Array(16*r),o=new Uint8Array(e.covAndColorData.buffer),l=new Int16Array(e.covAndColorData.buffer);for(let t=0;t<r;t++){let r=new nr(-(n[32*t+28+1]-128)/128,(n[32*t+28+2]-128)/128,(n[32*t+28+3]-128)/128,-(n[32*t+28+0]-128)/128);r.invert();let i=new ni(a[8*t+0],a[8*t+1],-a[8*t+2]),u=new ni(a[8*t+3+0],a[8*t+3+1],a[8*t+3+2]),c=new n8;c.makeRotationFromQuaternion(r),c.transpose(),c.scale(u);let h=c.clone();c.transpose(),c.premultiply(h),c.setPosition(i);let d=[0,1,2,5,6,10],f=0;for(let e=0;e<d.length;e++)Math.abs(c.elements[d[e]])>f&&(f=Math.abs(c.elements[d[e]]));let p=4*e.loadedVertexCount+4*t;e.centerAndScaleData[p+0]=i.x,e.centerAndScaleData[p+1]=-i.y,e.centerAndScaleData[p+2]=i.z,e.centerAndScaleData[p+3]=f/32767,p=8*e.loadedVertexCount+8*t;for(let e=0;e<d.length;e++)l[p+e]=32767*c.elements[d[e]]/f;p=16*e.loadedVertexCount+(4*t+3)*4;let m=new aQ(n[32*t+24+0]/255,n[32*t+24+1]/255,n[32*t+24+2]/255);m.convertSRGBToLinear(),o[p+0]=255*m.r,o[p+1]=255*m.g,o[p+2]=255*m.b,o[p+3]=n[32*t+24+3],c.elements[15]=Math.max(u.x,u.y,u.z)*n[32*t+24+3]/255;for(let e=0;e<16;e++)s[16*t+e]=c.elements[e]}for(;r>0;){let t=0,n=0,a=e.loadedVertexCount%e.bufferTextureWidth,s=Math.floor(e.loadedVertexCount/e.bufferTextureWidth);e.loadedVertexCount%e.bufferTextureWidth!=0?(t=Math.min(e.bufferTextureWidth,a+r)-a,n=1):Math.floor(r/e.bufferTextureWidth)>0?(t=e.bufferTextureWidth,n=Math.floor(r/e.bufferTextureWidth)):(t=r%e.bufferTextureWidth,n=1);let o=e.gl.properties.get(e.centerAndScaleTexture);i.bindTexture(i.TEXTURE_2D,o.__webglTexture),i.texSubImage2D(i.TEXTURE_2D,0,a,s,t,n,i.RGBA,i.FLOAT,e.centerAndScaleData,4*e.loadedVertexCount);let l=e.gl.properties.get(e.covAndColorTexture);i.bindTexture(i.TEXTURE_2D,l.__webglTexture),i.texSubImage2D(i.TEXTURE_2D,0,a,s,t,n,i.RGBA_INTEGER,i.UNSIGNED_INT,e.covAndColorData,4*e.loadedVertexCount),e.gl.resetState(),e.loadedVertexCount+=t*n,r-=t*n}return s}function Sq({src:e,toneMapped:t=!1,alphaTest:r=0,alphaHash:i=!1,chunkSize:n=25e3,...a}){dp({SplatMaterial:SQ});let s=eN.useRef(null),o=dY(e=>e.gl),l=dY(e=>e.camera),u=d$(SW,e,e=>{e.gl=o,e.chunkSize=n});return eN.useLayoutEffect(()=>u.connect(s.current),[e]),dK(()=>u.update(s.current,l,i)),eN.createElement("mesh",eU({ref:s,frustumCulled:!1},a),eN.createElement("splatMaterial",{key:`${e}/${r}/${i}${SQ.key}`,transparent:!i,depthTest:!0,alphaTest:i?0:r,centerAndScaleTexture:u.centerAndScaleTexture,covAndColorTexture:u.covAndColorTexture,depthWrite:!!i||r>0,blending:i?e3:e8,blendSrcAlpha:tn,alphaHash:!!i,toneMapped:t}))}function SX(e,t,r){let i=dY(e=>e.size),n=dY(e=>e.viewport),a="number"==typeof e?e:i.width*n.dpr,s="number"==typeof t?t:i.height*n.dpr,{samples:o=0,depth:l,...u}=("number"==typeof e?r:e)||{},c=eN.useMemo(()=>{let e=new nM(a,s,{minFilter:tZ,magFilter:tZ,type:rt,...u});return l&&(e.depthTexture=new lg(a,s,re)),e.samples=o,e},[]);return eN.useLayoutEffect(()=>{c.setSize(a,s),o&&(c.samples=o)},[o,c,a,s]),eN.useEffect(()=>()=>c.dispose(),[]),c}let S$=({children:e,width:t,height:r,...i})=>{let n=SX(t,r,i);return eN.createElement(eN.Fragment,null,null==e?void 0:e(n))},SJ=e=>"function"==typeof e,SZ=eN.forwardRef(({envMap:e,resolution:t=256,frames:r=1/0,children:i,makeDefault:n,...a},s)=>{let o=dY(({set:e})=>e),l=dY(({camera:e})=>e),u=dY(({size:e})=>e),c=eN.useRef(null);eN.useImperativeHandle(s,()=>c.current,[]);let h=eN.useRef(null),d=SX(t);eN.useLayoutEffect(()=>{a.manual||c.current.updateProjectionMatrix()},[u,a]),eN.useLayoutEffect(()=>{c.current.updateProjectionMatrix()}),eN.useLayoutEffect(()=>{if(n)return o(()=>({camera:c.current})),()=>o(()=>({camera:l}))},[c,n,o]);let f=0,p=null,m=SJ(i);return dK(t=>{m&&(r===1/0||f<r)&&(h.current.visible=!1,t.gl.setRenderTarget(d),p=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,c.current),t.scene.background=p,t.gl.setRenderTarget(null),h.current.visible=!0,f++)}),eN.createElement(eN.Fragment,null,eN.createElement("orthographicCamera",eU({left:-(u.width/2),right:u.width/2,top:u.height/2,bottom:-(u.height/2),ref:c},a),!m&&i),eN.createElement("group",{ref:h},m&&i(d.texture)))}),S0=e=>"function"==typeof e,S1=eN.forwardRef(({envMap:e,resolution:t=256,frames:r=1/0,makeDefault:i,children:n,...a},s)=>{let o=dY(({set:e})=>e),l=dY(({camera:e})=>e),u=dY(({size:e})=>e),c=eN.useRef(null);eN.useImperativeHandle(s,()=>c.current,[]);let h=eN.useRef(null),d=SX(t);eN.useLayoutEffect(()=>{a.manual||(c.current.aspect=u.width/u.height)},[u,a]),eN.useLayoutEffect(()=>{c.current.updateProjectionMatrix()});let f=0,p=null,m=S0(n);return dK(t=>{m&&(r===1/0||f<r)&&(h.current.visible=!1,t.gl.setRenderTarget(d),p=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,c.current),t.scene.background=p,t.gl.setRenderTarget(null),h.current.visible=!0,f++)}),eN.useLayoutEffect(()=>{if(i)return o(()=>({camera:c.current})),()=>o(()=>({camera:l}))},[c,i,o]),eN.createElement(eN.Fragment,null,eN.createElement("perspectiveCamera",eU({ref:c},a),!m&&n),eN.createElement("group",{ref:h},m&&n(d.texture)))});function S2({resolution:e=256,near:t=.1,far:r=1e3,envMap:i,fog:n}={}){let a,s;let o=dY(({gl:e})=>e),l=dY(({scene:e})=>e),u=(0,eN.useMemo)(()=>{let t=new sk(e);return t.texture.type=rt,t},[e]);(0,eN.useEffect)(()=>()=>{u.dispose()},[u]);let c=(0,eN.useMemo)(()=>new sP(t,r,u),[t,r,u]),h=eN.useCallback(()=>{a=l.fog,s=l.background,l.background=i||s,l.fog=n||a,c.update(o,l),l.fog=a,l.background=s},[o,l,c]);return{fbo:u,camera:c,update:h}}function S3({children:e,frames:t=1/0,resolution:r,near:i,far:n,envMap:a,fog:s,...o}){let l=eN.useRef(null),{fbo:u,camera:c,update:h}=S2({resolution:r,near:i,far:n,envMap:a,fog:s}),d=0;return dK(()=>{l.current&&(t===1/0||d<t)&&(l.current.visible=!1,h(),l.current.visible=!0,d++)}),eN.createElement("group",o,eN.createElement("primitive",{object:c}),eN.createElement("group",{ref:l},null==e?void 0:e(u.texture)))}var S4=Object.defineProperty,S5=(e,t,r)=>t in e?S4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,S6=(e,t,r)=>(S5(e,"symbol"!=typeof t?t+"":t,r),r);class S8{constructor(){S6(this,"_listeners")}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let r=this._listeners[e];if(void 0!==r){let e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e);e.target=null}}}var S9=Object.defineProperty,S7=(e,t,r)=>t in e?S9(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,we=(e,t,r)=>(S7(e,"symbol"!=typeof t?t+"":t,r),r);class wt extends S8{constructor(e){super(),we(this,"object"),we(this,"changeEvent",{type:"change"}),we(this,"EPS",1e-6),we(this,"enabled",!0),we(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),we(this,"screenOrientation",0),we(this,"alphaOffset",0),we(this,"onDeviceOrientationChangeEvent",e=>{this.deviceOrientation=e}),we(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),we(this,"zee",new ni(0,0,1)),we(this,"euler",new ao),we(this,"q0",new nr),we(this,"q1",new nr(-Math.sqrt(.5),0,0,Math.sqrt(.5))),we(this,"setObjectQuaternion",(e,t,r,i,n)=>{this.euler.set(r,t,-i,"YXZ"),e.setFromEuler(this.euler),e.multiply(this.q1),e.multiply(this.q0.setFromAxisAngle(this.zee,-n))}),we(this,"connect",()=>{this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(e=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),we(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),we(this,"lastQuaternion",new nr),we(this,"update",()=>{if(!1===this.enabled)return;let e=this.deviceOrientation;if(e){let t=e.alpha?ne.degToRad(e.alpha)+this.alphaOffset:0,r=e.beta?ne.degToRad(e.beta):0,i=e.gamma?ne.degToRad(e.gamma):0,n=this.screenOrientation?ne.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,t,r,i,n),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),we(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}}let wr=eN.forwardRef((e,t)=>{let{camera:r,onChange:i,makeDefault:n,...a}=e,s=dY(e=>e.camera),o=dY(e=>e.invalidate),l=dY(e=>e.get),u=dY(e=>e.set),c=r||s,h=eN.useMemo(()=>new wt(c),[c]);return eN.useEffect(()=>{let e=e=>{o(),i&&i(e)};return null==h||null==h.addEventListener||h.addEventListener("change",e),()=>null==h||null==h.removeEventListener?void 0:h.removeEventListener("change",e)},[i,h,o]),dK(()=>null==h?void 0:h.update(),-1),eN.useEffect(()=>(null==h||h.connect(),()=>null==h?void 0:h.dispose()),[h]),eN.useEffect(()=>{if(n){let e=l().controls;return u({controls:h}),()=>u({controls:e})}},[n,h]),h?eN.createElement("primitive",eU({ref:t,object:h},a)):null});var wi=Object.defineProperty,wn=(e,t,r)=>t in e?wi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wa=(e,t,r)=>(wn(e,"symbol"!=typeof t?t+"":t,r),r);function ws(e){e.preventDefault()}class wo extends S8{constructor(e,t){super(),wa(this,"object"),wa(this,"domElement",null),wa(this,"movementSpeed",1),wa(this,"rollSpeed",.005),wa(this,"dragToLook",!1),wa(this,"autoForward",!1),wa(this,"changeEvent",{type:"change"}),wa(this,"EPS",1e-6),wa(this,"tmpQuaternion",new nr),wa(this,"mouseStatus",0),wa(this,"movementSpeedMultiplier",1),wa(this,"moveState",{up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0}),wa(this,"moveVector",new ni(0,0,0)),wa(this,"rotationVector",new ni(0,0,0)),wa(this,"keydown",e=>{if(!e.altKey){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}}),wa(this,"keyup",e=>{switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()}),wa(this,"pointerdown",e=>{if(this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}}),wa(this,"pointermove",e=>{if(!this.dragToLook||this.mouseStatus>0){let t=this.getContainerDimensions(),r=t.size[0]/2,i=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-r)/r,this.moveState.pitchDown=(e.pageY-t.offset[1]-i)/i,this.updateRotationVector()}}),wa(this,"pointerup",e=>{if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()}),wa(this,"lastQuaternion",new nr),wa(this,"lastPosition",new ni),wa(this,"update",e=>{let t=e*this.movementSpeed,r=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*r,this.rotationVector.y*r,this.rotationVector.z*r,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS)&&(this.dispatchEvent(this.changeEvent),this.lastQuaternion.copy(this.object.quaternion),this.lastPosition.copy(this.object.position))}),wa(this,"updateMovementVector",()=>{let e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back}),wa(this,"updateRotationVector",()=>{this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft}),wa(this,"getContainerDimensions",()=>this.domElement==document||this.domElement instanceof Document?{size:[window.innerWidth,window.innerHeight],offset:[0,0]}:{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}),wa(this,"connect",e=>{this.domElement=e,e instanceof Document||e.setAttribute("tabindex",-1),this.domElement.addEventListener("contextmenu",ws),this.domElement.addEventListener("pointermove",this.pointermove),this.domElement.addEventListener("pointerdown",this.pointerdown),this.domElement.addEventListener("pointerup",this.pointerup),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}),wa(this,"dispose",()=>{this.domElement.removeEventListener("contextmenu",ws),this.domElement.removeEventListener("pointermove",this.pointermove),this.domElement.removeEventListener("pointerdown",this.pointerdown),this.domElement.removeEventListener("pointerup",this.pointerup),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup)}),this.object=e,void 0!==t&&this.connect(t),this.updateMovementVector(),this.updateRotationVector()}}let wl=eN.forwardRef(({domElement:e,...t},r)=>{let{onChange:i,makeDefault:n,...a}=t,s=dY(e=>e.invalidate),o=dY(e=>e.camera),l=dY(e=>e.gl),u=dY(e=>e.events),c=dY(e=>e.get),h=dY(e=>e.set),d=e||u.connected||l.domElement,f=eN.useMemo(()=>new wo(o),[o]);return eN.useEffect(()=>(f.connect(d),()=>void f.dispose()),[d,f,s]),eN.useEffect(()=>{let e=e=>{s(),i&&i(e)};return null==f.addEventListener||f.addEventListener("change",e),()=>null==f.removeEventListener?void 0:f.removeEventListener("change",e)},[i,s]),eN.useEffect(()=>{if(n){let e=c().controls;return h({controls:f}),()=>h({controls:e})}},[n,f]),dK((e,t)=>f.update(t)),eN.createElement("primitive",eU({ref:r,object:f,args:[o,d]},a))});var wu=Object.defineProperty,wc=(e,t,r)=>t in e?wu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wh=(e,t,r)=>(wc(e,"symbol"!=typeof t?t+"":t,r),r);let wd=new n6,wf=new oC,wp=Math.cos(Math.PI/180*70),wm=(e,t)=>(e%t+t)%t;class wg extends S8{constructor(e,t){super(),wh(this,"object"),wh(this,"domElement"),wh(this,"enabled",!0),wh(this,"target",new ni),wh(this,"minDistance",0),wh(this,"maxDistance",1/0),wh(this,"minZoom",0),wh(this,"maxZoom",1/0),wh(this,"minPolarAngle",0),wh(this,"maxPolarAngle",Math.PI),wh(this,"minAzimuthAngle",-1/0),wh(this,"maxAzimuthAngle",1/0),wh(this,"enableDamping",!1),wh(this,"dampingFactor",.05),wh(this,"enableZoom",!0),wh(this,"zoomSpeed",1),wh(this,"enableRotate",!0),wh(this,"rotateSpeed",1),wh(this,"enablePan",!0),wh(this,"panSpeed",1),wh(this,"screenSpacePanning",!0),wh(this,"keyPanSpeed",7),wh(this,"zoomToCursor",!1),wh(this,"autoRotate",!1),wh(this,"autoRotateSpeed",2),wh(this,"reverseOrbit",!1),wh(this,"reverseHorizontalOrbit",!1),wh(this,"reverseVerticalOrbit",!1),wh(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),wh(this,"mouseButtons",{LEFT:eQ.ROTATE,MIDDLE:eQ.DOLLY,RIGHT:eQ.PAN}),wh(this,"touches",{ONE:eV.ROTATE,TWO:eV.DOLLY_PAN}),wh(this,"target0"),wh(this,"position0"),wh(this,"zoom0"),wh(this,"_domElementKeyEvents",null),wh(this,"getPolarAngle"),wh(this,"getAzimuthalAngle"),wh(this,"setPolarAngle"),wh(this,"setAzimuthalAngle"),wh(this,"getDistance"),wh(this,"getZoomScale"),wh(this,"listenToKeyEvents"),wh(this,"stopListenToKeyEvents"),wh(this,"saveState"),wh(this,"reset"),wh(this,"update"),wh(this,"connect"),wh(this,"dispose"),wh(this,"dollyIn"),wh(this,"dollyOut"),wh(this,"getScale"),wh(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=e=>{let t=wm(e,2*Math.PI),i=u.phi;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let n=Math.abs(t-i);2*Math.PI-n<n&&(t<i?t+=2*Math.PI:i+=2*Math.PI),c.phi=t-i,r.update()},this.setAzimuthalAngle=e=>{let t=wm(e,2*Math.PI),i=u.theta;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let n=Math.abs(t-i);2*Math.PI-n<n&&(t<i?t+=2*Math.PI:i+=2*Math.PI),c.theta=t-i,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",K),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",K),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(i),r.update(),o=s.NONE},this.update=(()=>{let t=new ni,n=new ni(0,1,0),a=new nr().setFromUnitVectors(e.up,n),f=a.clone().invert(),p=new ni,m=new nr,g=2*Math.PI;return function(){let A=r.object.position;a.setFromUnitVectors(e.up,n),f.copy(a).invert(),t.copy(A).sub(r.target),t.applyQuaternion(a),u.setFromVector3(t),r.autoRotate&&o===s.NONE&&I(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(u.theta+=c.theta*r.dampingFactor,u.phi+=c.phi*r.dampingFactor):(u.theta+=c.theta,u.phi+=c.phi);let v=r.minAzimuthAngle,y=r.maxAzimuthAngle;isFinite(v)&&isFinite(y)&&(v<-Math.PI?v+=g:v>Math.PI&&(v-=g),y<-Math.PI?y+=g:y>Math.PI&&(y-=g),v<=y?u.theta=Math.max(v,Math.min(y,u.theta)):u.theta=u.theta>(v+y)/2?Math.max(v,u.theta):Math.min(y,u.theta)),u.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,u.phi)),u.makeSafe(),!0===r.enableDamping?r.target.addScaledVector(d,r.dampingFactor):r.target.add(d),r.zoomToCursor&&S||r.object.isOrthographicCamera?u.radius=k(u.radius):u.radius=k(u.radius*h),t.setFromSpherical(u),t.applyQuaternion(f),A.copy(r.target).add(t),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),!0===r.enableDamping?(c.theta*=1-r.dampingFactor,c.phi*=1-r.dampingFactor,d.multiplyScalar(1-r.dampingFactor)):(c.set(0,0,0),d.set(0,0,0));let E=!1;if(r.zoomToCursor&&S){let i=null;if(r.object instanceof sD&&r.object.isPerspectiveCamera){let e=t.length();i=k(e*h);let n=e-i;r.object.position.addScaledVector(_,n),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){let e=new ni(b.x,b.y,0);e.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/h)),r.object.updateProjectionMatrix(),E=!0;let n=new ni(b.x,b.y,0);n.unproject(r.object),r.object.position.sub(n).add(e),r.object.updateMatrixWorld(),i=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;null!==i&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(i).add(r.object.position):(wd.origin.copy(r.object.position),wd.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(wd.direction))<wp?e.lookAt(r.target):(wf.setFromNormalAndCoplanarPoint(r.object.up,r.target),wd.intersectPlane(wf,r.target))))}else r.object instanceof cv&&r.object.isOrthographicCamera&&(E=1!==h)&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/h)),r.object.updateProjectionMatrix());return h=1,S=!1,!!(E||p.distanceToSquared(r.object.position)>l||8*(1-m.dot(r.object.quaternion))>l)&&(r.dispatchEvent(i),p.copy(r.object.position),m.copy(r.object.quaternion),E=!1,!0)}})(),this.connect=e=>{r.domElement=e,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",q),r.domElement.addEventListener("pointerdown",V),r.domElement.addEventListener("pointercancel",j),r.domElement.addEventListener("wheel",Y)},this.dispose=()=>{var e,t,i,n,a,s;r.domElement&&(r.domElement.style.touchAction="auto"),null==(e=r.domElement)||e.removeEventListener("contextmenu",q),null==(t=r.domElement)||t.removeEventListener("pointerdown",V),null==(i=r.domElement)||i.removeEventListener("pointercancel",j),null==(n=r.domElement)||n.removeEventListener("wheel",Y),null==(a=r.domElement)||a.ownerDocument.removeEventListener("pointermove",W),null==(s=r.domElement)||s.ownerDocument.removeEventListener("pointerup",j),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",K)};let r=this,i={type:"change"},n={type:"start"},a={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},o=s.NONE,l=1e-6,u=new hv,c=new hv,h=1,d=new ni,f=new nt,p=new nt,m=new nt,g=new nt,A=new nt,v=new nt,y=new nt,E=new nt,x=new nt,_=new ni,b=new nt,S=!1,w=[],C={};function T(){return Math.pow(.95,r.zoomSpeed)}function I(e){r.reverseOrbit||r.reverseHorizontalOrbit?c.theta+=e:c.theta-=e}function M(e){r.reverseOrbit||r.reverseVerticalOrbit?c.phi+=e:c.phi-=e}let R=(()=>{let e=new ni;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),d.add(e)}})(),B=(()=>{let e=new ni;return function(t,i){!0===r.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),d.add(e)}})(),D=(()=>{let e=new ni;return function(t,i){let n=r.domElement;if(n&&r.object instanceof sD&&r.object.isPerspectiveCamera){let a=r.object.position;e.copy(a).sub(r.target);let s=e.length();R(2*t*(s*=Math.tan(r.object.fov/2*Math.PI/180))/n.clientHeight,r.object.matrix),B(2*i*s/n.clientHeight,r.object.matrix)}else n&&r.object instanceof cv&&r.object.isOrthographicCamera?(R(t*(r.object.right-r.object.left)/r.object.zoom/n.clientWidth,r.object.matrix),B(i*(r.object.top-r.object.bottom)/r.object.zoom/n.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function P(e){r.object instanceof sD&&r.object.isPerspectiveCamera||r.object instanceof cv&&r.object.isOrthographicCamera?h=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function L(e){if(!r.zoomToCursor||!r.domElement)return;S=!0;let t=r.domElement.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top,a=t.width,s=t.height;b.x=i/a*2-1,b.y=-(n/s*2)+1,_.set(b.x,b.y,1).unproject(r.object).sub(r.object.position).normalize()}function k(e){return Math.max(r.minDistance,Math.min(r.maxDistance,e))}function F(e){f.set(e.clientX,e.clientY)}function O(e){g.set(e.clientX,e.clientY)}function U(){if(1==w.length)f.set(w[0].pageX,w[0].pageY);else{let e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);f.set(e,t)}}function N(){if(1==w.length)g.set(w[0].pageX,w[0].pageY);else{let e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);g.set(e,t)}}function z(){let e=w[0].pageX-w[1].pageX,t=w[0].pageY-w[1].pageY,r=Math.sqrt(e*e+t*t);y.set(0,r)}function G(e){if(1==w.length)p.set(e.pageX,e.pageY);else{let t=$(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);p.set(r,i)}m.subVectors(p,f).multiplyScalar(r.rotateSpeed);let t=r.domElement;t&&(I(2*Math.PI*m.x/t.clientHeight),M(2*Math.PI*m.y/t.clientHeight)),f.copy(p)}function H(e){if(1==w.length)A.set(e.pageX,e.pageY);else{let t=$(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);A.set(r,i)}v.subVectors(A,g).multiplyScalar(r.panSpeed),D(v.x,v.y),g.copy(A)}function Q(e){var t;let i=$(e),n=e.pageX-i.x,a=e.pageY-i.y,s=Math.sqrt(n*n+a*a);E.set(0,s),x.set(0,Math.pow(E.y/y.y,r.zoomSpeed)),t=x.y,P(h/t),y.copy(E)}function V(e){var t,i;!1!==r.enabled&&(0===w.length&&(null==(t=r.domElement)||t.ownerDocument.addEventListener("pointermove",W),null==(i=r.domElement)||i.ownerDocument.addEventListener("pointerup",j)),w.push(e),"touch"===e.pointerType?function(e){switch(X(e),w.length){case 1:switch(r.touches.ONE){case eV.ROTATE:if(!1===r.enableRotate)return;U(),o=s.TOUCH_ROTATE;break;case eV.PAN:if(!1===r.enablePan)return;N(),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(r.touches.TWO){case eV.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&z(),r.enablePan&&N(),o=s.TOUCH_DOLLY_PAN;break;case eV.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&z(),r.enableRotate&&U(),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&r.dispatchEvent(n)}(e):function(e){let t;switch(e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case eQ.DOLLY:if(!1===r.enableZoom)return;L(e),y.set(e.clientX,e.clientY),o=s.DOLLY;break;case eQ.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;O(e),o=s.PAN}else{if(!1===r.enableRotate)return;F(e),o=s.ROTATE}break;case eQ.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;F(e),o=s.ROTATE}else{if(!1===r.enablePan)return;O(e),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&r.dispatchEvent(n)}(e))}function W(e){!1!==r.enabled&&("touch"===e.pointerType?function(e){switch(X(e),o){case s.TOUCH_ROTATE:if(!1===r.enableRotate)return;G(e),r.update();break;case s.TOUCH_PAN:if(!1===r.enablePan)return;H(e),r.update();break;case s.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&Q(e),r.enablePan&&H(e),r.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&Q(e),r.enableRotate&&G(e),r.update();break;default:o=s.NONE}}(e):function(e){if(!1!==r.enabled)switch(o){case s.ROTATE:if(!1===r.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),m.subVectors(p,f).multiplyScalar(r.rotateSpeed);let t=r.domElement;t&&(I(2*Math.PI*m.x/t.clientHeight),M(2*Math.PI*m.y/t.clientHeight)),f.copy(p),r.update()}(e);break;case s.DOLLY:var t,i;if(!1===r.enableZoom)return;(E.set(e.clientX,e.clientY),x.subVectors(E,y),x.y>0)?(t=T(),P(h/t)):x.y<0&&(i=T(),P(h*i)),y.copy(E),r.update();break;case s.PAN:if(!1===r.enablePan)return;A.set(e.clientX,e.clientY),v.subVectors(A,g).multiplyScalar(r.panSpeed),D(v.x,v.y),g.copy(A),r.update()}}(e))}function j(e){var t,i,n;(function(e){delete C[e.pointerId];for(let t=0;t<w.length;t++)if(w[t].pointerId==e.pointerId){w.splice(t,1);return}})(e),0===w.length&&(null==(t=r.domElement)||t.releasePointerCapture(e.pointerId),null==(i=r.domElement)||i.ownerDocument.removeEventListener("pointermove",W),null==(n=r.domElement)||n.ownerDocument.removeEventListener("pointerup",j)),r.dispatchEvent(a),o=s.NONE}function Y(e){if(!1!==r.enabled&&!1!==r.enableZoom&&(o===s.NONE||o===s.ROTATE)){var t,i;e.preventDefault(),r.dispatchEvent(n),(L(e),e.deltaY<0)?(t=T(),P(h*t)):e.deltaY>0&&(i=T(),P(h/i)),r.update(),r.dispatchEvent(a)}}function K(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:D(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:D(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:D(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:D(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function q(e){!1!==r.enabled&&e.preventDefault()}function X(e){let t=C[e.pointerId];void 0===t&&(t=new nt,C[e.pointerId]=t),t.set(e.pageX,e.pageY)}function $(e){return C[(e.pointerId===w[0].pointerId?w[1]:w[0]).pointerId]}this.dollyIn=(e=T())=>{P(h*e),r.update()},this.dollyOut=(e=T())=>{P(h/e),r.update()},this.getScale=()=>h,this.setScale=e=>{P(e),r.update()},this.getZoomScale=()=>T(),void 0!==t&&this.connect(t),this.update()}}class wA extends wg{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=eQ.PAN,this.mouseButtons.RIGHT=eQ.ROTATE,this.touches.ONE=eV.PAN,this.touches.TWO=eV.DOLLY_ROTATE}}let wv=eN.forwardRef((e={enableDamping:!0},t)=>{let{domElement:r,camera:i,makeDefault:n,onChange:a,onStart:s,onEnd:o,...l}=e,u=dY(e=>e.invalidate),c=dY(e=>e.camera),h=dY(e=>e.gl),d=dY(e=>e.events),f=dY(e=>e.set),p=dY(e=>e.get),m=r||d.connected||h.domElement,g=i||c,A=eN.useMemo(()=>new wA(g),[g]);return eN.useEffect(()=>{A.connect(m);let e=e=>{u(),a&&a(e)};return A.addEventListener("change",e),s&&A.addEventListener("start",s),o&&A.addEventListener("end",o),()=>{A.dispose(),A.removeEventListener("change",e),s&&A.removeEventListener("start",s),o&&A.removeEventListener("end",o)}},[a,s,o,A,u,m]),eN.useEffect(()=>{if(n){let e=p().controls;return f({controls:A}),()=>f({controls:e})}},[n,A]),dK(()=>A.update(),-1),eN.createElement("primitive",eU({ref:t,object:A,enableDamping:!0},l))}),wy=eN.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:n=!0,keyEvents:a=!1,onChange:s,onStart:o,onEnd:l,...u},c)=>{let h=dY(e=>e.invalidate),d=dY(e=>e.camera),f=dY(e=>e.gl),p=dY(e=>e.events),m=dY(e=>e.setEvents),g=dY(e=>e.set),A=dY(e=>e.get),v=dY(e=>e.performance),y=t||d,E=i||p.connected||f.domElement,x=eN.useMemo(()=>new wg(y),[y]);return dK(()=>{x.enabled&&x.update()},-1),eN.useEffect(()=>(a&&x.connect(!0===a?E:a),x.connect(E),()=>void x.dispose()),[a,E,r,x,h]),eN.useEffect(()=>{let e=e=>{h(),r&&v.regress(),s&&s(e)},t=e=>{o&&o(e)},i=e=>{l&&l(e)};return x.addEventListener("change",e),x.addEventListener("start",t),x.addEventListener("end",i),()=>{x.removeEventListener("start",t),x.removeEventListener("end",i),x.removeEventListener("change",e)}},[s,o,l,x,h,m]),eN.useEffect(()=>{if(e){let e=A().controls;return g({controls:x}),()=>g({controls:e})}},[e,x]),eN.createElement("primitive",eU({ref:c,object:x,enableDamping:n},u))});var wE=Object.defineProperty,wx=(e,t,r)=>t in e?wE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,w_=(e,t,r)=>(wx(e,"symbol"!=typeof t?t+"":t,r),r);class wb extends S8{constructor(e,t){super(),w_(this,"enabled",!0),w_(this,"screen",{left:0,top:0,width:0,height:0}),w_(this,"rotateSpeed",1),w_(this,"zoomSpeed",1.2),w_(this,"panSpeed",.3),w_(this,"noRotate",!1),w_(this,"noZoom",!1),w_(this,"noPan",!1),w_(this,"staticMoving",!1),w_(this,"dynamicDampingFactor",.2),w_(this,"minDistance",0),w_(this,"maxDistance",1/0),w_(this,"keys",["KeyA","KeyS","KeyD"]),w_(this,"mouseButtons",{LEFT:eQ.ROTATE,MIDDLE:eQ.DOLLY,RIGHT:eQ.PAN}),w_(this,"object"),w_(this,"domElement"),w_(this,"cursorZoom",!1),w_(this,"target",new ni),w_(this,"mousePosition",new nt),w_(this,"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),w_(this,"EPS",1e-6),w_(this,"lastZoom",1),w_(this,"lastPosition",new ni),w_(this,"cursorVector",new ni),w_(this,"targetVector",new ni),w_(this,"_state",this.STATE.NONE),w_(this,"_keyState",this.STATE.NONE),w_(this,"_eye",new ni),w_(this,"_movePrev",new nt),w_(this,"_moveCurr",new nt),w_(this,"_lastAxis",new ni),w_(this,"_lastAngle",0),w_(this,"_zoomStart",new nt),w_(this,"_zoomEnd",new nt),w_(this,"_touchZoomDistanceStart",0),w_(this,"_touchZoomDistanceEnd",0),w_(this,"_panStart",new nt),w_(this,"_panEnd",new nt),w_(this,"target0"),w_(this,"position0"),w_(this,"up0"),w_(this,"zoom0"),w_(this,"changeEvent",{type:"change"}),w_(this,"startEvent",{type:"start"}),w_(this,"endEvent",{type:"end"}),w_(this,"onScreenVector",new nt),w_(this,"getMouseOnScreen",(e,t)=>(this.onScreenVector.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),this.onScreenVector)),w_(this,"onCircleVector",new nt),w_(this,"getMouseOnCircle",(e,t)=>(this.onCircleVector.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-t))/this.screen.width),this.onCircleVector)),w_(this,"axis",new ni),w_(this,"quaternion",new nr),w_(this,"eyeDirection",new ni),w_(this,"objectUpDirection",new ni),w_(this,"objectSidewaysDirection",new ni),w_(this,"moveDirection",new ni),w_(this,"angle",0),w_(this,"rotateCamera",()=>{this.moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),this.angle=this.moveDirection.length(),this.angle?(this._eye.copy(this.object.position).sub(this.target),this.eyeDirection.copy(this._eye).normalize(),this.objectUpDirection.copy(this.object.up).normalize(),this.objectSidewaysDirection.crossVectors(this.objectUpDirection,this.eyeDirection).normalize(),this.objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),this.objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),this.moveDirection.copy(this.objectUpDirection.add(this.objectSidewaysDirection)),this.axis.crossVectors(this.moveDirection,this._eye).normalize(),this.angle*=this.rotateSpeed,this.quaternion.setFromAxisAngle(this.axis,this.angle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion),this._lastAxis.copy(this.axis),this._lastAngle=this.angle):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),this.quaternion.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion)),this._movePrev.copy(this._moveCurr)}),w_(this,"zoomCamera",()=>{let e;if(this._state===this.STATE.TOUCH_ZOOM_PAN)e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom/=e,this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(Math.abs((e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed)-1)>this.EPS&&e>0&&(this.object.isPerspectiveCamera?(e>1&&this._eye.length()>=this.maxDistance-this.EPS&&(e=1),this._eye.multiplyScalar(e)):this.object.isOrthographicCamera?(e>1&&this.object.zoom<this.maxDistance*this.maxDistance&&(e=1),this.object.zoom/=e):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor,this.cursorZoom){this.targetVector.copy(this.target).project(this.object);let t=this.cursorVector.set(this.mousePosition.x,this.mousePosition.y,this.targetVector.z).unproject(this.object);this.target.lerpVectors(t,this.target,e)}this.object.isOrthographicCamera&&this.object.updateProjectionMatrix()}}),w_(this,"mouseChange",new nt),w_(this,"objectUp",new ni),w_(this,"pan",new ni),w_(this,"panCamera",()=>{if(this.domElement&&(this.mouseChange.copy(this._panEnd).sub(this._panStart),this.mouseChange.lengthSq()>this.EPS)){if(this.object.isOrthographicCamera){let e=this.object,t=(e.right-e.left)/this.object.zoom,r=(e.top-e.bottom)/this.object.zoom;this.mouseChange.x*=t,this.mouseChange.y*=r}else this.mouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this.pan.copy(this._eye).cross(this.object.up).setLength(this.mouseChange.x),this.pan.add(this.objectUp.copy(this.object.up).setLength(this.mouseChange.y)),this.object.position.add(this.pan),this.target.add(this.pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(this.mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}),w_(this,"checkDistances",()=>{this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}),w_(this,"handleResize",()=>{if(!this.domElement)return;let e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}),w_(this,"update",()=>{this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||this.lastZoom!==this.object.zoom)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")}),w_(this,"reset",()=>{this._state=this.STATE.NONE,this._keyState=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom}),w_(this,"keydown",e=>{!1!==this.enabled&&(window.removeEventListener("keydown",this.keydown),this._keyState===this.STATE.NONE&&(e.code!==this.keys[this.STATE.ROTATE]||this.noRotate?e.code!==this.keys[this.STATE.ZOOM]||this.noZoom?e.code!==this.keys[this.STATE.PAN]||this.noPan||(this._keyState=this.STATE.PAN):this._keyState=this.STATE.ZOOM:this._keyState=this.STATE.ROTATE))}),w_(this,"onPointerDown",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseDown(e)}}),w_(this,"onPointerMove",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseMove(e)}}),w_(this,"onPointerUp",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseUp()}}),w_(this,"keyup",()=>{!1!==this.enabled&&(this._keyState=this.STATE.NONE,window.addEventListener("keydown",this.keydown))}),w_(this,"onMouseDown",e=>{if(!this.domElement)return;if(this._state===this.STATE.NONE)switch(e.button){case this.mouseButtons.LEFT:this._state=this.STATE.ROTATE;break;case this.mouseButtons.MIDDLE:this._state=this.STATE.ZOOM;break;case this.mouseButtons.RIGHT:this._state=this.STATE.PAN}let t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||(this._panStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.startEvent)}),w_(this,"onMouseMove",e=>{if(!1===this.enabled)return;let t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||this._panEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):this._zoomEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)))}),w_(this,"onMouseUp",()=>{this.domElement&&!1!==this.enabled&&(this._state=this.STATE.NONE,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.endEvent))}),w_(this,"mousewheel",e=>{if(!1!==this.enabled&&!0!==this.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=.025*e.deltaY;break;case 1:this._zoomStart.y-=.01*e.deltaY;break;default:this._zoomStart.y-=25e-5*e.deltaY}this.mousePosition.x=e.offsetX/this.screen.width*2-1,this.mousePosition.y=-(2*(e.offsetY/this.screen.height))+1,this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}}),w_(this,"touchstart",e=>{if(!1!==this.enabled){if(e.preventDefault(),1===e.touches.length)this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr);else{this._state=this.STATE.TOUCH_ZOOM_PAN;let t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+r*r);let i=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(i,n)),this._panEnd.copy(this._panStart)}this.dispatchEvent(this.startEvent)}}),w_(this,"touchmove",e=>{if(!1!==this.enabled){if(e.preventDefault(),1===e.touches.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));else{let t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(t*t+r*r);let i=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(i,n))}}}),w_(this,"touchend",e=>{if(!1!==this.enabled){switch(e.touches.length){case 0:this._state=this.STATE.NONE;break;case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr)}this.dispatchEvent(this.endEvent)}}),w_(this,"contextmenu",e=>{!1!==this.enabled&&e.preventDefault()}),w_(this,"connect",e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.mousewheel),this.domElement.addEventListener("touchstart",this.touchstart),this.domElement.addEventListener("touchend",this.touchend),this.domElement.addEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.handleResize()}),w_(this,"dispose",()=>{this.domElement&&(this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.mousewheel),this.domElement.removeEventListener("touchstart",this.touchstart),this.domElement.removeEventListener("touchend",this.touchend),this.domElement.removeEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup))}),this.object=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,void 0!==t&&this.connect(t),this.update()}}let wS=eN.forwardRef(({makeDefault:e,camera:t,domElement:r,regress:i,onChange:n,onStart:a,onEnd:s,...o},l)=>{let{invalidate:u,camera:c,gl:h,events:d,set:f,get:p,performance:m,viewport:g}=dY(),A=t||c,v=r||d.connected||h.domElement,y=eN.useMemo(()=>new wb(A),[A]);return dK(()=>{y.enabled&&y.update()},-1),eN.useEffect(()=>(y.connect(v),()=>void y.dispose()),[v,i,y,u]),eN.useEffect(()=>{let e=e=>{u(),i&&m.regress(),n&&n(e)};return y.addEventListener("change",e),a&&y.addEventListener("start",a),s&&y.addEventListener("end",s),()=>{a&&y.removeEventListener("start",a),s&&y.removeEventListener("end",s),y.removeEventListener("change",e)}},[n,a,s,y,u]),eN.useEffect(()=>{y.handleResize()},[g]),eN.useEffect(()=>{if(e){let e=p().controls;return f({controls:y}),()=>f({controls:e})}},[e,y]),eN.createElement("primitive",eU({ref:l,object:y},o))});var ww=Object.defineProperty,wC=(e,t,r)=>t in e?ww(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wT=(e,t,r)=>(wC(e,"symbol"!=typeof t?t+"":t,r),r);let wI={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},wM={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},wR={x:0,y:0},wB={camera:new n8,gizmos:new n8},wD={type:"change"},wP={type:"start"},wL={type:"end"};class wk extends S8{constructor(e,t=null,r=null){super(),wT(this,"camera"),wT(this,"domElement"),wT(this,"scene"),wT(this,"mouseActions"),wT(this,"_mouseOp"),wT(this,"_v2_1"),wT(this,"_v3_1"),wT(this,"_v3_2"),wT(this,"_m4_1"),wT(this,"_m4_2"),wT(this,"_quat"),wT(this,"_translationMatrix"),wT(this,"_rotationMatrix"),wT(this,"_scaleMatrix"),wT(this,"_rotationAxis"),wT(this,"_cameraMatrixState"),wT(this,"_cameraProjectionState"),wT(this,"_fovState"),wT(this,"_upState"),wT(this,"_zoomState"),wT(this,"_nearPos"),wT(this,"_farPos"),wT(this,"_gizmoMatrixState"),wT(this,"_up0"),wT(this,"_zoom0"),wT(this,"_fov0"),wT(this,"_initialNear"),wT(this,"_nearPos0"),wT(this,"_initialFar"),wT(this,"_farPos0"),wT(this,"_cameraMatrixState0"),wT(this,"_gizmoMatrixState0"),wT(this,"_button"),wT(this,"_touchStart"),wT(this,"_touchCurrent"),wT(this,"_input"),wT(this,"_switchSensibility"),wT(this,"_startFingerDistance"),wT(this,"_currentFingerDistance"),wT(this,"_startFingerRotation"),wT(this,"_currentFingerRotation"),wT(this,"_devPxRatio"),wT(this,"_downValid"),wT(this,"_nclicks"),wT(this,"_downEvents"),wT(this,"_clickStart"),wT(this,"_maxDownTime"),wT(this,"_maxInterval"),wT(this,"_posThreshold"),wT(this,"_movementThreshold"),wT(this,"_currentCursorPosition"),wT(this,"_startCursorPosition"),wT(this,"_grid"),wT(this,"_gridPosition"),wT(this,"_gizmos"),wT(this,"_curvePts"),wT(this,"_timeStart"),wT(this,"_animationId"),wT(this,"focusAnimationTime"),wT(this,"_timePrev"),wT(this,"_timeCurrent"),wT(this,"_anglePrev"),wT(this,"_angleCurrent"),wT(this,"_cursorPosPrev"),wT(this,"_cursorPosCurr"),wT(this,"_wPrev"),wT(this,"_wCurr"),wT(this,"adjustNearFar"),wT(this,"scaleFactor"),wT(this,"dampingFactor"),wT(this,"wMax"),wT(this,"enableAnimations"),wT(this,"enableGrid"),wT(this,"cursorZoom"),wT(this,"minFov"),wT(this,"maxFov"),wT(this,"enabled"),wT(this,"enablePan"),wT(this,"enableRotate"),wT(this,"enableZoom"),wT(this,"minDistance"),wT(this,"maxDistance"),wT(this,"minZoom"),wT(this,"maxZoom"),wT(this,"target"),wT(this,"_currentTarget"),wT(this,"_tbRadius"),wT(this,"_state"),wT(this,"onWindowResize",()=>{let e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;if(this.camera){let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e)}let t=this._tbRadius/e,r=new lR(0,0,t,t).getPoints(this._curvePts),i=new sl().setFromPoints(r);for(let e in this._gizmos.children)this._gizmos.children[e].geometry=i;this.dispatchEvent(wD)}),wT(this,"onContextMenu",e=>{if(this.enabled){for(let t=0;t<this.mouseActions.length;t++)if(2==this.mouseActions[t].mouse){e.preventDefault();break}}}),wT(this,"onPointerCancel",()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=wM.NONE}),wT(this,"onPointerDown",e=>{if(0==e.button&&e.isPrimary?(this._downValid=!0,this._downEvents.push(e)):this._downValid=!1,"touch"==e.pointerType&&this._input!=wM.CURSOR)switch(this._touchStart.push(e),this._touchCurrent.push(e),this._input){case wM.NONE:this._input=wM.ONE_FINGER,this.onSinglePanStart(e,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case wM.ONE_FINGER:case wM.ONE_FINGER_SWITCHED:this._input=wM.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case wM.TWO_FINGER:this._input=wM.MULT_FINGER,this.onTriplePanStart()}else if("touch"!=e.pointerType&&this._input==wM.NONE){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT"),this._mouseOp=this.getOpFromAction(e.button,t),this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=wM.CURSOR,this._button=e.button,this.onSinglePanStart(e,this._mouseOp))}}),wT(this,"onPointerMove",e=>{if("touch"==e.pointerType&&this._input!=wM.CURSOR)switch(this._input){case wM.ONE_FINGER:this.updateTouchEvent(e),this.onSinglePanMove(e,wI.ROTATE);break;case wM.ONE_FINGER_SWITCHED:this.calculatePointersDistance(this._touchCurrent[0],e)*this._devPxRatio>=this._switchSensibility&&(this._input=wM.ONE_FINGER,this.updateTouchEvent(e),this.onSinglePanStart(e,"ROTATE"));break;case wM.TWO_FINGER:this.updateTouchEvent(e),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case wM.MULT_FINGER:this.updateTouchEvent(e),this.onTriplePanMove()}else if("touch"!=e.pointerType&&this._input==wM.CURSOR){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT");let r=this.getOpStateFromAction(this._button,t);r&&this.onSinglePanMove(e,r)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],e)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}),wT(this,"onPointerUp",e=>{if("touch"==e.pointerType&&this._input!=wM.CURSOR){let t=this._touchCurrent.length;for(let r=0;r<t;r++)if(this._touchCurrent[r].pointerId==e.pointerId){this._touchCurrent.splice(r,1),this._touchStart.splice(r,1);break}switch(this._input){case wM.ONE_FINGER:case wM.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=wM.NONE,this.onSinglePanEnd();break;case wM.TWO_FINGER:this.onDoublePanEnd(),this.onPinchEnd(),this.onRotateEnd(),this._input=wM.ONE_FINGER_SWITCHED;break;case wM.MULT_FINGER:0==this._touchCurrent.length&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=wM.NONE,this.onTriplePanEnd())}}else"touch"!=e.pointerType&&this._input==wM.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=wM.NONE,this.onSinglePanEnd(),this._button=-1);if(e.isPrimary){if(this._downValid){if(e.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime){if(0==this._nclicks)this._nclicks=1,this._clickStart=performance.now();else{let t=e.timeStamp-this._clickStart,r=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;t<=this._maxInterval&&r<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(e)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}}),wT(this,"onWheel",e=>{var t,r;if(this.enabled&&this.enableZoom&&this.domElement){let i=null;e.ctrlKey||e.metaKey?i="CTRL":e.shiftKey&&(i="SHIFT");let n=this.getOpFromAction("WHEEL",i);if(n){e.preventDefault(),this.dispatchEvent(wP);let i=e.deltaY/125,a=1;switch(i>0?a=1/this.scaleFactor:i<0&&(a=this.scaleFactor),n){case"ZOOM":if(this.updateTbState(wI.SCALE,!0),i>0?a=1/Math.pow(this.scaleFactor,i):i<0&&(a=Math.pow(this.scaleFactor,-i)),this.cursorZoom&&this.enablePan){let i;this.camera instanceof cv&&(i=null==(t=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))?void 0:t.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position)),this.camera instanceof sD&&(i=null==(r=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))?void 0:r.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),void 0!==i&&this.applyTransformMatrix(this.applyScale(a,i))}else this.applyTransformMatrix(this.applyScale(a,this._gizmos.position));this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(wI.IDLE,!1),this.dispatchEvent(wD),this.dispatchEvent(wL);break;case"FOV":if(this.camera instanceof sD){this.updateTbState(wI.FOV,!0),0!=e.deltaX&&(i=e.deltaX/125,a=1,i>0?a=1/Math.pow(this.scaleFactor,i):i<0&&(a=Math.pow(this.scaleFactor,-i))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let t=this._v3_1.distanceTo(this._gizmos.position),r=t/a;r=ne.clamp(r,this.minDistance,this.maxDistance);let n=t*Math.tan(ne.DEG2RAD*this.camera.fov*.5),s=ne.RAD2DEG*(2*Math.atan(n/r));s>this.maxFov?s=this.maxFov:s<this.minFov&&(s=this.minFov),a=t/(n/Math.tan(ne.DEG2RAD*(s/2))),this.setFov(s),this.applyTransformMatrix(this.applyScale(a,this._gizmos.position,!1))}this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(wI.IDLE,!1),this.dispatchEvent(wD),this.dispatchEvent(wL)}}}}),wT(this,"onSinglePanStart",(e,t)=>{if(this.enabled&&this.domElement)switch(this.dispatchEvent(wP),this.setCenter(e.clientX,e.clientY),t){case"PAN":if(!this.enablePan)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(wD)),this.camera){this.updateTbState(wI.PAN,!0);let e=this.unprojectOnTbPlane(this.camera,wR.x,wR.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(wD))}break;case"ROTATE":if(!this.enableRotate)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.camera){this.updateTbState(wI.ROTATE,!0);let e=this.unprojectOnTbSurface(this.camera,wR.x,wR.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr)}this.dispatchEvent(wD);break;case"FOV":if(!this.enableZoom)return;this.camera instanceof sD&&(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(wD)),this.updateTbState(wI.FOV,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(wR.x,wR.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition));break;case"ZOOM":if(!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(wD)),this.updateTbState(wI.SCALE,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(wR.x,wR.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),wT(this,"onSinglePanMove",(e,t)=>{if(this.enabled&&this.domElement){let r=t!=this._state;switch(this.setCenter(e.clientX,e.clientY),t){case wI.PAN:if(this.enablePan&&this.camera){if(r){this.dispatchEvent(wL),this.dispatchEvent(wP),this.updateTbState(t,!0);let e=this.unprojectOnTbPlane(this.camera,wR.x,wR.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)}else{let e=this.unprojectOnTbPlane(this.camera,wR.x,wR.y,this.domElement);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))}}break;case wI.ROTATE:if(this.enableRotate&&this.camera){if(r){this.dispatchEvent(wL),this.dispatchEvent(wP),this.updateTbState(t,!0);let e=this.unprojectOnTbSurface(this.camera,wR.x,wR.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0)}else{let e=this.unprojectOnTbSurface(this.camera,wR.x,wR.y,this.domElement,this._tbRadius);void 0!==e&&this._currentCursorPosition.copy(e);let t=this._startCursorPosition.distanceTo(this._currentCursorPosition),r=this._startCursorPosition.angleTo(this._currentCursorPosition),i=Math.max(t/this._tbRadius,r);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),i)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=i,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}}break;case wI.SCALE:if(this.enableZoom){if(r)this.dispatchEvent(wL),this.dispatchEvent(wP),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(wR.x,wR.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(.5*this.getCursorNDC(wR.x,wR.y,this.domElement).y);let e=this._currentCursorPosition.y-this._startCursorPosition.y,t=1;e<0?t=1/Math.pow(this.scaleFactor,-(8*e)):e>0&&(t=Math.pow(this.scaleFactor,8*e)),this.applyTransformMatrix(this.applyScale(t,this._gizmos.position))}}break;case wI.FOV:if(this.enableZoom&&this.camera instanceof sD){if(r)this.dispatchEvent(wL),this.dispatchEvent(wP),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(wR.x,wR.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(.5*this.getCursorNDC(wR.x,wR.y,this.domElement).y);let e=this._currentCursorPosition.y-this._startCursorPosition.y,t=1;e<0?t=1/Math.pow(this.scaleFactor,-(8*e)):e>0&&(t=Math.pow(this.scaleFactor,8*e)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let r=this._v3_1.distanceTo(this._gizmos.position),i=r/t;i=ne.clamp(i,this.minDistance,this.maxDistance);let n=r*Math.tan(ne.DEG2RAD*this._fovState*.5),a=ne.RAD2DEG*(2*Math.atan(n/i));a=ne.clamp(a,this.minFov,this.maxFov);let s=n/Math.tan(ne.DEG2RAD*(a/2));t=r/s,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(a),this.applyTransformMatrix(this.applyScale(t,this._v3_2,!1));let o=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(s/r);this._m4_1.makeTranslation(o.x,o.y,o.z)}}}this.dispatchEvent(wD)}}),wT(this,"onSinglePanEnd",()=>{if(this._state==wI.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations){if(performance.now()-this._timeCurrent<120){let e=Math.abs((this._wPrev+this._wCurr)/2),t=this;this._animationId=window.requestAnimationFrame(function(r){t.updateTbState(wI.ANIMATION_ROTATE,!0);let i=t.calculateRotationAxis(t._cursorPosPrev,t._cursorPosCurr);t.onRotationAnim(r,i,Math.min(e,t.wMax))})}else this.updateTbState(wI.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(wD)}else this.updateTbState(wI.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(wD)}else(this._state==wI.PAN||this._state==wI.IDLE)&&(this.updateTbState(wI.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(wD));this.dispatchEvent(wL)}),wT(this,"onDoubleTap",e=>{if(this.enabled&&this.enablePan&&this.scene&&this.camera&&this.domElement){this.dispatchEvent(wP),this.setCenter(e.clientX,e.clientY);let t=this.unprojectOnObj(this.getCursorNDC(wR.x,wR.y,this.domElement),this.camera);if(t&&this.enableAnimations){let e=this;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(r){e.updateTbState(wI.ANIMATION_FOCUS,!0),e.onFocusAnim(r,t,e._cameraMatrixState,e._gizmoMatrixState)})}else t&&!this.enableAnimations&&(this.updateTbState(wI.FOCUS,!0),this.focus(t,this.scaleFactor),this.updateTbState(wI.IDLE,!1),this.dispatchEvent(wD))}this.dispatchEvent(wL)}),wT(this,"onDoublePanStart",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.dispatchEvent(wP),this.updateTbState(wI.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);let e=this.unprojectOnTbPlane(this.camera,wR.x,wR.y,this.domElement,!0);void 0!==e&&this._startCursorPosition.copy(e),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1)}}),wT(this,"onDoublePanMove",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=wI.PAN&&(this.updateTbState(wI.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition));let e=this.unprojectOnTbPlane(this.camera,wR.x,wR.y,this.domElement,!0);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(wD)}}),wT(this,"onDoublePanEnd",()=>{this.updateTbState(wI.IDLE,!1),this.dispatchEvent(wL)}),wT(this,"onRotateStart",()=>{var e;this.enabled&&this.enableRotate&&(this.dispatchEvent(wP),this.updateTbState(wI.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,null==(e=this.camera)||e.getWorldDirection(this._rotationAxis),this.enablePan||this.enableZoom||this.activateGizmos(!0))}),wT(this,"onRotateMove",()=>{var e;if(this.enabled&&this.enableRotate&&this.camera&&this.domElement){let t;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=wI.ZROTATE&&(this.updateTbState(wI.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?this.camera&&(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),t=null==(e=this.unprojectOnTbPlane(this.camera,wR.x,wR.y,this.domElement))?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):t=new ni().setFromMatrixPosition(this._gizmoMatrixState);let r=ne.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);void 0!==t&&this.applyTransformMatrix(this.zRotate(t,r)),this.dispatchEvent(wD)}}),wT(this,"onRotateEnd",()=>{this.updateTbState(wI.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(wL)}),wT(this,"onPinchStart",()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(wP),this.updateTbState(wI.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}),wT(this,"onPinchMove",()=>{var e,t;if(this.enabled&&this.enableZoom&&this.domElement){let r;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=wI.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(wI.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),12*this._devPxRatio);let i=this._currentFingerDistance/this._startFingerDistance;this.enablePan?this.camera instanceof cv?r=null==(e=this.unprojectOnTbPlane(this.camera,wR.x,wR.y,this.domElement))?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera instanceof sD&&(r=null==(t=this.unprojectOnTbPlane(this.camera,wR.x,wR.y,this.domElement))?void 0:t.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):r=this._gizmos.position,void 0!==r&&this.applyTransformMatrix(this.applyScale(i,r)),this.dispatchEvent(wD)}}),wT(this,"onPinchEnd",()=>{this.updateTbState(wI.IDLE,!1),this.dispatchEvent(wL)}),wT(this,"onTriplePanStart",()=>{if(this.enabled&&this.enableZoom&&this.domElement){this.dispatchEvent(wP),this.updateTbState(wI.SCALE,!0);let e=0,t=0,r=this._touchCurrent.length;for(let i=0;i<r;i++)e+=this._touchCurrent[i].clientX,t+=this._touchCurrent[i].clientY;this.setCenter(e/r,t/r),this._startCursorPosition.setY(.5*this.getCursorNDC(wR.x,wR.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),wT(this,"onTriplePanMove",()=>{if(this.enabled&&this.enableZoom&&this.camera&&this.domElement){let e=0,t=0,r=this._touchCurrent.length;for(let i=0;i<r;i++)e+=this._touchCurrent[i].clientX,t+=this._touchCurrent[i].clientY;this.setCenter(e/r,t/r),this._currentCursorPosition.setY(.5*this.getCursorNDC(wR.x,wR.y,this.domElement).y);let i=this._currentCursorPosition.y-this._startCursorPosition.y,n=1;i<0?n=1/Math.pow(this.scaleFactor,-(8*i)):i>0&&(n=Math.pow(this.scaleFactor,8*i)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let a=this._v3_1.distanceTo(this._gizmos.position),s=a/n;s=ne.clamp(s,this.minDistance,this.maxDistance);let o=a*Math.tan(ne.DEG2RAD*this._fovState*.5),l=ne.RAD2DEG*(2*Math.atan(o/s));l=ne.clamp(l,this.minFov,this.maxFov);let u=o/Math.tan(ne.DEG2RAD*(l/2));n=a/u,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(l),this.applyTransformMatrix(this.applyScale(n,this._v3_2,!1));let c=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(u/a);this._m4_1.makeTranslation(c.x,c.y,c.z),this.dispatchEvent(wD)}}),wT(this,"onTriplePanEnd",()=>{this.updateTbState(wI.IDLE,!1),this.dispatchEvent(wL)}),wT(this,"setCenter",(e,t)=>{wR.x=e,wR.y=t}),wT(this,"initializeMouseActions",()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}),wT(this,"setMouseAction",(e,t,r=null)=>{let i;if(!["PAN","ROTATE","ZOOM","FOV"].includes(e)||![0,1,2,"WHEEL"].includes(t)||!["CTRL","SHIFT",null].includes(r)||"WHEEL"==t&&"ZOOM"!=e&&"FOV"!=e)return!1;switch(e){case"PAN":i=wI.PAN;break;case"ROTATE":i=wI.ROTATE;break;case"ZOOM":i=wI.SCALE;break;case"FOV":i=wI.FOV}let n={operation:e,mouse:t,key:r,state:i};for(let e=0;e<this.mouseActions.length;e++)if(this.mouseActions[e].mouse==n.mouse&&this.mouseActions[e].key==n.key)return this.mouseActions.splice(e,1,n),!0;return this.mouseActions.push(n),!0}),wT(this,"getOpFromAction",(e,t)=>{let r;for(let i=0;i<this.mouseActions.length;i++)if((r=this.mouseActions[i]).mouse==e&&r.key==t)return r.operation;if(t){for(let t=0;t<this.mouseActions.length;t++)if((r=this.mouseActions[t]).mouse==e&&null==r.key)return r.operation}return null}),wT(this,"getOpStateFromAction",(e,t)=>{let r;for(let i=0;i<this.mouseActions.length;i++)if((r=this.mouseActions[i]).mouse==e&&r.key==t)return r.state;if(t){for(let t=0;t<this.mouseActions.length;t++)if((r=this.mouseActions[t]).mouse==e&&null==r.key)return r.state}return null}),wT(this,"getAngle",(e,t)=>180*Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)/Math.PI),wT(this,"updateTouchEvent",e=>{for(let t=0;t<this._touchCurrent.length;t++)if(this._touchCurrent[t].pointerId==e.pointerId){this._touchCurrent.splice(t,1,e);break}}),wT(this,"calculateAngularSpeed",(e,t,r,i)=>{let n=(i-r)/1e3;return 0==n?0:(t-e)/n}),wT(this,"calculatePointersDistance",(e,t)=>Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))),wT(this,"calculateRotationAxis",(e,t)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(e,t).applyQuaternion(this._quat),this._rotationAxis.normalize().clone())),wT(this,"calculateTbRadius",e=>{let t=e.position.distanceTo(this._gizmos.position);if(e instanceof sD){let r=ne.DEG2RAD*e.fov*.5,i=Math.atan(e.aspect*Math.tan(r));return Math.tan(Math.min(r,i))*t*.67}if(e instanceof cv)return .67*Math.min(e.top,e.right)}),wT(this,"focus",(e,t,r=1)=>{if(this.camera){let i=e.clone();i.sub(this._gizmos.position).multiplyScalar(r),this._translationMatrix.makeTranslation(i.x,i.y,i.z);let n=this._gizmoMatrixState.clone();this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);let a=this._cameraMatrixState.clone();this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.applyScale(t,this._gizmos.position)),this._gizmoMatrixState.copy(n),this._cameraMatrixState.copy(a)}}),wT(this,"drawGrid",()=>{if(this.scene){let e,t,r,i;if(this.camera instanceof cv)i=(r=Math.max(this.camera.right-this.camera.left,this.camera.bottom-this.camera.top))/20,t=(e=r/this.camera.zoom*3)/i*this.camera.zoom;else if(this.camera instanceof sD){let n=this.camera.position.distanceTo(this._gizmos.position),a=ne.DEG2RAD*this.camera.fov*.5,s=Math.atan(this.camera.aspect*Math.tan(a));i=(r=Math.tan(Math.max(a,s))*n*2)/20,t=(e=3*r)/i}null==this._grid&&this.camera&&(this._grid=new hH(e,t,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(.5*Math.PI),this.scene.add(this._grid))}}),wT(this,"connect",e=>{e===document&&console.error('THREE.ArcballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.style.touchAction="none",this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onWheel)}),wT(this,"dispose",()=>{var e,t,r,i,n;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointercancel",this.onPointerCancel),null==(r=this.domElement)||r.removeEventListener("wheel",this.onWheel),null==(i=this.domElement)||i.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),null==(n=this.scene)||n.remove(this._gizmos),this.disposeGrid()}),wT(this,"disposeGrid",()=>{this._grid&&this.scene&&(this.scene.remove(this._grid),this._grid=null)}),wT(this,"easeOutCubic",e=>1-Math.pow(1-e,3)),wT(this,"activateGizmos",e=>{for(let t of this._gizmos.children)t.material.setValues({opacity:e?1:.6})}),wT(this,"getCursorNDC",(e,t,r)=>{let i=r.getBoundingClientRect();return this._v2_1.setX((e-i.left)/i.width*2-1),this._v2_1.setY((i.bottom-t)/i.height*2-1),this._v2_1.clone()}),wT(this,"getCursorPosition",(e,t,r)=>(this._v2_1.copy(this.getCursorNDC(e,t,r)),this.camera instanceof cv&&(this._v2_1.x*=(this.camera.right-this.camera.left)*.5,this._v2_1.y*=(this.camera.top-this.camera.bottom)*.5),this._v2_1.clone())),wT(this,"setCamera",e=>{if(e){e.lookAt(this.target),e.updateMatrix(),e instanceof sD&&(this._fov0=e.fov,this._fovState=e.fov),this._cameraMatrixState0.copy(e.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(e.projectionMatrix),this._zoom0=e.zoom,this._zoomState=this._zoom0,this._initialNear=e.near,this._nearPos0=e.position.distanceTo(this.target)-e.near,this._nearPos=this._initialNear,this._initialFar=e.far,this._farPos0=e.position.distanceTo(this.target)-e.far,this._farPos=this._initialFar,this._up0.copy(e.up),this._upState.copy(e.up),this.camera=e,this.camera.updateProjectionMatrix();let t=this.calculateTbRadius(e);void 0!==t&&(this._tbRadius=t),this.makeGizmos(this.target,this._tbRadius)}}),wT(this,"makeGizmos",(e,t)=>{let r=new lR(0,0,t,t).getPoints(this._curvePts),i=new sl().setFromPoints(r),n=new oJ({color:0xff8080,fog:!1,transparent:!0,opacity:.6}),a=new oJ({color:8454016,fog:!1,transparent:!0,opacity:.6}),s=new oJ({color:8421631,fog:!1,transparent:!0,opacity:.6}),o=new o6(i,n),l=new o6(i,a),u=new o6(i,s),c=.5*Math.PI;if(o.rotation.x=c,l.rotation.y=c,this._gizmoMatrixState0.identity().setPosition(e),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.camera&&1!=this.camera.zoom){let t=1/this.camera.zoom;this._scaleMatrix.makeScale(t,t,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(e.x,e.y,e.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(o),this._gizmos.add(l),this._gizmos.add(u)}),wT(this,"onFocusAnim",(e,t,r,i)=>{if(-1==this._timeStart&&(this._timeStart=e),this._state==wI.ANIMATION_FOCUS){let n=(e-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(i),n>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,this.scaleFactor),this._timeStart=-1,this.updateTbState(wI.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(wD);else{let e=this.easeOutCubic(n),a=1-e+this.scaleFactor*e;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,a,e),this.dispatchEvent(wD);let s=this;this._animationId=window.requestAnimationFrame(function(e){s.onFocusAnim(e,t,r,i.clone())})}}else this._animationId=-1,this._timeStart=-1}),wT(this,"onRotationAnim",(e,t,r)=>{if(-1==this._timeStart&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=e),this._state==wI.ANIMATION_ROTATE){let i=(e-this._timeStart)/1e3;if(r+-this.dampingFactor*i>0){this._angleCurrent=-(.5*this.dampingFactor)*Math.pow(i,2)+r*i+0,this.applyTransformMatrix(this.rotate(t,this._angleCurrent)),this.dispatchEvent(wD);let e=this;this._animationId=window.requestAnimationFrame(function(i){e.onRotationAnim(i,t,r)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(wI.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(wD)}else this._animationId=-1,this._timeStart=-1,this._state!=wI.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(wD))}),wT(this,"pan",(e,t,r=!1)=>{if(this.camera){let i=e.clone().sub(t);if(this.camera instanceof cv&&i.multiplyScalar(1/this.camera.zoom),this.camera instanceof sD&&r){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);let e=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);i.multiplyScalar(1/e)}this._v3_1.set(i.x,i.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1)}return wB}),wT(this,"reset",()=>{if(this.camera){this.camera.zoom=this._zoom0,this.camera instanceof sD&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix();let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(wI.IDLE,!1),this.dispatchEvent(wD)}}),wT(this,"rotate",(e,t)=>{let r=this._gizmos.position;return this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._rotationMatrix.makeRotationAxis(e,-t),this._m4_1.makeTranslation(r.x,r.y,r.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),wB}),wT(this,"copyState",()=>{if(this.camera){let e=JSON.stringify(this.camera instanceof cv?{arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}:{arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}});navigator.clipboard.writeText(e)}}),wT(this,"pasteState",()=>{let e=this;navigator.clipboard.readText().then(function(t){e.setStateFromJSON(t)})}),wT(this,"saveState",()=>{this.camera&&(this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera instanceof sD&&(this._fov0=this.camera.fov))}),wT(this,"applyScale",(e,t,r=!0)=>{if(!this.camera)return;let i=t.clone(),n=1/e;if(this.camera instanceof cv){this.camera.zoom=this._zoomState,this.camera.zoom*=e,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,n=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,n=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(n,n,n),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),i.sub(this._v3_1);let t=i.clone().multiplyScalar(n);return i.sub(t),this._m4_1.makeTranslation(i.x,i.y,i.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),wB}if(this.camera instanceof sD){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let e=this._v3_1.distanceTo(i),t=e-e*n,a=e-t;a<this.minDistance?(n=this.minDistance/e,t=e-e*n):a>this.maxDistance&&(n=this.maxDistance/e,t=e-e*n);let s=i.clone().sub(this._v3_1).normalize().multiplyScalar(t);if(this._m4_1.makeTranslation(s.x,s.y,s.z),r){let r=this._v3_2;t=(e=r.distanceTo(i))-e*n,s=i.clone().sub(this._v3_2).normalize().multiplyScalar(t),this._translationMatrix.makeTranslation(r.x,r.y,r.z),this._scaleMatrix.makeScale(n,n,n),this._m4_2.makeTranslation(s.x,s.y,s.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return wB}}),wT(this,"setFov",e=>{this.camera instanceof sD&&(this.camera.fov=ne.clamp(e,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())}),wT(this,"setTarget",(e,t,r)=>{if(this.camera){this.target.set(e,t,r),this._gizmos.position.set(e,t,r);let i=this.calculateTbRadius(this.camera);void 0!==i&&(this._tbRadius=i),this.makeGizmos(this.target,this._tbRadius),this.camera.lookAt(this.target)}}),wT(this,"zRotate",(e,t)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._m4_1.makeTranslation(e.x,e.y,e.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(e),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,t),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),wB)),wT(this,"unprojectOnObj",(e,t)=>{if(!this.scene)return null;let r=new hf;r.near=t.near,r.far=t.far,r.setFromCamera(e,t);let i=r.intersectObjects(this.scene.children,!0);for(let e=0;e<i.length;e++)if(i[e].object.uuid!=this._gizmos.uuid&&i[e].face)return i[e].point.clone();return null}),wT(this,"unprojectOnTbSurface",(e,t,r,i,n)=>{if(e instanceof cv){this._v2_1.copy(this.getCursorPosition(t,r,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);let e=Math.pow(this._v2_1.x,2),n=Math.pow(this._v2_1.y,2),a=Math.pow(this._tbRadius,2);return e+n<=.5*a?this._v3_1.setZ(Math.sqrt(a-(e+n))):this._v3_1.setZ(.5*a/Math.sqrt(e+n)),this._v3_1}if(e instanceof sD){this._v2_1.copy(this.getCursorNDC(t,r,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);let a=this._v3_1.clone().normalize(),s=e.position.distanceTo(this._gizmos.position),o=Math.pow(n,2),l=this._v3_1.z,u=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(0==u)return a.set(this._v3_1.x,this._v3_1.y,n),a;let c=l/u,h=Math.pow(c,2)+1,d=2*c*s,f=Math.pow(s,2)-o,p=Math.pow(d,2)-4*h*f;if(p>=0&&(this._v2_1.setX((-d-Math.sqrt(p))/(2*h)),this._v2_1.setY(c*this._v2_1.x+s),ne.RAD2DEG*this._v2_1.angle()>=45)){let e=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(s-this._v2_1.y,2));return a.multiplyScalar(e),a.z+=s,a}h=c,p=Math.pow(d=s,2)-4*h*(f=-(.5*o)),this._v2_1.setX((-d-Math.sqrt(p))/(2*h)),this._v2_1.setY(c*this._v2_1.x+s);let m=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(s-this._v2_1.y,2));return a.multiplyScalar(m),a.z+=s,a}}),wT(this,"unprojectOnTbPlane",(e,t,r,i,n=!1)=>{if(e instanceof cv)return this._v2_1.copy(this.getCursorPosition(t,r,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(e instanceof sD){let a;this._v2_1.copy(this.getCursorNDC(t,r,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);let s=this._v3_1.clone().normalize(),o=this._v3_1.z,l=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(a=n?this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):e.position.distanceTo(this._gizmos.position),0==l)return s.set(0,0,0),s;let u=Math.sqrt(Math.pow(a,2)+Math.pow(-a/(o/l),2));return s.multiplyScalar(u),s.z=0,s}}),wT(this,"updateMatrixState",()=>{this.camera&&(this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera instanceof cv&&(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom),this.camera instanceof sD&&(this._fovState=this.camera.fov))}),wT(this,"updateTbState",(e,t)=>{this._state=e,t&&this.updateMatrixState()}),wT(this,"update",()=>{if(!this.target.equals(this._currentTarget)&&this.camera){this._gizmos.position.set(this.target.x,this.target.y,this.target.z);let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)}if(this.camera){if(this.camera instanceof cv&&(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom)){let e=ne.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.applyScale(e/this.camera.zoom,this._gizmos.position,!0))}if(this.camera instanceof sD){let e=this.camera.position.distanceTo(this._gizmos.position);if(e>this.maxDistance+1e-6||e<this.minDistance-1e-6){let t=ne.clamp(e,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.applyScale(t/e,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=ne.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());let t=this._tbRadius,r=this.calculateTbRadius(this.camera);if(void 0!==r&&(this._tbRadius=r),t<this._tbRadius-1e-6||t>this._tbRadius+1e-6){let e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,t=this._tbRadius/e,r=new lR(0,0,t,t).getPoints(this._curvePts),i=new sl().setFromPoints(r);for(let e in this._gizmos.children)this._gizmos.children[e].geometry=i}}this.camera.lookAt(this._gizmos.position)}}),wT(this,"setStateFromJSON",e=>{let t=JSON.parse(e);if(t.arcballState&&this.camera){this._cameraMatrixState.fromArray(t.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(t.arcballState.cameraUp),this.camera.near=t.arcballState.cameraNear,this.camera.far=t.arcballState.cameraFar,this.camera.zoom=t.arcballState.cameraZoom,this.camera instanceof sD&&(this.camera.fov=t.arcballState.cameraFov),this._gizmoMatrixState.fromArray(t.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix();let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e);let r=new n8().copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(r),this.camera.lookAt(this._gizmos.position),this.updateTbState(wI.IDLE,!1),this.dispatchEvent(wD)}}),this.camera=null,this.domElement=t,this.scene=r,this.mouseActions=[],this._mouseOp=null,this._v2_1=new nt,this._v3_1=new ni,this._v3_2=new ni,this._m4_1=new n8,this._m4_2=new n8,this._quat=new nr,this._translationMatrix=new n8,this._rotationMatrix=new n8,this._scaleMatrix=new n8,this._rotationAxis=new ni,this._cameraMatrixState=new n8,this._cameraProjectionState=new n8,this._fovState=1,this._upState=new ni,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new n8,this._up0=new ni,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new n8,this._gizmoMatrixState0=new n8,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=wM.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new ni,this._startCursorPosition=new ni,this._grid=null,this._gridPosition=new ni,this._gizmos=new sF,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new ni,this._cursorPosCurr=new ni,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.target=new ni(0,0,0),this._currentTarget=new ni(0,0,0),this._tbRadius=1,this._state=wI.IDLE,this.setCamera(e),this.scene&&this.scene.add(this._gizmos),this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement&&this.connect(this.domElement),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if((null==e?void 0:e.camera)&&this.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),(this._state==wI.ROTATE||this._state==wI.ZROTATE||this._state==wI.ANIMATION_ROTATE)&&this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),(null==e?void 0:e.gizmos)&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),(this._state==wI.SCALE||this._state==wI.FOCUS||this._state==wI.ANIMATION_FOCUS)&&this.camera){let e=this.calculateTbRadius(this.camera);if(void 0!==e&&(this._tbRadius=e),this.adjustNearFar){let e=this.camera.position.distanceTo(this._gizmos.position),t=new nL;t.setFromObject(this._gizmos);let r=new nJ;t.getBoundingSphere(r);let i=Math.min(Math.max(this._nearPos0,r.radius+r.center.length()),e-this._initialNear);this.camera.near=e-i;let n=Math.min(Math.min(this._farPos0,-r.radius+r.center.length()),e-this._initialFar);this.camera.far=e-n,this.camera.updateProjectionMatrix()}else{let e=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,e=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,e=!0),e&&this.camera.updateProjectionMatrix()}}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(wD)}setTransformationMatrices(e=null,t=null){e?wB.camera?wB.camera.copy(e):wB.camera=e.clone():wB.camera=null,t?wB.gizmos?wB.gizmos.copy(t):wB.gizmos=t.clone():wB.gizmos=null}}let wF=(0,eN.forwardRef)(({camera:e,makeDefault:t,regress:r,domElement:i,onChange:n,onStart:a,onEnd:s,...o},l)=>{let u=dY(e=>e.invalidate),c=dY(e=>e.camera),h=dY(e=>e.gl),d=dY(e=>e.events),f=dY(e=>e.set),p=dY(e=>e.get),m=dY(e=>e.performance),g=e||c,A=i||d.connected||h.domElement,v=(0,eN.useMemo)(()=>new wk(g),[g]);return dK(()=>{v.enabled&&v.update()},-1),(0,eN.useEffect)(()=>(v.connect(A),()=>void v.dispose()),[A,r,v,u]),(0,eN.useEffect)(()=>{let e=e=>{u(),r&&m.regress(),n&&n(e)};return v.addEventListener("change",e),a&&v.addEventListener("start",a),s&&v.addEventListener("end",s),()=>{v.removeEventListener("change",e),a&&v.removeEventListener("start",a),s&&v.removeEventListener("end",s)}},[n,a,s]),(0,eN.useEffect)(()=>{if(t){let e=p().controls;return f({controls:v}),()=>f({controls:e})}},[t,v]),eN.createElement("primitive",eU({ref:l,object:v},o))});var wO=Object.defineProperty,wU=(e,t,r)=>t in e?wO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wN=(e,t,r)=>(wU(e,"symbol"!=typeof t?t+"":t,r),r);class wz extends aS{constructor(e,t){super(),wN(this,"isTransformControls",!0),wN(this,"visible",!1),wN(this,"domElement"),wN(this,"raycaster",new hf),wN(this,"gizmo"),wN(this,"plane"),wN(this,"tempVector",new ni),wN(this,"tempVector2",new ni),wN(this,"tempQuaternion",new nr),wN(this,"unit",{X:new ni(1,0,0),Y:new ni(0,1,0),Z:new ni(0,0,1)}),wN(this,"pointStart",new ni),wN(this,"pointEnd",new ni),wN(this,"offset",new ni),wN(this,"rotationAxis",new ni),wN(this,"startNorm",new ni),wN(this,"endNorm",new ni),wN(this,"rotationAngle",0),wN(this,"cameraPosition",new ni),wN(this,"cameraQuaternion",new nr),wN(this,"cameraScale",new ni),wN(this,"parentPosition",new ni),wN(this,"parentQuaternion",new nr),wN(this,"parentQuaternionInv",new nr),wN(this,"parentScale",new ni),wN(this,"worldPositionStart",new ni),wN(this,"worldQuaternionStart",new nr),wN(this,"worldScaleStart",new ni),wN(this,"worldPosition",new ni),wN(this,"worldQuaternion",new nr),wN(this,"worldQuaternionInv",new nr),wN(this,"worldScale",new ni),wN(this,"eye",new ni),wN(this,"positionStart",new ni),wN(this,"quaternionStart",new nr),wN(this,"scaleStart",new ni),wN(this,"camera"),wN(this,"object"),wN(this,"enabled",!0),wN(this,"axis",null),wN(this,"mode","translate"),wN(this,"translationSnap",null),wN(this,"rotationSnap",null),wN(this,"scaleSnap",null),wN(this,"space","world"),wN(this,"size",1),wN(this,"dragging",!1),wN(this,"showX",!0),wN(this,"showY",!0),wN(this,"showZ",!0),wN(this,"changeEvent",{type:"change"}),wN(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),wN(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),wN(this,"objectChangeEvent",{type:"objectChange"}),wN(this,"intersectObjectWithRay",(e,t,r)=>{let i=t.intersectObject(e,!0);for(let e=0;e<i.length;e++)if(i[e].object.visible||r)return i[e];return!1}),wN(this,"attach",e=>(this.object=e,this.visible=!0,this)),wN(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),wN(this,"reset",()=>(this.enabled&&this.dragging&&void 0!==this.object&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this)),wN(this,"updateMatrixWorld",()=>{void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),wN(this,"pointerHover",e=>{if(void 0===this.object||!0===this.dragging)return;this.raycaster.setFromCamera(e,this.camera);let t=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);t?this.axis=t.object.name:this.axis=null}),wN(this,"pointerDown",e=>{if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){this.raycaster.setFromCamera(e,this.camera);let t=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(t){let e=this.space;if("scale"===this.mode?e="local":("E"===this.axis||"XYZE"===this.axis||"XYZ"===this.axis)&&(e="world"),"local"===e&&"rotate"===this.mode){let e=this.rotationSnap;"X"===this.axis&&e&&(this.object.rotation.x=Math.round(this.object.rotation.x/e)*e),"Y"===this.axis&&e&&(this.object.rotation.y=Math.round(this.object.rotation.y/e)*e),"Z"===this.axis&&e&&(this.object.rotation.z=Math.round(this.object.rotation.z/e)*e)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),wN(this,"pointerMove",e=>{let t=this.axis,r=this.mode,i=this.object,n=this.space;if("scale"===r?n="local":("E"===t||"XYZE"===t||"XYZ"===t)&&(n="world"),void 0===i||null===t||!1===this.dragging||-1!==e.button)return;this.raycaster.setFromCamera(e,this.camera);let a=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),"translate"===r)this.offset.copy(this.pointEnd).sub(this.pointStart),"local"===n&&"XYZ"!==t&&this.offset.applyQuaternion(this.worldQuaternionInv),-1===t.indexOf("X")&&(this.offset.x=0),-1===t.indexOf("Y")&&(this.offset.y=0),-1===t.indexOf("Z")&&(this.offset.z=0),"local"===n&&"XYZ"!==t?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),i.position.copy(this.offset).add(this.positionStart),this.translationSnap&&("local"===n&&(i.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this.quaternionStart)),"world"===n&&(i.parent&&i.position.add(this.tempVector.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(this.tempVector.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();0>this.pointEnd.dot(this.pointStart)&&(e*=-1),this.tempVector2.set(e,e,e)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),-1===t.search("X")&&(this.tempVector2.x=1),-1===t.search("Y")&&(this.tempVector2.y=1),-1===t.search("Z")&&(this.tempVector2.z=1);i.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(-1!==t.search("X")&&(this.object.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===r){this.offset.copy(this.pointEnd).sub(this.pointStart);let e=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=0>this.endNorm.cross(this.startNorm).dot(this.eye)?1:-1):"XYZE"===t?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*e):("X"===t||"Y"===t||"Z"===t)&&(this.rotationAxis.copy(this.unit[t]),this.tempVector.copy(this.unit[t]),"local"===n&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===n&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this.quaternionStart),i.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),i.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),wN(this,"pointerUp",e=>{0===e.button&&(this.dragging&&null!==this.axis&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),wN(this,"getPointer",e=>{var t;if(this.domElement&&(null==(t=this.domElement.ownerDocument)?void 0:t.pointerLockElement))return{x:0,y:0,button:e.button};{let t=e.changedTouches?e.changedTouches[0]:e,r=this.domElement.getBoundingClientRect();return{x:(t.clientX-r.left)/r.width*2-1,y:-(t.clientY-r.top)/r.height*2+1,button:e.button}}}),wN(this,"onPointerHover",e=>{if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(e))}}),wN(this,"onPointerDown",e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(e)),this.pointerDown(this.getPointer(e)))}),wN(this,"onPointerMove",e=>{this.enabled&&this.pointerMove(this.getPointer(e))}),wN(this,"onPointerUp",e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(e)))}),wN(this,"getMode",()=>this.mode),wN(this,"setMode",e=>{this.mode=e}),wN(this,"setTranslationSnap",e=>{this.translationSnap=e}),wN(this,"setRotationSnap",e=>{this.rotationSnap=e}),wN(this,"setScaleSnap",e=>{this.scaleSnap=e}),wN(this,"setSize",e=>{this.size=e}),wN(this,"setSpace",e=>{this.space=e}),wN(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),wN(this,"connect",e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),wN(this,"dispose",()=>{var e,t,r,i,n,a;null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointermove",this.onPointerHover),null==(i=null==(r=this.domElement)?void 0:r.ownerDocument)||i.removeEventListener("pointermove",this.onPointerMove),null==(a=null==(n=this.domElement)?void 0:n.ownerDocument)||a.removeEventListener("pointerup",this.onPointerUp),this.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}),this.domElement=t,this.camera=e,this.gizmo=new wG,this.add(this.gizmo),this.plane=new wH,this.add(this.plane);let r=(e,t)=>{let r=t;Object.defineProperty(this,e,{get:function(){return void 0!==r?r:t},set:function(t){r!==t&&(r=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),this[e]=t,this.plane[e]=t,this.gizmo[e]=t};r("camera",this.camera),r("object",this.object),r("enabled",this.enabled),r("axis",this.axis),r("mode",this.mode),r("translationSnap",this.translationSnap),r("rotationSnap",this.rotationSnap),r("scaleSnap",this.scaleSnap),r("space",this.space),r("size",this.size),r("dragging",this.dragging),r("showX",this.showX),r("showY",this.showY),r("showZ",this.showZ),r("worldPosition",this.worldPosition),r("worldPositionStart",this.worldPositionStart),r("worldQuaternion",this.worldQuaternion),r("worldQuaternionStart",this.worldQuaternionStart),r("cameraPosition",this.cameraPosition),r("cameraQuaternion",this.cameraQuaternion),r("pointStart",this.pointStart),r("pointEnd",this.pointEnd),r("rotationAxis",this.rotationAxis),r("rotationAngle",this.rotationAngle),r("eye",this.eye),void 0!==t&&this.connect(t)}}class wG extends aS{constructor(){super(),wN(this,"isTransformControlsGizmo",!0),wN(this,"type","TransformControlsGizmo"),wN(this,"tempVector",new ni(0,0,0)),wN(this,"tempEuler",new ao),wN(this,"alignVector",new ni(0,1,0)),wN(this,"zeroVector",new ni(0,0,0)),wN(this,"lookAtMatrix",new n8),wN(this,"tempQuaternion",new nr),wN(this,"tempQuaternion2",new nr),wN(this,"identityQuaternion",new nr),wN(this,"unitX",new ni(1,0,0)),wN(this,"unitY",new ni(0,1,0)),wN(this,"unitZ",new ni(0,0,1)),wN(this,"gizmo"),wN(this,"picker"),wN(this,"helper"),wN(this,"rotationAxis",new ni),wN(this,"cameraPosition",new ni),wN(this,"worldPositionStart",new ni),wN(this,"worldQuaternionStart",new nr),wN(this,"worldPosition",new ni),wN(this,"worldQuaternion",new nr),wN(this,"eye",new ni),wN(this,"camera",null),wN(this,"enabled",!0),wN(this,"axis",null),wN(this,"mode","translate"),wN(this,"space","world"),wN(this,"size",1),wN(this,"dragging",!1),wN(this,"showX",!0),wN(this,"showY",!0),wN(this,"showZ",!0),wN(this,"updateMatrixWorld",()=>{let e=this.space;"scale"===this.mode&&(e="local");let t="local"===e?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(let e=0;e<r.length;e++){let i;let n=r[e];if(n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition),i=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(i*this.size/7),"helper"===n.tag){n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),n.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),n.quaternion.multiply(this.tempQuaternion),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(this.tempVector),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)));continue}n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode?(("X"===n.name||"XYZX"===n.name)&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),("Y"===n.name||"XYZY"===n.name)&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),("Z"===n.name||"XYZZ"===n.name)&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&.2>Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&.2>Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&.2>Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(0>this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye)?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(0>this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye)?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(0>this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye)?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))):"rotate"===this.mode&&(this.tempQuaternion2.copy(t),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(t).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),"X"===n.name&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),n.quaternion.copy(this.tempQuaternion)),"Y"===n.name&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),n.quaternion.copy(this.tempQuaternion)),"Z"===n.name&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),n.quaternion.copy(this.tempQuaternion))),n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material.tempOpacity=n.material.tempOpacity||n.material.opacity,n.material.tempColor=n.material.tempColor||n.material.color.clone(),n.material.color.copy(n.material.tempColor),n.material.opacity=n.material.tempOpacity,this.enabled?this.axis&&(n.name===this.axis?n.material.opacity=1:this.axis.split("").some(function(e){return n.name===e})?n.material.opacity=1:n.material.opacity*=.25,n.material.color.lerp(new aQ(1,1,1),.5)):(n.material.opacity*=.5,n.material.color.lerp(new aQ(1,1,1),.5))}super.updateMatrixWorld()});let e=new aY({depthTest:!1,depthWrite:!1,transparent:!0,side:e1,fog:!1,toneMapped:!1}),t=new oJ({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),r=e.clone();r.opacity=.15;let i=e.clone();i.opacity=.33;let n=e.clone();n.color.set(0xff0000);let a=e.clone();a.color.set(65280);let s=e.clone();s.color.set(255);let o=e.clone();o.opacity=.25;let l=o.clone();l.color.set(0xffff00);let u=o.clone();u.color.set(65535);let c=o.clone();c.color.set(0xff00ff),e.clone().color.set(0xffff00);let h=t.clone();h.color.set(0xff0000);let d=t.clone();d.color.set(65280);let f=t.clone();f.color.set(255);let p=t.clone();p.color.set(65535);let m=t.clone();m.color.set(0xff00ff);let g=t.clone();g.color.set(0xffff00);let A=t.clone();A.color.set(7895160);let v=g.clone();v.opacity=.25;let y=new lE(0,.05,.2,12,1,!1),E=new s_(.125,.125,.125),x=new sl;x.setAttribute("position",new se([0,0,0,1,0,0],3));let _=(e,t)=>{let r=new sl,i=[];for(let r=0;r<=64*t;++r)i.push(0,Math.cos(r/32*Math.PI)*e,Math.sin(r/32*Math.PI)*e);return r.setAttribute("position",new se(i,3)),r},b={X:[[new sE(y,n),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new sE(y,n),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new o6(x,h)]],Y:[[new sE(y,a),[0,1,0],null,null,"fwd"],[new sE(y,a),[0,1,0],[Math.PI,0,0],null,"bwd"],[new o6(x,d),null,[0,0,Math.PI/2]]],Z:[[new sE(y,s),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new sE(y,s),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new o6(x,f),null,[0,-Math.PI/2,0]]],XYZ:[[new sE(new ud(.1,0),o.clone()),[0,0,0],[0,0,0]]],XY:[[new sE(new uf(.295,.295),l.clone()),[.15,.15,0]],[new o6(x,g),[.18,.3,0],null,[.125,1,1]],[new o6(x,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new sE(new uf(.295,.295),u.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new o6(x,p),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new o6(x,p),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new sE(new uf(.295,.295),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new o6(x,m),[.18,0,.3],null,[.125,1,1]],[new o6(x,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},S={X:[[new sE(new lE(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new sE(new lE(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new sE(new lE(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new sE(new ud(.2,0),r)]],XY:[[new sE(new uf(.4,.4),r),[.2,.2,0]]],YZ:[[new sE(new uf(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new sE(new uf(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},w={START:[[new sE(new ud(.01,2),i),null,null,null,"helper"]],END:[[new sE(new ud(.01,2),i),null,null,null,"helper"]],DELTA:[[new o6((()=>{let e=new sl;return e.setAttribute("position",new se([0,0,0,1,1,1],3)),e})(),i),null,null,null,"helper"]],X:[[new o6(x,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new o6(x,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new o6(x,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},C={X:[[new o6(_(1,.5),h)],[new sE(new ud(.04,0),n),[0,0,.99],null,[1,3,1]]],Y:[[new o6(_(1,.5),d),null,[0,0,-Math.PI/2]],[new sE(new ud(.04,0),a),[0,0,.99],null,[3,1,1]]],Z:[[new o6(_(1,.5),f),null,[0,Math.PI/2,0]],[new sE(new ud(.04,0),s),[.99,0,0],null,[1,3,1]]],E:[[new o6(_(1.25,1),v),null,[0,Math.PI/2,0]],[new sE(new lE(.03,0,.15,4,1,!1),v),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new sE(new lE(.03,0,.15,4,1,!1),v),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new sE(new lE(.03,0,.15,4,1,!1),v),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new sE(new lE(.03,0,.15,4,1,!1),v),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new o6(_(1,1),A),null,[0,Math.PI/2,0]]]},T={AXIS:[[new o6(x,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},I={X:[[new sE(new uv(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new sE(new uv(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new sE(new uv(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new sE(new uv(1.25,.1,2,24),r)]],XYZE:[[new sE(new ug(.7,10,8),r)]]},M={X:[[new sE(E,n),[.8,0,0],[0,0,-Math.PI/2]],[new o6(x,h),null,null,[.8,1,1]]],Y:[[new sE(E,a),[0,.8,0]],[new o6(x,d),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new sE(E,s),[0,0,.8],[Math.PI/2,0,0]],[new o6(x,f),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new sE(E,l),[.85,.85,0],null,[2,2,.2]],[new o6(x,g),[.855,.98,0],null,[.125,1,1]],[new o6(x,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new sE(E,u),[0,.85,.85],null,[.2,2,2]],[new o6(x,p),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new o6(x,p),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new sE(E,c),[.85,0,.85],null,[2,.2,2]],[new o6(x,m),[.855,0,.98],null,[.125,1,1]],[new o6(x,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new sE(new s_(.125,.125,.125),o.clone()),[1.1,0,0]]],XYZY:[[new sE(new s_(.125,.125,.125),o.clone()),[0,1.1,0]]],XYZZ:[[new sE(new s_(.125,.125,.125),o.clone()),[0,0,1.1]]]},R={X:[[new sE(new lE(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new sE(new lE(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new sE(new lE(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new sE(E,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new sE(E,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new sE(E,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new sE(new s_(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new sE(new s_(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new sE(new s_(.2,.2,.2),r),[0,0,1.1]]]},B={X:[[new o6(x,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new o6(x,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new o6(x,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},D=e=>{let t=new aS;for(let r in e)for(let i=e[r].length;i--;){let n=e[r][i][0].clone(),a=e[r][i][1],s=e[r][i][2],o=e[r][i][3],l=e[r][i][4];n.name=r,n.tag=l,a&&n.position.set(a[0],a[1],a[2]),s&&n.rotation.set(s[0],s[1],s[2]),o&&n.scale.set(o[0],o[1],o[2]),n.updateMatrix();let u=n.geometry.clone();u.applyMatrix4(n.matrix),n.geometry=u,n.renderOrder=1/0,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=D(b)),this.add(this.gizmo.rotate=D(C)),this.add(this.gizmo.scale=D(M)),this.add(this.picker.translate=D(S)),this.add(this.picker.rotate=D(I)),this.add(this.picker.scale=D(R)),this.add(this.helper.translate=D(w)),this.add(this.helper.rotate=D(T)),this.add(this.helper.scale=D(B)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class wH extends sE{constructor(){super(new uf(1e5,1e5,2,2),new aY({visible:!1,wireframe:!0,side:e1,transparent:!0,opacity:.1,toneMapped:!1})),wN(this,"isTransformControlsPlane",!0),wN(this,"type","TransformControlsPlane"),wN(this,"unitX",new ni(1,0,0)),wN(this,"unitY",new ni(0,1,0)),wN(this,"unitZ",new ni(0,0,1)),wN(this,"tempVector",new ni),wN(this,"dirVector",new ni),wN(this,"alignVector",new ni),wN(this,"tempMatrix",new n8),wN(this,"identityQuaternion",new nr),wN(this,"cameraQuaternion",new nr),wN(this,"worldPosition",new ni),wN(this,"worldQuaternion",new nr),wN(this,"eye",new ni),wN(this,"axis",null),wN(this,"mode","translate"),wN(this,"space","world"),wN(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),this.unitX.set(1,0,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0)}break;default:this.dirVector.set(0,0,0)}0===this.dirVector.length()?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}let wQ=eN.forwardRef(({children:e,domElement:t,onChange:r,onMouseDown:i,onMouseUp:n,onObjectChange:a,object:s,makeDefault:o,camera:l,enabled:u,axis:c,mode:h,translationSnap:d,rotationSnap:f,scaleSnap:p,space:m,size:g,showX:A,showY:v,showZ:y,...E},x)=>{let _=dY(e=>e.controls),b=dY(e=>e.gl),S=dY(e=>e.events),w=dY(e=>e.camera),C=dY(e=>e.invalidate),T=dY(e=>e.get),I=dY(e=>e.set),M=l||w,R=t||S.connected||b.domElement,B=eN.useMemo(()=>new wz(M,R),[M,R]),D=eN.useRef(null);eN.useLayoutEffect(()=>(s?B.attach(s instanceof aS?s:s.current):D.current instanceof aS&&B.attach(D.current),()=>void B.detach()),[s,e,B]),eN.useEffect(()=>{if(_){let e=e=>_.enabled=!e.value;return B.addEventListener("dragging-changed",e),()=>B.removeEventListener("dragging-changed",e)}},[B,_]);let P=eN.useRef(),L=eN.useRef(),k=eN.useRef(),F=eN.useRef();return eN.useLayoutEffect(()=>void(P.current=r),[r]),eN.useLayoutEffect(()=>void(L.current=i),[i]),eN.useLayoutEffect(()=>void(k.current=n),[n]),eN.useLayoutEffect(()=>void(F.current=a),[a]),eN.useEffect(()=>{let e=e=>{C(),null==P.current||P.current(e)},t=e=>null==L.current?void 0:L.current(e),r=e=>null==k.current?void 0:k.current(e),i=e=>null==F.current?void 0:F.current(e);return B.addEventListener("change",e),B.addEventListener("mouseDown",t),B.addEventListener("mouseUp",r),B.addEventListener("objectChange",i),()=>{B.removeEventListener("change",e),B.removeEventListener("mouseDown",t),B.removeEventListener("mouseUp",r),B.removeEventListener("objectChange",i)}},[C,B]),eN.useEffect(()=>{if(o){let e=T().controls;return I({controls:B}),()=>I({controls:e})}},[o,B]),eN.createElement(eN.Fragment,null,eN.createElement("primitive",{ref:x,object:B,enabled:u,axis:c,mode:h,translationSnap:d,rotationSnap:f,scaleSnap:p,space:m,size:g,showX:A,showY:v,showZ:y}),eN.createElement("group",eU({ref:D},E),e))});var wV=Object.defineProperty,wW=(e,t,r)=>t in e?wV(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wj=(e,t,r)=>(wW(e,"symbol"!=typeof t?t+"":t,r),r);let wY=new ao(0,0,0,"YXZ"),wK=new ni,wq={type:"change"},wX={type:"lock"},w$={type:"unlock"},wJ=Math.PI/2;class wZ extends S8{constructor(e,t){super(),wj(this,"camera"),wj(this,"domElement"),wj(this,"isLocked"),wj(this,"minPolarAngle"),wj(this,"maxPolarAngle"),wj(this,"pointerSpeed"),wj(this,"onMouseMove",e=>{this.domElement&&!1!==this.isLocked&&(wY.setFromQuaternion(this.camera.quaternion),wY.y-=.002*e.movementX*this.pointerSpeed,wY.x-=.002*e.movementY*this.pointerSpeed,wY.x=Math.max(wJ-this.maxPolarAngle,Math.min(wJ-this.minPolarAngle,wY.x)),this.camera.quaternion.setFromEuler(wY),this.dispatchEvent(wq))}),wj(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(wX),this.isLocked=!0):(this.dispatchEvent(w$),this.isLocked=!1))}),wj(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),wj(this,"connect",e=>{this.domElement=e||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),wj(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),wj(this,"dispose",()=>{this.disconnect()}),wj(this,"getObject",()=>this.camera),wj(this,"direction",new ni(0,0,-1)),wj(this,"getDirection",e=>e.copy(this.direction).applyQuaternion(this.camera.quaternion)),wj(this,"moveForward",e=>{wK.setFromMatrixColumn(this.camera.matrix,0),wK.crossVectors(this.camera.up,wK),this.camera.position.addScaledVector(wK,e)}),wj(this,"moveRight",e=>{wK.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(wK,e)}),wj(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),wj(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}}let w0=eN.forwardRef(({domElement:e,selector:t,onChange:r,onLock:i,onUnlock:n,enabled:a=!0,makeDefault:s,...o},l)=>{let{camera:u,...c}=o,h=dY(e=>e.setEvents),d=dY(e=>e.gl),f=dY(e=>e.camera),p=dY(e=>e.invalidate),m=dY(e=>e.events),g=dY(e=>e.get),A=dY(e=>e.set),v=u||f,y=e||m.connected||d.domElement,E=eN.useMemo(()=>new wZ(v),[v]);return eN.useEffect(()=>{if(a){E.connect(y);let e=g().events.compute;return h({compute(e,t){let r=t.size.width/2,i=t.size.height/2;t.pointer.set(r/t.size.width*2-1,-(2*(i/t.size.height))+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{E.disconnect(),h({compute:e})}}},[a,E]),eN.useEffect(()=>{let e=e=>{p(),r&&r(e)};E.addEventListener("change",e),i&&E.addEventListener("lock",i),n&&E.addEventListener("unlock",n);let a=()=>E.lock(),s=t?Array.from(document.querySelectorAll(t)):[document];return s.forEach(e=>e&&e.addEventListener("click",a)),()=>{E.removeEventListener("change",e),i&&E.removeEventListener("lock",i),n&&E.removeEventListener("unlock",n),s.forEach(e=>e?e.removeEventListener("click",a):void 0)}},[r,i,n,t,E,p]),eN.useEffect(()=>{if(s){let e=g().controls;return A({controls:E}),()=>A({controls:e})}},[s,E]),eN.createElement("primitive",eU({ref:l,object:E},c))});var w1=Object.defineProperty,w2=(e,t,r)=>t in e?w1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,w3=(e,t,r)=>(w2(e,"symbol"!=typeof t?t+"":t,r),r);let w4=new ni;class w5 extends S8{constructor(e,t){super(),w3(this,"object"),w3(this,"domElement"),w3(this,"enabled",!0),w3(this,"movementSpeed",1),w3(this,"lookSpeed",.005),w3(this,"lookVertical",!0),w3(this,"autoForward",!1),w3(this,"activeLook",!0),w3(this,"heightSpeed",!1),w3(this,"heightCoef",1),w3(this,"heightMin",0),w3(this,"heightMax",1),w3(this,"constrainVertical",!1),w3(this,"verticalMin",0),w3(this,"verticalMax",Math.PI),w3(this,"mouseDragOn",!1),w3(this,"autoSpeedFactor",0),w3(this,"mouseX",0),w3(this,"mouseY",0),w3(this,"moveForward",!1),w3(this,"moveBackward",!1),w3(this,"moveLeft",!1),w3(this,"moveRight",!1),w3(this,"moveUp",!1),w3(this,"moveDown",!1),w3(this,"viewHalfX",0),w3(this,"viewHalfY",0),w3(this,"lat",0),w3(this,"lon",0),w3(this,"lookDirection",new ni),w3(this,"spherical",new hv),w3(this,"target",new ni),w3(this,"connect",e=>{e.setAttribute("tabindex","-1"),e.style.touchAction="none",e.addEventListener("contextmenu",this.contextmenu),e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),this.domElement=e,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize()}),w3(this,"dispose",()=>{var e,t,r,i;null==(e=this.domElement)||e.removeEventListener("contextmenu",this.contextmenu),null==(t=this.domElement)||t.removeEventListener("mousedown",this.onMouseDown),null==(r=this.domElement)||r.removeEventListener("mousemove",this.onMouseMove),null==(i=this.domElement)||i.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}),w3(this,"handleResize",()=>{this.domElement&&(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}),w3(this,"onMouseDown",e=>{var t;if(null==(t=this.domElement)||t.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}),w3(this,"onMouseUp",e=>{if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}),w3(this,"onMouseMove",e=>{this.domElement&&(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)}),w3(this,"onKeyDown",e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}),w3(this,"onKeyUp",e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}),w3(this,"lookAt",(e,t,r)=>(e instanceof ni?this.target.copy(e):t&&r&&this.target.set(e,t,r),this.object.lookAt(this.target),this.setOrientation(),this)),w3(this,"update",e=>{if(!this.enabled)return;if(this.heightSpeed){let t=ne.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;let t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let r=e*this.lookSpeed;this.activeLook||(r=0);let i=1;this.constrainVertical&&(i=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*r,this.lookVertical&&(this.lat-=this.mouseY*r*i),this.lat=Math.max(-85,Math.min(85,this.lat));let n=ne.degToRad(90-this.lat),a=ne.degToRad(this.lon);this.constrainVertical&&(n=ne.mapLinear(n,0,Math.PI,this.verticalMin,this.verticalMax));let s=this.object.position;w4.setFromSphericalCoords(1,n,a).add(s),this.object.lookAt(w4)}),w3(this,"contextmenu",e=>e.preventDefault()),w3(this,"setOrientation",()=>{this.lookDirection.set(0,0,-1).applyQuaternion(this.object.quaternion),this.spherical.setFromVector3(this.lookDirection),this.lat=90-ne.radToDeg(this.spherical.phi),this.lon=ne.radToDeg(this.spherical.theta)}),this.object=e,this.domElement=t,this.setOrientation(),t&&this.connect(t)}}let w6=eN.forwardRef(({domElement:e,makeDefault:t,...r},i)=>{let n=dY(e=>e.camera),a=dY(e=>e.gl),s=dY(e=>e.events),o=dY(e=>e.get),l=dY(e=>e.set),u=e||s.connected||a.domElement,[c]=eN.useState(()=>new w5(n,u));return eN.useEffect(()=>{if(t){let e=o().controls;return l({controls:c}),()=>l({controls:e})}},[t,c]),dK((e,t)=>{c.update(t)},-1),c?eN.createElement("primitive",eU({ref:i,object:c},r)):null}),w8={LEFT:1,RIGHT:2,MIDDLE:4},w9=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),w7={NONE:0,IN:1,OUT:-1};function Ce(e){return e.isPerspectiveCamera}function Ct(e){return e.isOrthographicCamera}let Cr=2*Math.PI,Ci=Math.PI/2,Cn=Math.PI/180;function Ca(e,t,r){return Math.max(t,Math.min(r,e))}function Cs(e,t=1e-5){return Math.abs(e)<t}function Co(e,t,r=1e-5){return Cs(e-t,r)}function Cl(e,t){return Math.round(e/t)*t}function Cu(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Cc(e){return Math.abs(e)<Number.MAX_VALUE?e:1/0*e}function Ch(e,t,r,i,n=1/0,a){let s=2/(i=Math.max(1e-4,i)),o=s*a,l=1/(1+o+.48*o*o+.235*o*o*o),u=e-t,c=t,h=n*i;t=e-(u=Ca(u,-h,h));let d=(r.value+s*u)*a;r.value=(r.value-s*d)*l;let f=t+(u+d)*l;return c-e>0==f>c&&(f=c,r.value=(f-c)/a),f}function Cd(e,t,r,i,n=1/0,a,s){let o=2/(i=Math.max(1e-4,i)),l=o*a,u=1/(1+l+.48*l*l+.235*l*l*l),c=t.x,h=t.y,d=t.z,f=e.x-c,p=e.y-h,m=e.z-d,g=c,A=h,v=d,y=n*i,E=f*f+p*p+m*m;if(E>y*y){let e=Math.sqrt(E);f=f/e*y,p=p/e*y,m=m/e*y}c=e.x-f,h=e.y-p,d=e.z-m;let x=(r.x+o*f)*a,_=(r.y+o*p)*a,b=(r.z+o*m)*a;r.x=(r.x-o*x)*u,r.y=(r.y-o*_)*u,r.z=(r.z-o*b)*u,s.x=c+(f+x)*u,s.y=h+(p+_)*u,s.z=d+(m+b)*u;let S=g-e.x,w=A-e.y,C=v-e.z;return S*(s.x-g)+w*(s.y-A)+C*(s.z-v)>0&&(s.x=g,s.y=A,s.z=v,r.x=(s.x-g)/a,r.y=(s.y-A)/a,r.z=(s.z-v)/a),s}function Cf(e,t){t.set(0,0),e.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=e.length,t.y/=e.length}function Cp(e,t){return!!Ct(e)&&(console.warn(`${t} is not supported in OrthographicCamera`),!0)}class Cm{constructor(){this._listeners={}}addEventListener(e,t){let r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){let r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){let r=this._listeners[e];if(void 0!==r){let e=r.indexOf(t);-1!==e&&r.splice(e,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){let t=this._listeners[e.type];if(void 0!==t){e.target=this;let r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e)}}}let Cg=1/8,CA=/Mac/.test(null===(eL=null==globalThis?void 0:globalThis.navigator)||void 0===eL?void 0:eL.platform);class Cv extends Cm{static install(e){A=Object.freeze(new(g=e.THREE).Vector3(0,0,0)),v=Object.freeze(new g.Vector3(0,1,0)),y=Object.freeze(new g.Vector3(0,0,1)),E=new g.Vector2,x=new g.Vector3,_=new g.Vector3,b=new g.Vector3,S=new g.Vector3,w=new g.Vector3,C=new g.Vector3,T=new g.Vector3,I=new g.Vector3,M=new g.Vector3,R=new g.Spherical,B=new g.Spherical,D=new g.Box3,P=new g.Box3,L=new g.Sphere,k=new g.Quaternion,F=new g.Quaternion,O=new g.Matrix4,U=new g.Raycaster}static get ACTION(){return w9}set verticalDragToForward(e){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=w9.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=w7.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new g.Vector3,this._focalOffsetVelocity=new g.Vector3,this._zoomVelocity={value:0},this._truckInternal=(e,t,r,i)=>{let n,a;if(Ce(this._camera)){let r=x.copy(this._camera.position).sub(this._target),i=this._camera.getEffectiveFOV()*Cn,s=r.length()*Math.tan(.5*i);n=this.truckSpeed*e*s/this._elementRect.height,a=this.truckSpeed*t*s/this._elementRect.height}else{if(!Ct(this._camera))return;let r=this._camera;n=this.truckSpeed*e*(r.right-r.left)/r.zoom/this._elementRect.width,a=this.truckSpeed*t*(r.top-r.bottom)/r.zoom/this._elementRect.height}i?(r?this.setFocalOffset(this._focalOffsetEnd.x+n,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(n,0,!0),this.forward(-a,!0)):r?this.setFocalOffset(this._focalOffsetEnd.x+n,this._focalOffsetEnd.y+a,this._focalOffsetEnd.z,!0):this.truck(n,a,!0)},this._rotateInternal=(e,t)=>{let r=Cr*this.azimuthRotateSpeed*e/this._elementRect.height,i=Cr*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(r,i,!0)},this._dollyInternal=(e,t,r)=>{let i=Math.pow(.95,-e*this.dollySpeed),n=this._sphericalEnd.radius,a=this._sphericalEnd.radius*i,s=Ca(a,this.minDistance,this.maxDistance);this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(a,!0):(this.infinityDolly&&!this.dollyToCursor&&this.dollyInFixed(s-a,!0),this._dollyToNoClamp(s,!0)),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?a:s)-n,this._dollyControlCoord.set(t,r)),this._lastDollyDirection=Math.sign(-e)},this._zoomInternal=(e,t,r)=>{let i=Math.pow(.95,e*this.dollySpeed),n=this._zoom,a=this._zoom*i;this.zoomTo(a,!0),this.dollyToCursor&&(this._changedZoom+=a-n,this._dollyControlCoord.set(t,r))},void 0===g&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new g.Quaternion().setFromUnitVectors(this._camera.up,v),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=w9.NONE,this._target=new g.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new g.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new g.Spherical().setFromVector3(x.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new g.Vector3,new g.Vector3,new g.Vector3,new g.Vector3],this._updateNearPlaneCorners(),this._boundary=new g.Box3(new g.Vector3(-1/0,-1/0,-1/0),new g.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new g.Vector2,this.mouseButtons={left:w9.ROTATE,middle:w9.DOLLY,right:w9.TRUCK,wheel:Ce(this._camera)?w9.DOLLY:Ct(this._camera)?w9.ZOOM:w9.NONE},this.touches={one:w9.TOUCH_ROTATE,two:Ce(this._camera)?w9.TOUCH_DOLLY_TRUCK:Ct(this._camera)?w9.TOUCH_ZOOM_TRUCK:w9.NONE,three:w9.TOUCH_TRUCK};let r=new g.Vector2,i=new g.Vector2,n=new g.Vector2,a=e=>{if(!this._enabled||!this._domElement)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let t=this._domElement.getBoundingClientRect(),r=e.clientX/t.width,i=e.clientY/t.height;if(r<this._interactiveArea.left||r>this._interactiveArea.right||i<this._interactiveArea.top||i>this._interactiveArea.bottom)return}let t="mouse"!==e.pointerType?null:(e.buttons&w8.LEFT)===w8.LEFT?w8.LEFT:(e.buttons&w8.MIDDLE)===w8.MIDDLE?w8.MIDDLE:(e.buttons&w8.RIGHT)===w8.RIGHT?w8.RIGHT:null;if(null!==t){let e=this._findPointerByMouseButton(t);e&&this._disposePointer(e)}if((e.buttons&w8.LEFT)===w8.LEFT&&this._lockedPointer)return;let r={pointerId:e.pointerId,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:t};this._activePointers.push(r),this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",o),this._domElement.ownerDocument.addEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",o),this._isDragging=!0,h(e)},s=e=>{e.cancelable&&e.preventDefault();let t=e.pointerId,r=this._lockedPointer||this._findPointerById(t);if(r){if(r.clientX=e.clientX,r.clientY=e.clientY,r.deltaX=e.movementX,r.deltaY=e.movementY,this._state=0,"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(e.buttons&w8.LEFT)===w8.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(e.buttons&w8.MIDDLE)===w8.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(e.buttons&w8.RIGHT)===w8.RIGHT&&(this._state=this._state|this.mouseButtons.right);d()}},o=e=>{let t=this._findPointerById(e.pointerId);if(!t||t!==this._lockedPointer){if(t&&this._disposePointer(t),"touch"===e.pointerType)switch(this._activePointers.length){case 0:this._state=w9.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=w9.NONE;f()}},l=-1,u=e=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===w9.NONE)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let t=this._domElement.getBoundingClientRect(),r=e.clientX/t.width,i=e.clientY/t.height;if(r<this._interactiveArea.left||r>this._interactiveArea.right||i<this._interactiveArea.top||i>this._interactiveArea.bottom)return}if(e.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===w9.ROTATE||this.mouseButtons.wheel===w9.TRUCK){let e=performance.now();l-e<1e3&&this._getClientRect(this._elementRect),l=e}let t=CA?-1:-3,r=1===e.deltaMode||e.ctrlKey?e.deltaY/t:e.deltaY/(10*t),i=this.dollyToCursor?(e.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,n=this.dollyToCursor?-((e.clientY-this._elementRect.y)/this._elementRect.height*2)+1:0;switch(this.mouseButtons.wheel){case w9.ROTATE:this._rotateInternal(e.deltaX,e.deltaY),this._isUserControllingRotate=!0;break;case w9.TRUCK:this._truckInternal(e.deltaX,e.deltaY,!1,!1),this._isUserControllingTruck=!0;break;case w9.SCREEN_PAN:this._truckInternal(e.deltaX,e.deltaY,!1,!0),this._isUserControllingTruck=!0;break;case w9.OFFSET:this._truckInternal(e.deltaX,e.deltaY,!0,!1),this._isUserControllingOffset=!0;break;case w9.DOLLY:this._dollyInternal(-r,i,n),this._isUserControllingDolly=!0;break;case w9.ZOOM:this._zoomInternal(-r,i,n),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},c=e=>{if(this._domElement&&this._enabled){if(this.mouseButtons.right===Cv.ACTION.NONE){let t=e instanceof PointerEvent?e.pointerId:0,r=this._findPointerById(t);r&&this._disposePointer(r),this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",o);return}e.preventDefault()}},h=e=>{if(this._enabled){if(Cf(this._activePointers,E),this._getClientRect(this._elementRect),r.copy(E),i.copy(E),this._activePointers.length>=2){let e=E.x-this._activePointers[1].clientX,t=E.y-this._activePointers[1].clientY,r=Math.sqrt(e*e+t*t);n.set(0,r);let a=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,s=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(a,s)}if(this._state=0,e){if("pointerType"in e&&"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._lockedPointer||(e.buttons&w8.LEFT)!==w8.LEFT||(this._state=this._state|this.mouseButtons.left),(e.buttons&w8.MIDDLE)===w8.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(e.buttons&w8.RIGHT)===w8.RIGHT&&(this._state=this._state|this.mouseButtons.right)}else this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);((this._state&w9.ROTATE)===w9.ROTATE||(this._state&w9.TOUCH_ROTATE)===w9.TOUCH_ROTATE||(this._state&w9.TOUCH_DOLLY_ROTATE)===w9.TOUCH_DOLLY_ROTATE||(this._state&w9.TOUCH_ZOOM_ROTATE)===w9.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&w9.TRUCK)===w9.TRUCK||(this._state&w9.SCREEN_PAN)===w9.SCREEN_PAN||(this._state&w9.TOUCH_TRUCK)===w9.TOUCH_TRUCK||(this._state&w9.TOUCH_SCREEN_PAN)===w9.TOUCH_SCREEN_PAN||(this._state&w9.TOUCH_DOLLY_TRUCK)===w9.TOUCH_DOLLY_TRUCK||(this._state&w9.TOUCH_DOLLY_SCREEN_PAN)===w9.TOUCH_DOLLY_SCREEN_PAN||(this._state&w9.TOUCH_ZOOM_TRUCK)===w9.TOUCH_ZOOM_TRUCK||(this._state&w9.TOUCH_ZOOM_SCREEN_PAN)===w9.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&w9.DOLLY)===w9.DOLLY||(this._state&w9.TOUCH_DOLLY)===w9.TOUCH_DOLLY||(this._state&w9.TOUCH_DOLLY_TRUCK)===w9.TOUCH_DOLLY_TRUCK||(this._state&w9.TOUCH_DOLLY_SCREEN_PAN)===w9.TOUCH_DOLLY_SCREEN_PAN||(this._state&w9.TOUCH_DOLLY_OFFSET)===w9.TOUCH_DOLLY_OFFSET||(this._state&w9.TOUCH_DOLLY_ROTATE)===w9.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&w9.ZOOM)===w9.ZOOM||(this._state&w9.TOUCH_ZOOM)===w9.TOUCH_ZOOM||(this._state&w9.TOUCH_ZOOM_TRUCK)===w9.TOUCH_ZOOM_TRUCK||(this._state&w9.TOUCH_ZOOM_SCREEN_PAN)===w9.TOUCH_ZOOM_SCREEN_PAN||(this._state&w9.TOUCH_ZOOM_OFFSET)===w9.TOUCH_ZOOM_OFFSET||(this._state&w9.TOUCH_ZOOM_ROTATE)===w9.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&w9.OFFSET)===w9.OFFSET||(this._state&w9.TOUCH_OFFSET)===w9.TOUCH_OFFSET||(this._state&w9.TOUCH_DOLLY_OFFSET)===w9.TOUCH_DOLLY_OFFSET||(this._state&w9.TOUCH_ZOOM_OFFSET)===w9.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},d=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Cf(this._activePointers,E);let e=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,t=e?-e.deltaX:i.x-E.x,a=e?-e.deltaY:i.y-E.y;if(i.copy(E),((this._state&w9.ROTATE)===w9.ROTATE||(this._state&w9.TOUCH_ROTATE)===w9.TOUCH_ROTATE||(this._state&w9.TOUCH_DOLLY_ROTATE)===w9.TOUCH_DOLLY_ROTATE||(this._state&w9.TOUCH_ZOOM_ROTATE)===w9.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(t,a),this._isUserControllingRotate=!0),(this._state&w9.DOLLY)===w9.DOLLY||(this._state&w9.ZOOM)===w9.ZOOM){let e=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,t=this.dollyToCursor?-((r.y-this._elementRect.y)/this._elementRect.height*2)+1:0,i=this.dollyDragInverted?-1:1;(this._state&w9.DOLLY)===w9.DOLLY?(this._dollyInternal(i*a*Cg,e,t),this._isUserControllingDolly=!0):(this._zoomInternal(i*a*Cg,e,t),this._isUserControllingZoom=!0)}if((this._state&w9.TOUCH_DOLLY)===w9.TOUCH_DOLLY||(this._state&w9.TOUCH_ZOOM)===w9.TOUCH_ZOOM||(this._state&w9.TOUCH_DOLLY_TRUCK)===w9.TOUCH_DOLLY_TRUCK||(this._state&w9.TOUCH_ZOOM_TRUCK)===w9.TOUCH_ZOOM_TRUCK||(this._state&w9.TOUCH_DOLLY_SCREEN_PAN)===w9.TOUCH_DOLLY_SCREEN_PAN||(this._state&w9.TOUCH_ZOOM_SCREEN_PAN)===w9.TOUCH_ZOOM_SCREEN_PAN||(this._state&w9.TOUCH_DOLLY_OFFSET)===w9.TOUCH_DOLLY_OFFSET||(this._state&w9.TOUCH_ZOOM_OFFSET)===w9.TOUCH_ZOOM_OFFSET||(this._state&w9.TOUCH_DOLLY_ROTATE)===w9.TOUCH_DOLLY_ROTATE||(this._state&w9.TOUCH_ZOOM_ROTATE)===w9.TOUCH_ZOOM_ROTATE){let e=E.x-this._activePointers[1].clientX,t=E.y-this._activePointers[1].clientY,r=Math.sqrt(e*e+t*t),a=n.y-r;n.set(0,r);let s=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,o=this.dollyToCursor?-((i.y-this._elementRect.y)/this._elementRect.height*2)+1:0;(this._state&w9.TOUCH_DOLLY)===w9.TOUCH_DOLLY||(this._state&w9.TOUCH_DOLLY_ROTATE)===w9.TOUCH_DOLLY_ROTATE||(this._state&w9.TOUCH_DOLLY_TRUCK)===w9.TOUCH_DOLLY_TRUCK||(this._state&w9.TOUCH_DOLLY_SCREEN_PAN)===w9.TOUCH_DOLLY_SCREEN_PAN||(this._state&w9.TOUCH_DOLLY_OFFSET)===w9.TOUCH_DOLLY_OFFSET?(this._dollyInternal(a*Cg,s,o),this._isUserControllingDolly=!0):(this._zoomInternal(a*Cg,s,o),this._isUserControllingZoom=!0)}((this._state&w9.TRUCK)===w9.TRUCK||(this._state&w9.TOUCH_TRUCK)===w9.TOUCH_TRUCK||(this._state&w9.TOUCH_DOLLY_TRUCK)===w9.TOUCH_DOLLY_TRUCK||(this._state&w9.TOUCH_ZOOM_TRUCK)===w9.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(t,a,!1,!1),this._isUserControllingTruck=!0),((this._state&w9.SCREEN_PAN)===w9.SCREEN_PAN||(this._state&w9.TOUCH_SCREEN_PAN)===w9.TOUCH_SCREEN_PAN||(this._state&w9.TOUCH_DOLLY_SCREEN_PAN)===w9.TOUCH_DOLLY_SCREEN_PAN||(this._state&w9.TOUCH_ZOOM_SCREEN_PAN)===w9.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(t,a,!1,!0),this._isUserControllingTruck=!0),((this._state&w9.OFFSET)===w9.OFFSET||(this._state&w9.TOUCH_OFFSET)===w9.TOUCH_OFFSET||(this._state&w9.TOUCH_DOLLY_OFFSET)===w9.TOUCH_DOLLY_OFFSET||(this._state&w9.TOUCH_ZOOM_OFFSET)===w9.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(t,a,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},f=()=>{Cf(this._activePointers,E),i.copy(E),this._dragNeedsUpdate=!1,(0===this._activePointers.length||1===this._activePointers.length&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),0===this._activePointers.length&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",o),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{this._enabled&&this._domElement&&(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",o),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",p),this._domElement.ownerDocument.addEventListener("pointerlockerror",m),this._domElement.ownerDocument.addEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",o),h())},this.unlockPointer=()=>{var e,t,r;null!==this._lockedPointer&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),null===(e=this._domElement)||void 0===e||e.ownerDocument.exitPointerLock(),null===(t=this._domElement)||void 0===t||t.ownerDocument.removeEventListener("pointerlockchange",p),null===(r=this._domElement)||void 0===r||r.ownerDocument.removeEventListener("pointerlockerror",m),this.cancel()};let p=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},m=()=>{this.unlockPointer()};this._addAllEventListeners=e=>{this._domElement=e,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",a),this._domElement.addEventListener("pointercancel",o),this._domElement.addEventListener("wheel",u,{passive:!1}),this._domElement.addEventListener("contextmenu",c)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",a),this._domElement.removeEventListener("pointercancel",o),this._domElement.removeEventListener("wheel",u,{passive:!1}),this._domElement.removeEventListener("contextmenu",c),this._domElement.ownerDocument.removeEventListener("pointermove",s,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",o),this._domElement.ownerDocument.removeEventListener("pointerlockchange",p),this._domElement.ownerDocument.removeEventListener("pointerlockerror",m))},this.cancel=()=>{this._state!==w9.NONE&&(this._state=w9.NONE,this._activePointers.length=0,f())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){(this._spherical.radius!==e||this._sphericalEnd.radius!==e)&&(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){(this._spherical.theta!==e||this._sphericalEnd.theta!==e)&&(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){(this._spherical.phi!==e||this._sphericalEnd.phi!==e)&&(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Ca(e.width,0,1),this._interactiveArea.height=Ca(e.height,0,1),this._interactiveArea.x=Ca(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Ca(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,r=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,r)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,r=!1){this._isUserControllingRotate=!1;let i=Ca(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=Ca(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,r||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);let a=!r||Co(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Co(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=w7.NONE,this._changedDolly=0,this._dollyToNoClamp(Ca(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){let r=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){let t=this._collisionTest(),i=Co(t,this._spherical.radius);if(!(r>e)&&i)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,t)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);let i=!t||Co(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(S).multiplyScalar(e)),t||this._target.copy(this._targetEnd);let r=!t||Co(this._target.x,this._targetEnd.x,this.restThreshold)&&Co(this._target.y,this._targetEnd.y,this.restThreshold)&&Co(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Ca(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);let r=!t||Co(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(r)}pan(e,t,r=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,r)}truck(e,t,r=!1){this._camera.updateMatrix(),w.setFromMatrixColumn(this._camera.matrix,0),C.setFromMatrixColumn(this._camera.matrix,1),w.multiplyScalar(e),C.multiplyScalar(-t);let i=x.copy(w).add(C),n=_.copy(this._targetEnd).add(i);return this.moveTo(n.x,n.y,n.z,r)}forward(e,t=!1){x.setFromMatrixColumn(this._camera.matrix,0),x.crossVectors(this._camera.up,x),x.multiplyScalar(e);let r=_.copy(this._targetEnd).add(x);return this.moveTo(r.x,r.y,r.z,t)}elevate(e,t=!1){return x.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+x.x,this._targetEnd.y+x.y,this._targetEnd.z+x.z,t)}moveTo(e,t,r,i=!1){this._isUserControllingTruck=!1;let n=x.set(e,t,r).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);let a=!i||Co(this._target.x,this._targetEnd.x,this.restThreshold)&&Co(this._target.y,this._targetEnd.y,this.restThreshold)&&Co(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(e,t,r,i=!1){let n=x.set(e,t,r).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(n.x,n.y,n.z,i)}fitToBox(e,t,{cover:r=!1,paddingLeft:i=0,paddingRight:n=0,paddingBottom:a=0,paddingTop:s=0}={}){let o=[],l=e.isBox3?D.copy(e):D.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());let u=Cl(this._sphericalEnd.theta,Ci),c=Cl(this._sphericalEnd.phi,Ci);o.push(this.rotateTo(u,c,t));let h=x.setFromSpherical(this._sphericalEnd).normalize(),d=k.setFromUnitVectors(h,y),f=Co(Math.abs(h.y),1);f&&d.multiply(F.setFromAxisAngle(v,u)),d.multiply(this._yAxisUpSpaceInverse);let p=P.makeEmpty();_.copy(l.min).applyQuaternion(d),p.expandByPoint(_),_.copy(l.min).setX(l.max.x).applyQuaternion(d),p.expandByPoint(_),_.copy(l.min).setY(l.max.y).applyQuaternion(d),p.expandByPoint(_),_.copy(l.max).setZ(l.min.z).applyQuaternion(d),p.expandByPoint(_),_.copy(l.min).setZ(l.max.z).applyQuaternion(d),p.expandByPoint(_),_.copy(l.max).setY(l.min.y).applyQuaternion(d),p.expandByPoint(_),_.copy(l.max).setX(l.min.x).applyQuaternion(d),p.expandByPoint(_),_.copy(l.max).applyQuaternion(d),p.expandByPoint(_),p.min.x-=i,p.min.y-=a,p.max.x+=n,p.max.y+=s,d.setFromUnitVectors(y,h),f&&d.premultiply(F.invert()),d.premultiply(this._yAxisUpSpace);let m=p.getSize(x),g=p.getCenter(_).applyQuaternion(d);if(Ce(this._camera)){let e=this.getDistanceToFitBox(m.x,m.y,m.z,r);o.push(this.moveTo(g.x,g.y,g.z,t)),o.push(this.dollyTo(e,t)),o.push(this.setFocalOffset(0,0,0,t))}else if(Ct(this._camera)){let e=this._camera,i=e.right-e.left,n=e.top-e.bottom,a=r?Math.max(i/m.x,n/m.y):Math.min(i/m.x,n/m.y);o.push(this.moveTo(g.x,g.y,g.z,t)),o.push(this.zoomTo(a,t)),o.push(this.setFocalOffset(0,0,0,t))}return Promise.all(o)}fitToSphere(e,t){let r=[],i="isObject3D"in e?Cv.createBoundingSphere(e,L):L.copy(e);if(r.push(this.moveTo(i.center.x,i.center.y,i.center.z,t)),Ce(this._camera)){let e=this.getDistanceToFitSphere(i.radius);r.push(this.dollyTo(e,t))}else if(Ct(this._camera)){let e=this._camera.right-this._camera.left,n=this._camera.top-this._camera.bottom,a=2*i.radius,s=Math.min(e/a,n/a);r.push(this.zoomTo(s,t))}return r.push(this.setFocalOffset(0,0,0,t)),Promise.all(r)}setLookAt(e,t,r,i,n,a,s=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=w7.NONE,this._changedDolly=0;let o=_.set(i,n,a),l=x.set(e,t,r);this._targetEnd.copy(o),this._sphericalEnd.setFromVector3(l.sub(o).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,s||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let u=!s||Co(this._target.x,this._targetEnd.x,this.restThreshold)&&Co(this._target.y,this._targetEnd.y,this.restThreshold)&&Co(this._target.z,this._targetEnd.z,this.restThreshold)&&Co(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Co(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Co(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerpLookAt(e,t,r,i,n,a,s,o,l,u,c,h,d,f=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=w7.NONE,this._changedDolly=0;let p=x.set(i,n,a),m=_.set(e,t,r);R.setFromVector3(m.sub(p).applyQuaternion(this._yAxisUpSpace));let g=b.set(u,c,h),A=_.set(s,o,l);B.setFromVector3(A.sub(g).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(p.lerp(g,d));let v=B.theta-R.theta,y=B.phi-R.phi,E=B.radius-R.radius;this._sphericalEnd.set(R.radius+E*d,R.phi+y*d,R.theta+v*d),this.normalizeRotations(),this._needsUpdate=!0,f||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let S=!f||Co(this._target.x,this._targetEnd.x,this.restThreshold)&&Co(this._target.y,this._targetEnd.y,this.restThreshold)&&Co(this._target.z,this._targetEnd.z,this.restThreshold)&&Co(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Co(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Co(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(S)}setPosition(e,t,r,i=!1){return this.setLookAt(e,t,r,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,r,i=!1){let n=this.getPosition(x),a=this.setLookAt(n.x,n.y,n.z,e,t,r,i);return this._sphericalEnd.phi=Ca(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(e,t,r,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,r),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);let n=!i||Co(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Co(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Co(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,r){this._camera.updateMatrixWorld(),w.setFromMatrixColumn(this._camera.matrixWorldInverse,0),C.setFromMatrixColumn(this._camera.matrixWorldInverse,1),T.setFromMatrixColumn(this._camera.matrixWorldInverse,2);let i=x.set(e,t,r),n=i.distanceTo(this._camera.position),a=i.sub(this._camera.position);w.multiplyScalar(a.x),C.multiplyScalar(a.y),T.multiplyScalar(a.z),x.copy(w).add(C).add(T),x.z=x.z+n,this.dollyTo(n,!1),this.setFocalOffset(-x.x,x.y,-x.z,!1),this.moveTo(e,t,r,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,r,i){if(null===e){this._viewport=null;return}this._viewport=this._viewport||new g.Vector4,"number"==typeof e?this._viewport.set(e,t,r,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,r,i=!1){if(Cp(this._camera,"getDistanceToFitBox"))return this._spherical.radius;let n=e/t,a=this._camera.getEffectiveFOV()*Cn,s=this._camera.aspect;return .5*((i?n>s:n<s)?t:e/s)/Math.tan(.5*a)+.5*r}getDistanceToFitSphere(e){if(Cp(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;let t=this._camera.getEffectiveFOV()*Cn,r=2*Math.atan(Math.tan(.5*t)*this._camera.aspect);return e/Math.sin(.5*(1<this._camera.aspect?t:r))}getTarget(e,t=!0){return(e&&e.isVector3?e:new g.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new g.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new g.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new g.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Cr,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Cr),this._spherical.theta+=Cr*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Cr)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!Co(this._camera.up.x,this._cameraUp0.x)||!Co(this._camera.up.y,this._cameraUp0.y)||!Co(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);let e=this.getPosition(x);this.updateCameraUp(),this.setPosition(e.x,e.y,e.z)}return Promise.all([this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)])}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,v),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){let e=x.subVectors(this._target,this._camera.position).normalize(),t=_.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();let r=this.getPosition(x);this.updateCameraUp(),this.setPosition(r.x,r.y,r.z)}update(e){let t=this._sphericalEnd.theta-this._spherical.theta,r=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,n=I.subVectors(this._targetEnd,this._target),a=M.subVectors(this._focalOffsetEnd,this._focalOffset),s=this._zoomEnd-this._zoom;if(Cs(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{let t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Ch(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,t,1/0,e),this._needsUpdate=!0}if(Cs(r))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{let t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Ch(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,t,1/0,e),this._needsUpdate=!0}if(Cs(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{let t=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Ch(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,t,this.maxSpeed,e),this._needsUpdate=!0}if(Cs(n.x)&&Cs(n.y)&&Cs(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{let t=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Cd(this._target,this._targetEnd,this._targetVelocity,t,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(Cs(a.x)&&Cs(a.y)&&Cs(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{let t=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Cd(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,t,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(Cs(s))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{let t=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Ch(this._zoom,this._zoomEnd,this._zoomVelocity,t,1/0,e)}if(this.dollyToCursor){if(Ce(this._camera)&&0!==this._changedDolly){let e=this._spherical.radius-this._lastDistance,t=this._camera,r=this._getCameraDirection(S),i=x.copy(r).cross(t.up).normalize();0===i.lengthSq()&&(i.x=1);let n=_.crossVectors(i,r),a=this._sphericalEnd.radius*Math.tan(t.getEffectiveFOV()*Cn*.5),s=(this._sphericalEnd.radius-e-this._sphericalEnd.radius)/this._sphericalEnd.radius,o=b.copy(this._targetEnd).add(i.multiplyScalar(this._dollyControlCoord.x*a*t.aspect)).add(n.multiplyScalar(this._dollyControlCoord.y*a)),l=x.copy(this._targetEnd).lerp(o,s),u=this._lastDollyDirection===w7.IN&&this._spherical.radius<=this.minDistance,c=this._lastDollyDirection===w7.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(u||c)){this._sphericalEnd.radius-=e,this._spherical.radius-=e;let t=_.copy(r).multiplyScalar(-e);l.add(t)}this._boundary.clampPoint(l,l);let h=_.subVectors(l,this._targetEnd);this._targetEnd.copy(l),this._target.add(h),this._changedDolly-=e,Cs(this._changedDolly)&&(this._changedDolly=0)}else if(Ct(this._camera)&&0!==this._changedZoom){let e=this._zoom-this._lastZoom,t=this._camera,r=x.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(t.near+t.far)/(t.near-t.far)).unproject(t),i=_.set(0,0,-1).applyQuaternion(t.quaternion),n=b.copy(r).add(i.multiplyScalar(-r.dot(t.up))),a=-(this._zoom-e-this._zoom)/this._zoom,s=this._getCameraDirection(S),o=this._targetEnd.dot(s),l=x.copy(this._targetEnd).lerp(n,a),u=l.dot(s),c=s.multiplyScalar(u-o);l.sub(c),this._boundary.clampPoint(l,l);let h=_.subVectors(l,this._targetEnd);this._targetEnd.copy(l),this._target.add(h),this._changedZoom-=e,Cs(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;let o=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,o),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),Cs(this._focalOffset.x)&&Cs(this._focalOffset.y)&&Cs(this._focalOffset.z)||(w.setFromMatrixColumn(this._camera.matrix,0),C.setFromMatrixColumn(this._camera.matrix,1),T.setFromMatrixColumn(this._camera.matrix,2),w.multiplyScalar(this._focalOffset.x),C.multiplyScalar(-this._focalOffset.y),T.multiplyScalar(this._focalOffset.z),x.copy(w).add(C).add(T),this._camera.position.add(x),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),x.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);let l=this._needsUpdate;return l&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):l?(this.dispatchEvent({type:"update"}),Cs(t,this.restThreshold)&&Cs(r,this.restThreshold)&&Cs(i,this.restThreshold)&&Cs(n.x,this.restThreshold)&&Cs(n.y,this.restThreshold)&&Cs(n.z,this.restThreshold)&&Cs(a.x,this.restThreshold)&&Cs(a.y,this.restThreshold)&&Cs(a.z,this.restThreshold)&&Cs(s,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!l&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=l,this._needsUpdate=!1,l}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Cu(this.maxDistance),minZoom:this.minZoom,maxZoom:Cu(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Cu(this.maxPolarAngle),minAzimuthAngle:Cu(this.minAzimuthAngle),maxAzimuthAngle:Cu(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:x.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){let r=JSON.parse(e);this.enabled=r.enabled,this.minDistance=r.minDistance,this.maxDistance=Cc(r.maxDistance),this.minZoom=r.minZoom,this.maxZoom=Cc(r.maxZoom),this.minPolarAngle=r.minPolarAngle,this.maxPolarAngle=Cc(r.maxPolarAngle),this.minAzimuthAngle=Cc(r.minAzimuthAngle),this.maxAzimuthAngle=Cc(r.maxAzimuthAngle),this.smoothTime=r.smoothTime,this.draggingSmoothTime=r.draggingSmoothTime,this.dollySpeed=r.dollySpeed,this.truckSpeed=r.truckSpeed,this.dollyToCursor=r.dollyToCursor,this._target0.fromArray(r.target0),this._position0.fromArray(r.position0),this._zoom0=r.zoom0,this._focalOffset0.fromArray(r.focalOffset0),this.moveTo(r.target[0],r.target[1],r.target[2],t),R.setFromVector3(x.fromArray(r.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(R.theta,R.phi,t),this.dollyTo(R.radius,t),this.zoomTo(r.zoom,t),this.setFocalOffset(r.focalOffset[0],r.focalOffset[1],r.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version","2.10.1"),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,r){let i=t.lengthSq();if(0===i)return e;let n=_.copy(t).add(e),a=this._boundary.clampPoint(n,b).sub(n),s=a.lengthSq();if(0===s)return e.add(t);if(s===i)return e;if(0===r)return e.add(t).add(a);{let i=1+r*s/t.dot(a);return e.add(_.copy(t).multiplyScalar(i)).add(a.multiplyScalar(1-r))}}_updateNearPlaneCorners(){if(Ce(this._camera)){let e=this._camera,t=e.near,r=Math.tan(.5*(e.getEffectiveFOV()*Cn))*t,i=r*e.aspect;this._nearPlaneCorners[0].set(-i,-r,0),this._nearPlaneCorners[1].set(i,-r,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(-i,r,0)}else if(Ct(this._camera)){let e=this._camera,t=1/e.zoom,r=e.left*t,i=e.right*t,n=e.top*t,a=e.bottom*t;this._nearPlaneCorners[0].set(r,n,0),this._nearPlaneCorners[1].set(i,n,0),this._nearPlaneCorners[2].set(i,a,0),this._nearPlaneCorners[3].set(r,a,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Cp(this._camera,"_collisionTest"))return e;let t=this._getTargetDirection(S);O.lookAt(A,t,this._camera.up);for(let r=0;r<4;r++){let i=_.copy(this._nearPlaneCorners[r]);i.applyMatrix4(O);let n=b.addVectors(this._target,i);U.set(n,t),U.far=this._spherical.radius+1;let a=U.intersectObjects(this.colliderMeshes);0!==a.length&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;let t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{let t=()=>{this.removeEventListener("rest",t),e()};this.addEventListener("rest",t)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new g.Sphere){let r=t.center;D.makeEmpty(),e.traverseVisible(e=>{e.isMesh&&D.expandByObject(e)}),D.getCenter(r);let i=0;return e.traverseVisible(e=>{if(!e.isMesh||!e.geometry)return;let t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);let n=t.attributes.position;for(let e=0,t=n.count;e<t;e++)x.fromBufferAttribute(n,e),i=Math.max(i,r.distanceToSquared(x))}),t.radius=Math.sqrt(i),t}}let Cy=(0,eN.forwardRef)((e,t)=>{(0,eN.useMemo)(()=>{let e={Box3:nL,MathUtils:{clamp:ne.clamp},Matrix4:n8,Quaternion:nr,Raycaster:hf,Sphere:nJ,Spherical:hv,Vector2:nt,Vector3:ni,Vector4:nT};Cv.install({THREE:e}),dp({CameraControlsImpl:Cv})},[]);let{camera:r,domElement:i,makeDefault:n,onStart:a,onEnd:s,onChange:o,regress:l,...u}=e,c=dY(e=>e.camera),h=dY(e=>e.gl),d=dY(e=>e.invalidate),f=dY(e=>e.events),p=dY(e=>e.setEvents),m=dY(e=>e.set),g=dY(e=>e.get),A=dY(e=>e.performance),v=r||c,y=i||f.connected||h.domElement,E=(0,eN.useMemo)(()=>new Cv(v),[v]);return dK((e,t)=>{E.enabled&&E.update(t)},-1),(0,eN.useEffect)(()=>(E.connect(y),()=>void E.disconnect()),[y,E]),(0,eN.useEffect)(()=>{let e=e=>{d(),l&&A.regress(),o&&o(e)},t=e=>{a&&a(e)},r=e=>{s&&s(e)};return E.addEventListener("update",e),E.addEventListener("controlstart",t),E.addEventListener("controlend",r),E.addEventListener("control",e),E.addEventListener("transitionstart",e),E.addEventListener("wake",e),()=>{E.removeEventListener("update",e),E.removeEventListener("controlstart",t),E.removeEventListener("controlend",r),E.removeEventListener("control",e),E.removeEventListener("transitionstart",e),E.removeEventListener("wake",e)}},[E,a,s,d,p,l,o]),(0,eN.useEffect)(()=>{if(n){let e=g().controls;return m({controls:E}),()=>m({controls:e})}},[n,E]),eN.createElement("primitive",eU({ref:t,object:E},u))}),CE=e=>(null==e?void 0:e.current)instanceof aS,Cx=eN.createContext(null);function C_(){let e=eN.useContext(Cx);if(!e)throw Error("useMotion hook must be used in a MotionPathControls component.");return e}function Cb({points:e=50,color:t="black"}){let{path:r}=C_(),[i,n]=eN.useState([]),a=eN.useMemo(()=>new aY({color:t}),[t]),s=eN.useMemo(()=>new ug(.025,16,16),[]),o=eN.useRef([]);return eN.useEffect(()=>{r.curves!==o.current&&(n(r.getPoints(e)),o.current=r.curves)}),i.map((e,t)=>eN.createElement("mesh",{key:t,material:a,geometry:s,position:[e.x,e.y,e.z]}))}let CS=eN.forwardRef(({children:e,curves:t=[],debug:r=!1,debugColor:i="black",object:n,focus:a,loop:s=!0,offset:o,smooth:l=!1,eps:u=1e-5,damping:c=.1,focusDamping:h=.1,maxSpeed:d=1/0,...f},p)=>{let{camera:m}=dY(),g=eN.useRef(null),A=eN.useRef(null!=o?o:0),v=eN.useMemo(()=>new lq,[]),y=eN.useMemo(()=>({focus:a,object:(null==n?void 0:n.current)instanceof aS?n:{current:m},path:v,current:A.current,offset:A.current,point:new ni,tangent:new ni,next:new ni}),[a,n]);eN.useLayoutEffect(()=>{var e,r;v.curves=[];let i=t.length>0?t:null!==(e=null==(r=g.current)||null==(r=r.__r3f)?void 0:r.objects)&&void 0!==e?e:[];for(let e=0;e<i.length;e++)v.add(i[e]);if(l){let e=new lO(v.getPoints("number"==typeof l?l:1));v.curves=[e]}v.updateArcLengths()}),eN.useImperativeHandle(p,()=>Object.assign(g.current,{motion:y}),[y]),eN.useLayoutEffect(()=>{A.current=pG.repeat(A.current,1)},[o]);let E=eN.useMemo(()=>new ni,[]);return dK((e,t)=>{let r=y.offset;if(mu.damp(A,"current",void 0!==o?o:y.current,c,t,d,void 0,u),y.offset=s?pG.repeat(A.current,1):pG.clamp(A.current,0,1),v.getCurveLengths().length>0){v.getPointAt(y.offset,y.point),v.getTangentAt(y.offset,y.tangent).normalize(),v.getPointAt(pG.repeat(A.current-(r-y.offset),1),y.next);let e=(null==n?void 0:n.current)instanceof aS?n.current:m;e.position.copy(y.point),a&&mu.dampLookAt(e,CE(a)?a.current.getWorldPosition(E):a,h,t,d,void 0,u)}}),eN.createElement("group",eU({ref:g},f),eN.createElement(Cx.Provider,{value:y},e,r&&eN.createElement(Cb,{color:i})))});function Cw({defaultScene:e,defaultCamera:t,renderPriority:r=1}){let i;let{gl:n,scene:a,camera:s}=dY();return dK(()=>{i=n.autoClear,1===r&&(n.autoClear=!0,n.render(e,t)),n.autoClear=!1,n.clearDepth(),n.render(a,s),n.autoClear=i},r),eN.createElement("group",{onPointerOver:()=>null})}function CC({children:e,renderPriority:t=1}){let{scene:r,camera:i}=dY(),[n]=eN.useState(()=>new sG);return eN.createElement(eN.Fragment,null,d2(eN.createElement(eN.Fragment,null,e,eN.createElement(Cw,{defaultScene:r,defaultCamera:i,renderPriority:t})),n,{events:{priority:t+1}}))}let CT=eN.createContext({}),CI=()=>eN.useContext(CT),CM=2*Math.PI,CR=new aS,CB=new n8,[CD,CP]=[new nr,new nr],CL=new ni,Ck=new ni,CF=e=>"minPolarAngle"in e,CO=e=>"getTarget"in e,CU=({alignment:e="bottom-right",margin:t=[80,80],renderPriority:r=1,onUpdate:i,onTarget:n,children:a})=>{let s=dY(e=>e.size),o=dY(e=>e.camera),l=dY(e=>e.controls),u=dY(e=>e.invalidate),c=eN.useRef(null),h=eN.useRef(null),d=eN.useRef(!1),f=eN.useRef(0),p=eN.useRef(new ni(0,0,0)),m=eN.useRef(new ni(0,0,0));eN.useEffect(()=>{m.current.copy(o.up),CR.up.copy(o.up)},[o]);let g=eN.useCallback(e=>{d.current=!0,(l||n)&&(p.current=(null==n?void 0:n())||(CO(l)?l.getTarget(p.current):null==l?void 0:l.target)),f.current=o.position.distanceTo(CL),CD.copy(o.quaternion),Ck.copy(e).multiplyScalar(f.current).add(CL),CR.lookAt(Ck),CP.copy(CR.quaternion),u()},[l,o,n,u]);dK((e,t)=>{if(h.current&&c.current){var r;d.current&&(.01>CD.angleTo(CP)?(d.current=!1,CF(l)&&o.up.copy(m.current)):(CD.rotateTowards(CP,t*CM),o.position.set(0,0,1).applyQuaternion(CD).multiplyScalar(f.current).add(p.current),o.up.set(0,1,0).applyQuaternion(CD).normalize(),o.quaternion.copy(CD),CO(l)&&l.setPosition(o.position.x,o.position.y,o.position.z),i?i():l&&l.update(t),u())),CB.copy(o.matrix).invert(),null==(r=c.current)||r.quaternion.setFromRotationMatrix(CB)}});let A=eN.useMemo(()=>({tweenCamera:g}),[g]),[v,y]=t,E=e.endsWith("-center")?0:e.endsWith("-left")?-s.width/2+v:s.width/2-v,x=e.startsWith("center-")?0:e.startsWith("top-")?s.height/2-y:-s.height/2+y;return eN.createElement(CC,{renderPriority:r},eN.createElement(CT.Provider,{value:A},eN.createElement(SZ,{makeDefault:!0,ref:h,position:[0,0,200]}),eN.createElement("group",{ref:c,position:[E,x,0]},a)))},CN={bg:"#f0f0f0",hover:"#999",text:"black",stroke:"black"},Cz=["Right","Left","Top","Bottom","Front","Back"],CG=e=>new ni(...e).multiplyScalar(.38),CH=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(CG),CQ=[.25,.25,.25],CV=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(CG),CW=CV.map(e=>e.toArray().map(e=>0==e?.5:.25)),Cj=({hover:e,index:t,font:r="20px Inter var, Arial, sans-serif",faces:i=Cz,color:n=CN.bg,hoverColor:a=CN.hover,textColor:s=CN.text,strokeColor:o=CN.stroke,opacity:l=1})=>{let u=dY(e=>e.gl),c=eN.useMemo(()=>{let e=document.createElement("canvas");e.width=128,e.height=128;let a=e.getContext("2d");return a.fillStyle=n,a.fillRect(0,0,e.width,e.height),a.strokeStyle=o,a.strokeRect(0,0,e.width,e.height),a.font=r,a.textAlign="center",a.fillStyle=s,a.fillText(i[t].toUpperCase(),64,76),new lm(e)},[t,i,r,n,s,o]);return eN.createElement("meshBasicMaterial",{map:c,"map-anisotropy":u.capabilities.getMaxAnisotropy()||1,attach:`material-${t}`,color:e?a:"white",transparent:!0,opacity:l})},CY=e=>{let{tweenCamera:t}=CI(),[r,i]=eN.useState(null);return eN.createElement("mesh",{onPointerOut:e=>{e.stopPropagation(),i(null)},onPointerMove:e=>{e.stopPropagation(),i(Math.floor(e.faceIndex/2))},onClick:e.onClick||(e=>{e.stopPropagation(),t(e.face.normal)})},[...Array(6)].map((t,i)=>eN.createElement(Cj,eU({key:i,index:i,hover:r===i},e))),eN.createElement("boxGeometry",null))},CK=({onClick:e,dimensions:t,position:r,hoverColor:i=CN.hover})=>{let{tweenCamera:n}=CI(),[a,s]=eN.useState(!1);return eN.createElement("mesh",{scale:1.01,position:r,onPointerOver:e=>{e.stopPropagation(),s(!0)},onPointerOut:e=>{e.stopPropagation(),s(!1)},onClick:e||(e=>{e.stopPropagation(),n(r)})},eN.createElement("meshBasicMaterial",{color:a?i:"white",transparent:!0,opacity:.6,visible:a}),eN.createElement("boxGeometry",{args:t}))},Cq=e=>eN.createElement("group",{scale:[60,60,60]},eN.createElement(CY,e),CV.map((t,r)=>eN.createElement(CK,eU({key:r,position:t,dimensions:CW[r]},e))),CH.map((t,r)=>eN.createElement(CK,eU({key:r,position:t,dimensions:CQ},e))));function CX({scale:e=[.8,.05,.05],color:t,rotation:r}){return eN.createElement("group",{rotation:r},eN.createElement("mesh",{position:[.4,0,0]},eN.createElement("boxGeometry",{args:e}),eN.createElement("meshBasicMaterial",{color:t,toneMapped:!1})))}function C$({onClick:e,font:t,disabled:r,arcStyle:i,label:n,labelColor:a,axisHeadScale:s=1,...o}){let l=dY(e=>e.gl),u=eN.useMemo(()=>{let e=document.createElement("canvas");e.width=64,e.height=64;let r=e.getContext("2d");return r.beginPath(),r.arc(32,32,16,0,2*Math.PI),r.closePath(),r.fillStyle=i,r.fill(),n&&(r.font=t,r.textAlign="center",r.fillStyle=a,r.fillText(n,32,41)),new lm(e)},[i,n,a,t]),[c,h]=eN.useState(!1),d=(n?1:.75)*(c?1.2:1)*s;return eN.createElement("sprite",eU({scale:d,onPointerOver:r?void 0:e=>{e.stopPropagation(),h(!0)},onPointerOut:r?void 0:e||(e=>{e.stopPropagation(),h(!1)})},o),eN.createElement("spriteMaterial",{map:u,"map-anisotropy":l.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:n?1:.75,toneMapped:!1}))}let CJ=({hideNegativeAxes:e,hideAxisHeads:t,disabled:r,font:i="18px Inter var, Arial, sans-serif",axisColors:n=["#ff2060","#20df80","#2080ff"],axisHeadScale:a=1,axisScale:s,labels:o=["X","Y","Z"],labelColor:l="#000",onClick:u,...c})=>{let[h,d,f]=n,{tweenCamera:p}=CI(),m={font:i,disabled:r,labelColor:l,onClick:u,axisHeadScale:a,onPointerDown:r?void 0:e=>{p(e.object.position),e.stopPropagation()}};return eN.createElement("group",eU({scale:40},c),eN.createElement(CX,{color:h,rotation:[0,0,0],scale:s}),eN.createElement(CX,{color:d,rotation:[0,0,Math.PI/2],scale:s}),eN.createElement(CX,{color:f,rotation:[0,-Math.PI/2,0],scale:s}),!t&&eN.createElement(eN.Fragment,null,eN.createElement(C$,eU({arcStyle:h,position:[1,0,0],label:o[0]},m)),eN.createElement(C$,eU({arcStyle:d,position:[0,1,0],label:o[1]},m)),eN.createElement(C$,eU({arcStyle:f,position:[0,0,1],label:o[2]},m)),!e&&eN.createElement(eN.Fragment,null,eN.createElement(C$,eU({arcStyle:h,position:[-1,0,0]},m)),eN.createElement(C$,eU({arcStyle:d,position:[0,-1,0]},m)),eN.createElement(C$,eU({arcStyle:f,position:[0,0,-1]},m)))))},CZ=be({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new aQ,sectionColor:new aQ,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new ni,worldPlanePosition:new ni},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),C0=eN.forwardRef(({args:e,cellColor:t="#000000",sectionColor:r="#2080ff",cellSize:i=.5,sectionSize:n=1,followCamera:a=!1,infiniteGrid:s=!1,fadeDistance:o=100,fadeStrength:l=1,fadeFrom:u=1,cellThickness:c=.5,sectionThickness:h=1,side:d=e0,...f},p)=>{dp({GridMaterial:CZ});let m=eN.useRef(null);eN.useImperativeHandle(p,()=>m.current,[]);let g=new oC,A=new ni(0,1,0),v=new ni(0,0,0);return dK(e=>{g.setFromNormalAndCoplanarPoint(A,v).applyMatrix4(m.current.matrixWorld);let t=m.current.material,r=t.uniforms.worldCamProjPosition,i=t.uniforms.worldPlanePosition;g.projectPoint(e.camera.position,r.value),i.value.set(0,0,0).applyMatrix4(m.current.matrixWorld)}),eN.createElement("mesh",eU({ref:m,frustumCulled:!1},f),eN.createElement("gridMaterial",eU({transparent:!0,"extensions-derivatives":!0,side:d},{cellSize:i,sectionSize:n,cellColor:t,sectionColor:r,cellThickness:c,sectionThickness:h},{fadeDistance:o,fadeStrength:l,fadeFrom:u,infiniteGrid:s,followCamera:a})),eN.createElement("planeGeometry",{args:e}))});function C1(e,{path:t}){let[r]=d$(cr,[e],e=>e.setPath(t));return r}function C2({children:e,files:t,...r}){let i=C1(t,{...r});return eN.createElement(eN.Fragment,null,null==e?void 0:e(i))}C1.preload=(e,{path:t})=>d$.preload(cr,[e],e=>e.setPath(t));var C3=(0,r(8086).createRequire)("/");try{C3("worker_threads").Worker}catch(e){}var C4=Uint8Array,C5=Uint16Array,C6=Uint32Array,C8=new C4([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),C9=new C4([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),C7=new C4([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Te=function(e,t){for(var r=new C5(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];for(var n=new C6(r[30]),i=1;i<30;++i)for(var a=r[i];a<r[i+1];++a)n[a]=a-r[i]<<5|i;return[r,n]},Tt=Te(C8,2),Tr=Tt[0],Ti=Tt[1];Tr[28]=258,Ti[258]=28;for(var Tn=Te(C9,0),Ta=Tn[0],Ts=Tn[1],To=new C5(32768),Tl=0;Tl<32768;++Tl){var Tu=(43690&Tl)>>>1|(21845&Tl)<<1;Tu=(61680&(Tu=(52428&Tu)>>>2|(13107&Tu)<<2))>>>4|(3855&Tu)<<4,To[Tl]=((65280&Tu)>>>8|(255&Tu)<<8)>>>1}for(var Tc=function(e,t,r){for(var i,n=e.length,a=0,s=new C5(t);a<n;++a)++s[e[a]-1];var o=new C5(t);for(a=0;a<t;++a)o[a]=o[a-1]+s[a-1]<<1;if(r){i=new C5(1<<t);var l=15-t;for(a=0;a<n;++a)if(e[a])for(var u=a<<4|e[a],c=t-e[a],h=o[e[a]-1]++<<c,d=h|(1<<c)-1;h<=d;++h)i[To[h]>>>l]=u}else for(a=0,i=new C5(n);a<n;++a)e[a]&&(i[a]=To[o[e[a]-1]++]>>>15-e[a]);return i},Th=new C4(288),Tl=0;Tl<144;++Tl)Th[Tl]=8;for(var Tl=144;Tl<256;++Tl)Th[Tl]=9;for(var Tl=256;Tl<280;++Tl)Th[Tl]=7;for(var Tl=280;Tl<288;++Tl)Th[Tl]=8;for(var Td=new C4(32),Tl=0;Tl<32;++Tl)Td[Tl]=5;var Tf=Tc(Th,9,1),Tp=Tc(Td,5,1),Tm=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Tg=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&r},TA=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},Tv=function(e){return(e/8|0)+(7&e&&1)},Ty=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var i=new(e instanceof C5?C5:e instanceof C6?C6:C4)(r-t);return i.set(e.subarray(t,r)),i},TE=function(e,t,r){var i=e.length;if(!i||r&&!r.l&&i<5)return t||new C4(0);var n=!t||r,a=!r||r.i;r||(r={}),t||(t=new C4(3*i));var s=function(e){var r=t.length;if(e>r){var i=new C4(Math.max(2*r,e));i.set(t),t=i}},o=r.f||0,l=r.p||0,u=r.b||0,c=r.l,h=r.d,d=r.m,f=r.n,p=8*i;do{if(!c){r.f=o=Tg(e,l,1);var m=Tg(e,l+1,3);if(l+=3,m){if(1==m)c=Tf,h=Tp,d=9,f=5;else if(2==m){var g=Tg(e,l,31)+257,A=Tg(e,l+10,15)+4,v=g+Tg(e,l+5,31)+1;l+=14;for(var y=new C4(v),E=new C4(19),x=0;x<A;++x)E[C7[x]]=Tg(e,l+3*x,7);l+=3*A;for(var _=Tm(E),b=(1<<_)-1,S=Tc(E,_,1),x=0;x<v;){var w=S[Tg(e,l,b)];l+=15&w;var C=w>>>4;if(C<16)y[x++]=C;else{var T=0,I=0;for(16==C?(I=3+Tg(e,l,3),l+=2,T=y[x-1]):17==C?(I=3+Tg(e,l,7),l+=3):18==C&&(I=11+Tg(e,l,127),l+=7);I--;)y[x++]=T}}var M=y.subarray(0,g),R=y.subarray(g);d=Tm(M),f=Tm(R),c=Tc(M,d,1),h=Tc(R,f,1)}else throw"invalid block type"}else{var C=Tv(l)+4,B=e[C-4]|e[C-3]<<8,D=C+B;if(D>i){if(a)throw"unexpected EOF";break}n&&s(u+B),t.set(e.subarray(C,D),u),r.b=u+=B,r.p=l=8*D;continue}if(l>p){if(a)throw"unexpected EOF";break}}n&&s(u+131072);for(var P=(1<<d)-1,L=(1<<f)-1,k=l;;k=l){var T=c[TA(e,l)&P],F=T>>>4;if((l+=15&T)>p){if(a)throw"unexpected EOF";break}if(!T)throw"invalid length/literal";if(F<256)t[u++]=F;else if(256==F){k=l,c=null;break}else{var O=F-254;if(F>264){var x=F-257,U=C8[x];O=Tg(e,l,(1<<U)-1)+Tr[x],l+=U}var N=h[TA(e,l)&L],z=N>>>4;if(!N)throw"invalid distance";l+=15&N;var R=Ta[z];if(z>3){var U=C9[z];R+=TA(e,l)&(1<<U)-1,l+=U}if(l>p){if(a)throw"unexpected EOF";break}n&&s(u+131072);for(var G=u+O;u<G;u+=4)t[u]=t[u-R],t[u+1]=t[u+1-R],t[u+2]=t[u+2-R],t[u+3]=t[u+3-R];u=G}}r.l=c,r.p=k,r.b=u,c&&(o=1,r.m=d,r.d=h,r.n=f)}while(!o);return u==t.length?t:Ty(t,0,u)},Tx=function(e,t,r){r<<=7&t;var i=t/8|0;e[i]|=r,e[i+1]|=r>>>8},T_=function(e,t,r){r<<=7&t;var i=t/8|0;e[i]|=r,e[i+1]|=r>>>8,e[i+2]|=r>>>16},Tb=function(e,t){for(var r=[],i=0;i<e.length;++i)e[i]&&r.push({s:i,f:e[i]});var n=r.length,a=r.slice();if(!n)return[TR,0];if(1==n){var s=new C4(r[0].s+1);return s[r[0].s]=1,[s,1]}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var o=r[0],l=r[1],u=0,c=1,h=2;for(r[0]={s:-1,f:o.f+l.f,l:o,r:l};c!=n-1;)o=r[r[u].f<r[h].f?u++:h++],l=r[u!=c&&r[u].f<r[h].f?u++:h++],r[c++]={s:-1,f:o.f+l.f,l:o,r:l};for(var d=a[0].s,i=1;i<n;++i)a[i].s>d&&(d=a[i].s);var f=new C5(d+1),p=TS(r[c-1],f,0);if(p>t){var i=0,m=0,g=p-t,A=1<<g;for(a.sort(function(e,t){return f[t.s]-f[e.s]||e.f-t.f});i<n;++i){var v=a[i].s;if(f[v]>t)m+=A-(1<<p-f[v]),f[v]=t;else break}for(m>>>=g;m>0;){var y=a[i].s;f[y]<t?m-=1<<t-f[y]++-1:++i}for(;i>=0&&m;--i){var E=a[i].s;f[E]==t&&(--f[E],++m)}p=t}return[new C4(f),p]},TS=function(e,t,r){return -1==e.s?Math.max(TS(e.l,t,r+1),TS(e.r,t,r+1)):t[e.s]=r},Tw=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new C5(++t),i=0,n=e[0],a=1,s=function(e){r[i++]=e},o=1;o<=t;++o)if(e[o]==n&&o!=t)++a;else{if(!n&&a>2){for(;a>138;a-=138)s(32754);a>2&&(s(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(s(n),--a;a>6;a-=6)s(8304);a>2&&(s(a-3<<5|8208),a=0)}for(;a--;)s(n);a=1,n=e[o]}return[r.subarray(0,i),t]},TC=function(e,t){for(var r=0,i=0;i<t.length;++i)r+=e[i]*t[i];return r},TT=function(e,t,r){var i=r.length,n=Tv(t+2);e[n]=255&i,e[n+1]=i>>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var a=0;a<i;++a)e[n+a+4]=r[a];return(n+4+i)*8},TI=function(e,t,r,i,n,a,s,o,l,u,c){Tx(t,c++,r),++n[256];for(var h,d,f,p,m=Tb(n,15),g=m[0],A=m[1],v=Tb(a,15),y=v[0],E=v[1],x=Tw(g),_=x[0],b=x[1],S=Tw(y),w=S[0],C=S[1],T=new C5(19),I=0;I<_.length;++I)T[31&_[I]]++;for(var I=0;I<w.length;++I)T[31&w[I]]++;for(var M=Tb(T,7),R=M[0],B=M[1],D=19;D>4&&!R[C7[D-1]];--D);var P=u+5<<3,L=TC(n,Th)+TC(a,Td)+s,k=TC(n,g)+TC(a,y)+s+14+3*D+TC(T,R)+(2*T[16]+3*T[17]+7*T[18]);if(P<=L&&P<=k)return TT(t,c,e.subarray(l,l+u));if(Tx(t,c,1+(k<L)),c+=2,k<L){h=Tc(g,A,0),d=g,f=Tc(y,E,0),p=y;var F=Tc(R,B,0);Tx(t,c,b-257),Tx(t,c+5,C-1),Tx(t,c+10,D-4),c+=14;for(var I=0;I<D;++I)Tx(t,c+3*I,R[C7[I]]);c+=3*D;for(var O=[_,w],U=0;U<2;++U)for(var N=O[U],I=0;I<N.length;++I){var z=31&N[I];Tx(t,c,F[z]),c+=R[z],z>15&&(Tx(t,c,N[I]>>>5&127),c+=N[I]>>>12)}}else h=null,d=Th,f=null,p=Td;for(var I=0;I<o;++I)if(i[I]>255){var z=i[I]>>>18&31;T_(t,c,h[z+257]),c+=d[z+257],z>7&&(Tx(t,c,i[I]>>>23&31),c+=C8[z]);var G=31&i[I];T_(t,c,f[G]),c+=p[G],G>3&&(T_(t,c,i[I]>>>5&8191),c+=C9[G])}else T_(t,c,h[i[I]]),c+=d[i[I]];return T_(t,c,h[256]),c+d[256]},TM=new C6([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),TR=new C4(0),TB=function(e,t,r,i,n,a){var s=e.length,o=new C4(i+s+5*(1+Math.ceil(s/7e3))+n),l=o.subarray(i,o.length-n),u=0;if(!t||s<8)for(var c=0;c<=s;c+=65535){var h=c+65535;h<s?u=TT(l,u,e.subarray(c,h)):(l[c]=a,u=TT(l,u,e.subarray(c,s)))}else{for(var d=TM[t-1],f=d>>>13,p=8191&d,m=(1<<r)-1,g=new C5(32768),A=new C5(m+1),v=Math.ceil(r/3),y=2*v,E=function(t){return(e[t]^e[t+1]<<v^e[t+2]<<y)&m},x=new C6(25e3),_=new C5(288),b=new C5(32),S=0,w=0,c=0,C=0,T=0,I=0;c<s;++c){var M=E(c),R=32767&c,B=A[M];if(g[R]=B,A[M]=R,T<=c){var D=s-c;if((S>7e3||C>24576)&&D>423){u=TI(e,l,0,x,_,b,w,C,I,c-I,u),C=S=w=0,I=c;for(var P=0;P<286;++P)_[P]=0;for(var P=0;P<30;++P)b[P]=0}var L=2,k=0,F=p,O=R-B&32767;if(D>2&&M==E(c-O))for(var U=Math.min(f,D)-1,N=Math.min(32767,c),z=Math.min(258,D);O<=N&&--F&&R!=B;){if(e[c+L]==e[c+L-O]){for(var G=0;G<z&&e[c+G]==e[c+G-O];++G);if(G>L){if(L=G,k=O,G>U)break;for(var H=Math.min(O,G-2),Q=0,P=0;P<H;++P){var V=c-O+P+32768&32767,W=g[V],j=V-W+32768&32767;j>Q&&(Q=j,B=V)}}}B=g[R=B],O+=R-B+32768&32767}if(k){x[C++]=0x10000000|Ti[L]<<18|Ts[k];var Y=31&Ti[L],K=31&Ts[k];w+=C8[Y]+C9[K],++_[257+Y],++b[K],T=c+L,++S}else x[C++]=e[c],++_[e[c]]}}u=TI(e,l,a,x,_,b,w,C,I,c-I,u),!a&&7&u&&(u=TT(l,u+1,TR))}return Ty(o,0,i+Tv(u)+n)},TD=function(e,t){var r={};for(var i in e)r[i]=e[i];for(var i in t)r[i]=t[i];return r},TP=function(e,t,r){for(var i=e(),n=e.toString(),a=n.slice(n.indexOf("[")+1,n.lastIndexOf("]")).replace(/ /g,"").split(","),s=0;s<i.length;++s){var o=i[s],l=a[s];if("function"==typeof o){t+=";"+l+"=";var u=o.toString();if(o.prototype){if(-1!=u.indexOf("[native code]")){var c=u.indexOf(" ",8)+1;t+=u.slice(c,u.indexOf("(",c))}else for(var h in t+=u,o.prototype)t+=";"+l+".prototype."+h+"="+o.prototype[h].toString()}else t+=u}else r[l]=o}return[t,r]},TL=function(e){var t=[];for(var r in e)(e[r]instanceof C4||e[r]instanceof C5||e[r]instanceof C6)&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t},Tk=function(e,t,r,i){if(!null[r]){for(var n,a="",s={},o=e.length-1,l=0;l<o;++l)a=(n=TP(e[l],a,s))[0],s=n[1];null[r]=TP(e[o],a,s)}var u=TD({},null[r][1]);return(null)(null[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,u,TL(u),i)},TF=function(e){return postMessage(e,[e.buffer])},TO=function(e){return e&&e.size&&new C4(e.size)},TU=function(e,t){return e[t]|e[t+1]<<8},TN=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Tz=function(e,t){return TN(e,t)+0x100000000*TN(e,t+4)},TG=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},TH=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function TQ(e,t){return TE(e,t)}function TV(e,t){return TE((TH(e),e.subarray(2,-4)),t)}var TW="undefined"!=typeof TextDecoder&&new TextDecoder;try{TW.decode(TR,{stream:!0})}catch(e){}function Tj(e,t,r){let i=r.length-e-1;if(t>=r[i])return i-1;if(t<=r[e])return e;let n=e,a=i,s=Math.floor((n+a)/2);for(;t<r[s]||t>=r[s+1];)t<r[s]?a=s:n=s,s=Math.floor((n+a)/2);return s}class TY extends lM{constructor(e,t,r,i,n){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=n||this.knots.length-1;for(let e=0;e<r.length;++e){let t=r[e];this.controlPoints[e]=new nT(t.x,t.y,t.z,t.w)}}getPoint(e,t){let r=t||new ni,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),n=function(e,t,r,i){let n=Tj(e,i,t),a=function(e,t,r,i){let n=[],a=[],s=[];n[0]=1;for(let o=1;o<=r;++o){a[o]=t-i[e+1-o],s[o]=i[e+o]-t;let r=0;for(let e=0;e<o;++e){let t=s[e+1],i=a[o-e],l=n[e]/(t+i);n[e]=r+t*l,r=i*l}n[o]=r}return n}(n,i,e,t),s=new nT(0,0,0,0);for(let t=0;t<=e;++t){let i=r[n-e+t],o=a[t],l=i.w*o;s.x+=i.x*l,s.y+=i.y*l,s.z+=i.z*l,s.w+=i.w*o}return s}(this.degree,this.knots,this.controlPoints,i);return 1!=n.w&&n.divideScalar(n.w),r.set(n.x,n.y,n.z)}getTangent(e,t){var r;let i=t||new ni,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=(r=this.degree,function(e){let t=e.length,r=[],i=[];for(let n=0;n<t;++n){let t=e[n];r[n]=new ni(t.x,t.y,t.z),i[n]=t.w}let n=[];for(let e=0;e<t;++e){let t=r[e].clone();for(let r=1;r<=e;++r)t.sub(n[e-r].clone().multiplyScalar(function(e,t){let r=1;for(let t=2;t<=e;++t)r*=t;let i=1;for(let e=2;e<=t;++e)i*=e;for(let r=2;r<=e-t;++r)i*=r;return r/i}(e,r)*i[r]));n[e]=t.divideScalar(i[0])}return n}(function(e,t,r,i,n){let a=1<e?1:e,s=[],o=Tj(e,i,t),l=function(e,t,r,i,n){let a=[];for(let e=0;e<=r;++e)a[e]=0;let s=[];for(let e=0;e<=i;++e)s[e]=a.slice(0);let o=[];for(let e=0;e<=r;++e)o[e]=a.slice(0);o[0][0]=1;let l=a.slice(0),u=a.slice(0);for(let i=1;i<=r;++i){l[i]=t-n[e+1-i],u[i]=n[e+i]-t;let r=0;for(let e=0;e<i;++e){let t=u[e+1],n=l[i-e];o[i][e]=t+n;let a=o[e][i-1]/o[i][e];o[e][i]=r+t*a,r=n*a}o[i][i]=r}for(let e=0;e<=r;++e)s[0][e]=o[e][r];for(let e=0;e<=r;++e){let t=0,n=1,l=[];for(let e=0;e<=r;++e)l[e]=a.slice(0);l[0][0]=1;for(let a=1;a<=i;++a){let i=0,u=e-a,c=r-a;e>=a&&(l[n][0]=l[t][0]/o[c+1][u],i=l[n][0]*o[u][c]);let h=u>=-1?1:-u,d=e-1<=c?a-1:r-e;for(let e=h;e<=d;++e)l[n][e]=(l[t][e]-l[t][e-1])/o[c+1][u+e],i+=l[n][e]*o[u+e][c];e<=c&&(l[n][a]=-l[t][a-1]/o[c+1][e],i+=l[n][a]*o[e][c]),s[a][e]=i;let f=t;t=n,n=f}}let c=r;for(let e=1;e<=i;++e){for(let t=0;t<=r;++t)s[e][t]*=c;c*=r-e}return s}(o,i,e,a,t),u=[];for(let e=0;e<r.length;++e){let t=r[e].clone(),i=t.w;t.x*=i,t.y*=i,t.z*=i,u[e]=t}for(let t=0;t<=a;++t){let r=u[o-e].clone().multiplyScalar(l[t][0]);for(let i=1;i<=e;++i)r.add(u[o-e+i].clone().multiplyScalar(l[t][i]));s[t]=r}for(let e=a+1;e<=n+1;++e)s[e]=new nT(0,0,0);return s}(r,this.knots,this.controlPoints,n,1)));return i.copy(a[1]).normalize(),i}}class TK extends u4{constructor(e){super(e)}load(e,t,r,i){let n=this,a=""===n.path?cC.extractUrlBase(e):n.path,s=new u8(this.manager);s.setPath(n.path),s.setResponseType("arraybuffer"),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(r){try{t(n.parse(r,a))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}},r,i)}parse(e,t){if(function(e){let t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===It(e,0,t.length)}(e))N=new TZ().parse(e);else{let t=It(e);if(!function(e){let t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;for(let i=0;i<t.length;++i)if(function(t){let i=e[0];return e=e.slice(r+1),r++,i}(0)===t[i])return!1;return!0}(t))throw Error("THREE.FBXLoader: Unknown format.");if(7e3>T2(t))throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+T2(t));N=new TJ().parse(t)}return new Tq(new cn(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),this.manager).parse(N)}}class Tq{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){z=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),i=this.parseDeformers(),n=new TX().parse(i);return this.parseScene(i,n,r),G}parseConnections(){let e=new Map;return"Connections"in N&&N.Connections.connections.forEach(function(t){let r=t[0],i=t[1],n=t[2];e.has(r)||e.set(r,{parents:[],children:[]}),e.get(r).parents.push({ID:i,relationship:n}),e.has(i)||e.set(i,{parents:[],children:[]}),e.get(i).children.push({ID:r,relationship:n})}),e}parseImages(){let e={},t={};if("Video"in N.Objects){let r=N.Objects.Video;for(let i in r){let n=r[i];if(e[parseInt(i)]=n.RelativeFilename||n.Filename,"Content"in n){let e=n.Content instanceof ArrayBuffer&&n.Content.byteLength>0,a="string"==typeof n.Content&&""!==n.Content;if(e||a){let e=this.parseImage(r[i]);t[n.RelativeFilename||n.Filename]=e}}}}for(let r in e){let i=e[r];void 0!==t[i]?e[r]=t[i]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){let t;let r=e.Content,i=e.RelativeFilename||e.Filename,n=i.slice(i.lastIndexOf(".")+1).toLowerCase();switch(n){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",i),t="image/tga";break;default:console.warn('FBXLoader: Image type "'+n+'" is not supported.');return}if("string"==typeof r)return"data:"+t+";base64,"+r;{let e=new Uint8Array(r);return window.URL.createObjectURL(new Blob([e],{type:t}))}}parseTextures(e){let t=new Map;if("Texture"in N.Objects){let r=N.Objects.Texture;for(let i in r){let n=this.parseTexture(r[i],e);t.set(parseInt(i),n)}}return t}parseTexture(e,t){let r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;let i=e.WrapModeU,n=e.WrapModeV,a=void 0!==i?i.value:0,s=void 0!==n?n.value:0;if(r.wrapS=0===a?tW:tj,r.wrapT=0===s?tW:tj,"Scaling"in e){let t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}return r}loadTexture(e,t){let r,i;let n=this.textureLoader.path,a=z.get(e.id).children;void 0!==a&&a.length>0&&void 0!==t[a[0].ID]&&(0===(r=t[a[0].ID]).indexOf("blob:")||0===r.indexOf("data:"))&&this.textureLoader.setPath(void 0);let s=e.FileName.slice(-3).toLowerCase();if("tga"===s){let t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new nC):(t.setPath(this.textureLoader.path),i=t.load(r))}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new nC):i=this.textureLoader.load(r);return this.textureLoader.setPath(n),i}parseMaterials(e){let t=new Map;if("Material"in N.Objects){let r=N.Objects.Material;for(let i in r){let n=this.parseMaterial(r[i],e);null!==n&&t.set(parseInt(i),n)}}return t}parseMaterial(e,t){let r;let i=e.id,n=e.attrName,a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!z.has(i))return null;let s=this.parseParameters(e,t,i);switch(a.toLowerCase()){case"phong":r=new uI;break;case"lambert":r=new uB;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),r=new uI}return r.setValues(s),r.name=n,r}parseParameters(e,t,r){let i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new aQ().fromArray(e.Diffuse.value):e.DiffuseColor&&("Color"===e.DiffuseColor.type||"ColorRGB"===e.DiffuseColor.type)&&(i.color=new aQ().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new aQ().fromArray(e.Emissive.value):e.EmissiveColor&&("Color"===e.EmissiveColor.type||"ColorRGB"===e.EmissiveColor.type)&&(i.emissive=new aQ().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new aQ().fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=new aQ().fromArray(e.SpecularColor.value));let n=this;return z.get(r).children.forEach(function(e){let r=e.relationship;switch(r){case"Bump":i.bumpMap=n.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=n.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=n.getTexture(t,e.ID),void 0!==i.map&&("colorSpace"in i.map?i.map.colorSpace="srgb":i.map.encoding=3001);break;case"DisplacementColor":i.displacementMap=n.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=n.getTexture(t,e.ID),void 0!==i.emissiveMap&&("colorSpace"in i.emissiveMap?i.emissiveMap.colorSpace="srgb":i.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=n.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=n.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=tH,"colorSpace"in i.envMap?i.envMap.colorSpace="srgb":i.envMap.encoding=3001);break;case"SpecularColor":i.specularMap=n.getTexture(t,e.ID),void 0!==i.specularMap&&("colorSpace"in i.specularMap?i.specularMap.colorSpace="srgb":i.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=n.getTexture(t,e.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}}),i}getTexture(e,t){return"LayeredTexture"in N.Objects&&t in N.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=z.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in N.Objects){let r=N.Objects.Deformer;for(let i in r){let n=r[i],a=z.get(parseInt(i));if("Skin"===n.attrType){let t=this.parseSkeleton(a,r);t.ID=i,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=a.parents[0].ID,e[i]=t}else if("BlendShape"===n.attrType){let e={id:i};e.rawTargets=this.parseMorphTargets(a,r),e.id=i,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){let r=[];return e.children.forEach(function(e){let i=t[e.ID];if("Cluster"!==i.attrType)return;let n={ID:e.ID,indices:[],weights:[],transformLink:new n8().fromArray(i.TransformLink.a)};"Indexes"in i&&(n.indices=i.Indexes.a,n.weights=i.Weights.a),r.push(n)}),{rawBones:r,bones:[]}}parseMorphTargets(e,t){let r=[];for(let i=0;i<e.children.length;i++){let n=e.children[i],a=t[n.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;s.geoID=z.get(parseInt(n.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,r.push(s)}return r}parseScene(e,t,r){G=new sF;let i=this.parseModels(e.skeletons,t,r),n=N.Objects.Model,a=this;i.forEach(function(e){let t=n[e.ID];a.setLookAtProperties(e,t),z.get(e.ID).parents.forEach(function(t){let r=i.get(t.ID);void 0!==r&&r.add(e)}),null===e.parent&&G.add(e)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),G.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);let t=T9(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}});let s=new T$().parse();1===G.children.length&&G.children[0].isGroup&&(G.children[0].animations=s,G=G.children[0]),G.animations=s}parseModels(e,t,r){let i=new Map,n=N.Objects.Model;for(let a in n){let s=parseInt(a),o=n[a],l=z.get(s),u=this.buildSkeleton(l,e,s,o.attrName);if(!u){switch(o.attrType){case"Camera":u=this.createCamera(l);break;case"Light":u=this.createLight(l);break;case"Mesh":u=this.createMesh(l,t,r);break;case"NurbsCurve":u=this.createCurve(l,t);break;case"LimbNode":case"Root":u=new ou;break;default:u=new sF}u.name=o.attrName?ht.sanitizeNodeName(o.attrName):"",u.ID=s}this.getTransformData(u,o),i.set(s,u)}return i}buildSkeleton(e,t,r,i){let n=null;return e.parents.forEach(function(e){for(let a in t){let s=t[a];s.rawBones.forEach(function(t,a){if(t.ID===e.ID){let e=n;(n=new ou).matrixWorld.copy(t.transformLink),n.name=i?ht.sanitizeNodeName(i):"",n.ID=r,s.bones[a]=n,null!==e&&n.add(e)}})}}),n}createCamera(e){let t,r;if(e.children.forEach(function(e){let t=N.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new aS;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let i=1;void 0!==r.NearPlane&&(i=r.NearPlane.value/1e3);let n=1e3;void 0!==r.FarPlane&&(n=r.FarPlane.value/1e3);let a=window.innerWidth,s=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(a=r.AspectWidth.value,s=r.AspectHeight.value);let o=a/s,l=45;void 0!==r.FieldOfView&&(l=r.FieldOfView.value);let u=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new sD(l,o,i,n),null!==u&&t.setFocalLength(u);break;case 1:t=new cv(-a/2,a/2,s/2,-s/2,i,n);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new aS}}return t}createLight(e){let t,r;if(e.children.forEach(function(e){let t=N.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new aS;else{let e;e=void 0===r.LightType?0:r.LightType.value;let i=0xffffff;void 0!==r.Color&&(i=new aQ().fromArray(r.Color.value));let n=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(n=0);let a=0;switch(void 0!==r.FarAttenuationEnd&&(a=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value),e){case 0:t=new cA(i,n,a,1);break;case 1:t=new cE(i,n);break;case 2:let s=Math.PI/3;void 0!==r.InnerAngle&&(s=ne.degToRad(r.InnerAngle.value));let o=0;void 0!==r.OuterAngle&&(o=Math.max(o=ne.degToRad(r.OuterAngle.value),1)),t=new cd(i,n,a,s,o,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),t=new cA(i,n)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let i;let n=null,a=null,s=[];return e.children.forEach(function(e){t.has(e.ID)&&(n=t.get(e.ID)),r.has(e.ID)&&s.push(r.get(e.ID))}),s.length>1?a=s:s.length>0?a=s[0]:(a=new uI({color:0xcccccc}),s.push(a)),"color"in n.attributes&&s.forEach(function(e){e.vertexColors=!0}),n.FBX_Deformer?(i=new ol(n,a)).normalizeSkinWeights():i=new sE(n,a),i}createCurve(e,t){return new o6(e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),new oJ({color:3342591,linewidth:1}))}getTransformData(e,t){let r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?r.eulerOrder=T7(t.RotationOrder.value):r.eulerOrder="ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&z.get(e.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){let r=N.Objects.Model[t.ID];if("Lcl_Translation"in r){let t=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),G.add(e.target)):e.lookAt(new ni().fromArray(t))}}})}bindSkeleton(e,t,r){let i=this.parsePoseNodes();for(let n in e){let a=e[n];z.get(parseInt(a.ID)).parents.forEach(function(e){if(t.has(e.ID)){let t=e.ID;z.get(t).parents.forEach(function(e){r.has(e.ID)&&r.get(e.ID).bind(new of(a.bones),i[e.ID])})}})}}parsePoseNodes(){let e={};if("Pose"in N.Objects){let t=N.Objects.Pose;for(let r in t)if("BindPose"===t[r].attrType&&t[r].NbPoseNodes>0){let i=t[r].PoseNode;Array.isArray(i)?i.forEach(function(t){e[t.Node]=new n8().fromArray(t.Matrix.a)}):e[i.Node]=new n8().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in N&&"AmbientColor"in N.GlobalSettings){let e=N.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],i=e[2];if(0!==t||0!==r||0!==i){let e=new aQ(t,r,i);G.add(new cx(e,1))}}}}class TX{parse(e){let t=new Map;if("Geometry"in N.Objects){let r=N.Objects.Geometry;for(let i in r){let n=z.get(parseInt(i)),a=this.parseGeometry(n,r[i],e);t.set(parseInt(i),a)}}return t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){let i=r.skeletons,n=[],a=e.parents.map(function(e){return N.Objects.Model[e.ID]});if(0===a.length)return;let s=e.children.reduce(function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e},null);e.children.forEach(function(e){void 0!==r.morphTargets[e.ID]&&n.push(r.morphTargets[e.ID])});let o=a[0],l={};"RotationOrder"in o&&(l.eulerOrder=T7(o.RotationOrder.value)),"InheritType"in o&&(l.inheritType=parseInt(o.InheritType.value)),"GeometricTranslation"in o&&(l.translation=o.GeometricTranslation.value),"GeometricRotation"in o&&(l.rotation=o.GeometricRotation.value),"GeometricScaling"in o&&(l.scale=o.GeometricScaling.value);let u=T9(l);return this.genGeometry(t,s,n,u)}genGeometry(e,t,r,i){let n=new sl;e.attrName&&(n.name=e.attrName);let a=this.parseGeoNode(e,t),s=this.genBuffers(a),o=new se(s.vertex,3);if(o.applyMatrix4(i),n.setAttribute("position",o),s.colors.length>0&&n.setAttribute("color",new se(s.colors,3)),t&&(n.setAttribute("skinIndex",new a6(s.weightsIndices,4)),n.setAttribute("skinWeight",new se(s.vertexWeights,4)),n.FBX_Deformer=t),s.normal.length>0){let e=new ns().getNormalMatrix(i),t=new se(s.normal,3);t.applyNormalMatrix(e),n.setAttribute("normal",t)}if(s.uvs.forEach(function(e,t){"uv2"===E1&&t++;let r=0===t?"uv":`uv${t}`;n.setAttribute(r,new se(s.uvs[t],2))}),a.material&&"AllSame"!==a.material.mappingType){let e=s.materialIndex[0],t=0;if(s.materialIndex.forEach(function(r,i){r!==e&&(n.addGroup(t,i-t,e),e=r,t=i)}),n.groups.length>0){let t=n.groups[n.groups.length-1],r=t.start+t.count;r!==s.materialIndex.length&&n.addGroup(r,s.materialIndex.length-r,e)}0===n.groups.length&&n.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(n,e,r,i),n}parseGeoNode(e,t){let r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(i,n){void 0===r.weightTable[i]&&(r.weightTable[i]=[]),r.weightTable[i].push({id:t,weight:e.weights[n]})})})),r}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,i=0,n=!1,a=[],s=[],o=[],l=[],u=[],c=[],h=this;return e.vertexIndices.forEach(function(d,f){let p;let m=!1;d<0&&(d^=-1,m=!0);let g=[],A=[];if(a.push(3*d,3*d+1,3*d+2),e.color){let t=T5(f,r,d,e.color);o.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach(function(e){A.push(e.weight),g.push(e.id)}),A.length>4){n||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),n=!0);let e=[0,0,0,0],t=[0,0,0,0];A.forEach(function(r,i){let n=r,a=g[i];t.forEach(function(t,r,i){if(n>t){i[r]=n,n=t;let s=e[r];e[r]=a,a=s}})}),g=e,A=t}for(;A.length<4;)A.push(0),g.push(0);for(let e=0;e<4;++e)u.push(A[e]),c.push(g[e])}if(e.normal){let t=T5(f,r,d,e.normal);s.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(p=T5(f,r,d,e.material)[0]),e.uv&&e.uv.forEach(function(e,t){let i=T5(f,r,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(i[0]),l[t].push(i[1])}),i++,m&&(h.genFace(t,e,a,p,s,o,l,u,c,i),r++,i=0,a=[],s=[],o=[],l=[],u=[],c=[])}),t}genFace(e,t,r,i,n,a,s,o,l,u){for(let c=2;c<u;c++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[(c-1)*3]]),e.vertex.push(t.vertexPositions[r[(c-1)*3+1]]),e.vertex.push(t.vertexPositions[r[(c-1)*3+2]]),e.vertex.push(t.vertexPositions[r[3*c]]),e.vertex.push(t.vertexPositions[r[3*c+1]]),e.vertex.push(t.vertexPositions[r[3*c+2]]),t.skeleton&&(e.vertexWeights.push(o[0]),e.vertexWeights.push(o[1]),e.vertexWeights.push(o[2]),e.vertexWeights.push(o[3]),e.vertexWeights.push(o[(c-1)*4]),e.vertexWeights.push(o[(c-1)*4+1]),e.vertexWeights.push(o[(c-1)*4+2]),e.vertexWeights.push(o[(c-1)*4+3]),e.vertexWeights.push(o[4*c]),e.vertexWeights.push(o[4*c+1]),e.vertexWeights.push(o[4*c+2]),e.vertexWeights.push(o[4*c+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[(c-1)*4]),e.weightsIndices.push(l[(c-1)*4+1]),e.weightsIndices.push(l[(c-1)*4+2]),e.weightsIndices.push(l[(c-1)*4+3]),e.weightsIndices.push(l[4*c]),e.weightsIndices.push(l[4*c+1]),e.weightsIndices.push(l[4*c+2]),e.weightsIndices.push(l[4*c+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[(c-1)*3]),e.colors.push(a[(c-1)*3+1]),e.colors.push(a[(c-1)*3+2]),e.colors.push(a[3*c]),e.colors.push(a[3*c+1]),e.colors.push(a[3*c+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(n[0]),e.normal.push(n[1]),e.normal.push(n[2]),e.normal.push(n[(c-1)*3]),e.normal.push(n[(c-1)*3+1]),e.normal.push(n[(c-1)*3+2]),e.normal.push(n[3*c]),e.normal.push(n[3*c+1]),e.normal.push(n[3*c+2])),t.uv&&t.uv.forEach(function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(s[r][0]),e.uvs[r].push(s[r][1]),e.uvs[r].push(s[r][(c-1)*2]),e.uvs[r].push(s[r][(c-1)*2+1]),e.uvs[r].push(s[r][2*c]),e.uvs[r].push(s[r][2*c+1])})}addMorphTargets(e,t,r,i){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let n=this;r.forEach(function(r){r.rawTargets.forEach(function(r){let a=N.Objects.Geometry[r.geoID];void 0!==a&&n.genMorphGeometry(e,t,a,i,r.name)})})}genMorphGeometry(e,t,r,i,n){let a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==r.Vertices?r.Vertices.a:[],o=void 0!==r.Indexes?r.Indexes.a:[],l=new Float32Array(3*e.attributes.position.count);for(let e=0;e<o.length;e++){let t=3*o[e];l[t]=s[3*e],l[t+1]=s[3*e+1],l[t+2]=s[3*e+2]}let u=new se(this.genBuffers({vertexIndices:a,vertexPositions:l}).vertex,3);u.name=n||r.attrName,u.applyMatrix4(i),e.morphAttributes.position.push(u)}parseNormals(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Normals.a,n=[];return"IndexToDirect"===r&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:n,mappingType:t,referenceType:r}}parseUVs(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.UV.a,n=[];return"IndexToDirect"===r&&(n=e.UVIndex.a),{dataSize:2,buffer:i,indices:n,mappingType:t,referenceType:r}}parseVertexColors(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Colors.a,n=[];return"IndexToDirect"===r&&(n=e.ColorIndex.a),{dataSize:4,buffer:i,indices:n,mappingType:t,referenceType:r}}parseMaterialIndices(e){let t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};let i=e.Materials.a,n=[];for(let e=0;e<i.length;++e)n.push(e);return{dataSize:1,buffer:i,indices:n,mappingType:t,referenceType:r}}parseNurbsGeometry(e){let t,r;if(void 0===TY)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new sl;let i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new sl;let n=i-1,a=e.KnotVector.a,s=[],o=e.Points.a;for(let e=0,t=o.length;e<t;e+=4)s.push(new nT().fromArray(o,e));if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){t=n,r=a.length-1-t;for(let e=0;e<n;++e)s.push(s[e])}let l=new TY(n,a,s,t,r).getPoints(12*s.length);return new sl().setFromPoints(l)}}class T${parse(){let e=[],t=this.parseClips();if(void 0!==t)for(let r in t){let i=t[r],n=this.addClip(i);e.push(n)}return e}parseClips(){if(void 0===N.Objects.AnimationCurve)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=N.Objects.AnimationCurveNode,t=new Map;for(let r in e){let i=e[r];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){let e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){let t=N.Objects.AnimationCurve;for(let r in t){let i={id:t[r].id,times:t[r].KeyTime.a.map(T3),values:t[r].KeyValueFloat.a},n=z.get(i.id);if(void 0!==n){let t=n.parents[0].ID,r=n.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=i:r.match(/Y/)?e.get(t).curves.y=i:r.match(/Z/)?e.get(t).curves.z=i:r.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){let t=N.Objects.AnimationLayer,r=new Map;for(let i in t){let t=[],n=z.get(parseInt(i));void 0!==n&&(n.children.forEach(function(r,i){if(e.has(r.ID)){let n=e.get(r.ID);if(void 0!==n.curves.x||void 0!==n.curves.y||void 0!==n.curves.z){if(void 0===t[i]){let e=z.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID;if(void 0!==e){let n=N.Objects.Model[e.toString()];if(void 0===n){console.warn("THREE.FBXLoader: Encountered a unused curve.",r);return}let a={modelName:n.attrName?ht.sanitizeNodeName(n.attrName):"",ID:n.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};G.traverse(function(e){e.ID===n.id&&(a.transform=e.matrix,e.userData.transformData&&(a.eulerOrder=e.userData.transformData.eulerOrder))}),a.transform||(a.transform=new n8),"PreRotation"in n&&(a.preRotation=n.PreRotation.value),"PostRotation"in n&&(a.postRotation=n.PostRotation.value),t[i]=a}}t[i]&&(t[i][n.attr]=n)}else if(void 0!==n.curves.morph){if(void 0===t[i]){let e=z.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,n=z.get(e).parents[0].ID,a=z.get(n).parents[0].ID,s=z.get(a).parents[0].ID,o=N.Objects.Model[s],l={modelName:o.attrName?ht.sanitizeNodeName(o.attrName):"",morphName:N.Objects.Deformer[e].attrName};t[i]=l}t[i][n.attr]=n}}}),r.set(parseInt(i),t))}return r}parseAnimStacks(e){let t=N.Objects.AnimationStack,r={};for(let i in t){let n=z.get(parseInt(i)).children;n.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let a=e.get(n[0].ID);r[i]={name:t[i].attrName,layer:a}}return r}addClip(e){let t=[],r=this;return e.layer.forEach(function(e){t=t.concat(r.generateTracks(e))}),new u0(e.name,-1,t)}generateTracks(e){let t=[],r=new ni,i=new nr,n=new ni;if(e.transform&&e.transform.decompose(r,i,n),r=r.toArray(),i=new ao().setFromQuaternion(i,e.eulerOrder).toArray(),n=n.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){let i=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){let r=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){let r=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");void 0!==r&&t.push(r)}if(void 0!==e.DeformPercent){let r=this.generateMorphTrack(e);void 0!==r&&t.push(r)}return t}generateVectorTrack(e,t,r,i){let n=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(n,t,r);return new uZ(e+"."+i,n,a)}generateRotationTrack(e,t,r,i,n,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(ne.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(ne.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(ne.degToRad));let s=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(s,t,r);void 0!==i&&((i=i.map(ne.degToRad)).push(a),i=new ao().fromArray(i),i=new nr().setFromEuler(i)),void 0!==n&&((n=n.map(ne.degToRad)).push(a),n=new ao().fromArray(n),n=new nr().setFromEuler(n).invert());let l=new nr,u=new ao,c=[];for(let e=0;e<o.length;e+=3)u.set(o[e],o[e+1],o[e+2],a),l.setFromEuler(u),void 0!==i&&l.premultiply(i),void 0!==n&&l.multiply(n),l.toArray(c,e/3*4);return new u$(e+".quaternion",s,c)}generateMorphTrack(e){let t=e.DeformPercent.curves.morph,r=t.values.map(function(e){return e/100}),i=G.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new uq(e.modelName+".morphTargetInfluences["+i+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort(function(e,t){return e-t})).length>1){let e=1,r=t[0];for(let i=1;i<t.length;i++){let n=t[i];n!==r&&(t[e]=n,r=n,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){let i=[],n=-1,a=-1,s=-1;return e.forEach(function(e){if(t.x&&(n=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==n){let e=t.x.values[n];i.push(e),r[0]=e}else i.push(r[0]);if(-1!==a){let e=t.y.values[a];i.push(e),r[1]=e}else i.push(r[1]);if(-1!==s){let e=t.z.values[s];i.push(e),r[2]=e}else i.push(r[2])}),i}interpolateRotations(e){for(let t=1;t<e.values.length;t++){let r=e.values[t-1],i=e.values[t]-r,n=Math.abs(i);if(n>=180){let a=n/180,s=i/a,o=r+s,l=e.times[t-1],u=(e.times[t]-l)/a,c=l+u,h=[],d=[];for(;c<e.times[t];)h.push(c),c+=u,d.push(o),o+=s;e.times=Ir(e.times,t,h),e.values=Ir(e.values,t,d)}}}}class TJ{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new T1,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,r=e.split(/[\r\n]+/);return r.forEach(function(e,i){let n=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(n||a)return;let s=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),o=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");s?t.parseNodeBegin(e,s):o?t.parseNodeProperty(e,o,r[++i]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}),this.allNodes}parseNodeBegin(e,t){let r=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),n={name:r},a=this.parseNodeAttr(i),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,n):r in s?("PoseNode"===r?s.PoseNode.push(n):void 0!==s[r].id&&(s[r]={},s[r][s[r].id]=s[r]),""!==a.id&&(s[r][a.id]=n)):"number"==typeof a.id?(s[r]={},s[r][a.id]=n):"Properties70"!==r&&("PoseNode"===r?s[r]=[n]:s[r]=n),"number"==typeof a.id&&(n.id=a.id),""!==a.name&&(n.attrName=a.name),""!==a.type&&(n.attrType=a.type),this.pushStack(n)}parseNodeAttr(e){let t=e[0];""!==e[0]&&isNaN(t=parseInt(e[0]))&&(t=e[0]);let r="",i="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:r,type:i}}parseNodeProperty(e,t,r){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===n&&(n=r.replace(/"/g,"").replace(/,$/,"").trim());let a=this.getCurrentNode();if("Properties70"===a.name){this.parseNodeSpecialProperty(e,i,n);return}if("C"===i){let e=n.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]),s=n.split(",").slice(3);s=s.map(function(e){return e.trim().replace(/^"/,"")}),i="connections",function(e,t){for(let r=0,i=e.length,n=t.length;r<n;r++,i++)e[i]=t[r]}(n=[t,r],s),void 0===a[i]&&(a[i]=[])}"Node"===i&&(a.id=n),i in a&&Array.isArray(a[i])?a[i].push(n):"a"!==i?a[i]=n:a.a=n,this.setCurrentProp(a,i),"a"===i&&","!==n.slice(-1)&&(a.a=Ie(n))}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Ie(t.a))}parseNodeSpecialProperty(e,t,r){let i=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),n=i[0],a=i[1],s=i[2],o=i[3],l=i[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Ie(l)}this.getPrevNode()[n]={type:a,type2:s,flag:o,value:l},this.setCurrentProp(this.getPrevNode(),n)}}class TZ{parse(e){let t=new T0(e);t.skip(23);let r=t.getUint32();if(r<6400)throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);let i=new T1;for(;!this.endOfContent(t);){let e=this.parseNode(t,r);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let r={},i=t>=7500?e.getUint64():e.getUint32(),n=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let a=e.getUint8(),s=e.getString(a);if(0===i)return null;let o=[];for(let t=0;t<n;t++)o.push(this.parseProperty(e));let l=o.length>0?o[0]:"",u=o.length>1?o[1]:"",c=o.length>2?o[2]:"";for(r.singleProperty=1===n&&e.getOffset()===i;i>e.getOffset();){let i=this.parseNode(e,t);null!==i&&this.parseSubNode(s,r,i)}return r.propertyList=o,"number"==typeof l&&(r.id=l),""!==u&&(r.attrName=u),""!==c&&(r.attrType=c),""!==s&&(r.name=s),r}parseSubNode(e,t,r){if(!0===r.singleProperty){let e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){let e=[];r.propertyList.forEach(function(t,r){0!==r&&e.push(t)}),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name)Object.keys(r).forEach(function(e){t[e]=r[e]});else if("Properties70"===e&&"P"===r.name){let e,i=r.propertyList[0],n=r.propertyList[1],a=r.propertyList[2],s=r.propertyList[3];0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),e="Color"===n||"ColorRGB"===n||"Vector"===n||"Vector3D"===n||0===n.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[i]={type:n,type2:a,flag:s,value:e}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){let t;let r=e.getString(1);switch(r){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":let i=e.getUint32(),n=e.getUint32(),a=e.getUint32();if(0===n)switch(r){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}let s=new T0(TV(new Uint8Array(e.getArrayBuffer(a))).buffer);switch(r){case"b":case"c":return s.getBooleanArray(i);case"d":return s.getFloat64Array(i);case"f":return s.getFloat32Array(i);case"i":return s.getInt32Array(i);case"l":return s.getInt64Array(i)}default:throw Error("THREE.FBXLoader: Unknown property type "+r)}}}class T0{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){let t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return(this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),0x80000000&t)?(t=0xffffffff&~t,0xffffffff==(e=0xffffffff&~e)&&(t=t+1&0xffffffff),-(0x100000000*t+(e=e+1&0xffffffff))):0x100000000*t+e}getInt64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),0x100000000*t+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();let r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),b$(new Uint8Array(t))}}class T1{add(e,t){this[e]=t}}function T2(e){let t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function T3(e){return e/46186158e3}let T4=[];function T5(e,t,r,i){let n;switch(i.mappingType){case"ByPolygonVertex":n=e;break;case"ByPolygon":n=t;break;case"ByVertice":n=r;break;case"AllSame":n=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(n=i.indices[n]);let a=n*i.dataSize,s=a+i.dataSize;return function(e,t,r,i){for(let n=r,a=0;n<i;n++,a++)e[a]=t[n];return e}(T4,i.buffer,a,s)}let T6=new ao,T8=new ni;function T9(e){let t=new n8,r=new n8,i=new n8,n=new n8,a=new n8,s=new n8,o=new n8,l=new n8,u=new n8,c=new n8,h=new n8,d=new n8,f=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(T8.fromArray(e.translation)),e.preRotation){let t=e.preRotation.map(ne.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(T6.fromArray(t))}if(e.rotation){let t=e.rotation.map(ne.degToRad);t.push(e.eulerOrder),i.makeRotationFromEuler(T6.fromArray(t))}if(e.postRotation){let t=e.postRotation.map(ne.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(T6.fromArray(t)),n.invert()}e.scale&&a.scale(T8.fromArray(e.scale)),e.scalingOffset&&o.setPosition(T8.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(T8.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(T8.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(T8.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),c.copy(e.parentMatrixWorld));let p=r.clone().multiply(i).multiply(n),m=new n8;m.extractRotation(c);let g=new n8;g.copyPosition(c);let A=g.clone().invert().multiply(c),v=m.clone().invert().multiply(A),y=new n8;if(0===f)y.copy(m).multiply(p).multiply(v).multiply(a);else if(1===f)y.copy(m).multiply(v).multiply(p).multiply(a);else{let e=new n8().scale(new ni().setFromMatrixScale(h)).clone().invert(),t=v.clone().multiply(e);y.copy(m).multiply(p).multiply(t).multiply(a)}let E=u.clone().invert(),x=s.clone().invert(),_=t.clone().multiply(l).multiply(u).multiply(r).multiply(i).multiply(n).multiply(E).multiply(o).multiply(s).multiply(a).multiply(x),b=new n8().copyPosition(_),S=c.clone().multiply(b);return d.copyPosition(S),(_=d.clone().multiply(y)).premultiply(c.invert()),_}function T7(e){return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),"ZYX"):["ZYX","YZX","XZY","ZXY","YXZ","XYZ"][e]}function Ie(e){return e.split(",").map(function(e){return parseFloat(e)})}function It(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),b$(new Uint8Array(e,t,r))}function Ir(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}function Ii(e){return d$(TK,e)}function In({path:e,...t}){let r=Ii(e).children[0];return eN.createElement(bP,eU({},t,{object:r}))}Ii.preload=e=>d$.preload(TK,e),Ii.clear=e=>d$.clear(TK,e);class Ia{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){let t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return -1}_onMessage(e,t){let r=this.workersResolve[e];if(r&&r(t),this.queue.length){let{resolve:t,msg:r,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(r,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(r=>{let i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=r,this.workers[i].postMessage(e,t)):this.queue.push({resolve:r,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class Is{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Io{constructor(e,t,r,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=i,this._offset=0}_nextUint8(){let e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){let e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){let e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){let e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e+0x100000000*t}_nextInt32(){let e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){let t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);let r=this._offset,i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,i)}}let Il=[171,75,84,88,32,50,48,187,13,10,26,10];function Iu(e){return"undefined"!=typeof TextDecoder?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}let Ic={env:{emscripten_notify_memory_growth:function(e){V=new Uint8Array(Q.exports.memory.buffer)}}};class Ih{init(){return H||("undefined"!=typeof fetch?H=fetch("data:application/wasm;base64,"+Id).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Ic)).then(this._init):H=WebAssembly.instantiate(Buffer.from(Id,"base64"),Ic).then(this._init)),H}_init(e){Q=e.instance,Ic.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Q)throw Error("ZSTDDecoder: Await .init() before decoding.");let r=e.byteLength,i=Q.exports.malloc(r);V.set(e,i),t=t||Number(Q.exports.ZSTD_findDecompressedSize(i,r));let n=Q.exports.malloc(t),a=Q.exports.ZSTD_decompress(n,t,i,r),s=V.slice(n,n+a);return Q.exports.free(i),Q.exports.free(n),s}}let Id="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";class If extends ld{constructor(e,t,r){super(void 0,e[0].width,e[0].height,t,r,tz),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class Ip extends ld{constructor(e,t,r,i,n,a){super(e,t,r,n,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=tj}}class Im extends nC{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=tK,this.minFilter=tK,this.wrapR=tj,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}var Ig=Object.defineProperty,IA=(e,t,r)=>t in e?Ig(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Iv=(e,t,r)=>(IA(e,"symbol"!=typeof t?t+"":t,r),r);let Iy="srgb",IE=new WeakMap,Ix=0,I_=(()=>{let e=class extends u4{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Ia,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){let t=new u8(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);let r=t.loadAsync("basis_transcoder.js"),i=new u8(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);let n=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([r,n]).then(([t,r])=>{let i=e.BasisWorker.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(e.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(e.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(e.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n])),this.transcoderBinary=r,this.workerPool.setWorkerCreator(()=>{let e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e})}),Ix>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Ix++}return this.transcoderPending}load(e,t,r,i){if(null===this.workerConfig)throw Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");let n=new u8(this.manager);n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials),n.load(e,e=>{if(IE.has(e))return IE.get(e).promise.then(t).catch(i);this._createTexture(e).then(e=>t?t(e):null).catch(i)},r,i)}_createTextureFrom(e,t){let r;let{faces:i,width:n,height:a,format:s,type:o,error:l,dfdFlags:u}=e;if("error"===o)return Promise.reject(l);if(6===t.faceCount)r=new If(i,s,t4);else{let e=i[0].mipmaps;r=t.layerCount>1?new Ip(e,n,a,t.layerCount,s,t4):new ld(e,n,a,s,t4)}r.minFilter=1===i[0].mipmaps.length?tZ:t2,r.magFilter=tZ,r.generateMipmaps=!1,r.needsUpdate=!0;let c=IT(t);return"colorSpace"in r?r.colorSpace=c:r.encoding=c===Iy?3001:3e3,r.premultiplyAlpha=!!(1&u),r}async _createTexture(e,t={}){let r=function(e){let t=new Uint8Array(e.buffer,e.byteOffset,Il.length);if(t[0]!==Il[0]||t[1]!==Il[1]||t[2]!==Il[2]||t[3]!==Il[3]||t[4]!==Il[4]||t[5]!==Il[5]||t[6]!==Il[6]||t[7]!==Il[7]||t[8]!==Il[8]||t[9]!==Il[9]||t[10]!==Il[10]||t[11]!==Il[11])throw Error("Missing KTX 2.0 identifier.");let r=new Is,i=17*Uint32Array.BYTES_PER_ELEMENT,n=new Io(e,Il.length,i,!0);r.vkFormat=n._nextUint32(),r.typeSize=n._nextUint32(),r.pixelWidth=n._nextUint32(),r.pixelHeight=n._nextUint32(),r.pixelDepth=n._nextUint32(),r.layerCount=n._nextUint32(),r.faceCount=n._nextUint32();let a=n._nextUint32();r.supercompressionScheme=n._nextUint32();let s=n._nextUint32(),o=n._nextUint32(),l=n._nextUint32(),u=n._nextUint32(),c=n._nextUint64(),h=n._nextUint64(),d=new Io(e,Il.length+i,24*a,!0);for(let t=0;t<a;t++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});let f=new Io(e,s,o,!0),p={vendorId:f._skip(4)._nextUint16(),descriptorType:f._nextUint16(),versionNumber:f._nextUint16(),descriptorBlockSize:f._nextUint16(),colorModel:f._nextUint8(),colorPrimaries:f._nextUint8(),transferFunction:f._nextUint8(),flags:f._nextUint8(),texelBlockDimension:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],bytesPlane:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],samples:[]},m=(p.descriptorBlockSize/4-6)/4;for(let e=0;e<m;e++){let t={bitOffset:f._nextUint16(),bitLength:f._nextUint8(),channelType:f._nextUint8(),samplePosition:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=f._nextInt32(),t.sampleUpper=f._nextInt32()):(t.sampleLower=f._nextUint32(),t.sampleUpper=f._nextUint32()),p.samples[e]=t}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(p);let g=new Io(e,l,u,!0);for(;g._offset<u;){let e=g._nextUint32(),t=g._scan(e),i=Iu(t);if(r.keyValue[i]=g._nextUint8Array(e-t.byteLength-1),i.match(/^ktx/i)){let e=Iu(r.keyValue[i]);r.keyValue[i]=e.substring(0,e.lastIndexOf("\0"))}let n=e%4?4-e%4:0;g._skip(n)}if(h<=0)return r;let A=new Io(e,c,h,!0),v=A._nextUint16(),y=A._nextUint16(),E=A._nextUint32(),x=A._nextUint32(),_=A._nextUint32(),b=A._nextUint32(),S=[];for(let e=0;e<a;e++)S.push({imageFlags:A._nextUint32(),rgbSliceByteOffset:A._nextUint32(),rgbSliceByteLength:A._nextUint32(),alphaSliceByteOffset:A._nextUint32(),alphaSliceByteLength:A._nextUint32()});let w=c+A._offset,C=w+E,T=C+x,I=T+_,M=new Uint8Array(e.buffer,e.byteOffset+w,E),R=new Uint8Array(e.buffer,e.byteOffset+C,x),B=new Uint8Array(e.buffer,e.byteOffset+T,_),D=new Uint8Array(e.buffer,e.byteOffset+I,b);return r.globalData={endpointCount:v,selectorCount:y,imageDescs:S,endpointsData:M,selectorsData:R,tablesData:B,extendedData:D},r}(new Uint8Array(e));if(0!==r.vkFormat)return IC(r);let i=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:t},[e])).then(e=>this._createTextureFrom(e.data,r));return IE.set(e,{promise:i}),i}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Ix--,this}};return Iv(e,"BasisFormat",{ETC1S:0,UASTC_4x4:1}),Iv(e,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),Iv(e,"EngineFormat",{RGBAFormat:ru,RGBA_ASTC_4x4_Format:rM,RGBA_BPTC_Format:rQ,RGBA_ETC2_EAC_Format:rI,RGBA_PVRTC_4BPPV1_Format:rS,RGBA_S3TC_DXT5_Format:rx,RGB_ETC1_Format:rC,RGB_ETC2_Format:rT,RGB_PVRTC_4BPPV1_Format:r_,RGB_S3TC_DXT1_Format:rv}),Iv(e,"BasisWorker",function(){let e,t,r;let i=_EngineFormat,n=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",function(s){let c=s.data;switch(c.type){case"init":var h;e=c.config,h=c.transcoderBinary,t=new Promise(e=>{BASIS(r={wasmBinary:h,onRuntimeInitialized:e})}).then(()=>{r.initializeBasis(),void 0===r.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":t.then(()=>{try{let{faces:t,buffers:s,width:h,height:d,hasAlpha:f,format:p,dfdFlags:m}=function(t){let s=new r.KTX2File(new Uint8Array(t));function c(){s.close(),s.delete()}if(!s.isValid())throw c(),Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let h=s.isUASTC()?a.UASTC_4x4:a.ETC1S,d=s.getWidth(),f=s.getHeight(),p=s.getLayers()||1,m=s.getLevels(),g=s.getFaces(),A=s.getHasAlpha(),v=s.getDFDFlags(),{transcoderFormat:y,engineFormat:E}=function(t,r,s,c){let h;let d=t===a.ETC1S?o:l;for(let i=0;i<d.length;i++){let n=d[i];if(e[n.if]&&n.basisFormat.includes(t)&&(!c||!(n.transcoderFormat.length<2))&&(!n.needsPowerOfTwo||u(r)&&u(s)))return{transcoderFormat:n.transcoderFormat[c?1:0],engineFormat:n.engineFormat[c?1:0]}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:n.RGBA32,engineFormat:i.RGBAFormat}}(h,d,f,A);if(!d||!f||!m)throw c(),Error("THREE.KTX2Loader:	Invalid texture");if(!s.startTranscoding())throw c(),Error("THREE.KTX2Loader: .startTranscoding failed");let x=[],_=[];for(let e=0;e<g;e++){let t=[];for(let r=0;r<m;r++){let i,n;let a=[];for(let t=0;t<p;t++){let o=s.getImageLevelInfo(r,t,e);0===e&&0===r&&0===t&&(o.origWidth%4!=0||o.origHeight%4!=0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),m>1?(i=o.origWidth,n=o.origHeight):(i=o.width,n=o.height);let l=new Uint8Array(s.getImageTranscodedSizeInBytes(r,t,0,y));if(!s.transcodeImage(l,r,t,e,y,0,-1,-1))throw c(),Error("THREE.KTX2Loader: .transcodeImage failed.");a.push(l)}let o=function(e){if(1===e.length)return e[0];let t=0;for(let r=0;r<e.length;r++)t+=e[r].byteLength;let r=new Uint8Array(t),i=0;for(let t=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.byteLength}return r}(a);t.push({data:o,width:i,height:n}),_.push(o.buffer)}x.push({mipmaps:t,width:d,height:f,format:E})}return c(),{faces:x,buffers:_,width:d,height:f,hasAlpha:A,format:E,dfdFlags:v}}(c.buffer);self.postMessage({type:"transcode",id:c.id,faces:t,width:h,height:d,hasAlpha:f,format:p,dfdFlags:m},s)}catch(e){console.error(e),self.postMessage({type:"error",id:c.id,error:e.message})}})}});let s=[{if:"astcSupported",basisFormat:[a.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],o=s.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),l=s.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function u(e){return e<=2||(e&e-1)==0&&0!==e}}),e})(),Ib=new Set([ru,rp,rd]),IS={109:ru,97:ru,37:ru,43:ru,103:rp,83:rp,16:rp,22:rp,100:rd,76:rd,15:rd,9:rd,166:rP,165:rP},Iw={109:re,97:rt,37:t4,43:t4,103:re,83:rt,16:t4,22:t4,100:re,76:rt,15:t4,9:t4,166:t4,165:t4};async function IC(e){let t,r;let{vkFormat:i}=e;if(void 0===IS[i])throw Error("THREE.KTX2Loader: Unsupported vkFormat.");2===e.supercompressionScheme&&(W||(W=new Promise(async e=>{let t=new Ih;await t.init(),e(t)})),t=await W);let n=[];for(let r=0;r<e.levels.length;r++){let a,s;let o=Math.max(1,e.pixelWidth>>r),l=Math.max(1,e.pixelHeight>>r),u=e.pixelDepth?Math.max(1,e.pixelDepth>>r):0,c=e.levels[r];if(0===e.supercompressionScheme)a=c.levelData;else if(2===e.supercompressionScheme)a=t.decode(c.levelData,c.uncompressedByteLength);else throw Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");s=Iw[i]===re?new Float32Array(a.buffer,a.byteOffset,a.byteLength/Float32Array.BYTES_PER_ELEMENT):Iw[i]===rt?new Uint16Array(a.buffer,a.byteOffset,a.byteLength/Uint16Array.BYTES_PER_ELEMENT):a,n.push({data:s,width:o,height:l,depth:u})}if(Ib.has(IS[i]))r=0===e.pixelDepth?new oc(n[0].data,e.pixelWidth,e.pixelHeight):new Im(n[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new ld(n,e.pixelWidth,e.pixelHeight)}r.mipmaps=n,r.type=Iw[i],r.format=IS[i],r.needsUpdate=!0;let a=IT(e);return"colorSpace"in r?r.colorSpace=a:r.encoding=a===Iy?3001:3e3,Promise.resolve(r)}function IT(e){let t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?Iy:"srgb-linear":10===t.colorPrimaries?2===t.transferFunction?"display-p3":"display-p3-linear":(0===t.colorPrimaries||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),"")}let II="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master";function IM(e,t=`${II}/basis/`){let r=dY(e=>e.gl),i=d$(I_,bt(e)?Object.values(e):e,e=>{e.detectSupport(r),e.setTranscoderPath(t)});if((0,eN.useEffect)(()=>{(Array.isArray(i)?i:[i]).forEach(r.initTexture)},[r,i]),!bt(e))return i;{let t=Object.keys(e),r={};return t.forEach(e=>Object.assign(r,{[e]:i[t.indexOf(e)]})),r}}IM.preload=(e,t=`${II}/basis/`)=>d$.preload(I_,e,e=>{e.setTranscoderPath(t)}),IM.clear=e=>d$.clear(I_,e);let IR=({children:e,input:t,basisPath:r})=>{let i=IM(t,r);return eN.createElement(eN.Fragment,null,null==e?void 0:e(i))};var IB=r(29614);let ID=((e,t)=>"undefined"!=typeof window&&"function"==typeof(null==(e=window.document)?void 0:e.createElement)&&"string"==typeof(null==(t=window.navigator)?void 0:t.userAgent))(),IP=null;async function IL(...e){var t;null!==(t=IP)&&void 0!==t||(IP=await Promise.resolve().then(r.bind(r,29614)));let i=IP.default;return i.isSupported()?new i(...e):null}function Ik(e,{unsuspend:t="loadedmetadata",start:r=!0,hls:i={},crossOrigin:n="anonymous",muted:a=!0,loop:s=!0,playsInline:o=!0,onVideoFrame:l,...u}={}){let c=dY(e=>e.gl),h=(0,eN.useRef)(null),d=da(()=>new Promise(async r=>{let l,d;"string"==typeof e?l=e:d=e;let f=Object.assign(document.createElement("video"),{src:l,srcObject:d,crossOrigin:n,loop:s,muted:a,playsInline:o,...u});if(l&&ID&&l.endsWith(".m3u8")){let e=h.current=await IL(i);e&&(e.on(IB.Events.MEDIA_ATTACHED,()=>void e.loadSource(l)),e.attachMedia(f))}let p=new lu(f);"colorSpace"in p?p.colorSpace=c.outputColorSpace:p.encoding=c.outputEncoding,f.addEventListener(t,()=>r(p))}),[e]);return IO(d.source.data,l),(0,eN.useEffect)(()=>(r&&d.image.play(),()=>{h.current&&(h.current.destroy(),h.current=null)}),[d,r]),d}let IF=(0,eN.forwardRef)(({children:e,src:t,...r},i)=>{let n=Ik(t,r);return(0,eN.useEffect)(()=>()=>void n.dispose(),[n]),(0,eN.useImperativeHandle)(i,()=>n,[n]),eN.createElement(eN.Fragment,null,null==e?void 0:e(n))}),IO=(e,t)=>{(0,eN.useEffect)(()=>{let r;if(!t||!e.requestVideoFrameCallback)return;let i=(...n)=>{t(...n),r=e.requestVideoFrameCallback(i)};return e.requestVideoFrameCallback(i),()=>e.cancelVideoFrameCallback(r)},[e,t])},IU=(e,t)=>{if(Array.isArray(e))return e[0];{let r=null!=t?t:Object.keys(e)[0];return e[r][0]}},IN=e=>{for(let t=3;t<e.length;t+=4)if(0!==e[t])return!1;return!0};function Iz(e,t,r,i,n,a){let s=eN.useRef(dY(e=>e.viewport)),o=eN.useRef(null),l=eN.useRef(0),u=eN.useRef(e),c=eN.useRef(t),h=eN.useRef(r),[d,f]=(0,eN.useState)(null),[p,m]=eN.useState(new nC),g=eN.useMemo(()=>new cn,[]),[A,v]=(0,eN.useState)(null),y=eN.useCallback((e,t,r)=>{let i=t*(s.current.aspect>e/t?s.current.width/e:s.current.height/t),n=e*(s.current.aspect>e/t?s.current.width/e:s.current.height/t)*r,a=i*r,o=Math.min(1,n),l=Math.min(1,a);return n>1&&(o=1,l=a/n*1),new ni(o,l,1)},[]),E=eN.useCallback((e,t)=>{if(!e.image)return{rows:0,columns:0,frameWidth:0,frameHeight:0,emptyFrames:[]};{let r=document.createElement("canvas"),i=r.getContext("2d",a);if(!i)throw Error("Failed to get 2d context");r.width=e.image.width,r.height=e.image.height,i.drawImage(e.image,0,0);let n=e.image.width,s=e.image.height,o=Math.round(Math.sqrt(n/s*t)),l=Math.round(t/o),u=n/o,c=s/l,h=[];for(let e=0;e<l;e++)for(let r=0;r<o;r++){if(e*o+r>=t){h.push({row:e,col:r});continue}IN(i.getImageData(r*u,e*c,u,c).data)&&h.push({row:e,col:r})}return{rows:l,columns:o,frameWidth:u,frameHeight:c,emptyFrames:h}}},[a]),x=eN.useCallback(e=>{let t=e=>{let t=null;for(let r of e){let{w:e,h:i}=r.frame,n=e*i;(!t||n>t.area)&&(t={w:e,h:i,area:n})}return e.map(e=>{let{w:r,h:i}=e.frame,n=r*i,a=t?n===t.area?1:Math.sqrt(n/t.area):1;return{...e,scaleRatio:a}})};if(Array.isArray(e))return t(e);{let r={};for(let i in e)r[i]=t(e[i]);return r}},[]),_=eN.useCallback(()=>{let e={},t=o.current,r=h.current;if(t){if(r&&Array.isArray(t.frames)){for(let i=0;i<r.length;i++)for(let n of(e[r[i]]=[],t.frames)){let t=n.frame,a=n.sourceSize.w,s=n.sourceSize.h;"string"==typeof n.filename&&-1!==n.filename.toLowerCase().indexOf(r[i].toLowerCase())&&e[r[i]].push({...n,frame:t,sourceSize:{w:a,h:s}})}for(let t in e){let r=x(e[t]);Array.isArray(r)&&(e[t]=r)}return e}if(r&&"object"==typeof t.frames){for(let i=0;i<r.length;i++)for(let n in e[r[i]]=[],t.frames){let a=t.frames[n],s=a.frame,o=a.sourceSize.w,l=a.sourceSize.h;"string"==typeof n&&-1!==n.toLowerCase().indexOf(r[i].toLowerCase())&&e[r[i]].push({...a,frame:s,sourceSize:{w:o,h:l}})}for(let t in e){let r=x(e[t]);Array.isArray(r)&&(e[t]=r)}return e}{let e=[];return null!=t&&t.frames&&(e=Array.isArray(t.frames)?t.frames.map(e=>({...e,x:e.frame.x,y:e.frame.y,w:e.frame.w,h:e.frame.h})):Object.values(t.frames).flat().map(e=>({...e,x:e.frame.x,y:e.frame.y,w:e.frame.w,h:e.frame.h}))),x(e)}}return[]},[x,o]),b=eN.useCallback((e,t)=>{let r=new ni(1,1,1);if(null===e){if(t&&i){let e=t.image.width,n=t.image.height;l.current=i;let{rows:a,columns:s,frameWidth:u,frameHeight:c,emptyFrames:h}=E(t,i),d={frames:[],meta:{version:"1.0",size:{w:e,h:n},rows:a,columns:s,frameWidth:u,frameHeight:c,scale:"1"}};for(let e=0;e<a;e++)for(let t=0;t<s;t++)!(null!=h?h:[]).some(r=>r.row===e&&r.col===t)&&Array.isArray(d.frames)&&d.frames.push({frame:{x:t*u,y:e*c,w:u,h:c},scaleRatio:1,rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:u,h:c},sourceSize:{w:u,h:c}});r=y(u,c,.1),o.current=d}o.current&&o.current.frames&&(o.current.frames=x(o.current.frames))}else if(t){o.current=e,o.current.frames=_(),l.current=Array.isArray(e.frames)?e.frames.length:Object.keys(e.frames).length;let{w:t,h:i}=IU(e.frames).sourceSize;r=y(t,i,.1)}f(o.current),"encoding"in t?t.encoding=3001:"colorSpace"in t&&(t.colorSpace=il),m(t),v({spriteTexture:t,spriteData:o.current,aspect:r})},[E,i,_,y,x]),S=eN.useCallback((e,t,r)=>{Promise.all([fetch(e).then(e=>e.json()),new Promise(e=>{g.load(t,e)})]).then(e=>{r(e[0],e[1])})},[g]),w=eN.useCallback(e=>{if(!e&&!u.current)throw Error("Either textureUrl or input must be provided");let t=null!=e?e:u.current;if(!t)throw Error("A valid texture URL must be provided");g.load(t,e=>b(null,e))},[g,b]),C=eN.useCallback((e,t)=>{t&&e?S(t,e,b):w(e)},[S,w,b]);return eN.useLayoutEffect(()=>{c.current&&u.current?S(c.current,u.current,b):u.current&&w();let e=u.current;return()=>{e&&d$.clear(cn,e)}},[S,w,b]),eN.useLayoutEffect(()=>{null==n||n(p,null!=d?d:null)},[p,d,n]),{spriteObj:A,loadJsonAndTexture:C}}function IG(e,t,...r){let i=eN.useRef(),n=dY(e=>e.scene);return eN.useLayoutEffect(()=>{let a;if(e&&null!=e&&e.current&&t&&(i.current=a=new t(e.current,...r)),a)return a.traverse(e=>e.raycast=()=>null),n.add(a),()=>{i.current=void 0,n.remove(a),null==a.dispose||a.dispose()}},[n,t,e,...r]),dK(()=>{var e;null==(e=i.current)||null==e.update||e.update()}),i}Iz.preload=e=>d$.preload(cn,e),Iz.clear=e=>d$.clear(cn,e);let IH=({type:e,args:t=[]})=>{let r=eN.useRef(null),i=eN.useRef(null);return eN.useLayoutEffect(()=>{i.current=r.current.parent}),IG(i,e,...t),eN.createElement("object3D",{ref:r})};var IQ=r(5379),IV=r.n(IQ);function IW(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function Ij({showPanel:e=0,className:t,parent:r}){let i=function(e,t=[],r){let[i,n]=eN.useState();return eN.useLayoutEffect(()=>{let t=e();return n(t),IW(void 0,t),()=>IW(void 0,null)},t),i}(()=>new(IV()),[]);return eN.useEffect(()=>{if(i){let n=r&&r.current||document.body;i.showPanel(e),null==n||n.appendChild(i.dom);let a=(null!=t?t:"").split(" ").filter(e=>e);a.length&&i.dom.classList.add(...a);let s=dG(()=>i.begin()),o=dH(()=>i.end());return()=>{a.length&&i.dom.classList.remove(...a),null==n||n.removeChild(i.dom),s(),o()}}},[r,i,t,e]),null}class IY{constructor(e,t,r){this.name=e,this.fg=t,this.bg=r,this.gradient=null,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width="90px",this.canvas.style.height="48px",this.canvas.style.position="absolute",this.canvas.style.cssText="width:90px;height:48px",this.context=this.canvas.getContext("2d"),this.initializeCanvas()}createGradient(){let e;if(!this.context)throw Error("No context");let t=this.context.createLinearGradient(0,this.GRAPH_Y,0,this.GRAPH_Y+this.GRAPH_HEIGHT),r=this.fg;switch(this.fg.toLowerCase()){case"#0ff":e="#006666";break;case"#0f0":e="#006600";break;case"#ff0":e="#666600";break;case"#e1e1e1":e="#666666";break;default:e=this.bg}return t.addColorStop(0,e),t.addColorStop(1,r),t}initializeCanvas(){this.context&&(this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.gradient=this.createGradient(),this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillStyle=this.fg,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t,r,i,n=0){if(!this.context||!this.gradient)return;let a=Math.min(1/0,e),s=Math.max(r,e);i=Math.max(i,t),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(`${e.toFixed(n)} ${this.name} (${a.toFixed(n)}-${parseFloat(s.toFixed(n))})`,this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT);let o=this.GRAPH_HEIGHT-(1-t/i)*this.GRAPH_HEIGHT;o>0&&(this.context.globalAlpha=1,this.context.fillStyle=this.gradient,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y+this.GRAPH_HEIGHT-o,this.PR,o))}}let IK=class e{constructor({trackGPU:t=!1,logsPerSecond:r=30,samplesLog:i=60,samplesGraph:n=10,precision:a=2,minimal:s=!1,horizontal:o=!0,mode:l=0}={}){this.gl=null,this.ext=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.frames=0,this.renderCount=0,this.isRunningCPUProfiling=!1,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.totalFps=0,this.gpuPanel=null,this.gpuPanelCompute=null,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.handleClick=e=>{e.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},this.handleResize=()=>{this.resizePanel(this.fpsPanel,0),this.resizePanel(this.msPanel,1),this.gpuPanel&&this.resizePanel(this.gpuPanel,2),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute,3)},this.mode=l,this.horizontal=o,this.minimal=s,this.trackGPU=t,this.samplesLog=i,this.samplesGraph=n,this.precision=a,this.logsPerSecond=r,this.dom=document.createElement("div"),this.initializeDOM(),this.beginTime=performance.now(),this.prevTime=this.beginTime,this.prevCpuTime=this.beginTime,this.fpsPanel=this.addPanel(new e.Panel("FPS","#0ff","#002"),0),this.msPanel=this.addPanel(new e.Panel("CPU","#0f0","#020"),1),this.setupEventListeners()}initializeDOM(){this.dom.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      opacity: 0.9;
      z-index: 10000;
      ${this.minimal?"cursor: pointer;":""}
    `}setupEventListeners(){this.minimal?(this.dom.addEventListener("click",this.handleClick),this.showPanel(this.mode)):window.addEventListener("resize",this.handleResize)}async init(e){if(!e){console.error('Stats: The "canvas" parameter is undefined.');return}if(this.handleThreeRenderer(e)||!await this.handleWebGPURenderer(e)&&!this.initializeWebGL(e))return}handleThreeRenderer(e){return!!e.isWebGLRenderer&&!this.threeRendererPatched&&(this.patchThreeRenderer(e),this.gl=e.getContext(),this.trackGPU&&this.initializeGPUTracking(),!0)}async handleWebGPURenderer(e){return!!e.isWebGPURenderer&&(this.trackGPU&&(e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query")&&this.initializeWebGPUPanels()),this.info=e.info,!0)}initializeWebGPUPanels(){this.gpuPanel=this.addPanel(new e.Panel("GPU","#ff0","#220"),2),this.gpuPanelCompute=this.addPanel(new e.Panel("CPT","#e1e1e1","#212121"),3)}initializeWebGL(e){if(e instanceof WebGL2RenderingContext)this.gl=e;else if(!(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas))return console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas."),!1;else if(this.gl=e.getContext("webgl2"),!this.gl)return console.error("Stats: Unable to obtain WebGL2 context."),!1;return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new e.Panel("GPU","#ff0","#220"),2)))}begin(){this.isRunningCPUProfiling||this.beginProfiling("cpu-started"),this.gl&&this.ext&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null)}update(){this.info?this.processWebGPUTimestamps():this.processGpuQueries(),this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.updateAverages(),this.resetCounters()}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp,this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu)}resetCounters(){this.renderCount=0,0===this.totalCpuDuration&&this.beginProfiling("cpu-started"),this.totalCpuDuration=0,this.totalFps=0,this.beginTime=this.endInternal()}resizePanel(e,t){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=t*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=t*e.HEIGHT/e.PR+"px"))}addPanel(e,t){return e.canvas&&(this.dom.appendChild(e.canvas),this.resizePanel(e,t)),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++)this.dom.children[t].style.display=t===e?"block":"none";this.mode=e}processGpuQueries(){this.gl&&this.ext&&(this.totalGpuDuration=0,this.gpuQueries.forEach((e,t)=>{if(this.gl){let r=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),i=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(r&&!i){let r=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT);this.totalGpuDuration+=1e-6*r,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1)}}}))}endInternal(){this.frames++;let e=(performance||Date).now(),t=e-this.prevTime;if(e>=this.prevCpuTime+1e3/this.logsPerSecond){let r=Math.round(1e3*this.frames/t);this.addToAverage(r,this.averageFps),this.updatePanel(this.fpsPanel,this.averageFps,0),this.updatePanel(this.msPanel,this.averageCpu,this.precision),this.updatePanel(this.gpuPanel,this.averageGpu,this.precision),this.gpuPanelCompute&&this.updatePanel(this.gpuPanelCompute,this.averageGpuCompute),this.frames=0,this.prevCpuTime=e,this.prevTime=e}return e}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&t.logs.shift(),t.graph.push(e),t.graph.length>this.samplesGraph&&t.graph.shift()}beginProfiling(e){window.performance&&(window.performance.mark(e),this.isRunningCPUProfiling=!0)}endProfiling(e,t,r){if(window.performance&&t&&this.isRunningCPUProfiling){window.performance.mark(t);let i=performance.measure(r,e,t);this.totalCpuDuration+=i.duration,this.isRunningCPUProfiling=!1}}updatePanel(e,t,r=2){if(t.logs.length>0){let i=0,n=.01;for(let e=0;e<t.logs.length;e++)i+=t.logs[e],t.logs[e]>n&&(n=t.logs[e]);let a=0,s=.01;for(let e=0;e<t.graph.length;e++)a+=t.graph[e],t.graph[e]>s&&(s=t.graph[e]);e&&e.update(i/Math.min(t.logs.length,this.samplesLog),a/Math.min(t.graph.length,this.samplesGraph),n,s,r)}}get domElement(){return this.dom}patchThreeRenderer(e){let t=e.render,r=this;e.render=function(e,i){r.begin(),t.call(this,e,i),r.end()},this.threeRendererPatched=!0}};IK.Panel=IY;let Iq=eN.forwardRef(function({className:e,parent:t,id:r,clearStatsGlStyle:i,...n},a){let s=dY(e=>e.gl),o=eN.useMemo(()=>{let e=new IK({...n});return e.init(s),e},[s]);return eN.useImperativeHandle(a,()=>o.domElement,[o]),eN.useEffect(()=>{if(o){let n=t&&t.current||document.body;null==n||n.appendChild(o.domElement),o.domElement.querySelectorAll("canvas").forEach(e=>{e.style.removeProperty("position")}),r&&(o.domElement.id=r),i&&o.domElement.removeAttribute("style"),o.domElement.removeAttribute("style");let a=(null!=e?e:"").split(" ").filter(e=>e);a.length&&o.domElement.classList.add(...a);let s=dH(()=>o.update());return()=>{a.length&&o.domElement.classList.remove(...a),null==n||n.removeChild(o.domElement),s()}}},[t,o,e,r,i]),null});function IX({size:e=256,frames:t=1/0}={}){let r=dY(e=>e.viewport.dpr),{width:i,height:n}=dY(e=>e.size),a=e||i*r,s=e||n*r,o=eN.useMemo(()=>{let e=new lg(a,s);return e.format=rc,e.type=t8,{depthTexture:e}},[a,s]),l=0,u=SX(a,s,o);return dK(e=>{(t===1/0||l<t)&&(e.gl.setRenderTarget(u),e.gl.render(e.scene,e.camera),e.gl.setRenderTarget(null),l++)}),u.depthTexture}function I$(e,t,r=1){let i=dY(e=>e.viewport),n=t*(i.aspect>e/t?i.width/e:i.height/t);return[e*(i.aspect>e/t?i.width/e:i.height/t)*r,n*r,1]}function IJ(e,t){let r=dY(e=>e.pointer),[i]=eN.useState(()=>{let i=new hf;return t&&d1(i,t,{}),function(t,n){i.setFromCamera(r,e instanceof sI?e:e.current);let a=this.constructor.prototype.raycast.bind(this);a&&a(i,n)}});return i}function IZ(e,t,r,i){return new(r||(r=Promise))(function(n,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,o)}l((i=i.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;let I0=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function I1(e){return e=e.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}let I2="undefined"==typeof window,I3=(()=>{if(I2)return;let{userAgent:e,platform:t,maxTouchPoints:r}=window.navigator,i=/(iphone|ipod|ipad)/i.test(e),n="iPad"===t||"MacIntel"===t&&r>0&&!window.MSStream;return{isIpad:n,isMobile:/android/i.test(e)||i||n,isSafari12:/Version\/12.+Safari/.test(e),isFirefox:/Firefox/.test(e)}})();class I4 extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}let I5=[],I6=[];function I8(e){return null!=e}let I9=({mobileTiers:e=[0,15,30,60],desktopTiers:t=[0,15,30,60],override:r={},glContext:i,failIfMajorPerformanceCaveat:n=!1,benchmarksURL:a="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>IZ(void 0,void 0,void 0,function*(){let s={};if(I2)return{tier:0,type:"SSR"};let{isIpad:o=!!(null==I3?void 0:I3.isIpad),isMobile:l=!!(null==I3?void 0:I3.isMobile),screenSize:u=window.screen,loadBenchmarks:c=e=>IZ(void 0,void 0,void 0,function*(){let t=yield fetch(`${a}/${e}`).then(e=>e.json());if(4>parseInt(t.shift().split(".")[0],10))throw new I4("Detect GPU benchmark data is out of date. Please update to version 4x");return t})}=r,{renderer:h}=r,d=(e,t,r,i,n)=>({device:n,fps:i,gpu:r,isMobile:l,tier:e,type:t}),f,p="";if(h)f=[h=I1(h)];else{var m;let e=i||function(e,t=!1){let r={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:t,powerPreference:"high-performance",stencil:!1};e&&delete r.powerPreference;let i=window.document.createElement("canvas"),n=i.getContext("webgl",r)||i.getContext("experimental-webgl",r);return null!=n?n:void 0}(null==I3?void 0:I3.isSafari12,n);if(!e)return d(0,"WEBGL_UNSUPPORTED");let t=(null==I3?void 0:I3.isFirefox)?null:e.getExtension("WEBGL_debug_renderer_info");if(!(h=t?e.getParameter(t.UNMASKED_RENDERER_WEBGL):e.getParameter(e.RENDERER)))return d(1,"FALLBACK");p=h,f="apple gpu"===(m=h=I1(h))?function(e,t,r){let i;if(!r)return[t];let n=function(e){let t=e.createShader(35633),r=e.createShader(35632),i=e.createProgram();if(!(r&&t&&i))return;e.shaderSource(t,"\n    precision highp float;\n    attribute vec3 aPosition;\n    varying float vvv;\n    void main() {\n      vvv = 0.31622776601683794;\n      gl_Position = vec4(aPosition, 1.0);\n    }\n  "),e.shaderSource(r,"\n    precision highp float;\n    varying float vvv;\n    void main() {\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n      enc = fract(enc);\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n      gl_FragColor = enc;\n    }\n  "),e.compileShader(t),e.compileShader(r),e.attachShader(i,t),e.attachShader(i,r),e.linkProgram(i),e.detachShader(i,t),e.detachShader(i,r),e.deleteShader(t),e.deleteShader(r),e.useProgram(i);let n=e.createBuffer();e.bindBuffer(34962,n),e.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);let a=e.getAttribLocation(i,"aPosition");e.vertexAttribPointer(a,3,5126,!1,0,0),e.enableVertexAttribArray(a),e.clearColor(1,1,1,1),e.clear(16384),e.viewport(0,0,1,1),e.drawArrays(4,0,3);let s=new Uint8Array(4);return e.readPixels(0,0,1,1,6408,5121,s),e.deleteProgram(i),e.deleteBuffer(n),s.join("")}(e),a="801621810",s="8016218135",o="80162181161",l=(null==I3?void 0:I3.isIpad)?[["a7",o,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",a,15],["a12x",a,15],["a12z",a,15],["a14",a,15],["a15",a,15],["m1",a,15],["m2",a,15]]:[["a7",o,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",a,15],["a12",a,15],["a13",a,15],["a14",a,15],["a15",a,15],["a16",a,15],["a17",a,15]];return"80162181255"===n?i=l.filter(([,,e])=>e>=14):(i=l.filter(([,e])=>e===n)).length||(i=l),i.map(([e])=>`apple ${e} gpu`)}(e,m,l):[m]}let g=(yield Promise.all(f.map(function(e){var t;return IZ(this,void 0,void 0,function*(){let r;let i=(e=>{for(let t of l?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"])if(e.includes(t))return t})(e);if(!i)return;let n=`${l?"m":"d"}-${i}${o?"-ipad":""}.json`,a=s[n]=null!==(t=s[n])&&void 0!==t?t:c(n);try{r=yield a}catch(e){if(e instanceof I4)throw e;return}let h=function(e){var t;let r=(e=e.replace(/\([^)]+\)/,"")).match(/\d+/)||e.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return null!==(t=null==r?void 0:r.join("").replace(/\W|amd/g,""))&&void 0!==t?t:""}(e),d=r.filter(([,e])=>e===h);d.length||(d=r.filter(([t])=>t.includes(e)));let f=d.length;if(0===f)return;let p=e.split(/[.,()\[\]/\s]/g).sort().filter((e,t,r)=>0===t||e!==r[t-1]).join(" "),m,[g,,,,A]=f>1?d.map(e=>[e,function(e,t){if(e===t)return 0;let r=e;e.length>t.length&&(e=t,t=r);let i=e.length,n=t.length;for(;i>0&&e.charCodeAt(~-i)===t.charCodeAt(~-n);)i--,n--;let a,s=0;for(;s<i&&e.charCodeAt(s)===t.charCodeAt(s);)s++;if(i-=s,n-=s,0===i)return n;let o,l,u=0,c=0,h=0;for(;c<i;)I6[c]=e.charCodeAt(s+c),I5[c]=++c;for(;h<n;)for(a=t.charCodeAt(s+h),o=h++,u=h,c=0;c<i;c++)l=a===I6[c]?o:o+1,o=I5[c],u=I5[c]=o>u?l>u?u+1:l:l>o?o+1:l;return u}(p,e[2])]).sort(([,e],[,t])=>e-t)[0][0]:d[0],v=Number.MAX_VALUE,{devicePixelRatio:y}=window,E=u.width*y*u.height*y;for(let e of A){let[t,r]=e,i=Math.abs(E-t*r);i<v&&(v=i,m=e)}if(!m)return;let[,,x,_]=m;return[v,x,g,_]})}))).filter(I8).sort(([e=Number.MAX_VALUE,t],[r=Number.MAX_VALUE,i])=>e===r?t-i:e-r);if(!g.length){let e=I0.find(e=>h.includes(e));return e?d(0,"BLOCKLISTED",e):d(1,"FALLBACK",`${h} (${p})`)}let[,A,v,y]=g[0];if(-1===A)return d(0,"BLOCKLISTED",v,A,y);let E=l?e:t,x=0;for(let e=0;e<E.length;e++)A>=E[e]&&(x=e);return d(x,"BENCHMARK",v,A,y)}),I7=e=>da(()=>I9(e),["useDetectGPU"]);function Me({children:e,...t}){let r=I7(t);return eN.createElement(eN.Fragment,null,null==e?void 0:e(r))}let Mt=2,Mr=Symbol("SKIP_GENERATION");function Mi(e,t,r){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(r.ray.origin),e.object=t,e)}function Mn(e){return e.index?e.index.count:e.attributes.position.count}function Ma(e){return Mn(e)/3}function Ms(e,t=ArrayBuffer){return e>65535?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}function Mo(e,t){let r=Ma(e),i=t||e.drawRange,n=i.start/3,a=(i.start+i.count)/3,s=Math.max(0,n),o=Math.min(r,a)-s;return[{offset:Math.floor(s),count:Math.floor(o)}]}function Ml(e,t){if(!e.groups||!e.groups.length)return Mo(e,t);let r=[],i=new Set,n=t||e.drawRange,a=n.start/3,s=(n.start+n.count)/3;for(let t of e.groups){let e=t.start/3,r=(t.start+t.count)/3;i.add(Math.max(a,e)),i.add(Math.min(s,r))}let o=Array.from(i.values()).sort((e,t)=>e-t);for(let e=0;e<o.length-1;e++){let t=o[e],i=o[e+1];r.push({offset:Math.floor(t),count:Math.floor(i-t)})}return r}function Mu(e,t,r,i,n){let a=1/0,s=1/0,o=1/0,l=-1/0,u=-1/0,c=-1/0,h=1/0,d=1/0,f=1/0,p=-1/0,m=-1/0,g=-1/0;for(let i=6*t,n=(t+r)*6;i<n;i+=6){let t=e[i+0],r=e[i+1],n=t-r,A=t+r;n<a&&(a=n),A>l&&(l=A),t<h&&(h=t),t>p&&(p=t);let v=e[i+2],y=e[i+3],E=v-y,x=v+y;E<s&&(s=E),x>u&&(u=x),v<d&&(d=v),v>m&&(m=v);let _=e[i+4],b=e[i+5],S=_-b,w=_+b;S<o&&(o=S),w>c&&(c=w),_<f&&(f=_),_>g&&(g=_)}i[0]=a,i[1]=s,i[2]=o,i[3]=l,i[4]=u,i[5]=c,n[0]=h,n[1]=d,n[2]=f,n[3]=p,n[4]=m,n[5]=g}function Mc(e,t,r){return r.min.x=t[e],r.min.y=t[e+1],r.min.z=t[e+2],r.max.x=t[e+3],r.max.y=t[e+4],r.max.z=t[e+5],r}function Mh(e){let t=-1,r=-1/0;for(let i=0;i<3;i++){let n=e[i+3]-e[i];n>r&&(r=n,t=i)}return t}function Md(e,t,r){let i,n;for(let a=0;a<3;a++){let s=a+3;i=e[a],n=t[a],r[a]=i<n?i:n,i=e[s],n=t[s],r[s]=i>n?i:n}}function Mf(e,t,r){for(let i=0;i<3;i++){let n=t[e+2*i],a=t[e+2*i+1],s=n-a,o=n+a;s<r[i]&&(r[i]=s),o>r[i+3]&&(r[i+3]=o)}}function Mp(e){let t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2];return 2*(t*r+r*i+i*t)}let Mm=(e,t)=>e.candidate-t.candidate,Mg=Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),MA=new Float32Array(6);class Mv{constructor(){this.boundingData=new Float32Array(6)}}function My(e,t,r,i,n,a){let s=i,o=i+n-1,l=a.pos,u=2*a.axis;for(;;){for(;s<=o&&r[6*s+u]<l;)s++;for(;s<=o&&r[6*o+u]>=l;)o--;if(!(s<o))return s;for(let e=0;e<3;e++){let r=t[3*s+e];t[3*s+e]=t[3*o+e],t[3*o+e]=r}for(let e=0;e<6;e++){let t=r[6*s+e];r[6*s+e]=r[6*o+e],r[6*o+e]=t}s++,o--}}function ME(e,t,r,i,n,a){let s=i,o=i+n-1,l=a.pos,u=2*a.axis;for(;;){for(;s<=o&&r[6*s+u]<l;)s++;for(;s<=o&&r[6*o+u]>=l;)o--;if(!(s<o))return s;{let t=e[s];e[s]=e[o],e[o]=t;for(let e=0;e<6;e++){let t=r[6*s+e];r[6*s+e]=r[6*o+e],r[6*o+e]=t}s++,o--}}}function Mx(e,t){return 65535===t[e+15]}function M_(e,t){return t[e+14]}class Mb{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let r=1/0,i=-1/0;for(let n=0,a=e.length;n<a;n++){let a=e[n][t];r=a<r?a:r,i=a>i?a:i}this.min=r,this.max=i}setFromPoints(e,t){let r=1/0,i=-1/0;for(let n=0,a=t.length;n<a;n++){let a=t[n],s=e.dot(a);r=s<r?s:r,i=s>i?s:i}this.min=r,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}Mb.prototype.setFromBox=function(){let e=new ni;return function(t,r){let i=r.min,n=r.max,a=1/0,s=-1/0;for(let r=0;r<=1;r++)for(let o=0;o<=1;o++)for(let l=0;l<=1;l++){e.x=i.x*r+n.x*(1-r),e.y=i.y*o+n.y*(1-o),e.z=i.z*l+n.z*(1-l);let u=t.dot(e);a=Math.min(u,a),s=Math.max(u,s)}this.min=a,this.max=s}}(),new Mb;let MS=function(){let e=new ni,t=new ni,r=new ni;return function(i,n,a){let s,o;let l=i.start,u=n.start;r.subVectors(l,u),e.subVectors(i.end,i.start),t.subVectors(n.end,n.start);let c=r.dot(t),h=t.dot(e),d=t.dot(t),f=r.dot(e),p=e.dot(e)*d-h*h;s=0!==p?(c*h-f*d)/p:0,o=(c+s*h)/d,a.x=s,a.y=o}}(),Mw=function(){let e=new nt,t=new ni,r=new ni;return function(i,n,a,s){MS(i,n,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1){i.at(o,a),n.at(l,s);return}if(o>=0&&o<=1){l<0?n.at(0,s):n.at(1,s),i.closestPointToPoint(s,!0,a);return}if(l>=0&&l<=1){o<0?i.at(0,a):i.at(1,a),n.closestPointToPoint(a,!0,s);return}{let e,u;if(e=o<0?i.start:i.end,u=l<0?n.start:n.end,i.closestPointToPoint(u,!0,t),n.closestPointToPoint(e,!0,r),t.distanceToSquared(u)<=r.distanceToSquared(e)){a.copy(t),s.copy(u);return}a.copy(e),s.copy(r);return}}}(),MC=function(){let e=new ni,t=new ni,r=new oC,i=new hR;return function(n,a){let{radius:s,center:o}=n,{a:l,b:u,c}=a;if(i.start=l,i.end=u,i.closestPointToPoint(o,!0,e).distanceTo(o)<=s||(i.start=l,i.end=c,i.closestPointToPoint(o,!0,e).distanceTo(o)<=s)||(i.start=u,i.end=c,i.closestPointToPoint(o,!0,e).distanceTo(o)<=s))return!0;let h=a.getPlane(r);if(Math.abs(h.distanceToPoint(o))<=s){let e=h.projectPoint(o,t);if(a.containsPoint(e))return!0}return!1}}();function MT(e){return 1e-15>Math.abs(e)}class MI extends aU{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=[,,,,].fill().map(()=>new ni),this.satBounds=[,,,,].fill().map(()=>new Mb),this.points=[this.a,this.b,this.c],this.sphere=new nJ,this.plane=new oC,this.needsUpdate=!0}intersectsSphere(e){return MC(e,this)}update(){let e=this.a,t=this.b,r=this.c,i=this.points,n=this.satAxes,a=this.satBounds,s=n[0],o=a[0];this.getNormal(s),o.setFromPoints(s,i);let l=n[1],u=a[1];l.subVectors(e,t),u.setFromPoints(l,i);let c=n[2],h=a[2];c.subVectors(t,r),h.setFromPoints(c,i);let d=n[3],f=a[3];d.subVectors(r,e),f.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(s,e),this.needsUpdate=!1}}MI.prototype.closestPointToSegment=function(){let e=new ni,t=new ni,r=new hR;return function(i,n=null,a=null){let s;let{start:o,end:l}=i,u=this.points,c=1/0;for(let o=0;o<3;o++){let l=(o+1)%3;r.start.copy(u[o]),r.end.copy(u[l]),Mw(r,i,e,t),(s=e.distanceToSquared(t))<c&&(c=s,n&&n.copy(e),a&&a.copy(t))}return this.closestPointToPoint(o,e),(s=o.distanceToSquared(e))<c&&(c=s,n&&n.copy(e),a&&a.copy(o)),this.closestPointToPoint(l,e),(s=l.distanceToSquared(e))<c&&(c=s,n&&n.copy(e),a&&a.copy(l)),Math.sqrt(c)}}(),MI.prototype.intersectsTriangle=function(){let e=new MI,t=[,,,],r=[,,,],i=new Mb,n=new Mb,a=new ni,s=new ni,o=new ni,l=new ni,u=new ni,c=new hR,h=new hR,d=new hR,f=new ni;function p(e,t,r){let i=e.points,n=0,a=-1;for(let e=0;e<3;e++){let{start:o,end:l}=c;o.copy(i[e]),l.copy(i[(e+1)%3]),c.delta(s);let u=MT(t.distanceToPoint(o));if(MT(t.normal.dot(s))&&u){r.copy(c),n=2;break}let h=t.intersectLine(c,f);if(!h&&u&&f.copy(o),(h||u)&&!MT(f.distanceTo(l))){if(n<=1)(1===n?r.start:r.end).copy(f),u&&(a=n);else if(n>=2){(1===a?r.start:r.end).copy(f),n=2;break}if(2==++n&&-1===a)break}}return n}return function(s,c=null,f=!1){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let m=this.plane,g=s.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let e=this.satBounds,o=this.satAxes;r[0]=s.a,r[1]=s.b,r[2]=s.c;for(let t=0;t<4;t++){let n=e[t],a=o[t];if(i.setFromPoints(a,r),n.isSeparated(i))return!1}let l=s.satBounds,u=s.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){let r=l[e],n=u[e];if(i.setFromPoints(n,t),r.isSeparated(i))return!1}for(let e=0;e<4;e++){let s=o[e];for(let e=0;e<4;e++){let o=u[e];if(a.crossVectors(s,o),i.setFromPoints(a,t),n.setFromPoints(a,r),i.isSeparated(n))return!1}}return c&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),c.start.set(0,0,0),c.end.set(0,0,0)),!0}{let e=p(this,g,h);if(1===e&&s.containsPoint(h.end))return c&&(c.start.copy(h.end),c.end.copy(h.end)),!0;if(2!==e)return!1;let t=p(s,m,d);if(1===t&&this.containsPoint(d.end))return c&&(c.start.copy(d.end),c.end.copy(d.end)),!0;if(2!==t)return!1;if(h.delta(o),d.delta(l),0>o.dot(l)){let e=d.start;d.start=d.end,d.end=e}let r=h.start.dot(o),i=h.end.dot(o),n=d.start.dot(o),a=d.end.dot(o);return(r===a||n===i||i<n!=r<a)&&(c&&(u.subVectors(h.start,d.start),u.dot(o)>0?c.start.copy(h.start):c.start.copy(d.start),u.subVectors(h.end,d.end),0>u.dot(o)?c.end.copy(h.end):c.end.copy(d.end)),!0)}}}(),MI.prototype.distanceToPoint=function(){let e=new ni;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),MI.prototype.distanceToTriangle=function(){let e=new ni,t=new ni,r=["a","b","c"],i=new hR,n=new hR;return function(a,s=null,o=null){let l=s||o?i:null;if(this.intersectsTriangle(a,l))return(s||o)&&(s&&l.getCenter(s),o&&l.getCenter(o)),0;let u=1/0;for(let t=0;t<3;t++){let i;let n=r[t],l=a[n];this.closestPointToPoint(l,e),(i=l.distanceToSquared(e))<u&&(u=i,s&&s.copy(e),o&&o.copy(l));let c=this[n];a.closestPointToPoint(c,e),(i=c.distanceToSquared(e))<u&&(u=i,s&&s.copy(c),o&&o.copy(e))}for(let l=0;l<3;l++){let c=r[l],h=r[(l+1)%3];i.set(this[c],this[h]);for(let l=0;l<3;l++){let c=r[l],h=r[(l+1)%3];n.set(a[c],a[h]),Mw(i,n,e,t);let d=e.distanceToSquared(t);d<u&&(u=d,s&&s.copy(e),o&&o.copy(t))}}return Math.sqrt(u)}}();class MM{constructor(e,t,r){this.isOrientedBox=!0,this.min=new ni,this.max=new ni,this.matrix=new n8,this.invMatrix=new n8,this.points=Array(8).fill().map(()=>new ni),this.satAxes=[,,,].fill().map(()=>new ni),this.satBounds=[,,,].fill().map(()=>new Mb),this.alignedSatBounds=[,,,].fill().map(()=>new Mb),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),r&&this.matrix.copy(r)}set(e,t,r){this.min.copy(e),this.max.copy(t),this.matrix.copy(r),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}MM.prototype.update=function(){let e=this.matrix,t=this.min,r=this.max,i=this.points;for(let n=0;n<=1;n++)for(let a=0;a<=1;a++)for(let s=0;s<=1;s++){let o=i[1*n|2*a|4*s];o.x=n?r.x:t.x,o.y=a?r.y:t.y,o.z=s?r.z:t.z,o.applyMatrix4(e)}let n=this.satBounds,a=this.satAxes,s=i[0];for(let e=0;e<3;e++){let t=a[e],r=n[e],o=i[1<<e];t.subVectors(s,o),r.setFromPoints(t,i)}let o=this.alignedSatBounds;o[0].setFromPointsField(i,"x"),o[1].setFromPointsField(i,"y"),o[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},MM.prototype.intersectsBox=function(){let e=new Mb;return function(t){this.needsUpdate&&this.update();let r=t.min,i=t.max,n=this.satBounds,a=this.satAxes,s=this.alignedSatBounds;if(e.min=r.x,e.max=i.x,s[0].isSeparated(e)||(e.min=r.y,e.max=i.y,s[1].isSeparated(e))||(e.min=r.z,e.max=i.z,s[2].isSeparated(e)))return!1;for(let r=0;r<3;r++){let i=a[r],s=n[r];if(e.setFromBox(i,t),s.isSeparated(e))return!1}return!0}}(),MM.prototype.intersectsTriangle=function(){let e=new MI,t=[,,,],r=new Mb,i=new Mb,n=new ni;return function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(e.copy(a),e.update(),a=e);let s=this.satBounds,o=this.satAxes;t[0]=a.a,t[1]=a.b,t[2]=a.c;for(let e=0;e<3;e++){let i=s[e],n=o[e];if(r.setFromPoints(n,t),i.isSeparated(r))return!1}let l=a.satBounds,u=a.satAxes,c=this.points;for(let e=0;e<3;e++){let t=l[e],i=u[e];if(r.setFromPoints(i,c),t.isSeparated(r))return!1}for(let e=0;e<3;e++){let a=o[e];for(let e=0;e<4;e++){let s=u[e];if(n.crossVectors(a,s),r.setFromPoints(n,t),i.setFromPoints(n,c),r.isSeparated(i))return!1}}return!0}}(),MM.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},MM.prototype.distanceToPoint=function(){let e=new ni;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),MM.prototype.distanceToBox=function(){let e=["x","y","z"],t=Array(12).fill().map(()=>new hR),r=Array(12).fill().map(()=>new hR),i=new ni,n=new ni;return function(a,s=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(o||l)&&(a.getCenter(n),this.closestPointToPoint(n,i),a.closestPointToPoint(i,n),o&&o.copy(i),l&&l.copy(n)),0;let u=s*s,c=a.min,h=a.max,d=this.points,f=1/0;for(let e=0;e<8;e++){let t=d[e];n.copy(t).clamp(c,h);let r=t.distanceToSquared(n);if(r<f&&(f=r,o&&o.copy(t),l&&l.copy(n),r<u))return Math.sqrt(r)}let p=0;for(let i=0;i<3;i++)for(let n=0;n<=1;n++)for(let a=0;a<=1;a++){let s=(i+1)%3,o=(i+2)%3,l=n<<s|a<<o,u=1<<i|n<<s|a<<o,f=d[l],m=d[u];t[p].set(f,m);let g=e[i],A=e[s],v=e[o],y=r[p],E=y.start,x=y.end;E[g]=c[g],E[A]=n?c[A]:h[A],E[v]=a?c[v]:h[A],x[g]=h[g],x[A]=n?c[A]:h[A],x[v]=a?c[v]:h[A],p++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let r=0;r<=1;r++){n.x=e?h.x:c.x,n.y=t?h.y:c.y,n.z=r?h.z:c.z,this.closestPointToPoint(n,i);let a=n.distanceToSquared(i);if(a<f&&(f=a,o&&o.copy(i),l&&l.copy(n),a<u))return Math.sqrt(a)}for(let e=0;e<12;e++){let a=t[e];for(let e=0;e<12;e++){Mw(a,r[e],i,n);let t=i.distanceToSquared(n);if(t<f&&(f=t,o&&o.copy(i),l&&l.copy(n),t<u))return Math.sqrt(t)}}return Math.sqrt(f)}}();class MR{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class MB extends MR{constructor(){super(()=>new MI)}}let MD=new MB;class MP{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;let e=[],t=null;this.setBuffer=r=>{t&&e.push(t),t=r,this.float32Array=new Float32Array(r),this.uint16Array=new Uint16Array(r),this.uint32Array=new Uint32Array(r)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==e.length&&this.setBuffer(e.pop())}}}let ML=new MP,Mk=[],MF=new MR(()=>new nL),MO=new ni,MU=new ni,MN=new ni,Mz=new ni,MG=new ni,MH=new nt,MQ=new nt,MV=new nt,MW=new ni,Mj=new ni,MY=new ni,MK=new ni;function Mq(e,t,r,i,n,a,s){let o=3*i,l=o+0,u=o+1,c=o+2,h=e.index;e.index&&(l=h.getX(l),u=h.getX(u),c=h.getX(c));let{position:d,normal:f,uv:p,uv1:m}=e.attributes,g=function(e,t,r,i,n,a,s,o,l,u,c){MN.fromBufferAttribute(t,a),Mz.fromBufferAttribute(t,s),MG.fromBufferAttribute(t,o);let h=function(e,t,r,i,n,a,s,o){if(null===(a===e0?e.intersectTriangle(i,r,t,!0,n):e.intersectTriangle(t,r,i,a!==e1,n)))return null;let l=e.origin.distanceTo(n);return l<s||l>o?null:{distance:l,point:n.clone()}}(e,MN,Mz,MG,MK,l,u,c);if(h){i&&(MH.fromBufferAttribute(i,a),MQ.fromBufferAttribute(i,s),MV.fromBufferAttribute(i,o),h.uv=aU.getInterpolation(MK,MN,Mz,MG,MH,MQ,MV,new nt)),n&&(MH.fromBufferAttribute(n,a),MQ.fromBufferAttribute(n,s),MV.fromBufferAttribute(n,o),h.uv1=aU.getInterpolation(MK,MN,Mz,MG,MH,MQ,MV,new nt)),r&&(MW.fromBufferAttribute(r,a),Mj.fromBufferAttribute(r,s),MY.fromBufferAttribute(r,o),h.normal=aU.getInterpolation(MK,MN,Mz,MG,MW,Mj,MY,new ni),h.normal.dot(e.direction)>0&&h.normal.multiplyScalar(-1));let t={a:a,b:s,c:o,normal:new ni,materialIndex:0};aU.getNormal(MN,Mz,MG,t.normal),h.face=t,h.faceIndex=a}return h}(r,d,f,p,m,l,u,c,t,a,s);return g?(g.faceIndex=i,n&&n.push(g),g):null}function MX(e,t,r,i){let n=e.a,a=e.b,s=e.c,o=t,l=t+1,u=t+2;r&&(o=r.getX(o),l=r.getX(l),u=r.getX(u)),n.x=i.getX(o),n.y=i.getY(o),n.z=i.getZ(o),a.x=i.getX(l),a.y=i.getY(l),a.z=i.getZ(l),s.x=i.getX(u),s.y=i.getY(u),s.z=i.getZ(u)}function M$(e,t,r,i,n,a,s){let{geometry:o}=r,{index:l}=o,u=o.attributes.position;for(let r=e,o=t+e;r<o;r++){let e;if(MX(s,3*(e=r),l,u),s.needsUpdate=!0,i(s,e,n,a))return!0}return!1}function MJ(e,t,r,i,n){let a,s,o,l,u,c;let h=1/r.direction.x,d=1/r.direction.y,f=1/r.direction.z,p=r.origin.x,m=r.origin.y,g=r.origin.z,A=t[e],v=t[e+3],y=t[e+1],E=t[e+3+1],x=t[e+2],_=t[e+3+2];return h>=0?(a=(A-p)*h,s=(v-p)*h):(a=(v-p)*h,s=(A-p)*h),d>=0?(o=(y-m)*d,l=(E-m)*d):(o=(E-m)*d,l=(y-m)*d),!(a>l)&&!(o>s)&&((o>a||isNaN(a))&&(a=o),(l<s||isNaN(s))&&(s=l),f>=0?(u=(x-g)*f,c=(_-g)*f):(u=(_-g)*f,c=(x-g)*f),!(a>c)&&!(u>s)&&((u>a||a!=a)&&(a=u),(c<s||s!=s)&&(s=c),a<=n&&s>=i))}function MZ(e,t,r,i,n,a,s){ML.setBuffer(e._roots[t]),function e(t,r,i,n,a,s,o){let{float32Array:l,uint16Array:u,uint32Array:c}=ML,h=2*t;if(Mx(h,u))!function(e,t,r,i,n,a,s,o){let{geometry:l,_indirectBuffer:u}=e;for(let e=i,u=i+n;e<u;e++)Mq(l,t,r,e,a,s,o)}(r,i,n,c[t+6],M_(h,u),a,s,o);else{let u=t+8;MJ(u,l,n,s,o)&&e(u,r,i,n,a,s,o);let h=c[t+6];MJ(h,l,n,s,o)&&e(h,r,i,n,a,s,o)}}(0,e,r,i,n,a,s),ML.clearBuffer()}let M0=["x","y","z"];function M1(e,t,r,i,n,a){ML.setBuffer(e._roots[t]);let s=function e(t,r,i,n,a,s){let{float32Array:o,uint16Array:l,uint32Array:u}=ML,c=2*t;if(Mx(c,l))return function(e,t,r,i,n,a,s){let{geometry:o,_indirectBuffer:l}=e,u=1/0,c=null;for(let e=i,l=i+n;e<l;e++){let i;(i=Mq(o,t,r,e,null,a,s))&&i.distance<u&&(c=i,u=i.distance)}return c}(r,i,n,u[t+6],M_(c,l),a,s);{let l,c;let h=u[t+7],d=M0[h],f=n.direction[d]>=0;f?(l=t+8,c=u[t+6]):(l=u[t+6],c=t+8);let p=MJ(l,o,n,a,s)?e(l,r,i,n,a,s):null;if(p){let e=p.point[d];if(f?e<=o[c+h]:e>=o[c+h+3])return p}let m=MJ(c,o,n,a,s)?e(c,r,i,n,a,s):null;return p&&m?p.distance<=m.distance?p:m:p||m||null}}(0,e,r,i,n,a);return ML.clearBuffer(),s}let M2=new nL,M3=new MI,M4=new MI,M5=new n8,M6=new MM,M8=new MM;function M9(e,t,r,i){ML.setBuffer(e._roots[t]);let n=function e(t,r,i,n,a=null){let{float32Array:s,uint16Array:o,uint32Array:l}=ML,u=2*t;if(null===a&&(i.boundingBox||i.computeBoundingBox(),M6.set(i.boundingBox.min,i.boundingBox.max,n),a=M6),Mx(u,o)){let e=r.geometry,a=e.index,c=e.attributes.position,h=i.index,d=i.attributes.position,f=l[t+6],p=M_(u,o);if(M5.copy(n).invert(),i.boundsTree)return Mc(t,s,M8),M8.matrix.copy(M5),M8.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:e=>M8.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(let t=3*f,r=(p+f)*3;t<r;t+=3)if(MX(M4,t,a,c),M4.needsUpdate=!0,e.intersectsTriangle(M4))return!0;return!1}});for(let e=3*f,t=(p+f)*3;e<t;e+=3){MX(M3,e,a,c),M3.a.applyMatrix4(M5),M3.b.applyMatrix4(M5),M3.c.applyMatrix4(M5),M3.needsUpdate=!0;for(let e=0,t=h.count;e<t;e+=3)if(MX(M4,e,h,d),M4.needsUpdate=!0,M3.intersectsTriangle(M4))return!0}}else{let o=t+8,u=l[t+6];return Mc(o,s,M2),!!(a.intersectsBox(M2)&&e(o,r,i,n,a))||(Mc(u,s,M2),!!(a.intersectsBox(M2)&&e(u,r,i,n,a)))}}(0,e,r,i);return ML.clearBuffer(),n}let M7=new n8,Re=new MM,Rt=new MM,Rr=new ni,Ri=new ni,Rn=new ni,Ra=new ni;function Rs(e,t,r,i,n,a,s){let{geometry:o}=r,{index:l}=o,u=o.attributes.position;for(let o=e,c=t+e;o<c;o++){let e;if(MX(s,3*(e=r.resolveTriangleIndex(o)),l,u),s.needsUpdate=!0,i(s,e,n,a))return!0}return!1}function Ro(e,t,r,i,n,a,s){ML.setBuffer(e._roots[t]),function e(t,r,i,n,a,s,o){let{float32Array:l,uint16Array:u,uint32Array:c}=ML,h=2*t;if(Mx(h,u))!function(e,t,r,i,n,a,s,o){let{geometry:l,_indirectBuffer:u}=e;for(let e=i,c=i+n;e<c;e++)Mq(l,t,r,u?u[e]:e,a,s,o)}(r,i,n,c[t+6],M_(h,u),a,s,o);else{let u=t+8;MJ(u,l,n,s,o)&&e(u,r,i,n,a,s,o);let h=c[t+6];MJ(h,l,n,s,o)&&e(h,r,i,n,a,s,o)}}(0,e,r,i,n,a,s),ML.clearBuffer()}let Rl=["x","y","z"];function Ru(e,t,r,i,n,a){ML.setBuffer(e._roots[t]);let s=function e(t,r,i,n,a,s){let{float32Array:o,uint16Array:l,uint32Array:u}=ML,c=2*t;if(Mx(c,l))return function(e,t,r,i,n,a,s){let{geometry:o,_indirectBuffer:l}=e,u=1/0,c=null;for(let e=i,h=i+n;e<h;e++){let i;(i=Mq(o,t,r,l?l[e]:e,null,a,s))&&i.distance<u&&(c=i,u=i.distance)}return c}(r,i,n,u[t+6],M_(c,l),a,s);{let l,c;let h=u[t+7],d=Rl[h],f=n.direction[d]>=0;f?(l=t+8,c=u[t+6]):(l=u[t+6],c=t+8);let p=MJ(l,o,n,a,s)?e(l,r,i,n,a,s):null;if(p){let e=p.point[d];if(f?e<=o[c+h]:e>=o[c+h+3])return p}let m=MJ(c,o,n,a,s)?e(c,r,i,n,a,s):null;return p&&m?p.distance<=m.distance?p:m:p||m||null}}(0,e,r,i,n,a);return ML.clearBuffer(),s}let Rc=new nL,Rh=new MI,Rd=new MI,Rf=new n8,Rp=new MM,Rm=new MM;function Rg(e,t,r,i){ML.setBuffer(e._roots[t]);let n=function e(t,r,i,n,a=null){let{float32Array:s,uint16Array:o,uint32Array:l}=ML,u=2*t;if(null===a&&(i.boundingBox||i.computeBoundingBox(),Rp.set(i.boundingBox.min,i.boundingBox.max,n),a=Rp),Mx(u,o)){let e=r.geometry,a=e.index,c=e.attributes.position,h=i.index,d=i.attributes.position,f=l[t+6],p=M_(u,o);if(Rf.copy(n).invert(),i.boundsTree)return Mc(t,s,Rm),Rm.matrix.copy(Rf),Rm.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:e=>Rm.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(let t=f,i=p+f;t<i;t++)if(MX(Rd,3*r.resolveTriangleIndex(t),a,c),Rd.needsUpdate=!0,e.intersectsTriangle(Rd))return!0;return!1}});for(let e=f,t=p+f;e<t;e++){MX(Rh,3*r.resolveTriangleIndex(e),a,c),Rh.a.applyMatrix4(Rf),Rh.b.applyMatrix4(Rf),Rh.c.applyMatrix4(Rf),Rh.needsUpdate=!0;for(let e=0,t=h.count;e<t;e+=3)if(MX(Rd,e,h,d),Rd.needsUpdate=!0,Rh.intersectsTriangle(Rd))return!0}}else{let o=t+8,u=l[t+6];return Mc(o,s,Rc),!!(a.intersectsBox(Rc)&&e(o,r,i,n,a))||(Mc(u,s,Rc),!!(a.intersectsBox(Rc)&&e(u,r,i,n,a)))}}(0,e,r,i);return ML.clearBuffer(),n}let RA=new n8,Rv=new MM,Ry=new MM,RE=new ni,Rx=new ni,R_=new ni,Rb=new ni,RS=new ML.constructor,Rw=new ML.constructor,RC=new MR(()=>new nL),RT=new nL,RI=new nL,RM=new nL,RR=new nL,RB=!1,RD=new MM,RP=new nL,RL={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class Rk{static serialize(e,t={}){t={cloneBuffers:!0,...t};let r=e.geometry,i=e._roots,n=e._indirectBuffer,a=r.getIndex();return t.cloneBuffers?{roots:i.map(e=>e.slice()),index:a?a.array.slice():null,indirectBuffer:n?n.slice():null}:{roots:i,index:a?a.array:null,indirectBuffer:n}}static deserialize(e,t,r={}){r={setIndex:!0,indirect:!!e.indirectBuffer,...r};let{index:i,roots:n,indirectBuffer:a}=e,s=new Rk(t,{...r,[Mr]:!0});if(s._roots=n,s._indirectBuffer=a||null,r.setIndex){let r=t.getIndex();if(null===r){let r=new a1(e.index,1,!1);t.setIndex(r)}else r.array!==i&&(r.array.set(i),r.needsUpdate=!0)}return s}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw Error("MeshBVH: Only BufferGeometries are supported.");if((t=Object.assign({...RL,[Mr]:!1},t)).useSharedArrayBuffer&&!("undefined"!=typeof SharedArrayBuffer))throw Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[Mr]||(function(e,t){let r=e.geometry;t.indirect&&(e._indirectBuffer=function(e,t){let r=(e.index?e.index.count:e.attributes.position.count)/3,i=r>65536,n=i?4:2,a=t?new SharedArrayBuffer(r*n):new ArrayBuffer(r*n),s=i?new Uint32Array(a):new Uint16Array(a);for(let e=0,t=s.length;e<t;e++)s[e]=e;return s}(r,t.useSharedArrayBuffer),function(e,t){let r=Ma(e),i=Ml(e,t).sort((e,t)=>e.offset-t.offset),n=i[i.length-1];n.count=Math.min(r-n.offset,n.count);let a=0;return i.forEach(({count:e})=>a+=e),r!==a}(r,t.range)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),e._indirectBuffer||function(e,t){if(!e.index){let r=e.attributes.position.count,i=Ms(r,t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);e.setIndex(new a1(i,1));for(let e=0;e<r;e++)i[e]=e}}(r,t);let i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=function(e,t=null,r=null,i=null){let n;let a=e.attributes.position,s=e.index?e.index.array:null,o=Ma(e),l=a.normalized;null===t?(n=new Float32Array(24*o),r=0,i=o):(n=t,r=r||0,i=i||o);let u=a.array,c=a.offset||0,h=3;a.isInterleavedBufferAttribute&&(h=a.data.stride);let d=["getX","getY","getZ"];for(let e=r;e<r+i;e++){let t=3*e,r=6*e,i=t+0,o=t+1,f=t+2;s&&(i=s[i],o=s[o],f=s[f]),l||(i=i*h+c,o=o*h+c,f=f*h+c);for(let e=0;e<3;e++){let t,s,c;l?(t=a[d[e]](i),s=a[d[e]](o),c=a[d[e]](f)):(t=u[i+e],s=u[o+e],c=u[f+e]);let h=t;s<h&&(h=s),c<h&&(h=c);let p=t;s>p&&(p=s),c>p&&(p=c);let m=(p-h)/2,g=2*e;n[r+g+0]=h+m,n[r+g+1]=m+(Math.abs(h)+m)*5960464477539063e-23}}return n}(r),a=t.indirect?Mo(r,t.range):Ml(r,t.range);e._roots=a.map(r=>{let a=function(e,t,r,i,n){let{maxDepth:a,verbose:s,maxLeafTris:o,strategy:l,onProgress:u,indirect:c}=n,h=e._indirectBuffer,d=e.geometry,f=d.index?d.index.array:null,p=c?ME:My,m=Ma(d),g=new Float32Array(6),A=!1,v=new Mv;return Mu(t,r,i,v.boundingData,g),function e(r,i,n,u=null,c=0){if(!A&&c>=a&&(A=!0,s&&(console.warn(`MeshBVH: Max depth of ${a} reached when generating BVH. Consider increasing maxDepth.`),console.warn(d))),n<=o||c>=a)return y(i+n),r.offset=i,r.count=n,r;let m=function(e,t,r,i,n,a){let s=-1,o=0;if(0===a)-1!==(s=Mh(t))&&(o=(t[s]+t[s+3])/2);else if(1===a)-1!==(s=Mh(e))&&(o=function(e,t,r,i){let n=0;for(let a=t,s=t+r;a<s;a++)n+=e[6*a+2*i];return n/r}(r,i,n,s));else if(a===Mt){let a=Mp(e),l=1.25*n,u=6*i,c=(i+n)*6;for(let e=0;e<3;e++){let i=t[e],h=(t[e+3]-i)/32;if(n<8){let t=[...Mg];t.length=n;let i=0;for(let n=u;n<c;n+=6,i++){let a=t[i];a.candidate=r[n+2*e],a.count=0;let{bounds:s,leftCacheBounds:o,rightCacheBounds:l}=a;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0;Mf(n,r,s)}t.sort(Mm);let h=n;for(let e=0;e<h;e++){let r=t[e];for(;e+1<h&&t[e+1].candidate===r.candidate;)t.splice(e+1,1),h--}for(let i=u;i<c;i+=6){let n=r[i+2*e];for(let e=0;e<h;e++){let a=t[e];n>=a.candidate?Mf(i,r,a.rightCacheBounds):(Mf(i,r,a.leftCacheBounds),a.count++)}}for(let r=0;r<h;r++){let i=t[r],u=i.count,c=n-i.count,h=i.leftCacheBounds,d=i.rightCacheBounds,f=0;0!==u&&(f=Mp(h)/a);let p=0;0!==c&&(p=Mp(d)/a);let m=1+1.25*(f*u+p*c);m<l&&(s=e,l=m,o=i.candidate)}}else{for(let e=0;e<32;e++){let t=Mg[e];t.count=0,t.candidate=i+h+e*h;let r=t.bounds;for(let e=0;e<3;e++)r[e]=1/0,r[e+3]=-1/0}for(let t=u;t<c;t+=6){let n=~~((r[t+2*e]-i)/h);n>=32&&(n=31);let a=Mg[n];a.count++,Mf(t,r,a.bounds)}let t=Mg[31];!function(e,t){t.set(e)}(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){let t=Mg[e],r=Mg[e+1];Md(t.bounds,r.rightCacheBounds,t.rightCacheBounds)}let d=0;for(let t=0;t<31;t++){let r=Mg[t],i=r.count,u=r.bounds,c=Mg[t+1].rightCacheBounds;0!==i&&(0===d?function(e,t){t.set(e)}(u,MA):Md(u,MA,MA));let h=0,f=0;0!==(d+=i)&&(h=Mp(MA)/a);let p=n-d;0!==p&&(f=Mp(c)/a);let m=1+1.25*(h*d+f*p);m<l&&(s=e,l=m,o=r.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${a} used.`);return{axis:s,pos:o}}(r.boundingData,u,t,i,n,l);if(-1===m.axis)return y(i+n),r.offset=i,r.count=n,r;let v=p(h,f,t,i,n,m);if(v===i||v===i+n)y(i+n),r.offset=i,r.count=n;else{r.splitAxis=m.axis;let a=new Mv,s=v-i;r.left=a,Mu(t,i,s,a.boundingData,g),e(a,i,s,g,c+1);let o=new Mv,l=n-s;r.right=o,Mu(t,v,l,o.boundingData,g),e(o,v,l,g,c+1)}return r}(v,r,i,g),v;function y(e){u&&u(e/m)}}(e,n,r.offset,r.count,t),s=new i(32*function e(t){return"count"in t?1:1+e(t.left)+e(t.right)}(a));return j=new Float32Array(s),Y=new Uint32Array(s),K=new Uint16Array(s),q=new Uint8Array(s),function e(t,r){let i=t/4,n=t/2,a="count"in r,s=r.boundingData;for(let e=0;e<6;e++)j[i+e]=s[e];if(a){if(r.buffer){let e=r.buffer;q.set(new Uint8Array(e),t);for(let r=t,n=t+e.byteLength;r<n;r+=32)Mx(r/2,K)||(Y[r/4+6]+=i);return t+e.byteLength}{let e=r.offset,a=r.count;return Y[i+6]=e,K[n+14]=a,K[n+15]=65535,t+32}}{let n;let a=r.left,s=r.right,o=r.splitAxis;if((n=e(t+32,a))/4>0x100000000)throw Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return Y[i+6]=n/4,n=e(n,s),Y[i+7]=o,n}}(0,a),s})}(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new nL))),this.resolveTriangleIndex=t.indirect?e=>this._indirectBuffer[e]:e=>e}refit(e=null){return(this.indirect?function(e,t=null){let r,i,n,a;t&&Array.isArray(t)&&(t=new Set(t));let s=e.geometry,o=s.index?s.index.array:null,l=s.attributes.position,u=0,c=e._roots;for(let s=0,h=c.length;s<h;s++)i=new Uint32Array(r=c[s]),n=new Uint16Array(r),a=new Float32Array(r),function r(s,u,c=!1){let h=2*s;if(65535===n[h+15]){let t=i[s+6],r=n[h+14],u=1/0,c=1/0,d=1/0,f=-1/0,p=-1/0,m=-1/0;for(let i=t,n=t+r;i<n;i++){let t=3*e.resolveTriangleIndex(i);for(let e=0;e<3;e++){let r=t+e;r=o?o[r]:r;let i=l.getX(r),n=l.getY(r),a=l.getZ(r);i<u&&(u=i),i>f&&(f=i),n<c&&(c=n),n>p&&(p=n),a<d&&(d=a),a>m&&(m=a)}}return(a[s+0]!==u||a[s+1]!==c||a[s+2]!==d||a[s+3]!==f||a[s+4]!==p||a[s+5]!==m)&&(a[s+0]=u,a[s+1]=c,a[s+2]=d,a[s+3]=f,a[s+4]=p,a[s+5]=m,!0)}{let e=s+8,n=i[s+6],o=c,l=!1,h=!1;t?o||(l=t.has(e+u),h=t.has(n+u),o=!l&&!h):(l=!0,h=!0);let d=o||l,f=o||h,p=!1;d&&(p=r(e,u,o));let m=!1;f&&(m=r(n,u,o));let g=p||m;if(g)for(let t=0;t<3;t++){let r=e+t,i=n+t,o=a[r],l=a[r+3],u=a[i],c=a[i+3];a[s+t]=o<u?o:u,a[s+t+3]=l>c?l:c}return g}}(0,u),u+=r.byteLength}:function(e,t=null){let r,i,n,a;t&&Array.isArray(t)&&(t=new Set(t));let s=e.geometry,o=s.index?s.index.array:null,l=s.attributes.position,u=0,c=e._roots;for(let e=0,s=c.length;e<s;e++)i=new Uint32Array(r=c[e]),n=new Uint16Array(r),a=new Float32Array(r),function e(r,s,u=!1){let c=2*r;if(65535===n[c+15]){let e=i[r+6],t=n[c+14],s=1/0,u=1/0,h=1/0,d=-1/0,f=-1/0,p=-1/0;for(let r=3*e,i=3*(e+t);r<i;r++){let e=o[r],t=l.getX(e),i=l.getY(e),n=l.getZ(e);t<s&&(s=t),t>d&&(d=t),i<u&&(u=i),i>f&&(f=i),n<h&&(h=n),n>p&&(p=n)}return(a[r+0]!==s||a[r+1]!==u||a[r+2]!==h||a[r+3]!==d||a[r+4]!==f||a[r+5]!==p)&&(a[r+0]=s,a[r+1]=u,a[r+2]=h,a[r+3]=d,a[r+4]=f,a[r+5]=p,!0)}{let n=r+8,o=i[r+6],l=u,c=!1,h=!1;t?l||(c=t.has(n+s),h=t.has(o+s),l=!c&&!h):(c=!0,h=!0);let d=l||c,f=l||h,p=!1;d&&(p=e(n,s,l));let m=!1;f&&(m=e(o,s,l));let g=p||m;if(g)for(let e=0;e<3;e++){let t=n+e,i=o+e,s=a[t],l=a[t+3],u=a[i],c=a[i+3];a[r+e]=s<u?s:u,a[r+e+3]=l>c?l:c}return g}}(0,u),u+=r.byteLength})(this,e)}traverse(e,t=0){let r=this._roots[t],i=new Uint32Array(r),n=new Uint16Array(r);(function t(a,s=0){let o=2*a,l=65535===n[o+15];if(l){let t=i[a+6],u=n[o+14];e(s,l,new Float32Array(r,4*a,6),t,u)}else{let n=i[a+6],o=i[a+7];e(s,l,new Float32Array(r,4*a,6),o)||(t(a+8,s+1),t(n,s+1))}})(0)}raycast(e,t=eZ,r=0,i=1/0){let n=this._roots,a=this.geometry,s=[],o=t.isMaterial,l=Array.isArray(t),u=a.groups,c=o?t.side:t,h=this.indirect?Ro:MZ;for(let a=0,o=n.length;a<o;a++){let n=l?t[u[a].materialIndex].side:c,o=s.length;if(h(this,a,n,e,s,r,i),l){let e=u[a].materialIndex;for(let t=o,r=s.length;t<r;t++)s[t].face.materialIndex=e}}return s}raycastFirst(e,t=eZ,r=0,i=1/0){let n=this._roots,a=this.geometry,s=t.isMaterial,o=Array.isArray(t),l=null,u=a.groups,c=s?t.side:t,h=this.indirect?Ru:M1;for(let a=0,s=n.length;a<s;a++){let n=o?t[u[a].materialIndex].side:c,s=h(this,a,n,e,r,i);null!=s&&(null==l||s.distance<l.distance)&&(l=s,o&&(s.face.materialIndex=u[a].materialIndex))}return l}intersectsGeometry(e,t){let r=!1,i=this._roots,n=this.indirect?Rg:M9;for(let a=0,s=i.length;a<s&&!(r=n(this,a,e,t));a++);return r}shapecast(e){let t=MD.getPrimitive(),r=this.indirect?Rs:M$,{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:a,intersectsTriangle:s}=e;if(a&&s){let e=a;a=(i,n,a,o,l)=>!!e(i,n,a,o,l)||r(i,n,this,s,a,o,t)}else a||(a=s?(e,i,n,a)=>r(e,i,this,s,n,a,t):(e,t,r)=>r);let o=!1,l=0,u=this._roots;for(let e=0,t=u.length;e<t;e++){let t=u[e];if(o=function(e,t,r,i,n,a){X=MF.getPrimitive(),$=MF.getPrimitive(),Mk.push(X,$),ML.setBuffer(e._roots[t]);let s=function e(t,r,i,n,a=null,s=0,o=0){let{float32Array:l,uint16Array:u,uint32Array:c}=ML,h=2*t;if(Mx(h,u)){let e=c[t+6],r=M_(h,u);return Mc(t,l,X),n(e,r,!1,o,s+t,X)}{let h,p,m,g,A,v;let y=t+8,E=c[t+6],x=y,_=E;if(a&&(m=X,g=$,Mc(x,l,m),Mc(_,l,g),h=a(m),(p=a(g))<h)){x=E,_=y;let e=h;h=p,p=e,m=g}m||Mc(x,l,m=X);let b=i(m,Mx(2*x,u),h,o+1,s+x);if(2===b){let e=d(x);A=n(e,f(x)-e,!0,o+1,s+x,m)}else A=b&&e(x,r,i,n,a,s,o+1);if(A)return!0;Mc(_,l,g=$);let S=i(g,Mx(2*_,u),p,o+1,s+_);if(2===S){let e=d(_);v=n(e,f(_)-e,!0,o+1,s+_,g)}else v=S&&e(_,r,i,n,a,s,o+1);if(v)return!0;return!1;function d(e){let{uint16Array:t,uint32Array:r}=ML,i=2*e;for(;!Mx(i,t);)e+=8,i=2*e;return r[e+6]}function f(e){let{uint16Array:t,uint32Array:r}=ML,i=2*e;for(;!Mx(i,t);)i=2*(e=r[e+6]);return r[e+6]+M_(i,t)}}}(0,e.geometry,r,i,n,a);ML.clearBuffer(),MF.releasePrimitive(X),MF.releasePrimitive($),Mk.pop(),Mk.pop();let o=Mk.length;return o>0&&($=Mk[o-1],X=Mk[o-2]),s}(this,e,n,a,i,l))break;l+=t.byteLength}return MD.releasePrimitive(t),o}bvhcast(e,t,r){let{intersectsRanges:i,intersectsTriangles:n}=r,a=MD.getPrimitive(),s=this.geometry.index,o=this.geometry.attributes.position,l=this.indirect?e=>{MX(a,3*this.resolveTriangleIndex(e),s,o)}:e=>{MX(a,3*e,s,o)},u=MD.getPrimitive(),c=e.geometry.index,h=e.geometry.attributes.position,d=e.indirect?t=>{MX(u,3*e.resolveTriangleIndex(t),c,h)}:e=>{MX(u,3*e,c,h)};if(n){let e=(e,r,i,s,o,c,h,f)=>{for(let p=i,m=i+s;p<m;p++){d(p),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let t=e,i=e+r;t<i;t++)if(l(t),a.needsUpdate=!0,n(a,u,t,p,o,c,h,f))return!0}return!1};if(i){let t=i;i=function(r,i,n,a,s,o,l,u){return!!t(r,i,n,a,s,o,l,u)||e(r,i,n,a,s,o,l,u)}}else i=e}return function(e,t,r,i){let n;if(RB)throw Error("MeshBVH: Recursive calls to bvhcast not supported.");RB=!0;let a=e._roots,s=t._roots,o=0,l=0,u=new n8().copy(r).invert();for(let e=0,t=a.length;e<t;e++){RS.setBuffer(a[e]),l=0;let t=RC.getPrimitive();Mc(0,RS.float32Array,t),t.applyMatrix4(u);for(let e=0,a=s.length;e<a&&(Rw.setBuffer(s[e]),n=function e(t,r,i,n,a,s=0,o=0,l=0,u=0,c=null,h=!1){let d,f;h?(d=Rw,f=RS):(d=RS,f=Rw);let p=d.float32Array,m=d.uint32Array,g=d.uint16Array,A=f.float32Array,v=f.uint32Array,y=f.uint16Array,E=2*r,x=Mx(2*t,g),_=Mx(E,y),b=!1;if(_&&x)b=h?a(v[r+6],M_(2*r,y),m[t+6],M_(2*t,g),u,o+r,l,s+t):a(m[t+6],M_(2*t,g),v[r+6],M_(2*r,y),l,s+t,u,o+r);else if(_){let c=RC.getPrimitive();Mc(r,A,c),c.applyMatrix4(i);let d=t+8,f=m[t+6];Mc(d,p,RT),Mc(f,p,RI);let g=c.intersectsBox(RT),v=c.intersectsBox(RI);b=g&&e(r,d,n,i,a,o,s,u,l+1,c,!h)||v&&e(r,f,n,i,a,o,s,u,l+1,c,!h),RC.releasePrimitive(c)}else{let d=r+8,f=v[r+6];Mc(d,A,RM),Mc(f,A,RR);let g=c.intersectsBox(RM),y=c.intersectsBox(RR);if(g&&y)b=e(t,d,i,n,a,s,o,l,u+1,c,h)||e(t,f,i,n,a,s,o,l,u+1,c,h);else if(g){if(x)b=e(t,d,i,n,a,s,o,l,u+1,c,h);else{let r=RC.getPrimitive();r.copy(RM).applyMatrix4(i);let c=t+8,f=m[t+6];Mc(c,p,RT),Mc(f,p,RI);let g=r.intersectsBox(RT),A=r.intersectsBox(RI);b=g&&e(d,c,n,i,a,o,s,u,l+1,r,!h)||A&&e(d,f,n,i,a,o,s,u,l+1,r,!h),RC.releasePrimitive(r)}}else if(y){if(x)b=e(t,f,i,n,a,s,o,l,u+1,c,h);else{let r=RC.getPrimitive();r.copy(RR).applyMatrix4(i);let c=t+8,d=m[t+6];Mc(c,p,RT),Mc(d,p,RI);let g=r.intersectsBox(RT),A=r.intersectsBox(RI);b=g&&e(f,c,n,i,a,o,s,u,l+1,r,!h)||A&&e(f,d,n,i,a,o,s,u,l+1,r,!h),RC.releasePrimitive(r)}}}return b}(0,0,r,u,i,o,l,0,0,t),Rw.clearBuffer(),l+=s[e].length,!n);e++);if(RC.releasePrimitive(t),RS.clearBuffer(),o+=a[e].length,n)break}return RB=!1,n}(this,e,t,i)}intersectsBox(e,t){return RD.set(e.min,e.max,t),RD.needsUpdate=!0,this.shapecast({intersectsBounds:e=>RD.intersectsBox(e),intersectsTriangle:e=>RD.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,r={},i={},n=0,a=1/0){return(this.indirect?function(e,t,r,i={},n={},a=0,s=1/0){t.boundingBox||t.computeBoundingBox(),Rv.set(t.boundingBox.min,t.boundingBox.max,r),Rv.needsUpdate=!0;let o=e.geometry,l=o.attributes.position,u=o.index,c=t.attributes.position,h=t.index,d=MD.getPrimitive(),f=MD.getPrimitive(),p=null,m=null;n&&(p=R_,m=Rb);let g=1/0,A=null,v=null;return(RA.copy(r).invert(),Ry.matrix.copy(RA),e.shapecast({boundsTraverseOrder:e=>Rv.distanceToBox(e),intersectsBounds:(e,t,r)=>r<g&&r<s&&(t&&(Ry.min.copy(e.min),Ry.max.copy(e.max),Ry.needsUpdate=!0),!0),intersectsRange:(i,n)=>{if(t.boundsTree){let o=t.boundsTree;return o.shapecast({boundsTraverseOrder:e=>Ry.distanceToBox(e),intersectsBounds:(e,t,r)=>r<g&&r<s,intersectsRange:(t,s)=>{for(let y=t,E=t+s;y<E;y++){MX(f,3*o.resolveTriangleIndex(y),h,c),f.a.applyMatrix4(r),f.b.applyMatrix4(r),f.c.applyMatrix4(r),f.needsUpdate=!0;for(let t=i,r=i+n;t<r;t++){MX(d,3*e.resolveTriangleIndex(t),u,l),d.needsUpdate=!0;let r=d.distanceToTriangle(f,RE,p);if(r<g&&(Rx.copy(RE),m&&m.copy(p),g=r,A=t,v=y),r<a)return!0}}}})}{let s=Ma(t);for(let t=0;t<s;t++){MX(f,3*t,h,c),f.a.applyMatrix4(r),f.b.applyMatrix4(r),f.c.applyMatrix4(r),f.needsUpdate=!0;for(let r=i,s=i+n;r<s;r++){MX(d,3*e.resolveTriangleIndex(r),u,l),d.needsUpdate=!0;let i=d.distanceToTriangle(f,RE,p);if(i<g&&(Rx.copy(RE),m&&m.copy(p),g=i,A=r,v=t),i<a)return!0}}}}}),MD.releasePrimitive(d),MD.releasePrimitive(f),g===1/0)?null:(i.point?i.point.copy(Rx):i.point=Rx.clone(),i.distance=g,i.faceIndex=A,n&&(n.point?n.point.copy(m):n.point=m.clone(),n.point.applyMatrix4(RA),Rx.applyMatrix4(RA),n.distance=Rx.sub(n.point).length(),n.faceIndex=v),i)}:function(e,t,r,i={},n={},a=0,s=1/0){t.boundingBox||t.computeBoundingBox(),Re.set(t.boundingBox.min,t.boundingBox.max,r),Re.needsUpdate=!0;let o=e.geometry,l=o.attributes.position,u=o.index,c=t.attributes.position,h=t.index,d=MD.getPrimitive(),f=MD.getPrimitive(),p=null,m=null;n&&(p=Rn,m=Ra);let g=1/0,A=null,v=null;return(M7.copy(r).invert(),Rt.matrix.copy(M7),e.shapecast({boundsTraverseOrder:e=>Re.distanceToBox(e),intersectsBounds:(e,t,r)=>r<g&&r<s&&(t&&(Rt.min.copy(e.min),Rt.max.copy(e.max),Rt.needsUpdate=!0),!0),intersectsRange:(e,i)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:e=>Rt.distanceToBox(e),intersectsBounds:(e,t,r)=>r<g&&r<s,intersectsRange:(t,n)=>{for(let s=t,o=t+n;s<o;s++){MX(f,3*s,h,c),f.a.applyMatrix4(r),f.b.applyMatrix4(r),f.c.applyMatrix4(r),f.needsUpdate=!0;for(let t=e,r=e+i;t<r;t++){MX(d,3*t,u,l),d.needsUpdate=!0;let e=d.distanceToTriangle(f,Rr,p);if(e<g&&(Ri.copy(Rr),m&&m.copy(p),g=e,A=t,v=s),e<a)return!0}}}});{let n=Ma(t);for(let t=0;t<n;t++){MX(f,3*t,h,c),f.a.applyMatrix4(r),f.b.applyMatrix4(r),f.c.applyMatrix4(r),f.needsUpdate=!0;for(let r=e,n=e+i;r<n;r++){MX(d,3*r,u,l),d.needsUpdate=!0;let e=d.distanceToTriangle(f,Rr,p);if(e<g&&(Ri.copy(Rr),m&&m.copy(p),g=e,A=r,v=t),e<a)return!0}}}}}),MD.releasePrimitive(d),MD.releasePrimitive(f),g===1/0)?null:(i.point?i.point.copy(Ri):i.point=Ri.clone(),i.distance=g,i.faceIndex=A,n&&(n.point?n.point.copy(m):n.point=m.clone(),n.point.applyMatrix4(M7),Ri.applyMatrix4(M7),n.distance=Ri.sub(n.point).length(),n.faceIndex=v),i)})(this,e,t,r,i,n,a)}closestPointToPoint(e,t={},r=0,i=1/0){return function(e,t,r={},i=0,n=1/0){let a=i*i,s=n*n,o=1/0,l=null;if(e.shapecast({boundsTraverseOrder:e=>(MO.copy(t).clamp(e.min,e.max),MO.distanceToSquared(t)),intersectsBounds:(e,t,r)=>r<o&&r<s,intersectsTriangle:(e,r)=>{e.closestPointToPoint(t,MO);let i=t.distanceToSquared(MO);return i<o&&(MU.copy(MO),o=i,l=r),i<a}}),o===1/0)return null;let u=Math.sqrt(o);return r.point?r.point.copy(MU):r.point=MU.clone(),r.distance=u,r.faceIndex=l,r}(this,e,t,r,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Mc(0,new Float32Array(t),RP),e.union(RP)}),e}}let RF=o$||null,RO=(parseInt(eH),new n6),RU=new ni,RN=new n8,Rz=sE.prototype.raycast,RG=null!==RF?RF.prototype.raycast:null,RH=new ni,RQ=new sE,RV=[];function RW(e,t){this.isBatchedMesh?Rj.call(this,e,t):RY.call(this,e,t)}function Rj(e,t){if(this.boundsTrees){let r=this.boundsTrees,i=this._drawInfo,n=this._drawRanges,a=this.matrixWorld;RQ.material=this.material,RQ.geometry=this.geometry;let s=RQ.geometry.boundsTree,o=RQ.geometry.drawRange;null===RQ.geometry.boundingSphere&&(RQ.geometry.boundingSphere=new nJ);for(let s=0,o=i.length;s<o;s++){if(!this.getVisibleAt(s))continue;let o=i[s].geometryIndex;if(RQ.geometry.boundsTree=r[o],this.getMatrixAt(s,RQ.matrixWorld).premultiply(a),!RQ.geometry.boundsTree){this.getBoundingBoxAt(o,RQ.geometry.boundingBox),this.getBoundingSphereAt(o,RQ.geometry.boundingSphere);let e=n[o];RQ.geometry.setDrawRange(e.start,e.count)}RQ.raycast(e,RV);for(let e=0,r=RV.length;e<r;e++){let r=RV[e];r.object=this,r.batchId=s,t.push(r)}RV.length=0}RQ.geometry.boundsTree=s,RQ.geometry.drawRange=o,RQ.material=null,RQ.geometry=null}else RG.call(this,e,t)}function RY(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;RN.copy(this.matrixWorld).invert(),RO.copy(e.ray).applyMatrix4(RN),RH.setFromMatrixScale(this.matrixWorld),RU.copy(RO.direction).multiply(RH);let r=RU.length(),i=e.near/r,n=e.far/r,a=this.geometry.boundsTree;if(!0===e.firstHitOnly){let r=Mi(a.raycastFirst(RO,this.material,i,n),this,e);r&&t.push(r)}else{let r=a.raycast(RO,this.material,i,n);for(let i=0,n=r.length;i<n;i++){let n=Mi(r[i],this,e);n&&t.push(n)}}}else Rz.call(this,e,t)}function RK(e={}){return this.boundsTree=new Rk(this,e),this.boundsTree}function Rq(){this.boundsTree=null}let RX=e=>e.isMesh;function R$(e,t){t={strategy:Mt,verbose:!1,setBoundingBox:!0,maxDepth:40,maxLeafTris:10,indirect:!1,...t},eN.useEffect(()=>{if(e.current){e.current.raycast=RW;let r=e.current.geometry;return r.computeBoundsTree=RK,r.disposeBoundsTree=Rq,r.computeBoundsTree(t),()=>{r.boundsTree&&r.disposeBoundsTree()}}},[e,JSON.stringify(t)])}let RJ=eN.forwardRef(({enabled:e=!0,firstHitOnly:t=!1,children:r,strategy:i=Mt,verbose:n=!1,setBoundingBox:a=!0,maxDepth:s=40,maxLeafTris:o=10,indirect:l=!1,...u},c)=>{let h=eN.useRef(null),d=dY(e=>e.raycaster);return eN.useImperativeHandle(c,()=>h.current,[]),eN.useEffect(()=>{if(e){let e={strategy:i,verbose:n,setBoundingBox:a,maxDepth:s,maxLeafTris:o,indirect:l},r=h.current;return d.firstHitOnly=t,r.traverse(t=>{RX(t)&&!t.geometry.boundsTree&&t.raycast===sE.prototype.raycast&&(t.raycast=RW,t.geometry.computeBoundsTree=RK,t.geometry.disposeBoundsTree=Rq,t.geometry.computeBoundsTree(e))}),()=>{delete d.firstHitOnly,r.traverse(e=>{RX(e)&&e.geometry.boundsTree&&(e.geometry.disposeBoundsTree(),e.raycast=sE.prototype.raycast)})}}},[]),eN.createElement("group",eU({ref:h},u),r)});function RZ(...e){let t=eN.useRef([]);return t.current=e.map(e=>eN.useContext(e)),eN.useMemo(()=>({children:r})=>e.reduceRight((e,r,i)=>eN.createElement(r.Provider,{value:t.current[i],children:e}),r),[])}function R0(e,t){let r=eN.useRef(),[i]=eN.useState(()=>t?t instanceof aS?{current:t}:t:r),[n]=eN.useState(()=>new ha(void 0));eN.useLayoutEffect(()=>{t&&(i.current=t instanceof aS?t:t.current),n._root=i.current});let a=eN.useRef({}),s=eN.useMemo(()=>{let t={};return e.forEach(e=>Object.defineProperty(t,e.name,{enumerable:!0,get(){if(i.current)return a.current[e.name]||(a.current[e.name]=n.clipAction(e,i.current))},configurable:!0})),{ref:i,clips:e,actions:t,names:e.map(e=>e.name),mixer:n}},[e]);return dK((e,t)=>n.update(t)),eN.useEffect(()=>{let e=i.current;return()=>{a.current={},n.stopAllAction(),Object.values(s.actions).forEach(t=>{e&&n.uncacheAction(t,e)})}},[e]),s}function R1(e){let t=eN.useRef(null),r=eN.useRef(!1),i=eN.useRef(!1),n=eN.useRef(e);return eN.useLayoutEffect(()=>void(n.current=e),[e]),eN.useEffect(()=>{let e=t.current;if(e){let t=dG(()=>(r.current=!1,!0)),a=e.onBeforeRender;e.onBeforeRender=()=>r.current=!0;let s=dH(()=>(r.current!==i.current&&(null==n.current||n.current(i.current=r.current)),!0));return()=>{e.onBeforeRender=a,t(),s()}}},[]),t}let R2=`
#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );
  #ifdef BOX_PROJECTED_ENV_MAP
    vWorldPosition = worldPosition.xyz;
  #endif
#endif
`,R3=`
#ifdef BOX_PROJECTED_ENV_MAP
  uniform vec3 envMapSize;
  uniform vec3 envMapPosition;
  varying vec3 vWorldPosition;
    
  vec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {
    vec3 nDir = normalize( v );
    vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbminmax;
    rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;
    rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;
    rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;
    float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );
    vec3 boxIntersection = vWorldPosition + nDir * correction;    
    return boxIntersection - cubePos;
  }
#endif
`,R4=`
#ifdef BOX_PROJECTED_ENV_MAP
  worldNormal = parallaxCorrectNormal( worldNormal, envMapSize, envMapPosition );
#endif
`,R5=`
#ifdef BOX_PROJECTED_ENV_MAP
  reflectVec = parallaxCorrectNormal( reflectVec, envMapSize, envMapPosition );
#endif
`;function R6(e=new ni,t=new ni){let[r]=eN.useState(()=>({position:new ni,size:new ni}));d1(r,{position:e,size:t});let i=eN.useRef(null),n=eN.useMemo(()=>({ref:i,onBeforeCompile:e=>{var t,i;return t=r.position,i=r.size,void(e.defines.BOX_PROJECTED_ENV_MAP=!0,e.uniforms.envMapPosition={value:t},e.uniforms.envMapSize={value:i},e.vertexShader=`
  varying vec3 vWorldPosition;
  ${e.vertexShader.replace("#include <worldpos_vertex>",R2)}`,e.fragmentShader=`
    ${R3}
    ${e.fragmentShader.replace("#include <envmap_physical_pars_fragment>",A9.envmap_physical_pars_fragment).replace("vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );",`vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
         ${R4}
         `).replace("reflectVec = inverseTransformDirection( reflectVec, viewMatrix );",`reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
         ${R5}
        `)}`)},customProgramCacheKey:()=>JSON.stringify(r.position.toArray())+JSON.stringify(r.size.toArray())}),[...r.position.toArray(),...r.size.toArray()]);return eN.useLayoutEffect(()=>void(i.current.needsUpdate=!0),[r]),n}let R8=new nL,R9=new ni,R7=({anchor:e,...t})=>{let r=eN.useRef(null),i=eN.useRef(null);return eN.useEffect(()=>{var e;null!=(e=r.current)&&null!=(e=e.parent)&&e.parent&&(i.current=r.current.parent,r.current.parent.parent.add(r.current))},[]),dK(()=>{i.current&&(R8.setFromObject(i.current),R8.getSize(R9),r.current.position.set(i.current.position.x+R9.x*(Array.isArray(e)?e[0]:e.x)/2,i.current.position.y+R9.y*(Array.isArray(e)?e[1]:e.y)/2,i.current.position.z+R9.z*(Array.isArray(e)?e[2]:e.z)/2))}),eN.createElement("group",eU({ref:r},t))},Be=e=>Math.sqrt(1-Math.pow(e-1,2));class Bt{constructor({size:e=256,maxAge:t=750,radius:r=.3,intensity:i=.2,interpolate:n=0,smoothing:a=0,minForce:s=.3,blend:o="screen",ease:l=Be}={}){this.size=e,this.maxAge=t,this.radius=r,this.intensity=i,this.ease=l,this.interpolate=n,this.smoothing=a,this.minForce=s,this.blend=o,this.trail=[],this.force=0,this.initTexture()}initTexture(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=this.size;let e=this.canvas.getContext("2d");if(null===e)throw Error("2D not available");this.ctx=e,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.texture=new nC(this.canvas),this.canvas.id="touchTexture",this.canvas.style.width=this.canvas.style.height=`${this.canvas.width}px`}update(e){this.clear(),this.trail.forEach((t,r)=>{t.age+=1e3*e,t.age>this.maxAge&&this.trail.splice(r,1)}),this.trail.length||(this.force=0),this.trail.forEach(e=>{this.drawTouch(e)}),this.texture.needsUpdate=!0}clear(){this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}addTouch(e){let t=this.trail[this.trail.length-1];if(t){let r=t.x-e.x,i=t.y-e.y,n=r*r+i*i,a=Math.max(this.minForce,Math.min(1e4*n,1));if(this.force=function(e,t,r=.9){return t*r+e*(1-r)}(a,this.force,this.smoothing),this.interpolate){let e=Math.ceil(n/Math.pow(.5*this.radius/this.interpolate,2));if(e>1)for(let n=1;n<e;n++)this.trail.push({x:t.x-r/e*n,y:t.y-i/e*n,age:0,force:a})}}this.trail.push({x:e.x,y:e.y,age:0,force:this.force})}drawTouch(e){let t={x:e.x*this.size,y:(1-e.y)*this.size},r=1;r=(e.age<.3*this.maxAge?this.ease(e.age/(.3*this.maxAge)):this.ease(1-(e.age-.3*this.maxAge)/(.7*this.maxAge)))*e.force,this.ctx.globalCompositeOperation=this.blend;let i=this.size*this.radius*r,n=this.ctx.createRadialGradient(t.x,t.y,Math.max(0,.25*i),t.x,t.y,Math.max(0,i));n.addColorStop(0,`rgba(255, 255, 255, ${this.intensity})`),n.addColorStop(1,"rgba(0, 0, 0, 0.0)"),this.ctx.beginPath(),this.ctx.fillStyle=n,this.ctx.arc(t.x,t.y,Math.max(0,i),0,2*Math.PI),this.ctx.fill()}}function Br(e={}){let{size:t,maxAge:r,radius:i,intensity:n,interpolate:a,smoothing:s,minForce:o,blend:l,ease:u}=e,c=(0,eN.useMemo)(()=>new Bt(e),[t,r,i,n,a,s,o,l,u]);dK((e,t)=>void c.update(t));let h=(0,eN.useCallback)(e=>c.addTouch(e.uv),[c]);return[c.texture,h]}let Bi=({children:e,...t})=>{let r=Br(t);return eN.createElement(eN.Fragment,null,null==e?void 0:e(r))},Bn=eN.forwardRef(function({children:e,disable:t,disableX:r,disableY:i,disableZ:n,left:a,right:s,top:o,bottom:l,front:u,back:c,onCentered:h,precise:d=!0,cacheKey:f=0,...p},m){let g=eN.useRef(null),A=eN.useRef(null),v=eN.useRef(null);return eN.useLayoutEffect(()=>{A.current.matrixWorld.identity();let e=new nL().setFromObject(v.current,d),f=new ni,p=new nJ,m=e.max.x-e.min.x,y=e.max.y-e.min.y,E=e.max.z-e.min.z;e.getCenter(f),e.getBoundingSphere(p);let x=o?y/2:l?-y/2:0,_=a?-m/2:s?m/2:0,b=u?E/2:c?-E/2:0;A.current.position.set(t||r?0:-f.x+_,t||i?0:-f.y+x,t||n?0:-f.z+b),void 0!==h&&h({parent:g.current.parent,container:g.current,width:m,height:y,depth:E,boundingBox:e,boundingSphere:p,center:f,verticalAlignment:x,horizontalAlignment:_,depthAlignment:b})},[f,h,o,a,u,t,r,i,n,d,s,l,c]),eN.useImperativeHandle(m,()=>g.current,[]),eN.createElement("group",eU({ref:g},p),eN.createElement("group",{ref:A},eN.createElement("group",{ref:v},e)))}),Ba=eN.forwardRef(({font:e,color:t="#cbcbcb",bevelSize:r=.04,debug:i=!1,children:n,...a},s)=>{let[o,l]=eN.useState(0),u=eN.useCallback((e=1)=>l(o+e),[o]),c=eN.useCallback((e=1)=>l(o-e),[o]),h=eN.useMemo(()=>({incr:u,decr:c}),[u,c]);return eN.useImperativeHandle(s,()=>h,[h]),eN.createElement("group",a,eN.createElement(eN.Suspense,{fallback:null},eN.createElement(Bn,{top:!0,cacheKey:JSON.stringify({counter:o,font:e})},eN.createElement(_k,{bevelEnabled:!0,bevelSize:r,font:e},i?eN.createElement("meshNormalMaterial",{wireframe:!0}):eN.createElement("meshStandardMaterial",{color:t}),o))),n)});var Bs=r(28200),Bo=r.n(Bs);function Bl(e){return function e(t,r,i){if(i=i||[],!r[0])return t(i);function n(n){return e(t,r.slice(1),i.concat([n]))}return"function"==typeof r[0]?r[0]({results:i,render:n}):(0,eN.cloneElement)(r[0],{children:n})}(e.children,e.components)}Bl.propTypes={children:Bo().func.isRequired,components:Bo().arrayOf(Bo().oneOfType([Bo().element,Bo().func])).isRequired};let Bu=(e,t)=>{"updateRanges"in e?e.updateRanges[0]=t:e.updateRange=t},Bc=new n8,Bh=new n8,Bd=[],Bf=new sE;class Bp extends sF{constructor(){super(),this.color=new aQ("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){let r=this.instance.current;if(!r||!r.geometry||!r.material)return;Bf.geometry=r.geometry;let i=r.matrixWorld,n=r.userData.instances.indexOf(this.instanceKey);if(-1!==n&&!(n>r.count)){r.getMatrixAt(n,Bc),Bh.multiplyMatrices(i,Bc),Bf.matrixWorld=Bh,r.material instanceof aj?Bf.material.side=r.material.side:Bf.material.side=r.material[0].side,Bf.raycast(e,Bd);for(let e=0,r=Bd.length;e<r;e++){let r=Bd[e];r.instanceId=n,r.object=this,t.push(r)}Bd.length=0}}}let Bm=eN.createContext(null),Bg=new n8,BA=new n8,Bv=new n8,By=new ni,BE=new nr,Bx=new ni,B_=e=>e.isInstancedBufferAttribute,Bb=eN.forwardRef(({context:e,children:t,...r},i)=>{eN.useMemo(()=>dp({PositionMesh:Bp}),[]);let n=eN.useRef();eN.useImperativeHandle(i,()=>n.current,[]);let{subscribe:a,getParent:s}=eN.useContext(e||Bm);return eN.useLayoutEffect(()=>a(n),[]),eN.createElement("positionMesh",eU({instance:s(),instanceKey:n,ref:n},r),t)}),BS=eN.forwardRef(({context:e,children:t,range:r,limit:i=1e3,frames:n=1/0,...a},s)=>{let[{localContext:o,instance:l}]=eN.useState(()=>{let e=eN.createContext(null);return{localContext:e,instance:eN.forwardRef((t,r)=>eN.createElement(Bb,eU({context:e},t,{ref:r})))}}),u=eN.useRef(null);eN.useImperativeHandle(s,()=>u.current,[]);let[c,h]=eN.useState([]),[[d,f]]=eN.useState(()=>{let e=new Float32Array(16*i);for(let t=0;t<i;t++)Bv.identity().toArray(e,16*t);return[e,new Float32Array([...Array(3*i)].map(()=>1))]});eN.useEffect(()=>{u.current.instanceMatrix.needsUpdate=!0});let p=0,m=0,g=eN.useRef([]);eN.useLayoutEffect(()=>{g.current=Object.entries(u.current.geometry.attributes).filter(([e,t])=>B_(t))}),dK(()=>{if(n===1/0||p<n){u.current.updateMatrix(),u.current.updateMatrixWorld(),Bg.copy(u.current.matrixWorld).invert(),m=Math.min(i,void 0!==r?r:i,c.length),u.current.count=m,Bu(u.current.instanceMatrix,{offset:0,count:16*m}),Bu(u.current.instanceColor,{offset:0,count:3*m});for(let e=0;e<c.length;e++){let t=c[e].current;t.matrixWorld.decompose(By,BE,Bx),BA.compose(By,BE,Bx).premultiply(Bg),BA.toArray(d,16*e),u.current.instanceMatrix.needsUpdate=!0,t.color.toArray(f,3*e),u.current.instanceColor.needsUpdate=!0}p++}});let A=eN.useMemo(()=>({getParent:()=>u,subscribe:e=>(h(t=>[...t,e]),()=>h(t=>t.filter(t=>t.current!==e.current)))}),[]);return eN.createElement("instancedMesh",eU({userData:{instances:c,limit:i,frames:n},matrixAutoUpdate:!1,ref:u,args:[null,null,0],raycast:()=>null},a),eN.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:d.length/16,array:d,itemSize:16,usage:iU}),eN.createElement("instancedBufferAttribute",{attach:"instanceColor",count:f.length/3,array:f,itemSize:3,usage:iU}),"function"==typeof t?eN.createElement(o.Provider,{value:A},t(l)):e?eN.createElement(e.Provider,{value:A},t):eN.createElement(Bm.Provider,{value:A},t))}),Bw=eN.forwardRef(function({meshes:e,children:t,...r},i){let n=Array.isArray(e);if(!n)for(let t of Object.keys(e))e[t].isMesh||delete e[t];return eN.createElement("group",{ref:i},eN.createElement(Bl,{components:(n?e:Object.values(e)).map(({geometry:e,material:t})=>eN.createElement(BS,eU({key:e.uuid,geometry:e,material:t},r)))},r=>n?t(...r):t(Object.keys(e).filter(t=>e[t].isMesh).reduce((e,t,i)=>({...e,[t]:r[i]}),{}))))});function BC(){let e=eN.createContext(null);return[eN.forwardRef((t,r)=>eN.createElement(BS,eU({ref:r,context:e},t))),eN.forwardRef((t,r)=>eN.createElement(Bb,eU({ref:r,context:e},t)))]}let BT=eN.forwardRef(({name:e,defaultValue:t,normalized:r,usage:i=iU},n)=>{let a=eN.useRef(null);eN.useImperativeHandle(n,()=>a.current,[]),eN.useLayoutEffect(()=>{let r=a.current.__r3f.parent;r.geometry.attributes[e]=a.current;let i=Array.isArray(t)?t:[t],n=Array.from({length:r.userData.limit},()=>i).flat();return a.current.array=new Float32Array(n),a.current.itemSize=i.length,a.current.count=n.length/a.current.itemSize,()=>{delete r.geometry.attributes[e]}},[e]);let s=0;return dK(()=>{let t=a.current.__r3f.parent;if(t.userData.frames===1/0||s<t.userData.frames){for(let r=0;r<t.userData.instances.length;r++){let i=t.userData.instances[r].current[e];void 0!==i&&(a.current.set(Array.isArray(i)?i:"function"==typeof i.toArray?i.toArray():[i],r*a.current.itemSize),a.current.needsUpdate=!0)}s++}}),eN.createElement("instancedBufferAttribute",{ref:a,usage:i,normalized:r})}),BI=eN.createContext(null);function BM(){return eN.useContext(BI)}let BR=new uf(1,1),BB=eN.forwardRef(({startFrame:e=0,endFrame:t,fps:r=30,frameName:i="",textureDataURL:n,textureImageURL:a,loop:s=!1,numberOfFrames:o=1,autoPlay:l=!0,animationNames:u,onStart:c,onEnd:h,onLoopEnd:d,onFrame:f,play:p,pause:m=!1,flipX:g=!1,alphaTest:A=0,children:v,asSprite:y=!1,offset:E,playBackwards:x=!1,resetOnEnd:_=!1,maxItems:b=1,instanceItems:S=[[0,0,0]],spriteDataset:w,canvasRenderingContext2DSettings:C,roundFramePosition:T=!1,meshProps:I={},...M},R)=>{let B=eN.useRef(new sF),D=eN.useRef(null),P=eN.useRef(null),L=eN.useRef(null),k=eN.useRef(window.performance.now()),F=eN.useRef(e),O=eN.useRef(i),U=r>0?1e3/r:0,[N,z]=eN.useState(new nC),G=eN.useRef(0),[H,Q]=eN.useState(new ni(1,1,1)),V=g?-1:1,W=eN.useRef(m),j=eN.useRef(E),Y=eN.useRef(!1),{spriteObj:K,loadJsonAndTexture:q}=Iz(null,null,u,o,void 0,C),X=eN.useRef(i),$=eN.useCallback((e,t)=>{if(null===t)o&&(G.current=o,x&&(F.current=o-1),D.current=t);else{var r,i;D.current=t,D.current&&Array.isArray(D.current.frames)?G.current=D.current.frames.length:D.current&&"object"==typeof D.current&&X.current?G.current=D.current.frames[X.current].length:G.current=0,x&&(F.current=G.current-1);let{w:n,h:a}=IU(null!==(r=null==(i=D.current)?void 0:i.frames)&&void 0!==r?r:[],X.current).sourceSize;Q(ee(n,a)),P.current&&(P.current.map=e)}z(e)},[o,x]),J=eN.useCallback(()=>{if(!D.current)return;let{meta:{size:e},frames:t}=D.current,{w:r,h:n}=Array.isArray(t)?t[0].sourceSize:i&&t[i]?t[i][0].sourceSize:{w:0,h:0};P.current&&P.current.map&&(P.current.map.wrapS=P.current.map.wrapT=tW,P.current.map.center.set(0,0),P.current.map.repeat.set(1*V/(e.w/r),1/(e.h/n)));let a=(e.h-1)/n;P.current&&P.current.map&&(P.current.map.offset.x=0,P.current.map.offset.y=1-1/a),c&&c({currentFrameName:null!=i?i:"",currentFrame:F.current})},[V,i,c]),Z=eN.useMemo(()=>({current:j.current,offset:j.current,imageUrl:a,hasEnded:!1,ref:R}),[a,R]);eN.useImperativeHandle(R,()=>B.current,[]),eN.useLayoutEffect(()=>{j.current=E},[E]);let ee=(e,t)=>{var r;let i=new ni;return i.set(1,t/e,1),null==(r=L.current)||r.scale.copy(i),i};eN.useEffect(()=>{if(w){var e;$(null==w||null==(e=w.spriteTexture)?void 0:e.clone(),w.spriteData)}else a&&n&&q(a,n)},[q,w,n,a,$]),eN.useEffect(()=>{if(K){var e;$(null==K||null==(e=K.spriteTexture)?void 0:e.clone(),null==K?void 0:K.spriteData)}},[K,$]),eN.useEffect(()=>{if(Z.hasEnded=!1,D.current&&!0===x){var e;F.current=(null!==(e=D.current.frames.length)&&void 0!==e?e:0)-1}else F.current=0},[x,Z]),eN.useLayoutEffect(()=>{J()},[N,g,J]),eN.useEffect(()=>{l&&(W.current=!1)},[l]),eN.useLayoutEffect(()=>{if(O.current!==i&&i&&(F.current=0,O.current=i,Z.hasEnded=!1,U<=0&&(F.current=t||e||0),D.current)){let{w:e,h:t}=IU(D.current.frames,i).sourceSize;Q(ee(e,t))}},[i,U,Z,t,e]);let et=()=>{if(!function(e){return null!==e&&"meta"in e&&"frames"in e}(D.current))return;let{meta:{size:r},frames:n}=D.current,{w:a,h:o}=IU(n,i).sourceSize,l=Array.isArray(n)?n:i?n[i]:[],u=t||l.length-1;var f=void 0===E?Z.current:E;if(U<=0){F.current=t||e||0,er(a,o,r,l);return}let p=window.performance.now(),m=p-k.current;if(!(m<=U)){var g=x?F.current<0:F.current>u,A=x?F.current===u:0===F.current,v=x?F.current<0:F.current>=u;if(g){if(F.current=s&&null!=e?e:0,x&&(F.current=u),s?null==d||d({currentFrameName:null!=i?i:"",currentFrame:F.current}):(null==h||h({currentFrameName:null!=i?i:"",currentFrame:F.current}),Z.hasEnded=!_,_&&(W.current=!0)),!s)return}else A&&(null==c||c({currentFrameName:null!=i?i:"",currentFrame:F.current}));void 0!==f&&v?!1===Y.current&&(null==h||h({currentFrameName:null!=i?i:"",currentFrame:F.current}),Y.current=!0):Y.current=!1,m<=U||(k.current=p-m%U,er(a,o,r,l))}},er=(e,t,r,i)=>{var n=void 0===E?Z.current:E;let a=F.current,s=0,o=0;ee(e,t);let l=T?Math.round((r.w-1)/e):(r.w-1)/e,u=T?Math.round((r.h-1)/t):(r.h-1)/t;if(!i[a])return;let{frame:{x:c,y:h},sourceSize:{w:d,h:f}}=i[a],p=1/l,m=1/u;if(P.current&&P.current.map&&(s=V>0?c/d*p:c/d*p-P.current.map.repeat.x,o=Math.abs(1-m)-h/f*m,P.current.map.offset.x=s,P.current.map.offset.y=o),null!=n){let e=Math.floor(n*i.length);isNaN(e=Math.max(0,Math.min(e,i.length-1)))&&(e=0),F.current=e}else x?F.current-=1:F.current+=1};return dK((e,t)=>{var r,i;null!=(r=D.current)&&r.frames&&null!=(i=P.current)&&i.map&&!W.current&&!Z.hasEnded&&(l||p)&&(et(),null==f||f({currentFrameName:O.current,currentFrame:F.current}))}),eN.createElement("group",eU({},M,{ref:B,scale:function(e=new ni(1,1,1),t=1){return"number"==typeof t?e.multiplyScalar(t):Array.isArray(t)?e.multiply(new ni(...t)):t instanceof ni?e.multiply(t):void 0}(H,M.scale)}),eN.createElement(BI.Provider,{value:Z},y&&eN.createElement(Ez,null,eN.createElement("mesh",eU({ref:L,scale:1,geometry:BR},I),eN.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:e1,ref:P,map:N,transparent:!0,alphaTest:null!=A?A:0}))),!y&&eN.createElement(BS,eU({geometry:BR,limit:null!=b?b:1},I),eN.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:e1,ref:P,map:N,transparent:!0,alphaTest:null!=A?A:0}),(null!=S?S:[0]).map((e,t)=>eN.createElement(Bb,eU({key:t,ref:(null==S?void 0:S.length)===1?L:null,position:e,scale:1},I)))),v))});var BD=Object.defineProperty,BP=(e,t,r)=>t in e?BD(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,BL=(e,t,r)=>(BP(e,"symbol"!=typeof t?t+"":t,r),r);let Bk=(e=1)=>{let t=new oc(new Float32Array(4096*e*4),1024,4*e,ru,re);return t.wrapS=tW,t.wrapT=tW,t.magFilter=tK,t.needsUpdate=!0,t},BF=(e,t,r=0)=>{let i=Math.floor(1024);t.arcLengthDivisions=i/2,t.updateArcLengths();let n=t.getSpacedPoints(i),a=t.computeFrenetFrames(i,!0);for(let t=0;t<i;t++){let i=Math.floor(t/1024),s=t%1024,o=n[t];BO(e,s,o.x,o.y,o.z,0+i+4*r),BO(e,s,(o=a.tangents[t]).x,o.y,o.z,1+i+4*r),BO(e,s,(o=a.normals[t]).x,o.y,o.z,2+i+4*r),BO(e,s,(o=a.binormals[t]).x,o.y,o.z,3+i+4*r)}e.needsUpdate=!0},BO=(e,t,r,i,n,a)=>{let{data:s}=e.image,o=4096*a;s[4*t+o+0]=r,s[4*t+o+1]=i,s[4*t+o+2]=n,s[4*t+o+3]=1},BU=e=>({spineTexture:{value:e},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}});class BN{constructor(e,t=1){BL(this,"curveArray"),BL(this,"curveLengthArray"),BL(this,"object3D"),BL(this,"splineTexure"),BL(this,"uniforms");let r=e.clone(),i=Bk(t),n=BU(i);r.traverse(e=>{(e instanceof sE||e instanceof o_)&&(e.material=e.material.clone(),function(e,t,r=1){e.__ok||(e.__ok=!0,e.onBeforeCompile=e=>{if(e.__modified)return;e.__modified=!0,Object.assign(e.uniforms,t);let i=`
		uniform sampler2D spineTexture;
		uniform float pathOffset;
		uniform float pathSegment;
		uniform float spineOffset;
		uniform float spineLength;
		uniform int flow;

		float textureLayers = ${4*r}.;
		float textureStacks = 1.;

		${e.vertexShader}
		`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,`
        void main() {
        #include <beginnormal_vertex>

        vec4 worldPos = modelMatrix * vec4(position, 1.);

        bool bend = flow > 0;
        float xWeight = bend ? 0. : 1.;

        #ifdef USE_INSTANCING
        float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];
        float spineLengthFromInstanceMatrix = instanceMatrix[3][0];
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;
        float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;
        #else
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;
        float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;
        #endif

        mt = mod(mt, textureStacks);
        float rowOffset = floor(mt);

        #ifdef USE_INSTANCING
        rowOffset += instanceMatrix[3][1] * 4.;
        #endif

        vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;
        mat3 basis = mat3(a, b, c);

        vec3 transformed = basis
          * vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)
          + spinePos;

        vec3 transformedNormal = normalMatrix * (basis * objectNormal);
			`).replace("#include <project_vertex>",`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
				gl_Position = projectionMatrix * mvPosition;`);e.vertexShader=i})}(e.material,n,t))}),this.curveArray=Array(t),this.curveLengthArray=Array(t),this.object3D=r,this.splineTexure=i,this.uniforms=n}updateCurve(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");let r=t.getLength();this.uniforms.spineLength.value=r,this.curveLengthArray[e]=r,this.curveArray[e]=t,BF(this.splineTexure,t,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}let Bz=eN.forwardRef(({children:e,curve:t},r)=>{let[i]=eN.useState(()=>new sG),[n,a]=eN.useState(),s=eN.useRef(null);return eN.useLayoutEffect(()=>{s.current=new BN(i.children[0]),a(s.current.object3D)},[e]),eN.useEffect(()=>{var e;t&&(null==(e=s.current)||e.updateCurve(0,t))},[t]),eN.useImperativeHandle(r,()=>s.current),eN.createElement(eN.Fragment,null,d2(e,i),n&&eN.createElement("primitive",{object:n}))});class BG extends uT{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader=`
      uniform float time;
      uniform float radius;
      uniform float distort;
      #define GLSLIFY 1
vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`
        float updateTime = time / 50.0;
        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));
        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));
        `)}get time(){return this._time.value}set time(e){this._time.value=e}get distort(){return this._distort.value}set distort(e){this._distort.value=e}get radius(){return this._radius.value}set radius(e){this._radius.value=e}}let BH=eN.forwardRef(({speed:e=1,...t},r)=>{let[i]=eN.useState(()=>new BG);return dK(t=>i&&(i.time=t.clock.elapsedTime*e)),eN.createElement("primitive",eU({object:i,ref:r,attach:"material"},t))});class BQ extends uC{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._factor={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader=`
      uniform float time;
      uniform float factor;
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`float theta = sin( time + position.y ) / 2.0 * factor;
        float c = cos( theta );
        float s = sin( theta );
        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );
        vec3 transformed = vec3( position ) * m;
        vNormal = vNormal * m;`)}get time(){return this._time.value}set time(e){this._time.value=e}get factor(){return this._factor.value}set factor(e){this._factor.value=e}}let BV=eN.forwardRef(({speed:e=1,...t},r)=>{let[i]=eN.useState(()=>new BQ);return dK(t=>i&&(i.time=t.clock.elapsedTime*e)),eN.createElement("primitive",eU({object:i,ref:r,attach:"material"},t))});class BW extends sT{constructor(e=new nt){super({uniforms:{inputBuffer:new ho(null),depthBuffer:new ho(null),resolution:new ho(new nt),texelSize:new ho(new nt),halfTexelSize:new ho(new nt),kernel:new ho(0),scale:new ho(1),cameraNear:new ho(0),cameraFar:new ho(1),minDepthThreshold:new ho(0),maxDepthThreshold:new ho(1),depthScale:new ho(0),depthToBlurRatioBias:new ho(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:e2,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class Bj{constructor({gl:e,resolution:t,width:r=500,height:i=500,minDepthThreshold:n=0,maxDepthThreshold:a=1,depthScale:s=0,depthToBlurRatioBias:o=.25}){this.renderToScreen=!1,this.renderTargetA=new nM(t,t,{minFilter:tZ,magFilter:tZ,stencilBuffer:!1,depthBuffer:!1,type:rt}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new BW,this.convolutionMaterial.setTexelSize(1/r,1/i),this.convolutionMaterial.setResolution(new nt(r,i)),this.scene=new sG,this.camera=new sI,this.convolutionMaterial.uniforms.minDepthThreshold.value=n,this.convolutionMaterial.uniforms.maxDepthThreshold.value=a,this.convolutionMaterial.uniforms.depthScale.value=s,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=o,this.convolutionMaterial.defines.USE_DEPTH=s>0;let l=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),u=new Float32Array([0,0,2,0,0,2]),c=new sl;c.setAttribute("position",new a1(l,3)),c.setAttribute("uv",new a1(u,2)),this.screen=new sE(c,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,r){let i,n,a;let s=this.scene,o=this.camera,l=this.renderTargetA,u=this.renderTargetB,c=this.convolutionMaterial,h=c.uniforms;h.depthBuffer.value=t.depthTexture;let d=c.kernel,f=t;for(n=0,a=d.length-1;n<a;++n)i=(1&n)==0?l:u,h.kernel.value=d[n],h.inputBuffer.value=f.texture,e.setRenderTarget(i),e.render(s,o),f=i;h.kernel.value=d[n],h.inputBuffer.value=f.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(s,o)}}class BY extends uC{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),e.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}}let BK=eN.forwardRef(({mixBlur:e=0,mixStrength:t=1,resolution:r=256,blur:i=[0,0],minDepthThreshold:n=.9,maxDepthThreshold:a=1,depthScale:s=0,depthToBlurRatioBias:o=.25,mirror:l=0,distortion:u=1,mixContrast:c=1,distortionMap:h,reflectorOffset:d=0,...f},p)=>{dp({MeshReflectorMaterialImpl:BY});let m=dY(({gl:e})=>e),g=dY(({camera:e})=>e),A=dY(({scene:e})=>e),v=(i=Array.isArray(i)?i:[i,i])[0]+i[1]>0,y=eN.useRef(null);eN.useImperativeHandle(p,()=>y.current,[]);let[E]=eN.useState(()=>new oC),[x]=eN.useState(()=>new ni),[_]=eN.useState(()=>new ni),[b]=eN.useState(()=>new ni),[S]=eN.useState(()=>new n8),[w]=eN.useState(()=>new ni(0,0,-1)),[C]=eN.useState(()=>new nT),[T]=eN.useState(()=>new ni),[I]=eN.useState(()=>new ni),[M]=eN.useState(()=>new nT),[R]=eN.useState(()=>new n8),[B]=eN.useState(()=>new sD),D=eN.useCallback(()=>{var e;let t=y.current.parent||(null==(e=y.current)?void 0:e.__r3f.parent);if(!t||(_.setFromMatrixPosition(t.matrixWorld),b.setFromMatrixPosition(g.matrixWorld),S.extractRotation(t.matrixWorld),x.set(0,0,1),x.applyMatrix4(S),_.addScaledVector(x,d),T.subVectors(_,b),T.dot(x)>0))return;T.reflect(x).negate(),T.add(_),S.extractRotation(g.matrixWorld),w.set(0,0,-1),w.applyMatrix4(S),w.add(b),I.subVectors(_,w),I.reflect(x).negate(),I.add(_),B.position.copy(T),B.up.set(0,1,0),B.up.applyMatrix4(S),B.up.reflect(x),B.lookAt(I),B.far=g.far,B.updateMatrixWorld(),B.projectionMatrix.copy(g.projectionMatrix),R.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),R.multiply(B.projectionMatrix),R.multiply(B.matrixWorldInverse),R.multiply(t.matrixWorld),E.setFromNormalAndCoplanarPoint(x,_),E.applyMatrix4(B.matrixWorldInverse),C.set(E.normal.x,E.normal.y,E.normal.z,E.constant);let r=B.projectionMatrix;M.x=(Math.sign(C.x)+r.elements[8])/r.elements[0],M.y=(Math.sign(C.y)+r.elements[9])/r.elements[5],M.z=-1,M.w=(1+r.elements[10])/r.elements[14],C.multiplyScalar(2/C.dot(M)),r.elements[2]=C.x,r.elements[6]=C.y,r.elements[10]=C.z+1,r.elements[14]=C.w},[g,d]),[P,L,k,F]=eN.useMemo(()=>{let d={minFilter:tZ,magFilter:tZ,type:rt},f=new nM(r,r,d);f.depthBuffer=!0,f.depthTexture=new lg(r,r),f.depthTexture.format=rc,f.depthTexture.type=t8;let p=new nM(r,r,d),g=new Bj({gl:m,resolution:r,width:i[0],height:i[1],minDepthThreshold:n,maxDepthThreshold:a,depthScale:s,depthToBlurRatioBias:o}),A={mirror:l,textureMatrix:R,mixBlur:e,tDiffuse:f.texture,tDepth:f.depthTexture,tDiffuseBlur:p.texture,hasBlur:v,mixStrength:t,minDepthThreshold:n,maxDepthThreshold:a,depthScale:s,depthToBlurRatioBias:o,distortion:u,distortionMap:h,mixContrast:c,"defines-USE_BLUR":v?"":void 0,"defines-USE_DEPTH":s>0?"":void 0,"defines-USE_DISTORTION":h?"":void 0};return[f,p,g,A]},[m,i,R,r,l,v,e,t,n,a,s,o,u,h,c]);return dK(()=>{var e;let t=y.current.parent||(null==(e=y.current)?void 0:e.__r3f.parent);if(!t)return;t.visible=!1;let r=m.xr.enabled,i=m.shadowMap.autoUpdate;D(),m.xr.enabled=!1,m.shadowMap.autoUpdate=!1,m.setRenderTarget(P),m.state.buffers.depth.setMask(!0),m.autoClear||m.clear(),m.render(A,B),v&&k.render(m,P,L),m.xr.enabled=r,m.shadowMap.autoUpdate=i,t.visible=!0,m.setRenderTarget(null)}),eN.createElement("meshReflectorMaterialImpl",eU({attach:"material",key:"key"+F["defines-USE_BLUR"]+F["defines-USE_DEPTH"]+F["defines-USE_DISTORTION"],ref:y},F,f))});function Bq(e){switch(e){case 1:return rf;case 2:return rm;case 3:case 4:return rA}}class BX extends oc{constructor(){super(),this.minFilter=tK,this.magFilter=tK,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){let t,r,i,n;let a=this.overrideItemSize,s=e.itemSize,o=e.count;if(null!==a){if(s*o%a!=0)throw Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=a,e.count=o*s/a}let l=e.itemSize,u=e.count,c=e.normalized,h=e.array.constructor,d=h.BYTES_PER_ELEMENT,f=this._forcedType,p=l;if(null===f)switch(h){case Float32Array:f=re;break;case Uint8Array:case Uint16Array:case Uint32Array:f=t7;break;case Int8Array:case Int16Array:case Int32Array:f=t9}let m=function(e){switch(e){case 1:return"R";case 2:return"RG";case 3:case 4:return"RGBA"}throw Error()}(l);switch(f){case re:i=1,r=function(e){switch(e){case 1:return rd;case 2:return rp;case 3:case 4:return ru}}(l),c&&1===d?(n=h,m+="8",h===Uint8Array?t=t4:(t=t5,m+="_SNORM")):(n=Float32Array,m+="32F",t=re);break;case t9:m+=8*d+"I",i=c?Math.pow(2,8*h.BYTES_PER_ELEMENT-1):1,r=Bq(l),1===d?(n=Int8Array,t=t5):2===d?(n=Int16Array,t=t6):(n=Int32Array,t=t9);break;case t7:m+=8*d+"UI",i=c?Math.pow(2,8*h.BYTES_PER_ELEMENT-1):1,r=Bq(l),1===d?(n=Uint8Array,t=t4):2===d?(n=Uint16Array,t=t8):(n=Uint32Array,t=t7)}3===p&&(r===ru||r===rA)&&(p=4);let g=Math.ceil(Math.sqrt(u))||1,A=new n(p*g*g),v=e.normalized;e.normalized=!1;for(let t=0;t<u;t++){let r=p*t;A[r]=e.getX(t)/i,l>=2&&(A[r+1]=e.getY(t)/i),l>=3&&(A[r+2]=e.getZ(t)/i,4===p&&(A[r+3]=1)),l>=4&&(A[r+3]=e.getW(t)/i)}e.normalized=v,this.internalFormat=m,this.format=r,this.type=t,this.image.width=g,this.image.height=g,this.image.data=A,this.needsUpdate=!0,this.dispose(),e.itemSize=s,e.count=o}}class B$ extends BX{constructor(){super(),this._forcedType=t7}}class BJ extends BX{constructor(){super(),this._forcedType=re}}class BZ{constructor(){this.index=new B$,this.position=new BJ,this.bvhBounds=new oc,this.bvhContents=new oc,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){let{geometry:t}=e;if(function(e,t,r){let i=e._roots;if(1!==i.length)throw Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");let n=i[0],a=new Uint16Array(n),s=new Uint32Array(n),o=new Float32Array(n),l=n.byteLength/32,u=2*Math.ceil(Math.sqrt(l/2)),c=new Float32Array(4*u*u),h=Math.ceil(Math.sqrt(l)),d=new Uint32Array(2*h*h);for(let e=0;e<l;e++){let t=32*e/4,r=2*t;for(let r=0;r<3;r++)c[8*e+0+r]=o[t+0+r],c[8*e+4+r]=o[t+3+r];if(Mx(r,a)){let i=M_(r,a),n=s[t+6],o=0xffff0000|i;d[2*e+0]=o,d[2*e+1]=n}else{let r=4*s[t+6]/32,i=s[t+7];d[2*e+0]=i,d[2*e+1]=r}}t.image.data=c,t.image.width=u,t.image.height=u,t.format=ru,t.type=re,t.internalFormat="RGBA32F",t.minFilter=tK,t.magFilter=tK,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose(),r.image.data=d,r.image.width=h,r.image.height=h,r.format=rm,r.type=t7,r.internalFormat="RG32UI",r.minFilter=tK,r.magFilter=tK,r.generateMipmaps=!1,r.needsUpdate=!0,r.dispose()}(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(t.attributes.position),e.indirect){let r=e._indirectBuffer;if(null===this._cachedIndexAttr||this._cachedIndexAttr.count!==r.length){if(t.index)this._cachedIndexAttr=t.index.clone();else{let e=Ms(Mn(t));this._cachedIndexAttr=new a1(e,1,!1)}}(function(e,t,r){let i=r.array,n=e.index?e.index.array:null;for(let e=0,r=t.length;e<r;e++){let r=3*e,a=3*t[e];for(let e=0;e<3;e++)i[r+e]=n?n[a+e]:a+e}})(t,r,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(t.index)}dispose(){let{index:e,position:t,bvhBounds:r,bvhContents:i}=this;e&&e.dispose(),t&&t.dispose(),r&&r.dispose(),i&&i.dispose()}}let B0=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,B1=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,B2=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define\
	bvhIntersectFirstHit(\
		bvh,\
		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\
	)\
	_bvhIntersectFirstHit(\
		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,\
		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\
	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,B3=`
	${B1}
	${B2}
`,B4=be({envMap:null,bounces:3,ior:2.4,correctMips:!0,aberrationStrength:.01,fresnel:0,bvh:new BZ,color:new aQ("white"),opacity:1,resolution:new nt,viewMatrixInverse:new n8,projectionMatrixInverse:new n8},`
  uniform mat4 viewMatrixInverse;

  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_vertex>

  void main() {
    #include <color_vertex>

    vec4 transformedNormal = vec4(normal, 0.0);
    vec4 transformedPosition = vec4(position, 1.0);
    #ifdef USE_INSTANCING
      transformedNormal = instanceMatrix * transformedNormal;
      transformedPosition = instanceMatrix * transformedPosition;
    #endif

    #ifdef USE_INSTANCING
      vModelMatrixInverse = inverse(modelMatrix * instanceMatrix);
    #else
      vModelMatrixInverse = inverse(modelMatrix);
    #endif

    vWorldPosition = (modelMatrix * transformedPosition).xyz;
    vNormal = normalize((viewMatrixInverse * vec4(normalMatrix * transformedNormal.xyz, 0.0)).xyz);
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * transformedPosition;
  }`,`
  #define ENVMAP_TYPE_CUBE_UV
  precision highp isampler2D;
  precision highp usampler2D;
  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    uniform samplerCube envMap;
  #else
    uniform sampler2D envMap;
  #endif

  uniform float bounces;
  ${B0}
  ${B3}
  uniform BVH bvh;
  uniform float ior;
  uniform bool correctMips;
  uniform vec2 resolution;
  uniform float fresnel;
  uniform mat4 modelMatrix;
  uniform mat4 projectionMatrixInverse;
  uniform mat4 viewMatrixInverse;
  uniform float aberrationStrength;
  uniform vec3 color;
  uniform float opacity;

  float fresnelFunc(vec3 viewDirection, vec3 worldNormal) {
    return pow( 1.0 + dot( viewDirection, worldNormal), 10.0 );
  }

  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 normal, float ior, mat4 modelMatrixInverse) {
    vec3 rayOrigin = ro;
    vec3 rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = vWorldPosition + rayDirection * 0.001;
    rayOrigin = (modelMatrixInverse * vec4(rayOrigin, 1.0)).xyz;
    rayDirection = normalize((modelMatrixInverse * vec4(rayDirection, 0.0)).xyz);
    for(float i = 0.0; i < bounces; i++) {
      uvec4 faceIndices = uvec4( 0u );
      vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
      vec3 barycoord = vec3( 0.0 );
      float side = 1.0;
      float dist = 0.0;
      bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );
      vec3 hitPos = rayOrigin + rayDirection * max(dist - 0.001, 0.0);
      vec3 tempDir = refract(rayDirection, faceNormal, ior);
      if (length(tempDir) != 0.0) {
        rayDirection = tempDir;
        break;
      }
      rayDirection = reflect(rayDirection, faceNormal);
      rayOrigin = hitPos + rayDirection * 0.01;
    }
    rayDirection = normalize((modelMatrix * vec4(rayDirection, 0.0)).xyz);
    return rayDirection;
  }

  #include <common>
  #include <cube_uv_reflection_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    vec4 textureGradient(samplerCube envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      return textureGrad(envMap, rayDirection, dFdx(correctMips ? directionCamPerfect: rayDirection), dFdy(correctMips ? directionCamPerfect: rayDirection));
    }
  #else
    vec4 textureGradient(sampler2D envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      vec2 uvv = equirectUv( rayDirection );
      vec2 smoothUv = equirectUv( directionCamPerfect );
      return textureGrad(envMap, uvv, dFdx(correctMips ? smoothUv : uvv), dFdy(correctMips ? smoothUv : uvv));
    }
  #endif

  void main() {
    vec2 uv = gl_FragCoord.xy / resolution;
    vec3 directionCamPerfect = (projectionMatrixInverse * vec4(uv * 2.0 - 1.0, 0.0, 1.0)).xyz;
    directionCamPerfect = (viewMatrixInverse * vec4(directionCamPerfect, 0.0)).xyz;
    directionCamPerfect = normalize(directionCamPerfect);
    vec3 normal = vNormal;
    vec3 rayOrigin = cameraPosition;
    vec3 rayDirection = normalize(vWorldPosition - cameraPosition);

    vec4 diffuseColor = vec4(color, opacity);
    #include <color_fragment>

    #ifdef CHROMATIC_ABERRATIONS
      vec3 rayDirectionG = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      #ifdef FAST_CHROMA
        vec3 rayDirectionR = normalize(rayDirectionG + 1.0 * vec3(aberrationStrength / 2.0));
        vec3 rayDirectionB = normalize(rayDirectionG - 1.0 * vec3(aberrationStrength / 2.0));
      #else
        vec3 rayDirectionR = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 - aberrationStrength), 1.0), vModelMatrixInverse);
        vec3 rayDirectionB = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 + aberrationStrength), 1.0), vModelMatrixInverse);
      #endif
      float finalColorR = textureGradient(envMap, rayDirectionR, directionCamPerfect).r;
      float finalColorG = textureGradient(envMap, rayDirectionG, directionCamPerfect).g;
      float finalColorB = textureGradient(envMap, rayDirectionB, directionCamPerfect).b;
      diffuseColor.rgb *= vec3(finalColorR, finalColorG, finalColorB);
    #else
      rayDirection = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      diffuseColor.rgb *= textureGradient(envMap, rayDirection, directionCamPerfect).rgb;
    #endif

    vec3 viewDirection = normalize(vWorldPosition - cameraPosition);
    float nFresnel = fresnelFunc(viewDirection, normal) * fresnel;
    gl_FragColor = vec4(mix(diffuseColor.rgb, vec3(1.0), nFresnel), diffuseColor.a);

    #include <tonemapping_fragment>
    #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
  }`),B5=e=>e&&e.isCubeTexture;function B6({aberrationStrength:e=0,fastChroma:t=!0,envMap:r,...i}){dp({MeshRefractionMaterial:B4});let n=(0,eN.useRef)(),{size:a}=dY(),s=(0,eN.useMemo)(()=>{var i,n;let a={},s=B5(r),o=Math.floor(Math.log2((null!==(i=s?null==(n=r.image[0])?void 0:n.width:r.image.width)&&void 0!==i?i:1024)/4)),l=Math.pow(2,o),u=3*Math.max(l,112);return s&&(a.ENVMAP_TYPE_CUBEM=""),a.CUBEUV_TEXEL_WIDTH=`${1/u}`,a.CUBEUV_TEXEL_HEIGHT=`${1/(4*l)}`,a.CUBEUV_MAX_MIP=`${o}.0`,e>0&&(a.CHROMATIC_ABERRATIONS=""),t&&(a.FAST_CHROMA=""),a},[e,t]);return(0,eN.useLayoutEffect)(()=>{var e;let t=null==(e=n.current)||null==(e=e.__r3f)||null==(e=e.parent)?void 0:e.geometry;t&&(n.current.bvh=new BZ,n.current.bvh.updateFrom(new Rk(t.clone().toNonIndexed(),{strategy:Mt})))},[]),dK(({camera:e})=>{n.current.viewMatrixInverse=e.matrixWorld,n.current.projectionMatrixInverse=e.projectionMatrixInverse}),eN.createElement("meshRefractionMaterial",eU({key:JSON.stringify(s),defines:s,ref:n,resolution:[a.width,a.height],aberrationStrength:e,envMap:r},i))}let B8=be({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");class B9 extends uT{constructor(e=6,t=!1){super(),this.uniforms={chromaticAberration:{value:.05},transmission:{value:0},_transmission:{value:1},transmissionMap:{value:null},roughness:{value:0},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:1/0},attenuationColor:{value:new aQ("white")},anisotropicBlur:{value:.1},time:{value:0},distortion:{value:0},distortionScale:{value:.5},temporalDistortion:{value:0},buffer:{value:null}},this.onBeforeCompile=r=>{r.uniforms={...r.uniforms,...this.uniforms},this.anisotropy>0&&(r.defines.USE_ANISOTROPY=""),t?r.defines.USE_SAMPLER="":r.defines.USE_TRANSMISSION="",r.fragmentShader=`
      uniform float chromaticAberration;         
      uniform float anisotropicBlur;      
      uniform float time;
      uniform float distortion;
      uniform float distortionScale;
      uniform float temporalDistortion;
      uniform sampler2D buffer;

      vec3 random3(vec3 c) {
        float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
        vec3 r;
        r.z = fract(512.0*j);
        j *= .125;
        r.x = fract(512.0*j);
        j *= .125;
        r.y = fract(512.0*j);
        return r-0.5;
      }

      uint hash( uint x ) {
        x += ( x << 10u );
        x ^= ( x >>  6u );
        x += ( x <<  3u );
        x ^= ( x >> 11u );
        x += ( x << 15u );
        return x;
      }

      // Compound versions of the hashing algorithm I whipped together.
      uint hash( uvec2 v ) { return hash( v.x ^ hash(v.y)                         ); }
      uint hash( uvec3 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z)             ); }
      uint hash( uvec4 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z) ^ hash(v.w) ); }

      // Construct a float with half-open range [0:1] using low 23 bits.
      // All zeroes yields 0.0, all ones yields the next smallest representable value below 1.0.
      float floatConstruct( uint m ) {
        const uint ieeeMantissa = 0x007FFFFFu; // binary32 mantissa bitmask
        const uint ieeeOne      = 0x3F800000u; // 1.0 in IEEE binary32
        m &= ieeeMantissa;                     // Keep only mantissa bits (fractional part)
        m |= ieeeOne;                          // Add fractional part to 1.0
        float  f = uintBitsToFloat( m );       // Range [1:2]
        return f - 1.0;                        // Range [0:1]
      }

      // Pseudo-random value in half-open range [0:1].
      float randomBase( float x ) { return floatConstruct(hash(floatBitsToUint(x))); }
      float randomBase( vec2  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec3  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec4  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float rand(float seed) {
        float result = randomBase(vec3(gl_FragCoord.xy, seed));
        return result;
      }

      const float F3 =  0.3333333;
      const float G3 =  0.1666667;

      float snoise(vec3 p) {
        vec3 s = floor(p + dot(p, vec3(F3)));
        vec3 x = p - s + dot(s, vec3(G3));
        vec3 e = step(vec3(0.0), x - x.yzx);
        vec3 i1 = e*(1.0 - e.zxy);
        vec3 i2 = 1.0 - e.zxy*(1.0 - e);
        vec3 x1 = x - i1 + G3;
        vec3 x2 = x - i2 + 2.0*G3;
        vec3 x3 = x - 1.0 + 3.0*G3;
        vec4 w, d;
        w.x = dot(x, x);
        w.y = dot(x1, x1);
        w.z = dot(x2, x2);
        w.w = dot(x3, x3);
        w = max(0.6 - w, 0.0);
        d.x = dot(random3(s), x);
        d.y = dot(random3(s + i1), x1);
        d.z = dot(random3(s + i2), x2);
        d.w = dot(random3(s + 1.0), x3);
        w *= w;
        w *= w;
        d *= w;
        return dot(d, vec4(52.0));
      }

      float snoiseFractal(vec3 m) {
        return 0.5333333* snoise(m)
              +0.2666667* snoise(2.0*m)
              +0.1333333* snoise(4.0*m)
              +0.0666667* snoise(8.0*m);
      }
`+r.fragmentShader,r.fragmentShader=r.fragmentShader.replace("#include <transmission_pars_fragment>",`
        #ifdef USE_TRANSMISSION
          // Transmission code is based on glTF-Sampler-Viewer
          // https://github.com/KhronosGroup/glTF-Sample-Viewer
          uniform float _transmission;
          uniform float thickness;
          uniform float attenuationDistance;
          uniform vec3 attenuationColor;
          #ifdef USE_TRANSMISSIONMAP
            uniform sampler2D transmissionMap;
          #endif
          #ifdef USE_THICKNESSMAP
            uniform sampler2D thicknessMap;
          #endif
          uniform vec2 transmissionSamplerSize;
          uniform sampler2D transmissionSamplerMap;
          uniform mat4 modelMatrix;
          uniform mat4 projectionMatrix;
          varying vec3 vWorldPosition;
          vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
            // Direction of refracted light.
            vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
            // Compute rotation-independant scaling of the model matrix.
            vec3 modelScale;
            modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
            modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
            modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
            // The thickness is specified in local space.
            return normalize( refractionVector ) * thickness * modelScale;
          }
          float applyIorToRoughness( const in float roughness, const in float ior ) {
            // Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
            // an IOR of 1.5 results in the default amount of microfacet refraction.
            return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
          }
          vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
            float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );            
            #ifdef USE_SAMPLER
              #ifdef texture2DLodEXT
                return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #else
                return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #endif
            #else
              return texture2D(buffer, fragCoord.xy);
            #endif
          }
          vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
            if ( isinf( attenuationDistance ) ) {
              // Attenuation distance is +∞, i.e. the transmitted color is not attenuated at all.
              return radiance;
            } else {
              // Compute light attenuation using Beer's law.
              vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
              vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law
              return transmittance * radiance;
            }
          }
          vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
            const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
            const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
            const in vec3 attenuationColor, const in float attenuationDistance ) {
            vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
            vec3 refractedRayExit = position + transmissionRay;
            // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
            vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
            vec2 refractionCoords = ndcPos.xy / ndcPos.w;
            refractionCoords += 1.0;
            refractionCoords /= 2.0;
            // Sample framebuffer to get pixel the refracted ray hits.
            vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
            vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
            // Get the specular component.
            vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
            return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
          }
        #endif
`),r.fragmentShader=r.fragmentShader.replace("#include <transmission_fragment>",`  
        // Improve the refraction to use the world pos
        material.transmission = _transmission;
        material.transmissionAlpha = 1.0;
        material.thickness = thickness;
        material.attenuationDistance = attenuationDistance;
        material.attenuationColor = attenuationColor;
        #ifdef USE_TRANSMISSIONMAP
          material.transmission *= texture2D( transmissionMap, vUv ).r;
        #endif
        #ifdef USE_THICKNESSMAP
          material.thickness *= texture2D( thicknessMap, vUv ).g;
        #endif
        
        vec3 pos = vWorldPosition;
        float runningSeed = 0.0;
        vec3 v = normalize( cameraPosition - pos );
        vec3 n = inverseTransformDirection( normal, viewMatrix );
        vec3 transmission = vec3(0.0);
        float transmissionR, transmissionB, transmissionG;
        float randomCoords = rand(runningSeed++);
        float thickness_smear = thickness * max(pow(roughnessFactor, 0.33), anisotropicBlur);
        vec3 distortionNormal = vec3(0.0);
        vec3 temporalOffset = vec3(time, -time, -time) * temporalDistortion;
        if (distortion > 0.0) {
          distortionNormal = distortion * vec3(snoiseFractal(vec3((pos * distortionScale + temporalOffset))), snoiseFractal(vec3(pos.zxy * distortionScale - temporalOffset)), snoiseFractal(vec3(pos.yxz * distortionScale + temporalOffset)));
        }
        for (float i = 0.0; i < ${e}.0; i ++) {
          vec3 sampleNorm = normalize(n + roughnessFactor * roughnessFactor * 2.0 * normalize(vec3(rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5)) * pow(rand(runningSeed++), 0.33) + distortionNormal);
          transmissionR = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness  + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).r;
          transmissionG = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior  * (1.0 + chromaticAberration * (i + randomCoords) / float(${e})) , material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).g;
          transmissionB = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior * (1.0 + 2.0 * chromaticAberration * (i + randomCoords) / float(${e})), material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).b;
          transmission.r += transmissionR;
          transmission.g += transmissionG;
          transmission.b += transmissionB;
        }
        transmission /= ${e}.0;
        totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
`)},Object.keys(this.uniforms).forEach(e=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t}))}}let B7=eN.forwardRef(({buffer:e,transmissionSampler:t=!1,backside:r=!1,side:i=eZ,transmission:n=1,thickness:a=0,backsideThickness:s=0,backsideEnvMapIntensity:o=1,samples:l=10,resolution:u,backsideResolution:c,background:h,anisotropy:d,anisotropicBlur:f,...p},m)=>{let g,A,v,y;dp({MeshTransmissionMaterial:B9});let E=eN.useRef(null),[x]=eN.useState(()=>new B8),_=SX(c||u),b=SX(u);return dK(e=>{E.current.time=e.clock.elapsedTime,E.current.buffer===b.texture&&!t&&(y=E.current.__r3f.parent)&&(v=e.gl.toneMapping,g=e.scene.background,A=E.current.envMapIntensity,e.gl.toneMapping=tM,h&&(e.scene.background=h),y.material=x,r&&(e.gl.setRenderTarget(_),e.gl.render(e.scene,e.camera),y.material=E.current,y.material.buffer=_.texture,y.material.thickness=s,y.material.side=e0,y.material.envMapIntensity=o),e.gl.setRenderTarget(b),e.gl.render(e.scene,e.camera),y.material=E.current,y.material.thickness=a,y.material.side=i,y.material.buffer=b.texture,y.material.envMapIntensity=A,e.scene.background=g,e.gl.setRenderTarget(null),e.gl.toneMapping=v)}),eN.useImperativeHandle(m,()=>E.current,[]),eN.createElement("meshTransmissionMaterial",eU({args:[l,t],ref:E},p,{buffer:e||b.texture,_transmission:n,anisotropicBlur:null!=f?f:d,transmission:t?n:0,thickness:a,side:i}))}),De=eN.forwardRef((e,t)=>(dp({DiscardMaterialImpl:B8}),eN.createElement("discardMaterialImpl",eU({ref:t},e))));function Dt(e){let t=eN.useRef(null);return eN.useLayoutEffect(()=>{var e;let r=null==(e=t.current)?void 0:e.parent,i=null==r?void 0:r.geometry;if(i){let e=r.material;r.material=t.current.__r3f.objects;let n=[...i.groups];return i.clearGroups(),r.material.forEach((e,t)=>{t<r.material.length-1&&(e.depthWrite=!1),i.addGroup(0,1/0,t)}),()=>{r.material=e,i.groups=n}}}),eN.createElement("group",eU({ref:t},e))}let Dr=bn>=154?"opaque_fragment":"output_fragment";class Di extends lr{constructor(e){super(e),this.onBeforeCompile=(e,t)=>{let{isWebGL2:r}=t.capabilities;e.fragmentShader=e.fragmentShader.replace(`#include <${Dr}>`,`
        ${r?`#include <${Dr}>`:`#extension GL_OES_standard_derivatives : enable
#include <${Dr}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}let Dn=eN.forwardRef((e,t)=>{let[r]=eN.useState(()=>new Di(null));return eN.createElement("primitive",eU({},e,{object:r,ref:t,attach:"material"}))}),Da=({focus:e=0,size:t=25,samples:r=10}={})=>`
#define PENUMBRA_FILTER_SIZE float(${t})
#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))
vec3 randRGB(vec2 uv) {
  return vec3(
    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),
    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),
    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)
  );
}

vec3 lowPassRandRGB(vec2 uv) {
  // 3x3 convolution (average)
  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9
  vec3 result = vec3(0);
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));
  result *= 0.111111111; // 1.0 / 9.0
  return result;
}
vec3 highPassRandRGB(vec2 uv) {
  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal
  // hp(x) = x - lp(x)
  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;
}


vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}
float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation
  return (zReceiver - zBlocker) / zBlocker;
}
float findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float blockerDepthSum = float(${e});
  float blockers = 0.0;

  int j = 0;
  vec2 offset = vec2(0.);
  float depth = 0.;

  #pragma unroll_loop_start
  for(int i = 0; i < ${r}; i ++) {
    offset = (vogelDiskSample(j, ${r}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;
    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));
    if (depth < compare) {
      blockerDepthSum += depth;
      blockers++;
    }
    j++;
  }
  #pragma unroll_loop_end

  if (blockers > 0.0) {
    return blockerDepthSum / blockers;
  }
  return -1.0;
}

        
float vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float shadow = 0.0f;
  int j = 0;
  vec2 vogelSample = vec2(0.0);
  vec2 offset = vec2(0.0);
  #pragma unroll_loop_start
  for (int i = 0; i < ${r}; i++) {
    vogelSample = vogelDiskSample(j, ${r}, angle) * texelSize;
    offset = vogelSample * (1.0 + filterRadius * float(${t}));
    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    j++;
  }
  #pragma unroll_loop_end
  return shadow * 1.0 / ${r}.0;
}

float PCSS (sampler2D shadowMap, vec4 coords) {
  vec2 uv = coords.xy;
  float zReceiver = coords.z; // Assumed to be eye-space z in this code
  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;
  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);
  if (avgBlockerDepth == -1.0) {
    return 1.0;
  }
  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);
  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);
}`;function Ds(e,t,r){t.traverse(t=>{t.material&&(e.properties.remove(t.material),null==t.material.dispose||t.material.dispose())}),e.info.programs.length=0,e.compile(t,r)}function Do({focus:e=0,samples:t=10,size:r=25}){let i=dY(e=>e.gl),n=dY(e=>e.scene),a=dY(e=>e.camera);return eN.useEffect(()=>{let s=A9.shadowmap_pars_fragment;return A9.shadowmap_pars_fragment=A9.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP","#ifdef USE_SHADOWMAP\n"+Da({size:r,samples:t,focus:e})).replace("#if defined( SHADOWMAP_TYPE_PCF )","\nreturn PCSS(shadowMap, shadowCoord);\n#if defined( SHADOWMAP_TYPE_PCF )"),Ds(i,n,a),()=>{A9.shadowmap_pars_fragment=s,Ds(i,n,a)}},[e,r,t]),null}function Dl(e,t){let r=e+"Geometry";return eN.forwardRef(({args:e,children:i,...n},a)=>{let s=eN.useRef(null);return eN.useImperativeHandle(a,()=>s.current),eN.useLayoutEffect(()=>void(null==t||t(s.current))),eN.createElement("mesh",eU({ref:s},n),eN.createElement(r,{attach:"geometry",args:e}),i)})}let Du=Dl("box"),Dc=Dl("circle"),Dh=Dl("cone"),Dd=Dl("cylinder"),Df=Dl("sphere"),Dp=Dl("plane"),Dm=Dl("tube"),Dg=Dl("torus"),DA=Dl("torusKnot"),Dv=Dl("tetrahedron"),Dy=Dl("ring"),DE=Dl("polyhedron"),Dx=Dl("icosahedron"),D_=Dl("octahedron"),Db=Dl("dodecahedron"),DS=Dl("extrude"),Dw=Dl("lathe"),DC=Dl("capsule"),DT=Dl("shape",({geometry:e})=>{let t=e.attributes.position,r=new nL().setFromBufferAttribute(t),i=new ni;r.getSize(i);let n=[],a=0,s=0,o=0,l=0;for(let e=0;e<t.count;e++)a=t.getX(e),s=t.getY(e),o=(a-r.min.x)/i.x,l=(s-r.min.y)/i.y,n.push(o,l);e.setAttribute("uv",new se(n,2))}),DI=eN.forwardRef(function({args:[e=1,t=1,r=1]=[],radius:i=.05,steps:n=1,smoothness:a=4,bevelSegments:s=4,creaseAngle:o=.4,children:l,...u},c){let h=eN.useMemo(()=>(function(e,t,r){let i=new l$,n=r-1e-5;return i.absarc(1e-5,1e-5,1e-5,-Math.PI/2,-Math.PI,!0),i.absarc(1e-5,t-2*n,1e-5,Math.PI,Math.PI/2,!0),i.absarc(e-2*n,t-2*n,1e-5,Math.PI/2,0,!0),i.absarc(e-2*n,1e-5,1e-5,0,-Math.PI/2,!0),i})(e,t,i),[e,t,i]),d=eN.useMemo(()=>({depth:r-2*i,bevelEnabled:!0,bevelSegments:2*s,steps:n,bevelSize:i-1e-5,bevelThickness:i,curveSegments:a}),[r,i,a]),f=eN.useRef(null);return eN.useLayoutEffect(()=>{f.current&&(f.current.center(),_b(f.current,o))},[h,d]),eN.createElement("mesh",eU({ref:c},u),eN.createElement("extrudeGeometry",{ref:f,args:[h,d]}),l)});function DM(){let e=new sl,t=new Float32Array([-1,-1,3,-1,-1,3]);return e.boundingSphere=new nJ,e.boundingSphere.set(new ni,1/0),e.setAttribute("position",new a1(t,2)),e}let DR=eN.forwardRef(function({children:e,...t},r){let i=eN.useMemo(DM,[]);return eN.createElement("mesh",eU({ref:r,geometry:i,frustumCulled:!1},t),e)}),DB=eN.forwardRef(({children:e,width:t,height:r,depth:i,box3:n,precise:a=!0,...s},o)=>{let l=eN.useRef(null),u=eN.useRef(null),c=eN.useRef(null);return eN.useLayoutEffect(()=>{u.current.matrixWorld.identity();let e=n||new nL().setFromObject(c.current,a),s=e.max.x-e.min.x,o=e.max.y-e.min.y,l=e.max.z-e.min.z,h=Math.max(s,o,l);t&&(h=s),r&&(h=o),i&&(h=l),u.current.scale.setScalar(1/h)},[t,r,i,n,a]),eN.useImperativeHandle(o,()=>l.current,[]),eN.createElement("group",eU({ref:l},s),eN.createElement("group",{ref:u},eN.createElement("group",{ref:c},e)))});var DD=function(e){return e[e.NONE=0]="NONE",e[e.START=1]="START",e[e.ACTIVE=2]="ACTIVE",e}(DD||{});let DP=e=>e&&e.isOrthographicCamera,DL=e=>e&&e.isBox3,Dk=e=>1-Math.exp(-5*e)+.007*e,DF=eN.createContext(null);function DO({children:e,maxDuration:t=1,margin:r=1.2,observe:i,fit:n,clip:a,interpolateFunc:s=Dk,onFit:o}){let l=eN.useRef(null),{camera:u,size:c,invalidate:h}=dY(),d=dY(e=>e.controls),f=eN.useRef(o);f.current=o;let p=eN.useRef({camPos:new ni,camRot:new nr,camZoom:1}),m=eN.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),g=eN.useRef(DD.NONE),A=eN.useRef(0),[v]=eN.useState(()=>new nL),y=eN.useMemo(()=>{function e(){let e=v.getSize(new ni),t=v.getCenter(new ni),i=Math.max(e.x,e.y,e.z),n=DP(u)?4*i:i/(2*Math.atan(Math.PI*u.fov/360)),a=DP(u)?4*i:n/u.aspect;return{box:v,size:e,center:t,distance:r*Math.max(n,a)}}return{getSize:e,refresh(e){if(DL(e))v.copy(e);else{let t=e||l.current;if(!t)return this;t.updateWorldMatrix(!0,!0),v.setFromObject(t)}if(v.isEmpty()){let e=u.position.length()||10;v.setFromCenterAndSize(new ni,new ni(e,e,e))}return p.current.camPos.copy(u.position),p.current.camRot.copy(u.quaternion),DP(u)&&(p.current.camZoom=u.zoom),m.current.camPos=void 0,m.current.camRot=void 0,m.current.camZoom=void 0,m.current.camUp=void 0,m.current.target=void 0,this},reset(){let{center:t,distance:r}=e(),i=u.position.clone().sub(t).normalize();m.current.camPos=t.clone().addScaledVector(i,r),m.current.target=t.clone();let n=new n8().lookAt(m.current.camPos,m.current.target,u.up);return m.current.camRot=new nr().setFromRotationMatrix(n),g.current=DD.START,A.current=0,this},moveTo(e){return m.current.camPos=Array.isArray(e)?new ni(...e):e.clone(),g.current=DD.START,A.current=0,this},lookAt({target:e,up:t}){m.current.target=Array.isArray(e)?new ni(...e):e.clone(),t?m.current.camUp=Array.isArray(t)?new ni(...t):t.clone():m.current.camUp=u.up.clone();let r=new n8().lookAt(m.current.camPos||u.position,m.current.target,m.current.camUp);return m.current.camRot=new nr().setFromRotationMatrix(r),g.current=DD.START,A.current=0,this},to({position:e,target:t}){return this.moveTo(e).lookAt({target:t})},fit(){if(!DP(u))return this.reset();let e=0,t=0,i=[new ni(v.min.x,v.min.y,v.min.z),new ni(v.min.x,v.max.y,v.min.z),new ni(v.min.x,v.min.y,v.max.z),new ni(v.min.x,v.max.y,v.max.z),new ni(v.max.x,v.max.y,v.max.z),new ni(v.max.x,v.max.y,v.min.z),new ni(v.max.x,v.min.y,v.max.z),new ni(v.max.x,v.min.y,v.min.z)],n=m.current.camPos||u.position,a=m.current.target||(null==d?void 0:d.target),s=m.current.camUp||u.up,o=a?new n8().lookAt(n,a,s).setPosition(n).invert():u.matrixWorldInverse;for(let r of i)r.applyMatrix4(o),e=Math.max(e,Math.abs(r.y)),t=Math.max(t,Math.abs(r.x));e*=2,t*=2;let l=(u.top-u.bottom)/e,c=(u.right-u.left)/t;return m.current.camZoom=Math.min(l,c)/r,g.current=DD.START,A.current=0,f.current&&f.current(this.getSize()),this},clip(){let{distance:t}=e();return u.near=t/100,u.far=100*t,u.updateProjectionMatrix(),d&&(d.maxDistance=10*t,d.update()),h(),this}}},[v,u,d,r,h]);eN.useLayoutEffect(()=>{if(d){let e=()=>{if(d&&m.current.target&&g.current!==DD.NONE){let e=new ni().setFromMatrixColumn(u.matrix,2),t=p.current.camPos.distanceTo(d.target),r=(m.current.camPos||p.current.camPos).distanceTo(m.current.target),i=(1-A.current)*t+A.current*r;d.target.copy(u.position).addScaledVector(e,-i),d.update()}g.current=DD.NONE};return d.addEventListener("start",e),()=>d.removeEventListener("start",e)}},[d]);let E=eN.useRef(0);return eN.useLayoutEffect(()=>{(i||0==E.current++)&&(y.refresh(),n&&y.reset().fit(),a&&y.clip())},[c,a,n,i,u,d]),dK((e,r)=>{if(g.current===DD.START)g.current=DD.ACTIVE,h();else if(g.current===DD.ACTIVE){if(A.current+=r/t,A.current>=1)m.current.camPos&&u.position.copy(m.current.camPos),m.current.camRot&&u.quaternion.copy(m.current.camRot),m.current.camUp&&u.up.copy(m.current.camUp),m.current.camZoom&&DP(u)&&(u.zoom=m.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix(),d&&m.current.target&&(d.target.copy(m.current.target),d.update()),g.current=DD.NONE;else{let e=s(A.current);m.current.camPos&&u.position.lerpVectors(p.current.camPos,m.current.camPos,e),m.current.camRot&&u.quaternion.slerpQuaternions(p.current.camRot,m.current.camRot,e),m.current.camUp&&u.up.set(0,1,0).applyQuaternion(u.quaternion),m.current.camZoom&&DP(u)&&(u.zoom=(1-e)*p.current.camZoom+e*m.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix()}h()}}),eN.createElement("group",{ref:l},eN.createElement(DF.Provider,{value:y},e))}function DU(){return eN.useContext(DF)}var DN=Object.defineProperty,Dz=(e,t,r)=>t in e?DN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,DG=(e,t,r)=>(Dz(e,"symbol"!=typeof t?t+"":t,r),r);class DH{constructor(e=Math){DG(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),DG(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),DG(this,"p",[]),DG(this,"perm",[]),DG(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),DG(this,"dot",(e,t,r)=>e[0]*t+e[1]*r),DG(this,"dot3",(e,t,r,i)=>e[0]*t+e[1]*r+e[2]*i),DG(this,"dot4",(e,t,r,i,n)=>e[0]*t+e[1]*r+e[2]*i+e[3]*n),DG(this,"noise",(e,t)=>{let r,i,n;let a=.5*(Math.sqrt(3)-1)*(e+t),s=Math.floor(e+a),o=Math.floor(t+a),l=(3-Math.sqrt(3))/6,u=(s+o)*l,c=e-(s-u),h=t-(o-u),d=0,f=1;c>h&&(d=1,f=0);let p=c-d+l,m=h-f+l,g=c-1+2*l,A=h-1+2*l,v=255&s,y=255&o,E=this.perm[v+this.perm[y]]%12,x=this.perm[v+d+this.perm[y+f]]%12,_=this.perm[v+1+this.perm[y+1]]%12,b=.5-c*c-h*h;b<0?r=0:(b*=b,r=b*b*this.dot(this.grad3[E],c,h));let S=.5-p*p-m*m;S<0?i=0:(S*=S,i=S*S*this.dot(this.grad3[x],p,m));let w=.5-g*g-A*A;return w<0?n=0:(w*=w,n=w*w*this.dot(this.grad3[_],g,A)),70*(r+i+n)}),DG(this,"noise3d",(e,t,r)=>{let i,n,a,s,o,l,u,c,h,d;let f=1/3*(e+t+r),p=Math.floor(e+f),m=Math.floor(t+f),g=Math.floor(r+f),A=1/6*(p+m+g),v=e-(p-A),y=t-(m-A),E=r-(g-A);v>=y?y>=E?(o=1,l=0,u=0,c=1,h=1,d=0):(v>=E?(o=1,l=0,u=0):(o=0,l=0,u=1),c=1,h=0,d=1):y<E?(o=0,l=0,u=1,c=0,h=1,d=1):v<E?(o=0,l=1,u=0,c=0,h=1,d=1):(o=0,l=1,u=0,c=1,h=1,d=0);let x=v-o+1/6,_=y-l+1/6,b=E-u+1/6,S=v-c+1/6*2,w=y-h+1/6*2,C=E-d+1/6*2,T=v-1+1/6*3,I=y-1+1/6*3,M=E-1+1/6*3,R=255&p,B=255&m,D=255&g,P=this.perm[R+this.perm[B+this.perm[D]]]%12,L=this.perm[R+o+this.perm[B+l+this.perm[D+u]]]%12,k=this.perm[R+c+this.perm[B+h+this.perm[D+d]]]%12,F=this.perm[R+1+this.perm[B+1+this.perm[D+1]]]%12,O=.6-v*v-y*y-E*E;O<0?i=0:(O*=O,i=O*O*this.dot3(this.grad3[P],v,y,E));let U=.6-x*x-_*_-b*b;U<0?n=0:(U*=U,n=U*U*this.dot3(this.grad3[L],x,_,b));let N=.6-S*S-w*w-C*C;N<0?a=0:(N*=N,a=N*N*this.dot3(this.grad3[k],S,w,C));let z=.6-T*T-I*I-M*M;return z<0?s=0:(z*=z,s=z*z*this.dot3(this.grad3[F],T,I,M)),32*(i+n+a+s)}),DG(this,"noise4d",(e,t,r,i)=>{let n,a,s,o,l,u,c,h,d,f,p,m,g,A,v,y,E;let x=this.grad4,_=this.simplex,b=this.perm,S=(5-Math.sqrt(5))/20,w=(Math.sqrt(5)-1)/4*(e+t+r+i),C=Math.floor(e+w),T=Math.floor(t+w),I=Math.floor(r+w),M=Math.floor(i+w),R=(C+T+I+M)*S,B=e-(C-R),D=t-(T-R),P=r-(I-R),L=i-(M-R),k=(B>D?32:0)+(B>P?16:0)+(D>P?8:0)+(B>L?4:0)+(D>L?2:0)+(P>L?1:0);u=_[k][0]>=3?1:0,c=_[k][1]>=3?1:0,h=_[k][2]>=3?1:0,d=_[k][3]>=3?1:0,f=_[k][0]>=2?1:0,p=_[k][1]>=2?1:0,m=_[k][2]>=2?1:0,g=_[k][3]>=2?1:0,A=_[k][0]>=1?1:0,v=_[k][1]>=1?1:0,y=_[k][2]>=1?1:0,E=_[k][3]>=1?1:0;let F=B-u+S,O=D-c+S,U=P-h+S,N=L-d+S,z=B-f+2*S,G=D-p+2*S,H=P-m+2*S,Q=L-g+2*S,V=B-A+3*S,W=D-v+3*S,j=P-y+3*S,Y=L-E+3*S,K=B-1+4*S,q=D-1+4*S,X=P-1+4*S,$=L-1+4*S,J=255&C,Z=255&T,ee=255&I,et=255&M,er=b[J+b[Z+b[ee+b[et]]]]%32,ei=b[J+u+b[Z+c+b[ee+h+b[et+d]]]]%32,en=b[J+f+b[Z+p+b[ee+m+b[et+g]]]]%32,ea=b[J+A+b[Z+v+b[ee+y+b[et+E]]]]%32,es=b[J+1+b[Z+1+b[ee+1+b[et+1]]]]%32,eo=.6-B*B-D*D-P*P-L*L;eo<0?n=0:(eo*=eo,n=eo*eo*this.dot4(x[er],B,D,P,L));let el=.6-F*F-O*O-U*U-N*N;el<0?a=0:(el*=el,a=el*el*this.dot4(x[ei],F,O,U,N));let eu=.6-z*z-G*G-H*H-Q*Q;eu<0?s=0:(eu*=eu,s=eu*eu*this.dot4(x[en],z,G,H,Q));let ec=.6-V*V-W*W-j*j-Y*Y;ec<0?o=0:(ec*=ec,o=ec*ec*this.dot4(x[ea],V,W,j,Y));let eh=.6-K*K-q*q-X*X-$*$;return eh<0?l=0:(eh*=eh,l=eh*eh*this.dot4(x[es],K,q,X,$)),27*(n+a+s+o+l)});for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());for(let e=0;e<512;e++)this.perm[e]=this.p[255&e]}}let DQ=eN.forwardRef(({intensity:e=1,decay:t,decayRate:r=.65,maxYaw:i=.1,maxPitch:n=.1,maxRoll:a=.1,yawFrequency:s=.1,pitchFrequency:o=.1,rollFrequency:l=.1},u)=>{let c=dY(e=>e.camera),h=dY(e=>e.controls),d=eN.useRef(e),f=eN.useRef(c.rotation.clone()),[p]=eN.useState(()=>new DH),[m]=eN.useState(()=>new DH),[g]=eN.useState(()=>new DH),A=()=>{(d.current<0||d.current>1)&&(d.current=d.current<0?0:1)};return eN.useImperativeHandle(u,()=>({getIntensity:()=>d.current,setIntensity:e=>{d.current=e,A()}}),[]),eN.useEffect(()=>{if(h){let e=()=>void(f.current=c.rotation.clone());return h.addEventListener("change",e),e(),()=>void h.removeEventListener("change",e)}},[c,h]),dK((e,u)=>{let h=Math.pow(d.current,2),v=i*h*p.noise(e.clock.elapsedTime*s,1),y=n*h*m.noise(e.clock.elapsedTime*o,1),E=a*h*g.noise(e.clock.elapsedTime*l,1);c.rotation.set(f.current.x+y,f.current.y+v,f.current.z+E),t&&d.current>0&&(d.current-=r*u,A())}),null}),DV=eN.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:n=1,floatingRange:a=[-.1,.1],autoInvalidate:s=!1,...o},l)=>{let u=eN.useRef(null);eN.useImperativeHandle(l,()=>u.current,[]);let c=eN.useRef(1e4*Math.random());return dK(e=>{var o,l;if(!t||0===r)return;s&&e.invalidate();let h=c.current+e.clock.elapsedTime;u.current.rotation.x=Math.cos(h/4*r)/8*i,u.current.rotation.y=Math.sin(h/4*r)/8*i,u.current.rotation.z=Math.sin(h/4*r)/20*i;let d=Math.sin(h/4*r)/10;d=ne.mapLinear(d,-.1,.1,null!==(o=null==a?void 0:a[0])&&void 0!==o?o:-.1,null!==(l=null==a?void 0:a[1])&&void 0!==l?l:.1),u.current.position.y=d*n,u.current.updateMatrix()}),eN.createElement("group",o,eN.createElement("group",{ref:u,matrixAutoUpdate:!1},e))}),DW=e=>e&&e.isCubeTexture;class Dj extends sE{constructor(e,t){var r,i;let n=DW(e),a=Math.floor(Math.log2((null!=(i=n?null==(r=e.image[0])?void 0:r.width:e.image.width)?i:1024)/4)),s=Math.pow(2,a),o=3*Math.max(s,112),l=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,u=[n?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/o}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*s)}`,`#define CUBEUV_MAX_MIP ${a}.0`].join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${EZ>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `;super(new uc(1,16),new sT({uniforms:{map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}},fragmentShader:u,vertexShader:l,side:e1}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}class DY extends ci{constructor(e){super(e),this.type=rt}parse(e){let t,r,i;let n=function(e,t){switch(e){case 1:throw Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(t||""))}},a=function(e,t,r){t=t||1024;let i=e.pos,n=-1,a=0,s="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(n=o.indexOf("\n"))&&a<t&&i<e.byteLength;)s+=o,a+=o.length,i+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return -1<n&&(!1!==r&&(e.pos+=a+n+1),s+o.slice(0,n))},s=new Uint8Array(e);s.pos=0;let o=function(e){let t,r;let i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(e.pos>=e.byteLength)&&(t=a(e))||n(1,"no header found"),(r=t.match(/^#\?(\S+)/))||n(3,"bad initial token"),u.valid|=1,u.programtype=r[1],u.string+=t+"\n";!1!==(t=a(e));){if(u.string+=t+"\n","#"===t.charAt(0)){u.comments+=t+"\n";continue}if((r=t.match(i))&&(u.gamma=parseFloat(r[1])),(r=t.match(s))&&(u.exposure=parseFloat(r[1])),(r=t.match(o))&&(u.valid|=2,u.format=r[1]),(r=t.match(l))&&(u.valid|=4,u.height=parseInt(r[1],10),u.width=parseInt(r[2],10)),2&u.valid&&4&u.valid)break}return 2&u.valid||n(3,"missing format specifier"),4&u.valid||n(3,"missing image size specifier"),u}(s),l=o.width,u=o.height,c=function(e,t,r){if(t<8||t>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);t!==(e[2]<<8|e[3])&&n(3,"wrong scanline width");let i=new Uint8Array(4*t*r);i.length||n(4,"unable to allocate buffer space");let a=0,s=0,o=4*t,l=new Uint8Array(4),u=new Uint8Array(o),c=r;for(;c>0&&s<e.byteLength;){s+4>e.byteLength&&n(1),l[0]=e[s++],l[1]=e[s++],l[2]=e[s++],l[3]=e[s++],(2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=t)&&n(3,"bad rgbe scanline format");let r=0,h;for(;r<o&&s<e.byteLength;){let t=(h=e[s++])>128;if(t&&(h-=128),(0===h||r+h>o)&&n(3,"bad scanline data"),t){let t=e[s++];for(let e=0;e<h;e++)u[r++]=t}else u.set(e.subarray(s,s+h),r),r+=h,s+=h}for(let e=0;e<t;e++){let r=0;i[a]=u[e+r],r+=t,i[a+1]=u[e+r],r+=t,i[a+2]=u[e+r],r+=t,i[a+3]=u[e+r],a+=4}c--}return i}(s.subarray(s.pos),l,u);switch(this.type){case re:let h=new Float32Array(4*(i=c.length/4));for(let e=0;e<i;e++)!function(e,t,r,i){let n=Math.pow(2,e[t+3]-128)/255;r[i+0]=e[t+0]*n,r[i+1]=e[t+1]*n,r[i+2]=e[t+2]*n,r[i+3]=1}(c,4*e,h,4*e);t=h,r=re;break;case rt:let d=new Uint16Array(4*(i=c.length/4));for(let e=0;e<i;e++)!function(e,t,r,i){let n=Math.pow(2,e[t+3]-128)/255;r[i+0]=a$.toHalfFloat(Math.min(e[t+0]*n,65504)),r[i+1]=a$.toHalfFloat(Math.min(e[t+1]*n,65504)),r[i+2]=a$.toHalfFloat(Math.min(e[t+2]*n,65504)),r[i+3]=a$.toHalfFloat(1)}(c,4*e,d,4*e);t=d,r=rt;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:l,height:u,data:t,header:o.string,gamma:o.gamma,exposure:o.exposure,type:r}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,function(e,r){switch(e.type){case re:case rt:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=tZ,e.magFilter=tZ,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,i)}}let DK=EZ>=152;class Dq extends ci{constructor(e){super(e),this.type=rt}parse(e){let t={l:0,c:0,lc:0};function r(e,r,i,n,a){for(;i<e;)r=r<<8|w(n,a),i+=8;i-=e,t.l=r>>i&(1<<e)-1,t.c=r,t.lc=i}let i=Array(59),n={c:0,lc:0};function a(e,t,r,i){e=e<<8|w(r,i),t+=8,n.c=e,n.lc=t}let s={c:0,lc:0};function o(e,t,r,i,o,l,u,c,h,d){if(e==t){i<8&&(a(r,i,o,u),r=n.c,i=n.lc);var f=r>>(i-=8),f=new Uint8Array([f])[0];if(h.value+f>d)return!1;for(var p=c[h.value-1];f-- >0;)c[h.value++]=p}else{if(!(h.value<d))return!1;c[h.value++]=e}s.c=r,s.lc=i}function l(e){var t=65535&e;return t>32767?t-65536:t}let u={a:0,b:0};function c(e,t){var r=l(e),i=l(t),n=r+(1&i)+(i>>1),a=n-i;u.a=n,u.b=a}function h(e,t){var r=65535&t,i=(65535&e)-(r>>1)&65535;u.a=r+i-32768&65535,u.b=i}function d(e,l,u,c,h,d){var f=u.value,p=S(l,u),m=S(l,u);u.value+=4;var g=S(l,u);if(u.value+=4,p<0||p>=65537||m<0||m>=65537)throw"Something wrong with HUF_ENCSIZE";var A=Array(65537),v=Array(16384);!function(e){for(var t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(v);var y=c-(u.value-f);if(function(e,n,a,s,o,l,u){for(var c=0,h=0;o<=l;o++){if(a.value-a.value>s)return!1;r(6,c,h,e,a);var d=t.l;if(c=t.c,h=t.lc,u[o]=d,63==d){if(a.value-a.value>s)throw"Something wrong with hufUnpackEncTable";r(8,c,h,e,a);var f=t.l+6;if(c=t.c,h=t.lc,o+f>l+1)throw"Something wrong with hufUnpackEncTable";for(;f--;)u[o++]=0;o--}else if(d>=59){var f=d-59+2;if(o+f>l+1)throw"Something wrong with hufUnpackEncTable";for(;f--;)u[o++]=0;o--}}!function(e){for(var t=0;t<=58;++t)i[t]=0;for(var t=0;t<65537;++t)i[e[t]]+=1;for(var r=0,t=58;t>0;--t){var n=r+i[t]>>1;i[t]=r,r=n}for(var t=0;t<65537;++t){var a=e[t];a>0&&(e[t]=a|i[a]++<<6)}}(u)}(e,0,u,y,p,m,A),g>8*(c-(u.value-f)))throw"Something wrong with hufUncompress";(function(e,t,r,i){for(;t<=r;t++){var n=e[t]>>6,a=63&e[t];if(n>>a)throw"Invalid table entry";if(a>14){var s=i[n>>a-14];if(s.len)throw"Invalid table entry";if(s.lit++,s.p){var o=s.p;s.p=Array(s.lit);for(var l=0;l<s.lit-1;++l)s.p[l]=o[l]}else s.p=[,];s.p[s.lit-1]=t}else if(a)for(var u=0,l=1<<14-a;l>0;l--){var s=i[(n<<14-a)+u];if(s.len||s.p)throw"Invalid table entry";s.len=a,s.lit=t,u++}}})(A,p,m,v),function(e,t,r,i,l,u,c,h,d,f){for(var p=0,m=0,g=Math.trunc(l.value+(u+7)/8);l.value<g;)for(a(p,m,r,l),p=n.c,m=n.lc;m>=14;){var A=t[p>>m-14&16383];if(A.len)m-=A.len,o(A.lit,c,p,m,r,i,l,d,f,h),p=s.c,m=s.lc;else{if(!A.p)throw"hufDecode issues";for(v=0;v<A.lit;v++){for(var v,y=63&e[A.p[v]];m<y&&l.value<g;)a(p,m,r,l),p=n.c,m=n.lc;if(m>=y&&e[A.p[v]]>>6==(p>>m-y&(1<<y)-1)){m-=y,o(A.p[v],c,p,m,r,i,l,d,f,h),p=s.c,m=s.lc;break}}if(v==A.lit)throw"hufDecode issues"}}var E=8-u&7;for(p>>=E,m-=E;m>0;){var A=t[p<<14-m&16383];if(A.len)m-=A.len,o(A.lit,c,p,m,r,i,l,d,f,h),p=s.c,m=s.lc;else throw"hufDecode issues"}}(A,v,e,l,u,g,m,d,h,{value:0})}function f(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function p(e,t){for(var r=0,i=Math.floor((e.length+1)/2),n=0,a=e.length-1;!(n>a)&&(t[n++]=e[r++],!(n>a));)t[n++]=e[i++]}function m(e){for(var t=e.byteLength,r=[],i=0,n=new DataView(e);t>0;){var a=n.getInt8(i++);if(a<0){var s=-a;t-=s+1;for(var o=0;o<s;o++)r.push(n.getUint8(i++))}else{var s=a;t-=2;for(var l=n.getUint8(i++),o=0;o<s+1;o++)r.push(l)}}return r}function g(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function A(e){var t=new Uint8Array(m(e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size))),r=new Uint8Array(t.length);return f(t),p(t,r),new DataView(r.buffer)}function v(e){var t=TV(e.array.slice(e.offset.value,e.offset.value+e.size)),r=new Uint8Array(t.length);return f(t),p(t,r),new DataView(r.buffer)}function y(e){for(var t=e.viewer,r={value:e.offset.value},i=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),n=new Uint8Array(8192),a=0,s=Array(e.channels),o=0;o<e.channels;o++)s[o]={},s[o].start=a,s[o].end=s[o].start,s[o].nx=e.width,s[o].ny=e.lines,s[o].size=e.type,a+=s[o].nx*s[o].ny*s[o].size;var l=B(t,r),f=B(t,r);if(f>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(l<=f)for(var o=0;o<f-l+1;o++)n[o+l]=C(t,r);var p=new Uint16Array(65536),m=function(e,t){for(var r=0,i=0;i<65536;++i)(0==i||e[i>>3]&1<<(7&i))&&(t[r++]=i);for(var n=r-1;r<65536;)t[r++]=0;return n}(n,p),g=S(t,r);d(e.array,t,r,g,i,a);for(var o=0;o<e.channels;++o)for(var A=s[o],v=0;v<s[o].size;++v)!function(e,t,r,i,n,a,s){for(var o=s<16384,l=r>n?n:r,d=1;d<=l;)d<<=1;for(d>>=1,f=d,d>>=1;d>=1;){for(var f,p,m,g,A,v=0,y=0+a*(n-f),E=a*d,x=a*f,_=i*d,b=i*f;v<=y;v+=x){for(var S=v,w=v+i*(r-f);S<=w;S+=b){var C=S+_,T=S+E,I=T+_;o?(c(e[S+t],e[T+t]),p=u.a,g=u.b,c(e[C+t],e[I+t]),m=u.a,A=u.b,c(p,m),e[S+t]=u.a,e[C+t]=u.b,c(g,A)):(h(e[S+t],e[T+t]),p=u.a,g=u.b,h(e[C+t],e[I+t]),m=u.a,A=u.b,h(p,m),e[S+t]=u.a,e[C+t]=u.b,h(g,A)),e[T+t]=u.a,e[I+t]=u.b}if(r&d){var T=S+E;o?c(e[S+t],e[T+t]):h(e[S+t],e[T+t]),p=u.a,e[T+t]=u.b,e[S+t]=p}}if(n&d)for(var S=v,w=v+i*(r-f);S<=w;S+=b){var C=S+_;o?c(e[S+t],e[C+t]):h(e[S+t],e[C+t]),p=u.a,e[C+t]=u.b,e[S+t]=p}f=d,d>>=1}}(i,A.start+v,A.nx,A.size,A.ny,A.nx*A.size,m);!function(e,t,r){for(var i=0;i<r;++i)t[i]=e[t[i]]}(p,i,a);for(var y=0,E=new Uint8Array(i.buffer.byteLength),x=0;x<e.lines;x++)for(var _=0;_<e.channels;_++){var A=s[_],b=A.nx*A.size,w=new Uint8Array(i.buffer,2*A.end,2*b);E.set(w,y),y+=2*b,A.end+=b}return new DataView(E.buffer)}function E(e){var t=TV(e.array.slice(e.offset.value,e.offset.value+e.size));let r=e.lines*e.channels*e.width,i=1==e.type?new Uint16Array(r):new Uint32Array(r),n=0,a=0,s=[,,,,];for(let r=0;r<e.lines;r++)for(let r=0;r<e.channels;r++){let r=0;switch(e.type){case 1:s[0]=n,s[1]=s[0]+e.width,n=s[1]+e.width;for(let n=0;n<e.width;++n)r+=t[s[0]++]<<8|t[s[1]++],i[a]=r,a++;break;case 2:s[0]=n,s[1]=s[0]+e.width,s[2]=s[1]+e.width,n=s[2]+e.width;for(let n=0;n<e.width;++n)r+=t[s[0]++]<<24|t[s[1]++]<<16|t[s[2]++]<<8,i[a]=r,a++}}return new DataView(i.buffer)}function x(e){var t=e.viewer,r={value:e.offset.value},i=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),n={version:T(t,r),unknownUncompressedSize:T(t,r),unknownCompressedSize:T(t,r),acCompressedSize:T(t,r),dcCompressedSize:T(t,r),rleCompressedSize:T(t,r),rleUncompressedSize:T(t,r),rleRawSize:T(t,r),totalAcUncompressedCount:T(t,r),totalDcUncompressedCount:T(t,r),acCompression:T(t,r)};if(n.version<2)throw"EXRLoader.parse: "+F.compression+" version "+n.version+" is unsupported";for(var a=[],s=B(t,r)-2;s>0;){var o=_(t.buffer,r),l=C(t,r),u=l>>2&3,c=new Int8Array([(l>>4)-1])[0],h=C(t,r);a.push({name:o,index:c,type:h,compression:u}),s-=o.length+3}for(var f=F.channels,p=Array(e.channels),g=0;g<e.channels;++g){var A=p[g]={},y=f[g];A.name=y.name,A.compression=0,A.decoded=!1,A.type=y.pixelType,A.pLinear=y.pLinear,A.width=e.width,A.height=e.lines}for(var E={idx:[,,,]},x=0;x<e.channels;++x)for(var A=p[x],g=0;g<a.length;++g){var b=a[g];A.name==b.name&&(A.compression=b.compression,b.index>=0&&(E.idx[b.index]=x),A.offset=x)}if(n.acCompressedSize>0)switch(n.acCompression){case 0:var S=new Uint16Array(n.totalAcUncompressedCount);d(e.array,t,r,n.acCompressedSize,S,n.totalAcUncompressedCount);break;case 1:var w=e.array.slice(r.value,r.value+n.totalAcUncompressedCount),I=TV(w),S=new Uint16Array(I.buffer);r.value+=n.totalAcUncompressedCount}if(n.dcCompressedSize>0){var M=new Uint16Array(v({array:e.array,offset:r,size:n.dcCompressedSize}).buffer);r.value+=n.dcCompressedSize}if(n.rleRawSize>0){var w=e.array.slice(r.value,r.value+n.rleCompressedSize),I=TV(w),D=m(I.buffer);r.value+=n.rleCompressedSize}for(var P=0,L=Array(p.length),g=0;g<L.length;++g)L[g]=[];for(var k=0;k<e.lines;++k)for(var O=0;O<p.length;++O)L[O].push(P),P+=p[O].width*e.type*2;!function(e,t,r,i,n,a){var s=new DataView(a.buffer),o=r[e.idx[0]].width,l=r[e.idx[0]].height,u=Math.floor(o/8),c=Math.ceil(o/8),h=Math.ceil(l/8),d=o-(c-1)*8,f=l-(h-1)*8,p={value:0},m=[,,,],g=[,,,],A=[,,,],v=[,,,],y=[,,,];for(let r=0;r<3;++r)y[r]=t[e.idx[r]],m[r]=r<1?0:m[r-1]+c*h,g[r]=new Float32Array(64),A[r]=new Uint16Array(64),v[r]=new Uint16Array(64*c);for(let t=0;t<h;++t){var E,x,_=8;t==h-1&&(_=f);var b=8;for(let e=0;e<c;++e){e==c-1&&(b=d);for(let e=0;e<3;++e)A[e].fill(0),A[e][0]=n[m[e]++],function(e,t,r){for(var i,n=1;n<64;)65280==(i=t[e.value])?n=64:i>>8==255?n+=255&i:(r[n]=i,n++),e.value++}(p,i,A[e]),E=A[e],(x=g[e])[0]=R(E[0]),x[1]=R(E[1]),x[2]=R(E[5]),x[3]=R(E[6]),x[4]=R(E[14]),x[5]=R(E[15]),x[6]=R(E[27]),x[7]=R(E[28]),x[8]=R(E[2]),x[9]=R(E[4]),x[10]=R(E[7]),x[11]=R(E[13]),x[12]=R(E[16]),x[13]=R(E[26]),x[14]=R(E[29]),x[15]=R(E[42]),x[16]=R(E[3]),x[17]=R(E[8]),x[18]=R(E[12]),x[19]=R(E[17]),x[20]=R(E[25]),x[21]=R(E[30]),x[22]=R(E[41]),x[23]=R(E[43]),x[24]=R(E[9]),x[25]=R(E[11]),x[26]=R(E[18]),x[27]=R(E[24]),x[28]=R(E[31]),x[29]=R(E[40]),x[30]=R(E[44]),x[31]=R(E[53]),x[32]=R(E[10]),x[33]=R(E[19]),x[34]=R(E[23]),x[35]=R(E[32]),x[36]=R(E[39]),x[37]=R(E[45]),x[38]=R(E[52]),x[39]=R(E[54]),x[40]=R(E[20]),x[41]=R(E[22]),x[42]=R(E[33]),x[43]=R(E[38]),x[44]=R(E[46]),x[45]=R(E[51]),x[46]=R(E[55]),x[47]=R(E[60]),x[48]=R(E[21]),x[49]=R(E[34]),x[50]=R(E[37]),x[51]=R(E[47]),x[52]=R(E[50]),x[53]=R(E[56]),x[54]=R(E[59]),x[55]=R(E[61]),x[56]=R(E[35]),x[57]=R(E[36]),x[58]=R(E[48]),x[59]=R(E[49]),x[60]=R(E[57]),x[61]=R(E[58]),x[62]=R(E[62]),x[63]=R(E[63]),function(e){let t=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),i=.5*Math.cos(3*3.14159/16),n=.5*Math.cos(3*3.14159/8);for(var a=[,,,,],s=[,,,,],o=[,,,,],l=[,,,,],u=0;u<8;++u){var c=8*u;a[0]=r*e[c+2],a[1]=n*e[c+2],a[2]=r*e[c+6],a[3]=n*e[c+6],s[0]=t*e[c+1]+i*e[c+3]+.2777854612564676*e[c+5]+.09754573032714427*e[c+7],s[1]=i*e[c+1]-.09754573032714427*e[c+3]-t*e[c+5]-.2777854612564676*e[c+7],s[2]=.2777854612564676*e[c+1]-t*e[c+3]+.09754573032714427*e[c+5]+i*e[c+7],s[3]=.09754573032714427*e[c+1]-.2777854612564676*e[c+3]+i*e[c+5]-t*e[c+7],o[0]=.35355362513961314*(e[c+0]+e[c+4]),o[3]=.35355362513961314*(e[c+0]-e[c+4]),o[1]=a[0]+a[3],o[2]=a[1]-a[2],l[0]=o[0]+o[1],l[1]=o[3]+o[2],l[2]=o[3]-o[2],l[3]=o[0]-o[1],e[c+0]=l[0]+s[0],e[c+1]=l[1]+s[1],e[c+2]=l[2]+s[2],e[c+3]=l[3]+s[3],e[c+4]=l[3]-s[3],e[c+5]=l[2]-s[2],e[c+6]=l[1]-s[1],e[c+7]=l[0]-s[0]}for(var h=0;h<8;++h)a[0]=r*e[16+h],a[1]=n*e[16+h],a[2]=r*e[48+h],a[3]=n*e[48+h],s[0]=t*e[8+h]+i*e[24+h]+.2777854612564676*e[40+h]+.09754573032714427*e[56+h],s[1]=i*e[8+h]-.09754573032714427*e[24+h]-t*e[40+h]-.2777854612564676*e[56+h],s[2]=.2777854612564676*e[8+h]-t*e[24+h]+.09754573032714427*e[40+h]+i*e[56+h],s[3]=.09754573032714427*e[8+h]-.2777854612564676*e[24+h]+i*e[40+h]-t*e[56+h],o[0]=.35355362513961314*(e[h]+e[32+h]),o[3]=.35355362513961314*(e[h]-e[32+h]),o[1]=a[0]+a[3],o[2]=a[1]-a[2],l[0]=o[0]+o[1],l[1]=o[3]+o[2],l[2]=o[3]-o[2],l[3]=o[0]-o[1],e[0+h]=l[0]+s[0],e[8+h]=l[1]+s[1],e[16+h]=l[2]+s[2],e[24+h]=l[3]+s[3],e[32+h]=l[3]-s[3],e[40+h]=l[2]-s[2],e[48+h]=l[1]-s[1],e[56+h]=l[0]-s[0]}(g[e]);(function(e){for(var t=0;t<64;++t){var r=e[0][t],i=e[1][t],n=e[2][t];e[0][t]=r+1.5747*n,e[1][t]=r-.1873*i-.4682*n,e[2][t]=r+1.8556*i}})(g);for(let t=0;t<3;++t)(function(e,t,r){for(var i,n=0;n<64;++n)t[r+n]=a$.toHalfFloat((i=e[n])<=1?Math.sign(i)*Math.pow(Math.abs(i),2.2):Math.sign(i)*Math.pow(9.025013291561939,Math.abs(i)-1))})(g[t],v[t],64*e)}let a=0;for(let i=0;i<3;++i){let n=r[e.idx[i]].type;for(let e=8*t;e<8*t+_;++e){a=y[i][e];for(let t=0;t<u;++t){let r=64*t+(7&e)*8;s.setUint16(a+0*n,v[i][r+0],!0),s.setUint16(a+2*n,v[i][r+1],!0),s.setUint16(a+4*n,v[i][r+2],!0),s.setUint16(a+6*n,v[i][r+3],!0),s.setUint16(a+8*n,v[i][r+4],!0),s.setUint16(a+10*n,v[i][r+5],!0),s.setUint16(a+12*n,v[i][r+6],!0),s.setUint16(a+14*n,v[i][r+7],!0),a+=16*n}}if(u!=c)for(let e=8*t;e<8*t+_;++e){let t=y[i][e]+8*u*2*n,r=64*u+(7&e)*8;for(let e=0;e<b;++e)s.setUint16(t+2*e*n,v[i][r+e],!0)}}}for(var S=new Uint16Array(o),s=new DataView(a.buffer),w=0;w<3;++w){r[e.idx[w]].decoded=!0;var C=r[e.idx[w]].type;if(2==r[w].type)for(var T=0;T<l;++T){let e=y[w][T];for(var I=0;I<o;++I)S[I]=s.getUint16(e+2*I*C,!0);for(var I=0;I<o;++I)s.setFloat32(e+2*I*C,R(S[I]),!0)}}}(E,L,p,S,M,i);for(var g=0;g<p.length;++g){var A=p[g];if(!A.decoded){if(2===A.compression)for(var U=0,N=0,k=0;k<e.lines;++k){for(var z=L[g][U],G=0;G<A.width;++G){for(var H=0;H<2*A.type;++H)i[z++]=D[N+H*A.width*A.height];N++}U++}else throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(i.buffer)}function _(e,t){for(var r=new Uint8Array(e),i=0;0!=r[t.value+i];)i+=1;var n=new TextDecoder().decode(r.slice(t.value,t.value+i));return t.value=t.value+i+1,n}function b(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function S(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function w(e,t){var r=e[t.value];return t.value=t.value+1,r}function C(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}let T=function(e,t){let r;return"getBigInt64"in DataView.prototype?r=Number(e.getBigInt64(t.value,!0)):r=e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function I(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function M(e,t){return a$.toHalfFloat(I(e,t))}function R(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function B(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function D(e,t){return R(B(e,t))}let P=new DataView(e),L=new Uint8Array(e),k={value:0},F=function(e,t,r){let i={};if(0x1312f76!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";i.version=e.getUint8(4);let n=e.getUint8(5);i.spec={singleTile:!!(2&n),longName:!!(4&n),deepFormat:!!(8&n),multiPart:!!(16&n)},r.value=8;for(var a=!0;a;){var s=_(t,r);if(0==s)a=!1;else{var o=_(t,r),l=S(e,r),u=function(e,t,r,i,n){var a,s,o,l,u;if("string"===i||"stringvector"===i||"iccProfile"===i)return a=new TextDecoder().decode(new Uint8Array(t).slice(r.value,r.value+n)),r.value=r.value+n,a;if("chlist"===i)return function(e,t,r,i){for(var n=r.value,a=[];r.value<n+i-1;){var s=_(t,r),o=b(e,r),l=C(e,r);r.value+=3;var u=b(e,r),c=b(e,r);a.push({name:s,pixelType:o,pLinear:l,xSampling:u,ySampling:c})}return r.value+=1,a}(e,t,r,n);if("chromaticities"===i)return s=I(e,r),o=I(e,r),l=I(e,r),u=I(e,r),{redX:s,redY:o,greenX:l,greenY:u,blueX:I(e,r),blueY:I(e,r),whiteX:I(e,r),whiteY:I(e,r)};if("compression"===i)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][C(e,r)];if("box2i"===i)return{xMin:S(e,r),yMin:S(e,r),xMax:S(e,r),yMax:S(e,r)};if("lineOrder"===i)return["INCREASING_Y"][C(e,r)];if("float"===i)return I(e,r);else if("v2f"===i)return[I(e,r),I(e,r)];else if("v3f"===i)return[I(e,r),I(e,r),I(e,r)];else if("int"===i)return b(e,r);else if("rational"===i)return[b(e,r),S(e,r)];else if("timecode"===i)return[S(e,r),S(e,r)];else return"preview"===i?(r.value+=n,"skipped"):void(r.value+=n)}(e,t,r,o,l);void 0===u?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${o}'.`):i[s]=u}}if((-5&n)!=0)throw console.error("EXRHeader:",i),"THREE.EXRLoader: provided file is currently unsupported.";return i}(P,e,k),O=function(e,t,r,i,n){let a={size:0,viewer:t,array:r,offset:i,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[DK?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":a.lines=1,a.uncompress=g;break;case"RLE_COMPRESSION":a.lines=1,a.uncompress=A;break;case"ZIPS_COMPRESSION":a.lines=1,a.uncompress=v;break;case"ZIP_COMPRESSION":a.lines=16,a.uncompress=v;break;case"PIZ_COMPRESSION":a.lines=32,a.uncompress=y;break;case"PXR24_COMPRESSION":a.lines=16,a.uncompress=E;break;case"DWAA_COMPRESSION":a.lines=32,a.uncompress=x;break;case"DWAB_COMPRESSION":a.lines=256,a.uncompress=x;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(a.scanlineBlockSize=a.lines,1==a.type)switch(n){case re:a.getter=D,a.inputSize=2;break;case rt:a.getter=B,a.inputSize=2}else if(2==a.type)switch(n){case re:a.getter=I,a.inputSize=4;break;case rt:a.getter=M,a.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+a.type+" for "+e.compression+".";a.blockCount=(e.dataWindow.yMax+1)/a.scanlineBlockSize;for(var s=0;s<a.blockCount;s++)T(t,i);a.outputChannels=3==a.channels?4:a.channels;let o=a.width*a.height*a.outputChannels;switch(n){case re:a.byteArray=new Float32Array(o),a.channels<a.outputChannels&&a.byteArray.fill(1,0,o);break;case rt:a.byteArray=new Uint16Array(o),a.channels<a.outputChannels&&a.byteArray.fill(15360,0,o);break;default:console.error("THREE.EXRLoader: unsupported type: ",n)}return a.bytesPerLine=a.width*a.inputSize*a.channels,4==a.outputChannels?a.format=ru:a.format=rd,DK?a.colorSpace="srgb-linear":a.encoding=3e3,a}(F,P,L,k,this.type),U={value:0},N={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<O.height/O.scanlineBlockSize;e++){let t=S(P,k);O.size=S(P,k),O.lines=t+O.scanlineBlockSize>O.height?O.height-t:O.scanlineBlockSize;let r=O.size<O.lines*O.bytesPerLine?O.uncompress(O):g(O);k.value+=O.size;for(let t=0;t<O.scanlineBlockSize;t++){let i=t+e*O.scanlineBlockSize;if(i>=O.height)break;for(let e=0;e<O.channels;e++){let n=N[F.channels[e].name];for(let a=0;a<O.width;a++){U.value=(t*(O.channels*O.width)+e*O.width+a)*O.inputSize;let s=(O.height-1-i)*(O.width*O.outputChannels)+a*O.outputChannels+n;O.byteArray[s]=O.getter(r,U)}}}}return{header:F,width:O.width,height:O.height,data:O.byteArray,format:O.format,[DK?"colorSpace":"encoding"]:O[DK?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,function(e,r){DK?e.colorSpace=r.colorSpace:e.encoding=r.encoding,e.minFilter=tZ,e.magFilter=tZ,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)},r,i)}}let DX=(e,t,r)=>{let i;switch(e){case t4:i=new Uint8ClampedArray(t*r*4);break;case rt:i=new Uint16Array(t*r*4);break;case t7:i=new Uint32Array(t*r*4);break;case t5:i=new Int8Array(t*r*4);break;case t6:i=new Int16Array(t*r*4);break;case t9:i=new Int32Array(t*r*4);break;case re:i=new Float32Array(t*r*4);break;default:throw Error("Unsupported data type")}return i},D$=(e,t,r,i)=>{if(void 0!==J)return J;let n=new nM(1,1,i);t.setRenderTarget(n);let a=new sE(new uf,new aY({color:0xffffff}));t.render(a,r),t.setRenderTarget(null);let s=DX(e,n.width,n.height);return t.readRenderTargetPixels(n,0,0,n.width,n.height,s),n.dispose(),a.geometry.dispose(),a.material.dispose(),J=0!==s[0]};class DJ{constructor(e){var t,r,i,n,a,s,o,l,u,c,h,d,f,p,m,g;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;let A={format:ru,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:(null===(t=e.renderTargetOptions)||void 0===t?void 0:t.anisotropy)!==void 0?null===(r=e.renderTargetOptions)||void 0===r?void 0:r.anisotropy:1,generateMipmaps:(null===(i=e.renderTargetOptions)||void 0===i?void 0:i.generateMipmaps)!==void 0&&(null===(n=e.renderTargetOptions)||void 0===n?void 0:n.generateMipmaps),magFilter:(null===(a=e.renderTargetOptions)||void 0===a?void 0:a.magFilter)!==void 0?null===(s=e.renderTargetOptions)||void 0===s?void 0:s.magFilter:tZ,minFilter:(null===(o=e.renderTargetOptions)||void 0===o?void 0:o.minFilter)!==void 0?null===(l=e.renderTargetOptions)||void 0===l?void 0:l.minFilter:tZ,samples:(null===(u=e.renderTargetOptions)||void 0===u?void 0:u.samples)!==void 0?null===(c=e.renderTargetOptions)||void 0===c?void 0:c.samples:void 0,wrapS:(null===(h=e.renderTargetOptions)||void 0===h?void 0:h.wrapS)!==void 0?null===(d=e.renderTargetOptions)||void 0===d?void 0:d.wrapS:tj,wrapT:(null===(f=e.renderTargetOptions)||void 0===f?void 0:f.wrapT)!==void 0?null===(p=e.renderTargetOptions)||void 0===p?void 0:p.wrapT:tj};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=DJ.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new sG,this._camera=new cv,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!D$(this._type,this._renderer,this._camera,A)){let e;this._type===rt&&(e=this._renderer.extensions.has("EXT_color_buffer_float")?re:void 0),void 0!==e?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${re}`),this._type=e):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new sE(new uf,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new nM(this.width,this.height,A),this._renderTarget.texture.mapping=(null===(m=e.renderTargetOptions)||void 0===m?void 0:m.mapping)!==void 0?null===(g=e.renderTargetOptions)||void 0===g?void 0:g.mapping:tN}static instantiateRenderer(){let e=new Eu;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw Error("Can't read pixels in this browser");let e=DX(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){let t=new oc(this.toArray(),this.width,this.height,ru,this._type,(null==e?void 0:e.mapping)||tN,(null==e?void 0:e.wrapS)||tj,(null==e?void 0:e.wrapT)||tj,(null==e?void 0:e.magFilter)||tZ,(null==e?void 0:e.minFilter)||tZ,(null==e?void 0:e.anisotropy)||1,iu);return t.generateMipmaps=(null==e?void 0:e.generateMipmaps)!==void 0&&(null==e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof sT&&Object.values(this.material.uniforms).forEach(e=>{e.value instanceof nC&&e.value.dispose()}),Object.values(this.material).forEach(e=>{e instanceof nC&&e.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}let DZ=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,D0=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class D1 extends sT{constructor({gamma:e,offsetHdr:t,offsetSdr:r,gainMapMin:i,gainMapMax:n,maxDisplayBoost:a,hdrCapacityMin:s,hdrCapacityMax:o,sdr:l,gainMap:u}){super({name:"GainMapDecoderMaterial",vertexShader:DZ,fragmentShader:D0,uniforms:{sdr:{value:l},gainMap:{value:u},gamma:{value:new ni(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new ni().fromArray(t)},offsetSdr:{value:new ni().fromArray(r)},gainMapMin:{value:new ni().fromArray(i)},gainMapMax:{value:new ni().fromArray(n)},weightFactor:{value:(Math.log2(a)-s)/(o-s)}},blending:e2,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=s,this._hdrCapacityMax=o,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){let e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){let t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){let e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class D2 extends Error{}class D3 extends Error{}let D4=(e,t,r)=>{let i=RegExp(`${t}="([^"]*)"`,"i").exec(e);if(i)return i[1];let n=RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(n){let e=n[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map(e=>e.replace(/<\/?rdf:li>/g,"")):n[1].trim()}if(void 0!==r)return r;throw Error(`Can't find ${t} in gainmap metadata`)},D5=e=>{let t;"undefined"!=typeof TextDecoder?t=new TextDecoder().decode(e):t=e.toString();let r=t.indexOf("<x:xmpmeta");for(;-1!==r;){let e=t.indexOf("x:xmpmeta>",r),i=t.slice(r,e+10);try{let e=D4(i,"hdrgm:GainMapMin","0"),t=D4(i,"hdrgm:GainMapMax"),r=D4(i,"hdrgm:Gamma","1"),n=D4(i,"hdrgm:OffsetSDR","0.015625"),a=D4(i,"hdrgm:OffsetHDR","0.015625"),s=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(i),o=s?s[1]:"0",l=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(i);if(!l)throw Error("Incomplete gainmap metadata");let u=l[1];return{gainMapMin:Array.isArray(e)?e.map(e=>parseFloat(e)):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map(e=>parseFloat(e)):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(r)?r.map(e=>parseFloat(e)):[parseFloat(r),parseFloat(r),parseFloat(r)],offsetSdr:Array.isArray(n)?n.map(e=>parseFloat(e)):[parseFloat(n),parseFloat(n),parseFloat(n)],offsetHdr:Array.isArray(a)?a.map(e=>parseFloat(e)):[parseFloat(a),parseFloat(a),parseFloat(a)],hdrCapacityMin:parseFloat(o),hdrCapacityMax:parseFloat(u)}}catch(e){}r=t.indexOf("<x:xmpmeta",e)}};class D6{constructor(e){this.options={debug:!!e&&void 0!==e.debug&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise((t,r)=>{let i;let n=this.options.debug,a=new DataView(e.buffer);if(65496!==a.getUint16(0)){r(Error("Not a valid jpeg"));return}let s=a.byteLength,o=2,l=0;for(;o<s;){if(++l>250){r(Error(`Found no marker after ${l} loops 😵`));return}if(255!==a.getUint8(o)){r(Error(`Not a valid marker at offset 0x${o.toString(16)}, found: 0x${a.getUint8(o).toString(16)}`));return}if(i=a.getUint8(o+1),n&&console.log(`Marker: ${i.toString(16)}`),226===i){n&&console.log("Found APP2 marker (0xffe2)");let e=o+4;if(0x4d504600===a.getUint32(e)){let i;let n=e+4;if(18761===a.getUint16(n))i=!1;else if(19789===a.getUint16(n))i=!0;else{r(Error("No valid endianness marker found in TIFF header"));return}if(42!==a.getUint16(n+2,!i)){r(Error("Not valid TIFF data! (no 0x002A marker)"));return}let s=a.getUint32(n+4,!i);if(s<8){r(Error("Not valid TIFF data! (First offset less than 8)"));return}let o=n+s,l=a.getUint16(o,!i),u=o+2,c=0;for(let e=u;e<u+12*l;e+=12)45057===a.getUint16(e,!i)&&(c=a.getUint32(e+8,!i));let h=o+2+12*l+4,d=[];for(let e=h;e<h+16*c;e+=16){let t={MPType:a.getUint32(e,!i),size:a.getUint32(e+4,!i),dataOffset:a.getUint32(e+8,!i),dependantImages:a.getUint32(e+12,!i),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=n+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,d.push(t)}if(this.options.extractNonFII&&d.length){let e=new Blob([a]),r=[];for(let t of d){if(t.isFII&&!this.options.extractFII)continue;let i=e.slice(t.start,t.end+1,"image/jpeg");r.push(i)}t(r)}}}o+=2+a.getUint16(o+2)}})}}let D8=async e=>{let t=D5(e);if(!t)throw new D3("Gain map XMP metadata not found");let r=new D6({extractFII:!0,extractNonFII:!0}),i=await r.extract(e);if(2!==i.length)throw new D2("Gain map recovery image not found");return{sdr:new Uint8Array(await i[0].arrayBuffer()),gainMap:new Uint8Array(await i[1].arrayBuffer()),metadata:t}},D9=e=>new Promise((t,r)=>{let i=document.createElement("img");i.onload=()=>{t(i)},i.onerror=e=>{r(e)},i.src=URL.createObjectURL(e)});class D7 extends u4{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new u2}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){return this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer."),new DJ({width:16,height:16,type:rt,colorSpace:iu,material:new D1({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new nC,sdr:new nC}),renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,r,i){let n,a;let s=i?new Blob([i],{type:"image/jpeg"}):void 0,o=new Blob([r],{type:"image/jpeg"}),l=!1;if("undefined"==typeof createImageBitmap){let e=await Promise.all([s?D9(s):Promise.resolve(void 0),D9(o)]);a=e[0],n=e[1],l=!0}else{let e=await Promise.all([s?createImageBitmap(s,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(o,{imageOrientation:"flipY"})]);a=e[0],n=e[1]}let u=new nC(a||new ImageData(2,2),tN,tj,tj,tZ,t3,ru,t4,1,iu);u.flipY=l,u.needsUpdate=!0;let c=new nC(n,tN,tj,tj,tZ,t3,ru,t4,1,il);c.flipY=l,c.needsUpdate=!0,e.width=n.width,e.height=n.height,e.material.gainMap=u,e.material.sdr=c,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class Pe extends D7{load([e,t,r],i,n,a){let s,o,l;let u=this.prepareQuadRenderer(),c=async()=>{if(s&&o&&l){try{await this.render(u,l,s,o)}catch(i){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(r),"function"==typeof a&&a(i),u.disposeOnDemandRenderer();return}"function"==typeof i&&i(u),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(r),u.disposeOnDemandRenderer()}},h=!0,d=0,f=0,p=!0,m=0,g=0,A=!0,v=0,y=0,E=()=>{"function"==typeof n&&n(new ProgressEvent("progress",{lengthComputable:h&&p&&A,loaded:f+g+y,total:d+m+v}))};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(r);let x=new u8(this._internalLoadingManager);x.setResponseType("arraybuffer"),x.setRequestHeader(this.requestHeader),x.setPath(this.path),x.setWithCredentials(this.withCredentials),x.load(e,async e=>{if("string"==typeof e)throw Error("Invalid sdr buffer");s=e,await c()},e=>{h=e.lengthComputable,f=e.loaded,d=e.total,E()},t=>{this.manager.itemError(e),"function"==typeof a&&a(t)});let _=new u8(this._internalLoadingManager);_.setResponseType("arraybuffer"),_.setRequestHeader(this.requestHeader),_.setPath(this.path),_.setWithCredentials(this.withCredentials),_.load(t,async e=>{if("string"==typeof e)throw Error("Invalid gainmap buffer");o=e,await c()},e=>{p=e.lengthComputable,g=e.loaded,m=e.total,E()},e=>{this.manager.itemError(t),"function"==typeof a&&a(e)});let b=new u8(this._internalLoadingManager);return b.setRequestHeader(this.requestHeader),b.setPath(this.path),b.setWithCredentials(this.withCredentials),b.load(r,async e=>{if("string"!=typeof e)throw Error("Invalid metadata string");l=JSON.parse(e),await c()},e=>{A=e.lengthComputable,y=e.loaded,v=e.total,E()},e=>{this.manager.itemError(r),"function"==typeof a&&a(e)}),u}}class Pt extends D7{load(e,t,r,i){let n=this.prepareQuadRenderer(),a=new u8(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(e),a.load(e,async r=>{let a,s,o;if("string"==typeof r)throw Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");let l=new Uint8Array(r);try{let e=await D8(l);a=e.sdr,s=e.gainMap,o=e.metadata}catch(t){if(t instanceof D3||t instanceof D2)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),o={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},a=l;else throw t}try{await this.render(n,o,a,s)}catch(t){this.manager.itemError(e),"function"==typeof i&&i(t),n.disposeOnDemandRenderer();return}"function"==typeof t&&t(n),this.manager.itemEnd(e),n.disposeOnDemandRenderer()},r,t=>{this.manager.itemError(e),"function"==typeof i&&i(t)}),n}}let Pr={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Pi="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Pn=e=>Array.isArray(e),Pa=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Ps({files:e=Pa,path:t="",preset:r,encoding:i,extensions:n}={}){let a=null,s=!1;r&&(Pu(r),e=Pr[r],t=Pi),s=Pn(e);let{extension:o,isCubemap:l}=Pc(e);if(!(a=Ph(o)))throw Error("useEnvironment: Unrecognized file extension: "+e);let u=dY(e=>e.gl);(0,eN.useLayoutEffect)(()=>{("webp"===o||"jpg"===o||"jpeg"===o)&&u.domElement.addEventListener("webglcontextlost",function(){d$.clear(a,s?[e]:e)},{once:!0})},[e,u.domElement]);let c=d$(a,s?[e]:e,e=>{("webp"===o||"jpg"===o||"jpeg"===o)&&e.setRenderer(u),null==e.setPath||e.setPath(t),n&&n(e)}),h=s?c[0]:c;if("jpg"===o||"jpeg"===o||"webp"===o){var d;h=null==(d=h.renderTarget)?void 0:d.texture}return h.mapping=l?tz:tH,"colorSpace"in h?h.colorSpace=(null!=i?i:l)?"srgb":"srgb-linear":h.encoding=(null!=i?i:l)?3001:3e3,h}let Po={files:Pa,path:"",preset:void 0,extensions:void 0};Ps.preload=e=>{let t={...Po,...e},{files:r,path:i=""}=t,{preset:n,extensions:a}=t;n&&(Pu(n),r=Pr[n],i=Pi);let{extension:s}=Pc(r);if("webp"===s||"jpg"===s||"jpeg"===s)throw Error("useEnvironment: Preloading gainmaps is not supported");let o=Ph(s);if(!o)throw Error("useEnvironment: Unrecognized file extension: "+r);d$.preload(o,Pn(r)?[r]:r,e=>{null==e.setPath||e.setPath(i),a&&a(e)})};let Pl={files:Pa,preset:void 0};function Pu(e){if(!(e in Pr))throw Error("Preset must be one of: "+Object.keys(Pr).join(", "))}function Pc(e){var t;let r=Pn(e)&&6===e.length,i=Pn(e)&&3===e.length&&e.some(e=>e.endsWith("json")),n=Pn(e)?e[0]:e;return{extension:r?"cube":i?"webp":n.startsWith("data:application/exr")?"exr":n.startsWith("data:application/hdr")?"hdr":n.startsWith("data:image/jpeg")?"jpg":null==(t=n.split(".").pop())||null==(t=t.split("?"))||null==(t=t.shift())?void 0:t.toLowerCase(),isCubemap:r,isGainmap:i}}function Ph(e){return"cube"===e?cr:"hdr"===e?DY:"exr"===e?Dq:"jpg"===e||"jpeg"===e?Pt:"webp"===e?Pe:null}Ps.clear=e=>{let t={...Pl,...e},{files:r}=t,{preset:i}=t;i&&(Pu(i),r=Pr[i]);let{extension:n}=Pc(r),a=Ph(n);if(!a)throw Error("useEnvironment: Unrecognized file extension: "+r);d$.clear(a,Pn(r)?[r]:r)};let Pd=e=>e.current&&e.current.isScene,Pf=e=>Pd(e)?e.current:e;function Pp(e,t,r,i,n={}){var a,s,o,l;n={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...n};let u=Pf(t||r),c=u.background,h=u.environment,d={backgroundBlurriness:u.backgroundBlurriness,backgroundIntensity:u.backgroundIntensity,backgroundRotation:null!==(a=null==(s=u.backgroundRotation)||null==s.clone?void 0:s.clone())&&void 0!==a?a:[0,0,0],environmentIntensity:u.environmentIntensity,environmentRotation:null!==(o=null==(l=u.environmentRotation)||null==l.clone?void 0:l.clone())&&void 0!==o?o:[0,0,0]};return"only"!==e&&(u.environment=i),e&&(u.background=i),d1(u,n),()=>{"only"!==e&&(u.environment=h),e&&(u.background=c),d1(u,d)}}function Pm({scene:e,background:t=!1,map:r,...i}){let n=dY(e=>e.scene);return eN.useLayoutEffect(()=>{if(r)return Pp(t,e,n,r,i)}),null}function Pg({background:e=!1,scene:t,blur:r,backgroundBlurriness:i,backgroundIntensity:n,backgroundRotation:a,environmentIntensity:s,environmentRotation:o,...l}){let u=Ps(l),c=dY(e=>e.scene);return eN.useLayoutEffect(()=>Pp(e,t,c,u,{backgroundBlurriness:null!=r?r:i,backgroundIntensity:n,backgroundRotation:a,environmentIntensity:s,environmentRotation:o})),eN.useEffect(()=>()=>{u.dispose()},[u]),null}function PA({children:e,near:t=.1,far:r=1e3,resolution:i=256,frames:n=1,map:a,background:s=!1,blur:o,backgroundBlurriness:l,backgroundIntensity:u,backgroundRotation:c,environmentIntensity:h,environmentRotation:d,scene:f,files:p,path:m,preset:g,extensions:A}){let v=dY(e=>e.gl),y=dY(e=>e.scene),E=eN.useRef(null),[x]=eN.useState(()=>new sG),_=eN.useMemo(()=>{let e=new sk(i);return e.texture.type=rt,e},[i]);eN.useEffect(()=>()=>{_.dispose()},[_]),eN.useLayoutEffect(()=>{if(1===n){let e=v.autoClear;v.autoClear=!0,E.current.update(v,x),v.autoClear=e}return Pp(s,f,y,_.texture,{backgroundBlurriness:null!=o?o:l,backgroundIntensity:u,backgroundRotation:c,environmentIntensity:h,environmentRotation:d})},[e,x,_.texture,f,y,s,n,v]);let b=1;return dK(()=>{if(n===1/0||b<n){let e=v.autoClear;v.autoClear=!0,E.current.update(v,x),v.autoClear=e,b++}}),eN.createElement(eN.Fragment,null,d2(eN.createElement(eN.Fragment,null,e,eN.createElement("cubeCamera",{ref:E,args:[t,r,_]}),p||g?eN.createElement(Pg,{background:!0,files:p,preset:g,path:m,extensions:A}):a?eN.createElement(Pm,{background:!0,map:a,extensions:A}):null),x))}function Pv(e){var t,r,i,n;let a=Ps(e),s=e.map||a;eN.useMemo(()=>dp({GroundProjectedEnvImpl:Dj}),[]),eN.useEffect(()=>()=>{a.dispose()},[a]);let o=eN.useMemo(()=>[s],[s]),l=null==(t=e.ground)?void 0:t.height,u=null==(r=e.ground)?void 0:r.radius,c=null!==(i=null==(n=e.ground)?void 0:n.scale)&&void 0!==i?i:1e3;return eN.createElement(eN.Fragment,null,eN.createElement(Pm,eU({},e,{map:s})),eN.createElement("groundProjectedEnvImpl",{args:o,scale:c,height:l,radius:u}))}function Py(e){return e.ground?eN.createElement(Pv,e):e.map?eN.createElement(Pm,e):e.children?eN.createElement(PA,e):eN.createElement(Pg,e)}let PE={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},Px={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `},P_=eN.forwardRef(({scale:e=10,frames:t=1/0,opacity:r=1,width:i=1,height:n=1,blur:a=1,near:s=0,far:o=10,resolution:l=512,smooth:u=!0,color:c="#000000",depthWrite:h=!1,renderOrder:d,...f},p)=>{let m,g;let A=eN.useRef(null),v=dY(e=>e.scene),y=dY(e=>e.gl),E=eN.useRef(null);i*=Array.isArray(e)?e[0]:e||1,n*=Array.isArray(e)?e[1]:e||1;let[x,_,b,S,w,C,T]=eN.useMemo(()=>{let e=new nM(l,l),t=new nM(l,l);t.texture.generateMipmaps=e.texture.generateMipmaps=!1;let r=new uf(i,n).rotateX(Math.PI/2),a=new sE(r),s=new uD;s.depthTest=s.depthWrite=!1,s.onBeforeCompile=e=>{e.uniforms={...e.uniforms,ucolor:{value:new aQ(c)}},e.fragmentShader=e.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),e.fragmentShader=e.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};let o=new sT(PE),u=new sT(Px);return u.depthTest=o.depthTest=!1,[e,r,s,a,o,u,t]},[l,i,n,e,c]),I=e=>{S.visible=!0,S.material=w,w.uniforms.tDiffuse.value=x.texture,w.uniforms.h.value=1*e/256,y.setRenderTarget(T),y.render(S,E.current),S.material=C,C.uniforms.tDiffuse.value=T.texture,C.uniforms.v.value=1*e/256,y.setRenderTarget(x),y.render(S,E.current),S.visible=!1},M=0;return dK(()=>{E.current&&(t===1/0||M<t)&&(M++,m=v.background,g=v.overrideMaterial,A.current.visible=!1,v.background=null,v.overrideMaterial=b,y.setRenderTarget(x),y.render(v,E.current),I(a),u&&I(.4*a),y.setRenderTarget(null),A.current.visible=!0,v.overrideMaterial=g,v.background=m)}),eN.useImperativeHandle(p,()=>A.current,[]),eN.createElement("group",eU({"rotation-x":Math.PI/2},f,{ref:A}),eN.createElement("mesh",{renderOrder:d,geometry:_,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},eN.createElement("meshBasicMaterial",{transparent:!0,map:x.texture,opacity:r,depthWrite:h})),eN.createElement("orthographicCamera",{ref:E,args:[-i/2,i/2,n/2,-n/2,s,o]}))}),Pb=eN.createContext(null),PS=be({color:new aQ,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),Pw=eN.forwardRef(({children:e,temporal:t,frames:r=40,limit:i=1/0,blend:n=20,scale:a=10,opacity:s=1,alphaTest:o=.75,color:l="black",colorBlend:u=2,resolution:c=1024,toneMapped:h=!0,...d},f)=>{dp({SoftShadowMaterial:PS});let p=dY(e=>e.gl),m=dY(e=>e.scene),g=dY(e=>e.camera),A=dY(e=>e.invalidate),v=eN.useRef(null),y=eN.useRef(null),[E]=eN.useState(()=>new PT(p,m,c));eN.useLayoutEffect(()=>{E.configure(v.current)},[]);let x=eN.useMemo(()=>({lights:new Map,temporal:!!t,frames:Math.max(2,r),blend:Math.max(2,r===1/0?n:r),count:0,getMesh:()=>v.current,reset:()=>{E.clear();let e=v.current.material;e.opacity=0,e.alphaTest=0,x.count=0},update:(e=1)=>{let t=v.current.material;x.temporal?(t.opacity=Math.min(s,t.opacity+s/x.blend),t.alphaTest=Math.min(o,t.alphaTest+o/x.blend)):(t.opacity=s,t.alphaTest=o),y.current.visible=!0,E.prepare();for(let t=0;t<e;t++)x.lights.forEach(e=>e.update()),E.update(g,x.blend);y.current.visible=!1,E.finish()}}),[E,g,m,t,r,n,s,o]);return eN.useLayoutEffect(()=>{x.reset(),x.temporal||x.frames===1/0||x.update(x.blend)}),eN.useImperativeHandle(f,()=>x,[x]),dK(()=>{(x.temporal||x.frames===1/0)&&x.count<x.frames&&x.count<i&&(A(),x.update(),x.count++)}),eN.createElement("group",d,eN.createElement("group",{traverse:()=>null,ref:y},eN.createElement(Pb.Provider,{value:x},e)),eN.createElement("mesh",{receiveShadow:!0,ref:v,scale:a,rotation:[-Math.PI/2,0,0]},eN.createElement("planeGeometry",null),eN.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:h,color:l,blend:u,map:E.progressiveLightMap2.texture})))}),PC=eN.forwardRef(({castShadow:e=!0,bias:t=.001,mapSize:r=512,size:i=5,near:n=.5,far:a=500,frames:s=1,position:o=[0,0,0],radius:l=1,amount:u=8,intensity:c=bn>=155?Math.PI:1,ambient:h=.5,...d},f)=>{let p=eN.useRef(null),m=new ni(...o).length(),g=eN.useContext(Pb),A=eN.useCallback(()=>{let e;if(p.current)for(let t=0;t<p.current.children.length;t++)if(e=p.current.children[t],Math.random()>h)e.position.set(o[0]+ne.randFloatSpread(l),o[1]+ne.randFloatSpread(l),o[2]+ne.randFloatSpread(l));else{let t=Math.acos(2*Math.random()-1)-Math.PI/2,r=2*Math.PI*Math.random();e.position.set(Math.cos(t)*Math.cos(r)*m,Math.abs(Math.cos(t)*Math.sin(r)*m),Math.sin(t)*m)}},[l,h,m,...o]),v=eN.useMemo(()=>({update:A}),[A]);return eN.useImperativeHandle(f,()=>v,[v]),eN.useLayoutEffect(()=>{var e;let t=p.current;return g&&(null==(e=g.lights)||e.set(t.uuid,v)),()=>{var e;null==g||null==(e=g.lights)||e.delete(t.uuid)}},[g,v]),eN.createElement("group",eU({ref:p},d),Array.from({length:u},(s,o)=>eN.createElement("directionalLight",{key:o,castShadow:e,"shadow-bias":t,"shadow-mapSize":[r,r],intensity:c/u},eN.createElement("orthographicCamera",{attach:"shadow-camera",args:[-i,i,i,-i,n,a]}))))});class PT{constructor(e,t,r=1024){this.renderer=e,this.res=r,this.scene=t,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new aQ,this.clearAlpha=0;let i={type:rt,magFilter:tK,minFilter:tK};this.progressiveLightMap1=new nM(this.res,this.res,i),this.progressiveLightMap2=new nM(this.res,this.res,i),this.discardMat=new B8,this.targetMat=new uB({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=e=>{e.vertexShader="varying vec2 vUv;\n"+e.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";let t=e.fragmentShader.indexOf("void main() {");e.fragmentShader="varying vec2 vUv;\n"+e.fragmentShader.slice(0,t)+"uniform sampler2D previousShadowMap;\n	uniform float averagingWindow;\n"+e.fragmentShader.slice(t-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,e.uniforms.previousShadowMap=this.previousShadowMap,e.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{e.geometry?this.meshes.push({object:e,material:e.material}):e.isLight&&this.lights.push({object:e,intensity:e.intensity})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,t=100){if(!this.object)return;this.averagingWindow.value=t,this.object.material=this.targetMat;let r=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,i=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,n=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(r),this.previousShadowMap.value=i.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=n}}let PI={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function PM({radius:e,adjustCamera:t}){let r=DU();return eN.useEffect(()=>{t&&r.refresh().clip().fit()},[e,t]),null}function PR({children:e,center:t,adjustCamera:r=!0,intensity:i=.5,shadows:n="contact",environment:a="city",preset:s="rembrandt",...o}){var l,u,c,h,d,f,p,m;let g="string"==typeof s?PI[s]:s,[{radius:A,height:v},y]=eN.useState({radius:0,width:0,height:0,depth:0}),E=null!==(l=null==n?void 0:n.bias)&&void 0!==l?l:-1e-4,x=null!==(u=null==n?void 0:n.normalBias)&&void 0!==u?u:0,_=null!==(c=null==n?void 0:n.size)&&void 0!==c?c:1024,b=null!==(h=null==n?void 0:n.offset)&&void 0!==h?h:0,S="contact"===n||(null==n?void 0:n.type)==="contact",w="accumulative"===n||(null==n?void 0:n.type)==="accumulative",C={..."object"==typeof n?n:{}},T=a?"string"==typeof a?{preset:a}:a:null,I=eN.useCallback(e=>{let{width:r,height:i,depth:n,boundingSphere:a}=e;y({radius:a.radius,width:r,height:i,depth:n}),null!=t&&t.onCentered&&t.onCentered(e)},[]);return eN.createElement(eN.Fragment,null,eN.createElement("ambientLight",{intensity:i/3}),eN.createElement("spotLight",{penumbra:1,position:[g.main[0]*A,g.main[1]*A,g.main[2]*A],intensity:2*i,castShadow:!!n,"shadow-bias":E,"shadow-normalBias":x,"shadow-mapSize":_}),eN.createElement("pointLight",{position:[g.fill[0]*A,g.fill[1]*A,g.fill[2]*A],intensity:i}),eN.createElement(DO,eU({fit:!!r,clip:!!r,margin:Number(r),observe:!0},o),eN.createElement(PM,{radius:A,adjustCamera:r}),eN.createElement(Bn,eU({},t,{position:[0,b/2,0],onCentered:I}),e)),eN.createElement("group",{position:[0,-v/2-b/2,0]},S&&eN.createElement(P_,eU({scale:4*A,far:A,blur:2},C)),w&&eN.createElement(Pw,eU({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:4*A},C),eN.createElement(PC,{amount:null!==(d=C.amount)&&void 0!==d?d:8,radius:null!==(f=C.radius)&&void 0!==f?f:A,ambient:null!==(p=C.ambient)&&void 0!==p?p:.5,intensity:null!==(m=C.intensity)&&void 0!==m?m:1,position:[g.main[0]*A,g.main[1]*A,g.main[2]*A],size:4*A,bias:-E,mapSize:_}))),a&&eN.createElement(Py,T))}let PB=e=>0===e?0:Math.pow(2,10*e-10);function PD({children:e,floor:t=.25,segments:r=20,receiveShadow:i,...n}){let a=eN.useRef(null);return eN.useLayoutEffect(()=>{let e=0,i=r/r/2,n=a.current.attributes.position;for(let a=0;a<r+1;a++)for(let s=0;s<r+1;s++)n.setXYZ(e++,a/r-i+(0===a?-t:0),s/r-i,PB(a/r));n.needsUpdate=!0,a.current.computeVertexNormals()},[r,t]),eN.createElement("group",n,eN.createElement("mesh",{receiveShadow:i,rotation:[-Math.PI/2,0,Math.PI/2]},eN.createElement("planeGeometry",{ref:a,args:[1,1,r,r]}),e))}let PP=eN.forwardRef(({fog:e=!1,renderOrder:t,depthWrite:r=!1,colorStop:i=0,color:n="black",opacity:a=.5,...s},o)=>{let l=eN.useMemo(()=>{let e=document.createElement("canvas");e.width=128,e.height=128;let t=e.getContext("2d"),r=t.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);return r.addColorStop(i,new aQ(n).getStyle()),r.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=r,t.fillRect(0,0,e.width,e.height),e},[n,i]);return eN.createElement("mesh",eU({renderOrder:t,ref:o,"rotation-x":-Math.PI/2},s),eN.createElement("planeGeometry",null),eN.createElement("meshBasicMaterial",{transparent:!0,opacity:a,fog:e,depthWrite:r,side:e1},eN.createElement("canvasTexture",{attach:"map",args:[l]})))});function PL(e=eZ){let t={value:new n8};return Object.assign(new uR({side:e}),{viewMatrix:t,onBeforeCompile:e=>{e.uniforms.viewMatrix=t,e.fragmentShader=`vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
           return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
         }
`+e.fragmentShader.replace("#include <normal_fragment_maps>",`#include <normal_fragment_maps>
           normal = inverseTransformDirection( normal, viewMatrix );
`)}})}let Pk=be({causticsTexture:null,causticsTextureB:null,color:new aQ,lightProjMatrix:new n8,lightViewMatrix:new n8},`varying vec3 vWorldPosition;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vec4 worldPosition = modelMatrix * vec4(position, 1.);
     vWorldPosition = worldPosition.xyz;
   }`,`varying vec3 vWorldPosition;
  uniform vec3 color;
  uniform sampler2D causticsTexture;
  uniform sampler2D causticsTextureB;
  uniform mat4 lightProjMatrix;
  uniform mat4 lightViewMatrix;
   void main() {
    // Apply caustics
    vec4 lightSpacePos = lightProjMatrix * lightViewMatrix * vec4(vWorldPosition, 1.0);
    lightSpacePos.xyz /= lightSpacePos.w;
    lightSpacePos.xyz = lightSpacePos.xyz * 0.5 + 0.5;
    vec3 front = texture2D(causticsTexture, lightSpacePos.xy).rgb;
    vec3 back = texture2D(causticsTextureB, lightSpacePos.xy).rgb;
    gl_FragColor = vec4((front + back) * color, 1.0);
    #include <tonemapping_fragment>
    #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),PF=be({cameraMatrixWorld:new n8,cameraProjectionMatrixInv:new n8,normalTexture:null,depthTexture:null,lightDir:new ni(0,1,0),lightPlaneNormal:new ni(0,1,0),lightPlaneConstant:0,near:.1,far:100,modelMatrix:new n8,worldRadius:1/40,ior:1.1,bounces:0,resolution:1024,size:10,intensity:.5},`
  varying vec2 vUv;
  void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,`
  uniform mat4 cameraMatrixWorld;
  uniform mat4 cameraProjectionMatrixInv;
  uniform vec3 lightDir;
  uniform vec3 lightPlaneNormal;
  uniform float lightPlaneConstant;
  uniform float near;
  uniform float far;
  uniform float time;
  uniform float worldRadius;
  uniform float resolution;
  uniform float size;
  uniform float intensity;
  uniform float ior;
  precision highp isampler2D;
  precision highp usampler2D;
  uniform sampler2D normalTexture;
  uniform sampler2D depthTexture;
  uniform float bounces;
  varying vec2 vUv;
  vec3 WorldPosFromDepth(float depth, vec2 coord) {
    float z = depth * 2.0 - 1.0;
    vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
    vec4 viewSpacePosition = cameraProjectionMatrixInv * clipSpacePosition;
    // Perspective division
    viewSpacePosition /= viewSpacePosition.w;
    vec4 worldSpacePosition = cameraMatrixWorld * viewSpacePosition;
    return worldSpacePosition.xyz;
  }
  float sdPlane( vec3 p, vec3 n, float h ) {
    // n must be normalized
    return dot(p,n) + h;
  }
  float planeIntersect( vec3 ro, vec3 rd, vec4 p ) {
    return -(dot(ro,p.xyz)+p.w)/dot(rd,p.xyz);
  }
  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 pos, vec3 normal, float ior, out vec3 rayOrigin, out vec3 rayDirection) {
    rayOrigin = ro;
    rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = pos + rayDirection * 0.1;
    return rayDirection;
  }
  void main() {
    // Each sample consists of random offset in the x and y direction
    float caustic = 0.0;
    float causticTexelSize = (1.0 / resolution) * size * 2.0;
    float texelsNeeded = worldRadius / causticTexelSize;
    float sampleRadius = texelsNeeded / resolution;
    float sum = 0.0;
    if (texture2D(depthTexture, vUv).x == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec2 offset1 = vec2(-0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset2 = vec2(-0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset3 = vec2(0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset4 = vec2(0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 uv1 = vUv + offset1 * sampleRadius;
    vec2 uv2 = vUv + offset2 * sampleRadius;
    vec2 uv3 = vUv + offset3 * sampleRadius;
    vec2 uv4 = vUv + offset4 * sampleRadius;
    vec3 normal1 = texture2D(normalTexture, uv1, -10.0).rgb * 2.0 - 1.0;
    vec3 normal2 = texture2D(normalTexture, uv2, -10.0).rgb * 2.0 - 1.0;
    vec3 normal3 = texture2D(normalTexture, uv3, -10.0).rgb * 2.0 - 1.0;
    vec3 normal4 = texture2D(normalTexture, uv4, -10.0).rgb * 2.0 - 1.0;
    float depth1 = texture2D(depthTexture, uv1, -10.0).x;
    float depth2 = texture2D(depthTexture, uv2, -10.0).x;
    float depth3 = texture2D(depthTexture, uv3, -10.0).x;
    float depth4 = texture2D(depthTexture, uv4, -10.0).x;
    // Sanity check the depths
    if (depth1 == 1.0 || depth2 == 1.0 || depth3 == 1.0 || depth4 == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec3 pos1 = WorldPosFromDepth(depth1, uv1);
    vec3 pos2 = WorldPosFromDepth(depth2, uv2);
    vec3 pos3 = WorldPosFromDepth(depth3, uv3);
    vec3 pos4 = WorldPosFromDepth(depth4, uv4);
    vec3 originPos1 = WorldPosFromDepth(0.0, uv1);
    vec3 originPos2 = WorldPosFromDepth(0.0, uv2);
    vec3 originPos3 = WorldPosFromDepth(0.0, uv3);
    vec3 originPos4 = WorldPosFromDepth(0.0, uv4);
    vec3 endPos1, endPos2, endPos3, endPos4;
    vec3 endDir1, endDir2, endDir3, endDir4;
    totalInternalReflection(originPos1, lightDir, pos1, normal1, ior, endPos1, endDir1);
    totalInternalReflection(originPos2, lightDir, pos2, normal2, ior, endPos2, endDir2);
    totalInternalReflection(originPos3, lightDir, pos3, normal3, ior, endPos3, endDir3);
    totalInternalReflection(originPos4, lightDir, pos4, normal4, ior, endPos4, endDir4);
    float lightPosArea = length(cross(originPos2 - originPos1, originPos3 - originPos1)) + length(cross(originPos3 - originPos1, originPos4 - originPos1));
    float t1 = planeIntersect(endPos1, endDir1, vec4(lightPlaneNormal, lightPlaneConstant));
    float t2 = planeIntersect(endPos2, endDir2, vec4(lightPlaneNormal, lightPlaneConstant));
    float t3 = planeIntersect(endPos3, endDir3, vec4(lightPlaneNormal, lightPlaneConstant));
    float t4 = planeIntersect(endPos4, endDir4, vec4(lightPlaneNormal, lightPlaneConstant));
    vec3 finalPos1 = endPos1 + endDir1 * t1;
    vec3 finalPos2 = endPos2 + endDir2 * t2;
    vec3 finalPos3 = endPos3 + endDir3 * t3;
    vec3 finalPos4 = endPos4 + endDir4 * t4;
    float finalArea = length(cross(finalPos2 - finalPos1, finalPos3 - finalPos1)) + length(cross(finalPos3 - finalPos1, finalPos4 - finalPos1));
    caustic += intensity * (lightPosArea / finalArea);
    // Calculate the area of the triangle in light spaces
    gl_FragColor = vec4(vec3(max(caustic, 0.0)), 1.0);
  }`),PO={depth:!0,minFilter:tZ,magFilter:tZ,type:t4},PU={minFilter:t2,magFilter:tZ,type:re,generateMipmaps:!0},PN=eN.forwardRef(({debug:e,children:t,frames:r=1,ior:i=1.1,color:n="white",causticsOnly:a=!1,backside:s=!1,backsideIOR:o=1.1,worldRadius:l=.3125,intensity:u=.05,resolution:c=2024,lightSource:h=[5,5,5],...d},f)=>{dp({CausticsProjectionMaterial:Pk});let p=eN.useRef(null),m=eN.useRef(null),g=eN.useRef(null),A=eN.useRef(null),v=dY(e=>e.gl),y=IG(e&&m,hX),E=SX(c,c,PO),x=SX(c,c,PO),_=SX(c,c,PU),b=SX(c,c,PU),[S]=eN.useState(()=>PL()),[w]=eN.useState(()=>PL(e0)),[C]=eN.useState(()=>new PF),[T]=eN.useState(()=>new _G(C));eN.useLayoutEffect(()=>{p.current.updateWorldMatrix(!1,!0)});let I=0,M=new ni,R=new oR,B=new n8,D=new oC,P=new ni,L=new ni,k=new nL,F=new ni,O=[],U=[],N=[],z=[],G=new ni;for(let e=0;e<8;e++)O.push(new ni),U.push(new ni),N.push(new ni),z.push(new ni);return dK(()=>{if(r===1/0||I++<r){var t,n;Array.isArray(h)?P.fromArray(h).normalize():P.copy(p.current.worldToLocal(h.current.getWorldPosition(M)).normalize()),L.copy(P).multiplyScalar(-1),null==(t=g.current.parent)||t.matrixWorld.identity(),k.setFromObject(g.current,!0),O[0].set(k.min.x,k.min.y,k.min.z),O[1].set(k.min.x,k.min.y,k.max.z),O[2].set(k.min.x,k.max.y,k.min.z),O[3].set(k.min.x,k.max.y,k.max.z),O[4].set(k.max.x,k.min.y,k.min.z),O[5].set(k.max.x,k.min.y,k.max.z),O[6].set(k.max.x,k.max.y,k.min.z),O[7].set(k.max.x,k.max.y,k.max.z);for(let e=0;e<8;e++)U[e].copy(O[e]);k.getCenter(F),O.map(e=>e.sub(F));let r=D.set(L,0);O.map((e,t)=>r.projectPoint(e,N[t]));let d=N.reduce((e,t)=>e.add(t),M.set(0,0,0)).divideScalar(N.length),f=N.map(e=>e.distanceTo(d)).reduce((e,t)=>Math.max(e,t)),I=O.map(e=>e.dot(P)).reduce((e,t)=>Math.max(e,t));m.current.position.copy(G.copy(P).multiplyScalar(I).add(F)),m.current.lookAt(g.current.localToWorld(F));let H=B.lookAt(m.current.position,F,M.set(0,1,0));m.current.left=-f,m.current.right=f,m.current.top=f,m.current.bottom=-f;let Q=M.set(0,f,0).applyMatrix4(H),V=(m.current.position.y+Q.y)/P.y;m.current.near=.1,m.current.far=V,m.current.updateProjectionMatrix(),m.current.updateMatrixWorld();let W=U.map((e,t)=>e.add(z[t].copy(P).multiplyScalar(-e.y/P.y))),j=W.reduce((e,t)=>e.add(t),M.set(0,0,0)).divideScalar(W.length),Y=2*W.map(e=>Math.hypot(e.x-j.x,e.z-j.z)).reduce((e,t)=>Math.max(e,t));A.current.scale.setScalar(Y),A.current.position.copy(j),e&&(null==(n=y.current)||n.update()),w.viewMatrix.value=S.viewMatrix.value=m.current.matrixWorldInverse;let K=R.setFromProjectionMatrix(B.multiplyMatrices(m.current.projectionMatrix,m.current.matrixWorldInverse)).planes[4];C.cameraMatrixWorld=m.current.matrixWorld,C.cameraProjectionMatrixInv=m.current.projectionMatrixInverse,C.lightDir=L,C.lightPlaneNormal=K.normal,C.lightPlaneConstant=K.constant,C.near=m.current.near,C.far=m.current.far,C.resolution=c,C.size=f,C.intensity=u,C.worldRadius=l,g.current.visible=!0,v.setRenderTarget(E),v.clear(),g.current.overrideMaterial=S,v.render(g.current,m.current),v.setRenderTarget(x),v.clear(),s&&(g.current.overrideMaterial=w,v.render(g.current,m.current)),g.current.overrideMaterial=null,C.ior=i,A.current.material.lightProjMatrix=m.current.projectionMatrix,A.current.material.lightViewMatrix=m.current.matrixWorldInverse,C.normalTexture=E.texture,C.depthTexture=E.depthTexture,v.setRenderTarget(_),v.clear(),T.render(v),C.ior=o,C.normalTexture=x.texture,C.depthTexture=x.depthTexture,v.setRenderTarget(b),v.clear(),s&&T.render(v),v.setRenderTarget(null),a&&(g.current.visible=!1)}}),eN.useImperativeHandle(f,()=>p.current,[]),eN.createElement("group",eU({ref:p},d),eN.createElement("scene",{ref:g},eN.createElement("orthographicCamera",{ref:m,up:[0,1,0]}),t),eN.createElement("mesh",{renderOrder:2,ref:A,"rotation-x":-Math.PI/2},eN.createElement("planeGeometry",null),eN.createElement("causticsProjectionMaterial",{transparent:!0,color:n,causticsTexture:_.texture,causticsTextureB:b.texture,blending:e8,blendSrc:tn,blendDst:to,depthWrite:!1}),e&&eN.createElement(bc,null,eN.createElement("lineBasicMaterial",{color:"#ffff00",toneMapped:!1}))))}),Pz=eN.forwardRef(({mixBlur:e=0,mixStrength:t=.5,resolution:r=256,blur:i=[0,0],args:n=[1,1],minDepthThreshold:a=.9,maxDepthThreshold:s=1,depthScale:o=0,depthToBlurRatioBias:l=.25,mirror:u=0,children:c,debug:h=0,distortion:d=1,mixContrast:f=1,distortionMap:p,...m},g)=>{dp({MeshReflectorMaterial:BY}),eN.useEffect(()=>{console.warn("Reflector has been deprecated and will be removed next major. Replace it with <MeshReflectorMaterial />!")},[]);let A=dY(({gl:e})=>e),v=dY(({camera:e})=>e),y=dY(({scene:e})=>e),E=(i=Array.isArray(i)?i:[i,i])[0]+i[1]>0,x=eN.useRef(null);eN.useImperativeHandle(g,()=>x.current,[]);let[_]=eN.useState(()=>new oC),[b]=eN.useState(()=>new ni),[S]=eN.useState(()=>new ni),[w]=eN.useState(()=>new ni),[C]=eN.useState(()=>new n8),[T]=eN.useState(()=>new ni(0,0,-1)),[I]=eN.useState(()=>new nT),[M]=eN.useState(()=>new ni),[R]=eN.useState(()=>new ni),[B]=eN.useState(()=>new nT),[D]=eN.useState(()=>new n8),[P]=eN.useState(()=>new sD),L=eN.useCallback(()=>{if(S.setFromMatrixPosition(x.current.matrixWorld),w.setFromMatrixPosition(v.matrixWorld),C.extractRotation(x.current.matrixWorld),b.set(0,0,1),b.applyMatrix4(C),M.subVectors(S,w),M.dot(b)>0)return;M.reflect(b).negate(),M.add(S),C.extractRotation(v.matrixWorld),T.set(0,0,-1),T.applyMatrix4(C),T.add(w),R.subVectors(S,T),R.reflect(b).negate(),R.add(S),P.position.copy(M),P.up.set(0,1,0),P.up.applyMatrix4(C),P.up.reflect(b),P.lookAt(R),P.far=v.far,P.updateMatrixWorld(),P.projectionMatrix.copy(v.projectionMatrix),D.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),D.multiply(P.projectionMatrix),D.multiply(P.matrixWorldInverse),D.multiply(x.current.matrixWorld),_.setFromNormalAndCoplanarPoint(b,S),_.applyMatrix4(P.matrixWorldInverse),I.set(_.normal.x,_.normal.y,_.normal.z,_.constant);let e=P.projectionMatrix;B.x=(Math.sign(I.x)+e.elements[8])/e.elements[0],B.y=(Math.sign(I.y)+e.elements[9])/e.elements[5],B.z=-1,B.w=(1+e.elements[10])/e.elements[14],I.multiplyScalar(2/I.dot(B)),e.elements[2]=I.x,e.elements[6]=I.y,e.elements[10]=I.z+1,e.elements[14]=I.w},[]),[k,F,O,U]=eN.useMemo(()=>{let n={type:rt,minFilter:tZ,magFilter:tZ},c=new nM(r,r,n);c.depthBuffer=!0,c.depthTexture=new lg(r,r),c.depthTexture.format=rc,c.depthTexture.type=t8;let m=new nM(r,r,n),g=new Bj({gl:A,resolution:r,width:i[0],height:i[1],minDepthThreshold:a,maxDepthThreshold:s,depthScale:o,depthToBlurRatioBias:l}),v={mirror:u,textureMatrix:D,mixBlur:e,tDiffuse:c.texture,tDepth:c.depthTexture,tDiffuseBlur:m.texture,hasBlur:E,mixStrength:t,minDepthThreshold:a,maxDepthThreshold:s,depthScale:o,depthToBlurRatioBias:l,transparent:!0,debug:h,distortion:d,distortionMap:p,mixContrast:f,"defines-USE_BLUR":E?"":void 0,"defines-USE_DEPTH":o>0?"":void 0,"defines-USE_DISTORTION":p?"":void 0};return[c,m,g,v]},[A,i,D,r,u,E,e,t,a,s,o,l,h,d,p,f]);return dK(()=>{if(!(null!=x&&x.current))return;x.current.visible=!1;let e=A.xr.enabled,t=A.shadowMap.autoUpdate;L(),A.xr.enabled=!1,A.shadowMap.autoUpdate=!1,A.setRenderTarget(k),A.state.buffers.depth.setMask(!0),A.autoClear||A.clear(),A.render(y,P),E&&O.render(A,k,F),A.xr.enabled=e,A.shadowMap.autoUpdate=t,x.current.visible=!0,A.setRenderTarget(null)}),eN.createElement("mesh",eU({ref:x},m),eN.createElement("planeGeometry",{args:n}),c?c("meshReflectorMaterial",U):eN.createElement("meshReflectorMaterial",U))});class PG extends sT{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new ni(0,0,0)},lightColor:{value:new aQ("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new nt(0,0)}},transparent:!0,depthWrite:!1,vertexShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;
        uniform vec3 spotPosition;
        uniform float attenuation;

        #include <common>
        #include <logdepthbuf_pars_vertex>

        void main() {
          // compute intensity
          vNormal = normalize(normalMatrix * normal);
          vec4 worldPosition = modelMatrix * vec4(position, 1);
          vec4 viewPosition = viewMatrix * worldPosition;
          vViewZ = viewPosition.z;

          vIntensity = 1.0 - saturate(distance(worldPosition.xyz, spotPosition) / attenuation);

          gl_Position = projectionMatrix * viewPosition;

          #include <logdepthbuf_vertex>
        }
      `,fragmentShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;

        uniform vec3 lightColor;
        uniform float anglePower;
        uniform sampler2D depth;
        uniform vec2 resolution;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float opacity;

        #include <packing>
        #include <logdepthbuf_pars_fragment>

        float readDepth(sampler2D depthSampler, vec2 uv) {
          float fragCoordZ = texture(depthSampler, uv).r;

          // https://github.com/mrdoob/three.js/issues/23072
          #ifdef USE_LOGDEPTHBUF
            float viewZ = 1.0 - exp2(fragCoordZ * log(cameraFar + 1.0) / log(2.0));
          #else
            float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);
          #endif

          return viewZ;
        }

        void main() {
          #include <logdepthbuf_fragment>

          vec3 normal = vec3(vNormal.x, vNormal.y, abs(vNormal.z));
          float angleIntensity = pow(dot(normal, vec3(0, 0, 1)), anglePower);
          float intensity = vIntensity * angleIntensity;

          // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry
          bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;
          if (isSoft) {
            vec2 uv = gl_FragCoord.xy / resolution;
            intensity *= smoothstep(0.0, 1.0, vViewZ - readDepth(depth, uv));
          }

          gl_FragColor = vec4(lightColor, intensity * opacity);

          #include <tonemapping_fragment>
          #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}}let PH=e=>null==e?void 0:e.isSpotLight;function PQ({opacity:e=1,radiusTop:t,radiusBottom:r,depthBuffer:i,color:n="white",distance:a=5,angle:s=.15,attenuation:o=5,anglePower:l=5}){let u=eN.useRef(null),c=dY(e=>e.size),h=dY(e=>e.camera),d=dY(e=>e.viewport.dpr),[f]=eN.useState(()=>new PG),[p]=eN.useState(()=>new ni);t=void 0===t?.1:t,r=void 0===r?7*s:r,dK(()=>{f.uniforms.spotPosition.value.copy(u.current.getWorldPosition(p)),u.current.lookAt(u.current.parent.target.getWorldPosition(p))});let m=eN.useMemo(()=>{let e=new lE(t,r,a,128,64,!0);return e.applyMatrix4(new n8().makeTranslation(0,-a/2,0)),e.applyMatrix4(new n8().makeRotationX(-Math.PI/2)),e},[a,t,r]);return eN.createElement(eN.Fragment,null,eN.createElement("mesh",{ref:u,geometry:m,raycast:()=>null},eN.createElement("primitive",{object:f,attach:"material","uniforms-opacity-value":e,"uniforms-lightColor-value":n,"uniforms-attenuation-value":o,"uniforms-anglePower-value":l,"uniforms-depth-value":i,"uniforms-cameraNear-value":h.near,"uniforms-cameraFar-value":h.far,"uniforms-resolution-value":i?[c.width*d,c.height*d]:[0,0]})))}function PV(e,t,r,i,n){let[[a,s]]=eN.useState(()=>[new ni,new ni]);eN.useLayoutEffect(()=>{if(PH(e.current))e.current.shadow.mapSize.set(r,i),e.current.shadow.needsUpdate=!0;else throw Error("SpotlightShadow must be a child of a SpotLight")},[e,r,i]),dK(()=>{if(!e.current)return;let r=e.current.position,i=e.current.target.position;s.copy(i).sub(r);var o=s.length();s.normalize().multiplyScalar(o*n),a.copy(r).add(s),t.current.position.copy(a),t.current.lookAt(e.current.target.position)})}function PW({distance:e=.4,alphaTest:t=.5,map:r,shader:i="#define GLSLIFY 1\nvarying vec2 vUv;uniform sampler2D uShadowMap;uniform float uTime;void main(){vec3 color=texture2D(uShadowMap,vUv).xyz;gl_FragColor=vec4(color,1.);}",width:n=512,height:a=512,scale:s=1,children:o,...l}){let u=eN.useRef(null),c=l.spotlightRef,h=l.debug;PV(c,u,n,a,e);let d=eN.useMemo(()=>new nM(n,a,{format:ru,stencilBuffer:!1}),[n,a]),f=eN.useRef({uShadowMap:{value:r},uTime:{value:0}});eN.useEffect(()=>void(f.current.uShadowMap.value=r),[r]);let p=eN.useMemo(()=>new _G(new sT({uniforms:f.current,vertexShader:`
          varying vec2 vUv;

          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
          `,fragmentShader:i})),[i]);return eN.useEffect(()=>()=>{p.material.dispose(),p.dispose()},[p]),eN.useEffect(()=>()=>d.dispose(),[d]),dK(({gl:e},t)=>{f.current.uTime.value+=t,e.setRenderTarget(d),p.render(e),e.setRenderTarget(null)}),eN.createElement(eN.Fragment,null,eN.createElement("mesh",{ref:u,scale:s,castShadow:!0},eN.createElement("planeGeometry",null),eN.createElement("meshBasicMaterial",{transparent:!0,side:e1,alphaTest:t,alphaMap:d.texture,"alphaMap-wrapS":tW,"alphaMap-wrapT":tW,opacity:h?1:0},o)))}function Pj({distance:e=.4,alphaTest:t=.5,map:r,width:i=512,height:n=512,scale:a,children:s,...o}){let l=eN.useRef(null),u=o.spotlightRef,c=o.debug;return PV(u,l,i,n,e),eN.createElement(eN.Fragment,null,eN.createElement("mesh",{ref:l,scale:a,castShadow:!0},eN.createElement("planeGeometry",null),eN.createElement("meshBasicMaterial",{transparent:!0,side:e1,alphaTest:t,alphaMap:r,"alphaMap-wrapS":tW,"alphaMap-wrapT":tW,opacity:c?1:0},s)))}function PY(e){return e.shader?eN.createElement(PW,e):eN.createElement(Pj,e)}let PK=eN.forwardRef(({opacity:e=1,radiusTop:t,radiusBottom:r,depthBuffer:i,color:n="white",distance:a=5,angle:s=.15,attenuation:o=5,anglePower:l=5,volumetric:u=!0,debug:c=!1,children:h,...d},f)=>{let p=eN.useRef(null);return eN.useImperativeHandle(f,()=>p.current,[]),eN.createElement("group",null,c&&p.current&&eN.createElement("spotLightHelper",{args:[p.current]}),eN.createElement("spotLight",eU({ref:p,angle:s,color:n,distance:a,castShadow:!0},d),u&&eN.createElement(PQ,{debug:c,opacity:e,radiusTop:t,radiusBottom:r,depthBuffer:i,color:n,distance:a,angle:s,attenuation:o,anglePower:l})),h&&eN.cloneElement(h,{spotlightRef:p,debug:c}))}),Pq=eN.forwardRef(({light:e,args:t,map:r,toneMapped:i=!1,color:n="white",form:a="rect",intensity:s=1,scale:o=1,target:l=[0,0,0],children:u,...c},h)=>{let d=eN.useRef(null);return eN.useImperativeHandle(h,()=>d.current,[]),eN.useLayoutEffect(()=>{u||c.material||(d1(d.current.material,{color:n}),d.current.material.color.multiplyScalar(s))},[n,s,u,c.material]),eN.useLayoutEffect(()=>{c.rotation||d.current.quaternion.identity(),l&&!c.rotation&&("boolean"==typeof l?d.current.lookAt(0,0,0):d.current.lookAt(Array.isArray(l)?new ni(...l):l))},[l,c.rotation]),o=Array.isArray(o)&&2===o.length?[o[0],o[1],1]:o,eN.createElement("mesh",eU({ref:d,scale:o},c),"circle"===a?eN.createElement("ringGeometry",{args:t||[0,.5,64]}):"ring"===a?eN.createElement("ringGeometry",{args:t||[.25,.5,64]}):"rect"===a||"plane"===a?eN.createElement("planeGeometry",{args:t||[1,1]}):"box"===a?eN.createElement("boxGeometry",{args:t||[1,1,1]}):eN.createElement(a,{args:t}),u||eN.createElement("meshBasicMaterial",{toneMapped:i,map:r,side:e1}),e&&eN.createElement("pointLight",eU({castShadow:!0},e)))});var PX=Object.defineProperty,P$=(e,t,r)=>t in e?PX(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,PJ=(e,t,r)=>(P$(e,"symbol"!=typeof t?t+"":t,r),r);let PZ=(()=>{let e={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new ni},up:{value:new ni(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${EZ>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},t=new sT({name:"SkyShader",fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:sC.clone(e.uniforms),side:e0,depthWrite:!1});class r extends sE{constructor(){super(new s_(1,1,1),t)}}return PJ(r,"SkyShader",e),PJ(r,"material",t),r})();function P0(e,t,r=new ni){let i=Math.PI*(e-.5),n=2*Math.PI*(t-.5);return r.x=Math.cos(n),r.y=Math.sin(i),r.z=Math.sin(n),r}let P1=eN.forwardRef(({inclination:e=.6,azimuth:t=.1,distance:r=1e3,mieCoefficient:i=.005,mieDirectionalG:n=.8,rayleigh:a=.5,turbidity:s=10,sunPosition:o=P0(e,t),...l},u)=>{let c=eN.useMemo(()=>new ni().setScalar(r),[r]),[h]=eN.useState(()=>new PZ);return eN.createElement("primitive",eU({object:h,ref:u,"material-uniforms-mieCoefficient-value":i,"material-uniforms-mieDirectionalG-value":n,"material-uniforms-rayleigh-value":a,"material-uniforms-sunPosition-value":o,"material-uniforms-turbidity-value":s,scale:c},l))});class P2 extends sT{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:`
      uniform float time;
      attribute float size;
      varying vec3 vColor;
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);
        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));
        gl_Position = projectionMatrix * mvPosition;
      }`,fragmentShader:`
      uniform sampler2D pointTexture;
      uniform float fade;
      varying vec3 vColor;
      void main() {
        float opacity = 1.0;
        if (fade == 1.0) {
          float d = distance(gl_PointCoord, vec2(0.5, 0.5));
          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));
        }
        gl_FragColor = vec4(vColor, opacity);

        #include <tonemapping_fragment>
	      #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
      }`})}}let P3=e=>new ni().setFromSpherical(new hv(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI)),P4=eN.forwardRef(({radius:e=100,depth:t=50,count:r=5e3,saturation:i=0,factor:n=4,fade:a=!1,speed:s=1},o)=>{let l=eN.useRef(),[u,c,h]=eN.useMemo(()=>{let a=[],s=[],o=Array.from({length:r},()=>(.5+.5*Math.random())*n),l=new aQ,u=e+t,c=t/r;for(let e=0;e<r;e++)u-=c*Math.random(),a.push(...P3(u).toArray()),l.setHSL(e/r,i,.9),s.push(l.r,l.g,l.b);return[new Float32Array(a),new Float32Array(s),new Float32Array(o)]},[r,t,n,e,i]);dK(e=>l.current&&(l.current.uniforms.time.value=e.clock.elapsedTime*s));let[d]=eN.useState(()=>new P2);return eN.createElement("points",{ref:o},eN.createElement("bufferGeometry",null,eN.createElement("bufferAttribute",{attach:"attributes-position",args:[u,3]}),eN.createElement("bufferAttribute",{attach:"attributes-color",args:[c,3]}),eN.createElement("bufferAttribute",{attach:"attributes-size",args:[h,1]})),eN.createElement("primitive",{ref:l,object:d,attach:"material",blending:e4,"uniforms-fade-value":a,depthWrite:!1,transparent:!0,vertexColors:!0}))}),P5="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",P6=new n8,P8=new ni,P9=new nr,P7=new ni,Le=new nr,Lt=new ni,Lr=eN.createContext(null),Li=eN.forwardRef(({children:e,material:t=uB,texture:r=P5,range:i,limit:n=200,frustumCulled:a,...s},o)=>{var l,u;let c;dp({CloudMaterial:eN.useMemo(()=>class extends t{constructor(){super();let e=parseInt(eH.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=t=>{t.vertexShader=`attribute float cloudOpacity;
               varying float vOpacity;
              `+t.vertexShader.replace("#include <fog_vertex>",`#include <fog_vertex>
                 vOpacity = cloudOpacity;
                `),t.fragmentShader=`varying float vOpacity;
              `+t.fragmentShader.replace(`#include <${e}>`,`#include <${e}>
                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);
                `)}}},[t])});let h=eN.useRef(null),d=eN.useRef([]),f=eN.useMemo(()=>new Float32Array(Array.from({length:n},()=>1)),[n]),p=eN.useMemo(()=>new Float32Array(Array.from({length:n},()=>[1,1,1]).flat()),[n]),m=br(r),g=0,A=0,v=new nr,y=new ni(0,0,1),E=new ni;dK((e,t)=>{for(g=e.clock.elapsedTime,P6.copy(h.current.matrixWorld).invert(),e.camera.matrixWorld.decompose(P7,Le,Lt),A=0;A<d.current.length;A++)(c=d.current[A]).ref.current.matrixWorld.decompose(P8,P9,Lt),P8.add(E.copy(c.position).applyQuaternion(P9).multiply(Lt)),P9.copy(Le).multiply(v.setFromAxisAngle(y,c.rotation+=t*c.rotationFactor)),Lt.multiplyScalar(c.volume+(1+Math.sin(g*c.density*c.speed))/2*c.growth),c.matrix.compose(P8,P9,Lt).premultiply(P6),c.dist=P8.distanceTo(P7);for(d.current.sort((e,t)=>t.dist-e.dist),A=0;A<d.current.length;A++)c=d.current[A],f[A]=c.opacity*(c.dist<c.fade-1?c.dist/c.fade:1),h.current.setMatrixAt(A,c.matrix),h.current.setColorAt(A,c.color);h.current.geometry.attributes.cloudOpacity.needsUpdate=!0,h.current.instanceMatrix.needsUpdate=!0,h.current.instanceColor&&(h.current.instanceColor.needsUpdate=!0)}),eN.useLayoutEffect(()=>{let e=Math.min(n,void 0!==i?i:n,d.current.length);h.current.count=e,Bu(h.current.instanceMatrix,{offset:0,count:16*e}),h.current.instanceColor&&Bu(h.current.instanceColor,{offset:0,count:3*e}),Bu(h.current.geometry.attributes.cloudOpacity,{offset:0,count:e})});let x=[null!==(l=m.image.width)&&void 0!==l?l:1,null!==(u=m.image.height)&&void 0!==u?u:1],_=Math.max(x[0],x[1]);return x=[x[0]/_,x[1]/_],eN.createElement("group",eU({ref:o},s),eN.createElement(Lr.Provider,{value:d},e,eN.createElement("instancedMesh",{matrixAutoUpdate:!1,ref:h,args:[null,null,n],frustumCulled:a},eN.createElement("instancedBufferAttribute",{usage:iU,attach:"instanceColor",args:[p,3]}),eN.createElement("planeGeometry",{args:[...x]},eN.createElement("instancedBufferAttribute",{usage:iU,attach:"attributes-cloudOpacity",args:[f,1]})),eN.createElement("cloudMaterial",{key:t.name,map:m,transparent:!0,depthWrite:!1}))))}),Ln=eN.forwardRef(({opacity:e=1,speed:t=0,bounds:r=[5,1,1],segments:i=20,color:n="#ffffff",fade:a=10,volume:s=6,smallestVolume:o=.25,distribute:l=null,growth:u=4,concentrate:c="inside",seed:h=Math.random(),...d},f)=>{function p(){let e=1e4*Math.sin(h++);return e-Math.floor(e)}let m=eN.useContext(Lr),g=eN.useRef(null),A=eN.useId(),v=eN.useMemo(()=>[...Array(i)].map((e,t)=>({segments:i,bounds:new ni(1,1,1),position:new ni,uuid:A,index:t,ref:g,dist:0,matrix:new n8,color:new aQ,rotation:Math.PI/i*t})),[i,A]);return eN.useLayoutEffect(()=>{v.forEach((h,d)=>{d1(h,{volume:s,color:n,speed:t,growth:u,opacity:e,fade:a,bounds:r,density:Math.max(.5,p()),rotationFactor:Math.max(.2,.5*p())*t});let f=null==l?void 0:l(h,d);if(f||i>1){var m;h.position.copy(h.bounds).multiply(null!==(m=null==f?void 0:f.point)&&void 0!==m?m:{x:2*p()-1,y:2*p()-1,z:2*p()-1})}let g=Math.abs(h.position.x),A=Math.abs(h.position.y),v=Math.abs(h.position.z),y=Math.max(g,A,v);h.length=1,g===y&&(h.length-=g/h.bounds.x),A===y&&(h.length-=A/h.bounds.y),v===y&&(h.length-=v/h.bounds.z),h.volume=((null==f?void 0:f.volume)!==void 0?f.volume:Math.max(Math.max(0,o),"random"===c?p():"inside"===c?h.length:1-h.length))*s})},[c,r,a,n,e,u,s,h,i,t]),eN.useLayoutEffect(()=>(m.current=[...m.current,...v],()=>{m.current=m.current.filter(e=>e.uuid!==A)}),[v]),eN.useImperativeHandle(f,()=>g.current,[]),eN.createElement("group",eU({ref:g},d))}),La=eN.forwardRef((e,t)=>eN.useContext(Lr)?eN.createElement(Ln,eU({ref:t},e)):eN.createElement(Li,null,eN.createElement(Ln,eU({ref:t},e))));class Ls extends sT{constructor(){super({uniforms:{time:{value:0},pixelRatio:{value:1}},vertexShader:`
        uniform float pixelRatio;
        uniform float time;
        attribute float size;  
        attribute float speed;  
        attribute float opacity;
        attribute vec3 noise;
        attribute vec3 color;
        varying vec3 vColor;
        varying float vOpacity;

        void main() {
          vec4 modelPosition = modelMatrix * vec4(position, 1.0);
          modelPosition.y += sin(time * speed + modelPosition.x * noise.x * 100.0) * 0.2;
          modelPosition.z += cos(time * speed + modelPosition.x * noise.y * 100.0) * 0.2;
          modelPosition.x += cos(time * speed + modelPosition.x * noise.z * 100.0) * 0.2;
          vec4 viewPosition = viewMatrix * modelPosition;
          vec4 projectionPostion = projectionMatrix * viewPosition;
          gl_Position = projectionPostion;
          gl_PointSize = size * 25. * pixelRatio;
          gl_PointSize *= (1.0 / - viewPosition.z);
          vColor = color;
          vOpacity = opacity;
        }
      `,fragmentShader:`
        varying vec3 vColor;
        varying float vOpacity;
        void main() {
          float distanceToCenter = distance(gl_PointCoord, vec2(0.5));
          float strength = 0.05 / distanceToCenter - 0.1;
          gl_FragColor = vec4(vColor, strength * vOpacity);
          #include <tonemapping_fragment>
          #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}get pixelRatio(){return this.uniforms.pixelRatio.value}set pixelRatio(e){this.uniforms.pixelRatio.value=e}}let Lo=e=>e&&e.constructor===Float32Array,Ll=e=>[e.r,e.g,e.b],Lu=e=>e instanceof nt||e instanceof ni||e instanceof nT,Lc=e=>Array.isArray(e)?e:Lu(e)?e.toArray():[e,e,e];function Lh(e,t,r){return eN.useMemo(()=>{if(void 0!==t){if(Lo(t))return t;if(t instanceof aQ){let r=Array.from({length:3*e},()=>Ll(t)).flat();return Float32Array.from(r)}if(Lu(t)||Array.isArray(t)){let r=Array.from({length:3*e},()=>Lc(t)).flat();return Float32Array.from(r)}return Float32Array.from({length:e},()=>t)}return Float32Array.from({length:e},r)},[t])}let Ld=eN.forwardRef(({noise:e=1,count:t=100,speed:r=1,opacity:i=1,scale:n=1,size:a,color:s,children:o,...l},u)=>{eN.useMemo(()=>dp({SparklesImplMaterial:Ls}),[]);let c=eN.useRef(null),h=dY(e=>e.viewport.dpr),d=Lc(n),f=eN.useMemo(()=>Float32Array.from(Array.from({length:t},()=>d.map(ne.randFloatSpread)).flat()),[t,...d]),p=Lh(t,a,Math.random),m=Lh(t,i),g=Lh(t,r),A=Lh(3*t,e),v=Lh(void 0===s?3*t:t,Lo(s)?s:new aQ(s),()=>1);return dK(e=>{c.current&&c.current.material&&(c.current.material.time=e.clock.elapsedTime)}),eN.useImperativeHandle(u,()=>c.current,[]),eN.createElement("points",eU({key:`particle-${t}-${JSON.stringify(n)}`},l,{ref:c}),eN.createElement("bufferGeometry",null,eN.createElement("bufferAttribute",{attach:"attributes-position",args:[f,3]}),eN.createElement("bufferAttribute",{attach:"attributes-size",args:[p,1]}),eN.createElement("bufferAttribute",{attach:"attributes-opacity",args:[m,1]}),eN.createElement("bufferAttribute",{attach:"attributes-speed",args:[g,1]}),eN.createElement("bufferAttribute",{attach:"attributes-color",args:[v,3]}),eN.createElement("bufferAttribute",{attach:"attributes-noise",args:[A,3]})),o||eN.createElement("sparklesImplMaterial",{transparent:!0,pixelRatio:h,depthWrite:!1}))});function Lf(e=0,t=1024,r){let i=da(()=>fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json").then(e=>e.json()),["matcapList"]),n=i[0],a=eN.useMemo(()=>Object.keys(i).length,[]),s=eN.useMemo(()=>"string"==typeof e?e:"number"==typeof e?i[e]:null,[e]),o=`${s||n}${function(e){switch(e){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}(t)}.png`,l=`https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d/${t}/${o}`;return[br(l,r),l,a]}let Lp=({children:e,id:t,format:r,onLoad:i})=>{let n=Lf(t,r,i);return eN.createElement(eN.Fragment,null,null==e?void 0:e(n))};function Lm(e=0,t={},r){let{repeat:i=[1,1],anisotropy:n=1,offset:a=[0,0]}=t,s=da(()=>fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json").then(e=>e.json()),["normalsList"]),o=eN.useMemo(()=>Object.keys(s).length,[]),l=s[0],u=s[e]||l,c=`https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb/normals/${u}`,h=br(c,r);return eN.useLayoutEffect(()=>{h&&(h.wrapS=h.wrapT=tW,h.repeat=new nt(i[0],i[1]),h.offset=new nt(a[0],a[1]),h.anisotropy=n)},[h,n,i,a]),[h,c,o]}let Lg=({children:e,id:t,onLoad:r,...i})=>{let n=Lm(t,i,r);return eN.createElement(eN.Fragment,null,null==e?void 0:e(n))},LA={uniforms:{strokeOpacity:1,fillOpacity:.25,fillMix:0,thickness:.05,colorBackfaces:!1,dashInvert:!0,dash:!1,dashRepeats:4,dashLength:.5,squeeze:!1,squeezeMin:.2,squeezeMax:1,stroke:new aQ("#ff0000"),backfaceStroke:new aQ("#0000ff"),fill:new aQ("#00ff00")},vertex:`
	  attribute vec3 barycentric;
	
		varying vec3 v_edges_Barycentric;
		varying vec3 v_edges_Position;

		void initWireframe() {
			v_edges_Barycentric = barycentric;
			v_edges_Position = position.xyz;
		}
	  `,fragment:`
		#ifndef PI
	  	#define PI 3.1415926535897932384626433832795
		#endif
  
	  varying vec3 v_edges_Barycentric;
	  varying vec3 v_edges_Position;
  
	  uniform float strokeOpacity;
	  uniform float fillOpacity;
	  uniform float fillMix;
	  uniform float thickness;
	  uniform bool colorBackfaces;
  
	  // Dash
	  uniform bool dashInvert;
	  uniform bool dash;
	  uniform bool dashOnly;
	  uniform float dashRepeats;
	  uniform float dashLength;
  
	  // Squeeze
	  uniform bool squeeze;
	  uniform float squeezeMin;
	  uniform float squeezeMax;
  
	  // Colors
	  uniform vec3 stroke;
	  uniform vec3 backfaceStroke;
	  uniform vec3 fill;
  
	  // This is like
	  float wireframe_aastep(float threshold, float dist) {
		  float afwidth = fwidth(dist) * 0.5;
		  return smoothstep(threshold - afwidth, threshold + afwidth, dist);
	  }
  
	  float wireframe_map(float value, float min1, float max1, float min2, float max2) {
		  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
	  }
  
	  float getWireframe() {
			vec3 barycentric = v_edges_Barycentric;
		
			// Distance from center of each triangle to its edges.
			float d = min(min(barycentric.x, barycentric.y), barycentric.z);

			// for dashed rendering, we can use this to get the 0 .. 1 value of the line length
			float positionAlong = max(barycentric.x, barycentric.y);
			if (barycentric.y < barycentric.x && barycentric.y < barycentric.z) {
				positionAlong = 1.0 - positionAlong;
			}

			// the thickness of the stroke
			float computedThickness = wireframe_map(thickness, 0.0, 1.0, 0.0, 0.34);

			// if we want to shrink the thickness toward the center of the line segment
			if (squeeze) {
				computedThickness *= mix(squeezeMin, squeezeMax, (1.0 - sin(positionAlong * PI)));
			}

			// Create dash pattern
			if (dash) {
				// here we offset the stroke position depending on whether it
				// should overlap or not
				float offset = 1.0 / dashRepeats * dashLength / 2.0;
				if (!dashInvert) {
					offset += 1.0 / dashRepeats / 2.0;
				}

				// if we should animate the dash or not
				// if (dashAnimate) {
				// 	offset += time * 0.22;
				// }

				// create the repeating dash pattern
				float pattern = fract((positionAlong + offset) * dashRepeats);
				computedThickness *= 1.0 - wireframe_aastep(dashLength, pattern);
			}

			// compute the anti-aliased stroke edge  
			float edge = 1.0 - wireframe_aastep(computedThickness, d);

			return edge;
	  }
	  `},Lv=be(LA.uniforms,LA.vertex+`
  	void main() {
		initWireframe();
		gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	}
  `,LA.fragment+`
  void main () {
		// Compute color

		float edge = getWireframe();
		vec4 colorStroke = vec4(stroke, edge);

		#ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		#endif
    
		vec4 colorFill = vec4(fill, fillOpacity);
		vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		gl_FragColor = outColor;
	}
  `);function Ly(e){return(null==e?void 0:e.current)!==void 0}function LE(e){return"WireframeGeometry"===e.type}function Lx(e){let t=null!=e&&e.current?e.current:e;if(null!=t&&t.isBufferGeometry)return t;{if(LE(t))throw Error("Wireframe: WireframeGeometry is not supported.");let e=t.parent;if(null!=e&&e.geometry){if(LE(e.geometry))throw Error("Wireframe: WireframeGeometry is not supported.");return e.geometry}}}function L_(e,t){if(e.index){console.warn("Wireframe: Requires non-indexed geometry, converting to non-indexed geometry.");let t=e.toNonIndexed();e.copy(t),e.setIndex(null)}let r=function(e,t){let r=e.getAttribute("position").count,i=[];for(let e=0;e<r;e++){let r=t?1:0;e%2==0?i.push(0,0,1,0,1,0,1,0,r):i.push(0,1,0,0,0,1,1,0,r)}return new a1(Float32Array.from(i),3)}(e,t);e.setAttribute("barycentric",r)}function Lb({geometry:e,simplify:t=!1,...r}){dp({MeshWireframeMaterial:Lv});let[i,n]=eN.useState(null);eN.useLayoutEffect(()=>{let r=Lx(e);if(!r)throw Error("Wireframe: geometry prop must be a BufferGeometry or a ref to a BufferGeometry.");L_(r,t),Ly(e)&&n(r)},[t,e]);let a=Ly(e)?i:e;return eN.createElement(eN.Fragment,null,a&&eN.createElement("mesh",{geometry:a},eN.createElement("meshWireframeMaterial",eU({attach:"material",transparent:!0,side:e1,polygonOffset:!0,polygonOffsetFactor:-4},r,{extensions:{derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1}}))))}function LS({simplify:e=!1,...t}){let r=eN.useRef(null),i=eN.useMemo(()=>(function(){let e={};for(let t in LA.uniforms)e[t]={value:LA.uniforms[t]};return e})(),[LA.uniforms]);return eN.useEffect(()=>{var e;i.fillOpacity.value=null!==(e=t.fillOpacity)&&void 0!==e?e:i.fillOpacity.value},[t.fillOpacity]),eN.useEffect(()=>{var e;i.fillMix.value=null!==(e=t.fillMix)&&void 0!==e?e:i.fillMix.value},[t.fillMix]),eN.useEffect(()=>{var e;i.strokeOpacity.value=null!==(e=t.strokeOpacity)&&void 0!==e?e:i.strokeOpacity.value},[t.strokeOpacity]),eN.useEffect(()=>{var e;i.thickness.value=null!==(e=t.thickness)&&void 0!==e?e:i.thickness.value},[t.thickness]),eN.useEffect(()=>void(i.colorBackfaces.value=!!t.colorBackfaces),[t.colorBackfaces]),eN.useEffect(()=>void(i.dash.value=!!t.dash),[t.dash]),eN.useEffect(()=>void(i.dashInvert.value=!!t.dashInvert),[t.dashInvert]),eN.useEffect(()=>{var e;i.dashRepeats.value=null!==(e=t.dashRepeats)&&void 0!==e?e:i.dashRepeats.value},[t.dashRepeats]),eN.useEffect(()=>{var e;i.dashLength.value=null!==(e=t.dashLength)&&void 0!==e?e:i.dashLength.value},[t.dashLength]),eN.useEffect(()=>void(i.squeeze.value=!!t.squeeze),[t.squeeze]),eN.useEffect(()=>{var e;i.squeezeMin.value=null!==(e=t.squeezeMin)&&void 0!==e?e:i.squeezeMin.value},[t.squeezeMin]),eN.useEffect(()=>{var e;i.squeezeMax.value=null!==(e=t.squeezeMax)&&void 0!==e?e:i.squeezeMax.value},[t.squeezeMax]),eN.useEffect(()=>void(i.stroke.value=t.stroke?new aQ(t.stroke):i.stroke.value),[t.stroke]),eN.useEffect(()=>void(i.fill.value=t.fill?new aQ(t.fill):i.fill.value),[t.fill]),eN.useEffect(()=>void(i.backfaceStroke.value=t.backfaceStroke?new aQ(t.backfaceStroke):i.backfaceStroke.value),[t.backfaceStroke]),eN.useLayoutEffect(()=>{let t=Lx(r);if(!t)throw Error("Wireframe: Must be a child of a Mesh, Line or Points object or specify a geometry prop.");let i=t.clone();return L_(t,e),()=>{t.copy(i),i.dispose()}},[e]),eN.useLayoutEffect(()=>{var e;let t=r.current.parent,n=t.material.clone();return(e=t.material).onBeforeCompile=e=>{e.uniforms={...e.uniforms,...i},e.vertexShader=e.vertexShader.replace("void main() {",`
		  ${LA.vertex}
		  void main() {
			initWireframe();
		`),e.fragmentShader=e.fragmentShader.replace("void main() {",`
		  ${LA.fragment}
		  void main() {
		`),e.fragmentShader=e.fragmentShader.replace("#include <color_fragment>",`
		  #include <color_fragment>
			  float edge = getWireframe();
		  vec4 colorStroke = vec4(stroke, edge);
		  #ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		  #endif
		  vec4 colorFill = vec4(mix(diffuseColor.rgb, fill, fillMix), mix(diffuseColor.a, fillOpacity, fillMix));
		  vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		  diffuseColor.rgb = outColor.rgb;
		  diffuseColor.a *= outColor.a;
		`)},e.side=e1,e.transparent=!0,()=>{t.material.dispose(),t.material=n}},[]),eN.createElement("object3D",{ref:r})}function Lw({geometry:e,...t}){return e?eN.createElement(Lb,eU({geometry:e},t)):eN.createElement(LS,t)}function LC({opacity:e,alphaMap:t}){let r=eN.useRef(null),i=eN.useRef(null),n=eN.useRef({value:1}),a=eN.useRef({value:null}),s=eN.useRef({value:!1});return eN.useLayoutEffect(()=>{r.current.onBeforeCompile=i.current.onBeforeCompile=e=>{let t;let r=e.fragmentShader.indexOf("void main"),i="",o=r;for(;"\n"!==t&&o<r+100;)i+=t=e.fragmentShader.charAt(o),o++;i=i.trim(),e.vertexShader=e.vertexShader.replace("void main() {",`
        varying vec2 custom_vUv;

        void main() {
          custom_vUv = uv;
          
        `),e.fragmentShader=e.fragmentShader.replace(i,`
          uniform float uShadowOpacity;
          uniform sampler2D uAlphaMap;
          uniform bool uHasAlphaMap;

          varying vec2 custom_vUv;
  
          float bayerDither2x2( vec2 v ) {
            return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
          }
    
          float bayerDither4x4( vec2 v ) {
            vec2 P1 = mod( v, 2.0 );
            vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
            return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
          }
  
          void main() {
            float alpha = 
              uHasAlphaMap ? 
                uShadowOpacity * texture2D(uAlphaMap, custom_vUv).x
              : uShadowOpacity;

            if( ( bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) ) ) / 16.0 >= alpha ) discard;
            
          `),e.uniforms.uShadowOpacity=n.current,e.uniforms.uAlphaMap=a.current,e.uniforms.uHasAlphaMap=s.current}},[]),dK(()=>{var i;let o=null==(i=r.current.__r3f)?void 0:i.parent;if(o){let r=o.material;r&&(n.current.value=null!=e?e:r.opacity,!1===t?(a.current.value=null,s.current.value=!1):(a.current.value=t||r.alphaMap,s.current.value=!!a.current.value))}}),eN.createElement(eN.Fragment,null,eN.createElement("meshDepthMaterial",{ref:r,attach:"customDepthMaterial",depthPacking:it}),eN.createElement("meshDistanceMaterial",{ref:i,attach:"customDistanceMaterial"}))}let LT=new n8,LI=new n6,LM=new nJ,LR=new ni;class LB extends sF{constructor(){super(),this.size=0,this.color=new aQ("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){var r,i;let n=this.instance.current;if(!n||!n.geometry)return;let a=n.userData.instances.indexOf(this.instanceKey);if(-1===a||a>n.geometry.drawRange.count)return;let s=null!==(r=null==(i=e.params.Points)?void 0:i.threshold)&&void 0!==r?r:1;if(LM.set(this.getWorldPosition(LR),s),!1===e.ray.intersectsSphere(LM))return;LT.copy(n.matrixWorld).invert(),LI.copy(e.ray).applyMatrix4(LT);let o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=LI.distanceSqToPoint(this.position);if(l<o*o){let r=new ni;LI.closestPointToPoint(this.position,r),r.applyMatrix4(this.matrixWorld);let i=e.ray.origin.distanceTo(r);if(i<e.near||i>e.far)return;t.push({distance:i,distanceToRay:Math.sqrt(l),point:r,index:a,face:null,object:this})}}}let LD=eN.createContext(null),LP=new n8,LL=new ni,Lk=eN.forwardRef(({children:e,range:t,limit:r=1e3,...i},n)=>{let a=eN.useRef(null);eN.useImperativeHandle(n,()=>a.current,[]);let[s,o]=eN.useState([]),[[l,u,c]]=eN.useState(()=>[new Float32Array(3*r),Float32Array.from({length:3*r},()=>1),Float32Array.from({length:r},()=>1)]);eN.useEffect(()=>{a.current.geometry.attributes.position.needsUpdate=!0}),dK(()=>{for(a.current.updateMatrix(),a.current.updateMatrixWorld(),LP.copy(a.current.matrixWorld).invert(),a.current.geometry.drawRange.count=Math.min(r,void 0!==t?t:r,s.length),Z=0;Z<s.length;Z++)(ee=s[Z].current).getWorldPosition(LL).applyMatrix4(LP),LL.toArray(l,3*Z),a.current.geometry.attributes.position.needsUpdate=!0,ee.matrixWorldNeedsUpdate=!0,ee.color.toArray(u,3*Z),a.current.geometry.attributes.color.needsUpdate=!0,c.set([ee.size],Z),a.current.geometry.attributes.size.needsUpdate=!0});let h=eN.useMemo(()=>({getParent:()=>a,subscribe:e=>(o(t=>[...t,e]),()=>o(t=>t.filter(t=>t.current!==e.current)))}),[]);return eN.createElement("points",eU({userData:{instances:s},matrixAutoUpdate:!1,ref:a,raycast:()=>null},i),eN.createElement("bufferGeometry",null,eN.createElement("bufferAttribute",{attach:"attributes-position",count:l.length/3,array:l,itemSize:3,usage:iU}),eN.createElement("bufferAttribute",{attach:"attributes-color",count:u.length/3,array:u,itemSize:3,usage:iU}),eN.createElement("bufferAttribute",{attach:"attributes-size",count:c.length,array:c,itemSize:1,usage:iU})),eN.createElement(LD.Provider,{value:h},e))}),LF=eN.forwardRef(({children:e,...t},r)=>{eN.useMemo(()=>dp({PositionPoint:LB}),[]);let i=eN.useRef(null);eN.useImperativeHandle(r,()=>i.current,[]);let{subscribe:n,getParent:a}=eN.useContext(LD);return eN.useLayoutEffect(()=>n(i),[]),eN.createElement("positionPoint",eU({instance:a(),instanceKey:i,ref:i},t),e)}),LO=eN.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:n=3,...a},s)=>{let o=eN.useRef(null);return eN.useImperativeHandle(s,()=>o.current,[]),dK(()=>{let e=o.current.geometry.attributes;e.position.needsUpdate=!0,r&&(e.color.needsUpdate=!0),i&&(e.size.needsUpdate=!0)}),eN.createElement("points",eU({ref:o},a),eN.createElement("bufferGeometry",null,eN.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/n,array:t,itemSize:n,usage:iU}),r&&eN.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/n,array:r,itemSize:3,usage:iU}),i&&eN.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/n,array:i,itemSize:1,usage:iU})),e)}),LU=eN.forwardRef((e,t)=>e.positions instanceof Float32Array?eN.createElement(LO,eU({},e,{ref:t})):eN.createElement(Lk,eU({},e,{ref:t}))),LN=eN.createContext(null),Lz=eN.forwardRef((e,t)=>{eN.useMemo(()=>dp({SegmentObject:LG}),[]);let{limit:r=1e3,lineWidth:i=1,children:n,...a}=e,[s,o]=eN.useState([]),[l]=eN.useState(()=>new xl),[u]=eN.useState(()=>new E0),[c]=eN.useState(()=>new EJ),[h]=eN.useState(()=>new nt(512,512)),[d]=eN.useState(()=>Array(6*r).fill(0)),[f]=eN.useState(()=>Array(6*r).fill(0)),p=eN.useMemo(()=>({subscribe:e=>(o(t=>[...t,e]),()=>o(t=>t.filter(t=>t.current!==e.current)))}),[]);return dK(()=>{for(let t=0;t<r;t++){var e;let r=null==(e=s[t])?void 0:e.current;r&&(d[6*t+0]=r.start.x,d[6*t+1]=r.start.y,d[6*t+2]=r.start.z,d[6*t+3]=r.end.x,d[6*t+4]=r.end.y,d[6*t+5]=r.end.z,f[6*t+0]=r.color.r,f[6*t+1]=r.color.g,f[6*t+2]=r.color.b,f[6*t+3]=r.color.r,f[6*t+4]=r.color.g,f[6*t+5]=r.color.b)}c.setColors(f),c.setPositions(d),l.computeLineDistances()}),eN.createElement("primitive",{object:l,ref:t},eN.createElement("primitive",{object:c,attach:"geometry"}),eN.createElement("primitive",eU({object:u,attach:"material",vertexColors:!0,resolution:h,linewidth:i},a)),eN.createElement(LN.Provider,{value:p},n))});class LG{constructor(){this.color=new aQ("white"),this.start=new ni(0,0,0),this.end=new ni(0,0,0)}}let LH=e=>e instanceof ni?e:new ni(..."number"==typeof e?[e,e,e]:e),LQ=eN.forwardRef(({color:e,start:t,end:r},i)=>{let n=eN.useContext(LN);if(!n)throw"Segment must used inside Segments component.";let a=eN.useRef(null);return eN.useImperativeHandle(i,()=>a.current,[]),eN.useLayoutEffect(()=>n.subscribe(a),[]),eN.createElement("segmentObject",{ref:a,color:e,start:LH(t),end:LH(r)})}),LV=eN.forwardRef(({children:e,hysteresis:t=0,distances:r,...i},n)=>{let a=eN.useRef(null);return eN.useImperativeHandle(n,()=>a.current,[]),eN.useLayoutEffect(()=>{let{current:e}=a;e.levels.length=0,e.children.forEach((i,n)=>e.levels.push({object:i,hysteresis:t,distance:r[n]}))}),dK(e=>{var t;return null==(t=a.current)?void 0:t.update(e.camera)}),eN.createElement("lOD",eU({ref:a},i),e)});function LW({all:e,scene:t,camera:r}){let i=dY(({gl:e})=>e),n=dY(({camera:e})=>e),a=dY(({scene:e})=>e);return eN.useLayoutEffect(()=>{let s=[];e&&(t||a).traverse(e=>{!1===e.visible&&(s.push(e),e.visible=!0)}),i.compile(t||a,r||n);let o=new sk(128);new sP(.01,1e5,o).update(i,t||a),o.dispose(),s.forEach(e=>e.visible=!1)},[]),null}function Lj(){let e=dY(e=>e.gl);return(0,eN.useEffect)(()=>(e.shadowMap.autoUpdate=!1,e.shadowMap.needsUpdate=!0,()=>{e.shadowMap.autoUpdate=e.shadowMap.needsUpdate=!0}),[e.shadowMap]),null}let LY=new n8,LK=new n6,Lq=new nJ,LX=new ni;function L$(e,t){let r=this.geometry,i=this.material,n=this.matrixWorld;void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),Lq.copy(r.boundingSphere),Lq.applyMatrix4(n),!1!==e.ray.intersectsSphere(Lq)&&(LY.copy(n).invert(),LK.copy(e.ray).applyMatrix4(LY),(null===r.boundingBox||null!==LK.intersectBox(r.boundingBox,LX))&&t.push({distance:LX.distanceTo(e.ray.origin),point:LX.clone(),object:this})))}function LJ({pixelated:e}){let t=dY(e=>e.gl),r=dY(e=>e.internal.active),i=dY(e=>e.performance.current),n=dY(e=>e.viewport.initialDpr),a=dY(e=>e.setDpr);return eN.useEffect(()=>{let i=t.domElement;return()=>{r&&a(n),e&&i&&(i.style.imageRendering="auto")}},[]),eN.useEffect(()=>{a(i*n),e&&t.domElement&&(t.domElement.style.imageRendering=1===i?"auto":"pixelated")},[i]),null}function LZ(){let e=dY(e=>e.get),t=dY(e=>e.setEvents),r=dY(e=>e.performance.current);return eN.useEffect(()=>{let r=e().events.enabled;return()=>t({enabled:r})},[]),eN.useEffect(()=>t({enabled:1===r}),[r]),null}let L0=(0,eN.createContext)(null);function L1({iterations:e=10,ms:t=250,threshold:r=.75,step:i=.1,factor:n=.5,flipflops:a=1/0,bounds:s=e=>e>100?[60,100]:[40,60],onIncline:o,onDecline:l,onChange:u,onFallback:c,children:h}){let[d,f]=(0,eN.useState)(()=>({fps:0,index:0,factor:n,flipped:0,refreshrate:0,fallback:!1,frames:[],averages:[],subscriptions:new Map,subscribe:e=>{let t=Symbol();return d.subscriptions.set(t,e.current),()=>void d.subscriptions.delete(t)}})),p=0;return dK(()=>{let{frames:n,averages:h}=d;if(!d.fallback&&h.length<e){n.push(performance.now());let f=n[n.length-1]-n[0];if(f>=t){if(d.fps=Math.round(n.length/f*1e3)/1,d.refreshrate=Math.max(d.refreshrate,d.fps),h[d.index++%e]=d.fps,h.length===e){let[t,n]=s(d.refreshrate),f=h.filter(e=>e>=n),m=h.filter(e=>e<t);f.length>e*r&&(d.factor=Math.min(1,d.factor+i),d.flipped++,o&&o(d),d.subscriptions.forEach(e=>e.onIncline&&e.onIncline(d))),m.length>e*r&&(d.factor=Math.max(0,d.factor-i),d.flipped++,l&&l(d),d.subscriptions.forEach(e=>e.onDecline&&e.onDecline(d))),p!==d.factor&&(p=d.factor,u&&u(d),d.subscriptions.forEach(e=>e.onChange&&e.onChange(d))),d.flipped>a&&!d.fallback&&(d.fallback=!0,c&&c(d),d.subscriptions.forEach(e=>e.onFallback&&e.onFallback(d))),d.averages=[]}d.frames=[]}}}),eN.createElement(L0.Provider,{value:d},h)}function L2({onIncline:e,onDecline:t,onChange:r,onFallback:i}){let n=(0,eN.useContext)(L0),a=(0,eN.useRef)({onIncline:e,onDecline:t,onChange:r,onFallback:i});(0,eN.useLayoutEffect)(()=>{a.current.onIncline=e,a.current.onDecline=t,a.current.onChange=r,a.current.onFallback=i},[e,t,r,i]),(0,eN.useLayoutEffect)(()=>n.subscribe(a),[n])}let L3=eN.forwardRef(({children:e,compute:t,width:r,height:i,samples:n=8,renderPriority:a=0,eventPriority:s=0,frames:o=1/0,stencilBuffer:l=!1,depthBuffer:u=!0,generateMipmaps:c=!1,...h},d)=>{let{size:f,viewport:p}=dY(),m=SX((r||f.width)*p.dpr,(i||f.height)*p.dpr,{samples:n,stencilBuffer:l,depthBuffer:u,generateMipmaps:c}),[g]=eN.useState(()=>new sG),A=eN.useCallback((e,t,r)=>{var i,n;let a=null==(i=m.texture)?void 0:i.__r3f.parent;for(;a&&!(a instanceof aS);)a=a.__r3f.parent;if(!a)return!1;r.raycaster.camera||r.events.compute(e,r,null==(n=r.previousRoot)?void 0:n.getState());let[s]=r.raycaster.intersectObject(a);if(!s)return!1;let o=s.uv;if(!o)return!1;t.raycaster.setFromCamera(t.pointer.set(2*o.x-1,2*o.y-1),t.camera)},[]);return eN.useImperativeHandle(d,()=>m.texture,[m]),eN.createElement(eN.Fragment,null,d2(eN.createElement(L4,{renderPriority:a,frames:o,fbo:m},e,eN.createElement("group",{onPointerOver:()=>null})),g,{events:{compute:t||A,priority:s}}),eN.createElement("primitive",eU({object:m.texture},h)))});function L4({frames:e,renderPriority:t,children:r,fbo:i}){let n,a,s,o,l=0;return dK(t=>{(e===1/0||l<e)&&(n=t.gl.autoClear,a=t.gl.xr.enabled,s=t.gl.getRenderTarget(),o=t.gl.xr.isPresenting,t.gl.autoClear=!0,t.gl.xr.enabled=!1,t.gl.xr.isPresenting=!1,t.gl.setRenderTarget(i),t.gl.render(t.scene,t.camera),t.gl.setRenderTarget(s),t.gl.autoClear=n,t.gl.xr.enabled=a,t.gl.xr.isPresenting=o,l++)},t),eN.createElement(eN.Fragment,null,r)}let L5=eN.forwardRef(({children:e,compute:t,renderPriority:r=-1,eventPriority:i=0,frames:n=1/0,stencilBuffer:a=!1,depthBuffer:s=!0,generateMipmaps:o=!1,resolution:l=896,near:u=.1,far:c=1e3,flip:h=!1,position:d,rotation:f,scale:p,quaternion:m,matrix:g,matrixAutoUpdate:A,...v},y)=>{let{size:E,viewport:x}=dY(),_=eN.useRef(null),b=eN.useMemo(()=>{let e=new sk(Math.max((l||E.width)*x.dpr,(l||E.height)*x.dpr),{stencilBuffer:a,depthBuffer:s,generateMipmaps:o});return e.texture.isRenderTargetTexture=!h,e.texture.flipY=!0,e.texture.type=rt,e},[l,h]);eN.useEffect(()=>()=>b.dispose(),[b]);let[S]=eN.useState(()=>new sG);return eN.useImperativeHandle(y,()=>({scene:S,fbo:b,camera:_.current}),[b]),eN.createElement(eN.Fragment,null,d2(eN.createElement(L6,{renderPriority:r,frames:n,camera:_},e,eN.createElement("group",{onPointerOver:()=>null})),S,{events:{compute:t,priority:i}}),eN.createElement("primitive",eU({object:b.texture},v)),eN.createElement("cubeCamera",{ref:_,args:[u,c,b],position:d,rotation:f,scale:p,quaternion:m,matrix:g,matrixAutoUpdate:A}))});function L6({frames:e,renderPriority:t,children:r,camera:i}){let n=0;return dK(t=>{(e===1/0||n<e)&&(i.current.update(t.gl,t.scene),n++)},t),eN.createElement(eN.Fragment,null,r)}let L8=eN.forwardRef(({id:e=1,colorWrite:t=!1,depthWrite:r=!1,...i},n)=>{let a=eN.useRef(null),s=eN.useMemo(()=>({colorWrite:t,depthWrite:r,stencilWrite:!0,stencilRef:e,stencilFunc:iI,stencilFail:im,stencilZFail:im,stencilZPass:im}),[e,t,r]);return eN.useLayoutEffect(()=>{Object.assign(a.current.material,s)}),eN.useImperativeHandle(n,()=>a.current,[]),eN.createElement("mesh",eU({ref:a,renderOrder:-e},i))});function L9(e,t=!1){return{stencilWrite:!0,stencilRef:e,stencilFunc:t?iC:ib,stencilFail:ip,stencilZFail:ip,stencilZPass:ip}}function L7({renderPriority:e=1,zoom:t=0,segments:r=64,children:i,resolution:n=896,...a}){let s=eN.useRef(null),o=eN.useRef(null),{width:l,height:u}=dY(e=>e.size),[c]=eN.useState(()=>new cv);eN.useLayoutEffect(()=>{c.position.set(0,0,100),c.zoom=100,c.left=-(l/2),c.right=l/2,c.top=u/2,c.bottom=-(u/2),c.updateProjectionMatrix()},[l,u]);let h=Math.sqrt(l*l+u*u)/100*(.5+t/2),d=new ni,f=new nJ(new ni,h),p=new ns,m=eN.useCallback((e,t,r)=>{t.pointer.set(e.offsetX/t.size.width*2-1,-(2*(e.offsetY/t.size.height))+1),t.raycaster.setFromCamera(t.pointer,c),t.raycaster.ray.intersectSphere(f,d)&&(d.normalize(),p.getNormalMatrix(o.current.camera.matrixWorld),o.current.camera.getWorldPosition(t.raycaster.ray.origin),t.raycaster.ray.direction.set(0,0,1).reflect(d),t.raycaster.ray.direction.x*=-1,t.raycaster.ray.direction.applyNormalMatrix(p).multiplyScalar(-1))},[]);return dK(t=>{e&&t.gl.render(s.current,c)},e),eN.createElement(eN.Fragment,null,eN.createElement("mesh",eU({ref:s},a,{scale:h}),eN.createElement("sphereGeometry",{args:[1,r,r]}),eN.createElement("meshBasicMaterial",null,eN.createElement(L5,{compute:m,attach:"envMap",flip:!0,resolution:n,ref:o},i,eN.createElement(ke,{api:o})))))}function ke({api:e}){let t=new ni,r=new nr,i=new ni,n=new ao(0,Math.PI,0);return dK(a=>{a.camera.matrixWorld.decompose(t,r,i),e.current.camera.position.copy(t),e.current.camera.quaternion.setFromEuler(n).premultiply(r)}),null}let kt=be({blur:0,map:null,sdf:null,blend:0,size:0,resolution:new nt},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
     vUv = uv;
   }`,`uniform sampler2D sdf;
   uniform sampler2D map;
   uniform float blur;
   uniform float size;
   uniform float time;
   uniform vec2 resolution;
   varying vec2 vUv;
   #include <packing>
   void main() {
     vec2 uv = gl_FragCoord.xy / resolution.xy;
     vec4 t = texture2D(map, uv);
     float k = blur;
     float d = texture2D(sdf, vUv).r/size;
     float alpha = 1.0 - smoothstep(0.0, 1.0, clamp(d/k + 1.0, 0.0, 1.0));
     gl_FragColor = vec4(t.rgb, blur == 0.0 ? t.a : t.a * alpha);
     #include <tonemapping_fragment>
     #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),kr=eN.forwardRef(({children:e,events:t,blur:r=0,eventPriority:i=0,renderPriority:n=0,worldUnits:a=!1,resolution:s=512,...o},l)=>{dp({PortalMaterialImpl:kt});let u=eN.useRef(null),{scene:c,gl:h,size:d,viewport:f,setEvents:p}=dY(),m=SX(s,s),[g,A]=eN.useState(0);dK(()=>{let e=u.current.blend>0?Math.max(1,n):0;g!==e&&A(e)}),eN.useEffect(()=>{void 0!==t&&p({enabled:!t})},[t]);let[v,y]=eN.useState(!0),E=R1(y);eN.useLayoutEffect(()=>{var e;E.current=null==(e=u.current)?void 0:e.__r3f.parent},[]),eN.useLayoutEffect(()=>{if(E.current&&r&&null===u.current.sdf){let e=new sE(E.current.geometry,new aY),t=new nL().setFromBufferAttribute(e.geometry.attributes.position),r=new cv(t.min.x*(1+2/s),t.max.x*(1+2/s),t.max.y*(1+2/s),t.min.y*(1+2/s),.1,1e3);r.position.set(0,0,1),r.lookAt(0,0,0),h.setRenderTarget(m),h.render(e,r);let i=kn(s,s,h)(m.texture),n=new Float32Array(s*s);h.readRenderTargetPixels(i,0,0,s,s,n);let a=1/0;for(let e=0;e<n.length;e++)n[e]<a&&(a=n[e]);a=-a,u.current.size=a,u.current.sdf=i.texture,h.setRenderTarget(null)}},[s,r]),eN.useImperativeHandle(l,()=>u.current);let x=eN.useCallback((e,t,r)=>{var i;if(!E.current)return!1;if(t.pointer.set(e.offsetX/t.size.width*2-1,-(2*(e.offsetY/t.size.height))+1),t.raycaster.setFromCamera(t.pointer,t.camera),(null==(i=u.current)?void 0:i.blend)===0){let[e]=t.raycaster.intersectObject(E.current);if(!e)return t.raycaster.camera=void 0,!1}},[]);return eN.createElement("portalMaterialImpl",eU({ref:u,blur:r,blend:0,resolution:[d.width*f.dpr,d.height*f.dpr],attach:"material"},o),eN.createElement(L3,{attach:"map",frames:v?1/0:0,eventPriority:i,renderPriority:n,compute:x},e,eN.createElement(ki,{events:t,rootScene:c,priority:g,material:u,worldUnits:a})))});function ki({events:e,rootScene:t,material:r,priority:i,worldUnits:n}){let a=dY(e=>e.scene),s=dY(e=>e.setEvents),o=SX(),l=SX();eN.useLayoutEffect(()=>{a.matrixAutoUpdate=!1},[]),eN.useEffect(()=>{void 0!==e&&s({enabled:e})},[e]);let[u,c]=eN.useMemo(()=>{let e={value:0};return[new _G(new sT({uniforms:{a:{value:o.texture},b:{value:l.texture},blend:e},vertexShader:`
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
          }`,fragmentShader:`
          uniform sampler2D a;
          uniform sampler2D b;
          uniform float blend;
          varying vec2 vUv;
          #include <packing>
          void main() {
            vec4 ta = texture2D(a, vUv);
            vec4 tb = texture2D(b, vUv);
            gl_FragColor = mix(tb, ta, blend);
            #include <tonemapping_fragment>
            #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
          }`})),e]},[]);return dK(e=>{var s,h,d,f,p;let m=null==r||null==(s=r.current)?void 0:s.__r3f.parent;m&&(n?a.matrixWorld.identity():(i&&(null==(h=r.current)?void 0:h.blend)===1&&m.updateWorldMatrix(!0,!1),a.matrixWorld.copy(m.matrixWorld)),i&&((null==(d=r.current)?void 0:d.blend)>0&&(null==(f=r.current)?void 0:f.blend)<1?(c.value=r.current.blend,e.gl.setRenderTarget(o),e.gl.render(a,e.camera),e.gl.setRenderTarget(l),e.gl.render(t,e.camera),e.gl.setRenderTarget(null),u.render(e.gl)):(null==(p=r.current)?void 0:p.blend)===1&&e.gl.render(a,e.camera)))},i),eN.createElement(eN.Fragment,null)}let kn=(e,t,r)=>{let i=new nM(e,t,{minFilter:t2,magFilter:tZ,type:re,format:rd,generateMipmaps:!0}),n=new nM(e,t,{minFilter:tK,magFilter:tK}),a=new nM(e,t,{minFilter:tK,magFilter:tK}),s=new nM(e,t,{minFilter:tK,magFilter:tK}),o=new nM(e,t,{minFilter:tK,magFilter:tK}),l=new nM(e,t,{minFilter:tK,magFilter:tK,type:re,format:rd}),u=new nM(e,t,{minFilter:tK,magFilter:tK,type:re,format:rd}),c=new _G(new sT({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (round(texture2D(tex, vUv).x)));
        }`})),h=new _G(new sT({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (1.0 - round(texture2D(tex, vUv).x)));
        }`})),d=new _G(new sT({uniforms:{tex:{value:null},offset:{value:0},level:{value:0},maxSteps:{value:0}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform float offset;
        uniform float level;
        uniform float maxSteps;
        #include <packing>
        void main() {
          float closestDist = 9999999.9;
          vec2 closestPos = vec2(0.0);
          for (float x = -1.0; x <= 1.0; x += 1.0) {
            for (float y = -1.0; y <= 1.0; y += 1.0) {
              vec2 voffset = vUv;
              voffset += vec2(x, y) * vec2(${1/e}, ${1/t}) * offset;
              vec2 pos = unpackRGBATo2Half(texture2D(tex, voffset));
              float dist = distance(pos.xy, vUv);
              if(pos.x != 0.0 && pos.y != 0.0 && dist < closestDist) {
                closestDist = dist;
                closestPos = pos;
              }
            }
          }
          gl_FragColor = pack2HalfToRGBA(closestPos);
        }`})),f=new _G(new sT({uniforms:{tex:{value:null},size:{value:new nt(e,t)}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform vec2 size;
        #include <packing>
        void main() {
          gl_FragColor = vec4(distance(size * unpackRGBATo2Half(texture2D(tex, vUv)), size * vUv), 0.0, 0.0, 0.0);
        }`})),p=new _G(new sT({uniforms:{inside:{value:u.texture},outside:{value:l.texture},tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D inside;
        uniform sampler2D outside;
        uniform sampler2D tex;
        #include <packing>
        void main() {
          float i = texture2D(inside, vUv).x;
          float o =texture2D(outside, vUv).x;
          if (texture2D(tex, vUv).x == 0.0) {
            gl_FragColor = vec4(o, 0.0, 0.0, 0.0);
          } else {
            gl_FragColor = vec4(-i, 0.0, 0.0, 0.0);
          }
        }`}));return m=>{m.minFilter=tK,m.magFilter=tK,c.material.uniforms.tex.value=m,r.setRenderTarget(n),c.render(r);let g=Math.ceil(Math.log(Math.max(e,t))/Math.log(2)),A=n,v=null;for(let e=0;e<g;e++){let t=Math.pow(2,g-e-1);v=A===n?s:n,d.material.uniforms.level.value=e,d.material.uniforms.maxSteps.value=g,d.material.uniforms.offset.value=t,d.material.uniforms.tex.value=A.texture,r.setRenderTarget(v),d.render(r),A=v}r.setRenderTarget(l),f.material.uniforms.tex.value=v.texture,f.render(r),h.material.uniforms.tex.value=m,r.setRenderTarget(a),h.render(r),A=a;for(let e=0;e<g;e++){let t=Math.pow(2,g-e-1);v=A===a?o:a,d.material.uniforms.level.value=e,d.material.uniforms.maxSteps.value=g,d.material.uniforms.offset.value=t,d.material.uniforms.tex.value=A.texture,r.setRenderTarget(v),d.render(r),A=v}return r.setRenderTarget(u),f.material.uniforms.tex.value=v.texture,f.render(r),r.setRenderTarget(i),p.material.uniforms.tex.value=m,p.render(r),r.setRenderTarget(null),i}},ka=e=>{let t;let r=new Set,i=(e,i)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=i?i:"object"!=typeof n||null===n)?n:Object.assign({},t,n),r.forEach(r=>r(t,e))}},n=()=>t,a={setState:i,getState:n,getInitialState:()=>s,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},s=t=e(i,n,a);return a},ks=e=>e?ka(e):ka;var ko=r(73450);let{useDebugValue:kl}=eN,{useSyncExternalStoreWithSelector:ku}=ko,kc=!1,kh=e=>e,kd=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?ks(e):e,r=(e,r)=>(function(e,t=kh,r){r&&!kc&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),kc=!0);let i=ku(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return kl(i),i})(t,e,r);return Object.assign(r,t),r},kf=e=>e?kd(e):kd,kp="undefined"!=typeof window&&(null!=(ek=window.document)&&ek.createElement||(null==(eF=window.navigator)?void 0:eF.product)==="ReactNative")?ez().useLayoutEffect:ez().useEffect,km=e=>e&&e.isOrthographicCamera,kg=new aQ,kA=function(){let e=kf(e=>({current:[],version:0,set:e}));return{In:({children:t})=>{let r=e(e=>e.set),i=e(e=>e.version);return kp(()=>{r(e=>({version:e.version+1}))},[]),kp(()=>(r(({current:e})=>({current:[...e,t]})),()=>r(({current:e})=>({current:e.filter(e=>e!==t)}))),[t,i]),null},Out:()=>{let t=e(e=>e.current);return ez().createElement(ez().Fragment,null,t)}}}();function kv(e,t){let{right:r,top:i,left:n,bottom:a,width:s,height:o}=t,l=t.bottom<0||i>e.height||r<0||t.left>e.width;if("top"in e){let t=e.top+e.height;return{position:{width:s,height:o,left:n-e.left,top:i,bottom:t-a,right:r},isOffscreen:l}}return{position:{width:s,height:o,top:i,left:n,bottom:e.height-a,right:r},isOffscreen:l}}function ky(e,{left:t,bottom:r,width:i,height:n}){let a;let s=i/n;return km(e.camera)?e.camera.manual?e.camera.updateProjectionMatrix():(e.camera.left!==-(i/2)||e.camera.right!==i/2||e.camera.top!==n/2||e.camera.bottom!==-(n/2))&&(Object.assign(e.camera,{left:-(i/2),right:i/2,top:n/2,bottom:-(n/2)}),e.camera.updateProjectionMatrix()):e.camera.aspect!==s&&(e.camera.aspect=s,e.camera.updateProjectionMatrix()),a=e.gl.autoClear,e.gl.autoClear=!1,e.gl.setViewport(t,r,i,n),e.gl.setScissor(t,r,i,n),e.gl.setScissorTest(!0),a}function kE(e,t){e.gl.setScissorTest(!1),e.gl.autoClear=t}function kx(e){e.gl.getClearColor(kg),e.gl.setClearColor(kg,e.gl.getClearAlpha()),e.gl.clear(!0,!0)}function k_({visible:e=!0,canvasSize:t,scene:r,index:i,children:n,frames:a,rect:s,track:o}){let l=dY(),[u,c]=eN.useState(!1),h=0;return dK(i=>{if(a===1/0||h<=a){var l;o&&(s.current=null==(l=o.current)?void 0:l.getBoundingClientRect()),h++}if(s.current){let{position:a,isOffscreen:o}=kv(t,s.current);if(u!==o&&c(o),e&&!u&&s.current){let e=ky(i,a);i.gl.render(n?i.scene:r,i.camera),kE(i,e)}}},i),eN.useLayoutEffect(()=>{let r=s.current;if(r&&(!e||!u)){let{position:e}=kv(t,r),i=ky(l,e);kx(l),kE(l,i)}},[e,u]),eN.useEffect(()=>{if(!o)return;let e=s.current,r=l.get().events.connected;return l.setEvents({connected:o.current}),()=>{if(e){let{position:r}=kv(t,e),i=ky(l,r);kx(l),kE(l,i)}l.setEvents({connected:r})}},[o]),eN.useEffect(()=>{"top"in t||console.warn("Detected @react-three/fiber canvas size does not include position information. <View /> may not work as expected. Upgrade to @react-three/fiber ^8.1.0 for support.\n See https://github.com/pmndrs/drei/issues/944")},[]),eN.createElement(eN.Fragment,null,n,eN.createElement("group",{onPointerOver:()=>null}))}let kb=eN.forwardRef(({track:e,visible:t=!0,index:r=1,id:i,style:n,className:a,frames:s=1/0,children:o,...l},u)=>{var c,h,d,f;let p=eN.useRef(null),{size:m,scene:g}=dY(),[A]=eN.useState(()=>new sG),[v,y]=eN.useReducer(()=>!0,!1),E=eN.useCallback((t,r)=>{if(p.current&&e&&e.current&&t.target===e.current){let{width:e,height:i,left:n,top:a}=p.current,s=t.clientX-n,o=t.clientY-a;r.pointer.set(s/e*2-1,-(o/i*2)+1),r.raycaster.setFromCamera(r.pointer,r.camera)}},[p,e]);return eN.useEffect(()=>{var t;e&&(p.current=null==(t=e.current)?void 0:t.getBoundingClientRect()),y()},[e]),eN.createElement("group",eU({ref:u},l),v&&d2(eN.createElement(k_,{visible:t,canvasSize:m,frames:s,scene:g,track:e,rect:p,index:r},o),A,{events:{compute:E,priority:r},size:{width:null==(c=p.current)?void 0:c.width,height:null==(h=p.current)?void 0:h.height,top:null==(d=p.current)?void 0:d.top,left:null==(f=p.current)?void 0:f.left}}))}),kS=eN.forwardRef(({as:e="div",id:t,visible:r,className:i,style:n,index:a=1,track:s,frames:o=1/0,children:l,...u},c)=>{let h=eN.useId(),d=eN.useRef(null);return eN.useImperativeHandle(c,()=>d.current),eN.createElement(eN.Fragment,null,eN.createElement(e,eU({ref:d,id:t,className:i,style:n},u)),eN.createElement(kA.In,null,eN.createElement(kb,{visible:r,key:h,track:d,frames:o,index:a},l)))}),kw=(()=>{let e=eN.forwardRef((e,t)=>eN.useContext(dF)?eN.createElement(kb,eU({ref:t},e)):eN.createElement(kS,eU({ref:t},e)));return e.Port=()=>eN.createElement(kA.Out,null),e})(),kC=eN.createContext(null),kT=new ni,kI=new ni,kM=(e,t,r,i)=>{let n=t.dot(t),a=t.dot(e)-t.dot(r),s=t.dot(i);return 0===s?-a/n:(kT.copy(i).multiplyScalar(n/s).sub(t),kI.copy(i).multiplyScalar(a/s).add(r).sub(e),-kT.dot(kI)/kT.dot(kT))},kR=new ni(0,1,0),kB=new n8,kD=({direction:e,axis:t})=>{let{translation:r,translationLimits:i,annotations:n,annotationsClass:a,depthTest:s,scale:o,lineWidth:l,fixed:u,axisColors:c,hoveredColor:h,opacity:d,onDragStart:f,onDrag:p,onDragEnd:m,userData:g}=eN.useContext(kC),A=dY(e=>e.controls),v=eN.useRef(null),y=eN.useRef(null),E=eN.useRef(null),x=eN.useRef(0),[_,b]=eN.useState(!1),S=eN.useCallback(i=>{n&&(v.current.innerText=`${r.current[t].toFixed(2)}`,v.current.style.display="block"),i.stopPropagation();let a=new n8().extractRotation(y.current.matrixWorld),s=i.point.clone(),o=new ni().setFromMatrixPosition(y.current.matrixWorld),l=e.clone().applyMatrix4(a).normalize();E.current={clickPoint:s,dir:l},x.current=r.current[t],f({component:"Arrow",axis:t,origin:o,directions:[l]}),A&&(A.enabled=!1),i.target.setPointerCapture(i.pointerId)},[n,e,A,f,r,t]),w=eN.useCallback(e=>{if(e.stopPropagation(),_||b(!0),E.current){let{clickPoint:a,dir:s}=E.current,[o,l]=(null==i?void 0:i[t])||[void 0,void 0],u=kM(a,s,e.ray.origin,e.ray.direction);void 0!==o&&(u=Math.max(u,o-x.current)),void 0!==l&&(u=Math.min(u,l-x.current)),r.current[t]=x.current+u,n&&(v.current.innerText=`${r.current[t].toFixed(2)}`),kB.makeTranslation(s.x*u,s.y*u,s.z*u),p(kB)}},[n,p,_,r,i,t]),C=eN.useCallback(e=>{n&&(v.current.style.display="none"),e.stopPropagation(),E.current=null,m(),A&&(A.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[n,A,m]),T=eN.useCallback(e=>{e.stopPropagation(),b(!1)},[]),{cylinderLength:I,coneWidth:M,coneLength:R,matrixL:B}=eN.useMemo(()=>{let t=u?l/o*1.6:o/20,r=u?.2:o/5,i=u?1-r:o-r,n=new nr().setFromUnitVectors(kR,e.clone().normalize());return{cylinderLength:i,coneWidth:t,coneLength:r,matrixL:new n8().makeRotationFromQuaternion(n)}},[e,o,l,u]),D=_?h:c[t];return eN.createElement("group",{ref:y},eN.createElement("group",{matrix:B,matrixAutoUpdate:!1,onPointerDown:S,onPointerMove:w,onPointerUp:C,onPointerOut:T},n&&eN.createElement(fi,{position:[0,-R,0]},eN.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:a,ref:v})),eN.createElement("mesh",{visible:!1,position:[0,(I+R)/2,0],userData:g},eN.createElement("cylinderGeometry",{args:[1.4*M,1.4*M,I+R,8,1]})),eN.createElement(xu,{transparent:!0,raycast:()=>null,depthTest:s,points:[0,0,0,0,I,0],lineWidth:l,side:e1,color:D,opacity:d,polygonOffset:!0,renderOrder:1,polygonOffsetFactor:-10,fog:!1}),eN.createElement("mesh",{raycast:()=>null,position:[0,I+R/2,0],renderOrder:500},eN.createElement("coneGeometry",{args:[M,R,24,1]}),eN.createElement("meshBasicMaterial",{transparent:!0,depthTest:s,color:D,opacity:d,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))))},kP=new ni,kL=new ni,kk=e=>180*e/Math.PI,kF=e=>e*Math.PI/180,kO=(e,t,r,i,n)=>{kP.copy(e).sub(r),kL.copy(t).sub(r);let a=i.dot(i),s=n.dot(n),o=kP.dot(i)/a,l=kP.dot(n)/s,u=kL.dot(i)/a;return Math.atan2(kL.dot(n)/s,u)-Math.atan2(l,o)},kU=(e,t)=>{let r=Math.floor(e/t);return e-(r=r<0?r+1:r)*t},kN=e=>{let t=kU(e,2*Math.PI);return 1e-6>Math.abs(t)?0:(t<0&&(t+=2*Math.PI),t)},kz=new n8,kG=new ni,kH=new n6,kQ=new ni,kV=({dir1:e,dir2:t,axis:r})=>{let{rotationLimits:i,annotations:n,annotationsClass:a,depthTest:s,scale:o,lineWidth:l,fixed:u,axisColors:c,hoveredColor:h,opacity:d,onDragStart:f,onDrag:p,onDragEnd:m,userData:g}=eN.useContext(kC),A=dY(e=>e.controls),v=eN.useRef(null),y=eN.useRef(null),E=eN.useRef(0),x=eN.useRef(0),_=eN.useRef(null),[b,S]=eN.useState(!1),w=eN.useCallback(e=>{n&&(v.current.innerText=`${kk(x.current).toFixed(0)}\xba`,v.current.style.display="block"),e.stopPropagation();let t=e.point.clone(),i=new ni().setFromMatrixPosition(y.current.matrixWorld),a=new ni().setFromMatrixColumn(y.current.matrixWorld,0).normalize(),s=new ni().setFromMatrixColumn(y.current.matrixWorld,1).normalize(),o=new ni().setFromMatrixColumn(y.current.matrixWorld,2).normalize(),l=new oC().setFromNormalAndCoplanarPoint(o,i);_.current={clickPoint:t,origin:i,e1:a,e2:s,normal:o,plane:l},f({component:"Rotator",axis:r,origin:i,directions:[a,s,o]}),A&&(A.enabled=!1),e.target.setPointerCapture(e.pointerId)},[n,A,f,r]),C=eN.useCallback(e=>{if(e.stopPropagation(),b||S(!0),_.current){let{clickPoint:t,origin:a,e1:s,e2:o,normal:l,plane:u}=_.current,[c,h]=(null==i?void 0:i[r])||[void 0,void 0];kH.copy(e.ray),kH.intersectPlane(u,kQ),kH.direction.negate(),kH.intersectPlane(u,kQ);let d=kO(t,kQ,a,s,o),f=kk(d);e.shiftKey&&(d=kF(f=10*Math.round(f/10))),void 0!==c&&void 0!==h&&h-c<2*Math.PI?(d=(d=kN(d))>Math.PI?d-2*Math.PI:d,d=ne.clamp(d,c-E.current,h-E.current),x.current=E.current+d):(x.current=kN(E.current+d),x.current=x.current>Math.PI?x.current-2*Math.PI:x.current),n&&(f=kk(x.current),v.current.innerText=`${f.toFixed(0)}\xba`),kz.makeRotationAxis(l,d),kG.copy(a).applyMatrix4(kz).sub(a).negate(),kz.setPosition(kG),p(kz)}},[n,p,b,i,r]),T=eN.useCallback(e=>{n&&(v.current.style.display="none"),e.stopPropagation(),E.current=x.current,_.current=null,m(),A&&(A.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[n,A,m]),I=eN.useCallback(e=>{e.stopPropagation(),S(!1)},[]),M=eN.useMemo(()=>{let r=e.clone().normalize(),i=t.clone().normalize();return new n8().makeBasis(r,i,r.clone().cross(i))},[e,t]),R=u?.65:.65*o,B=eN.useMemo(()=>{let e=[];for(let t=0;t<=32;t++){let r=Math.PI/2*t/32;e.push(new ni(Math.cos(r)*R,Math.sin(r)*R,0))}return e},[R]);return eN.createElement("group",{ref:y,onPointerDown:w,onPointerMove:C,onPointerUp:T,onPointerOut:I,matrix:M,matrixAutoUpdate:!1},n&&eN.createElement(fi,{position:[R,R,0]},eN.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:a,ref:v})),eN.createElement(xu,{points:B,lineWidth:4*l,visible:!1,userData:g}),eN.createElement(xu,{transparent:!0,raycast:()=>null,depthTest:s,points:B,lineWidth:l,side:e1,color:b?h:c[r],opacity:d,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))},kW=(e,t,r)=>{let i=Math.abs(e.x)>=Math.abs(e.y)&&Math.abs(e.x)>=Math.abs(e.z)?0:Math.abs(e.y)>=Math.abs(e.x)&&Math.abs(e.y)>=Math.abs(e.z)?1:2,n=[0,1,2].sort((e,r)=>Math.abs(t.getComponent(r))-Math.abs(t.getComponent(e))),a=i===n[0]?n[1]:n[0],s=e.getComponent(i),o=e.getComponent(a),l=t.getComponent(i),u=t.getComponent(a),c=r.getComponent(i),h=(r.getComponent(a)-o/s*c)/(u-o/s*l);return[(c-h*l)/s,h]},kj=new n6,kY=new ni,kK=new n8,kq=({dir1:e,dir2:t,axis:r})=>{let{translation:i,translationLimits:n,annotations:a,annotationsClass:s,depthTest:o,scale:l,lineWidth:u,fixed:c,axisColors:h,hoveredColor:d,opacity:f,onDragStart:p,onDrag:m,onDragEnd:g,userData:A}=eN.useContext(kC),v=dY(e=>e.controls),y=eN.useRef(null),E=eN.useRef(null),x=eN.useRef(null),_=eN.useRef(0),b=eN.useRef(0),[S,w]=eN.useState(!1),C=eN.useCallback(e=>{a&&(y.current.innerText=`${i.current[(r+1)%3].toFixed(2)}, ${i.current[(r+2)%3].toFixed(2)}`,y.current.style.display="block"),e.stopPropagation();let t=e.point.clone(),n=new ni().setFromMatrixPosition(E.current.matrixWorld),s=new ni().setFromMatrixColumn(E.current.matrixWorld,0).normalize(),o=new ni().setFromMatrixColumn(E.current.matrixWorld,1).normalize(),l=new ni().setFromMatrixColumn(E.current.matrixWorld,2).normalize(),u=new oC().setFromNormalAndCoplanarPoint(l,n);x.current={clickPoint:t,e1:s,e2:o,plane:u},_.current=i.current[(r+1)%3],b.current=i.current[(r+2)%3],p({component:"Slider",axis:r,origin:n,directions:[s,o,l]}),v&&(v.enabled=!1),e.target.setPointerCapture(e.pointerId)},[a,v,p,r]),T=eN.useCallback(e=>{if(e.stopPropagation(),S||w(!0),x.current){let{clickPoint:t,e1:s,e2:o,plane:l}=x.current,[u,c]=(null==n?void 0:n[(r+1)%3])||[void 0,void 0],[h,d]=(null==n?void 0:n[(r+2)%3])||[void 0,void 0];kj.copy(e.ray),kj.intersectPlane(l,kY),kj.direction.negate(),kj.intersectPlane(l,kY),kY.sub(t);let[f,p]=kW(s,o,kY);void 0!==u&&(f=Math.max(f,u-_.current)),void 0!==c&&(f=Math.min(f,c-_.current)),void 0!==h&&(p=Math.max(p,h-b.current)),void 0!==d&&(p=Math.min(p,d-b.current)),i.current[(r+1)%3]=_.current+f,i.current[(r+2)%3]=b.current+p,a&&(y.current.innerText=`${i.current[(r+1)%3].toFixed(2)}, ${i.current[(r+2)%3].toFixed(2)}`),kK.makeTranslation(f*s.x+p*o.x,f*s.y+p*o.y,f*s.z+p*o.z),m(kK)}},[a,m,S,i,n,r]),I=eN.useCallback(e=>{a&&(y.current.style.display="none"),e.stopPropagation(),x.current=null,g(),v&&(v.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[a,v,g]),M=eN.useCallback(e=>{e.stopPropagation(),w(!1)},[]),R=eN.useMemo(()=>{let r=e.clone().normalize(),i=t.clone().normalize();return new n8().makeBasis(r,i,r.clone().cross(i))},[e,t]),B=c?1/7:l/7,D=c?.225:.225*l,P=S?d:h[r],L=eN.useMemo(()=>[new ni(0,0,0),new ni(0,D,0),new ni(D,D,0),new ni(D,0,0),new ni(0,0,0)],[D]);return eN.createElement("group",{ref:E,matrix:R,matrixAutoUpdate:!1},a&&eN.createElement(fi,{position:[0,0,0]},eN.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:s,ref:y})),eN.createElement("group",{position:[1.7*B,1.7*B,0]},eN.createElement("mesh",{visible:!0,onPointerDown:C,onPointerMove:T,onPointerUp:I,onPointerOut:M,scale:D,userData:A},eN.createElement("planeGeometry",null),eN.createElement("meshBasicMaterial",{transparent:!0,depthTest:o,color:P,polygonOffset:!0,polygonOffsetFactor:-10,side:e1,fog:!1})),eN.createElement(xu,{position:[-D/2,-D/2,0],transparent:!0,depthTest:o,points:L,lineWidth:u,color:P,opacity:f,polygonOffset:!0,polygonOffsetFactor:-10,userData:A,fog:!1})))},kX=new ni,k$=new ni,kJ=(e,t,r,i)=>{let n=t.dot(t),a=t.dot(e)-t.dot(r),s=t.dot(i);return 0===s?-a/n:(kX.copy(i).multiplyScalar(n/s).sub(t),k$.copy(i).multiplyScalar(a/s).add(r).sub(e),-kX.dot(k$)/kX.dot(kX))},kZ=new ni(0,1,0),k0=new ni,k1=new n8,k2=({direction:e,axis:t})=>{let{scaleLimits:r,annotations:i,annotationsClass:n,depthTest:a,scale:s,lineWidth:o,fixed:l,axisColors:u,hoveredColor:c,opacity:h,onDragStart:d,onDrag:f,onDragEnd:p,userData:m}=eN.useContext(kC),g=dY(e=>e.size),A=dY(e=>e.controls),v=eN.useRef(null),y=eN.useRef(null),E=eN.useRef(null),x=eN.useRef(1),_=eN.useRef(1),b=eN.useRef(null),[S,w]=eN.useState(!1),C=l?1.2:1.2*s,T=eN.useCallback(r=>{i&&(v.current.innerText=`${_.current.toFixed(2)}`,v.current.style.display="block"),r.stopPropagation();let n=new n8().extractRotation(y.current.matrixWorld),a=r.point.clone(),o=new ni().setFromMatrixPosition(y.current.matrixWorld),u=e.clone().applyMatrix4(n).normalize(),c=y.current.matrixWorld.clone(),h=c.clone().invert(),f=l?1/EY(y.current.getWorldPosition(kX),s,r.camera,g):1;b.current={clickPoint:a,dir:u,mPLG:c,mPLGInv:h,offsetMultiplier:f},d({component:"Sphere",axis:t,origin:o,directions:[u]}),A&&(A.enabled=!1),r.target.setPointerCapture(r.pointerId)},[i,A,e,d,t,l,s,g]),I=eN.useCallback(e=>{if(e.stopPropagation(),S||w(!0),b.current){let{clickPoint:n,dir:a,mPLG:o,mPLGInv:u,offsetMultiplier:c}=b.current,[h,d]=(null==r?void 0:r[t])||[1e-5,void 0],p=kJ(n,a,e.ray.origin,e.ray.direction)*c,m=Math.pow(2,.2*(l?p:p/s));e.shiftKey&&(m=Math.round(10*m)/10),m=Math.max(m,h/x.current),void 0!==d&&(m=Math.min(m,d/x.current)),_.current=x.current*m,E.current.position.set(0,C+p,0),i&&(v.current.innerText=`${_.current.toFixed(2)}`),k0.set(1,1,1),k0.setComponent(t,m),k1.makeScale(k0.x,k0.y,k0.z).premultiply(o).multiply(u),f(k1)}},[i,C,f,S,r,t]),M=eN.useCallback(e=>{i&&(v.current.style.display="none"),e.stopPropagation(),x.current=_.current,b.current=null,E.current.position.set(0,C,0),p(),A&&(A.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[i,A,p,C]),R=eN.useCallback(e=>{e.stopPropagation(),w(!1)},[]),{radius:B,matrixL:D}=eN.useMemo(()=>{let t=l?o/s*1.8:s/22.5,r=new nr().setFromUnitVectors(kZ,e.clone().normalize());return{radius:t,matrixL:new n8().makeRotationFromQuaternion(r)}},[e,s,o,l]),P=S?c:u[t];return eN.createElement("group",{ref:y},eN.createElement("group",{matrix:D,matrixAutoUpdate:!1,onPointerDown:T,onPointerMove:I,onPointerUp:M,onPointerOut:R},i&&eN.createElement(fi,{position:[0,C/2,0]},eN.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:n,ref:v})),eN.createElement("mesh",{ref:E,position:[0,C,0],renderOrder:500,userData:m},eN.createElement("sphereGeometry",{args:[B,12,12]}),eN.createElement("meshBasicMaterial",{transparent:!0,depthTest:a,color:P,opacity:h,polygonOffset:!0,polygonOffsetFactor:-10}))))},k3=new n8,k4=new n8,k5=new n8,k6=new n8,k8=new n8,k9=new n8,k7=new n8,Fe=new n8,Ft=new n8,Fr=new nL,Fi=new nL,Fn=new ni,Fa=new ni,Fs=new ni,Fo=new ni,Fl=new ni,Fu=new ni(1,0,0),Fc=new ni(0,1,0),Fh=new ni(0,0,1),Fd=eN.forwardRef(({enabled:e=!0,matrix:t,onDragStart:r,onDrag:i,onDragEnd:n,autoTransform:a=!0,anchor:s,disableAxes:o=!1,disableSliders:l=!1,disableRotations:u=!1,disableScaling:c=!1,activeAxes:h=[!0,!0,!0],offset:d=[0,0,0],rotation:f=[0,0,0],scale:p=1,lineWidth:m=4,fixed:g=!1,translationLimits:A,rotationLimits:v,scaleLimits:y,depthTest:E=!0,axisColors:x=["#ff2060","#20df80","#2080ff"],hoveredColor:_="#ffff40",annotations:b=!1,annotationsClass:S,opacity:w=1,visible:C=!0,userData:T,children:I,...M},R)=>{let B=dY(e=>e.invalidate),D=eN.useRef(null),P=eN.useRef(null),L=eN.useRef(null),k=eN.useRef(null),F=eN.useRef([0,0,0]),O=eN.useRef(new ni(1,1,1)),U=eN.useRef(new ni(1,1,1));eN.useLayoutEffect(()=>{s&&(k.current.updateWorldMatrix(!0,!0),k6.copy(k.current.matrixWorld).invert(),Fr.makeEmpty(),k.current.traverse(e=>{e.geometry&&(e.geometry.boundingBox||e.geometry.computeBoundingBox(),k9.copy(e.matrixWorld).premultiply(k6),Fi.copy(e.geometry.boundingBox),Fi.applyMatrix4(k9),Fr.union(Fi))}),Fn.copy(Fr.max).add(Fr.min).multiplyScalar(.5),Fa.copy(Fr.max).sub(Fr.min).multiplyScalar(.5),Fs.copy(Fa).multiply(new ni(...s)).add(Fn),Fo.set(...d).add(Fs),L.current.position.copy(Fo),B())});let N=eN.useMemo(()=>({onDragStart:e=>{k3.copy(P.current.matrix),k4.copy(P.current.matrixWorld),r&&r(e),B()},onDrag:e=>{k5.copy(D.current.matrixWorld),k6.copy(k5).invert(),k8.copy(k4).premultiply(e),k9.copy(k8).premultiply(k6),k7.copy(k3).invert(),Fe.copy(k9).multiply(k7),a&&P.current.matrix.copy(k9),i&&i(k9,Fe,k8,e),B()},onDragEnd:()=>{n&&n(),B()},translation:F,translationLimits:A,rotationLimits:v,axisColors:x,hoveredColor:_,opacity:w,scale:p,lineWidth:m,fixed:g,depthTest:E,userData:T,annotations:b,annotationsClass:S}),[r,i,n,F,A,v,y,E,p,m,g,...x,_,w,T,a,b,S]),z=new ni;return dK(e=>{if(g){let t=EY(L.current.getWorldPosition(z),p,e.camera,e.size);O.current.setScalar(t)}t&&t instanceof n8&&(P.current.matrix=t),P.current.updateWorldMatrix(!0,!0),Ft.makeRotationFromEuler(L.current.rotation).setPosition(L.current.position).premultiply(P.current.matrixWorld),U.current.setFromMatrixScale(Ft),Fl.copy(O.current).divide(U.current),(Math.abs(L.current.scale.x-Fl.x)>1e-4||Math.abs(L.current.scale.y-Fl.y)>1e-4||Math.abs(L.current.scale.z-Fl.z)>1e-4)&&(L.current.scale.copy(Fl),e.invalidate())}),eN.useImperativeHandle(R,()=>P.current,[]),eN.createElement(kC.Provider,{value:N},eN.createElement("group",{ref:D},eN.createElement("group",eU({ref:P,matrix:t,matrixAutoUpdate:!1},M),eN.createElement("group",{visible:C,ref:L,position:d,rotation:f},e&&eN.createElement(eN.Fragment,null,!o&&h[0]&&eN.createElement(kD,{axis:0,direction:Fu}),!o&&h[1]&&eN.createElement(kD,{axis:1,direction:Fc}),!o&&h[2]&&eN.createElement(kD,{axis:2,direction:Fh}),!l&&h[0]&&h[1]&&eN.createElement(kq,{axis:2,dir1:Fu,dir2:Fc}),!l&&h[0]&&h[2]&&eN.createElement(kq,{axis:1,dir1:Fh,dir2:Fu}),!l&&h[2]&&h[1]&&eN.createElement(kq,{axis:0,dir1:Fc,dir2:Fh}),!u&&h[0]&&h[1]&&eN.createElement(kV,{axis:2,dir1:Fu,dir2:Fc}),!u&&h[0]&&h[2]&&eN.createElement(kV,{axis:1,dir1:Fh,dir2:Fu}),!u&&h[2]&&h[1]&&eN.createElement(kV,{axis:0,dir1:Fc,dir2:Fh}),!c&&h[0]&&eN.createElement(k2,{axis:0,direction:Fu}),!c&&h[1]&&eN.createElement(k2,{axis:1,direction:Fc}),!c&&h[2]&&eN.createElement(k2,{axis:2,direction:Fh}))),eN.createElement("group",{ref:k},I))))}),Ff=(0,eN.forwardRef)(({options:e={video:!0},...t},r)=>{let i=da(()=>navigator.mediaDevices.getDisplayMedia(e),[]);return(0,eN.useEffect)(()=>()=>{null==i||i.getTracks().forEach(e=>e.stop()),dl([])},[i]),eN.createElement(IF,eU({ref:r},t,{src:i}))}),Fp=(0,eN.forwardRef)(({constraints:e={audio:!1,video:{facingMode:"user"}},...t},r)=>{let i=da(()=>navigator.mediaDevices.getUserMedia(e),[]);return(0,eN.useEffect)(()=>()=>{null==i||i.getTracks().forEach(e=>e.stop()),dl([])},[i]),eN.createElement(IF,eU({ref:r},t,{src:i}))}),Fm=new ni(0,0,-1),Fg=function(){let e=new ni,t=new ni,r=new ni,i=new ni,n=new ni;return function(a,s,o,l){return e.copy(a),t.copy(s),r.copy(o),i.copy(t).sub(e),n.copy(r).sub(e),l.crossVectors(n,i).normalize()}}(),FA=eN.forwardRef(({points:e=FE.SAMPLE_FACELANDMARKER_RESULT.faceLandmarks[0],face:t,facialTransformationMatrix:r,faceBlendshapes:i,offset:n,offsetScalar:a=80,width:s,height:o,depth:l=1,verticalTri:u=[159,386,152],origin:c,eyes:h=!0,eyesAsOrigin:d=!1,debug:f=!1,children:p,...m},g)=>{var A;t&&(e=t.keypoints,console.warn("Facemesh `face` prop is deprecated: use `points` instead"));let v=eN.useRef(null),y=eN.useRef(null),E=eN.useRef(null),x=eN.useRef(null),_=eN.useRef(null),b=eN.useRef(null),S=eN.useRef(null),[w]=eN.useState(()=>new ni),[C]=eN.useState(()=>new aS),[T]=eN.useState(()=>new nr),[I]=eN.useState(()=>new ni),{invalidate:M}=dY();eN.useEffect(()=>{var e;null==(e=_.current)||e.geometry.setIndex(FE.TRIANGULATION)},[]);let[R]=eN.useState(()=>new ni);eN.useEffect(()=>{var t,p,m,g,A,B;let D=null==(t=_.current)?void 0:t.geometry;if(!D)return;D.setFromPoints(e),D.setDrawRange(0,FE.TRIANGULATION.length),r?(C.matrix.fromArray(r.data),C.matrix.decompose(C.position,C.quaternion,C.scale),C.rotation.y*=-1,C.rotation.z*=-1,T.setFromEuler(C.rotation),n?(C.position.y*=-1,C.position.z*=-1,null==(m=v.current)||m.position.copy(C.position.divideScalar(a))):null==(g=v.current)||g.position.set(0,0,0)):(Fg(e[u[0]],e[u[1]],e[u[2]],w),T.setFromUnitVectors(Fm,w));let P=T.clone().invert();if(D.computeBoundingBox(),f&&M(),D.center(),D.applyQuaternion(P),null==(p=x.current)||p.setRotationFromQuaternion(T),h){if(i){if(b.current&&S.current&&E.current){if(d){let e=b.current._computeSphere(D),t=S.current._computeSphere(D);c=(A=e.center,B=t.center,A.clone().add(B).multiplyScalar(.5)).negate(),b.current._update(D,i,e),S.current._update(D,i,t)}else b.current._update(D,i),S.current._update(D,i)}}else console.warn("Facemesh `eyes` option only works if `faceBlendshapes` is provided: skipping.")}if(E.current){if(void 0!==c){if("number"==typeof c){let e=D.getAttribute("position");I.set(-e.getX(c),-e.getY(c),-e.getZ(c))}else c.isVector3&&I.copy(c)}else I.setScalar(0);E.current.position.copy(I)}if(y.current){let e=1;(s||o||l)&&(D.boundingBox.getSize(R),s&&(e=s/R.x),o&&(e=o/R.y),l&&(e=l/R.z)),y.current.scale.setScalar(1!==e?e:1)}D.computeVertexNormals(),D.attributes.position.needsUpdate=!0},[e,r,i,C,n,a,s,o,l,u,c,h,f,M,w,T,R,I]);let B=eN.useMemo(()=>({outerRef:x,meshRef:_,eyeRightRef:b,eyeLeftRef:S}),[]);eN.useImperativeHandle(g,()=>B,[B]);let[D]=eN.useState(()=>new ni),P=null==(A=_.current)?void 0:A.geometry.boundingBox,L=(null==P?void 0:P.getSize(D).z)||1;return eN.createElement("group",m,eN.createElement("group",{ref:v},eN.createElement("group",{ref:x},eN.createElement("group",{ref:y},f?eN.createElement(eN.Fragment,null,eN.createElement("axesHelper",{args:[L]}),eN.createElement(xu,{points:[[0,0,0],[0,0,-L]],color:65535})):null,eN.createElement("group",{ref:E},h&&i&&eN.createElement("group",{name:"eyes"},eN.createElement(Fy,{side:"left",ref:b,debug:f}),eN.createElement(Fy,{side:"right",ref:S,debug:f})),eN.createElement("mesh",{ref:_,name:"face"},p,f?eN.createElement(eN.Fragment,null,P&&eN.createElement("box3Helper",{args:[P]})):null))))))}),Fv={contourLandmarks:{right:[33,133,159,145,153],left:[263,362,386,374,380]},blendshapes:{right:[14,16,18,12],left:[13,15,17,11]},color:{right:"red",left:"#00ff00"},fov:{horizontal:100,vertical:90}},Fy=eN.forwardRef(({side:e,debug:t=!0},r)=>{let i=eN.useRef(null),n=eN.useRef(null),[a]=eN.useState(()=>new nJ),s=eN.useCallback(t=>{let r=t.getAttribute("position"),i=Fv.contourLandmarks[e].map(e=>new ni(r.getX(e),r.getY(e),r.getZ(e)));return a.center.set(0,0,0),i.forEach(e=>a.center.add(e)),a.center.divideScalar(i.length),a.radius=i[0].sub(i[1]).length()/2,a},[a,e]),[o]=eN.useState(()=>new ao),l=eN.useCallback((t,r,a)=>{if(i.current){var l;null!==(l=a)&&void 0!==l||(a=s(t)),i.current.position.copy(a.center),i.current.scale.setScalar(a.radius)}if(r&&n.current){let t=Fv.blendshapes[e],i=r.categories[t[0]].score,a=r.categories[t[1]].score,s=r.categories[t[2]].score,l=r.categories[t[3]].score,u=Fv.fov.horizontal*ne.DEG2RAD,c=.5*(Fv.fov.vertical*ne.DEG2RAD)*(i-a)*("left"===e?1:-1);o.set(.5*u*(l-s),c,0),n.current.setRotationFromEuler(o)}},[s,e,o]),u=eN.useMemo(()=>({eyeMeshRef:i,irisDirRef:n,_computeSphere:s,_update:l}),[s,l]);eN.useImperativeHandle(r,()=>u,[u]);let c=Fv.color[e];return eN.createElement("group",null,eN.createElement("group",{ref:i},t&&eN.createElement("axesHelper",null),eN.createElement("group",{ref:n},eN.createElement(eN.Fragment,null,t&&eN.createElement(xu,{points:[[0,0,0],[0,0,-2]],lineWidth:1,color:c})))))}),FE={TRIANGULATION:[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255],SAMPLE_FACE:{keypoints:[{x:356.2804412841797,y:295.1960563659668,z:-23.786449432373047,name:"lips"},{x:354.8859405517578,y:264.69520568847656,z:-36.718435287475586},{x:355.2180862426758,y:275.3360366821289,z:-21.183712482452393},{x:347.349853515625,y:242.4400234222412,z:-25.093655586242676},{x:354.40135955810547,y:256.67933464050293,z:-38.23572635650635},{x:353.7689971923828,y:247.54886627197266,z:-34.5475435256958},{x:352.1288299560547,y:227.34312057495117,z:-13.095386028289795},{x:303.5013198852539,y:234.67002868652344,z:12.500141859054565,name:"rightEye"},{x:351.09378814697266,y:211.87547206878662,z:-6.413471698760986},{x:350.7115936279297,y:202.1251630783081,z:-6.413471698760986},{x:348.33667755126953,y:168.7741756439209,z:6.483500003814697,name:"faceOval"},{x:356.4806365966797,y:299.2995357513428,z:-23.144519329071045},{x:356.5511703491211,y:302.66146659851074,z:-21.020312309265137},{x:356.6239547729492,y:304.1536331176758,z:-18.137459754943848,name:"lips"},{x:356.5807342529297,y:305.1840591430664,z:-18.767719268798828,name:"lips"},{x:356.8241500854492,y:308.25711250305176,z:-20.16829490661621},{x:357.113037109375,y:312.26277351379395,z:-22.10575819015503},{x:357.34962463378906,y:317.1123218536377,z:-21.837315559387207,name:"lips"},{x:357.6658630371094,y:325.51036834716797,z:-16.27002477645874},{x:355.0201416015625,y:269.36279296875,z:-33.73054027557373},{x:348.5237503051758,y:270.33411026000977,z:-24.93025302886963},{x:279.97331619262695,y:213.24176788330078,z:47.759642601013184,name:"faceOval"},{x:322.66529083251953,y:238.5027265548706,z:5.535193085670471},{x:316.0983657836914,y:239.94489669799805,z:5.777376294136047},{x:309.9431610107422,y:240.24518966674805,z:7.510589361190796},{x:301.31994247436523,y:237.86138534545898,z:13.118728399276733},{x:328.14266204833984,y:235.80496788024902,z:6.646900177001953},{x:313.7326431274414,y:222.11161136627197,z:3.9887237548828125},{x:320.45196533203125,y:221.87729358673096,z:4.601476192474365},{x:307.35679626464844,y:223.63793849945068,z:5.932023525238037},{x:303.0031204223633,y:226.3743782043457,z:8.479321002960205},{x:296.80023193359375,y:242.94299125671387,z:15.931552648544312},{x:332.2352981567383,y:340.77341079711914,z:-10.165848731994629},{x:301.38587951660156,y:233.46447944641113,z:14.764405488967896,name:"rightEye"},{x:279.0147018432617,y:244.37155723571777,z:45.77549457550049},{x:289.60548400878906,y:239.1807460784912,z:23.191204071044922},{x:320.32257080078125,y:267.1292781829834,z:-4.954537749290466},{x:347.64583587646484,y:294.4955062866211,z:-23.062820434570313,name:"lips"},{x:349.28138732910156,y:303.1095886230469,z:-20.238323211669922},{x:338.9453125,y:298.19186210632324,z:-19.456336498260498,name:"lips"},{x:333.36788177490234,y:302.6706790924072,z:-14.776077270507813,name:"lips"},{x:342.89188385009766,y:304.3561363220215,z:-17.752301692962646},{x:337.7375030517578,y:306.0098361968994,z:-13.410515785217285},{x:325.6159210205078,y:316.22995376586914,z:-6.681914925575256},{x:349.0104675292969,y:264.9818515777588,z:-36.274919509887695},{x:347.7138900756836,y:257.5664806365967,z:-37.67549514770508},{x:291.79357528686523,y:218.88171672821045,z:11.578094959259033,name:"rightEyebrow"},{x:332.2689437866211,y:247.56946563720703,z:-3.3730539679527283},{x:332.0074462890625,y:267.1201229095459,z:-19.969879388809204},{x:331.27952575683594,y:263.6967658996582,z:-17.47218608856201},{x:301.04373931884766,y:269.56552505493164,z:3.61815482378006},{x:347.4863815307617,y:249.0706443786621,z:-32.633421421051025},{x:307.26118087768555,y:208.2646894454956,z:1.1591226607561111,name:"rightEyebrow"},{x:297.91919708251953,y:212.22604751586914,z:5.914516448974609,name:"rightEyebrow"},{x:285.1651382446289,y:197.98450469970703,z:36.391637325286865,name:"faceOval"},{x:337.04097747802734,y:211.25229835510254,z:-4.548954665660858},{x:326.5912628173828,y:223.16698551177979,z:6.670243740081787},{x:320.05664825439453,y:309.5834255218506,z:-4.055835008621216},{x:289.6866226196289,y:314.617395401001,z:53.875489234924316,name:"faceOval"},{x:337.4256896972656,y:270.8755302429199,z:-17.67060160636902},{x:343.69922637939453,y:273.0000400543213,z:-18.756048679351807},{x:327.4242401123047,y:309.22399520874023,z:-4.703601002693176,name:"lips"},{x:330.37220001220703,y:308.3323001861572,z:-6.442649960517883},{x:293.87027740478516,y:207.7961826324463,z:9.821539521217346,name:"rightEyebrow"},{x:332.11437225341797,y:271.22812271118164,z:-16.64351224899292},{x:320.1197814941406,y:207.40366458892822,z:-2.48164564371109,name:"rightEyebrow"},{x:318.59575271606445,y:201.07443809509277,z:-3.110446035861969,name:"rightEyebrow"},{x:310.72303771972656,y:175.75075149536133,z:13.328815698623657,name:"faceOval"},{x:289.67578887939453,y:202.29835510253906,z:21.370456218719482},{x:315.30879974365234,y:187.35260009765625,z:5.0304025411605835},{x:287.8936767578125,y:216.54793739318848,z:17.81065821647644,name:"rightEyebrow"},{x:283.9391899108887,y:215.01142501831055,z:32.04984903335571},{x:348.35330963134766,y:299.4155788421631,z:-22.47924566268921},{x:341.1790466308594,y:301.8221855163574,z:-18.977805376052856},{x:335.69713592529297,y:304.4266891479492,z:-14.682706594467163},{x:339.4615173339844,y:272.3654365539551,z:-16.38674020767212},{x:328.99600982666016,y:308.86685371398926,z:-5.616893768310547},{x:332.00313568115234,y:309.1875743865967,z:-10.335084199905396},{x:331.0068130493164,y:307.9274368286133,z:-6.681914925575256,name:"lips"},{x:341.13792419433594,y:266.4876937866211,z:-26.56425952911377},{x:339.02950286865234,y:305.6663703918457,z:-12.33674168586731,name:"lips"},{x:344.22935485839844,y:304.9452781677246,z:-15.161235332489014,name:"lips"},{x:350.1844024658203,y:304.374303817749,z:-17.5305438041687,name:"lips"},{x:348.52630615234375,y:325.9562301635742,z:-16.164982318878174},{x:348.6581802368164,y:317.1624183654785,z:-21.510512828826904,name:"lips"},{x:348.9766311645508,y:312.1923065185547,z:-21.708929538726807},{x:349.2427444458008,y:308.0660820007324,z:-19.643079042434692},{x:349.67491149902344,y:305.42747497558594,z:-18.16080331802368,name:"lips"},{x:337.95589447021484,y:306.6535949707031,z:-12.803598642349243,name:"lips"},{x:337.06878662109375,y:307.63169288635254,z:-14.274203777313232},{x:335.77449798583984,y:309.8449516296387,z:-15.698124170303345},{x:334.6099090576172,y:312.7997016906738,z:-14.764405488967896,name:"lips"},{x:327.2330856323242,y:293.80866050720215,z:-11.864047050476074},{x:280.97679138183594,y:279.79928970336914,z:68.90834331512451,name:"faceOval"},{x:355.13843536376953,y:271.7875671386719,z:-25.350427627563477},{x:334.7235870361328,y:307.4656391143799,z:-9.302158951759338,name:"lips"},{x:333.5293960571289,y:307.89782524108887,z:-10.200862884521484},{x:346.29688262939453,y:276.4256286621094,z:-19.748122692108154},{x:335.16246795654297,y:276.22097969055176,z:-12.313398122787476},{x:345.09132385253906,y:274.7082996368408,z:-19.304605722427368},{x:325.4267883300781,y:252.95130729675293,z:-1.6661019623279572},{x:315.347843170166,y:259.05200958251953,z:-.25604281574487686},{x:330.44933319091797,y:267.7570152282715,z:-14.017432928085327},{x:294.96768951416016,y:185.26001930236816,z:23.903164863586426,name:"faceOval"},{x:299.63531494140625,y:192.7913761138916,z:12.640198469161987},{x:304.5452117919922,y:202.4142837524414,z:3.244667649269104,name:"rightEyebrow"},{x:331.6915512084961,y:320.0467872619629,z:-10.632705688476563},{x:334.5911407470703,y:201.27566814422607,z:-6.133356094360352,name:"rightEyebrow"},{x:331.4815902709961,y:185.44180870056152,z:.6627205014228821},{x:328.05816650390625,y:170.8385467529297,z:7.358860373497009,name:"faceOval"},{x:304.49764251708984,y:239.76297855377197,z:10.387605428695679},{x:290.6382179260254,y:248.85257720947266,z:19.03616428375244},{x:331.5682601928711,y:233.20727348327637,z:7.837390303611755},{x:295.5115509033203,y:228.9834451675415,z:14.41426157951355},{x:336.94332122802734,y:241.8259334564209,z:-5.27842104434967},{x:336.2792205810547,y:262.7049922943115,z:-26.12074375152588},{x:284.4102478027344,y:255.3262710571289,z:25.467140674591064},{x:295.1420593261719,y:253.02655220031738,z:12.430112361907959},{x:303.5196113586426,y:254.20703887939453,z:6.139191389083862},{x:315.73450088500977,y:251.64799690246582,z:3.3788898587226868},{x:324.69661712646484,y:247.56494522094727,z:2.3328344523906708},{x:331.57970428466797,y:243.02241325378418,z:1.1423448473215103},{x:345.6210708618164,y:229.9976634979248,z:-10.825285911560059},{x:286.26644134521484,y:270.37991523742676,z:21.708929538726807},{x:290.2525520324707,y:228.4921360015869,z:17.71728754043579},{x:351.65367126464844,y:269.3400764465332,z:-33.450424671173096},{x:333.1378936767578,y:253.88388633728027,z:-7.230473756790161},{x:277.8318977355957,y:246.95331573486328,z:68.20805549621582,name:"faceOval"},{x:336.6680908203125,y:238.10003757476807,z:.7688578963279724},{x:329.95800018310547,y:269.18323516845703,z:-7.207130789756775},{x:299.17491912841797,y:234.13324356079102,z:15.95489501953125},{x:335.61729431152344,y:258.71752738952637,z:-23.016133308410645},{x:284.1079330444336,y:297.0343494415283,z:63.25934886932373,name:"faceOval"},{x:331.44542694091797,y:230.6892442703247,z:9.92658257484436,name:"rightEye"},{x:341.41536712646484,y:253.01264762878418,z:-29.038610458374023},{x:303.5472869873047,y:327.5896739959717,z:16.725212335586548},{x:304.7756576538086,y:337.4389457702637,z:27.38126277923584,name:"faceOval"},{x:280.80501556396484,y:275.32050132751465,z:45.0752067565918},{x:295.43582916259766,y:318.4501647949219,z:26.2608003616333},{x:281.4303207397461,y:228.7355661392212,z:40.94350814819336},{x:331.2549591064453,y:349.4216537475586,z:-7.376367449760437},{x:352.4247741699219,y:271.7330074310303,z:-24.953596591949463},{x:327.5672912597656,y:260.41900634765625,z:-5.456410646438599},{x:284.5432472229004,y:241.7647933959961,z:29.668869972229004},{x:310,y:235.66174507141113,z:8.502663969993591,name:"rightEye"},{x:315.7071113586426,y:235.7572603225708,z:6.938687562942505,name:"rightEye"},{x:330.41088104248047,y:311.04143142700195,z:-9.325502514839172,name:"lips"},{x:288.5377502441406,y:285.31983375549316,z:21.837315559387207},{x:344.55039978027344,y:359.4300842285156,z:-6.705257892608643,name:"faceOval"},{x:323.41880798339844,y:351.67362213134766,z:7.802375555038452,name:"faceOval"},{x:314.64088439941406,y:346.11894607543945,z:16.36339783668518,name:"faceOval"},{x:349.4945526123047,y:184.8434829711914,z:-.21847527474164963},{x:359.24694061279297,y:359.8348903656006,z:-8.403456211090088,name:"faceOval"},{x:321.26182556152344,y:234.64492321014404,z:6.90950870513916,name:"rightEye"},{x:326.318359375,y:232.90250301361084,z:8.029969334602356,name:"rightEye"},{x:329.6211624145508,y:231.6195774078369,z:9.722331762313843,name:"rightEye"},{x:285.9398078918457,y:228.2351303100586,z:24.650139808654785},{x:325.79288482666016,y:227.88007736206055,z:7.469738721847534,name:"rightEye"},{x:320.1699447631836,y:227.5934886932373,z:6.168370842933655,name:"rightEye"},{x:314.85408782958984,y:227.85282611846924,z:6.2675780057907104,name:"rightEye"},{x:309.3084907531738,y:229.1516876220703,z:7.7031683921813965,name:"rightEye"},{x:305.5621337890625,y:230.92366218566895,z:9.722331762313843,name:"rightEye"},{x:277.8681945800781,y:228.5354232788086,z:59.71122741699219,name:"faceOval"},{x:306.1444664001465,y:235.1954698562622,z:10.603528022766113,name:"rightEye"},{x:355.4478454589844,y:281.96210861206055,z:-20.565123558044434},{x:333.02661895751953,y:288.0105400085449,z:-14.72939133644104},{x:337.15728759765625,y:269.2059516906738,z:-19.8414945602417},{x:345.9898376464844,y:283.5453128814697,z:-20.4834246635437},{x:351.48963928222656,y:219.98916149139404,z:-7.0378947257995605},{x:312.39574432373047,y:336.50628089904785,z:8.671900033950806},{x:321.32152557373047,y:343.1755256652832,z:.9067271649837494},{x:343.78379821777344,y:353.2975959777832,z:-14.355905055999756},{x:296.8791389465332,y:327.91497230529785,z:41.01353645324707,name:"faceOval"},{x:329.6939468383789,y:229.27897453308105,z:8.934508562088013,name:"rightEye"},{x:341.6905212402344,y:241.4073657989502,z:-14.589333534240723},{x:359.03079986572266,y:353.48859786987305,z:-15.803166627883911},{x:333.1861877441406,y:356.43213272094727,z:-1.0234417766332626,name:"faceOval"},{x:283.97483825683594,y:291.4318656921387,z:41.94725513458252},{x:343.33770751953125,y:305.830135345459,z:-15.756480693817139,name:"lips"},{x:342.40283966064453,y:307.7453899383545,z:-17.4021577835083},{x:341.53621673583984,y:311.0595703125,z:-19.047834873199463},{x:340.9107208251953,y:315.4837703704834,z:-18.5576331615448,name:"lips"},{x:339.1478729248047,y:323.42233657836914,z:-14.367576837539673},{x:333.3201599121094,y:307.4406337738037,z:-9.617288708686829},{x:331.2411117553711,y:306.9811820983887,z:-9.669809937477112},{x:329.23255920410156,y:306.0508346557617,z:-9.582273960113525,name:"lips"},{x:322.4586486816406,y:301.33323669433594,z:-7.720675468444824},{x:297.1712112426758,y:286.9552803039551,z:8.240055441856384},{x:341.3060760498047,y:235.4432201385498,z:-7.504753470420837},{x:336.9318389892578,y:224.3451976776123,z:5.829898118972778},{x:332.65323638916016,y:226.70403957366943,z:8.105834126472473},{x:334.67357635498047,y:306.4397621154785,z:-8.981193900108337,name:"lips"},{x:297.4601936340332,y:306.29210472106934,z:15.476365089416504},{x:342.9119110107422,y:222.37077713012695,z:-2.754466235637665},{x:335.4629898071289,y:332.20250129699707,z:-11.823196411132813},{x:353.2412338256836,y:240.56339263916016,z:-27.147831916809082},{x:346.3080596923828,y:236.41446590423584,z:-18.452589511871338},{x:352.6475143432617,y:234.1420555114746,z:-19.748122692108154},{x:337.3209762573242,y:253.39937210083008,z:-16.024924516677856},{x:358.6122131347656,y:344.90861892700195,z:-18.592647314071655},{x:358.1117248535156,y:334.64990615844727,z:-17.49552845954895},{x:346.4450454711914,y:335.0321102142334,z:-16.32838249206543},{x:319.17640686035156,y:320.2833938598633,z:-3.276764452457428},{x:325.2540588378906,y:276.2369728088379,z:-6.460157036781311},{x:326.7214584350586,y:327.3939514160156,z:-7.417217493057251},{x:310.7190132141113,y:277.2265148162842,z:-3.5452082753181458},{x:319.78355407714844,y:284.8238182067871,z:-6.4543211460113525},{x:305.773983001709,y:290.83580017089844,z:.06907138042151928},{x:344.4001770019531,y:344.85408782958984,z:-16.946970224380493},{x:333.1879425048828,y:258.74256134033203,z:-11.90489649772644},{x:313.80598068237305,y:327.08919525146484,z:2.2277912497520447},{x:322.9637908935547,y:334.6819496154785,z:-3.3643004298210144},{x:313.4055519104004,y:311.2166690826416,z:-1.1175429821014404},{x:291.0865783691406,y:298.2831001281738,z:22.467575073242188},{x:305.6580924987793,y:313.3707904815674,z:5.561453700065613},{x:288.23760986328125,y:305.9941864013672,z:36.765122413635254},{x:315.10692596435547,y:296.26991271972656,z:-4.604393839836121},{x:337.50518798828125,y:247.5944423675537,z:-10.597691535949707},{x:338.8450622558594,y:265.47778129577637,z:-27.778091430664063},{x:334.25254821777344,y:269.0671920776367,z:-20.938611030578613},{x:341.64512634277344,y:259.6387195587158,z:-32.189905643463135},{x:331.44081115722656,y:219.0976095199585,z:4.207563698291779},{x:320.56339263916016,y:216.49658203125,z:2.930997312068939},{x:311.21912002563477,y:216.57853603363037,z:2.9674705862998962},{x:303.46256256103516,y:218.54614734649658,z:5.357203483581543},{x:297.99999237060547,y:222.505202293396,z:9.325502514839172},{x:294.93839263916016,y:236.39654159545898,z:18.534289598464966},{x:278.87489318847656,y:259.7095584869385,z:45.68212032318115},{x:300.3782653808594,y:245.38593292236328,z:12.278382778167725},{x:307.06348419189453,y:246.36857986450195,z:8.164191246032715},{x:315.5229187011719,y:245.3949737548828,z:5.503097176551819},{x:323.71395111083984,y:242.75178909301758,z:4.6335723996162415},{x:330.2785873413086,y:239.34658527374268,z:4.937030673027039},{x:334.6982192993164,y:236.0460376739502,z:4.823233783245087},{x:279.3412208557129,y:263.5196113586426,z:70.91583728790283,name:"faceOval"},{x:334.65972900390625,y:271.6648578643799,z:-17.775644063949585},{x:342.05677032470703,y:246.99846267700195,z:-20.84523916244507},{x:344.0357971191406,y:264.5701503753662,z:-32.936880588531494},{x:348.25531005859375,y:268.6645030975342,z:-30.695960521697998},{x:344.12227630615234,y:266.34212493896484,z:-29.808926582336426},{x:337.12318420410156,y:274.2556858062744,z:-15.768152475357056},{x:349.49047088623047,y:269.071683883667,z:-32.51670837402344},{x:350.1683044433594,y:271.4691352844238,z:-24.93025302886963},{x:333.9634704589844,y:230.56639194488525,z:8.89949381351471},{x:338.2147979736328,y:231.4807891845703,z:4.6715047955513},{x:340.4712677001953,y:231.74463272094727,z:-.34996166825294495},{x:303.28975677490234,y:232.24980354309082,z:11.916568279266357,name:"rightEye"},{x:299.4649124145508,y:229.53842639923096,z:12.325069904327393},{x:359.09618377685547,y:241.77349090576172,z:-24.650139808654785},{x:399.46216583251953,y:229.89503860473633,z:15.919880867004395,name:"leftEye"},{x:361.38919830322266,y:269.6129894256592,z:-24.510080814361572},{x:416.9973373413086,y:206.0895538330078,z:53.26857566833496,name:"faceOval"},{x:381.32179260253906,y:235.5476474761963,z:7.6214683055877686},{x:387.8068542480469,y:236.25958442687988,z:8.345099091529846},{x:393.95751953125,y:235.8660364151001,z:10.475142002105713},{x:401.84600830078125,y:232.77019500732422,z:16.760226488113403},{x:375.70568084716797,y:233.48456382751465,z:8.234220147132874},{x:388.17752838134766,y:218.94717693328857,z:6.810300946235657},{x:381.64928436279297,y:219.2656660079956,z:6.711093783378601},{x:394.4760513305664,y:219.66821193695068,z:9.173773527145386},{x:398.8843536376953,y:221.8837022781372,z:12.03328251838684},{x:406.5454864501953,y:237.12156772613525,z:19.7131085395813},{x:383.87447357177734,y:337.6932907104492,z:-8.631049990653992},{x:401.2682342529297,y:228.5916566848755,z:18.359217643737793,name:"leftEye"},{x:422.0449447631836,y:236.73934936523438,z:51.16771221160889},{x:412.69153594970703,y:232.80198097229004,z:27.52131938934326},{x:387.3497772216797,y:263.298397064209,z:-2.8609684109687805},{x:364.5124053955078,y:293.39221000671387,z:-22.397546768188477,name:"lips"},{x:363.62987518310547,y:302.1291446685791,z:-19.643079042434692},{x:373.2334518432617,y:295.8647060394287,z:-18.125789165496826,name:"lips"},{x:378.83365631103516,y:299.5177745819092,z:-13.153743743896484,name:"lips"},{x:369.91477966308594,y:302.5704002380371,z:-16.65518283843994},{x:374.9167251586914,y:303.5416603088379,z:-11.963253021240234},{x:387.58888244628906,y:312.2716999053955,z:-4.680258631706238},{x:360.6635284423828,y:264.31986808776855,z:-35.94811677932739},{x:361.04564666748047,y:256.8225860595703,z:-37.278664112091064},{x:408.3855438232422,y:213.52088928222656,z:15.756480693817139,name:"leftEyebrow"},{x:373.2946014404297,y:245.38101196289063,z:-1.9316278398036957},{x:376.83860778808594,y:264.3721103668213,z:-18.510947227478027},{x:376.9546127319336,y:261.0010528564453,z:-15.989909172058105},{x:406.1498260498047,y:263.5030174255371,z:7.072908878326416},{x:360.07205963134766,y:248.3631706237793,z:-32.16656446456909},{x:393.11119079589844,y:205.10473251342773,z:3.7786373496055603,name:"leftEyebrow"},{x:402.12791442871094,y:207.89000988006592,z:9.383859634399414,name:"leftEyebrow"},{x:410.8693313598633,y:191.6182279586792,z:41.27030849456787,name:"faceOval"},{x:364.9509811401367,y:210.40483474731445,z:-3.758212625980377},{x:375.94444274902344,y:221.1331844329834,z:8.368442058563232},{x:392.1904754638672,y:305.0360298156738,z:-1.752179116010666},{x:419.50225830078125,y:307.25592613220215,z:58.96425247192383,name:"faceOval"},{x:372.0027160644531,y:268.7212657928467,z:-16.631840467453003},{x:366.1614227294922,y:271.6237449645996,z:-18.219159841537476},{x:385.00938415527344,y:305.3863334655762,z:-2.567722797393799},{x:381.99771881103516,y:304.9723720550537,z:-4.575215280056},{x:405.078125,y:203.21216583251953,z:13.713973760604858,name:"leftEyebrow"},{x:377.13207244873047,y:268.4710121154785,z:-15.266278982162476},{x:380.9713363647461,y:205.36980628967285,z:-.7250899076461792,name:"leftEyebrow"},{x:381.7788314819336,y:198.9268398284912,z:-1.184653863310814,name:"leftEyebrow"},{x:385.5204772949219,y:172.1484375,z:16.04826807975769,name:"faceOval"},{x:407.94189453125,y:196.76236152648926,z:25.723915100097656},{x:383.03890228271484,y:184.5157527923584,z:7.393874526023865},{x:411.61781311035156,y:210.79241752624512,z:22.315845489501953,name:"leftEyebrow"},{x:414.30870056152344,y:208.4643030166626,z:37.021894454956055},{x:364.28722381591797,y:298.35777282714844,z:-21.86065673828125},{x:371.3682556152344,y:299.78848457336426,z:-17.834001779556274},{x:376.88201904296875,y:301.6696071624756,z:-13.153743743896484},{x:370.2193832397461,y:270.49095153808594,z:-15.569736957550049},{x:383.5081100463867,y:305.2726364135742,z:-3.673594295978546},{x:380.73760986328125,y:305.96869468688965,z:-8.660228252410889},{x:381.2334442138672,y:304.63574409484863,z:-4.820316135883331,name:"lips"},{x:368.1698989868164,y:264.8884963989258,z:-25.653886795043945},{x:373.5087203979492,y:303.4233856201172,z:-10.95950722694397,name:"lips"},{x:368.4544372558594,y:303.29601287841797,z:-14.169161319732666,name:"lips"},{x:362.76554107666016,y:303.5735607147217,z:-16.911956071853638,name:"lips"},{x:366.60980224609375,y:324.8870658874512,z:-15.616422891616821},{x:365.7067108154297,y:315.95678329467773,z:-20.903596878051758,name:"lips"},{x:365.0083923339844,y:311.2232208251953,z:-21.066999435424805},{x:364.1508102416992,y:307.0583438873291,z:-18.907777070999146},{x:363.37512969970703,y:304.5721435546875,z:-17.42550015449524,name:"lips"},{x:374.580078125,y:304.3059539794922,z:-11.40302300453186,name:"lips"},{x:375.55362701416016,y:305.0998020172119,z:-12.861957550048828},{x:377.2437286376953,y:307.1674346923828,z:-14.215847253799438},{x:378.68587493896484,y:309.9015712738037,z:-13.223772048950195,name:"lips"},{x:383.8992691040039,y:290.29629707336426,z:-9.97326910495758},{x:423.3871841430664,y:271.91688537597656,z:74.37058925628662,name:"faceOval"},{x:377.68043518066406,y:304.62209701538086,z:-7.603961229324341,name:"lips"},{x:379.00428771972656,y:304.9314594268799,z:-8.57852816581726},{x:364.00279998779297,y:275.2813911437988,z:-19.25792098045349},{x:374.68231201171875,y:273.82555961608887,z:-11.28047227859497},{x:365.0354766845703,y:273.4548568725586,z:-18.791062831878662},{x:380.61901092529297,y:249.8848056793213,z:.15501167625188828},{x:391.14158630371094,y:254.7934627532959,z:2.0906515419483185},{x:378.1761169433594,y:264.9612236022949,z:-12.605184316635132},{x:400.9540557861328,y:179.99592304229736,z:27.82477855682373,name:"faceOval"},{x:398.0038833618164,y:188.50656509399414,z:16.094952821731567},{x:394.8717498779297,y:199.0359592437744,z:6.226727366447449,name:"leftEyebrow"},{x:382.10926055908203,y:316.83926582336426,z:-8.946179747581482},{x:366.51588439941406,y:200.32583713531494,z:-5.24632453918457,name:"leftEyebrow"},{x:367.4893569946289,y:183.87210845947266,z:1.9039081037044525},{x:368.6243438720703,y:168.8127565383911,z:8.736093044281006,name:"faceOval"},{x:398.96175384521484,y:234.9675178527832,z:13.713973760604858},{x:412.9645538330078,y:242.23042488098145,z:23.272905349731445},{x:372.05257415771484,y:231.41919136047363,z:9.226294755935669},{x:406.0722351074219,y:223.58965873718262,z:18.370890617370605},{x:368.27442169189453,y:240.2039337158203,z:-4.166713654994965},{x:372.3575210571289,y:260.66442489624023,z:-24.976940155029297},{x:419.2244338989258,y:247.9079246520996,z:30.299127101898193},{x:409.43885803222656,y:246.60913467407227,z:16.398411989212036},{x:401.69139862060547,y:248.76328468322754,z:9.395531415939331},{x:389.7608184814453,y:247.56915092468262,z:5.841569304466248},{x:380.5461883544922,y:244.55984115600586,z:4.263003468513489},{x:373.25817108154297,y:240.80214500427246,z:2.5356262922286987},{x:358.77086639404297,y:229.35615062713623,z:-10.387605428695679},{x:419.5793914794922,y:262.8478717803955,z:26.5175724029541},{x:410.8808898925781,y:222.51372814178467,z:22.199130058288574},{x:358.45714569091797,y:268.91467094421387,z:-33.17030906677246},{x:373.4129333496094,y:251.6385841369629,z:-5.771540403366089},{x:422.5408172607422,y:239.23919677734375,z:74.04378890991211,name:"faceOval"},{x:367.8171920776367,y:236.58040523529053,z:1.820748895406723},{x:378.51959228515625,y:266.2532329559326,z:-5.74819803237915},{x:403.3472442626953,y:229.05112266540527,z:19.689764976501465},{x:372.34840393066406,y:256.6451168060303,z:-21.872329711914063},{x:422.54566192626953,y:289.1587829589844,z:68.67491245269775,name:"faceOval"},{x:371.9297409057617,y:228.90116214752197,z:11.432201862335205,name:"leftEye"},{x:366.21360778808594,y:251.6158962249756,z:-28.19826364517212},{x:409.1571807861328,y:321.3156223297119,z:20.2266526222229},{x:408.52943420410156,y:331.44238471984863,z:31.09278917312622,name:"faceOval"},{x:424.2788314819336,y:267.1992301940918,z:50.467424392700195},{x:415.60352325439453,y:311.6528606414795,z:30.579242706298828},{x:418.12793731689453,y:221.59927368164063,z:46.26569747924805},{x:385.68286895751953,y:346.0184955596924,z:-5.70151150226593},{x:357.82936096191406,y:271.3758373260498,z:-24.836881160736084},{x:379.588623046875,y:257.5071716308594,z:-3.755294680595398},{x:417.4592590332031,y:234.71948146820068,z:34.5475435256958},{x:393.4684371948242,y:231.58967971801758,z:11.408859491348267,name:"leftEye"},{x:387.8864288330078,y:232.14245796203613,z:9.51808214187622,name:"leftEye"},{x:382.4981689453125,y:307.5654888153076,z:-7.522260546684265,name:"lips"},{x:419.00169372558594,y:277.8332805633545,z:26.424202919006348},{x:373.62953186035156,y:357.6375102996826,z:-5.75986921787262,name:"faceOval"},{x:392.8708267211914,y:347.72446632385254,z:10.154176950454712,name:"faceOval"},{x:400.3953552246094,y:341.0005187988281,z:19.39797878265381,name:"faceOval"},{x:382.25440979003906,y:231.66935920715332,z:8.998700976371765,name:"leftEye"},{x:377.14550018310547,y:230.4228687286377,z:9.804032444953918,name:"leftEye"},{x:373.8358688354492,y:229.64950561523438,z:11.292144060134888,name:"leftEye"},{x:414.5794677734375,y:221.67891025543213,z:29.412097930908203},{x:377.00672149658203,y:225.66201210021973,z:9.360517263412476,name:"leftEye"},{x:382.29530334472656,y:224.8431158065796,z:8.32175612449646,name:"leftEye"},{x:387.5133514404297,y:224.49507236480713,z:8.917000889778137,name:"leftEye"},{x:393.15906524658203,y:225.24795055389404,z:10.737749338150024,name:"leftEye"},{x:397.05554962158203,y:226.55359268188477,z:13.002015352249146,name:"leftEye"},{x:420.5299377441406,y:221.014666557312,z:65.40690422058105,name:"faceOval"},{x:397.06920623779297,y:230.6661558151245,z:13.807345628738403,name:"leftEye"},{x:377.94647216796875,y:285.1647090911865,z:-13.305472135543823},{x:372.1118927001953,y:267.1267318725586,z:-18.83774757385254},{x:364.9968719482422,y:282.24411964416504,z:-19.818150997161865},{x:401.973876953125,y:331.20131492614746,z:11.566424369812012},{x:394.3083190917969,y:338.86693954467773,z:3.142542541027069},{x:373.9820861816406,y:351.4504623413086,z:-13.50388765335083},{x:414.3888854980469,y:321.24735832214355,z:45.51872253417969,name:"faceOval"},{x:373.44234466552734,y:227.33163356781006,z:10.626870393753052,name:"leftEye"},{x:364.0731430053711,y:240.31539916992188,z:-13.807345628738403},{x:384.2658233642578,y:353.3793067932129,z:.7385850697755814,name:"faceOval"},{x:423.20526123046875,y:283.5176181793213,z:47.152724266052246},{x:369.42798614501953,y:304.0898895263672,z:-14.647691249847412,name:"lips"},{x:370.63812255859375,y:305.90051651000977,z:-16.211668252944946},{x:371.91192626953125,y:309.0167713165283,z:-17.84567356109619},{x:373.0583953857422,y:313.3545398712158,z:-17.378815412521362,name:"lips"},{x:375.39905548095703,y:321.09289169311523,z:-13.118728399276733},{x:379.2567825317383,y:304.3582534790039,z:-7.924926280975342},{x:381.18797302246094,y:303.7031364440918,z:-7.843226194381714},{x:383.0918502807617,y:302.4884605407715,z:-7.6506465673446655,name:"lips"},{x:389.09461975097656,y:297.1475315093994,z:-5.5497825145721436},{x:411.6408920288086,y:280.24898529052734,z:12.02161192893982},{x:363.3110809326172,y:234.27620887756348,z:-6.775286793708801},{x:366.0474395751953,y:223.29872131347656,z:6.827808618545532},{x:370.34427642822266,y:225.1457118988037,z:9.558931589126587},{x:377.5371551513672,y:303.60079765319824,z:-7.358860373497009,name:"lips"},{x:412.9557800292969,y:299.53579902648926,z:19.39797878265381},{x:360.0810241699219,y:221.72012329101563,z:-2.153385728597641},{x:379.82784271240234,y:329.47723388671875,z:-10.48097848892212},{x:359.08477783203125,y:235.7911491394043,z:-18.079102039337158},{x:369.6688461303711,y:251.5407943725586,z:-14.962821006774902},{x:369.5555114746094,y:333.5307312011719,z:-15.67478060722351},{x:394.0193176269531,y:315.6973171234131,z:-.9920747578144073},{x:383.78997802734375,y:272.7268695831299,z:-4.689012169837952},{x:387.67765045166016,y:323.6722755432129,z:-5.640236139297485},{x:397.8769302368164,y:272.1331214904785,z:-.9395531564950943},{x:389.87476348876953,y:280.5630111694336,z:-4.29218202829361},{x:403.83888244628906,y:285.1167869567871,z:3.0229100584983826},{x:372.5467300415039,y:343.1070327758789,z:-16.153310537338257},{x:374.1112518310547,y:256.3721466064453,z:-10.574349164962769},{x:399.73785400390625,y:321.77515983581543,z:4.849494695663452},{x:392.03365325927734,y:330.56447982788086,z:-1.3407598435878754},{x:398.59134674072266,y:305.93902587890625,z:1.517290621995926},{x:417.95997619628906,y:290.9716987609863,z:26.89105987548828},{x:406.04541778564453,y:307.35154151916504,z:8.666064143180847},{x:420.75328826904297,y:298.40752601623535,z:41.78385257720947},{x:395.4522705078125,y:291.4153575897217,z:-2.1752697229385376},{x:368.6452102661133,y:245.8882999420166,z:-9.453888535499573},{x:370.34900665283203,y:263.56690406799316,z:-26.75100326538086},{x:374.98477935791016,y:266.6126346588135,z:-19.77146625518799},{x:366.99840545654297,y:258.12140464782715,z:-31.372904777526855},{x:371.00616455078125,y:217.63479709625244,z:5.60522198677063},{x:381.30577087402344,y:214.14087295532227,z:4.983716309070587},{x:390.1496124267578,y:213.38221549987793,z:5.593550801277161},{x:397.7696990966797,y:214.3659782409668,z:8.57852816581726},{x:403.1652069091797,y:217.65509605407715,z:13.013685941696167},{x:407.3551940917969,y:230.72525024414063,z:22.444231510162354},{x:424.0876770019531,y:251.7839241027832,z:51.16771221160889},{x:403.50196838378906,y:239.88757610321045,z:15.803166627883911},{x:397.31719970703125,y:241.49806022644043,z:11.233787536621094},{x:388.99425506591797,y:241.4366912841797,z:7.948269248008728},{x:380.7804489135742,y:239.78078842163086,z:6.600214838981628},{x:374.01336669921875,y:237.11946487426758,z:6.349278092384338},{x:369.39125061035156,y:234.35351371765137,z:5.987462401390076},{x:422.9730987548828,y:255.76455116271973,z:76.61150932312012,name:"faceOval"},{x:374.73915100097656,y:269.24214363098145,z:-16.608498096466064},{x:364.61681365966797,y:245.71088790893555,z:-20.02823829650879},{x:365.3834533691406,y:263.34174156188965,z:-32.32996463775635},{x:361.58252716064453,y:267.8273677825928,z:-30.345816612243652},{x:365.37208557128906,y:265.0249671936035,z:-29.178667068481445},{x:372.72605895996094,y:272.05135345458984,z:-14.834434986114502},{x:360.48614501953125,y:268.34827423095703,z:-32.189905643463135},{x:359.9516296386719,y:270.8049201965332,z:-24.650139808654785},{x:369.5049285888672,y:229.01945114135742,z:10.107489824295044},{x:365.5447769165039,y:230.24096488952637,z:5.593550801277161},{x:363.50669860839844,y:230.6208372116089,z:.43622106313705444},{x:399.3529510498047,y:227.65677452087402,z:15.35965085029602,name:"leftEye"},{x:402.5693130493164,y:224.60190296173096,z:15.931552648544312}],box:{xMin:277.8318977355957,yMin:168.7741756439209,xMax:424.2788314819336,yMax:359.8348903656006,width:146.4469337463379,height:191.0607147216797}},SAMPLE_FACELANDMARKER_RESULT:{faceLandmarks:[[{x:.5760777592658997,y:.8639070391654968,z:-.030997956171631813},{x:.572094738483429,y:.7886289358139038,z:-.07189624011516571},{x:.5723551511764526,y:.8075382709503174,z:-.03578168898820877},{x:.5548420548439026,y:.7188365459442139,z:-.057787876576185226},{x:.5706077814102173,y:.7674974799156189,z:-.07740399986505508},{x:.5681378245353699,y:.7387768030166626,z:-.07356284558773041},{x:.5621535181999207,y:.6681165099143982,z:-.04189874976873398},{x:.46613582968711853,y:.6679812073707581,z:.011289681307971478},{x:.5579932928085327,y:.6174106597900391,z:-.03502821549773216},{x:.5563451647758484,y:.5905600190162659,z:-.03928658738732338},{x:.5487832427024841,y:.4900572597980499,z:-.029898937791585922},{x:.5765544176101685,y:.8692144751548767,z:-.02831427752971649},{x:.5771114230155945,y:.873644232749939,z:-.02345779910683632},{x:.5771905779838562,y:.877016007900238,z:-.016658689826726913},{x:.5778058767318726,y:.8770116567611694,z:-.014505492523312569},{x:.5783766508102417,y:.8835000991821289,z:-.015996402129530907},{x:.5792440176010132,y:.8913810849189758,z:-.01924579218029976},{x:.5796768069267273,y:.8996334671974182,z:-.018261712044477463},{x:.5817288160324097,y:.9255813956260681,z:-.007126849144697189},{x:.5726592540740967,y:.7992473244667053,z:-.0643521398305893},{x:.5579419136047363,y:.7996989488601685,z:-.04566684365272522},{x:.4216199815273285,y:.5958762764930725,z:.06776496022939682},{x:.5052269697189331,y:.6796539425849915,z:-.0010737782577052712},{x:.49243026971817017,y:.6838865876197815,z:-5227324436418712e-19},{x:.4796970784664154,y:.6856290102005005,z:.002684245817363262},{x:.4618356227874756,y:.6764569878578186,z:.013439622707664967},{x:.5160380601882935,y:.6737282276153564,z:-17607348127057776e-21},{x:.48070961236953735,y:.6255870461463928,z:-.008339674212038517},{x:.49719780683517456,y:.6256808042526245,z:-.008027955889701843},{x:.46674346923828125,y:.6317623853683472,z:-.004460199736058712},{x:.4582492709159851,y:.641118049621582,z:.0011905613355338573},{x:.45408669114112854,y:.6911458969116211,z:.020514748990535736},{x:.535312294960022,y:.9619986414909363,z:.012499462813138962},{x:.4608460068702698,y:.6628725528717041,z:.01517564244568348},{x:.4206731915473938,y:.6828458309173584,z:.07848648726940155},{x:.4390624463558197,y:.6796106696128845,z:.03283142298460007},{x:.5029968619346619,y:.7701570391654968,z:-.009734481573104858},{x:.5595027208328247,y:.8607323169708252,z:-.030043255537748337},{x:.5621269941329956,y:.8738374710083008,z:-.021709579974412918},{x:.5451499819755554,y:.865527331829071,z:-.022014077752828598},{x:.5351184010505676,y:.8705098032951355,z:-.011602800339460373},{x:.5495014190673828,y:.8744956254959106,z:-.016490943729877472},{x:.5395170450210571,y:.8759440779685974,z:-.007333362940698862},{x:.5183624029159546,y:.8959754705429077,z:.010520773939788342},{x:.5604349374771118,y:.7895449995994568,z:-.07082037627696991},{x:.557381272315979,y:.7687489986419678,z:-.07590588927268982},{x:.4432901442050934,y:.6308897733688354,z:.0027153254486620426},{x:.5258325338363647,y:.7151225805282593,z:-.014676518738269806},{x:.5271827578544617,y:.7833116054534912,z:-.037643320858478546},{x:.5257382988929749,y:.7717816233634949,z:-.03401920944452286},{x:.46516409516334534,y:.7705106735229492,z:.0065747760236263275},{x:.5558893084526062,y:.7420997619628906,z:-.0694495290517807},{x:.4720408320426941,y:.6066038608551025,z:-.021204356104135513},{x:.45432573556900024,y:.6158540844917297,z:-.011054684408009052},{x:.4305151402950287,y:.5608053803443909,z:.0396830290555954},{x:.5310865640640259,y:.6157484650611877,z:-.03081176057457924},{x:.5114666223526001,y:.6329749226570129,z:-.00335998204536736},{x:.506435751914978,y:.8786543607711792,z:.012980876490473747},{x:.4480472207069397,y:.8640613555908203,z:.12569651007652283},{x:.5372058153152466,y:.7942581176757813,z:-.03168361634016037},{x:.5488379597663879,y:.8001630306243896,z:-.03280917927622795},{x:.5213388204574585,y:.8794381618499756,z:.011892606504261494},{x:.5242055654525757,y:.8789222240447998,z:.008370225317776203},{x:.4477175176143646,y:.6039950251579285,z:-.0050799972377717495},{x:.526964008808136,y:.7916748523712158,z:-.02968614175915718},{x:.4971255660057068,y:.6050706505775452,z:-.028175678104162216},{x:.4938119053840637,y:.5882453918457031,z:-.03210941329598427},{x:.4757143557071686,y:.5094879865646362,z:-.01300730835646391},{x:.43947282433509827,y:.5816648006439209,z:.01415177434682846},{x:.485664039850235,y:.5477864146232605,z:-.023685332387685776},{x:.43635931611061096,y:.6226438283920288,z:.013606148771941662},{x:.42910251021385193,y:.6102726459503174,z:.03926564007997513},{x:.5605402588844299,y:.8680099248886108,z:-.027318159118294716},{x:.5474816560745239,y:.8702861070632935,z:-.019686367362737656},{x:.5373021364212036,y:.8728838562965393,z:-.010484928265213966},{x:.540735125541687,y:.7979167103767395,z:-.029073253273963928},{x:.5228585004806519,y:.87913578748703,z:.009915109723806381},{x:.530497670173645,y:.8815253973007202,z:.0020524784922599792},{x:.5259912610054016,y:.8790552616119385,z:.007895970717072487},{x:.5433906316757202,y:.7882310748100281,z:-.05121905356645584},{x:.541388213634491,y:.8777219653129578,z:-.00466804439201951},{x:.5515822172164917,y:.8767023086547852,z:-.010475946590304375},{x:.5637003779411316,y:.877059817314148,z:-.015273625031113625},{x:.5640299320220947,y:.9263423085212708,z:-.00658724969252944},{x:.5642300248146057,y:.8993074893951416,z:-.017653480172157288},{x:.5637336373329163,y:.8910360932350159,z:-.01852807030081749},{x:.5637134313583374,y:.8837276697158813,z:-.01482592523097992},{x:.564205527305603,y:.8768964409828186,z:-.01331155002117157},{x:.5419867634773254,y:.8778373599052429,z:-.0037720394320786},{x:.5404468774795532,y:.880696177482605,z:-.005610354244709015},{x:.5392338633537292,y:.8845721483230591,z:-.007352025713771582},{x:.538469672203064,y:.8891173601150513,z:-.005154991988092661},{x:.5189250111579895,y:.8452741503715515,z:-.009755070321261883},{x:.4258975088596344,y:.7662280797958374,z:.1387351155281067},{x:.5725725293159485,y:.8041572570800781,z:-.04583907872438431},{x:.5342061519622803,y:.8785833120346069,z:.002659974154084921},{x:.5324031114578247,y:.8804071545600891,z:.0017832003068178892},{x:.5538818836212158,y:.8078407645225525,z:-.03254539892077446},{x:.5325431823730469,y:.8026832938194275,z:-.019140373915433884},{x:.5514076948165894,y:.8043903112411499,z:-.03313535451889038},{x:.5131856203079224,y:.7284771800041199,z:-.009399853646755219},{x:.49331504106521606,y:.7443980574607849,z:-.005225230939686298},{x:.5239617824554443,y:.7807451486587524,z:-.025881027802824974},{x:.4473606050014496,y:.5315827131271362,z:.011164786294102669},{x:.45718759298324585,y:.5604941248893738,z:-.005943301599472761},{x:.4670005738735199,y:.5909327268600464,z:-.019681761041283607},{x:.5311570167541504,y:.9076261520385742,z:.00389476353302598},{x:.5249923467636108,y:.5893563628196716,z:-.037981919944286346},{x:.5166932344436646,y:.5429551005363464,z:-.03319704160094261},{x:.5085030198097229,y:.49676206707954407,z:-.02691275253891945},{x:.4687720239162445,y:.6834565997123718,z:.008113506250083447},{x:.4426414966583252,y:.7069531679153442,z:.028577271848917007},{x:.5230373740196228,y:.6675713658332825,z:.001773772411979735},{x:.4481240212917328,y:.6527872085571289,z:.012414850294589996},{x:.5339856743812561,y:.7012367844581604,z:-.020220188423991203},{x:.5347223281860352,y:.7761190533638,z:-.05141595005989075},{x:.4315067231655121,y:.7211957573890686,z:.04381405934691429},{x:.45203351974487305,y:.7206180095672607,z:.017288070172071457},{x:.46892452239990234,y:.7265436053276062,z:.005602988880127668},{x:.49314674735069275,y:.7202282547950745,z:-6408205372281373e-19},{x:.5104925632476807,y:.7091827392578125,z:-.00362918758764863},{x:.5232142210006714,y:.698553740978241,z:-.00787867046892643},{x:.5497883558273315,y:.6743605136871338,z:-.036349106580019},{x:.43658503890037537,y:.7627100348472595,z:.042555369436740875},{x:.4397648870944977,y:.6528646349906921,z:.017956094816327095},{x:.5653332471847534,y:.7992802858352661,z:-.06365057826042175},{x:.5285563468933105,y:.736810564994812,z:-.018836988136172295},{x:.4180678725242615,y:.6792560815811157,z:.12284679710865021},{x:.5328429937362671,y:.6865872144699097,z:-.010484723374247551},{x:.5230283141136169,y:.7809416055679321,z:-.011922398582100868},{x:.4551771283149719,y:.6650775074958801,z:.01774493046104908},{x:.5337203741073608,y:.7618928551673889,z:-.04697106033563614},{x:.43463975191116333,y:.8133478164672852,z:.1354849934577942},{x:.5225707292556763,y:.6605283617973328,z:.004980515688657761},{x:.5441933870315552,y:.7497199773788452,z:-.06091512367129326},{x:.4774007797241211,y:.9159183502197266,z:.059622734785079956},{x:.48068761825561523,y:.9364941716194153,z:.08404944837093353},{x:.4268292486667633,y:.7657528519630432,z:.09051097184419632},{x:.46051913499832153,y:.8880485892295837,z:.0738474428653717},{x:.4243420660495758,y:.6434382200241089,z:.06230505183339119},{x:.5342157483100891,y:.9835634231567383,z:.021662971004843712},{x:.5668109655380249,y:.8042187094688416,z:-.044937074184417725},{x:.5176341533660889,y:.7530587315559387,z:-.012967454269528389},{x:.430206298828125,y:.6835605502128601,z:.04612284153699875},{x:.4794231951236725,y:.6732114553451538,z:.003970044665038586},{x:.49073347449302673,y:.6722435355186462,z:8692514384165406e-19},{x:.5294116139411926,y:.884677529335022,z:.004413890186697245},{x:.4430122375488281,y:.80235356092453,z:.04987282305955887},{x:.5603825449943542,y:1.0092442035675049,z:.026417359709739685},{x:.5186598300933838,y:.9828659892082214,z:.0513598807156086},{x:.5010536909103394,y:.9640932679176331,z:.06591596454381943},{x:.5524769425392151,y:.539441704750061,z:-.035816047340631485},{x:.5879997611045837,y:1.0091472864151,z:.02285068854689598},{x:.5016193985939026,y:.6684437990188599,z:28415941051207483e-20},{x:.511952817440033,y:.6642197370529175,z:.0021144719794392586},{x:.5194343328475952,y:.6623469591140747,z:.004674181342124939},{x:.4321230351924896,y:.6496355533599854,z:.03124697133898735},{x:.508686363697052,y:.6479565501213074,z:-44765998609364033e-20},{x:.4963986277580261,y:.6431032419204712,z:-.0032507688738405704},{x:.4845542013645172,y:.6430778503417969,z:-.002903624437749386},{x:.4733612537384033,y:.647506833076477,z:23347247042693198e-20},{x:.4668654501438141,y:.653346598148346,z:.004762572236359119},{x:.41815051436424255,y:.633708119392395,z:.09809435904026031},{x:.47159942984580994,y:.6711485385894775,z:.007849935442209244},{x:.5734396576881409,y:.8256140351295471,z:-.03155219927430153},{x:.5306524038314819,y:.8337990641593933,z:-.018351426348090172},{x:.5371729135513306,y:.7910830974578857,z:-.037286680191755295},{x:.5549534559249878,y:.8275275826454163,z:-.030664825811982155},{x:.5597432255744934,y:.6418541669845581,z:-.03318847343325615},{x:.4958484172821045,y:.9429569244384766,z:.048340678215026855},{x:.5140507817268372,y:.9634028077125549,z:.03589847311377525},{x:.5587693452835083,y:.9951097369194031,z:.00908728688955307},{x:.46411189436912537,y:.9051855206489563,z:.10601935535669327},{x:.5181609392166138,y:.6554316878318787,z:.002546071307733655},{x:.5436590909957886,y:.7085841298103333,z:-.03844436630606651},{x:.5872187614440918,y:.9960382580757141,z:.0063423276878893375},{x:.5379653573036194,y:.9989125728607178,z:.03636329993605614},{x:.4350326955318451,y:.8088565468788147,z:.09147704392671585},{x:.5523084998130798,y:.8773422837257385,z:-.009068487212061882},{x:.5510149598121643,y:.8816931843757629,z:-.011043853126466274},{x:.5503793954849243,y:.88776695728302,z:-.01348799467086792},{x:.5501549243927002,y:.8954370617866516,z:-.012142189778387547},{x:.546072781085968,y:.9192524552345276,z:-.003157563041895628},{x:.5314661860466003,y:.8771666884422302,z:5075141089037061e-19},{x:.5293324589729309,y:.8762547969818115,z:39177737198770046e-20},{x:.5275698900222778,y:.8750609755516052,z:47732755774632096e-21},{x:.5104271173477173,y:.8607332110404968,z:.0012934643309563398},{x:.45938700437545776,y:.8134918212890625,z:.023569690063595772},{x:.5418947339057922,y:.6864100694656372,z:-.027333909645676613},{x:.531914234161377,y:.6456130743026733,z:-.005434140563011169},{x:.523697018623352,y:.647885262966156,z:-2466466394253075e-19},{x:.5338191390037537,y:.8783687353134155,z:.002268768846988678},{x:.46226605772972107,y:.8610277771949768,z:.04718952998518944},{x:.5434442758560181,y:.6456181406974792,z:-.02327350154519081},{x:.5399754643440247,y:.940219521522522,z:.005075343884527683},{x:.5661457777023315,y:.71457839012146,z:-.06242101639509201},{x:.5523148775100708,y:.6974870562553406,z:-.04863070324063301},{x:.5639959573745728,y:.6923378109931946,z:-.05180761218070984},{x:.5367592573165894,y:.7423217296600342,z:-.03623027727007866},{x:.5853689908981323,y:.9752064943313599,z:-.002361974213272333},{x:.5835235118865967,y:.9493685960769653,z:-.003941743168979883},{x:.5615018606185913,y:.949194610118866,z:-.0015953965485095978},{x:.5068561434745789,y:.9048219323158264,z:.01862684078514576},{x:.5134067535400391,y:.7971825003623962,z:-.008485661819577217},{x:.5223897099494934,y:.925589919090271,z:.01249657291918993},{x:.48500555753707886,y:.7959478497505188,z:-.0032065745908766985},{x:.5037734508514404,y:.8184596300125122,z:-.004932103678584099},{x:.4766361117362976,y:.828806459903717,z:.01027688942849636},{x:.5589827299118042,y:.974656343460083,z:9666886180639267e-19},{x:.5294582843780518,y:.7541216611862183,z:-.025603046640753746},{x:.4973002076148987,y:.9208990931510925,z:.031931452453136444},{x:.5163551568984985,y:.9432790875434875,z:.024321340024471283},{x:.49399662017822266,y:.8814862370491028,z:.018687399104237556},{x:.44948166608810425,y:.836137592792511,z:.05702034756541252},{x:.47898444533348083,y:.8836610913276672,z:.03150695189833641},{x:.4454479217529297,y:.8499438166618347,z:.08868525922298431},{x:.49572959542274475,y:.8452823758125305,z:.0036111653316766024},{x:.5362502336502075,y:.7222585678100586,z:-.027912352234125137},{x:.5393770337104797,y:.7850722074508667,z:-.05415399745106697},{x:.531399667263031,y:.7898418307304382,z:-.03883346915245056},{x:.5451627373695374,y:.7717036604881287,z:-.06480253487825394},{x:.5206395983695984,y:.6287745833396912,z:-.010521138086915016},{x:.4974782466888428,y:.6191938519477844,z:-.014098240062594414},{x:.4774145185947418,y:.6193130612373352,z:-.013643337413668633},{x:.4616098403930664,y:.6259890198707581,z:-.008448202162981033},{x:.4516478478908539,y:.6368461847305298,z:9050309745362028e-20},{x:.4485096037387848,y:.6719120740890503,z:.022984720766544342},{x:.42177659273147583,y:.7240667343139648,z:.08511673659086227},{x:.4616215229034424,y:.6988231539726257,z:.014238474890589714},{x:.4755798876285553,y:.7034608721733093,z:.00625590980052948},{x:.4924992024898529,y:.7005885243415833,z:9391739731654525e-19},{x:.5082254409790039,y:.693384051322937,z:-9464038303121924e-19},{x:.5203112959861755,y:.6849707961082458,z:-.0022114769089967012},{x:.52867591381073,y:.6779075860977173,z:-.002962538506835699},{x:.4213953912258148,y:.7219811677932739,z:.1350894570350647},{x:.5320829749107361,y:.794858992099762,z:-.03181503340601921},{x:.5452795028686523,y:.7286570072174072,z:-.04771539941430092},{x:.5496407747268677,y:.7866933345794678,z:-.06452003121376038},{x:.557040274143219,y:.7962084412574768,z:-.05837344378232956},{x:.549176812171936,y:.7895247936248779,z:-.057761140167713165},{x:.5362890362739563,y:.8005836606025696,z:-.026903774589300156},{x:.560200035572052,y:.7983731031417847,z:-.06172555685043335},{x:.5616944432258606,y:.8022753596305847,z:-.045200999826192856},{x:.5273328423500061,y:.6611284017562866,z:.0029021520167589188},{x:.534850537776947,y:.6660012006759644,z:-.005215510260313749},{x:.5394860506057739,y:.6701375246047974,z:-.014931917190551758},{x:.4634307324886322,y:.658291757106781,z:.009295716881752014},{x:.4538393020629883,y:.6519932150840759,z:.00930330716073513},{x:.5776031613349915,y:.7159298658370972,z:-.057365912944078445},{x:.6504855155944824,y:.6461779475212097,z:.014184834435582161},{x:.5860154032707214,y:.7962266206741333,z:-.04522843658924103},{x:.6842049360275269,y:.5631637573242188,z:.07207967340946198},{x:.6152560710906982,y:.6674962639808655,z:7529259892180562e-19},{x:.6280948519706726,y:.6684326529502869,z:.0016892586136236787},{x:.6408625245094299,y:.6663892269134521,z:.005331226624548435},{x:.6557814478874207,y:.6534678936004639,z:.01646413467824459},{x:.6035663485527039,y:.6639701724052429,z:.0013799630105495453},{x:.6329053044319153,y:.608010470867157,z:-.006195899099111557},{x:.6167260408401489,y:.6117533445358276,z:-.006319951266050339},{x:.6471013426780701,y:.6112449765205383,z:-.0017843559617176652},{x:.6560901999473572,y:.6185776591300964,z:.004047257360070944},{x:.6666946411132813,y:.6651176810264587,z:.023647578433156013},{x:.6311345100402832,y:.9495396018028259,z:.014004078693687916},{x:.6544655561447144,y:.6397901773452759,z:.01809609681367874},{x:.6965808868408203,y:.6482675075531006,z:.08304904401302338},{x:.679817259311676,y:.650188148021698,z:.03632688894867897},{x:.6336516737937927,y:.7541458010673523,z:-.007742783520370722},{x:.5921701192855835,y:.8567668199539185,z:-.029399123042821884},{x:.591663658618927,y:.870215654373169,z:-.02103729173541069},{x:.6068367958068848,y:.8584195375442505,z:-.020668085664510727},{x:.6176617741584778,y:.860965371131897,z:-.009790095500648022},{x:.6040634512901306,y:.8686612844467163,z:-.015289564616978168},{x:.6143736839294434,y:.8671170473098755,z:-.005712216719985008},{x:.6373105049133301,y:.8815656900405884,z:.012672550976276398},{x:.5832505822181702,y:.7866312861442566,z:-.07051534950733185},{x:.5836675763130188,y:.7658692598342896,z:-.07566110789775848},{x:.6709531545639038,y:.604898989200592,z:.005951565690338612},{x:.6029891967773438,y:.705652117729187,z:-.013388276100158691},{x:.6131622195243835,y:.7728396058082581,z:-.036248479038476944},{x:.6123163104057312,y:.7612020373344421,z:-.03264721855521202},{x:.6696187853813171,y:.744706928730011,z:.009673702530562878},{x:.5803102254867554,y:.7385968565940857,z:-.0689152330160141},{x:.6404349207878113,y:.5877999663352966,z:-.01929756999015808},{x:.6588467955589294,y:.5929454565048218,z:-.008487257175147533},{x:.6720337867736816,y:.530631422996521,z:.043437421321868896},{x:.584305465221405,y:.6099005341529846,z:-.030301367864012718},{x:.6034283638000488,y:.6217452883720398,z:-.001970183802768588},{x:.6460927724838257,y:.8608663082122803,z:.015541625209152699},{x:.6957815289497375,y:.8326103091239929,z:.13015234470367432},{x:.6043362617492676,y:.7861682772636414,z:-.030476901680231094},{x:.594293475151062,y:.7942103147506714,z:-.032218821346759796},{x:.6324057579040527,y:.8665139675140381,z:.014255806803703308},{x:.6296147704124451,y:.8667733669281006,z:.010388285852968693},{x:.663644552230835,y:.5798642635345459,z:-.0022301070857793093},{x:.6140630841255188,y:.7809288501739502,z:-.02835679054260254},{x:.615908145904541,y:.5921698212623596,z:-.026804860681295395},{x:.617181122303009,y:.5748661756515503,z:-.03060605563223362},{x:.6222207546234131,y:.49137672781944275,z:-.011151673272252083},{x:.6669357419013977,y:.5541607141494751,z:.017466170713305473},{x:.6182981729507446,y:.5320425629615784,z:-.021793590858578682},{x:.6760554313659668,y:.595052182674408,z:.017115700989961624},{x:.6801463961601257,y:.5800720453262329,z:.043127160519361496},{x:.5922210812568665,y:.8644017577171326,z:-.02662893570959568},{x:.6054555177688599,y:.8637874722480774,z:-.018363753333687782},{x:.6161889433860779,y:.8641164898872375,z:-.008808949030935764},{x:.6017249822616577,y:.7901403307914734,z:-.028126630932092667},{x:.631446123123169,y:.8664817810058594,z:.012112865224480629},{x:.6249198913574219,y:.8716511130332947,z:.003882825840264559},{x:.6281915903091431,y:.867301881313324,z:.009891441091895103},{x:.5986843109130859,y:.7813931703567505,z:-.050227612257003784},{x:.6126407384872437,y:.869275689125061,z:-.0031255714129656553},{x:.6027271151542664,y:.8711842894554138,z:-.009324162267148495},{x:.59088134765625,y:.8742044568061829,z:-.014608660712838173},{x:.5984604358673096,y:.9216185212135315,z:-.005981989670544863},{x:.5950398445129395,y:.8964707255363464,z:-.01703473925590515},{x:.5941568613052368,y:.8882410526275635,z:-.017784785479307175},{x:.5928806662559509,y:.8803883194923401,z:-.014153128489851952},{x:.5909661054611206,y:.8748103976249695,z:-.012609979137778282},{x:.6128016710281372,y:.8702545762062073,z:-.0022550546564161777},{x:.6150846481323242,y:.8726804256439209,z:-.00414019962772727},{x:.6173093914985657,y:.8770190477371216,z:-.005970994010567665},{x:.619335412979126,y:.8814800977706909,z:-.0036864024586975574},{x:.6292637586593628,y:.8314558267593384,z:-.007714875973761082},{x:.702275276184082,y:.7320667505264282,z:.1433621346950531},{x:.6204835176467896,y:.8689177632331848,z:.0044869170524179935},{x:.6223508715629578,y:.8704851269721985,z:.00352082890458405},{x:.590448260307312,y:.8029727935791016,z:-.03200828656554222},{x:.6097423434257507,y:.7933741211891174,z:-.018042555078864098},{x:.59229576587677,y:.7993767261505127,z:-.032564569264650345},{x:.6171364188194275,y:.7153720259666443,z:-.007672437466681004},{x:.6389747858047485,y:.726390540599823,z:-.002999067772179842},{x:.6151940226554871,y:.769412100315094,z:-.024427521973848343},{x:.6526776552200317,y:.505868136882782,z:.01412637997418642},{x:.6475822329521179,y:.5375454425811768,z:-.0033899128902703524},{x:.6433356404304504,y:.5714520215988159,z:-.017428796738386154},{x:.626949667930603,y:.8962116837501526,z:.005602736957371235},{x:.5868416428565979,y:.5829002261161804,z:-.03727729618549347},{x:.5877229571342468,y:.5345035791397095,z:-.032396964728832245},{x:.5887066125869751,y:.48655083775520325,z:-.025856535881757736},{x:.6507197618484497,y:.6612282991409302,z:.011114613153040409},{x:.6803066730499268,y:.677992045879364,z:.032125361263751984},{x:.5963194370269775,y:.6598632335662842,z:.002976928371936083},{x:.667536199092865,y:.6274255514144897,z:.015618261881172657},{x:.5930740833282471,y:.6940041780471802,z:-.019217798486351967},{x:.6053346395492554,y:.7676517963409424,z:-.050308309495449066},{x:.6934473514556885,y:.6884298920631409,z:.04794462397694588},{x:.6738007664680481,y:.6934011578559875,z:.020697161555290222},{x:.6588084697723389,y:.7033141851425171,z:.008462334051728249},{x:.6346072554588318,y:.7029502391815186,z:.001542167621664703},{x:.6157816648483276,y:.6966525912284851,z:-.002009218093007803},{x:.6015574336051941,y:.688928484916687,z:-.006588225718587637},{x:.5746836066246033,y:.6711069345474243,z:-.03597589209675789},{x:.6947521567344666,y:.7309479117393494,z:.046707939356565475},{x:.6759101152420044,y:.6249120831489563,z:.021654341369867325},{x:.5794773101806641,y:.7971615195274353,z:-.06339326500892639},{x:.6041849851608276,y:.727514922618866,z:-.017512541264295578},{x:.6968844532966614,y:.6440950036048889,z:.12727996706962585},{x:.5910853147506714,y:.679325520992279,z:-.009497715160250664},{x:.6157375574111938,y:.7695677280426025,z:-.010624290443956852},{x:.6606494784355164,y:.6410489678382874,z:.0208158977329731},{x:.6040687561035156,y:.7531470656394958,z:-.045887019485235214},{x:.7012156248092651,y:.780247151851654,z:.14028730988502502},{x:.595149576663971,y:.6527782678604126,z:.006308757700026035},{x:.5925500392913818,y:.7436665892601013,z:-.060151755809783936},{x:.6780198812484741,y:.8905693888664246,z:.0626060739159584},{x:.676746666431427,y:.9113880395889282,z:.08726003766059875},{x:.7030686140060425,y:.7312687635421753,z:.09529774636030197},{x:.688987135887146,y:.8588417172431946,z:.07752864807844162},{x:.6883691549301147,y:.6109960675239563,z:.06669612973928452},{x:.6358906030654907,y:.9702065587043762,z:.023120900616049767},{x:.5781539678573608,y:.8023634552955627,z:-.044763918966054916},{x:.6170316934585571,y:.7408350706100464,z:-.011375460773706436},{x:.688542366027832,y:.6516284346580505,z:.050206027925014496},{x:.6385149359703064,y:.6540714502334595,z:.006462941411882639},{x:.6279382109642029,y:.6563615798950195,z:.003062846139073372},{x:.6268895268440247,y:.8736732006072998,z:.00627936702221632},{x:.6944946050643921,y:.7709181308746338,z:.053824134171009064},{x:.614617109298706,y:1.0022112131118774,z:.02719894051551819},{x:.6493719220161438,y:.9665167927742004,z:.053563784807920456},{x:.6624587178230286,y:.943530797958374,z:.068605437874794},{x:.6162528991699219,y:.6558693051338196,z:.002187855076044798},{x:.6058168411254883,y:.654328465461731,z:.0036193584091961384},{x:.5987918972969055,y:.6536934971809387,z:.006134530063718557},{x:.6831037402153015,y:.6195642948150635,z:.03511790186166763},{x:.6062582731246948,y:.6356398463249207,z:.001280312892049551},{x:.6174948811531067,y:.62776118516922,z:-.0013642468256875873},{x:.6297246217727661,y:.6253792643547058,z:-7034156005829573e-19},{x:.6407091617584229,y:.627578616142273,z:.0028144705574959517},{x:.6479622721672058,y:.6322650909423828,z:.00750273372977972},{x:.6915091276168823,y:.5990704298019409,z:.10270945727825165},{x:.6457163095474243,y:.6504453420639038,z:.010696077719330788},{x:.6164222955703735,y:.8231936097145081,z:-.016772059723734856},{x:.6042401194572449,y:.7830976843833923,z:-.03630910441279411},{x:.5922216773033142,y:.8228387236595154,z:-.029992375522851944},{x:.6646111011505127,y:.92097008228302,z:.050967294722795486},{x:.651232898235321,y:.9460107088088989,z:.038000158965587616},{x:.6140977144241333,y:.9882472157478333,z:.009882091544568539},{x:.6870781183242798,y:.8768675327301025,z:.10980932414531708},{x:.5986856818199158,y:.6456438899040222,z:.003999010659754276},{x:.585981547832489,y:.7034481763839722,z:-.0377722829580307},{x:.6342031359672546,y:.9867448806762695,z:.03786521404981613},{x:.7013950943946838,y:.776049017906189,z:.09598205983638763},{x:.6030206680297852,y:.8719133138656616,z:-.007931148633360863},{x:.6050592064857483,y:.8767156004905701,z:-.009791925549507141},{x:.6073468923568726,y:.8831382393836975,z:-.012361008673906326},{x:.6087977290153503,y:.890143632888794,z:-.01098148338496685},{x:.6147705316543579,y:.9110084772109985,z:-.0018823575228452682},{x:.622577965259552,y:.8670604825019836,z:.002609190298244357},{x:.6241236329078674,y:.8651344180107117,z:.0025534380692988634},{x:.6257084608078003,y:.8638408184051514,z:.0023300074972212315},{x:.639931321144104,y:.8449671268463135,z:.0038123116828501225},{x:.6810906529426575,y:.7856625318527222,z:.02717764675617218},{x:.583532452583313,y:.6811994910240173,z:-.026588857173919678},{x:.5855660438537598,y:.6393819451332092,z:-.004512844607234001},{x:.5932201743125916,y:.6398029327392578,z:8020466193556786e-19},{x:.6200879812240601,y:.8683351874351501,z:.00417016725987196},{x:.6842559576034546,y:.8330534100532532,z:.050836317241191864},{x:.5754412412643433,y:.6418221592903137,z:-.022838059812784195},{x:.6232790350914001,y:.9295297265052795,z:.006339520215988159},{x:.5764067769050598,y:.694546639919281,z:-.04825803264975548},{x:.59778892993927,y:.7343927621841431,z:-.035004377365112305},{x:.6042810678482056,y:.9441440105438232,z:-.0010970570147037506},{x:.6496372222900391,y:.8869078159332275,z:.021036235615611076},{x:.6274012327194214,y:.7830310463905334,z:-.006658440921455622},{x:.637792706489563,y:.9104999899864197,z:.014290250837802887},{x:.6549934148788452,y:.7748609185218811,z:-6672973395325243e-19},{x:.6404005289077759,y:.801220715045929,z:-.0026642554439604282},{x:.6671456694602966,y:.8045546412467957,z:.013180811889469624},{x:.6107483506202698,y:.9680658578872681,z:.001778992242179811},{x:.6060343980789185,y:.744587242603302,z:-.024382334202528},{x:.6602751612663269,y:.8998945355415344,z:.0344940721988678},{x:.6463775038719177,y:.9262562394142151,z:.02617623284459114},{x:.6579852104187012,y:.8602304458618164,z:.021586716175079346},{x:.6926165223121643,y:.8053340315818787,z:.061075080186128616},{x:.6724731922149658,y:.8594399690628052,z:.03457934781908989},{x:.6975721716880798,y:.8183245062828064,z:.09300774335861206},{x:.6512877941131592,y:.8258221745491028,z:.006324059329926968},{x:.594887375831604,y:.7148372530937195,z:-.026898479089140892},{x:.6017440557479858,y:.7773507833480835,z:-.05312420800328255},{x:.6096571683883667,y:.7806998491287231,z:-.037646256387233734},{x:.5952993035316467,y:.7654367685317993,z:-.06398405134677887},{x:.5950021147727966,y:.6201304793357849,z:-.009297547861933708},{x:.6165438890457153,y:.6052900552749634,z:-.012455573305487633},{x:.6362661719322205,y:.6015968918800354,z:-.011649220250546932},{x:.6522727608680725,y:.6046400666236877,z:-.005903332494199276},{x:.6625409722328186,y:.6128141283988953,z:.0030042496509850025},{x:.6688099503517151,y:.6457712054252625,z:.026322703808546066},{x:.7013440728187561,y:.6893666386604309,z:.08984331786632538},{x:.6608623266220093,y:.6749406456947327,z:.0172116681933403},{x:.6482325196266174,y:.6823726296424866,z:.008881398476660252},{x:.6313265562057495,y:.6842025518417358,z:.0031308617908507586},{x:.6147016286849976,y:.6809731721878052,z:7630771724507213e-19},{x:.6018834114074707,y:.6755372285842896,z:-8834321051836014e-19},{x:.5925027132034302,y:.670681357383728,z:-.001968748401850462},{x:.700127363204956,y:.6871103644371033,z:.13980500400066376},{x:.6095665693283081,y:.7853189706802368,z:-.03074747882783413},{x:.5880423784255981,y:.7229287028312683,z:-.04691500961780548},{x:.5930182337760925,y:.7811514139175415,z:-.06398335844278336},{x:.5867722034454346,y:.7922660112380981,z:-.05794971063733101},{x:.5933279991149902,y:.7842848896980286,z:-.05714067071676254},{x:.6063535809516907,y:.7920218706130981,z:-.02590685710310936},{x:.5839452743530273,y:.794978141784668,z:-.0615212507545948},{x:.5828126072883606,y:.8000800013542175,z:-.0449722595512867},{x:.5909603834152222,y:.6541213393211365,z:.003991890233010054},{x:.5852181911468506,y:.6602938771247864,z:-.004428438376635313},{x:.5825737714767456,y:.6651063561439514,z:-.014345290139317513},{x:.6517343521118164,y:.6362385153770447,z:.012151890434324741},{x:.6615052819252014,y:.6281577944755554,z:.0123682152479887},{x:.4856873154640198,y:.6568945646286011,z:720038078725338e-18},{x:.49988406896591187,y:.6547410488128662,z:6949726957827806e-19},{x:.48438939452171326,y:.6392973065376282,z:705525919329375e-18},{x:.47143134474754333,y:.6589511632919312,z:6980331381782889e-19},{x:.48704618215560913,y:.6752797961235046,z:6921177846379578e-19},{x:.6243702173233032,y:.640461802482605,z:-6592126737814397e-20},{x:.6390967965126038,y:.6385173797607422,z:-16105435497593135e-20},{x:.6230536699295044,y:.6224825382232666,z:-16136496560648084e-20},{x:.6095397472381592,y:.641917884349823,z:-1803556369850412e-19},{x:.6250996589660645,y:.6586247682571411,z:-1785515050869435e-19}]],faceBlendshapes:[{categories:[{index:0,score:5187174338061595e-21,categoryName:"_neutral",displayName:""},{index:1,score:.24521504342556,categoryName:"browDownLeft",displayName:""},{index:2,score:.1987743377685547,categoryName:"browDownRight",displayName:""},{index:3,score:.013400448486208916,categoryName:"browInnerUp",displayName:""},{index:4,score:.012361560948193073,categoryName:"browOuterUpLeft",displayName:""},{index:5,score:.019305096939206123,categoryName:"browOuterUpRight",displayName:""},{index:6,score:28426356948330067e-21,categoryName:"cheekPuff",displayName:""},{index:7,score:34500112633395474e-23,categoryName:"cheekSquintLeft",displayName:""},{index:8,score:483789051486383e-21,categoryName:"cheekSquintRight",displayName:""},{index:9,score:.07650448381900787,categoryName:"eyeBlinkLeft",displayName:""},{index:10,score:.05070012807846069,categoryName:"eyeBlinkRight",displayName:""},{index:11,score:.13978900015354156,categoryName:"eyeLookDownLeft",displayName:""},{index:12,score:.14198613166809082,categoryName:"eyeLookDownRight",displayName:""},{index:13,score:.2177766114473343,categoryName:"eyeLookInLeft",displayName:""},{index:14,score:.014739357866346836,categoryName:"eyeLookInRight",displayName:""},{index:15,score:.02361512929201126,categoryName:"eyeLookOutLeft",displayName:""},{index:16,score:.19679604470729828,categoryName:"eyeLookOutRight",displayName:""},{index:17,score:.04874616861343384,categoryName:"eyeLookUpLeft",displayName:""},{index:18,score:.049392376095056534,categoryName:"eyeLookUpRight",displayName:""},{index:19,score:.34944331645965576,categoryName:"eyeSquintLeft",displayName:""},{index:20,score:.2939716875553131,categoryName:"eyeSquintRight",displayName:""},{index:21,score:.005955042317509651,categoryName:"eyeWideLeft",displayName:""},{index:22,score:.006776117719709873,categoryName:"eyeWideRight",displayName:""},{index:23,score:16942436559475027e-21,categoryName:"jawForward",displayName:""},{index:24,score:.0045165494084358215,categoryName:"jawLeft",displayName:""},{index:25,score:.07803940027952194,categoryName:"jawOpen",displayName:""},{index:26,score:2090057751047425e-20,categoryName:"jawRight",displayName:""},{index:27,score:.06032035872340202,categoryName:"mouthClose",displayName:""},{index:28,score:.00228882092051208,categoryName:"mouthDimpleLeft",displayName:""},{index:29,score:.00781762320548296,categoryName:"mouthDimpleRight",displayName:""},{index:30,score:.0017093931091949344,categoryName:"mouthFrownLeft",displayName:""},{index:31,score:.0019319106359034777,categoryName:"mouthFrownRight",displayName:""},{index:32,score:8485237776767462e-20,categoryName:"mouthFunnel",displayName:""},{index:33,score:9051355300471187e-19,categoryName:"mouthLeft",displayName:""},{index:34,score:3630454302765429e-19,categoryName:"mouthLowerDownLeft",displayName:""},{index:35,score:17601238505449146e-20,categoryName:"mouthLowerDownRight",displayName:""},{index:36,score:.12865161895751953,categoryName:"mouthPressLeft",displayName:""},{index:37,score:.20137207210063934,categoryName:"mouthPressRight",displayName:""},{index:38,score:.0022203284315764904,categoryName:"mouthPucker",displayName:""},{index:39,score:9096377179957926e-19,categoryName:"mouthRight",displayName:""},{index:40,score:.34189721941947937,categoryName:"mouthRollLower",displayName:""},{index:41,score:.11409689486026764,categoryName:"mouthRollUpper",displayName:""},{index:42,score:.17172536253929138,categoryName:"mouthShrugLower",displayName:""},{index:43,score:.004038424696773291,categoryName:"mouthShrugUpper",displayName:""},{index:44,score:23205230536404997e-20,categoryName:"mouthSmileLeft",displayName:""},{index:45,score:19313619122840464e-20,categoryName:"mouthSmileRight",displayName:""},{index:46,score:.0018571305554360151,categoryName:"mouthStretchLeft",displayName:""},{index:47,score:.0023813238367438316,categoryName:"mouthStretchRight",displayName:""},{index:48,score:24323100660694763e-21,categoryName:"mouthUpperUpLeft",displayName:""},{index:49,score:3161552012898028e-20,categoryName:"mouthUpperUpRight",displayName:""},{index:50,score:108198406678639e-21,categoryName:"noseSneerLeft",displayName:""},{index:51,score:12652527630052646e-22,categoryName:"noseSneerRight",displayName:""}],headIndex:-1,headName:""}],facialTransformationMatrixes:[{rows:4,columns:4,data:[.9947517514228821,.10230544209480286,.0013679931871592999,0,-.10230997204780579,.9947447776794434,.003816320328041911,0,-970348424743861e-18,-.0039362297393381596,.9999914169311523,0,2.8888821601867676,-7.808934211730957,-30.52109146118164,1]}]}},Fx=(0,eN.createContext)({}),F_={basePath:"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.17/wasm",options:{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",outputFaceBlendshapes:!0,outputFacialTransformationMatrixes:!0}},Fb=(0,eN.forwardRef)(({basePath:e=F_.basePath,options:t=F_.options,children:i},n)=>{let a=JSON.stringify(t),s=da(async()=>{let{FilesetResolver:i,FaceLandmarker:n}=await r.e(407).then(r.bind(r,17407)),a=await i.forVisionTasks(e);return n.createFromOptions(a,t)},[e,a]);return(0,eN.useEffect)(()=>()=>{null==s||s.close(),dl([e,a])},[s,e,a]),(0,eN.useImperativeHandle)(n,()=>s,[s]),eN.createElement(Fx.Provider,{value:s},i)});function FS(){return(0,eN.useContext)(Fx)}function Fw(e,t){return e.clone().add(t).multiplyScalar(.5)}function FC(e,t,r){let i=e.localToWorld(t);return r.worldToLocal(i)}let FT=(0,eN.createContext)({}),FI=(0,eN.forwardRef)(({camera:e,videoTexture:t={start:!0},manualDetect:r=!1,faceLandmarkerResult:i,manualUpdate:n=!1,makeDefault:a,smoothTime:s=.25,offset:o=!0,offsetScalar:l=80,eyes:u=!1,eyesAsOrigin:c=!0,depth:h=.15,debug:d=!1,facemesh:f},p)=>{var m,g;let A=dY(e=>e.scene),v=dY(e=>e.camera),y=dY(e=>e.set),E=dY(e=>e.get),x=e||v,_=(0,eN.useRef)(null),[b]=(0,eN.useState)(()=>new aS),[S]=(0,eN.useState)(()=>new ni),[w]=(0,eN.useState)(()=>new ni),[C]=(0,eN.useState)(()=>new ni),[T]=(0,eN.useState)(()=>new ni),I=(0,eN.useCallback)(()=>{b.parent=x.parent;let e=_.current;if(e){let{outerRef:t,eyeRightRef:r,eyeLeftRef:i}=e;if(r.current&&i.current){let{irisDirRef:e}=r.current,{irisDirRef:n}=i.current;e.current&&n.current&&t.current&&(S.copy(FC(e.current,new ni(0,0,0),t.current)),w.copy(FC(n.current,new ni(0,0,0),t.current)),b.position.copy(FC(t.current,Fw(S,w),x.parent||A)),C.copy(FC(e.current,new ni(0,0,1),t.current)),T.copy(FC(n.current,new ni(0,0,1),t.current)),b.lookAt(t.current.localToWorld(Fw(C,T))))}else t.current&&(b.position.copy(FC(t.current,new ni(0,0,0),x.parent||A)),b.lookAt(t.current.localToWorld(new ni(0,0,1))))}return b},[x,w,T,S,C,A,b]),[M]=(0,eN.useState)(()=>new aS),R=(0,eN.useCallback)(function(e,t){if(x){var r;null!==(r=t)&&void 0!==r||(t=I()),s>0?(mu.damp3(M.position,t.position,s,e,void 0,void 0,1e-9),mu.dampE(M.rotation,t.rotation,s,e,void 0,void 0,1e-9)):(M.position.copy(t.position),M.rotation.copy(t.rotation)),x.position.copy(M.position),x.rotation.copy(M.rotation)}},[x,I,s,M.position,M.rotation]);dK((e,t)=>{n||R(t)});let B=(0,eN.useRef)(null),[D,P]=(0,eN.useState)(),L=FS(),k=(0,eN.useCallback)((e,t)=>{let r=B.current;if(!r)return;let i=r.source.data;P(null==L?void 0:L.detectForVideo(i,e))},[L]),F=(0,eN.useMemo)(()=>Object.assign(Object.create(iZ.prototype),{computeTarget:I,update:R,facemeshApiRef:_}),[I,R]);(0,eN.useImperativeHandle)(p,()=>F,[F]),(0,eN.useEffect)(()=>{if(a){let e=E().controls;return y({controls:F}),()=>y({controls:e})}},[a,F,E,y]);let O=null!=i?i:D,U=null==O?void 0:O.faceLandmarks[0],N=null==O||null==(m=O.facialTransformationMatrixes)?void 0:m[0],z=null==O||null==(g=O.faceBlendshapes)?void 0:g[0],G={onVideoFrame:k,...t};return eN.createElement(FT.Provider,{value:F},!r&&eN.createElement(eN.Suspense,{fallback:null},"src"in G?eN.createElement(IF,eU({ref:B},G)):eN.createElement(Fp,eU({ref:B},G))),eN.createElement(FA,eU({ref:_,children:eN.createElement("meshNormalMaterial",{side:e1})},f,{points:U,depth:h,facialTransformationMatrix:N,faceBlendshapes:z,eyes:u,eyesAsOrigin:c,offset:o,offsetScalar:l,debug:d,"rotation-z":Math.PI,visible:d})))}),FM=()=>(0,eN.useContext)(FT)},47764:(e,t)=>{"use strict";function r(e,t){var r=e.length;for(e.push(t);0<r;){var i=r-1>>>1,n=e[i];if(0<a(n,t))e[i]=t,e[r]=n,r=i;else break}}function i(e){return 0===e.length?null:e[0]}function n(e){if(0===e.length)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;for(var i=0,n=e.length,s=n>>>1;i<s;){var o=2*(i+1)-1,l=e[o],u=o+1,c=e[u];if(0>a(l,r))u<n&&0>a(c,l)?(e[i]=c,e[u]=r,i=u):(e[i]=l,e[o]=r,i=o);else if(u<n&&0>a(c,r))e[i]=c,e[u]=r,i=u;else break}}return t}function a(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var s,o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,u=l.now();t.unstable_now=function(){return l.now()-u}}var c=[],h=[],d=1,f=null,p=3,m=!1,g=!1,A=!1,v="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,E="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var t=i(h);null!==t;){if(null===t.callback)n(h);else if(t.startTime<=e)n(h),t.sortIndex=t.expirationTime,r(c,t);else break;t=i(h)}}function _(e){if(A=!1,x(e),!g){if(null!==i(c))g=!0,P(b);else{var t=i(h);null!==t&&L(_,t.startTime-e)}}}function b(e,r){g=!1,A&&(A=!1,y(C),C=-1),m=!0;var a=p;try{for(x(r),f=i(c);null!==f&&(!(f.expirationTime>r)||e&&!M());){var s=f.callback;if("function"==typeof s){f.callback=null,p=f.priorityLevel;var o=s(f.expirationTime<=r);r=t.unstable_now(),"function"==typeof o?f.callback=o:f===i(c)&&n(c),x(r)}else n(c);f=i(c)}if(null!==f)var l=!0;else{var u=i(h);null!==u&&L(_,u.startTime-r),l=!1}return l}finally{f=null,p=a,m=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S=!1,w=null,C=-1,T=5,I=-1;function M(){return!(t.unstable_now()-I<T)}function R(){if(null!==w){var e=t.unstable_now();I=e;var r=!0;try{r=w(!0,e)}finally{r?s():(S=!1,w=null)}}else S=!1}if("function"==typeof E)s=function(){E(R)};else if("undefined"!=typeof MessageChannel){var B=new MessageChannel,D=B.port2;B.port1.onmessage=R,s=function(){D.postMessage(null)}}else s=function(){v(R,0)};function P(e){w=e,S||(S=!0,s())}function L(e,r){C=v(function(){e(t.unstable_now())},r)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||m||(g=!0,P(b))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var r=p;p=t;try{return e()}finally{p=r}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=p;p=e;try{return t()}finally{p=r}},t.unstable_scheduleCallback=function(e,n,a){var s=t.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?s+a:s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=0x3fffffff;break;case 4:o=1e4;break;default:o=5e3}return o=a+o,e={id:d++,callback:n,priorityLevel:e,startTime:a,expirationTime:o,sortIndex:-1},a>s?(e.sortIndex=a,r(h,e),null===i(c)&&e===i(h)&&(A?(y(C),C=-1):A=!0,L(_,a-s))):(e.sortIndex=o,r(c,e),g||m||(g=!0,P(b))),e},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(e){var t=p;return function(){var r=p;p=t;try{return e.apply(this,arguments)}finally{p=r}}}},43063:(e,t,r)=>{"use strict";e.exports=r(47764)},75614:(e,t,r)=>{"use strict";var i,n,a=r(51583),s=r(14205),o=r(20100);function l(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var u=Symbol.for("react.element"),c=Symbol.for("react.transitional.element"),h=Symbol.for("react.portal"),d=Symbol.for("react.fragment"),f=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),m=Symbol.for("react.provider"),g=Symbol.for("react.consumer"),A=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),_=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var b=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var S=Symbol.for("react.memo_cache_sentinel"),w=Symbol.iterator;function C(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=w&&e[w]||e["@@iterator"])?e:null}var T,I,M=Symbol.for("react.client.reference"),R=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B=Object.assign;function D(e){if(void 0===T)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);T=t&&t[1]||"",I=-1<e.stack.indexOf("\n    at")?" (<anonymous>)":-1<e.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+T+e+I}var P=!1;function L(e,t){if(!e||P)return"";P=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(t){var r=function(){throw Error()};if(Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(r,[])}catch(e){var i=e}Reflect.construct(e,[],r)}else{try{r.call()}catch(e){i=e}e.call(r.prototype)}}else{try{throw Error()}catch(e){i=e}(r=e())&&"function"==typeof r.catch&&r.catch(function(){})}}catch(e){if(e&&i&&"string"==typeof e.stack)return[e.stack,i.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var n=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");n&&n.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=i.DetermineComponentFrameRoot(),s=a[0],o=a[1];if(s&&o){var l=s.split("\n"),u=o.split("\n");for(n=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;n<u.length&&!u[n].includes("DetermineComponentFrameRoot");)n++;if(i===l.length||n===u.length)for(i=l.length-1,n=u.length-1;1<=i&&0<=n&&l[i]!==u[n];)n--;for(;1<=i&&0<=n;i--,n--)if(l[i]!==u[n]){if(1!==i||1!==n)do if(i--,n--,0>n||l[i]!==u[n]){var c="\n"+l[i].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=i&&0<=n);break}}}finally{P=!1,Error.prepareStackTrace=r}return(r=e?e.displayName||e.name:"")?D(r):""}function k(e){try{var t="";do t+=function(e){switch(e.tag){case 26:case 27:case 5:return D(e.type);case 16:return D("Lazy");case 13:return D("Suspense");case 19:return D("SuspenseList");case 0:case 15:return e=L(e.type,!1);case 11:return e=L(e.type.render,!1);case 1:return e=L(e.type,!0);default:return""}}(e),e=e.return;while(e);return t}catch(e){return"\nError generating stack: "+e.message+"\n"+e.stack}}function F(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do 0!=(4098&(t=e).flags)&&(r=t.return),e=t.return;while(e)}return 3===t.tag?r:null}function O(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function U(e){if(F(e)!==e)throw Error(l(188))}var N=Array.isArray,z=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G={pending:!1,data:null,method:null,action:null},H=[],Q=-1;function V(e){return{current:e}}function W(e){0>Q||(e.current=H[Q],H[Q]=null,Q--)}function j(e,t){H[++Q]=e.current,e.current=t}var Y=V(null),K=V(null),q=V(null),X=V(null);function $(e,t){switch(j(q,t),j(K,e),j(Y,null),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)&&(t=t.namespaceURI)?l4(t):0;break;default:if(t=(e=8===e?t.parentNode:t).tagName,e=e.namespaceURI)t=l5(e=l4(e),t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}W(Y),j(Y,t)}function J(){W(Y),W(K),W(q)}function Z(e){null!==e.memoizedState&&j(X,e);var t=Y.current,r=l5(t,e.type);t!==r&&(j(K,e),j(Y,r))}function ee(e){K.current===e&&(W(Y),W(K)),X.current===e&&(W(X),uL._currentValue=G)}var et=Object.prototype.hasOwnProperty,er=a.unstable_scheduleCallback,ei=a.unstable_cancelCallback,en=a.unstable_shouldYield,ea=a.unstable_requestPaint,es=a.unstable_now,eo=a.unstable_getCurrentPriorityLevel,el=a.unstable_ImmediatePriority,eu=a.unstable_UserBlockingPriority,ec=a.unstable_NormalPriority,eh=a.unstable_LowPriority,ed=a.unstable_IdlePriority,ef=a.log,ep=a.unstable_setDisableYieldValue,em=null,eg=null;function eA(e){if("function"==typeof ef&&ep(e),eg&&"function"==typeof eg.setStrictMode)try{eg.setStrictMode(em,e)}catch(e){}}var ev=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(ey(e)/eE|0)|0},ey=Math.log,eE=Math.LN2,ex=128,e_=4194304;function eb(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194176&e;case 4194304:case 8388608:case 0x1000000:case 0x2000000:return 0x3c00000&e;case 0x4000000:return 0x4000000;case 0x8000000:return 0x8000000;case 0x10000000:return 0x10000000;case 0x20000000:return 0x20000000;case 0x40000000:return 0;default:return e}}function eS(e,t){var r=e.pendingLanes;if(0===r)return 0;var i=0,n=e.suspendedLanes;e=e.pingedLanes;var a=0x7ffffff&r;return 0!==a?0!=(r=a&~n)?i=eb(r):0!=(e&=a)&&(i=eb(e)):0!=(r&=~n)?i=eb(r):0!==e&&(i=eb(e)),0===i?0:0!==t&&t!==i&&0==(t&n)&&((n=i&-i)>=(e=t&-t)||32===n&&0!=(4194176&e))?t:i}function ew(){var e=ex;return 0==(4194176&(ex<<=1))&&(ex=128),e}function eC(){var e=e_;return 0==(0x3c00000&(e_<<=1))&&(e_=4194304),e}function eT(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function eI(e,t){e.pendingLanes|=t,0x10000000!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function eM(e,t,r){e.pendingLanes|=t,e.suspendedLanes&=~t;var i=31-ev(t);e.entangledLanes|=t,e.entanglements[i]=0x40000000|e.entanglements[i]|4194218&r}function eR(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var i=31-ev(r),n=1<<i;n&t|e[i]&t&&(e[i]|=t),r&=~n}}function eB(e){return 2<(e&=-e)?8<e?0!=(0x7ffffff&e)?32:0x10000000:8:2}function eD(){var e=z.p;return 0!==e?e:void 0===(e=window.event)?32:uY(e.type)}var eP=Math.random().toString(36).slice(2),eL="__reactFiber$"+eP,ek="__reactProps$"+eP,eF="__reactContainer$"+eP,eO="__reactEvents$"+eP,eU="__reactListeners$"+eP,eN="__reactHandles$"+eP,ez="__reactResources$"+eP,eG="__reactMarker$"+eP;function eH(e){delete e[eL],delete e[ek],delete e[eO],delete e[eU],delete e[eN]}function eQ(e){var t=e[eL];if(t)return t;for(var r=e.parentNode;r;){if(t=r[eF]||r[eL]){if(r=t.alternate,null!==t.child||null!==r&&null!==r.child)for(e=us(e);null!==e;){if(r=e[eL])return r;e=us(e)}return t}r=(e=r).parentNode}return null}function eV(e){if(e=e[eL]||e[eF]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function eW(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(l(33))}function ej(e){var t=e[ez];return t||(t=e[ez]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function eY(e){e[eG]=!0}var eK=new Set,eq={};function eX(e,t){e$(e,t),e$(e+"Capture",t)}function e$(e,t){for(eq[e]=t,e=0;e<t.length;e++)eK.add(t[e])}var eJ=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),eZ=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),e0={},e1={};function e2(e,t,r){if(et.call(e1,t)||!et.call(e0,t)&&(eZ.test(t)?e1[t]=!0:(e0[t]=!0,!1))){if(null===r)e.removeAttribute(t);else{switch(typeof r){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var i=t.toLowerCase().slice(0,5);if("data-"!==i&&"aria-"!==i){e.removeAttribute(t);return}}e.setAttribute(t,""+r)}}}function e3(e,t,r){if(null===r)e.removeAttribute(t);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+r)}}function e4(e,t,r,i){if(null===i)e.removeAttribute(r);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttributeNS(t,r,""+i)}}function e5(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function e6(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function e8(e){e._valueTracker||(e._valueTracker=function(e){var t=e6(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==r&&"function"==typeof r.get&&"function"==typeof r.set){var n=r.get,a=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(e){i=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function e9(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),i="";return e&&(i=e6(e)?e.checked?"true":"false":e.value),(e=i)!==r&&(t.setValue(e),!0)}function e7(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var te=/[\n"\\]/g;function tt(e){return e.replace(te,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function tr(e,t,r,i,n,a,s,o){e.name="",null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s?e.type=s:e.removeAttribute("type"),null!=t?"number"===s?(0===t&&""===e.value||e.value!=t)&&(e.value=""+e5(t)):e.value!==""+e5(t)&&(e.value=""+e5(t)):"submit"!==s&&"reset"!==s||e.removeAttribute("value"),null!=t?tn(e,s,e5(t)):null!=r?tn(e,s,e5(r)):null!=i&&e.removeAttribute("value"),null==n&&null!=a&&(e.defaultChecked=!!a),null!=n&&(e.checked=n&&"function"!=typeof n&&"symbol"!=typeof n),null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o?e.name=""+e5(o):e.removeAttribute("name")}function ti(e,t,r,i,n,a,s,o){if(null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a&&(e.type=a),null!=t||null!=r){if(!("submit"!==a&&"reset"!==a||null!=t))return;r=null!=r?""+e5(r):"",t=null!=t?""+e5(t):r,o||t===e.value||(e.value=t),e.defaultValue=t}i="function"!=typeof(i=null!=i?i:n)&&"symbol"!=typeof i&&!!i,e.checked=o?e.checked:!!i,e.defaultChecked=!!i,null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s&&(e.name=s)}function tn(e,t,r){"number"===t&&e7(e.ownerDocument)===e||e.defaultValue===""+r||(e.defaultValue=""+r)}function ta(e,t,r,i){if(e=e.options,t){t={};for(var n=0;n<r.length;n++)t["$"+r[n]]=!0;for(r=0;r<e.length;r++)n=t.hasOwnProperty("$"+e[r].value),e[r].selected!==n&&(e[r].selected=n),n&&i&&(e[r].defaultSelected=!0)}else{for(n=0,r=""+e5(r),t=null;n<e.length;n++){if(e[n].value===r){e[n].selected=!0,i&&(e[n].defaultSelected=!0);return}null!==t||e[n].disabled||(t=e[n])}null!==t&&(t.selected=!0)}}function ts(e,t,r){if(null!=t&&((t=""+e5(t))!==e.value&&(e.value=t),null==r)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=null!=r?""+e5(r):""}function to(e,t,r,i){if(null==t){if(null!=i){if(null!=r)throw Error(l(92));if(N(i)){if(1<i.length)throw Error(l(93));i=i[0]}r=i}null==r&&(r=""),t=r}r=e5(t),e.defaultValue=r,(i=e.textContent)===r&&""!==i&&null!==i&&(e.value=i)}function tl(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType){r.nodeValue=t;return}}e.textContent=t}var tu=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function tc(e,t,r){var i=0===t.indexOf("--");null==r||"boolean"==typeof r||""===r?i?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":i?e.setProperty(t,r):"number"!=typeof r||0===r||tu.has(t)?"float"===t?e.cssFloat=r:e[t]=(""+r).trim():e[t]=r+"px"}function th(e,t,r){if(null!=t&&"object"!=typeof t)throw Error(l(62));if(e=e.style,null!=r){for(var i in r)!r.hasOwnProperty(i)||null!=t&&t.hasOwnProperty(i)||(0===i.indexOf("--")?e.setProperty(i,""):"float"===i?e.cssFloat="":e[i]="");for(var n in t)i=t[n],t.hasOwnProperty(n)&&r[n]!==i&&tc(e,n,i)}else for(var a in t)t.hasOwnProperty(a)&&tc(e,a,t[a])}function td(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tf=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),tp=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function tm(e){return tp.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var tg=null;function tA(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var tv=null,ty=null;function tE(e){var t=eV(e);if(t&&(e=t.stateNode)){var r=e[ek]||null;switch(e=t.stateNode,t.type){case"input":if(tr(e,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+tt(""+t)+'"][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var n=i[ek]||null;if(!n)throw Error(l(90));tr(i,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name)}}for(t=0;t<r.length;t++)(i=r[t]).form===e.form&&e9(i)}break;case"textarea":ts(e,r.value,r.defaultValue);break;case"select":null!=(t=r.value)&&ta(e,!!r.multiple,t,!1)}}}var tx=!1;function t_(e,t,r){if(tx)return e(t,r);tx=!0;try{return e(t)}finally{if(tx=!1,(null!==tv||null!==ty)&&(o3(),tv&&(t=tv,e=ty,ty=tv=null,tE(t),e)))for(t=0;t<e.length;t++)tE(e[t])}}function tb(e,t){var r=e.stateNode;if(null===r)return null;var i=r[ek]||null;if(null===i)return null;switch(r=i[t],t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break;default:e=!1}if(e)return null;if(r&&"function"!=typeof r)throw Error(l(231,t,typeof r));return r}var tS=!1;if(eJ)try{var tw={};Object.defineProperty(tw,"passive",{get:function(){tS=!0}}),window.addEventListener("test",tw,tw),window.removeEventListener("test",tw,tw)}catch(e){tS=!1}var tC=null,tT=null,tI=null;function tM(){if(tI)return tI;var e,t,r=tT,i=r.length,n="value"in tC?tC.value:tC.textContent,a=n.length;for(e=0;e<i&&r[e]===n[e];e++);var s=i-e;for(t=1;t<=s&&r[i-t]===n[a-t];t++);return tI=n.slice(e,1<t?1-t:void 0)}function tR(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function tB(){return!0}function tD(){return!1}function tP(e){function t(t,r,i,n,a){for(var s in this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=n,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(n):n[s]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?tB:tD,this.isPropagationStopped=tD,this}return B(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=tB)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=tB)},persist:function(){},isPersistent:tB}),t}var tL,tk,tF,tO={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tU=tP(tO),tN=B({},tO,{view:0,detail:0}),tz=tP(tN),tG=B({},tN,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:tJ,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==tF&&(tF&&"mousemove"===e.type?(tL=e.screenX-tF.screenX,tk=e.screenY-tF.screenY):tk=tL=0,tF=e),tL)},movementY:function(e){return"movementY"in e?e.movementY:tk}}),tH=tP(tG),tQ=tP(B({},tG,{dataTransfer:0})),tV=tP(B({},tN,{relatedTarget:0})),tW=tP(B({},tO,{animationName:0,elapsedTime:0,pseudoElement:0})),tj=tP(B({},tO,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),tY=tP(B({},tO,{data:0})),tK={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tq={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tX={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function t$(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=tX[e])&&!!t[e]}function tJ(){return t$}var tZ=tP(B({},tN,{key:function(e){if(e.key){var t=tK[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tR(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?tq[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:tJ,charCode:function(e){return"keypress"===e.type?tR(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tR(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),t0=tP(B({},tG,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),t1=tP(B({},tN,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:tJ})),t2=tP(B({},tO,{propertyName:0,elapsedTime:0,pseudoElement:0})),t3=tP(B({},tG,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),t4=tP(B({},tO,{newState:0,oldState:0})),t5=[9,13,27,32],t6=eJ&&"CompositionEvent"in window,t8=null;eJ&&"documentMode"in document&&(t8=document.documentMode);var t9=eJ&&"TextEvent"in window&&!t8,t7=eJ&&(!t6||t8&&8<t8&&11>=t8),re=!1;function rt(e,t){switch(e){case"keyup":return -1!==t5.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rr(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var ri=!1,rn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ra(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!rn[e.type]:"textarea"===t}function rs(e,t,r,i){tv?ty?ty.push(i):ty=[i]:tv=i,0<(t=lV(t,"onChange")).length&&(r=new tU("onChange","change",null,r,i),e.push({event:r,listeners:t}))}var ro=null,rl=null;function ru(e){lF(e,0)}function rc(e){if(e9(eW(e)))return e}function rh(e,t){if("change"===e)return t}var rd=!1;if(eJ){if(eJ){var rf="oninput"in document;if(!rf){var rp=document.createElement("div");rp.setAttribute("oninput","return;"),rf="function"==typeof rp.oninput}i=rf}else i=!1;rd=i&&(!document.documentMode||9<document.documentMode)}function rm(){ro&&(ro.detachEvent("onpropertychange",rg),rl=ro=null)}function rg(e){if("value"===e.propertyName&&rc(rl)){var t=[];rs(t,rl,e,tA(e)),t_(ru,t)}}function rA(e,t,r){"focusin"===e?(rm(),ro=t,rl=r,ro.attachEvent("onpropertychange",rg)):"focusout"===e&&rm()}function rv(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return rc(rl)}function ry(e,t){if("click"===e)return rc(t)}function rE(e,t){if("input"===e||"change"===e)return rc(t)}var rx="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function r_(e,t){if(rx(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!et.call(t,n)||!rx(e[n],t[n]))return!1}return!0}function rb(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function rS(e,t){var r,i=rb(e);for(e=0;i;){if(3===i.nodeType){if(r=e+i.textContent.length,e<=t&&r>=t)return{node:i,offset:t-e};e=r}s:{for(;i;){if(i.nextSibling){i=i.nextSibling;break s}i=i.parentNode}i=void 0}i=rb(i)}}function rw(e){e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window;for(var t=e7(e.document);t instanceof e.HTMLIFrameElement;){try{var r="string"==typeof t.contentWindow.location.href}catch(e){r=!1}if(r)e=t.contentWindow;else break;t=e7(e.document)}return t}function rC(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var rT=eJ&&"documentMode"in document&&11>=document.documentMode,rI=null,rM=null,rR=null,rB=!1;function rD(e,t,r){var i=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;rB||null==rI||rI!==e7(i)||(i="selectionStart"in(i=rI)&&rC(i)?{start:i.selectionStart,end:i.selectionEnd}:{anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},rR&&r_(rR,i)||(rR=i,0<(i=lV(rM,"onSelect")).length&&(t=new tU("onSelect","select",null,t,r),e.push({event:t,listeners:i}),t.target=rI)))}function rP(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var rL={animationend:rP("Animation","AnimationEnd"),animationiteration:rP("Animation","AnimationIteration"),animationstart:rP("Animation","AnimationStart"),transitionrun:rP("Transition","TransitionRun"),transitionstart:rP("Transition","TransitionStart"),transitioncancel:rP("Transition","TransitionCancel"),transitionend:rP("Transition","TransitionEnd")},rk={},rF={};function rO(e){if(rk[e])return rk[e];if(!rL[e])return e;var t,r=rL[e];for(t in r)if(r.hasOwnProperty(t)&&t in rF)return rk[e]=r[t];return e}eJ&&(rF=document.createElement("div").style,"AnimationEvent"in window||(delete rL.animationend.animation,delete rL.animationiteration.animation,delete rL.animationstart.animation),"TransitionEvent"in window||delete rL.transitionend.transition);var rU=rO("animationend"),rN=rO("animationiteration"),rz=rO("animationstart"),rG=rO("transitionrun"),rH=rO("transitionstart"),rQ=rO("transitioncancel"),rV=rO("transitionend"),rW=new Map,rj="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function rY(e,t){rW.set(e,t),eX(t,[e])}var rK=[],rq=0,rX=0;function r$(){for(var e=rq,t=rX=rq=0;t<e;){var r=rK[t];rK[t++]=null;var i=rK[t];rK[t++]=null;var n=rK[t];rK[t++]=null;var a=rK[t];if(rK[t++]=null,null!==i&&null!==n){var s=i.pending;null===s?n.next=n:(n.next=s.next,s.next=n),i.pending=n}0!==a&&r1(r,n,a)}}function rJ(e,t,r,i){rK[rq++]=e,rK[rq++]=t,rK[rq++]=r,rK[rq++]=i,rX|=i,e.lanes|=i,null!==(e=e.alternate)&&(e.lanes|=i)}function rZ(e,t,r,i){return rJ(e,t,r,i),r2(e)}function r0(e,t){return rJ(e,null,null,t),r2(e)}function r1(e,t,r){e.lanes|=r;var i=e.alternate;null!==i&&(i.lanes|=r);for(var n=!1,a=e.return;null!==a;)a.childLanes|=r,null!==(i=a.alternate)&&(i.childLanes|=r),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(n=!0)),e=a,a=a.return;n&&null!==t&&3===e.tag&&(a=e.stateNode,n=31-ev(r),null===(e=(a=a.hiddenUpdates)[n])?a[n]=[t]:e.push(t),t.lane=0x20000000|r)}function r2(e){if(50<oK)throw oK=0,oq=null,Error(l(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var r3={},r4=new WeakMap;function r5(e,t){if("object"==typeof e&&null!==e){var r=r4.get(e);return void 0!==r?r:(t={value:e,source:t,stack:k(t)},r4.set(e,t),t)}return{value:e,source:t,stack:k(t)}}var r6=[],r8=0,r9=null,r7=0,ie=[],it=0,ir=null,ii=1,ia="";function is(e,t){r6[r8++]=r7,r6[r8++]=r9,r9=e,r7=t}function io(e,t,r){ie[it++]=ii,ie[it++]=ia,ie[it++]=ir,ir=e;var i=ii;e=ia;var n=32-ev(i)-1;i&=~(1<<n),r+=1;var a=32-ev(t)+n;if(30<a){var s=n-n%5;a=(i&(1<<s)-1).toString(32),i>>=s,n-=s,ii=1<<32-ev(t)+n|r<<n|i,ia=a+e}else ii=1<<a|r<<n|i,ia=e}function il(e){null!==e.return&&(is(e,1),io(e,1,0))}function iu(e){for(;e===r9;)r9=r6[--r8],r6[r8]=null,r7=r6[--r8],r6[r8]=null;for(;e===ir;)ir=ie[--it],ie[it]=null,ia=ie[--it],ie[it]=null,ii=ie[--it],ie[it]=null}var ic=null,ih=null,id=!1,ip=null,im=!1,ig=Error(l(519));function iA(e){throw i_(r5(Error(l(418,"")),e)),ig}function iv(e){var t=e.stateNode,r=e.type,i=e.memoizedProps;switch(t[eL]=e,t[ek]=i,r){case"dialog":lO("cancel",t),lO("close",t);break;case"iframe":case"object":case"embed":lO("load",t);break;case"video":case"audio":for(r=0;r<lL.length;r++)lO(lL[r],t);break;case"source":lO("error",t);break;case"img":case"image":case"link":lO("error",t),lO("load",t);break;case"details":lO("toggle",t);break;case"input":lO("invalid",t),ti(t,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0),e8(t);break;case"select":lO("invalid",t);break;case"textarea":lO("invalid",t),to(t,i.value,i.defaultValue,i.children),e8(t)}"string"!=typeof(r=i.children)&&"number"!=typeof r&&"bigint"!=typeof r||t.textContent===""+r||!0===i.suppressHydrationWarning||lX(t.textContent,r)?(null!=i.popover&&(lO("beforetoggle",t),lO("toggle",t)),null!=i.onScroll&&lO("scroll",t),null!=i.onScrollEnd&&lO("scrollend",t),null!=i.onClick&&(t.onclick=l$),t=!0):t=!1,t||iA(e)}function iy(e){for(ic=e.return;ic;)switch(ic.tag){case 3:case 27:im=!0;return;case 5:case 13:im=!1;return;default:ic=ic.return}}function iE(e){if(e!==ic)return!1;if(!id)return iy(e),id=!0,!1;var t,r=!1;if((t=3!==e.tag&&27!==e.tag)&&((t=5===e.tag)&&(t=!("form"!==(t=e.type)&&"button"!==t)||l6(e.type,e.memoizedProps)),t=!t),t&&(r=!0),r&&ih&&iA(e),iy(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(l(317));s:{for(r=0,e=e.nextSibling;e;){if(8===e.nodeType){if("/$"===(t=e.data)){if(0===r){ih=ua(e.nextSibling);break s}r--}else"$"!==t&&"$!"!==t&&"$?"!==t||r++}e=e.nextSibling}ih=null}}else ih=ic?ua(e.stateNode.nextSibling):null;return!0}function ix(){ih=ic=null,id=!1}function i_(e){null===ip?ip=[e]:ip.push(e)}var ib=Error(l(460)),iS=Error(l(474)),iw={then:function(){}};function iC(e){return"fulfilled"===(e=e.status)||"rejected"===e}function iT(){}function iI(e,t,r){switch(void 0===(r=e[r])?e.push(t):r!==t&&(t.then(iT,iT),t=r),t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===ib)throw Error(l(483));throw e;default:if("string"==typeof t.status)t.then(iT,iT);else{if(null!==(e=o_)&&100<e.shellSuspendCounter)throw Error(l(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var r=t;r.status="fulfilled",r.value=e}},function(e){if("pending"===t.status){var r=t;r.status="rejected",r.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===ib)throw Error(l(483));throw e}throw iM=t,ib}}var iM=null;function iR(){if(null===iM)throw Error(l(459));var e=iM;return iM=null,e}var iB=null,iD=0;function iP(e){var t=iD;return iD+=1,null===iB&&(iB=[]),iI(iB,e,t)}function iL(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function ik(e,t){if(t.$$typeof===u)throw Error(l(525));throw Error(l(31,"[object Object]"===(e=Object.prototype.toString.call(t))?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function iF(e){return(0,e._init)(e._payload)}function iO(e){function t(t,r){if(e){var i=t.deletions;null===i?(t.deletions=[r],t.flags|=16):i.push(r)}}function r(r,i){if(!e)return null;for(;null!==i;)t(r,i),i=i.sibling;return null}function i(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function n(e,t){return(e=os(e,t)).index=0,e.sibling=null,e}function a(t,r,i){return(t.index=i,e)?null!==(i=t.alternate)?(i=i.index)<r?(t.flags|=0x2000002,r):i:(t.flags|=0x2000002,r):(t.flags|=1048576,r)}function s(t){return e&&null===t.alternate&&(t.flags|=0x2000002),t}function o(e,t,r,i){return null===t||6!==t.tag?(t=oh(r,e.mode,i)).return=e:(t=n(t,r)).return=e,t}function u(e,t,r,i){var a=r.type;return a===d?p(e,t,r.props.children,i,r.key):(null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===_&&iF(a)===t.type)?iL(t=n(t,r.props),r):iL(t=ol(r.type,r.key,r.props,null,e.mode,i),r),t.return=e,t)}function f(e,t,r,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?(t=od(r,e.mode,i)).return=e:(t=n(t,r.children||[])).return=e,t}function p(e,t,r,i,a){return null===t||7!==t.tag?(t=ou(r,e.mode,i,a)).return=e:(t=n(t,r)).return=e,t}function m(e,t,r){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=oh(""+t,e.mode,r)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case c:return iL(r=ol(t.type,t.key,t.props,null,e.mode,r),t),r.return=e,r;case h:return(t=od(t,e.mode,r)).return=e,t;case _:return m(e,t=(0,t._init)(t._payload),r)}if(N(t)||C(t))return(t=ou(t,e.mode,r,null)).return=e,t;if("function"==typeof t.then)return m(e,iP(t),r);if(t.$$typeof===A)return m(e,sd(e,t),r);ik(e,t)}return null}function g(e,t,r,i){var n=null!==t?t.key:null;if("string"==typeof r&&""!==r||"number"==typeof r||"bigint"==typeof r)return null!==n?null:o(e,t,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case c:return r.key===n?u(e,t,r,i):null;case h:return r.key===n?f(e,t,r,i):null;case _:return g(e,t,r=(n=r._init)(r._payload),i)}if(N(r)||C(r))return null!==n?null:p(e,t,r,i,null);if("function"==typeof r.then)return g(e,t,iP(r),i);if(r.$$typeof===A)return g(e,t,sd(e,r),i);ik(e,r)}return null}function v(e,t,r,i,n){if("string"==typeof i&&""!==i||"number"==typeof i||"bigint"==typeof i)return o(t,e=e.get(r)||null,""+i,n);if("object"==typeof i&&null!==i){switch(i.$$typeof){case c:return u(t,e=e.get(null===i.key?r:i.key)||null,i,n);case h:return f(t,e=e.get(null===i.key?r:i.key)||null,i,n);case _:return v(e,t,r,i=(0,i._init)(i._payload),n)}if(N(i)||C(i))return p(t,e=e.get(r)||null,i,n,null);if("function"==typeof i.then)return v(e,t,r,iP(i),n);if(i.$$typeof===A)return v(e,t,r,sd(t,i),n);ik(t,i)}return null}return function(o,u,f,p){try{iD=0;var y=function o(u,f,p,y){if("object"==typeof p&&null!==p&&p.type===d&&null===p.key&&(p=p.props.children),"object"==typeof p&&null!==p){switch(p.$$typeof){case c:s:{for(var E=p.key;null!==f;){if(f.key===E){if((E=p.type)===d){if(7===f.tag){r(u,f.sibling),(y=n(f,p.props.children)).return=u,u=y;break s}}else if(f.elementType===E||"object"==typeof E&&null!==E&&E.$$typeof===_&&iF(E)===f.type){r(u,f.sibling),iL(y=n(f,p.props),p),y.return=u,u=y;break s}r(u,f);break}t(u,f),f=f.sibling}p.type===d?(y=ou(p.props.children,u.mode,y,p.key)).return=u:(iL(y=ol(p.type,p.key,p.props,null,u.mode,y),p),y.return=u),u=y}return s(u);case h:s:{for(E=p.key;null!==f;){if(f.key===E){if(4===f.tag&&f.stateNode.containerInfo===p.containerInfo&&f.stateNode.implementation===p.implementation){r(u,f.sibling),(y=n(f,p.children||[])).return=u,u=y;break s}r(u,f);break}t(u,f),f=f.sibling}(y=od(p,u.mode,y)).return=u,u=y}return s(u);case _:return o(u,f,p=(E=p._init)(p._payload),y)}if(N(p))return function(n,s,o,l){for(var u=null,c=null,h=s,d=s=0,f=null;null!==h&&d<o.length;d++){h.index>d?(f=h,h=null):f=h.sibling;var p=g(n,h,o[d],l);if(null===p){null===h&&(h=f);break}e&&h&&null===p.alternate&&t(n,h),s=a(p,s,d),null===c?u=p:c.sibling=p,c=p,h=f}if(d===o.length)return r(n,h),id&&is(n,d),u;if(null===h){for(;d<o.length;d++)null!==(h=m(n,o[d],l))&&(s=a(h,s,d),null===c?u=h:c.sibling=h,c=h);return id&&is(n,d),u}for(h=i(h);d<o.length;d++)null!==(f=v(h,n,d,o[d],l))&&(e&&null!==f.alternate&&h.delete(null===f.key?d:f.key),s=a(f,s,d),null===c?u=f:c.sibling=f,c=f);return e&&h.forEach(function(e){return t(n,e)}),id&&is(n,d),u}(u,f,p,y);if(C(p)){if("function"!=typeof(E=C(p)))throw Error(l(150));return function(n,s,o,u){if(null==o)throw Error(l(151));for(var c=null,h=null,d=s,f=s=0,p=null,A=o.next();null!==d&&!A.done;f++,A=o.next()){d.index>f?(p=d,d=null):p=d.sibling;var y=g(n,d,A.value,u);if(null===y){null===d&&(d=p);break}e&&d&&null===y.alternate&&t(n,d),s=a(y,s,f),null===h?c=y:h.sibling=y,h=y,d=p}if(A.done)return r(n,d),id&&is(n,f),c;if(null===d){for(;!A.done;f++,A=o.next())null!==(A=m(n,A.value,u))&&(s=a(A,s,f),null===h?c=A:h.sibling=A,h=A);return id&&is(n,f),c}for(d=i(d);!A.done;f++,A=o.next())null!==(A=v(d,n,f,A.value,u))&&(e&&null!==A.alternate&&d.delete(null===A.key?f:A.key),s=a(A,s,f),null===h?c=A:h.sibling=A,h=A);return e&&d.forEach(function(e){return t(n,e)}),id&&is(n,f),c}(u,f,p=E.call(p),y)}if("function"==typeof p.then)return o(u,f,iP(p),y);if(p.$$typeof===A)return o(u,f,sd(u,p),y);ik(u,p)}return"string"==typeof p&&""!==p||"number"==typeof p||"bigint"==typeof p?(p=""+p,null!==f&&6===f.tag?(r(u,f.sibling),(y=n(f,p)).return=u):(r(u,f),(y=oh(p,u.mode,y)).return=u),s(u=y)):r(u,f)}(o,u,f,p);return iB=null,y}catch(e){if(e===ib)throw e;var E=on(29,e,null,o.mode);return E.lanes=p,E.return=o,E}finally{}}}var iU=iO(!0),iN=iO(!1),iz=V(null),iG=V(0);function iH(e,t){j(iG,e=oM),j(iz,t),oM=e|t.baseLanes}function iQ(){j(iG,oM),j(iz,iz.current)}function iV(){oM=iG.current,W(iz),W(iG)}var iW=V(null),ij=null;function iY(e){var t=e.alternate;j(i$,1&i$.current),j(iW,e),null===ij&&(null===t||null!==iz.current?ij=e:null!==t.memoizedState&&(ij=e))}function iK(e){if(22===e.tag){if(j(i$,i$.current),j(iW,e),null===ij){var t=e.alternate;null!==t&&null!==t.memoizedState&&(ij=e)}}else iq(e)}function iq(){j(i$,i$.current),j(iW,iW.current)}function iX(e){W(iW),ij===e&&(ij=null),W(i$)}var i$=V(0);function iJ(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||"$?"===r.data||"$!"===r.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var iZ="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,r){e.push(r)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},i0=a.unstable_scheduleCallback,i1=a.unstable_NormalPriority,i2={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function i3(){return{controller:new iZ,data:new Map,refCount:0}}function i4(e){e.refCount--,0===e.refCount&&i0(i1,function(){e.controller.abort()})}var i5=null,i6=0,i8=0,i9=null;function i7(){if(0==--i6&&null!==i5){null!==i9&&(i9.status="fulfilled");var e=i5;i5=null,i8=0,i9=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var ne=R.S;R.S=function(e,t){"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===i5){var r=i5=[];i6=0,i8=lM(),i9={status:"pending",value:void 0,then:function(e){r.push(e)}}}i6++,t.then(i7,i7)}(0,t),null!==ne&&ne(e,t)};var nt=V(null);function nr(){var e=nt.current;return null!==e?e:o_.pooledCache}function ni(e,t){null===t?j(nt,nt.current):j(nt,t.pool)}function nn(){var e=nr();return null===e?null:{parent:i2._currentValue,pool:e}}var na=0,ns=null,no=null,nl=null,nu=!1,nc=!1,nh=!1,nd=0,nf=0,np=null,nm=0;function ng(){throw Error(l(321))}function nA(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!rx(e[r],t[r]))return!1;return!0}function nv(e,t,r,i,n,a){return na=a,ns=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,R.H=null===e||null===e.memoizedState?a_:ab,nh=!1,a=r(i,n),nh=!1,nc&&(a=nE(t,r,i,n)),ny(e),a}function ny(e){R.H=ax;var t=null!==no&&null!==no.next;if(na=0,nl=no=ns=null,nu=!1,nf=0,np=null,t)throw Error(l(300));null===e||az||null!==(e=e.dependencies)&&su(e)&&(az=!0)}function nE(e,t,r,i){ns=e;var n=0;do{if(nc&&(np=null),nf=0,nc=!1,25<=n)throw Error(l(301));if(n+=1,nl=no=null,null!=e.updateQueue){var a=e.updateQueue;a.lastEffect=null,a.events=null,a.stores=null,null!=a.memoCache&&(a.memoCache.index=0)}R.H=aS,a=t(r,i)}while(nc);return a}function nx(){var e=R.H,t=e.useState()[0];return t="function"==typeof t.then?nT(t):t,e=e.useState()[0],(null!==no?no.memoizedState:null)!==e&&(ns.flags|=1024),t}function n_(){var e=0!==nd;return nd=0,e}function nb(e,t,r){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r}function nS(e){if(nu){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}nu=!1}na=0,nl=no=ns=null,nc=!1,nf=nd=0,np=null}function nw(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===nl?ns.memoizedState=nl=e:nl=nl.next=e,nl}function nC(){if(null===no){var e=ns.alternate;e=null!==e?e.memoizedState:null}else e=no.next;var t=null===nl?ns.memoizedState:nl.next;if(null!==t)nl=t,no=e;else{if(null===e){if(null===ns.alternate)throw Error(l(467));throw Error(l(310))}e={memoizedState:(no=e).memoizedState,baseState:no.baseState,baseQueue:no.baseQueue,queue:no.queue,next:null},null===nl?ns.memoizedState=nl=e:nl=nl.next=e}return nl}function nT(e){var t=nf;return nf+=1,null===np&&(np=[]),e=iI(np,e,t),t=ns,null===(null===nl?t.memoizedState:nl.next)&&(t=t.alternate,R.H=null===t||null===t.memoizedState?a_:ab),e}function nI(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return nT(e);if(e.$$typeof===A)return sh(e)}throw Error(l(438,String(e)))}function nM(e){var t=null,r=ns.updateQueue;if(null!==r&&(t=r.memoCache),null==t){var i=ns.alternate;null!==i&&null!==(i=i.updateQueue)&&null!=(i=i.memoCache)&&(t={data:i.data.map(function(e){return e.slice()}),index:0})}if(null==t&&(t={data:[],index:0}),null===r&&(r=n(),ns.updateQueue=r),r.memoCache=t,void 0===(r=t.data[t.index]))for(r=t.data[t.index]=Array(e),i=0;i<e;i++)r[i]=S;return t.index++,r}function nR(e,t){return"function"==typeof t?t(e):t}function nB(e){return nD(nC(),no,e)}function nD(e,t,r){var i=e.queue;if(null===i)throw Error(l(311));i.lastRenderedReducer=r;var n=e.baseQueue,a=i.pending;if(null!==a){if(null!==n){var s=n.next;n.next=a.next,a.next=s}t.baseQueue=n=a,i.pending=null}if(a=e.baseState,null===n)e.memoizedState=a;else{t=n.next;var o=s=null,u=null,c=t,h=!1;do{var d=-0x20000001&c.lane;if(d!==c.lane?(oS&d)===d:(na&d)===d){var f=c.revertLane;if(0===f)null!==u&&(u=u.next={lane:0,revertLane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),d===i8&&(h=!0);else if((na&f)===f){c=c.next,f===i8&&(h=!0);continue}else d={lane:0,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===u?(o=u=d,s=a):u=u.next=d,ns.lanes|=f,oB|=f;d=c.action,nh&&r(a,d),a=c.hasEagerState?c.eagerState:r(a,d)}else f={lane:d,revertLane:c.revertLane,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===u?(o=u=f,s=a):u=u.next=f,ns.lanes|=d,oB|=d;c=c.next}while(null!==c&&c!==t);if(null===u?s=a:u.next=o,!rx(a,e.memoizedState)&&(az=!0,h&&null!==(r=i9)))throw r;e.memoizedState=a,e.baseState=s,e.baseQueue=u,i.lastRenderedState=a}return null===n&&(i.lanes=0),[e.memoizedState,i.dispatch]}function nP(e){var t=nC(),r=t.queue;if(null===r)throw Error(l(311));r.lastRenderedReducer=e;var i=r.dispatch,n=r.pending,a=t.memoizedState;if(null!==n){r.pending=null;var s=n=n.next;do a=e(a,s.action),s=s.next;while(s!==n);rx(a,t.memoizedState)||(az=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),r.lastRenderedState=a}return[a,i]}function nL(e,t,r){var i=ns,n=nC(),a=id;if(a){if(void 0===r)throw Error(l(407));r=r()}else r=t();var s=!rx((no||n).memoizedState,r);if(s&&(n.memoizedState=r,az=!0),n=n.queue,n5(nO.bind(null,i,n,e),[e]),n.getSnapshot!==t||s||null!==nl&&1&nl.memoizedState.tag){if(i.flags|=2048,n0(9,nF.bind(null,i,n,r,t),{destroy:void 0},null),null===o_)throw Error(l(349));a||0!=(60&na)||nk(i,t,r)}return r}function nk(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},null===(t=ns.updateQueue)?(t=n(),ns.updateQueue=t,t.stores=[e]):null===(r=t.stores)?t.stores=[e]:r.push(e)}function nF(e,t,r,i){t.value=r,t.getSnapshot=i,nU(t)&&nN(e)}function nO(e,t,r){return r(function(){nU(t)&&nN(e)})}function nU(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!rx(e,r)}catch(e){return!0}}function nN(e){var t=r0(e,2);null!==t&&oJ(t,e,2)}function nz(e){var t=nw();if("function"==typeof e){var r=e;if(e=r(),nh){eA(!0);try{r()}finally{eA(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:nR,lastRenderedState:e},t}function nG(e,t,r,i){return e.baseState=r,nD(e,no,"function"==typeof i?i:nR)}function nH(e,t,r,i,n){if(av(e))throw Error(l(485));if(null!==(e=t.action)){var a={payload:n,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){a.listeners.push(e)}};null!==R.T?r(!0):a.isTransition=!1,i(a),null===(r=t.pending)?(a.next=t.pending=a,nQ(t,a)):(a.next=r.next,t.pending=r.next=a)}}function nQ(e,t){var r=t.action,i=t.payload,n=e.state;if(t.isTransition){var a=R.T,s={};R.T=s;try{var o=r(n,i),l=R.S;null!==l&&l(s,o),nV(e,t,o)}catch(r){nj(e,t,r)}finally{R.T=a}}else try{a=r(n,i),nV(e,t,a)}catch(r){nj(e,t,r)}}function nV(e,t,r){null!==r&&"object"==typeof r&&"function"==typeof r.then?r.then(function(r){nW(e,t,r)},function(r){return nj(e,t,r)}):nW(e,t,r)}function nW(e,t,r){t.status="fulfilled",t.value=r,nY(t),e.state=r,null!==(t=e.pending)&&((r=t.next)===t?e.pending=null:(r=r.next,t.next=r,nQ(e,r)))}function nj(e,t,r){var i=e.pending;if(e.pending=null,null!==i){i=i.next;do t.status="rejected",t.reason=r,nY(t),t=t.next;while(t!==i)}e.action=null}function nY(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function nK(e,t){return t}function nq(e,t){if(id){var r=o_.formState;if(null!==r){s:{var i=ns;if(id){if(ih){o:{for(var n=ih,a=im;8!==n.nodeType;)if(!a||null===(n=ua(n.nextSibling))){n=null;break o}n="F!"===(a=n.data)||"F"===a?n:null}if(n){ih=ua(n.nextSibling),i="F!"===n.data;break s}}iA(i)}i=!1}i&&(t=r[0])}}return(r=nw()).memoizedState=r.baseState=t,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:nK,lastRenderedState:t},r.queue=i,r=am.bind(null,ns,i),i.dispatch=r,i=nz(!1),a=aA.bind(null,ns,!1,i.queue),i=nw(),n={state:t,dispatch:null,action:e,pending:null},i.queue=n,r=nH.bind(null,ns,n,a,r),n.dispatch=r,i.memoizedState=e,[t,r,!1]}function nX(e){return n$(nC(),no,e)}function n$(e,t,r){t=nD(e,t,nK)[0],e=nB(nR)[0],t="object"==typeof t&&null!==t&&"function"==typeof t.then?nT(t):t;var i=nC(),n=i.queue,a=n.dispatch;return r!==i.memoizedState&&(ns.flags|=2048,n0(9,nJ.bind(null,n,r),{destroy:void 0},null)),[t,a,e]}function nJ(e,t){e.action=t}function nZ(e){var t=nC(),r=no;if(null!==r)return n$(t,r,e);nC(),t=t.memoizedState;var i=(r=nC()).queue.dispatch;return r.memoizedState=e,[t,i,!1]}function n0(e,t,r,i){return e={tag:e,create:t,inst:r,deps:i,next:null},null===(t=ns.updateQueue)&&(t=n(),ns.updateQueue=t),null===(r=t.lastEffect)?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e),e}function n1(){return nC().memoizedState}function n2(e,t,r,i){var n=nw();ns.flags|=e,n.memoizedState=n0(1|t,r,{destroy:void 0},void 0===i?null:i)}function n3(e,t,r,i){var n=nC();i=void 0===i?null:i;var a=n.memoizedState.inst;null!==no&&null!==i&&nA(i,no.memoizedState.deps)?n.memoizedState=n0(t,r,a,i):(ns.flags|=e,n.memoizedState=n0(1|t,r,a,i))}function n4(e,t){n2(8390656,8,e,t)}function n5(e,t){n3(2048,8,e,t)}function n6(e,t){return n3(4,2,e,t)}function n8(e,t){return n3(4,4,e,t)}function n9(e,t){if("function"==typeof t){var r=t(e=e());return function(){"function"==typeof r?r():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function n7(e,t,r){r=null!=r?r.concat([e]):null,n3(4,4,n9.bind(null,t,e),r)}function ae(){}function at(e,t){var r=nC();t=void 0===t?null:t;var i=r.memoizedState;return null!==t&&nA(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function ar(e,t){var r=nC();t=void 0===t?null:t;var i=r.memoizedState;if(null!==t&&nA(t,i[1]))return i[0];if(i=e(),nh){eA(!0);try{e()}finally{eA(!1)}}return r.memoizedState=[i,t],i}function ai(e,t,r){return void 0===r||0!=(0x40000000&na)?e.memoizedState=t:(e.memoizedState=r,e=o$(),ns.lanes|=e,oB|=e,r)}function an(e,t,r,i){return rx(r,t)?r:null!==iz.current?(rx(e=ai(e,r,i),t)||(az=!0),e):0==(42&na)?(az=!0,e.memoizedState=r):(e=o$(),ns.lanes|=e,oB|=e,t)}function aa(e,t,r,i,n){var a=z.p;z.p=0!==a&&8>a?a:8;var s=R.T,o={};R.T=o,aA(e,!1,t,r);try{var l=n(),u=R.S;if(null!==u&&u(o,l),null!==l&&"object"==typeof l&&"function"==typeof l.then){var c,h,d=(c=[],h={status:"pending",value:null,reason:null,then:function(e){c.push(e)}},l.then(function(){h.status="fulfilled",h.value=i;for(var e=0;e<c.length;e++)(0,c[e])(i)},function(e){for(h.status="rejected",h.reason=e,e=0;e<c.length;e++)(0,c[e])(void 0)}),h);ag(e,t,d,oX(e))}else ag(e,t,i,oX(e))}catch(r){ag(e,t,{then:function(){},status:"rejected",reason:r},oX())}finally{z.p=a,R.T=s}}function as(){}function ao(e,t,r,i){if(5!==e.tag)throw Error(l(476));var n=al(e).queue;aa(e,n,t,G,null===r?as:function(){return au(e),r(i)})}function al(e){var t=e.memoizedState;if(null!==t)return t;var r={};return(t={memoizedState:G,baseState:G,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:nR,lastRenderedState:G},next:null}).next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:nR,lastRenderedState:r},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function au(e){var t=al(e).next.queue;ag(e,t,{},oX())}function ac(){return sh(uL)}function ah(){return nC().memoizedState}function ad(){return nC().memoizedState}function af(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var r=oX(),i=sv(t,e=sA(r),r);null!==i&&(oJ(i,t,r),sy(i,t,r)),t={cache:i3()},e.payload=t;return}t=t.return}}function ap(e,t,r){var i=oX();r={lane:i,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null},av(e)?ay(t,r):null!==(r=rZ(e,t,r,i))&&(oJ(r,e,i),aE(r,t,i))}function am(e,t,r){ag(e,t,r,oX())}function ag(e,t,r,i){var n={lane:i,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null};if(av(e))ay(t,n);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=a(s,r);if(n.hasEagerState=!0,n.eagerState=o,rx(o,s))return rJ(e,t,n,0),null===o_&&r$(),!1}catch(e){}finally{}if(null!==(r=rZ(e,t,n,i)))return oJ(r,e,i),aE(r,t,i),!0}return!1}function aA(e,t,r,i){if(i={lane:2,revertLane:lM(),action:i,hasEagerState:!1,eagerState:null,next:null},av(e)){if(t)throw Error(l(479))}else null!==(t=rZ(e,r,i,2))&&oJ(t,e,2)}function av(e){var t=e.alternate;return e===ns||null!==t&&t===ns}function ay(e,t){nc=nu=!0;var r=e.pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function aE(e,t,r){if(0!=(4194176&r)){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,eR(e,r)}}n=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};var ax={readContext:sh,use:nI,useCallback:ng,useContext:ng,useEffect:ng,useImperativeHandle:ng,useLayoutEffect:ng,useInsertionEffect:ng,useMemo:ng,useReducer:ng,useRef:ng,useState:ng,useDebugValue:ng,useDeferredValue:ng,useTransition:ng,useSyncExternalStore:ng,useId:ng};ax.useCacheRefresh=ng,ax.useMemoCache=ng,ax.useHostTransitionStatus=ng,ax.useFormState=ng,ax.useActionState=ng,ax.useOptimistic=ng;var a_={readContext:sh,use:nI,useCallback:function(e,t){return nw().memoizedState=[e,void 0===t?null:t],e},useContext:sh,useEffect:n4,useImperativeHandle:function(e,t,r){r=null!=r?r.concat([e]):null,n2(4194308,4,n9.bind(null,t,e),r)},useLayoutEffect:function(e,t){return n2(4194308,4,e,t)},useInsertionEffect:function(e,t){n2(4,2,e,t)},useMemo:function(e,t){var r=nw();t=void 0===t?null:t;var i=e();if(nh){eA(!0);try{e()}finally{eA(!1)}}return r.memoizedState=[i,t],i},useReducer:function(e,t,r){var i=nw();if(void 0!==r){var n=r(t);if(nh){eA(!0);try{r(t)}finally{eA(!1)}}}else n=t;return i.memoizedState=i.baseState=n,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},i.queue=e,e=e.dispatch=ap.bind(null,ns,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},nw().memoizedState=e},useState:function(e){var t=(e=nz(e)).queue,r=am.bind(null,ns,t);return t.dispatch=r,[e.memoizedState,r]},useDebugValue:ae,useDeferredValue:function(e,t){return ai(nw(),e,t)},useTransition:function(){var e=nz(!1);return e=aa.bind(null,ns,e.queue,!0,!1),nw().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,r){var i=ns,n=nw();if(id){if(void 0===r)throw Error(l(407));r=r()}else{if(r=t(),null===o_)throw Error(l(349));0!=(60&oS)||nk(i,t,r)}n.memoizedState=r;var a={value:r,getSnapshot:t};return n.queue=a,n4(nO.bind(null,i,a,e),[e]),i.flags|=2048,n0(9,nF.bind(null,i,a,r,t),{destroy:void 0},null),r},useId:function(){var e=nw(),t=o_.identifierPrefix;if(id){var r=ia,i=ii;t=":"+t+"R"+(r=(i&~(1<<32-ev(i)-1)).toString(32)+r),0<(r=nd++)&&(t+="H"+r.toString(32)),t+=":"}else t=":"+t+"r"+(r=nm++).toString(32)+":";return e.memoizedState=t},useCacheRefresh:function(){return nw().memoizedState=af.bind(null,ns)}};a_.useMemoCache=nM,a_.useHostTransitionStatus=ac,a_.useFormState=nq,a_.useActionState=nq,a_.useOptimistic=function(e){var t=nw();t.memoizedState=t.baseState=e;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=r,t=aA.bind(null,ns,!0,r),r.dispatch=t,[e,t]};var ab={readContext:sh,use:nI,useCallback:at,useContext:sh,useEffect:n5,useImperativeHandle:n7,useInsertionEffect:n6,useLayoutEffect:n8,useMemo:ar,useReducer:nB,useRef:n1,useState:function(){return nB(nR)},useDebugValue:ae,useDeferredValue:function(e,t){return an(nC(),no.memoizedState,e,t)},useTransition:function(){var e=nB(nR)[0],t=nC().memoizedState;return["boolean"==typeof e?e:nT(e),t]},useSyncExternalStore:nL,useId:ah};ab.useCacheRefresh=ad,ab.useMemoCache=nM,ab.useHostTransitionStatus=ac,ab.useFormState=nX,ab.useActionState=nX,ab.useOptimistic=function(e,t){return nG(nC(),no,e,t)};var aS={readContext:sh,use:nI,useCallback:at,useContext:sh,useEffect:n5,useImperativeHandle:n7,useInsertionEffect:n6,useLayoutEffect:n8,useMemo:ar,useReducer:nP,useRef:n1,useState:function(){return nP(nR)},useDebugValue:ae,useDeferredValue:function(e,t){var r=nC();return null===no?ai(r,e,t):an(r,no.memoizedState,e,t)},useTransition:function(){var e=nP(nR)[0],t=nC().memoizedState;return["boolean"==typeof e?e:nT(e),t]},useSyncExternalStore:nL,useId:ah};function aw(e,t,r,i){r=null==(r=r(i,t=e.memoizedState))?t:B({},t,r),e.memoizedState=r,0===e.lanes&&(e.updateQueue.baseState=r)}aS.useCacheRefresh=ad,aS.useMemoCache=nM,aS.useHostTransitionStatus=ac,aS.useFormState=nZ,aS.useActionState=nZ,aS.useOptimistic=function(e,t){var r=nC();return null!==no?nG(r,no,e,t):(r.baseState=e,[e,r.queue.dispatch])};var aC={isMounted:function(e){return!!(e=e._reactInternals)&&F(e)===e},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=oX(),n=sA(i);n.payload=t,null!=r&&(n.callback=r),null!==(t=sv(e,n,i))&&(oJ(t,e,i),sy(t,e,i))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=oX(),n=sA(i);n.tag=1,n.payload=t,null!=r&&(n.callback=r),null!==(t=sv(e,n,i))&&(oJ(t,e,i),sy(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=oX(),i=sA(r);i.tag=2,null!=t&&(i.callback=t),null!==(t=sv(e,i,r))&&(oJ(t,e,r),sy(t,e,r))}};function aT(e,t,r,i,n,a,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,s):!t.prototype||!t.prototype.isPureReactComponent||!r_(r,i)||!r_(n,a)}function aI(e,t,r,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&aC.enqueueReplaceState(t,t.state,null)}function aM(e,t){var r=t;if("ref"in t)for(var i in r={},t)"ref"!==i&&(r[i]=t[i]);if(e=e.defaultProps)for(var n in r===t&&(r=B({},r)),e)void 0===r[n]&&(r[n]=e[n]);return r}var aR="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit){process.emit("uncaughtException",e);return}console.error(e)};function aB(e){aR(e)}function aD(e){console.error(e)}function aP(e){aR(e)}function aL(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(e){setTimeout(function(){throw e})}}function ak(e,t,r){try{(0,e.onCaughtError)(r.value,{componentStack:r.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(e){setTimeout(function(){throw e})}}function aF(e,t,r){return(r=sA(r)).tag=3,r.payload={element:null},r.callback=function(){aL(e,t)},r}function aO(e){return(e=sA(e)).tag=3,e}function aU(e,t,r,i){var n=r.type.getDerivedStateFromError;if("function"==typeof n){var a=i.value;e.payload=function(){return n(a)},e.callback=function(){ak(t,r,i)}}var s=r.stateNode;null!==s&&"function"==typeof s.componentDidCatch&&(e.callback=function(){ak(t,r,i),"function"!=typeof n&&(null===oH?oH=new Set([this]):oH.add(this));var e=i.stack;this.componentDidCatch(i.value,{componentStack:null!==e?e:""})})}var aN=Error(l(461)),az=!1;function aG(e,t,r,i){t.child=null===e?iN(t,null,r,i):iU(t,e.child,r,i)}function aH(e,t,r,i,n){r=r.render;var a=t.ref;if("ref"in i){var s={};for(var o in i)"ref"!==o&&(s[o]=i[o])}else s=i;return(sc(t),i=nv(e,t,r,s,a,n),o=n_(),null===e||az)?(id&&o&&il(t),t.flags|=1,aG(e,t,i,n),t.child):(nb(e,t,n),a9(e,t,n))}function aQ(e,t,r,i,n){if(null===e){var a=r.type;return"function"!=typeof a||oa(a)||void 0!==a.defaultProps||null!==r.compare?((e=ol(r.type,null,i,t,t.mode,n)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,aV(e,t,a,i,n))}if(a=e.child,!a7(e,n)){var s=a.memoizedProps;if((r=null!==(r=r.compare)?r:r_)(s,i)&&e.ref===t.ref)return a9(e,t,n)}return t.flags|=1,(e=os(a,i)).ref=t.ref,e.return=t,t.child=e}function aV(e,t,r,i,n){if(null!==e){var a=e.memoizedProps;if(r_(a,i)&&e.ref===t.ref){if(az=!1,t.pendingProps=i=a,!a7(e,n))return t.lanes=e.lanes,a9(e,t,n);0!=(131072&e.flags)&&(az=!0)}}return aK(e,t,r,i,n)}function aW(e,t,r){var i=t.pendingProps,n=i.children,a=0!=(2&t.stateNode._pendingVisibility),s=null!==e?e.memoizedState:null;if(aY(e,t),"hidden"===i.mode||a){if(0!=(128&t.flags)){if(i=null!==s?s.baseLanes|r:r,null!==e){for(a=0,n=t.child=e.child;null!==n;)a=a|n.lanes|n.childLanes,n=n.sibling;t.childLanes=a&~i}else t.childLanes=0,t.child=null;return aj(e,t,i,r)}if(0==(0x20000000&r))return t.lanes=t.childLanes=0x20000000,aj(e,t,null!==s?s.baseLanes|r:r,r);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&ni(t,null!==s?s.cachePool:null),null!==s?iH(t,s):iQ(),iK(t)}else null!==s?(ni(t,s.cachePool),iH(t,s),iq(t),t.memoizedState=null):(null!==e&&ni(t,null),iQ(),iq(t));return aG(e,t,n,r),t.child}function aj(e,t,r,i){var n=nr();return n=null===n?null:{parent:i2._currentValue,pool:n},t.memoizedState={baseLanes:r,cachePool:n},null!==e&&ni(t,null),iQ(),iK(t),null!==e&&sl(e,t,i,!0),null}function aY(e,t){var r=t.ref;if(null===r)null!==e&&null!==e.ref&&(t.flags|=2097664);else{if("function"!=typeof r&&"object"!=typeof r)throw Error(l(284));(null===e||e.ref!==r)&&(t.flags|=2097664)}}function aK(e,t,r,i,n){return(sc(t),r=nv(e,t,r,i,void 0,n),i=n_(),null===e||az)?(id&&i&&il(t),t.flags|=1,aG(e,t,r,n),t.child):(nb(e,t,n),a9(e,t,n))}function aq(e,t,r,i,n,a){return(sc(t),t.updateQueue=null,r=nE(t,i,r,n),ny(e),i=n_(),null===e||az)?(id&&i&&il(t),t.flags|=1,aG(e,t,r,a),t.child):(nb(e,t,a),a9(e,t,a))}function aX(e,t,r,i,n){if(sc(t),null===t.stateNode){var a=r3,s=r.contextType;"object"==typeof s&&null!==s&&(a=sh(s)),a=new r(i,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=aC,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=i,a.state=t.memoizedState,a.refs={},sm(t),s=r.contextType,a.context="object"==typeof s&&null!==s?sh(s):r3,a.state=t.memoizedState,"function"==typeof(s=r.getDerivedStateFromProps)&&(aw(t,r,s,i),a.state=t.memoizedState),"function"==typeof r.getDerivedStateFromProps||"function"==typeof a.getSnapshotBeforeUpdate||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||(s=a.state,"function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),s!==a.state&&aC.enqueueReplaceState(a,a.state,null),sb(t,i,a,n),s_(),a.state=t.memoizedState),"function"==typeof a.componentDidMount&&(t.flags|=4194308),i=!0}else if(null===e){a=t.stateNode;var o=t.memoizedProps,l=aM(r,o);a.props=l;var u=a.context,c=r.contextType;s=r3,"object"==typeof c&&null!==c&&(s=sh(c));var h=r.getDerivedStateFromProps;c="function"==typeof h||"function"==typeof a.getSnapshotBeforeUpdate,o=t.pendingProps!==o,c||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o||u!==s)&&aI(t,a,i,s),sp=!1;var d=t.memoizedState;a.state=d,sb(t,i,a,n),s_(),u=t.memoizedState,o||d!==u||sp?("function"==typeof h&&(aw(t,r,h,i),u=t.memoizedState),(l=sp||aT(t,r,l,i,d,u,s))?(c||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=u),a.props=i,a.state=u,a.context=s,i=l):("function"==typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,sg(e,t),c=aM(r,s=t.memoizedProps),a.props=c,h=t.pendingProps,d=a.context,u=r.contextType,l=r3,"object"==typeof u&&null!==u&&(l=sh(u)),(u="function"==typeof(o=r.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==h||d!==l)&&aI(t,a,i,l),sp=!1,d=t.memoizedState,a.state=d,sb(t,i,a,n),s_();var f=t.memoizedState;s!==h||d!==f||sp||null!==e&&null!==e.dependencies&&su(e.dependencies)?("function"==typeof o&&(aw(t,r,o,i),f=t.memoizedState),(c=sp||aT(t,r,c,i,d,f,l)||null!==e&&null!==e.dependencies&&su(e.dependencies))?(u||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(i,f,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,f,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),a.props=i,a.state=f,a.context=l,i=c):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return a=i,aY(e,t),i=0!=(128&t.flags),a||i?(a=t.stateNode,r=i&&"function"!=typeof r.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&i?(t.child=iU(t,e.child,null,n),t.child=iU(t,null,r,n)):aG(e,t,r,n),t.memoizedState=a.state,e=t.child):e=a9(e,t,n),e}function a$(e,t,r,i){return ix(),t.flags|=256,aG(e,t,r,i),t.child}var aJ={dehydrated:null,treeContext:null,retryLane:0};function aZ(e){return{baseLanes:e,cachePool:nn()}}function a0(e,t,r){return e=null!==e?e.childLanes&~r:0,t&&(e|=oL),e}function a1(e,t,r){var i,n=t.pendingProps,a=!1,s=0!=(128&t.flags);if((i=s)||(i=(null===e||null!==e.memoizedState)&&0!=(2&i$.current)),i&&(a=!0,t.flags&=-129),i=0!=(32&t.flags),t.flags&=-33,null===e){if(id){if(a?iY(t):iq(t),id){var o,u=ih;if(o=u){l:{for(o=u,u=im;8!==o.nodeType;)if(!u||null===(o=ua(o.nextSibling))){u=null;break l}u=o}null!==u?(t.memoizedState={dehydrated:u,treeContext:null!==ir?{id:ii,overflow:ia}:null,retryLane:0x20000000},(o=on(18,null,null,0)).stateNode=u,o.return=t,t.child=o,ic=t,ih=null,o=!0):o=!1}o||iA(t)}if(null!==(u=t.memoizedState)&&null!==(u=u.dehydrated))return"$!"===u.data?t.lanes=16:t.lanes=0x20000000,null;iX(t)}return(u=n.children,n=n.fallback,a)?(iq(t),u=a3({mode:"hidden",children:u},a=t.mode),n=ou(n,a,r,null),u.return=t,n.return=t,u.sibling=n,t.child=u,(a=t.child).memoizedState=aZ(r),a.childLanes=a0(e,i,r),t.memoizedState=aJ,n):(iY(t),a2(t,u))}if(null!==(o=e.memoizedState)&&null!==(u=o.dehydrated)){if(s)256&t.flags?(iY(t),t.flags&=-257,t=a4(e,t,r)):null!==t.memoizedState?(iq(t),t.child=e.child,t.flags|=128,t=null):(iq(t),a=n.fallback,u=t.mode,n=a3({mode:"visible",children:n.children},u),a=ou(a,u,r,null),a.flags|=2,n.return=t,a.return=t,n.sibling=a,t.child=n,iU(t,e.child,null,r),(n=t.child).memoizedState=aZ(r),n.childLanes=a0(e,i,r),t.memoizedState=aJ,t=a);else if(iY(t),"$!"===u.data){if(i=u.nextSibling&&u.nextSibling.dataset)var c=i.dgst;i=c,(n=Error(l(419))).stack="",n.digest=i,i_({value:n,source:null,stack:null}),t=a4(e,t,r)}else if(az||sl(e,t,r,!1),i=0!=(r&e.childLanes),az||i){if(null!==(i=o_)){if(0!=(42&(n=r&-r)))n=1;else switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 0x1000000:case 0x2000000:n=64;break;case 0x10000000:n=0x8000000;break;default:n=0}if(0!==(n=0!=(n&(i.suspendedLanes|r))?0:n)&&n!==o.retryLane)throw o.retryLane=n,r0(e,n),oJ(i,e,n),aN}"$?"===u.data||le(),t=a4(e,t,r)}else"$?"===u.data?(t.flags|=128,t.child=e.child,t=lm.bind(null,e),u._reactRetry=t,t=null):(e=o.treeContext,ih=ua(u.nextSibling),ic=t,id=!0,ip=null,im=!1,null!==e&&(ie[it++]=ii,ie[it++]=ia,ie[it++]=ir,ii=e.id,ia=e.overflow,ir=t),t=a2(t,n.children),t.flags|=4096);return t}return a?(iq(t),a=n.fallback,u=t.mode,c=(o=e.child).sibling,(n=os(o,{mode:"hidden",children:n.children})).subtreeFlags=0x1e00000&o.subtreeFlags,null!==c?a=os(c,a):(a=ou(a,u,r,null),a.flags|=2),a.return=t,n.return=t,n.sibling=a,t.child=n,n=a,a=t.child,null===(u=e.child.memoizedState)?u=aZ(r):(null!==(o=u.cachePool)?(c=i2._currentValue,o=o.parent!==c?{parent:c,pool:c}:o):o=nn(),u={baseLanes:u.baseLanes|r,cachePool:o}),a.memoizedState=u,a.childLanes=a0(e,i,r),t.memoizedState=aJ,n):(iY(t),e=(r=e.child).sibling,(r=os(r,{mode:"visible",children:n.children})).return=t,r.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r)}function a2(e,t){return(t=a3({mode:"visible",children:t},e.mode)).return=e,e.child=t}function a3(e,t){return oc(e,t,0,null)}function a4(e,t,r){return iU(t,e.child,null,r),e=a2(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function a5(e,t,r){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),ss(e.return,t,r)}function a6(e,t,r,i,n){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=r,a.tailMode=n)}function a8(e,t,r){var i=t.pendingProps,n=i.revealOrder,a=i.tail;if(aG(e,t,i.children,r),0!=(2&(i=i$.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!=(128&e.flags))s:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&a5(e,r,t);else if(19===e.tag)a5(e,r,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)break s;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}switch(j(i$,i),n){case"forwards":for(n=null,r=t.child;null!==r;)null!==(e=r.alternate)&&null===iJ(e)&&(n=r),r=r.sibling;null===(r=n)?(n=t.child,t.child=null):(n=r.sibling,r.sibling=null),a6(t,!1,n,r,a);break;case"backwards":for(r=null,n=t.child,t.child=null;null!==n;){if(null!==(e=n.alternate)&&null===iJ(e)){t.child=n;break}e=n.sibling,n.sibling=r,r=n,n=e}a6(t,!0,r,null,a);break;case"together":a6(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function a9(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),oB|=t.lanes,0==(r&t.childLanes)&&(null===e||(sl(e,t,r,!1),0==(r&t.childLanes))))return null;if(null!==e&&t.child!==e.child)throw Error(l(153));if(null!==t.child){for(r=os(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=os(e,e.pendingProps)).return=t;r.sibling=null}return t.child}function a7(e,t){return 0!=(e.lanes&t)||!!(null!==(e=e.dependencies)&&su(e))}function se(e,t,r){if(null!==e){if(e.memoizedProps!==t.pendingProps)az=!0;else{if(!a7(e,r)&&0==(128&t.flags))return az=!1,function(e,t,r){switch(t.tag){case 3:$(t,t.stateNode.containerInfo),sn(t,i2,e.memoizedState.cache),ix();break;case 27:case 5:Z(t);break;case 4:$(t,t.stateNode.containerInfo);break;case 10:sn(t,t.type,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i){if(null!==i.dehydrated)return iY(t),t.flags|=128,null;if(0!=(r&t.child.childLanes))return a1(e,t,r);return iY(t),null!==(e=a9(e,t,r))?e.sibling:null}iY(t);break;case 19:var n=0!=(128&e.flags);if((i=0!=(r&t.childLanes))||(sl(e,t,r,!1),i=0!=(r&t.childLanes)),n){if(i)return a8(e,t,r);t.flags|=128}if(null!==(n=t.memoizedState)&&(n.rendering=null,n.tail=null,n.lastEffect=null),j(i$,i$.current),!i)return null;break;case 22:case 23:return t.lanes=0,aW(e,t,r);case 24:sn(t,i2,e.memoizedState.cache)}return a9(e,t,r)}(e,t,r);az=0!=(131072&e.flags)}}else az=!1,id&&0!=(1048576&t.flags)&&io(t,r7,t.index);switch(t.lanes=0,t.tag){case 16:s:{e=t.pendingProps;var i=t.elementType,n=i._init;if(i=n(i._payload),t.type=i,"function"==typeof i)oa(i)?(e=aM(i,e),t.tag=1,t=aX(null,t,i,e,r)):(t.tag=0,t=aK(null,t,i,e,r));else{if(null!=i){if((n=i.$$typeof)===v){t.tag=11,t=aH(null,t,i,e,r);break s}if(n===x){t.tag=14,t=aQ(null,t,i,e,r);break s}}throw Error(l(306,t=function e(t){if(null==t)return null;if("function"==typeof t)return t.$$typeof===M?null:t.displayName||t.name||null;if("string"==typeof t)return t;switch(t){case d:return"Fragment";case h:return"Portal";case p:return"Profiler";case f:return"StrictMode";case y:return"Suspense";case E:return"SuspenseList"}if("object"==typeof t)switch(t.$$typeof){case A:return(t.displayName||"Context")+".Provider";case g:return(t._context.displayName||"Context")+".Consumer";case v:var r=t.render;return(t=t.displayName)||(t=""!==(t=r.displayName||r.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case x:return null!==(r=t.displayName||null)?r:e(t.type)||"Memo";case _:r=t._payload,t=t._init;try{return e(t(r))}catch(e){}}return null}(i)||i,""))}}return t;case 0:return aK(e,t,t.type,t.pendingProps,r);case 1:return n=aM(i=t.type,t.pendingProps),aX(e,t,i,n,r);case 3:s:{if($(t,t.stateNode.containerInfo),null===e)throw Error(l(387));var a=t.pendingProps;i=(n=t.memoizedState).element,sg(e,t),sb(t,a,null,r);var s=t.memoizedState;if(sn(t,i2,a=s.cache),a!==n.cache&&so(t,[i2],r,!0),s_(),a=s.element,n.isDehydrated){if(n={element:a,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=n,t.memoizedState=n,256&t.flags){t=a$(e,t,a,r);break s}if(a!==i){i_(i=r5(Error(l(424)),t)),t=a$(e,t,a,r);break s}for(ih=ua(t.stateNode.containerInfo.firstChild),ic=t,id=!0,ip=null,im=!0,r=iN(t,null,a,r),t.child=r;r;)r.flags=-3&r.flags|4096,r=r.sibling}else{if(ix(),a===i){t=a9(e,t,r);break s}aG(e,t,a,r)}t=t.child}return t;case 26:return aY(e,t),null===e?(r=up(t.type,null,t.pendingProps,null))?t.memoizedState=r:id||(r=t.type,e=t.pendingProps,(i=l3(q.current).createElement(r))[eL]=t,i[ek]=e,l0(i,r,e),eY(i),t.stateNode=i):t.memoizedState=up(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Z(t),null===e&&id&&(i=t.stateNode=uo(t.type,t.pendingProps,q.current),ic=t,im=!0,ih=ua(i.firstChild)),i=t.pendingProps.children,null!==e||id?aG(e,t,i,r):t.child=iU(t,null,i,r),aY(e,t),t.child;case 5:return null===e&&id&&((n=i=ih)&&(null!==(i=function(e,t,r,i){for(;1===e.nodeType;){if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!i&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(i){if(!e[eG])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(n=e.getAttribute("rel"))&&e.hasAttribute("data-precedence")||n!==r.rel||e.getAttribute("href")!==(null==r.href?null:r.href)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin)||e.getAttribute("title")!==(null==r.title?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((n=e.getAttribute("src"))!==(null==r.src?null:r.src)||e.getAttribute("type")!==(null==r.type?null:r.type)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin))&&n&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var n=null==r.name?null:""+r.name;if("hidden"===r.type&&e.getAttribute("name")===n)return e}if(null===(e=ua(e.nextSibling)))break}return null}(i,t.type,t.pendingProps,im))?(t.stateNode=i,ic=t,ih=ua(i.firstChild),im=!1,n=!0):n=!1),n||iA(t)),Z(t),n=t.type,a=t.pendingProps,s=null!==e?e.memoizedProps:null,i=a.children,l6(n,a)?i=null:null!==s&&l6(n,s)&&(t.flags|=32),null!==t.memoizedState&&(n=nv(e,t,nx,null,null,r),uL._currentValue=n),aY(e,t),aG(e,t,i,r),t.child;case 6:return null===e&&id&&((e=r=ih)&&(null!==(r=function(e,t,r){if(""===t)return null;for(;3!==e.nodeType;)if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!r||null===(e=ua(e.nextSibling)))return null;return e}(r,t.pendingProps,im))?(t.stateNode=r,ic=t,ih=null,e=!0):e=!1),e||iA(t)),null;case 13:return a1(e,t,r);case 4:return $(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=iU(t,null,i,r):aG(e,t,i,r),t.child;case 11:return aH(e,t,t.type,t.pendingProps,r);case 7:return aG(e,t,t.pendingProps,r),t.child;case 8:case 12:return aG(e,t,t.pendingProps.children,r),t.child;case 10:return i=t.pendingProps,sn(t,t.type,i.value),aG(e,t,i.children,r),t.child;case 9:return n=t.type._context,i=t.pendingProps.children,sc(t),i=i(n=sh(n)),t.flags|=1,aG(e,t,i,r),t.child;case 14:return aQ(e,t,t.type,t.pendingProps,r);case 15:return aV(e,t,t.type,t.pendingProps,r);case 19:return a8(e,t,r);case 22:return aW(e,t,r);case 24:return sc(t),i=sh(i2),null===e?(null===(n=nr())&&(n=o_,a=i3(),n.pooledCache=a,a.refCount++,null!==a&&(n.pooledCacheLanes|=r),n=a),t.memoizedState={parent:i,cache:n},sm(t),sn(t,i2,n)):(0!=(e.lanes&r)&&(sg(e,t),sb(t,null,null,r),s_()),n=e.memoizedState,a=t.memoizedState,n.parent!==i?(n={parent:i,cache:i},t.memoizedState=n,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=n),sn(t,i2,i)):(sn(t,i2,i=a.cache),i!==n.cache&&so(t,[i2],r,!0))),aG(e,t,t.pendingProps.children,r),t.child;case 29:throw t.pendingProps}throw Error(l(156,t.tag))}var st=V(null),sr=null,si=null;function sn(e,t,r){j(st,t._currentValue),t._currentValue=r}function sa(e){e._currentValue=st.current,W(st)}function ss(e,t,r){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===r)break;e=e.return}}function so(e,t,r,i){var n=e.child;for(null!==n&&(n.return=e);null!==n;){var a=n.dependencies;if(null!==a){var s=n.child;a=a.firstContext;s:for(;null!==a;){var o=a;a=n;for(var u=0;u<t.length;u++)if(o.context===t[u]){a.lanes|=r,null!==(o=a.alternate)&&(o.lanes|=r),ss(a.return,r,e),i||(s=null);break s}a=o.next}}else if(18===n.tag){if(null===(s=n.return))throw Error(l(341));s.lanes|=r,null!==(a=s.alternate)&&(a.lanes|=r),ss(s,r,e),s=null}else s=n.child;if(null!==s)s.return=n;else for(s=n;null!==s;){if(s===e){s=null;break}if(null!==(n=s.sibling)){n.return=s.return,s=n;break}s=s.return}n=s}}function sl(e,t,r,i){e=null;for(var n=t,a=!1;null!==n;){if(!a){if(0!=(524288&n.flags))a=!0;else if(0!=(262144&n.flags))break}if(10===n.tag){var s=n.alternate;if(null===s)throw Error(l(387));if(null!==(s=s.memoizedProps)){var o=n.type;rx(n.pendingProps.value,s.value)||(null!==e?e.push(o):e=[o])}}else if(n===X.current){if(null===(s=n.alternate))throw Error(l(387));s.memoizedState.memoizedState!==n.memoizedState.memoizedState&&(null!==e?e.push(uL):e=[uL])}n=n.return}null!==e&&so(t,e,r,i),t.flags|=262144}function su(e){for(e=e.firstContext;null!==e;){if(!rx(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function sc(e){sr=e,si=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function sh(e){return sf(sr,e)}function sd(e,t){return null===sr&&sc(e),sf(e,t)}function sf(e,t){var r=t._currentValue;if(t={context:t,memoizedValue:r,next:null},null===si){if(null===e)throw Error(l(308));si=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else si=si.next=t;return r}var sp=!1;function sm(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function sg(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function sA(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function sv(e,t,r){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!=(2&ox)){var n=i.pending;return null===n?t.next=t:(t.next=n.next,n.next=t),i.pending=t,t=r2(e),r1(e,null,r),t}return rJ(e,i,t,r),r2(e)}function sy(e,t,r){if(null!==(t=t.updateQueue)&&(t=t.shared,0!=(4194176&r))){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,eR(e,r)}}function sE(e,t){var r=e.updateQueue,i=e.alternate;if(null!==i&&r===(i=i.updateQueue)){var n=null,a=null;if(null!==(r=r.firstBaseUpdate)){do{var s={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};null===a?n=a=s:a=a.next=s,r=r.next}while(null!==r);null===a?n=a=t:a=a.next=t}else n=a=t;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:a,shared:i.shared,callbacks:i.callbacks},e.updateQueue=r;return}null===(e=r.lastBaseUpdate)?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}var sx=!1;function s_(){if(sx){var e=i9;if(null!==e)throw e}}function sb(e,t,r,i){sx=!1;var n=e.updateQueue;sp=!1;var a=n.firstBaseUpdate,s=n.lastBaseUpdate,o=n.shared.pending;if(null!==o){n.shared.pending=null;var l=o,u=l.next;l.next=null,null===s?a=u:s.next=u,s=l;var c=e.alternate;null!==c&&(o=(c=c.updateQueue).lastBaseUpdate)!==s&&(null===o?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l)}if(null!==a){var h=n.baseState;for(s=0,c=u=l=null,o=a;;){var d=-0x20000001&o.lane,f=d!==o.lane;if(f?(oS&d)===d:(i&d)===d){0!==d&&d===i8&&(sx=!0),null!==c&&(c=c.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});s:{var p=e,m=o;switch(d=t,m.tag){case 1:if("function"==typeof(p=m.payload)){h=p.call(r,h,d);break s}h=p;break s;case 3:p.flags=-65537&p.flags|128;case 0:if(null==(d="function"==typeof(p=m.payload)?p.call(r,h,d):p))break s;h=B({},h,d);break s;case 2:sp=!0}}null!==(d=o.callback)&&(e.flags|=64,f&&(e.flags|=8192),null===(f=n.callbacks)?n.callbacks=[d]:f.push(d))}else f={lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===c?(u=c=f,l=h):c=c.next=f,s|=d;if(null===(o=o.next)){if(null===(o=n.shared.pending))break;o=(f=o).next,f.next=null,n.lastBaseUpdate=f,n.shared.pending=null}}null===c&&(l=h),n.baseState=l,n.firstBaseUpdate=u,n.lastBaseUpdate=c,null===a&&(n.shared.lanes=0),oB|=s,e.lanes=s,e.memoizedState=h}}function sS(e,t){if("function"!=typeof e)throw Error(l(191,e));e.call(t)}function sw(e,t){var r=e.callbacks;if(null!==r)for(e.callbacks=null,e=0;e<r.length;e++)sS(r[e],t)}function sC(e,t){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var n=i.next;r=n;do{if((r.tag&e)===e){i=void 0;var a=r.create,s=r.inst;i=a(),s.destroy=i}r=r.next}while(r!==n)}}catch(e){lh(t,t.return,e)}}function sT(e,t,r){try{var i=t.updateQueue,n=null!==i?i.lastEffect:null;if(null!==n){var a=n.next;i=a;do{if((i.tag&e)===e){var s=i.inst,o=s.destroy;if(void 0!==o){s.destroy=void 0,n=t;try{o()}catch(e){lh(n,r,e)}}}i=i.next}while(i!==a)}}catch(e){lh(t,t.return,e)}}function sI(e){var t=e.updateQueue;if(null!==t){var r=e.stateNode;try{sw(t,r)}catch(t){lh(e,e.return,t)}}}function sM(e,t,r){r.props=aM(e.type,e.memoizedProps),r.state=e.memoizedState;try{r.componentWillUnmount()}catch(r){lh(e,t,r)}}function sR(e,t){try{var r=e.ref;if(null!==r){var i=e.stateNode;switch(e.tag){case 26:case 27:case 5:var n=i;break;default:n=i}"function"==typeof r?e.refCleanup=r(n):r.current=n}}catch(r){lh(e,t,r)}}function sB(e,t){var r=e.ref,i=e.refCleanup;if(null!==r){if("function"==typeof i)try{i()}catch(r){lh(e,t,r)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof r)try{r(null)}catch(r){lh(e,t,r)}else r.current=null}}function sD(e){var t=e.type,r=e.memoizedProps,i=e.stateNode;try{switch(t){case"button":case"input":case"select":case"textarea":r.autoFocus&&i.focus();break;case"img":r.src?i.src=r.src:r.srcSet&&(i.srcset=r.srcSet)}}catch(t){lh(e,e.return,t)}}function sP(e,t,r){try{var i=e.stateNode;(function(e,t,r,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var n=null,a=null,s=null,o=null,u=null,c=null,h=null;for(p in r){var d=r[p];if(r.hasOwnProperty(p)&&null!=d)switch(p){case"checked":case"value":break;case"defaultValue":u=d;default:i.hasOwnProperty(p)||lJ(e,t,p,null,i,d)}}for(var f in i){var p=i[f];if(d=r[f],i.hasOwnProperty(f)&&(null!=p||null!=d))switch(f){case"type":a=p;break;case"name":n=p;break;case"checked":c=p;break;case"defaultChecked":h=p;break;case"value":s=p;break;case"defaultValue":o=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(l(137,t));break;default:p!==d&&lJ(e,t,f,p,i,d)}}tr(e,s,o,u,c,h,a,n);return;case"select":for(a in p=s=o=f=null,r)if(u=r[a],r.hasOwnProperty(a)&&null!=u)switch(a){case"value":break;case"multiple":p=u;default:i.hasOwnProperty(a)||lJ(e,t,a,null,i,u)}for(n in i)if(a=i[n],u=r[n],i.hasOwnProperty(n)&&(null!=a||null!=u))switch(n){case"value":f=a;break;case"defaultValue":o=a;break;case"multiple":s=a;default:a!==u&&lJ(e,t,n,a,i,u)}t=o,r=s,i=p,null!=f?ta(e,!!r,f,!1):!!i!=!!r&&(null!=t?ta(e,!!r,t,!0):ta(e,!!r,r?[]:"",!1));return;case"textarea":for(o in p=f=null,r)if(n=r[o],r.hasOwnProperty(o)&&null!=n&&!i.hasOwnProperty(o))switch(o){case"value":case"children":break;default:lJ(e,t,o,null,i,n)}for(s in i)if(n=i[s],a=r[s],i.hasOwnProperty(s)&&(null!=n||null!=a))switch(s){case"value":f=n;break;case"defaultValue":p=n;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=n)throw Error(l(91));break;default:n!==a&&lJ(e,t,s,n,i,a)}ts(e,f,p);return;case"option":for(var m in r)f=r[m],r.hasOwnProperty(m)&&null!=f&&!i.hasOwnProperty(m)&&("selected"===m?e.selected=!1:lJ(e,t,m,null,i,f));for(u in i)f=i[u],p=r[u],i.hasOwnProperty(u)&&f!==p&&(null!=f||null!=p)&&("selected"===u?e.selected=f&&"function"!=typeof f&&"symbol"!=typeof f:lJ(e,t,u,f,i,p));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in r)f=r[g],r.hasOwnProperty(g)&&null!=f&&!i.hasOwnProperty(g)&&lJ(e,t,g,null,i,f);for(c in i)if(f=i[c],p=r[c],i.hasOwnProperty(c)&&f!==p&&(null!=f||null!=p))switch(c){case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(l(137,t));break;default:lJ(e,t,c,f,i,p)}return;default:if(td(t)){for(var A in r)f=r[A],r.hasOwnProperty(A)&&void 0!==f&&!i.hasOwnProperty(A)&&lZ(e,t,A,void 0,i,f);for(h in i)f=i[h],p=r[h],i.hasOwnProperty(h)&&f!==p&&(void 0!==f||void 0!==p)&&lZ(e,t,h,f,i,p);return}}for(var v in r)f=r[v],r.hasOwnProperty(v)&&null!=f&&!i.hasOwnProperty(v)&&lJ(e,t,v,null,i,f);for(d in i)f=i[d],p=r[d],i.hasOwnProperty(d)&&f!==p&&(null!=f||null!=p)&&lJ(e,t,d,f,i,p)})(i,e.type,r,t),i[ek]=t}catch(t){lh(e,e.return,t)}}function sL(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag||4===e.tag}function sk(e){s:for(;;){for(;null===e.sibling;){if(null===e.return||sL(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&27!==e.tag&&18!==e.tag;){if(2&e.flags||null===e.child||4===e.tag)continue s;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function sF(e,t,r){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(4!==i&&27!==i&&null!==(e=e.child))for(sF(e,t,r),e=e.sibling;null!==e;)sF(e,t,r),e=e.sibling}var sO=!1,sU=!1,sN=!1,sz="function"==typeof WeakSet?WeakSet:Set,sG=null,sH=!1;function sQ(e,t,r){var i=r.flags;switch(r.tag){case 0:case 11:case 15:s0(e,r),4&i&&sC(5,r);break;case 1:if(s0(e,r),4&i){if(e=r.stateNode,null===t)try{e.componentDidMount()}catch(e){lh(r,r.return,e)}else{var n=aM(r.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(n,t,e.__reactInternalSnapshotBeforeUpdate)}catch(e){lh(r,r.return,e)}}}64&i&&sI(r),512&i&&sR(r,r.return);break;case 3:if(s0(e,r),64&i&&null!==(i=r.updateQueue)){if(e=null,null!==r.child)switch(r.child.tag){case 27:case 5:case 1:e=r.child.stateNode}try{sw(i,e)}catch(e){lh(r,r.return,e)}}break;case 26:s0(e,r),512&i&&sR(r,r.return);break;case 27:case 5:s0(e,r),null===t&&4&i&&sD(r),512&i&&sR(r,r.return);break;case 12:default:s0(e,r);break;case 13:s0(e,r),4&i&&sK(e,r);break;case 22:if(!(n=null!==r.memoizedState||sO)){t=null!==t&&null!==t.memoizedState||sU;var a=sO,s=sU;sO=n,(sU=t)&&!s?function e(t,r,i){for(i=i&&0!=(8772&r.subtreeFlags),r=r.child;null!==r;){var n=r.alternate,a=t,s=r,o=s.flags;switch(s.tag){case 0:case 11:case 15:e(a,s,i),sC(4,s);break;case 1:if(e(a,s,i),"function"==typeof(a=(n=s).stateNode).componentDidMount)try{a.componentDidMount()}catch(e){lh(n,n.return,e)}if(null!==(a=(n=s).updateQueue)){var l=n.stateNode;try{var u=a.shared.hiddenCallbacks;if(null!==u)for(a.shared.hiddenCallbacks=null,a=0;a<u.length;a++)sS(u[a],l)}catch(e){lh(n,n.return,e)}}i&&64&o&&sI(s),sR(s,s.return);break;case 26:case 27:case 5:e(a,s,i),i&&null===n&&4&o&&sD(s),sR(s,s.return);break;case 12:default:e(a,s,i);break;case 13:e(a,s,i),i&&4&o&&sK(a,s);break;case 22:null===s.memoizedState&&e(a,s,i),sR(s,s.return)}r=r.sibling}}(e,r,0!=(8772&r.subtreeFlags)):s0(e,r),sO=a,sU=s}512&i&&("manual"===r.memoizedProps.mode?sR(r,r.return):sB(r,r.return))}}var sV=null,sW=!1;function sj(e,t,r){for(r=r.child;null!==r;)sY(e,t,r),r=r.sibling}function sY(e,t,r){if(eg&&"function"==typeof eg.onCommitFiberUnmount)try{eg.onCommitFiberUnmount(em,r)}catch(e){}switch(r.tag){case 26:sU||sB(r,t),sj(e,t,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode).parentNode.removeChild(r);break;case 27:sU||sB(r,t);var i=sV,n=sW;for(sV=r.stateNode,sj(e,t,r),t=(r=r.stateNode).attributes;t.length;)r.removeAttributeNode(t[0]);eH(r),sV=i,sW=n;break;case 5:sU||sB(r,t);case 6:n=sV;var a=sW;if(sV=null,sj(e,t,r),sV=n,sW=a,null!==sV){if(sW)try{e=sV,i=r.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)}catch(e){lh(r,t,e)}else try{sV.removeChild(r.stateNode)}catch(e){lh(r,t,e)}}break;case 18:null!==sV&&(sW?(t=sV,r=r.stateNode,8===t.nodeType?ui(t.parentNode,r):1===t.nodeType&&ui(t,r),ct(t)):ui(sV,r.stateNode));break;case 4:i=sV,n=sW,sV=r.stateNode.containerInfo,sW=!0,sj(e,t,r),sV=i,sW=n;break;case 0:case 11:case 14:case 15:sU||sT(2,r,t),sU||sT(4,r,t),sj(e,t,r);break;case 1:sU||(sB(r,t),"function"==typeof(i=r.stateNode).componentWillUnmount&&sM(r,t,i)),sj(e,t,r);break;case 21:default:sj(e,t,r);break;case 22:sU||sB(r,t),sU=(i=sU)||null!==r.memoizedState,sj(e,t,r),sU=i}}function sK(e,t){if(null===t.memoizedState&&null!==(e=t.alternate)&&null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))try{ct(e)}catch(e){lh(t,t.return,e)}}function sq(e,t){var r=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new sz),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new sz),t;default:throw Error(l(435,e.tag))}}(e);t.forEach(function(t){var i=lg.bind(null,e,t);r.has(t)||(r.add(t),t.then(i,i))})}function sX(e,t){var r=t.deletions;if(null!==r)for(var i=0;i<r.length;i++){var n=r[i],a=e,s=t,o=s;s:for(;null!==o;){switch(o.tag){case 27:case 5:sV=o.stateNode,sW=!1;break s;case 3:case 4:sV=o.stateNode.containerInfo,sW=!0;break s}o=o.return}if(null===sV)throw Error(l(160));sY(a,s,n),sV=null,sW=!1,null!==(a=n.alternate)&&(a.return=null),n.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)sJ(t,e),t=t.sibling}var s$=null;function sJ(e,t){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:sX(t,e),sZ(e),4&i&&(sT(3,e,e.return),sC(3,e),sT(5,e,e.return));break;case 1:sX(t,e),sZ(e),512&i&&(sU||null===r||sB(r,r.return)),64&i&&sO&&null!==(e=e.updateQueue)&&null!==(i=e.callbacks)&&(r=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===r?i:r.concat(i));break;case 26:var n=s$;if(sX(t,e),sZ(e),512&i&&(sU||null===r||sB(r,r.return)),4&i){var a=null!==r?r.memoizedState:null;if(i=e.memoizedState,null===r){if(null===i){if(null===e.stateNode){s:{i=e.type,r=e.memoizedProps,n=n.ownerDocument||n;o:switch(i){case"title":(!(a=n.getElementsByTagName("title")[0])||a[eG]||a[eL]||"http://www.w3.org/2000/svg"===a.namespaceURI||a.hasAttribute("itemprop"))&&(a=n.createElement(i),n.head.insertBefore(a,n.querySelector("head > title"))),l0(a,i,r),a[eL]=e,eY(a),i=a;break s;case"link":var s=uw("link","href",n).get(i+(r.href||""));if(s){for(var o=0;o<s.length;o++)if((a=s[o]).getAttribute("href")===(null==r.href?null:r.href)&&a.getAttribute("rel")===(null==r.rel?null:r.rel)&&a.getAttribute("title")===(null==r.title?null:r.title)&&a.getAttribute("crossorigin")===(null==r.crossOrigin?null:r.crossOrigin)){s.splice(o,1);break o}}l0(a=n.createElement(i),i,r),n.head.appendChild(a);break;case"meta":if(s=uw("meta","content",n).get(i+(r.content||""))){for(o=0;o<s.length;o++)if((a=s[o]).getAttribute("content")===(null==r.content?null:""+r.content)&&a.getAttribute("name")===(null==r.name?null:r.name)&&a.getAttribute("property")===(null==r.property?null:r.property)&&a.getAttribute("http-equiv")===(null==r.httpEquiv?null:r.httpEquiv)&&a.getAttribute("charset")===(null==r.charSet?null:r.charSet)){s.splice(o,1);break o}}l0(a=n.createElement(i),i,r),n.head.appendChild(a);break;default:throw Error(l(468,i))}a[eL]=e,eY(a),i=a}e.stateNode=i}else uC(n,e.type,e.stateNode)}else e.stateNode=uE(n,i,e.memoizedProps)}else a!==i?(null===a?null!==r.stateNode&&(r=r.stateNode).parentNode.removeChild(r):a.count--,null===i?uC(n,e.type,e.stateNode):uE(n,i,e.memoizedProps)):null===i&&null!==e.stateNode&&sP(e,e.memoizedProps,r.memoizedProps)}break;case 27:if(4&i&&null===e.alternate){n=e.stateNode,a=e.memoizedProps;try{for(var u=n.firstChild;u;){var c=u.nextSibling,h=u.nodeName;u[eG]||"HEAD"===h||"BODY"===h||"SCRIPT"===h||"STYLE"===h||"LINK"===h&&"stylesheet"===u.rel.toLowerCase()||n.removeChild(u),u=c}for(var d=e.type,f=n.attributes;f.length;)n.removeAttributeNode(f[0]);l0(n,d,a),n[eL]=e,n[ek]=a}catch(t){lh(e,e.return,t)}}case 5:if(sX(t,e),sZ(e),512&i&&(sU||null===r||sB(r,r.return)),32&e.flags){n=e.stateNode;try{tl(n,"")}catch(t){lh(e,e.return,t)}}4&i&&null!=e.stateNode&&(n=e.memoizedProps,sP(e,n,null!==r?r.memoizedProps:n)),1024&i&&(sN=!0);break;case 6:if(sX(t,e),sZ(e),4&i){if(null===e.stateNode)throw Error(l(162));i=e.memoizedProps,r=e.stateNode;try{r.nodeValue=i}catch(t){lh(e,e.return,t)}}break;case 3:if(uS=null,n=s$,s$=uc(t.containerInfo),sX(t,e),s$=n,sZ(e),4&i&&null!==r&&r.memoizedState.isDehydrated)try{ct(t.containerInfo)}catch(t){lh(e,e.return,t)}sN&&(sN=!1,function e(t){if(1024&t.subtreeFlags)for(t=t.child;null!==t;){var r=t;e(r),5===r.tag&&1024&r.flags&&r.stateNode.reset(),t=t.sibling}}(e));break;case 4:i=s$,s$=uc(e.stateNode.containerInfo),sX(t,e),sZ(e),s$=i;break;case 12:default:sX(t,e),sZ(e);break;case 13:sX(t,e),sZ(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==r&&null!==r.memoizedState)&&(oN=es()),4&i&&null!==(i=e.updateQueue)&&(e.updateQueue=null,sq(e,i));break;case 22:if(512&i&&(sU||null===r||sB(r,r.return)),u=null!==e.memoizedState,c=null!==r&&null!==r.memoizedState,h=sO,d=sU,sO=h||u,sU=d||c,sX(t,e),sU=d,sO=h,sZ(e),(t=e.stateNode)._current=e,t._visibility&=-3,t._visibility|=2&t._pendingVisibility,8192&i&&(t._visibility=u?-2&t._visibility:1|t._visibility,u&&(t=sO||sU,null===r||c||t||function e(t){for(t=t.child;null!==t;){var r=t;switch(r.tag){case 0:case 11:case 14:case 15:sT(4,r,r.return),e(r);break;case 1:sB(r,r.return);var i=r.stateNode;"function"==typeof i.componentWillUnmount&&sM(r,r.return,i),e(r);break;case 26:case 27:case 5:sB(r,r.return),e(r);break;case 22:sB(r,r.return),null===r.memoizedState&&e(r);break;default:e(r)}t=t.sibling}}(e)),null===e.memoizedProps||"manual"!==e.memoizedProps.mode))s:for(r=null,t=e;;){if(5===t.tag||26===t.tag||27===t.tag){if(null===r){c=r=t;try{if(n=c.stateNode,u)a=n.style,"function"==typeof a.setProperty?a.setProperty("display","none","important"):a.display="none";else{s=c.stateNode;var p=null!=(o=c.memoizedProps.style)&&o.hasOwnProperty("display")?o.display:null;s.style.display=null==p||"boolean"==typeof p?"":(""+p).trim()}}catch(e){lh(c,c.return,e)}}}else if(6===t.tag){if(null===r){c=t;try{c.stateNode.nodeValue=u?"":c.memoizedProps}catch(e){lh(c,c.return,e)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)break s;r===t&&(r=null),t=t.return}r===t&&(r=null),t.sibling.return=t.return,t=t.sibling}4&i&&null!==(i=e.updateQueue)&&null!==(r=i.retryQueue)&&(i.retryQueue=null,sq(e,r));break;case 19:sX(t,e),sZ(e),4&i&&null!==(i=e.updateQueue)&&(e.updateQueue=null,sq(e,i));case 21:}}function sZ(e){var t=e.flags;if(2&t){try{if(27!==e.tag){s:{for(var r=e.return;null!==r;){if(sL(r)){var i=r;break s}r=r.return}throw Error(l(160))}switch(i.tag){case 27:var n=i.stateNode,a=sk(e);sF(e,a,n);break;case 5:var s=i.stateNode;32&i.flags&&(tl(s,""),i.flags&=-33);var o=sk(e);sF(e,o,s);break;case 3:case 4:var u=i.stateNode.containerInfo,c=sk(e);!function e(t,r,i){var n=t.tag;if(5===n||6===n)t=t.stateNode,r?8===i.nodeType?i.parentNode.insertBefore(t,r):i.insertBefore(t,r):(8===i.nodeType?(r=i.parentNode).insertBefore(t,i):(r=i).appendChild(t),null!=(i=i._reactRootContainer)||null!==r.onclick||(r.onclick=l$));else if(4!==n&&27!==n&&null!==(t=t.child))for(e(t,r,i),t=t.sibling;null!==t;)e(t,r,i),t=t.sibling}(e,c,u);break;default:throw Error(l(161))}}}catch(t){lh(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function s0(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)sQ(e,t.alternate,t),t=t.sibling}function s1(e,t){var r=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(r=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==r&&(null!=e&&e.refCount++,null!=r&&i4(r))}function s2(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&i4(e))}function s3(e,t,r,i){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)s4(e,t,r,i),t=t.sibling}function s4(e,t,r,i){var n=t.flags;switch(t.tag){case 0:case 11:case 15:s3(e,t,r,i),2048&n&&sC(9,t);break;case 3:s3(e,t,r,i),2048&n&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&i4(e)));break;case 12:if(2048&n){s3(e,t,r,i),e=t.stateNode;try{var a=t.memoizedProps,s=a.id,o=a.onPostCommit;"function"==typeof o&&o(s,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(e){lh(t,t.return,e)}}else s3(e,t,r,i);break;case 23:break;case 22:a=t.stateNode,null!==t.memoizedState?4&a._visibility?s3(e,t,r,i):s5(e,t):4&a._visibility?s3(e,t,r,i):(a._visibility|=4,function e(t,r,i,n,a){for(a=a&&0!=(10256&r.subtreeFlags),r=r.child;null!==r;){var s=r,o=s.flags;switch(s.tag){case 0:case 11:case 15:e(t,s,i,n,a),sC(8,s);break;case 23:break;case 22:var l=s.stateNode;null!==s.memoizedState?4&l._visibility?e(t,s,i,n,a):s5(t,s):(l._visibility|=4,e(t,s,i,n,a)),a&&2048&o&&s1(s.alternate,s);break;case 24:e(t,s,i,n,a),a&&2048&o&&s2(s.alternate,s);break;default:e(t,s,i,n,a)}r=r.sibling}}(e,t,r,i,0!=(10256&t.subtreeFlags))),2048&n&&s1(t.alternate,t);break;case 24:s3(e,t,r,i),2048&n&&s2(t.alternate,t);break;default:s3(e,t,r,i)}}function s5(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var r=t,i=r.flags;switch(r.tag){case 22:s5(e,r),2048&i&&s1(r.alternate,r);break;case 24:s5(e,r),2048&i&&s2(r.alternate,r);break;default:s5(e,r)}t=t.sibling}}var s6=8192;function s8(e){if(e.subtreeFlags&s6)for(e=e.child;null!==e;)s9(e),e=e.sibling}function s9(e){switch(e.tag){case 26:s8(e),e.flags&s6&&null!==e.memoizedState&&function(e,t,r){if(null===uI)throw Error(l(475));var i=uI;if("stylesheet"===t.type&&("string"!=typeof r.media||!1!==matchMedia(r.media).matches)&&0==(4&t.state.loading)){if(null===t.instance){var n=um(r.href),a=e.querySelector(ug(n));if(a){null!==(e=a._p)&&"object"==typeof e&&"function"==typeof e.then&&(i.count++,i=uR.bind(i),e.then(i,i)),t.state.loading|=4,t.instance=a,eY(a);return}a=e.ownerDocument||e,r=uA(r),(n=ul.get(n))&&u_(r,n),eY(a=a.createElement("link"));var s=a;s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),l0(a,"link",r),t.instance=a}null===i.stylesheets&&(i.stylesheets=new Map),i.stylesheets.set(t,e),(e=t.state.preload)&&0==(3&t.state.loading)&&(i.count++,t=uR.bind(i),e.addEventListener("load",t),e.addEventListener("error",t))}}(s$,e.memoizedState,e.memoizedProps);break;case 5:default:s8(e);break;case 3:case 4:var t=s$;s$=uc(e.stateNode.containerInfo),s8(e),s$=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=s6,s6=0x1000000,s8(e),s6=t):s8(e))}}function s7(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(null!==e)}}function oe(e){var t=e.deletions;if(0!=(16&e.flags)){if(null!==t)for(var r=0;r<t.length;r++){var i=t[r];sG=i,or(i,e)}s7(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)ot(e),e=e.sibling}function ot(e){switch(e.tag){case 0:case 11:case 15:oe(e),2048&e.flags&&sT(9,e,e.return);break;case 3:case 12:default:oe(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&4&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-5,function e(t){var r=t.deletions;if(0!=(16&t.flags)){if(null!==r)for(var i=0;i<r.length;i++){var n=r[i];sG=n,or(n,t)}s7(t)}for(t=t.child;null!==t;){switch((r=t).tag){case 0:case 11:case 15:sT(8,r,r.return),e(r);break;case 22:4&(i=r.stateNode)._visibility&&(i._visibility&=-5,e(r));break;default:e(r)}t=t.sibling}}(e)):oe(e)}}function or(e,t){for(;null!==sG;){var r=sG;switch(r.tag){case 0:case 11:case 15:sT(8,r,t);break;case 23:case 22:if(null!==r.memoizedState&&null!==r.memoizedState.cachePool){var i=r.memoizedState.cachePool.pool;null!=i&&i.refCount++}break;case 24:i4(r.memoizedState.cache)}if(null!==(i=r.child))i.return=r,sG=i;else for(r=e;null!==sG;){var n=(i=sG).sibling,a=i.return;if(function e(t){var r=t.alternate;null!==r&&(t.alternate=null,e(r)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&null!==(r=t.stateNode)&&eH(r),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}(i),i===r){sG=null;break}if(null!==n){n.return=a,sG=n;break}sG=a}}}function oi(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function on(e,t,r,i){return new oi(e,t,r,i)}function oa(e){return!(!(e=e.prototype)||!e.isReactComponent)}function os(e,t){var r=e.alternate;return null===r?((r=on(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=0x1e00000&e.flags,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r.refCleanup=e.refCleanup,r}function oo(e,t){e.flags&=0x1e00002;var r=e.alternate;return null===r?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=r.childLanes,e.lanes=r.lanes,e.child=r.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=r.memoizedProps,e.memoizedState=r.memoizedState,e.updateQueue=r.updateQueue,e.type=r.type,t=r.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function ol(e,t,r,i,n,a){var s=0;if(i=e,"function"==typeof e)oa(e)&&(s=1);else if("string"==typeof e)s=!function(e,t,r){if(1===r||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;if("stylesheet"===t.rel)return e=t.disabled,"string"==typeof t.precedence&&null==e;return!0;case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,r,Y.current)?"html"===e||"head"===e||"body"===e?27:5:26;else s:switch(e){case d:return ou(r.children,n,a,t);case f:s=8,n|=24;break;case p:return(e=on(12,r,t,2|n)).elementType=p,e.lanes=a,e;case y:return(e=on(13,r,t,n)).elementType=y,e.lanes=a,e;case E:return(e=on(19,r,t,n)).elementType=E,e.lanes=a,e;case b:return oc(r,n,a,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case m:case A:s=10;break s;case g:s=9;break s;case v:s=11;break s;case x:s=14;break s;case _:s=16,i=null;break s}s=29,r=Error(l(130,null===e?"null":typeof e,"")),i=null}return(t=on(s,r,t,n)).elementType=e,t.type=i,t.lanes=a,t}function ou(e,t,r,i){return(e=on(7,e,i,t)).lanes=r,e}function oc(e,t,r,i){(e=on(22,e,i,t)).elementType=b,e.lanes=r;var n={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var e=n._current;if(null===e)throw Error(l(456));if(0==(2&n._pendingVisibility)){var t=r0(e,2);null!==t&&(n._pendingVisibility|=2,oJ(t,e,2))}},attach:function(){var e=n._current;if(null===e)throw Error(l(456));if(0!=(2&n._pendingVisibility)){var t=r0(e,2);null!==t&&(n._pendingVisibility&=-3,oJ(t,e,2))}}};return e.stateNode=n,e}function oh(e,t,r){return(e=on(6,e,null,t)).lanes=r,e}function od(e,t,r){return(t=on(4,null!==e.children?e.children:[],e.key,t)).lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function of(e){e.flags|=4}function op(e,t){if("stylesheet"!==t.type||0!=(4&t.state.loading))e.flags&=-0x1000001;else if(e.flags|=0x1000000,!uT(t)){if(o8())e.flags|=8192;else throw iM=iw,iS}}function om(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?eC():0x20000000,e.lanes|=t)}function og(e,t){if(!id)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;null!==r;)null!==r.alternate&&(i=r),r=r.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function oA(e){var t=null!==e.alternate&&e.alternate.child===e.child,r=0,i=0;if(t)for(var n=e.child;null!==n;)r|=n.lanes|n.childLanes,i|=0x1e00000&n.subtreeFlags,i|=0x1e00000&n.flags,n.return=e,n=n.sibling;else for(n=e.child;null!==n;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=i,e.childLanes=r,t}function ov(e,t){switch(iu(t),t.tag){case 3:sa(i2),J();break;case 26:case 27:case 5:ee(t);break;case 4:J();break;case 13:iX(t);break;case 19:W(i$);break;case 10:sa(t.type);break;case 22:case 23:iX(t),iV(),null!==e&&W(nt);break;case 24:sa(i2)}}var oy={getCacheForType:function(e){var t=sh(i2),r=t.data.get(e);return void 0===r&&(r=e(),t.data.set(e,r)),r}},oE="function"==typeof WeakMap?WeakMap:Map,ox=0,o_=null,ob=null,oS=0,ow=0,oC=null,oT=!1,oI=!1,oM=0,oR=0,oB=0,oD=0,oP=0,oL=0,ok=0,oF=null,oO=null,oU=!1,oN=0,oz=1/0,oG=null,oH=null,oQ=!1,oV=null,oW=0,oj=0,oY=null,oK=0,oq=null;function oX(){if(0!=(2&ox)&&0!==oS)return oS&-oS;if(null!==R.T){var e=i8;return 0!==e?e:lM()}return eD()}function o$(){0===oL&&(oL=0==(0x20000000&oS)||id?ew():0x20000000);var e=iW.current;return null!==e&&(e.flags|=32),oL}function oJ(e,t,r){(e===o_&&2===ow||null!==e.cancelPendingCommit)&&(o5(e,0),o2(e,oS,oL)),eI(e,r),(0==(2&ox)||e!==o_)&&(e===o_&&(0==(2&ox)&&(oD|=r),4===oR&&o2(e,oS,oL)),lb(e))}function oZ(e,t,r){if(0!=(6&ox))throw Error(l(327));var i=(r=!r&&0==(60&t)&&0==(t&e.expiredLanes))?function(e,t){var r=ox;ox|=2;var i=o9(),n=o7();(o_!==e||oS!==t)&&(oG=null,oz=es()+500,o5(e,t));s:for(;;)try{if(0!==ow&&null!==ob){t=ob;var a=oC;o:switch(ow){case 1:ow=0,oC=null,ln(e,t,a,1);break;case 2:if(iC(a)){ow=0,oC=null,li(t);break}t=function(){2===ow&&o_===e&&(ow=7),lb(e)},a.then(t,t);break s;case 3:ow=7;break s;case 4:ow=5;break s;case 7:iC(a)?(ow=0,oC=null,li(t)):(ow=0,oC=null,ln(e,t,a,7));break;case 5:var s=null;switch(ob.tag){case 26:s=ob.memoizedState;case 5:case 27:var o=ob;if(s?uT(s):1){ow=0,oC=null;var u=o.sibling;if(null!==u)ob=u;else{var c=o.return;null!==c?(ob=c,la(c)):ob=null}break o}}ow=0,oC=null,ln(e,t,a,5);break;case 6:ow=0,oC=null,ln(e,t,a,6);break;case 8:o4(),oR=6;break s;default:throw Error(l(462))}}(function(){for(;null!==ob&&!en();)lr(ob)})();break}catch(t){o6(e,t)}return(si=sr=null,R.H=i,R.A=n,ox=r,null!==ob)?0:(o_=null,oS=0,r$(),oR)}(e,t):lt(e,t);if(0!==i)for(var n=r;;){if(6===i)o2(e,t,0);else{if(r=e.current.alternate,n&&!function(e){for(var t=e;;){var r=t.tag;if((0===r||11===r||15===r)&&16384&t.flags&&null!==(r=t.updateQueue)&&null!==(r=r.stores))for(var i=0;i<r.length;i++){var n=r[i],a=n.getSnapshot;n=n.value;try{if(!rx(a(),n))return!1}catch(e){return!1}}if(r=t.child,16384&t.subtreeFlags&&null!==r)r.return=t,t=r;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)){i=lt(e,t),n=!1;continue}if(2===i){if(n=t,e.errorRecoveryDisabledLanes&n)var a=0;else a=0!=(a=-0x20000001&e.pendingLanes)?a:0x20000000&a?0x20000000:0;if(0!==a){t=a;s:{i=oF;var s=e.current.memoizedState.isDehydrated;if(s&&(o5(e,a).flags|=256),2!==(a=lt(e,a))){if(oI&&!s){e.errorRecoveryDisabledLanes|=n,oD|=n,i=4;break s}n=oO,oO=i,null!==n&&o0(n)}i=a}if(n=!1,2!==i)continue}}if(1===i){o5(e,0),o2(e,t,0);break}s:{switch(n=e,i){case 0:case 1:throw Error(l(345));case 4:if((4194176&t)===t){o2(n,t,oL);break s}break;case 2:oO=null;break;case 3:case 5:break;default:throw Error(l(329))}if(n.finishedWork=r,n.finishedLanes=t,(0x3c00000&t)===t&&10<(i=oN+300-es())){if(o2(n,t,oL),0!==eS(n,0))break s;n.timeoutHandle=l9(o1.bind(null,n,r,oO,oG,oU,t,oL,oD,ok,oT,2,-0,0),i);break s}o1(n,r,oO,oG,oU,t,oL,oD,ok,oT,0,-0,0)}}break}lb(e)}function o0(e){null===oO?oO=e:oO.push.apply(oO,e)}function o1(e,t,r,i,n,a,s,o,u,c,h,d,f){if((8192&(c=t.subtreeFlags)||0x1002000==(0x1002000&c))&&(uI={stylesheets:null,count:0,unsuspend:uM},s9(t),null!==(t=function(){if(null===uI)throw Error(l(475));var e=uI;return e.stylesheets&&0===e.count&&uD(e,e.stylesheets),0<e.count?function(t){var r=setTimeout(function(){if(e.stylesheets&&uD(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(r)}}:null}()))){e.cancelPendingCommit=t(lo.bind(null,e,r,i,n,s,o,u,1,d,f)),o2(e,a,s);return}lo(e,r,i,n,s,o,u,h,d,f)}function o2(e,t,r){t&=~oP,t&=~oD,e.suspendedLanes|=t,e.pingedLanes&=~t;for(var i=e.expirationTimes,n=t;0<n;){var a=31-ev(n),s=1<<a;i[a]=-1,n&=~s}0!==r&&eM(e,r,t)}function o3(){return 0!=(6&ox)||(lS(0,!1),!1)}function o4(){if(null!==ob){if(0===ow)var e=ob.return;else e=ob,si=sr=null,nS(e),iB=null,iD=0,e=ob;for(;null!==e;)ov(e.alternate,e),e=e.return;ob=null}}function o5(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;-1!==r&&(e.timeoutHandle=-1,l7(r)),null!==(r=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,r()),o4(),o_=e,ob=r=os(e.current,null),oS=t,ow=0,oC=null,oI=oT=!1,ok=oL=oP=oD=oB=oR=0,oO=oF=null,oU=!1,0!=(8&t)&&(t|=32&t);var i=e.entangledLanes;if(0!==i)for(e=e.entanglements,i&=t;0<i;){var n=31-ev(i),a=1<<n;t|=e[n],i&=~a}return oM=t,r$(),r}function o6(e,t){ns=null,R.H=ax,t===ib?(t=iR(),ow=o8()&&0==(0x7ffffff&oB)&&0==(0x7ffffff&oD)?2:3):t===iS?(t=iR(),ow=4):ow=t===aN?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,oC=t,null===ob&&(oR=1,aL(e,r5(t,e.current)))}function o8(){var e=iW.current;return null===e||((4194176&oS)===oS?null===ij:((0x3c00000&oS)===oS||0!=(0x20000000&oS))&&e===ij)}function o9(){var e=R.H;return R.H=ax,null===e?ax:e}function o7(){var e=R.A;return R.A=oy,e}function le(){oR=4,0==(0x7ffffff&oB)&&0==(0x7ffffff&oD)||null===o_||o2(o_,oS,oL)}function lt(e,t){var r=ox;ox|=2;var i=o9(),n=o7();(o_!==e||oS!==t)&&(oG=null,o5(e,t)),t=!1;s:for(;;)try{if(0!==ow&&null!==ob){var a=ob,s=oC;switch(ow){case 8:o4(),oR=6;break s;case 3:case 2:t||null!==iW.current||(t=!0);default:var o=ow;ow=0,oC=null,ln(e,a,s,o)}}(function(){for(;null!==ob;)lr(ob)})();break}catch(t){o6(e,t)}if(t&&e.shellSuspendCounter++,si=sr=null,ox=r,R.H=i,R.A=n,null!==ob)throw Error(l(261));return o_=null,oS=0,r$(),oR}function lr(e){var t=se(e.alternate,e,oM);e.memoizedProps=e.pendingProps,null===t?la(e):ob=t}function li(e){var t=e,r=t.alternate;switch(t.tag){case 15:case 0:t=aq(r,t,t.pendingProps,t.type,void 0,oS);break;case 11:t=aq(r,t,t.pendingProps,t.type.render,t.ref,oS);break;case 5:nS(t);default:ov(r,t),t=se(r,t=ob=oo(t,oM),oM)}e.memoizedProps=e.pendingProps,null===t?la(e):ob=t}function ln(e,t,r){si=sr=null,nS(t),iB=null,iD=0;var i=t.return;try{if(function(e,t,r,i,n){if(r.flags|=32768,null!==i&&"object"==typeof i&&"function"==typeof i.then){if(null!==(t=r.alternate)&&sl(t,r,n,!0),null!==(r=iW.current)){switch(r.tag){case 13:return null===ij?le():null===r.alternate&&0===oR&&(oR=3),r.flags&=-257,r.flags|=65536,r.lanes=n,i===iw?r.flags|=16384:(null===(t=r.updateQueue)?r.updateQueue=new Set([i]):t.add(i),ld(e,i,n)),!1;case 22:return r.flags|=65536,i===iw?r.flags|=16384:(null===(t=r.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},r.updateQueue=t):null===(r=t.retryQueue)?t.retryQueue=new Set([i]):r.add(i),ld(e,i,n)),!1}throw Error(l(435,r.tag))}return ld(e,i,n),le(),!1}if(id)return null!==(t=iW.current)?(0==(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=n,i!==ig&&i_(r5(e=Error(l(422),{cause:i}),r))):(i!==ig&&i_(r5(t=Error(l(423),{cause:i}),r)),e=e.current.alternate,e.flags|=65536,n&=-n,e.lanes|=n,i=r5(i,r),n=aF(e.stateNode,i,n),sE(e,n),4!==oR&&(oR=2)),!1;var a=Error(l(520),{cause:i});if(a=r5(a,r),null===oF?oF=[a]:oF.push(a),4!==oR&&(oR=2),null===t)return!0;i=r5(i,r),r=t;do{switch(r.tag){case 3:return r.flags|=65536,e=n&-n,r.lanes|=e,e=aF(r.stateNode,i,e),sE(r,e),!1;case 1:if(t=r.type,a=r.stateNode,0==(128&r.flags)&&("function"==typeof t.getDerivedStateFromError||null!==a&&"function"==typeof a.componentDidCatch&&(null===oH||!oH.has(a))))return r.flags|=65536,n&=-n,r.lanes|=n,aU(n=aO(n),e,r,i),sE(r,n),!1}r=r.return}while(null!==r);return!1}(e,i,t,r,oS)){oR=1,aL(e,r5(r,e.current)),ob=null;return}}catch(t){if(null!==i)throw ob=i,t;oR=1,aL(e,r5(r,e.current)),ob=null;return}32768&t.flags?ls(t,!0):la(t)}function la(e){var t=e;do{if(0!=(32768&t.flags)){ls(t,oT);return}e=t.return;var r=function(e,t,r){var i=t.pendingProps;switch(iu(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return oA(t),null;case 3:return r=t.stateNode,i=null,null!==e&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),sa(i2),J(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(null===e||null===e.child)&&(iE(t)?of(t):null===e||e.memoizedState.isDehydrated&&0==(256&t.flags)||(t.flags|=1024,null!==ip&&(o0(ip),ip=null))),oA(t),null;case 26:return r=t.memoizedState,null===e?(of(t),null!==r?(oA(t),op(t,r)):(oA(t),t.flags&=-0x1000001)):r?r!==e.memoizedState?(of(t),oA(t),op(t,r)):(oA(t),t.flags&=-0x1000001):(e.memoizedProps!==i&&of(t),oA(t),t.flags&=-0x1000001),null;case 27:ee(t),r=q.current;var n=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==i&&of(t);else{if(!i){if(null===t.stateNode)throw Error(l(166));return oA(t),null}e=Y.current,iE(t)?iv(t,e):(e=uo(n,i,r),t.stateNode=e,of(t))}return oA(t),null;case 5:if(ee(t),r=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==i&&of(t);else{if(!i){if(null===t.stateNode)throw Error(l(166));return oA(t),null}if(e=Y.current,iE(t))iv(t,e);else{switch(n=l3(q.current),e){case 1:e=n.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:e=n.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":e=n.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":e=n.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":(e=n.createElement("div")).innerHTML="<script></script>",e=e.removeChild(e.firstChild);break;case"select":e="string"==typeof i.is?n.createElement("select",{is:i.is}):n.createElement("select"),i.multiple?e.multiple=!0:i.size&&(e.size=i.size);break;default:e="string"==typeof i.is?n.createElement(r,{is:i.is}):n.createElement(r)}}e[eL]=t,e[ek]=i;s:for(n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&27!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)break s;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(t.stateNode=e,l0(e,r,i),r){case"button":case"input":case"select":case"textarea":e=!!i.autoFocus;break;case"img":e=!0;break;default:e=!1}e&&of(t)}}return oA(t),t.flags&=-0x1000001,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==i&&of(t);else{if("string"!=typeof i&&null===t.stateNode)throw Error(l(166));if(e=q.current,iE(t)){if(e=t.stateNode,r=t.memoizedProps,i=null,null!==(n=ic))switch(n.tag){case 27:case 5:i=n.memoizedProps}e[eL]=t,(e=!!(e.nodeValue===r||null!==i&&!0===i.suppressHydrationWarning||lX(e.nodeValue,r)))||iA(t)}else(e=l3(e).createTextNode(i))[eL]=t,t.stateNode=e}return oA(t),null;case 13:if(i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(n=iE(t),null!==i&&null!==i.dehydrated){if(null===e){if(!n)throw Error(l(318));if(!(n=null!==(n=t.memoizedState)?n.dehydrated:null))throw Error(l(317));n[eL]=t}else ix(),0==(128&t.flags)&&(t.memoizedState=null),t.flags|=4;oA(t),n=!1}else null!==ip&&(o0(ip),ip=null),n=!0;if(!n){if(256&t.flags)return iX(t),t;return iX(t),null}}if(iX(t),0!=(128&t.flags))return t.lanes=r,t;if(r=null!==i,e=null!==e&&null!==e.memoizedState,r){i=t.child,n=null,null!==i.alternate&&null!==i.alternate.memoizedState&&null!==i.alternate.memoizedState.cachePool&&(n=i.alternate.memoizedState.cachePool.pool);var a=null;null!==i.memoizedState&&null!==i.memoizedState.cachePool&&(a=i.memoizedState.cachePool.pool),a!==n&&(i.flags|=2048)}return r!==e&&r&&(t.child.flags|=8192),om(t,t.updateQueue),oA(t),null;case 4:return J(),null===e&&lz(t.stateNode.containerInfo),oA(t),null;case 10:return sa(t.type),oA(t),null;case 19:if(W(i$),null===(n=t.memoizedState))return oA(t),null;if(i=0!=(128&t.flags),null===(a=n.rendering)){if(i)og(n,!1);else{if(0!==oR||null!==e&&0!=(128&e.flags))for(e=t.child;null!==e;){if(null!==(a=iJ(e))){for(t.flags|=128,og(n,!1),e=a.updateQueue,t.updateQueue=e,om(t,e),t.subtreeFlags=0,e=r,r=t.child;null!==r;)oo(r,e),r=r.sibling;return j(i$,1&i$.current|2),t.child}e=e.sibling}null!==n.tail&&es()>oz&&(t.flags|=128,i=!0,og(n,!1),t.lanes=4194304)}}else{if(!i){if(null!==(e=iJ(a))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,om(t,e),og(n,!0),null===n.tail&&"hidden"===n.tailMode&&!a.alternate&&!id)return oA(t),null}else 2*es()-n.renderingStartTime>oz&&0x20000000!==r&&(t.flags|=128,i=!0,og(n,!1),t.lanes=4194304)}n.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=n.last)?e.sibling=a:t.child=a,n.last=a)}if(null!==n.tail)return t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=es(),t.sibling=null,e=i$.current,j(i$,i?1&e|2:1&e),t;return oA(t),null;case 22:case 23:return iX(t),iV(),i=null!==t.memoizedState,null!==e?null!==e.memoizedState!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?0!=(0x20000000&r)&&0==(128&t.flags)&&(oA(t),6&t.subtreeFlags&&(t.flags|=8192)):oA(t),null!==(r=t.updateQueue)&&om(t,r.retryQueue),r=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(r=e.memoizedState.cachePool.pool),i=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),i!==r&&(t.flags|=2048),null!==e&&W(nt),null;case 24:return r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),sa(i2),oA(t),null;case 25:return null}throw Error(l(156,t.tag))}(t.alternate,t,oM);if(null!==r){ob=r;return}if(null!==(t=t.sibling)){ob=t;return}ob=t=e}while(null!==t);0===oR&&(oR=5)}function ls(e,t){do{var r=function(e,t){switch(iu(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return sa(i2),J(),0!=(65536&(e=t.flags))&&0==(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return ee(t),null;case 13:if(iX(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(l(340));ix()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return W(i$),null;case 4:return J(),null;case 10:return sa(t.type),null;case 22:case 23:return iX(t),iV(),null!==e&&W(nt),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return sa(i2),null;default:return null}}(e.alternate,e);if(null!==r){r.flags&=32767,ob=r;return}if(null!==(r=e.return)&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!t&&null!==(e=e.sibling)){ob=e;return}ob=e=r}while(null!==e);oR=6,ob=null}function lo(e,t,r,i,n,a,s,o,u,c){var h=R.T,d=z.p;try{z.p=2,R.T=null,function(e,t,r,i,n,a){do lu();while(null!==oV);if(0!=(6&ox))throw Error(l(327));var s,o=e.finishedWork;if(i=e.finishedLanes,null!==o){if(e.finishedWork=null,e.finishedLanes=0,o===e.current)throw Error(l(177));e.callbackNode=null,e.callbackPriority=0,e.cancelPendingCommit=null;var u=o.lanes|o.childLanes;if(function(e,t,r,i){var n=e.pendingLanes;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=r,e.entangledLanes&=r,e.errorRecoveryDisabledLanes&=r,e.shellSuspendCounter=0,t=e.entanglements;var a=e.expirationTimes,s=e.hiddenUpdates;for(r=n&~r;0<r;){var o=31-ev(r);n=1<<o,t[o]=0,a[o]=-1;var l=s[o];if(null!==l)for(s[o]=null,o=0;o<l.length;o++){var u=l[o];null!==u&&(u.lane&=-0x20000001)}r&=~n}0!==i&&eM(e,i,0)}(e,i,u|=rX,a),e===o_&&(ob=o_=null,oS=0),0==(10256&o.subtreeFlags)&&0==(10256&o.flags)||oQ||(oQ=!0,oj=u,oY=r,s=function(){return lu(!0),null},er(ec,s)),r=0!=(15990&o.flags),0!=(15990&o.subtreeFlags)||r){r=R.T,R.T=null,a=z.p,z.p=2;var c=ox;ox|=4,function(e,t){if(e=e.containerInfo,l1=uz,rC(e=rw(e))){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else s:{var i=(r=(r=e.ownerDocument)&&r.defaultView||window).getSelection&&r.getSelection();if(i&&0!==i.rangeCount){r=i.anchorNode;var n,a=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{r.nodeType,s.nodeType}catch(e){r=null;break s}var o=0,u=-1,c=-1,h=0,d=0,f=e,p=null;o:for(;;){for(;f!==r||0!==a&&3!==f.nodeType||(u=o+a),f!==s||0!==i&&3!==f.nodeType||(c=o+i),3===f.nodeType&&(o+=f.nodeValue.length),null!==(n=f.firstChild);)p=f,f=n;for(;;){if(f===e)break o;if(p===r&&++h===a&&(u=o),p===s&&++d===i&&(c=o),null!==(n=f.nextSibling))break;p=(f=p).parentNode}f=n}r=-1===u||-1===c?null:{start:u,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(l2={focusedElem:e,selectionRange:r},uz=!1,sG=t;null!==sG;)if(e=(t=sG).child,0!=(1028&t.subtreeFlags)&&null!==e)e.return=t,sG=e;else for(;null!==sG;){switch(s=(t=sG).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!=(1024&e)&&null!==s){e=void 0,r=t,a=s.memoizedProps,s=s.memoizedState,i=r.stateNode;try{var m=aM(r.type,a,r.elementType===r.type);e=i.getSnapshotBeforeUpdate(m,s),i.__reactInternalSnapshotBeforeUpdate=e}catch(e){lh(r,r.return,e)}}break;case 3:if(0!=(1024&e)){if(9===(r=(e=t.stateNode.containerInfo).nodeType))un(e);else if(1===r)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":un(e);break;default:e.textContent=""}}break;default:if(0!=(1024&e))throw Error(l(163))}if(null!==(e=t.sibling)){e.return=t.return,sG=e;break}sG=t.return}m=sH,sH=!1}(e,o),sJ(o,e),function(e,t){var r=rw(t);t=e.focusedElem;var i=e.selectionRange;if(r!==t&&t&&t.ownerDocument&&function e(t,r){return!!t&&!!r&&(t===r||(!t||3!==t.nodeType)&&(r&&3===r.nodeType?e(t,r.parentNode):"contains"in t?t.contains(r):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(r))))}(t.ownerDocument.documentElement,t)){if(null!==i&&rC(t)){if(e=i.start,void 0===(r=i.end)&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if((r=(e=t.ownerDocument||document)&&e.defaultView||window).getSelection){r=r.getSelection();var n=t.textContent.length,a=Math.min(i.start,n);i=void 0===i.end?a:Math.min(i.end,n),!r.extend&&a>i&&(n=i,i=a,a=n),n=rS(t,a);var s=rS(t,i);n&&s&&(1!==r.rangeCount||r.anchorNode!==n.node||r.anchorOffset!==n.offset||r.focusNode!==s.node||r.focusOffset!==s.offset)&&((e=e.createRange()).setStart(n.node,n.offset),r.removeAllRanges(),a>i?(r.addRange(e),r.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)1===r.nodeType&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for("function"==typeof t.focus&&t.focus(),t=0;t<e.length;t++)(r=e[t]).element.scrollLeft=r.left,r.element.scrollTop=r.top}}(l2,e.containerInfo),uz=!!l1,l2=l1=null,e.current=o,sQ(e,o.alternate,o),ea(),ox=c,z.p=a,R.T=r}else e.current=o;if(oQ?(oQ=!1,oV=e,oW=i):ll(e,u),0===(u=e.pendingLanes)&&(oH=null),function(e){if(eg&&"function"==typeof eg.onCommitFiberRoot)try{eg.onCommitFiberRoot(em,e,void 0,128==(128&e.current.flags))}catch(e){}}(o.stateNode,n),lb(e),null!==t)for(n=e.onRecoverableError,o=0;o<t.length;o++)n((u=t[o]).value,{componentStack:u.stack});0!=(3&oW)&&lu(),u=e.pendingLanes,0!=(4194218&i)&&0!=(42&u)?e===oq?oK++:(oK=0,oq=e):oK=0,lS(0,!1)}}(e,t,r,i,d,n,a,s,o,u,c)}finally{R.T=h,z.p=d}}function ll(e,t){0==(e.pooledCacheLanes&=t)&&null!=(t=e.pooledCache)&&(e.pooledCache=null,i4(t))}function lu(){if(null!==oV){var e=oV,t=oj;oj=0;var r=eB(oW),i=R.T,n=z.p;try{if(z.p=32>r?32:r,R.T=null,null===oV)var a=!1;else{r=oY,oY=null;var s=oV,o=oW;if(oV=null,oW=0,0!=(6&ox))throw Error(l(331));var u=ox;if(ox|=4,ot(s.current),s4(s,s.current,o,r),ox=u,lS(0,!1),eg&&"function"==typeof eg.onPostCommitFiberRoot)try{eg.onPostCommitFiberRoot(em,s)}catch(e){}a=!0}return a}finally{z.p=n,R.T=i,ll(e,t)}}return!1}function lc(e,t,r){t=r5(r,t),t=aF(e.stateNode,t,2),null!==(e=sv(e,t,2))&&(eI(e,2),lb(e))}function lh(e,t,r){if(3===e.tag)lc(e,e,r);else for(;null!==t;){if(3===t.tag){lc(t,e,r);break}if(1===t.tag){var i=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===oH||!oH.has(i))){e=r5(r,e),null!==(i=sv(t,r=aO(2),2))&&(aU(r,i,t,e),eI(i,2),lb(i));break}}t=t.return}}function ld(e,t,r){var i=e.pingCache;if(null===i){i=e.pingCache=new oE;var n=new Set;i.set(t,n)}else void 0===(n=i.get(t))&&(n=new Set,i.set(t,n));n.has(r)||(oI=!0,n.add(r),e=lf.bind(null,e,t,r),t.then(e,e))}function lf(e,t,r){var i=e.pingCache;null!==i&&i.delete(t),e.pingedLanes|=e.suspendedLanes&r,e.warmLanes&=~r,o_===e&&(oS&r)===r&&(4===oR||3===oR&&(0x3c00000&oS)===oS&&300>es()-oN?0==(2&ox)&&o5(e,0):oP|=r,ok===oS&&(ok=0)),lb(e)}function lp(e,t){0===t&&(t=eC()),null!==(e=r0(e,t))&&(eI(e,t),lb(e))}function lm(e){var t=e.memoizedState,r=0;null!==t&&(r=t.retryLane),lp(e,r)}function lg(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,n=e.memoizedState;null!==n&&(r=n.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(l(314))}null!==i&&i.delete(t),lp(e,r)}var lA=null,lv=null,ly=!1,lE=!1,lx=!1,l_=0;function lb(e){var t;e!==lv&&null===e.next&&(null===lv?lA=lv=e:lv=lv.next=e),lE=!0,ly||(ly=!0,t=lw,ut(function(){0!=(6&ox)?er(el,t):t()}))}function lS(e,t){if(!lx&&lE){lx=!0;do for(var r=!1,i=lA;null!==i;){if(!t){if(0!==e){var n=i.pendingLanes;if(0===n)var a=0;else{var s=i.suspendedLanes,o=i.pingedLanes;a=0xc000055&(a=(1<<31-ev(42|e)+1)-1&(n&~(s&~o)))?0xc000055&a|1:a?2|a:0}0!==a&&(r=!0,lI(i,a))}else a=oS,0!=(3&(a=eS(i,i===o_?a:0)))&&(r=!0,lI(i,a))}i=i.next}while(r);lx=!1}}function lw(){lE=ly=!1;var e,t=0;0!==l_&&(((e=window.event)&&"popstate"===e.type?e===l8||(l8=e,0):(l8=null,1))||(t=l_),l_=0);for(var r=es(),i=null,n=lA;null!==n;){var a=n.next,s=lC(n,r);0===s?(n.next=null,null===i?lA=a:i.next=a,null===a&&(lv=i)):(i=n,(0!==t||0!=(3&s))&&(lE=!0)),n=a}lS(t,!1)}function lC(e,t){for(var r=e.suspendedLanes,i=e.pingedLanes,n=e.expirationTimes,a=-0x3c00001&e.pendingLanes;0<a;){var s=31-ev(a),o=1<<s,l=n[s];-1===l?(0==(o&r)||0!=(o&i))&&(n[s]=function(e,t){switch(e){case 1:case 2:case 4:case 8:return t+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return -1}}(o,t)):l<=t&&(e.expiredLanes|=o),a&=~o}if(t=o_,r=oS,r=eS(e,e===t?r:0),i=e.callbackNode,0===r||e===t&&2===ow||null!==e.cancelPendingCommit)return null!==i&&null!==i&&ei(i),e.callbackNode=null,e.callbackPriority=0;if(0!=(3&r))return null!==i&&null!==i&&ei(i),e.callbackPriority=2,e.callbackNode=null,2;if((t=r&-r)===e.callbackPriority)return t;switch(null!==i&&ei(i),eB(r)){case 2:r=el;break;case 8:r=eu;break;case 32:default:r=ec;break;case 0x10000000:r=ed}return r=er(r,i=lT.bind(null,e)),e.callbackPriority=t,e.callbackNode=r,t}function lT(e,t){var r=e.callbackNode;if(lu()&&e.callbackNode!==r)return null;var i=oS;return 0===(i=eS(e,e===o_?i:0))?null:(oZ(e,i,t),lC(e,es()),e.callbackNode===r?lT.bind(null,e):null)}function lI(e,t){if(lu())return null;oZ(e,t,!0)}function lM(){return 0===l_&&(l_=ew()),l_}function lR(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:tm(""+e)}function lB(e,t){var r=t.ownerDocument.createElement("input");return r.name=t.name,r.value=t.value,e.id&&r.setAttribute("form",e.id),t.parentNode.insertBefore(r,t),e=new FormData(e),r.parentNode.removeChild(r),e}for(var lD=0;lD<rj.length;lD++){var lP=rj[lD];rY(lP.toLowerCase(),"on"+(lP[0].toUpperCase()+lP.slice(1)))}rY(rU,"onAnimationEnd"),rY(rN,"onAnimationIteration"),rY(rz,"onAnimationStart"),rY("dblclick","onDoubleClick"),rY("focusin","onFocus"),rY("focusout","onBlur"),rY(rG,"onTransitionRun"),rY(rH,"onTransitionStart"),rY(rQ,"onTransitionCancel"),rY(rV,"onTransitionEnd"),e$("onMouseEnter",["mouseout","mouseover"]),e$("onMouseLeave",["mouseout","mouseover"]),e$("onPointerEnter",["pointerout","pointerover"]),e$("onPointerLeave",["pointerout","pointerover"]),eX("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),eX("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),eX("onBeforeInput",["compositionend","keypress","textInput","paste"]),eX("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),eX("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),eX("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lL="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lk=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(lL));function lF(e,t){t=0!=(4&t);for(var r=0;r<e.length;r++){var i=e[r],n=i.event;i=i.listeners;s:{var a=void 0;if(t)for(var s=i.length-1;0<=s;s--){var o=i[s],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==a&&n.isPropagationStopped())break s;a=o,n.currentTarget=u;try{a(n)}catch(e){aR(e)}n.currentTarget=null,a=l}else for(s=0;s<i.length;s++){if(l=(o=i[s]).instance,u=o.currentTarget,o=o.listener,l!==a&&n.isPropagationStopped())break s;a=o,n.currentTarget=u;try{a(n)}catch(e){aR(e)}n.currentTarget=null,a=l}}}}function lO(e,t){var r=t[eO];void 0===r&&(r=t[eO]=new Set);var i=e+"__bubble";r.has(i)||(lG(t,e,2,!1),r.add(i))}function lU(e,t,r){var i=0;t&&(i|=4),lG(r,e,i,t)}var lN="_reactListening"+Math.random().toString(36).slice(2);function lz(e){if(!e[lN]){e[lN]=!0,eK.forEach(function(t){"selectionchange"!==t&&(lk.has(t)||lU(t,!1,e),lU(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[lN]||(t[lN]=!0,lU("selectionchange",!1,t))}}function lG(e,t,r,i){switch(uY(t)){case 2:var n=uG;break;case 8:n=uH;break;default:n=uQ}r=n.bind(null,t,r,e),n=void 0,tS&&("touchstart"===t||"touchmove"===t||"wheel"===t)&&(n=!0),i?void 0!==n?e.addEventListener(t,r,{capture:!0,passive:n}):e.addEventListener(t,r,!0):void 0!==n?e.addEventListener(t,r,{passive:n}):e.addEventListener(t,r,!1)}function lH(e,t,r,i,n){var a=i;if(0==(1&t)&&0==(2&t)&&null!==i)s:for(;;){if(null===i)return;var s=i.tag;if(3===s||4===s){var o=i.stateNode.containerInfo;if(o===n||8===o.nodeType&&o.parentNode===n)break;if(4===s)for(s=i.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===n||8===l.nodeType&&l.parentNode===n))return;s=s.return}for(;null!==o;){if(null===(s=eQ(o)))return;if(5===(l=s.tag)||6===l||26===l||27===l){i=a=s;continue s}o=o.parentNode}}i=i.return}t_(function(){var i=a,n=tA(r),s=[];s:{var o=rW.get(e);if(void 0!==o){var l=tU,u=e;switch(e){case"keypress":if(0===tR(r))break s;case"keydown":case"keyup":l=tZ;break;case"focusin":u="focus",l=tV;break;case"focusout":u="blur",l=tV;break;case"beforeblur":case"afterblur":l=tV;break;case"click":if(2===r.button)break s;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=tH;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=tQ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=t1;break;case rU:case rN:case rz:l=tW;break;case rV:l=t2;break;case"scroll":case"scrollend":l=tz;break;case"wheel":l=t3;break;case"copy":case"cut":case"paste":l=tj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=t0;break;case"toggle":case"beforetoggle":l=t4}var c=0!=(4&t),h=!c&&("scroll"===e||"scrollend"===e),d=c?null!==o?o+"Capture":null:o;c=[];for(var f,p=i;null!==p;){var m=p;if(f=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===f||null===d||null!=(m=tb(p,d))&&c.push(lQ(p,m,f)),h)break;p=p.return}0<c.length&&(o=new l(o,u,null,r,n),s.push({event:o,listeners:c}))}}if(0==(7&t)){if(o="mouseover"===e||"pointerover"===e,l="mouseout"===e||"pointerout"===e,!(o&&r!==tg&&(u=r.relatedTarget||r.fromElement)&&(eQ(u)||u[eF]))&&(l||o)&&(o=n.window===n?n:(o=n.ownerDocument)?o.defaultView||o.parentWindow:window,l?(u=r.relatedTarget||r.toElement,l=i,null!==(u=u?eQ(u):null)&&(h=F(u),c=u.tag,u!==h||5!==c&&27!==c&&6!==c)&&(u=null)):(l=null,u=i),l!==u)){if(c=tH,m="onMouseLeave",d="onMouseEnter",p="mouse",("pointerout"===e||"pointerover"===e)&&(c=t0,m="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==l?o:eW(l),f=null==u?o:eW(u),(o=new c(m,p+"leave",l,r,n)).target=h,o.relatedTarget=f,m=null,eQ(n)===i&&((c=new c(d,p+"enter",u,r,n)).target=f,c.relatedTarget=h,m=c),h=m,l&&u)o:{for(c=l,d=u,p=0,f=c;f;f=lW(f))p++;for(f=0,m=d;m;m=lW(m))f++;for(;0<p-f;)c=lW(c),p--;for(;0<f-p;)d=lW(d),f--;for(;p--;){if(c===d||null!==d&&c===d.alternate)break o;c=lW(c),d=lW(d)}c=null}else c=null;null!==l&&lj(s,o,l,c,!1),null!==u&&null!==h&&lj(s,h,u,c,!0)}s:{if("select"===(l=(o=i?eW(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g,A=rh;else if(ra(o)){if(rd)A=rE;else{A=rv;var v=rA}}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)?A=ry:i&&td(i.elementType)&&(A=rh);if(A&&(A=A(e,i))){rs(s,A,r,n);break s}v&&v(e,o,i),"focusout"===e&&i&&"number"===o.type&&null!=i.memoizedProps.value&&tn(o,"number",o.value)}switch(v=i?eW(i):window,e){case"focusin":(ra(v)||"true"===v.contentEditable)&&(rI=v,rM=i,rR=null);break;case"focusout":rR=rM=rI=null;break;case"mousedown":rB=!0;break;case"contextmenu":case"mouseup":case"dragend":rB=!1,rD(s,r,n);break;case"selectionchange":if(rT)break;case"keydown":case"keyup":rD(s,r,n)}if(t6)o:{switch(e){case"compositionstart":var y="onCompositionStart";break o;case"compositionend":y="onCompositionEnd";break o;case"compositionupdate":y="onCompositionUpdate";break o}y=void 0}else ri?rt(e,r)&&(y="onCompositionEnd"):"keydown"===e&&229===r.keyCode&&(y="onCompositionStart");y&&(t7&&"ko"!==r.locale&&(ri||"onCompositionStart"!==y?"onCompositionEnd"===y&&ri&&(g=tM()):(tT="value"in(tC=n)?tC.value:tC.textContent,ri=!0)),0<(v=lV(i,y)).length&&(y=new tY(y,e,null,r,n),s.push({event:y,listeners:v}),g?y.data=g:null!==(g=rr(r))&&(y.data=g))),(g=t9?function(e,t){switch(e){case"compositionend":return rr(t);case"keypress":if(32!==t.which)return null;return re=!0," ";case"textInput":return" "===(e=t.data)&&re?null:e;default:return null}}(e,r):function(e,t){if(ri)return"compositionend"===e||!t6&&rt(e,t)?(e=tM(),tI=tT=tC=null,ri=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return t7&&"ko"!==t.locale?null:t.data}}(e,r))&&0<(y=lV(i,"onBeforeInput")).length&&(v=new tY("onBeforeInput","beforeinput",null,r,n),s.push({event:v,listeners:y}),v.data=g),function(e,t,r,i,n){if("submit"===t&&r&&r.stateNode===n){var a=lR((n[ek]||null).action),s=i.submitter;s&&null!==(t=(t=s[ek]||null)?lR(t.formAction):s.getAttribute("formAction"))&&(a=t,s=null);var o=new tU("action","action",null,i,n);e.push({event:o,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(0!==l_){var e=s?lB(n,s):new FormData(n);ao(r,{pending:!0,data:e,method:n.method,action:a},null,e)}}else"function"==typeof a&&(o.preventDefault(),ao(r,{pending:!0,data:e=s?lB(n,s):new FormData(n),method:n.method,action:a},a,e))},currentTarget:n}]})}}(s,e,i,r,n)}lF(s,t)})}function lQ(e,t,r){return{instance:e,listener:t,currentTarget:r}}function lV(e,t){for(var r=t+"Capture",i=[];null!==e;){var n=e,a=n.stateNode;5!==(n=n.tag)&&26!==n&&27!==n||null===a||(null!=(n=tb(e,r))&&i.unshift(lQ(e,n,a)),null!=(n=tb(e,t))&&i.push(lQ(e,n,a))),e=e.return}return i}function lW(e){if(null===e)return null;do e=e.return;while(e&&5!==e.tag&&27!==e.tag);return e||null}function lj(e,t,r,i,n){for(var a=t._reactName,s=[];null!==r&&r!==i;){var o=r,l=o.alternate,u=o.stateNode;if(o=o.tag,null!==l&&l===i)break;5!==o&&26!==o&&27!==o||null===u||(l=u,n?null!=(u=tb(r,a))&&s.unshift(lQ(r,u,l)):n||null!=(u=tb(r,a))&&s.push(lQ(r,u,l))),r=r.return}0!==s.length&&e.push({event:t,listeners:s})}var lY=/\r\n?/g,lK=/\u0000|\uFFFD/g;function lq(e){return("string"==typeof e?e:""+e).replace(lY,"\n").replace(lK,"")}function lX(e,t){return t=lq(t),lq(e)===t}function l$(){}function lJ(e,t,r,i,n,a){switch(r){case"children":"string"==typeof i?"body"===t||"textarea"===t&&""===i||tl(e,i):("number"==typeof i||"bigint"==typeof i)&&"body"!==t&&tl(e,""+i);break;case"className":e3(e,"class",i);break;case"tabIndex":e3(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":e3(e,r,i);break;case"style":th(e,i,a);break;case"data":if("object"!==t){e3(e,"data",i);break}case"src":case"href":if(""===i&&("a"!==t||"href"!==r)||null==i||"function"==typeof i||"symbol"==typeof i||"boolean"==typeof i){e.removeAttribute(r);break}i=tm(""+i),e.setAttribute(r,i);break;case"action":case"formAction":if("function"==typeof i){e.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof a&&("formAction"===r?("input"!==t&&lJ(e,t,"name",n.name,n,null),lJ(e,t,"formEncType",n.formEncType,n,null),lJ(e,t,"formMethod",n.formMethod,n,null),lJ(e,t,"formTarget",n.formTarget,n,null)):(lJ(e,t,"encType",n.encType,n,null),lJ(e,t,"method",n.method,n,null),lJ(e,t,"target",n.target,n,null))),null==i||"symbol"==typeof i||"boolean"==typeof i){e.removeAttribute(r);break}i=tm(""+i),e.setAttribute(r,i);break;case"onClick":null!=i&&(e.onclick=l$);break;case"onScroll":null!=i&&lO("scroll",e);break;case"onScrollEnd":null!=i&&lO("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!=typeof i||!("__html"in i))throw Error(l(61));if(null!=(r=i.__html)){if(null!=n.children)throw Error(l(60));e.innerHTML=r}}break;case"multiple":e.multiple=i&&"function"!=typeof i&&"symbol"!=typeof i;break;case"muted":e.muted=i&&"function"!=typeof i&&"symbol"!=typeof i;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":case"innerText":case"textContent":break;case"xlinkHref":if(null==i||"function"==typeof i||"boolean"==typeof i||"symbol"==typeof i){e.removeAttribute("xlink:href");break}r=tm(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=i&&"function"!=typeof i&&"symbol"!=typeof i?e.setAttribute(r,""+i):e.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&"function"!=typeof i&&"symbol"!=typeof i?e.setAttribute(r,""):e.removeAttribute(r);break;case"capture":case"download":!0===i?e.setAttribute(r,""):!1!==i&&null!=i&&"function"!=typeof i&&"symbol"!=typeof i?e.setAttribute(r,i):e.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&!isNaN(i)&&1<=i?e.setAttribute(r,i):e.removeAttribute(r);break;case"rowSpan":case"start":null==i||"function"==typeof i||"symbol"==typeof i||isNaN(i)?e.removeAttribute(r):e.setAttribute(r,i);break;case"popover":lO("beforetoggle",e),lO("toggle",e),e2(e,"popover",i);break;case"xlinkActuate":e4(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":e4(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":e4(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":e4(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":e4(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":e4(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":e4(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":e4(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":e4(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":e2(e,"is",i);break;default:2<r.length&&("o"===r[0]||"O"===r[0])&&("n"===r[1]||"N"===r[1])||e2(e,r=tf.get(r)||r,i)}}function lZ(e,t,r,i,n,a){switch(r){case"style":th(e,i,a);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!=typeof i||!("__html"in i))throw Error(l(61));if(null!=(r=i.__html)){if(null!=n.children)throw Error(l(60));e.innerHTML=r}}break;case"children":"string"==typeof i?tl(e,i):("number"==typeof i||"bigint"==typeof i)&&tl(e,""+i);break;case"onScroll":null!=i&&lO("scroll",e);break;case"onScrollEnd":null!=i&&lO("scrollend",e);break;case"onClick":null!=i&&(e.onclick=l$);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:if(!eq.hasOwnProperty(r))s:{if("o"===r[0]&&"n"===r[1]&&(n=r.endsWith("Capture"),t=r.slice(2,n?r.length-7:void 0),"function"==typeof(a=null!=(a=e[ek]||null)?a[r]:null)&&e.removeEventListener(t,a,n),"function"==typeof i)){"function"!=typeof a&&null!==a&&(r in e?e[r]=null:e.hasAttribute(r)&&e.removeAttribute(r)),e.addEventListener(t,i,n);break s}r in e?e[r]=i:!0===i?e.setAttribute(r,""):e2(e,r,i)}}}function l0(e,t,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":lO("error",e),lO("load",e);var i,n=!1,a=!1;for(i in r)if(r.hasOwnProperty(i)){var s=r[i];if(null!=s)switch(i){case"src":n=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,t));default:lJ(e,t,i,s,r,null)}}a&&lJ(e,t,"srcSet",r.srcSet,r,null),n&&lJ(e,t,"src",r.src,r,null);return;case"input":lO("invalid",e);var o=i=s=a=null,u=null,c=null;for(n in r)if(r.hasOwnProperty(n)){var h=r[n];if(null!=h)switch(n){case"name":a=h;break;case"type":s=h;break;case"checked":u=h;break;case"defaultChecked":c=h;break;case"value":i=h;break;case"defaultValue":o=h;break;case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(l(137,t));break;default:lJ(e,t,n,h,r,null)}}ti(e,i,o,u,c,s,a,!1),e8(e);return;case"select":for(a in lO("invalid",e),n=s=i=null,r)if(r.hasOwnProperty(a)&&null!=(o=r[a]))switch(a){case"value":i=o;break;case"defaultValue":s=o;break;case"multiple":n=o;default:lJ(e,t,a,o,r,null)}t=i,r=s,e.multiple=!!n,null!=t?ta(e,!!n,t,!1):null!=r&&ta(e,!!n,r,!0);return;case"textarea":for(s in lO("invalid",e),i=a=n=null,r)if(r.hasOwnProperty(s)&&null!=(o=r[s]))switch(s){case"value":n=o;break;case"defaultValue":a=o;break;case"children":i=o;break;case"dangerouslySetInnerHTML":if(null!=o)throw Error(l(91));break;default:lJ(e,t,s,o,r,null)}to(e,n,a,i),e8(e);return;case"option":for(u in r)r.hasOwnProperty(u)&&null!=(n=r[u])&&("selected"===u?e.selected=n&&"function"!=typeof n&&"symbol"!=typeof n:lJ(e,t,u,n,r,null));return;case"dialog":lO("cancel",e),lO("close",e);break;case"iframe":case"object":lO("load",e);break;case"video":case"audio":for(n=0;n<lL.length;n++)lO(lL[n],e);break;case"image":lO("error",e),lO("load",e);break;case"details":lO("toggle",e);break;case"embed":case"source":case"link":lO("error",e),lO("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in r)if(r.hasOwnProperty(c)&&null!=(n=r[c]))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,t));default:lJ(e,t,c,n,r,null)}return;default:if(td(t)){for(h in r)r.hasOwnProperty(h)&&void 0!==(n=r[h])&&lZ(e,t,h,n,r,void 0);return}}for(o in r)r.hasOwnProperty(o)&&null!=(n=r[o])&&lJ(e,t,o,n,r,null)}var l1=null,l2=null;function l3(e){return 9===e.nodeType?e:e.ownerDocument}function l4(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function l5(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function l6(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var l8=null,l9="function"==typeof setTimeout?setTimeout:void 0,l7="function"==typeof clearTimeout?clearTimeout:void 0,ue="function"==typeof Promise?Promise:void 0,ut="function"==typeof queueMicrotask?queueMicrotask:void 0!==ue?function(e){return ue.resolve(null).then(e).catch(ur)}:l9;function ur(e){setTimeout(function(){throw e})}function ui(e,t){var r=t,i=0;do{var n=r.nextSibling;if(e.removeChild(r),n&&8===n.nodeType){if("/$"===(r=n.data)){if(0===i){e.removeChild(n),ct(t);return}i--}else"$"!==r&&"$?"!==r&&"$!"!==r||i++}r=n}while(r);ct(t)}function un(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var r=t;switch(t=t.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":un(r),eH(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===r.rel.toLowerCase())continue}e.removeChild(r)}}function ua(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}function us(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if("$"===r||"$!"===r||"$?"===r){if(0===t)return e;t--}else"/$"===r&&t++}e=e.previousSibling}return null}function uo(e,t,r){switch(t=l3(r),e){case"html":if(!(e=t.documentElement))throw Error(l(452));return e;case"head":if(!(e=t.head))throw Error(l(453));return e;case"body":if(!(e=t.body))throw Error(l(454));return e;default:throw Error(l(451))}}var ul=new Map,uu=new Set;function uc(e){return"function"==typeof e.getRootNode?e.getRootNode():e.ownerDocument}var uh=z.d;z.d={f:function(){var e=uh.f(),t=o3();return e||t},r:function(e){var t=eV(e);null!==t&&5===t.tag&&"form"===t.type?au(t):uh.r(e)},D:function(e){uh.D(e),uf("dns-prefetch",e,null)},C:function(e,t){uh.C(e,t),uf("preconnect",e,t)},L:function(e,t,r){if(uh.L(e,t,r),ud&&e&&t){var i='link[rel="preload"][as="'+tt(t)+'"]';"image"===t&&r&&r.imageSrcSet?(i+='[imagesrcset="'+tt(r.imageSrcSet)+'"]',"string"==typeof r.imageSizes&&(i+='[imagesizes="'+tt(r.imageSizes)+'"]')):i+='[href="'+tt(e)+'"]';var n=i;switch(t){case"style":n=um(e);break;case"script":n=uv(e)}ul.has(n)||(e=B({rel:"preload",href:"image"===t&&r&&r.imageSrcSet?void 0:e,as:t},r),ul.set(n,e),null!==ud.querySelector(i)||"style"===t&&ud.querySelector(ug(n))||"script"===t&&ud.querySelector(uy(n))||(l0(t=ud.createElement("link"),"link",e),eY(t),ud.head.appendChild(t)))}},m:function(e,t){if(uh.m(e,t),ud&&e){var r=t&&"string"==typeof t.as?t.as:"script",i='link[rel="modulepreload"][as="'+tt(r)+'"][href="'+tt(e)+'"]',n=i;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":n=uv(e)}if(!ul.has(n)&&(e=B({rel:"modulepreload",href:e},t),ul.set(n,e),null===ud.querySelector(i))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(ud.querySelector(uy(n)))return}l0(r=ud.createElement("link"),"link",e),eY(r),ud.head.appendChild(r)}}},X:function(e,t){if(uh.X(e,t),ud&&e){var r=ej(ud).hoistableScripts,i=uv(e),n=r.get(i);n||((n=ud.querySelector(uy(i)))||(e=B({src:e,async:!0},t),(t=ul.get(i))&&ub(e,t),eY(n=ud.createElement("script")),l0(n,"link",e),ud.head.appendChild(n)),n={type:"script",instance:n,count:1,state:null},r.set(i,n))}},S:function(e,t,r){if(uh.S(e,t,r),ud&&e){var i=ej(ud).hoistableStyles,n=um(e);t=t||"default";var a=i.get(n);if(!a){var s={loading:0,preload:null};if(a=ud.querySelector(ug(n)))s.loading=5;else{e=B({rel:"stylesheet",href:e,"data-precedence":t},r),(r=ul.get(n))&&u_(e,r);var o=a=ud.createElement("link");eY(o),l0(o,"link",e),o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),o.addEventListener("load",function(){s.loading|=1}),o.addEventListener("error",function(){s.loading|=2}),s.loading|=4,ux(a,t,ud)}a={type:"stylesheet",instance:a,count:1,state:s},i.set(n,a)}}},M:function(e,t){if(uh.M(e,t),ud&&e){var r=ej(ud).hoistableScripts,i=uv(e),n=r.get(i);n||((n=ud.querySelector(uy(i)))||(e=B({src:e,async:!0,type:"module"},t),(t=ul.get(i))&&ub(e,t),eY(n=ud.createElement("script")),l0(n,"link",e),ud.head.appendChild(n)),n={type:"script",instance:n,count:1,state:null},r.set(i,n))}}};var ud="undefined"==typeof document?null:document;function uf(e,t,r){if(ud&&"string"==typeof t&&t){var i=tt(t);i='link[rel="'+e+'"][href="'+i+'"]',"string"==typeof r&&(i+='[crossorigin="'+r+'"]'),uu.has(i)||(uu.add(i),e={rel:e,crossOrigin:r,href:t},null===ud.querySelector(i)&&(l0(t=ud.createElement("link"),"link",e),eY(t),ud.head.appendChild(t)))}}function up(e,t,r,i){var n=(n=q.current)?uc(n):null;if(!n)throw Error(l(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof r.precedence&&"string"==typeof r.href?(t=um(r.href),(i=(r=ej(n).hoistableStyles).get(t))||(i={type:"style",instance:null,count:0,state:null},r.set(t,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===r.rel&&"string"==typeof r.href&&"string"==typeof r.precedence){e=um(r.href);var a,s,o,u,c=ej(n).hoistableStyles,h=c.get(e);if(h||(n=n.ownerDocument||n,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},c.set(e,h),(c=n.querySelector(ug(e)))&&!c._p&&(h.instance=c,h.state.loading=5),ul.has(e)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},ul.set(e,r),c||(a=n,s=e,o=r,u=h.state,a.querySelector('link[rel="preload"][as="style"]['+s+"]")?u.loading=1:(s=a.createElement("link"),u.preload=s,s.addEventListener("load",function(){return u.loading|=1}),s.addEventListener("error",function(){return u.loading|=2}),l0(s,"link",o),eY(s),a.head.appendChild(s))))),t&&null===i)throw Error(l(528,""));return h}if(t&&null!==i)throw Error(l(529,""));return null;case"script":return t=r.async,"string"==typeof(r=r.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=uv(r),(i=(r=ej(n).hoistableScripts).get(t))||(i={type:"script",instance:null,count:0,state:null},r.set(t,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,e))}}function um(e){return'href="'+tt(e)+'"'}function ug(e){return'link[rel="stylesheet"]['+e+"]"}function uA(e){return B({},e,{"data-precedence":e.precedence,precedence:null})}function uv(e){return'[src="'+tt(e)+'"]'}function uy(e){return"script[async]"+e}function uE(e,t,r){if(t.count++,null===t.instance)switch(t.type){case"style":var i=e.querySelector('style[data-href~="'+tt(r.href)+'"]');if(i)return t.instance=i,eY(i),i;var n=B({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return eY(i=(e.ownerDocument||e).createElement("style")),l0(i,"style",n),ux(i,r.precedence,e),t.instance=i;case"stylesheet":n=um(r.href);var a=e.querySelector(ug(n));if(a)return t.state.loading|=4,t.instance=a,eY(a),a;i=uA(r),(n=ul.get(n))&&u_(i,n),eY(a=(e.ownerDocument||e).createElement("link"));var s=a;return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),l0(a,"link",i),t.state.loading|=4,ux(a,r.precedence,e),t.instance=a;case"script":if(a=uv(r.src),n=e.querySelector(uy(a)))return t.instance=n,eY(n),n;return i=r,(n=ul.get(a))&&ub(i=B({},r),n),eY(n=(e=e.ownerDocument||e).createElement("script")),l0(n,"link",i),e.head.appendChild(n),t.instance=n;case"void":return null;default:throw Error(l(443,t.type))}else"stylesheet"===t.type&&0==(4&t.state.loading)&&(i=t.instance,t.state.loading|=4,ux(i,r.precedence,e));return t.instance}function ux(e,t,r){for(var i=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),n=i.length?i[i.length-1]:null,a=n,s=0;s<i.length;s++){var o=i[s];if(o.dataset.precedence===t)a=o;else if(a!==n)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=9===r.nodeType?r.head:r).insertBefore(e,t.firstChild)}function u_(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function ub(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var uS=null;function uw(e,t,r){if(null===uS){var i=new Map,n=uS=new Map;n.set(r,i)}else(i=(n=uS).get(r))||(i=new Map,n.set(r,i));if(i.has(e))return i;for(i.set(e,null),r=r.getElementsByTagName(e),n=0;n<r.length;n++){var a=r[n];if(!(a[eG]||a[eL]||"link"===e&&"stylesheet"===a.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==a.namespaceURI){var s=a.getAttribute(t)||"";s=e+s;var o=i.get(s);o?o.push(a):i.set(s,[a])}}return i}function uC(e,t,r){(e=e.ownerDocument||e).head.insertBefore(r,"title"===t?e.querySelector("head > title"):null)}function uT(e){return"stylesheet"!==e.type||0!=(3&e.state.loading)}var uI=null;function uM(){}function uR(){if(this.count--,0===this.count){if(this.stylesheets)uD(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var uB=null;function uD(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,uB=new Map,t.forEach(uP,e),uB=null,uR.call(e))}function uP(e,t){if(!(4&t.state.loading)){var r=uB.get(e);if(r)var i=r.get(null);else{r=new Map,uB.set(e,r);for(var n=e.querySelectorAll("link[data-precedence],style[data-precedence]"),a=0;a<n.length;a++){var s=n[a];("LINK"===s.nodeName||"not all"!==s.getAttribute("media"))&&(r.set(s.dataset.precedence,s),i=s)}i&&r.set(null,i)}s=(n=t.instance).getAttribute("data-precedence"),(a=r.get(s)||i)===i&&r.set(null,n),r.set(s,n),this.count++,i=uR.bind(this),n.addEventListener("load",i),n.addEventListener("error",i),a?a.parentNode.insertBefore(n,a.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(n,e.firstChild),t.state.loading|=4}}var uL={$$typeof:A,Provider:null,Consumer:null,_currentValue:G,_currentValue2:G,_threadCount:0};function uk(e,t,r,i,n,a,s,o){this.tag=1,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=eT(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=eT(0),this.hiddenUpdates=eT(null),this.identifierPrefix=i,this.onUncaughtError=n,this.onCaughtError=a,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function uF(e,t,r,i,n,a){var s;n=r3,null===i.context?i.context=n:i.pendingContext=n,(i=sA(t)).payload={element:r},null!==(a=void 0===a?null:a)&&(i.callback=a),null!==(r=sv(e,i,t))&&(oJ(r,e,t),sy(r,e,t))}function uO(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var r=e.retryLane;e.retryLane=0!==r&&r<t?r:t}}function uU(e,t){uO(e,t),(e=e.alternate)&&uO(e,t)}function uN(e){if(13===e.tag){var t=r0(e,0x4000000);null!==t&&oJ(t,e,0x4000000),uU(e,0x4000000)}}var uz=!0;function uG(e,t,r,i){var n=R.T;R.T=null;var a=z.p;try{z.p=2,uQ(e,t,r,i)}finally{z.p=a,R.T=n}}function uH(e,t,r,i){var n=R.T;R.T=null;var a=z.p;try{z.p=8,uQ(e,t,r,i)}finally{z.p=a,R.T=n}}function uQ(e,t,r,i){if(uz){var n=uV(i);if(null===n)lH(e,t,i,uW,r),u2(e,i);else if(function(e,t,r,i,n){switch(t){case"focusin":return uq=u3(uq,e,t,r,i,n),!0;case"dragenter":return uX=u3(uX,e,t,r,i,n),!0;case"mouseover":return u$=u3(u$,e,t,r,i,n),!0;case"pointerover":var a=n.pointerId;return uJ.set(a,u3(uJ.get(a)||null,e,t,r,i,n)),!0;case"gotpointercapture":return a=n.pointerId,uZ.set(a,u3(uZ.get(a)||null,e,t,r,i,n)),!0}return!1}(n,e,t,r,i))i.stopPropagation();else if(u2(e,i),4&t&&-1<u1.indexOf(e)){for(;null!==n;){var a=eV(n);if(null!==a)switch(a.tag){case 3:if((a=a.stateNode).current.memoizedState.isDehydrated){var s=eb(a.pendingLanes);if(0!==s){var o=a;for(o.pendingLanes|=2,o.entangledLanes|=2;s;){var l=1<<31-ev(s);o.entanglements[1]|=l,s&=~l}lb(a),0==(6&ox)&&(oz=es()+500,lS(0,!1))}}break;case 13:null!==(o=r0(a,2))&&oJ(o,a,2),o3(),uU(a,2)}if(null===(a=uV(i))&&lH(e,t,i,uW,r),a===n)break;n=a}null!==n&&i.stopPropagation()}else lH(e,t,i,null,r)}}function uV(e){return uj(e=tA(e))}var uW=null;function uj(e){if(uW=null,null!==(e=eQ(e))){var t=F(e);if(null===t)e=null;else{var r=t.tag;if(13===r){if(null!==(e=O(t)))return e;e=null}else if(3===r){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return uW=e,null}function uY(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(eo()){case el:return 2;case eu:return 8;case ec:case eh:return 32;case ed:return 0x10000000;default:return 32}default:return 32}}var uK=!1,uq=null,uX=null,u$=null,uJ=new Map,uZ=new Map,u0=[],u1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function u2(e,t){switch(e){case"focusin":case"focusout":uq=null;break;case"dragenter":case"dragleave":uX=null;break;case"mouseover":case"mouseout":u$=null;break;case"pointerover":case"pointerout":uJ.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":uZ.delete(t.pointerId)}}function u3(e,t,r,i,n,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:r,eventSystemFlags:i,nativeEvent:a,targetContainers:[n]},null!==t&&null!==(t=eV(t))&&uN(t)):(e.eventSystemFlags|=i,t=e.targetContainers,null!==n&&-1===t.indexOf(n)&&t.push(n)),e}function u4(e){var t=eQ(e.target);if(null!==t){var r=F(t);if(null!==r){if(13===(t=r.tag)){if(null!==(t=O(r))){e.blockedOn=t,function(e,t){var r=z.p;try{return z.p=e,t()}finally{z.p=r}}(e.priority,function(){if(13===r.tag){var e=oX(),t=r0(r,e);null!==t&&oJ(t,r,e),uU(r,e)}});return}}else if(3===t&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=3===r.tag?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function u5(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var r=uV(e.nativeEvent);if(null!==r)return null!==(t=eV(r))&&uN(t),e.blockedOn=r,!1;var i=new(r=e.nativeEvent).constructor(r.type,r);tg=i,r.target.dispatchEvent(i),tg=null,t.shift()}return!0}function u6(e,t,r){u5(e)&&r.delete(t)}function u8(){uK=!1,null!==uq&&u5(uq)&&(uq=null),null!==uX&&u5(uX)&&(uX=null),null!==u$&&u5(u$)&&(u$=null),uJ.forEach(u6),uZ.forEach(u6)}function u9(e,t){e.blockedOn===t&&(e.blockedOn=null,uK||(uK=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,u8)))}var u7=null;function ce(e){u7!==e&&(u7=e,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){u7===e&&(u7=null);for(var t=0;t<e.length;t+=3){var r=e[t],i=e[t+1],n=e[t+2];if("function"!=typeof i){if(null===uj(i||r))continue;break}var a=eV(r);null!==a&&(e.splice(t,3),t-=3,ao(a,{pending:!0,data:n,method:r.method,action:i},i,n))}}))}function ct(e){function t(t){return u9(t,e)}null!==uq&&u9(uq,e),null!==uX&&u9(uX,e),null!==u$&&u9(u$,e),uJ.forEach(t),uZ.forEach(t);for(var r=0;r<u0.length;r++){var i=u0[r];i.blockedOn===e&&(i.blockedOn=null)}for(;0<u0.length&&null===(r=u0[0]).blockedOn;)u4(r),null===r.blockedOn&&u0.shift();if(null!=(r=(e.ownerDocument||e).$$reactFormReplay))for(i=0;i<r.length;i+=3){var n=r[i],a=r[i+1],s=n[ek]||null;if("function"==typeof a)s||ce(r);else if(s){var o=null;if(a&&a.hasAttribute("formAction")){if(n=a,s=a[ek]||null)o=s.formAction;else if(null!==uj(n))continue}else o=s.action;"function"==typeof o?r[i+1]=o:(r.splice(i,3),i-=3),ce(r)}}}function cr(e){this._internalRoot=e}function ci(e){this._internalRoot=e}ci.prototype.render=cr.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(l(409));uF(t.current,oX(),e,t,null,null)},ci.prototype.unmount=cr.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;0===e.tag&&lu(),uF(e.current,2,null,e,null,null),o3(),t[eF]=null}},ci.prototype.unstable_scheduleHydration=function(e){if(e){var t=eD();e={blockedOn:null,target:e,priority:t};for(var r=0;r<u0.length&&0!==t&&t<u0[r].priority;r++);u0.splice(r,0,e),0===r&&u4(e)}};var cn=s.version;if("19.0.0-rc-66855b96-20241106"!==cn)throw Error(l(527,cn,"19.0.0-rc-66855b96-20241106"));if(z.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(l(188));throw Error(l(268,e=Object.keys(e).join(",")))}return e=null===(e=null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=F(e)))throw Error(l(188));return t!==e?null:e}for(var r=e,i=t;;){var n=r.return;if(null===n)break;var a=n.alternate;if(null===a){if(null!==(i=n.return)){r=i;continue}break}if(n.child===a.child){for(a=n.child;a;){if(a===r)return U(n),e;if(a===i)return U(n),t;a=a.sibling}throw Error(l(188))}if(r.return!==i.return)r=n,i=a;else{for(var s=!1,o=n.child;o;){if(o===r){s=!0,r=n,i=a;break}if(o===i){s=!0,i=n,r=a;break}o=o.sibling}if(!s){for(o=a.child;o;){if(o===r){s=!0,r=a,i=n;break}if(o===i){s=!0,i=a,r=n;break}o=o.sibling}if(!s)throw Error(l(189))}}if(r.alternate!==i)throw Error(l(190))}if(3!==r.tag)throw Error(l(188));return r.stateNode.current===r?e:t}(t))?function e(t){var r=t.tag;if(5===r||26===r||27===r||6===r)return t;for(t=t.child;null!==t;){if(null!==(r=e(t)))return r;t=t.sibling}return null}(e):null)?null:e.stateNode},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ca=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ca.isDisabled&&ca.supportsFiber)try{em=ca.inject({bundleType:0,version:"19.0.0-rc-66855b96-20241106",rendererPackageName:"react-dom",currentDispatcherRef:R,findFiberByHostInstance:eQ,reconcilerVersion:"19.0.0-rc-66855b96-20241106"}),eg=ca}catch(e){}}t.createRoot=function(e,t){if(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)throw Error(l(299));var r,i,n,a=!1,s="",o=aB,u=aD,c=aP,h=null;return null!=t&&(!0===t.unstable_strictMode&&(a=!0),void 0!==t.identifierPrefix&&(s=t.identifierPrefix),void 0!==t.onUncaughtError&&(o=t.onUncaughtError),void 0!==t.onCaughtError&&(u=t.onCaughtError),void 0!==t.onRecoverableError&&(c=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),r=e,i=1,n=a,r=new uk(r,i,!1,s,o,u,c,null),i=1,!0===n&&(i|=24),n=on(3,null,null,i),r.current=n,n.stateNode=r,i=i3(),i.refCount++,r.pooledCache=i,i.refCount++,n.memoizedState={element:null,isDehydrated:!1,cache:i},sm(n),t=r,e[eF]=t.current,lz(8===e.nodeType?e.parentNode:e),new cr(t)}},35750:(e,t,r)=>{"use strict";var i=r(14205);function n(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var s={d:{f:a,r:function(){throw Error(n(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},o=Symbol.for("react.portal"),l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,t.createPortal=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(n(299));return function(e,t,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:o,key:null==i?null:""+i,children:e,containerInfo:t,implementation:r}}(e,t,null,r)},t.flushSync=function(e){var t=l.T,r=s.p;try{if(l.T=null,s.p=2,e)return e()}finally{l.T=t,s.p=r,s.d.f()}},t.preconnect=function(e,t){"string"==typeof e&&(t=t?"string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:null,s.d.C(e,t))},t.prefetchDNS=function(e){"string"==typeof e&&s.d.D(e)},t.preinit=function(e,t){if("string"==typeof e&&t&&"string"==typeof t.as){var r=t.as,i=u(r,t.crossOrigin),n="string"==typeof t.integrity?t.integrity:void 0,a="string"==typeof t.fetchPriority?t.fetchPriority:void 0;"style"===r?s.d.S(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:i,integrity:n,fetchPriority:a}):"script"===r&&s.d.X(e,{crossOrigin:i,integrity:n,fetchPriority:a,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"==typeof e){if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var r=u(t.as,t.crossOrigin);s.d.M(e,{crossOrigin:r,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&s.d.M(e)}},t.preload=function(e,t){if("string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var r=t.as,i=u(r,t.crossOrigin);s.d.L(e,r,{crossOrigin:i,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0,media:"string"==typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"==typeof e){if(t){var r=u(t.as,t.crossOrigin);s.d.m(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:r,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else s.d.m(e)}},t.requestFormReset=function(e){s.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,r){return l.H.useFormState(e,t,r)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.0.0-rc-66855b96-20241106"},53413:(e,t,r)=>{"use strict";(function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}})(),e.exports=r(75614)},20100:(e,t,r)=>{"use strict";(function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}})(),e.exports=r(35750)},76014:(e,t)=>{"use strict";var r=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator,p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function A(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||p}function v(){}function y(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||p}A.prototype.isReactComponent={},A.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},A.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=A.prototype;var E=y.prototype=new v;E.constructor=y,m(E,A.prototype),E.isPureReactComponent=!0;var x=Array.isArray,_={H:null,A:null,T:null,S:null},b=Object.prototype.hasOwnProperty;function S(e,t,i,n,a,s){return{$$typeof:r,type:e,key:t,ref:void 0!==(i=s.ref)?i:null,props:s}}function w(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}var C=/\/+/g;function T(e,t){var r,i;return"object"==typeof e&&null!==e&&null!=e.key?(r=""+e.key,i={"=":"=0",":":"=2"},"$"+r.replace(/[=:]/g,function(e){return i[e]})):t.toString(36)}function I(){}function M(e,t,n){if(null==e)return e;var a=[],s=0;return function e(t,n,a,s,o){var l,u,c,h=typeof t;("undefined"===h||"boolean"===h)&&(t=null);var p=!1;if(null===t)p=!0;else switch(h){case"bigint":case"string":case"number":p=!0;break;case"object":switch(t.$$typeof){case r:case i:p=!0;break;case d:return e((p=t._init)(t._payload),n,a,s,o)}}if(p)return o=o(t),p=""===s?"."+T(t,0):s,x(o)?(a="",null!=p&&(a=p.replace(C,"$&/")+"/"),e(o,n,a,"",function(e){return e})):null!=o&&(w(o)&&(l=o,u=a+(null==o.key||t&&t.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+p,o=S(l.type,u,void 0,void 0,void 0,l.props)),n.push(o)),1;p=0;var m=""===s?".":s+":";if(x(t))for(var g=0;g<t.length;g++)h=m+T(s=t[g],g),p+=e(s,n,a,h,o);else if("function"==typeof(g=null===(c=t)||"object"!=typeof c?null:"function"==typeof(c=f&&c[f]||c["@@iterator"])?c:null))for(t=g.call(t),g=0;!(s=t.next()).done;)h=m+T(s=s.value,g++),p+=e(s,n,a,h,o);else if("object"===h){if("function"==typeof t.then)return e(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(I,I):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(t),n,a,s,o);throw Error("Objects are not valid as a React child (found: "+("[object Object]"===(n=String(t))?"object with keys {"+Object.keys(t).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.")}return p}(e,a,"","",function(e){return t.call(n,e,s++)}),a}function R(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){(0===e._status||-1===e._status)&&(e._status=1,e._result=t)},function(t){(0===e._status||-1===e._status)&&(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var B="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit){process.emit("uncaughtException",e);return}console.error(e)};function D(){}t.Children={map:M,forEach:function(e,t,r){M(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return M(e,function(){t++}),t},toArray:function(e){return M(e,function(e){return e})||[]},only:function(e){if(!w(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=A,t.Fragment=n,t.Profiler=s,t.PureComponent=y,t.StrictMode=a,t.Suspense=c,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=_,t.act=function(){throw Error("act(...) is not supported in production builds of React.")},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,r){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var i=m({},e.props),n=e.key,a=void 0;if(null!=t)for(s in void 0!==t.ref&&(a=void 0),void 0!==t.key&&(n=""+t.key),t)b.call(t,s)&&"key"!==s&&"__self"!==s&&"__source"!==s&&("ref"!==s||void 0!==t.ref)&&(i[s]=t[s]);var s=arguments.length-2;if(1===s)i.children=r;else if(1<s){for(var o=Array(s),l=0;l<s;l++)o[l]=arguments[l+2];i.children=o}return S(e.type,n,void 0,void 0,a,i)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:o,_context:e},e},t.createElement=function(e,t,r){var i,n={},a=null;if(null!=t)for(i in void 0!==t.key&&(a=""+t.key),t)b.call(t,i)&&"key"!==i&&"__self"!==i&&"__source"!==i&&(n[i]=t[i]);var s=arguments.length-2;if(1===s)n.children=r;else if(1<s){for(var o=Array(s),l=0;l<s;l++)o[l]=arguments[l+2];n.children=o}if(e&&e.defaultProps)for(i in s=e.defaultProps)void 0===n[i]&&(n[i]=s[i]);return S(e,a,void 0,void 0,null,n)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=w,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=_.T,r={};_.T=r;try{var i=e(),n=_.S;null!==n&&n(r,i),"object"==typeof i&&null!==i&&"function"==typeof i.then&&i.then(D,B)}catch(e){B(e)}finally{_.T=t}},t.unstable_useCacheRefresh=function(){return _.H.useCacheRefresh()},t.use=function(e){return _.H.use(e)},t.useActionState=function(e,t,r){return _.H.useActionState(e,t,r)},t.useCallback=function(e,t){return _.H.useCallback(e,t)},t.useContext=function(e){return _.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return _.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return _.H.useEffect(e,t)},t.useId=function(){return _.H.useId()},t.useImperativeHandle=function(e,t,r){return _.H.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return _.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return _.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return _.H.useMemo(e,t)},t.useOptimistic=function(e,t){return _.H.useOptimistic(e,t)},t.useReducer=function(e,t,r){return _.H.useReducer(e,t,r)},t.useRef=function(e){return _.H.useRef(e)},t.useState=function(e){return _.H.useState(e)},t.useSyncExternalStore=function(e,t,r){return _.H.useSyncExternalStore(e,t,r)},t.useTransition=function(){return _.H.useTransition()},t.version="19.0.0-rc-66855b96-20241106"},14205:(e,t,r)=>{"use strict";e.exports=r(76014)},16998:(e,t)=>{"use strict";function r(e,t){var r=e.length;for(e.push(t);0<r;){var i=r-1>>>1,n=e[i];if(0<a(n,t))e[i]=t,e[r]=n,r=i;else break}}function i(e){return 0===e.length?null:e[0]}function n(e){if(0===e.length)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;for(var i=0,n=e.length,s=n>>>1;i<s;){var o=2*(i+1)-1,l=e[o],u=o+1,c=e[u];if(0>a(l,r))u<n&&0>a(c,l)?(e[i]=c,e[u]=r,i=u):(e[i]=l,e[o]=r,i=o);else if(u<n&&0>a(c,r))e[i]=c,e[u]=r,i=u;else break}}return t}function a(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}if(t.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var s,o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,u=l.now();t.unstable_now=function(){return l.now()-u}}var c=[],h=[],d=1,f=null,p=3,m=!1,g=!1,A=!1,v="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,E="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var t=i(h);null!==t;){if(null===t.callback)n(h);else if(t.startTime<=e)n(h),t.sortIndex=t.expirationTime,r(c,t);else break;t=i(h)}}function _(e){if(A=!1,x(e),!g){if(null!==i(c))g=!0,B();else{var t=i(h);null!==t&&D(_,t.startTime-e)}}}var b=!1,S=-1,w=5,C=-1;function T(){return!(t.unstable_now()-C<w)}function I(){if(b){var e=t.unstable_now();C=e;var r=!0;try{s:{g=!1,A&&(A=!1,y(S),S=-1),m=!0;var a=p;try{o:{for(x(e),f=i(c);null!==f&&!(f.expirationTime>e&&T());){var o=f.callback;if("function"==typeof o){f.callback=null,p=f.priorityLevel;var l=o(f.expirationTime<=e);if(e=t.unstable_now(),"function"==typeof l){f.callback=l,x(e),r=!0;break o}f===i(c)&&n(c),x(e)}else n(c);f=i(c)}if(null!==f)r=!0;else{var u=i(h);null!==u&&D(_,u.startTime-e),r=!1}}break s}finally{f=null,p=a,m=!1}r=void 0}}finally{r?s():b=!1}}}if("function"==typeof E)s=function(){E(I)};else if("undefined"!=typeof MessageChannel){var M=new MessageChannel,R=M.port2;M.port1.onmessage=I,s=function(){R.postMessage(null)}}else s=function(){v(I,0)};function B(){b||(b=!0,s())}function D(e,r){S=v(function(){e(t.unstable_now())},r)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||m||(g=!0,B())},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):w=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var r=p;p=t;try{return e()}finally{p=r}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=p;p=e;try{return t()}finally{p=r}},t.unstable_scheduleCallback=function(e,n,a){var s=t.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?s+a:s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=0x3fffffff;break;case 4:o=1e4;break;default:o=5e3}return o=a+o,e={id:d++,callback:n,priorityLevel:e,startTime:a,expirationTime:o,sortIndex:-1},a>s?(e.sortIndex=a,r(h,e),null===i(c)&&e===i(h)&&(A?(y(S),S=-1):A=!0,D(_,a-s))):(e.sortIndex=o,r(c,e),g||m||(g=!0,B())),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=p;return function(){var r=p;p=t;try{return e.apply(this,arguments)}finally{p=r}}}},51583:(e,t,r)=>{"use strict";e.exports=r(16998)},61518:(e,t,r)=>{"use strict";var i=r(53897);function n(){}function a(){}a.resetWarningCache=n,e.exports=function(){function e(e,t,r,n,a,s){if(s!==i){var o=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:n};return r.PropTypes=r,r}},28200:(e,t,r)=>{e.exports=r(61518)()},53897:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},76423:(e,t)=>{"use strict";t.ContinuousEventPriority=4,t.DefaultEventPriority=16,t.DiscreteEventPriority=1},58015:(e,t,r)=>{e.exports=function(e){"use strict";var t,i,n,a,s,o={},l=r(58009),u=r(11438),c=Object.assign;function h(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var d=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,f=Symbol.for("react.element"),p=Symbol.for("react.portal"),m=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),y=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),S=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var w=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var C=Symbol.iterator;function T(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=C&&e[C]||e["@@iterator"])?e:null}function I(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case m:return"Fragment";case p:return"Portal";case A:return"Profiler";case g:return"StrictMode";case x:return"Suspense";case _:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case y:return(e.displayName||"Context")+".Consumer";case v:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case b:return null!==(t=e.displayName||null)?t:I(e.type)||"Memo";case S:t=e._payload,e=e._init;try{return I(e(t))}catch(e){}}return null}function M(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do 0!=(4098&(t=e).flags)&&(r=t.return),e=t.return;while(e)}return 3===t.tag?r:null}function R(e){if(M(e)!==e)throw Error(h(188))}function B(e){var t=e.alternate;if(!t){if(null===(t=M(e)))throw Error(h(188));return t!==e?null:e}for(var r=e,i=t;;){var n=r.return;if(null===n)break;var a=n.alternate;if(null===a){if(null!==(i=n.return)){r=i;continue}break}if(n.child===a.child){for(a=n.child;a;){if(a===r)return R(n),e;if(a===i)return R(n),t;a=a.sibling}throw Error(h(188))}if(r.return!==i.return)r=n,i=a;else{for(var s=!1,o=n.child;o;){if(o===r){s=!0,r=n,i=a;break}if(o===i){s=!0,i=n,r=a;break}o=o.sibling}if(!s){for(o=a.child;o;){if(o===r){s=!0,r=a,i=n;break}if(o===i){s=!0,i=a,r=n;break}o=o.sibling}if(!s)throw Error(h(189))}}if(r.alternate!==i)throw Error(h(190))}if(3!==r.tag)throw Error(h(188));return r.stateNode.current===r?e:t}function D(e){return null!==(e=B(e))?function e(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var r=e(t);if(null!==r)return r;t=t.sibling}return null}(e):null}var P,L=Array.isArray,k=e.getPublicInstance,F=e.getRootHostContext,O=e.getChildHostContext,U=e.prepareForCommit,N=e.resetAfterCommit,z=e.createInstance,G=e.appendInitialChild,H=e.finalizeInitialChildren,Q=e.prepareUpdate,V=e.shouldSetTextContent,W=e.createTextInstance,j=e.scheduleTimeout,Y=e.cancelTimeout,K=e.noTimeout,q=e.isPrimaryRenderer,X=e.supportsMutation,$=e.supportsPersistence,J=e.supportsHydration,Z=e.getInstanceFromNode,ee=e.preparePortalMount,et=e.getCurrentEventPriority,er=e.detachDeletedInstance,ei=e.supportsMicrotasks,en=e.scheduleMicrotask,ea=e.supportsTestSelectors,es=e.findFiberRoot,eo=e.getBoundingRect,el=e.getTextContent,eu=e.isHiddenSubtree,ec=e.matchAccessibilityRole,eh=e.setFocusIfFocusable,ed=e.setupIntersectionObserver,ef=e.appendChild,ep=e.appendChildToContainer,em=e.commitTextUpdate,eg=e.commitMount,eA=e.commitUpdate,ev=e.insertBefore,ey=e.insertInContainerBefore,eE=e.removeChild,ex=e.removeChildFromContainer,e_=e.resetTextContent,eb=e.hideInstance,eS=e.hideTextInstance,ew=e.unhideInstance,eC=e.unhideTextInstance,eT=e.clearContainer,eI=e.cloneInstance,eM=e.createContainerChildSet,eR=e.appendChildToContainerChildSet,eB=e.finalizeContainerChildren,eD=e.replaceContainerChildren,eP=e.cloneHiddenInstance,eL=e.cloneHiddenTextInstance,ek=e.canHydrateInstance,eF=e.canHydrateTextInstance,eO=e.canHydrateSuspenseInstance,eU=e.isSuspenseInstancePending,eN=e.isSuspenseInstanceFallback,ez=e.registerSuspenseInstanceRetry,eG=e.getNextHydratableSibling,eH=e.getFirstHydratableChild,eQ=e.getFirstHydratableChildWithinContainer,eV=e.getFirstHydratableChildWithinSuspenseInstance,eW=e.hydrateInstance,ej=e.hydrateTextInstance,eY=e.hydrateSuspenseInstance,eK=e.getNextHydratableInstanceAfterSuspenseInstance,eq=e.commitHydratedContainer,eX=e.commitHydratedSuspenseInstance,e$=e.clearSuspenseBoundary,eJ=e.clearSuspenseBoundaryFromContainer,eZ=e.shouldDeleteUnhydratedTailInstances,e0=e.didNotMatchHydratedContainerTextInstance,e1=e.didNotMatchHydratedTextInstance;function e2(e){if(void 0===P)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);P=t&&t[1]||""}return"\n"+P+e}var e3=!1;function e4(e,t){if(!e||e3)return"";e3=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t){if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var i=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){i=e}e.call(t.prototype)}}else{try{throw Error()}catch(e){i=e}e()}}catch(t){if(t&&i&&"string"==typeof t.stack){for(var n=t.stack.split("\n"),a=i.stack.split("\n"),s=n.length-1,o=a.length-1;1<=s&&0<=o&&n[s]!==a[o];)o--;for(;1<=s&&0<=o;s--,o--)if(n[s]!==a[o]){if(1!==s||1!==o)do if(s--,0>--o||n[s]!==a[o]){var l="\n"+n[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=s&&0<=o);break}}}finally{e3=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?e2(e):""}var e5=Object.prototype.hasOwnProperty,e6=[],e8=-1;function e9(e){return{current:e}}function e7(e){0>e8||(e.current=e6[e8],e6[e8]=null,e8--)}function te(e,t){e6[++e8]=e.current,e.current=t}var tt={},tr=e9(tt),ti=e9(!1),tn=tt;function ta(e,t){var r=e.type.contextTypes;if(!r)return tt;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var n,a={};for(n in r)a[n]=t[n];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function ts(e){return null!=(e=e.childContextTypes)}function to(){e7(ti),e7(tr)}function tl(e,t,r){if(tr.current!==tt)throw Error(h(168));te(tr,t),te(ti,r)}function tu(e,t,r){var i=e.stateNode;if(t=t.childContextTypes,"function"!=typeof i.getChildContext)return r;for(var n in i=i.getChildContext())if(!(n in t))throw Error(h(108,function(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return I(t);case 8:return t===g?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}(e)||"Unknown",n));return c({},r,i)}function tc(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||tt,tn=tr.current,te(tr,e),te(ti,ti.current),!0}function th(e,t,r){var i=e.stateNode;if(!i)throw Error(h(169));r?(e=tu(e,t,tn),i.__reactInternalMemoizedMergedChildContext=e,e7(ti),e7(tr),te(tr,e)):e7(ti),te(ti,r)}var td=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(tf(e)/tp|0)|0},tf=Math.log,tp=Math.LN2,tm=64,tg=4194304;function tA(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 0x1000000:case 0x2000000:case 0x4000000:return 0x7c00000&e;case 0x8000000:return 0x8000000;case 0x10000000:return 0x10000000;case 0x20000000:return 0x20000000;case 0x40000000:return 0x40000000;default:return e}}function tv(e,t){var r=e.pendingLanes;if(0===r)return 0;var i=0,n=e.suspendedLanes,a=e.pingedLanes,s=0xfffffff&r;if(0!==s){var o=s&~n;0!==o?i=tA(o):0!=(a&=s)&&(i=tA(a))}else 0!=(s=r&~n)?i=tA(s):0!==a&&(i=tA(a));if(0===i)return 0;if(0!==t&&t!==i&&0==(t&n)&&((n=i&-i)>=(a=t&-t)||16===n&&0!=(4194240&a)))return t;if(0!=(4&i)&&(i|=16&r),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)n=1<<(r=31-td(t)),i|=e[r],t&=~n;return i}function ty(e){return 0!=(e=-0x40000001&e.pendingLanes)?e:0x40000000&e?0x40000000:0}function tE(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function tx(e,t,r){e.pendingLanes|=t,0x20000000!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-td(t)]=r}function t_(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var i=31-td(r),n=1<<i;n&t|e[i]&t&&(e[i]|=t),r&=~n}}var tb=0;function tS(e){return 1<(e&=-e)?4<e?0!=(0xfffffff&e)?16:0x20000000:4:1}var tw=u.unstable_scheduleCallback,tC=u.unstable_cancelCallback,tT=u.unstable_shouldYield,tI=u.unstable_requestPaint,tM=u.unstable_now,tR=u.unstable_ImmediatePriority,tB=u.unstable_UserBlockingPriority,tD=u.unstable_NormalPriority,tP=u.unstable_IdlePriority,tL=null,tk=null,tF="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},tO=null,tU=!1,tN=!1;function tz(e){null===tO?tO=[e]:tO.push(e)}function tG(){if(!tN&&null!==tO){tN=!0;var e=0,t=tb;try{var r=tO;for(tb=1;e<r.length;e++){var i=r[e];do i=i(!0);while(null!==i)}tO=null,tU=!1}catch(t){throw null!==tO&&(tO=tO.slice(e+1)),tw(tR,tG),t}finally{tb=t,tN=!1}}return null}var tH=d.ReactCurrentBatchConfig;function tQ(e,t){if(tF(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!e5.call(t,n)||!tF(e[n],t[n]))return!1}return!0}function tV(e,t){if(e&&e.defaultProps)for(var r in t=c({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}var tW=e9(null),tj=null,tY=null,tK=null;function tq(){tK=tY=tj=null}function tX(e,t,r){q?(te(tW,t._currentValue),t._currentValue=r):(te(tW,t._currentValue2),t._currentValue2=r)}function t$(e){var t=tW.current;e7(tW),q?e._currentValue=t:e._currentValue2=t}function tJ(e,t,r){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===r)break;e=e.return}}function tZ(e,t){tj=e,tK=tY=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(i2=!0),e.firstContext=null)}function t0(e){var t=q?e._currentValue:e._currentValue2;if(tK!==e){if(e={context:e,memoizedValue:t,next:null},null===tY){if(null===tj)throw Error(h(308));tY=e,tj.dependencies={lanes:0,firstContext:e}}else tY=tY.next=e}return t}var t1=null,t2=!1;function t3(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function t4(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function t5(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function t6(e,t){var r=e.updateQueue;null!==r&&(r=r.shared,null!==nX&&0!=(1&e.mode)&&0==(2&nq)?(null===(e=r.interleaved)?(t.next=t,null===t1?t1=[r]:t1.push(r)):(t.next=e.next,e.next=t),r.interleaved=t):(null===(e=r.pending)?t.next=t:(t.next=e.next,e.next=t),r.pending=t))}function t8(e,t,r){if(null!==(t=t.updateQueue)&&(t=t.shared,0!=(4194240&r))){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,t_(e,r)}}function t9(e,t){var r=e.updateQueue,i=e.alternate;if(null!==i&&r===(i=i.updateQueue)){var n=null,a=null;if(null!==(r=r.firstBaseUpdate)){do{var s={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};null===a?n=a=s:a=a.next=s,r=r.next}while(null!==r);null===a?n=a=t:a=a.next=t}else n=a=t;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:a,shared:i.shared,effects:i.effects},e.updateQueue=r;return}null===(e=r.lastBaseUpdate)?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function t7(e,t,r,i){var n=e.updateQueue;t2=!1;var a=n.firstBaseUpdate,s=n.lastBaseUpdate,o=n.shared.pending;if(null!==o){n.shared.pending=null;var l=o,u=l.next;l.next=null,null===s?a=u:s.next=u,s=l;var h=e.alternate;null!==h&&(o=(h=h.updateQueue).lastBaseUpdate)!==s&&(null===o?h.firstBaseUpdate=u:o.next=u,h.lastBaseUpdate=l)}if(null!==a){var d=n.baseState;for(s=0,h=u=l=null,o=a;;){var f=o.lane,p=o.eventTime;if((i&f)===f){null!==h&&(h=h.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});s:{var m=e,g=o;switch(f=t,p=r,g.tag){case 1:if("function"==typeof(m=g.payload)){d=m.call(p,d,f);break s}d=m;break s;case 3:m.flags=-65537&m.flags|128;case 0:if(null==(f="function"==typeof(m=g.payload)?m.call(p,d,f):m))break s;d=c({},d,f);break s;case 2:t2=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(f=n.effects)?n.effects=[o]:f.push(o))}else p={eventTime:p,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===h?(u=h=p,l=d):h=h.next=p,s|=f;if(null===(o=o.next)){if(null===(o=n.shared.pending))break;o=(f=o).next,f.next=null,n.lastBaseUpdate=f,n.shared.pending=null}}if(null===h&&(l=d),n.baseState=l,n.firstBaseUpdate=u,n.lastBaseUpdate=h,null!==(t=n.shared.interleaved)){n=t;do s|=n.lane,n=n.next;while(n!==t)}else null===a&&(n.shared.lanes=0);n3|=s,e.lanes=s,e.memoizedState=d}}function re(e,t,r){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],n=i.callback;if(null!==n){if(i.callback=null,i=r,"function"!=typeof n)throw Error(h(191,n));n.call(i)}}}var rt=(new l.Component).refs;function rr(e,t,r,i){r=null==(r=r(i,t=e.memoizedState))?t:c({},t,r),e.memoizedState=r,0===e.lanes&&(e.updateQueue.baseState=r)}var ri={isMounted:function(e){return!!(e=e._reactInternals)&&M(e)===e},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=ah(),n=ad(e),a=t5(i,n);a.payload=t,null!=r&&(a.callback=r),t6(e,a),null!==(t=af(e,n,i))&&t8(t,e,n)},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=ah(),n=ad(e),a=t5(i,n);a.tag=1,a.payload=t,null!=r&&(a.callback=r),t6(e,a),null!==(t=af(e,n,i))&&t8(t,e,n)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=ah(),i=ad(e),n=t5(r,i);n.tag=2,null!=t&&(n.callback=t),t6(e,n),null!==(t=af(e,i,r))&&t8(t,e,i)}};function rn(e,t,r,i,n,a,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,s):!t.prototype||!t.prototype.isPureReactComponent||!tQ(r,i)||!tQ(n,a)}function ra(e,t,r){var i=!1,n=tt,a=t.contextType;return"object"==typeof a&&null!==a?a=t0(a):(n=ts(t)?tn:tr.current,a=(i=null!=(i=t.contextTypes))?ta(e,n):tt),t=new t(r,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ri,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=a),t}function rs(e,t,r,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&ri.enqueueReplaceState(t,t.state,null)}function ro(e,t,r,i){var n=e.stateNode;n.props=r,n.state=e.memoizedState,n.refs=rt,t3(e);var a=t.contextType;"object"==typeof a&&null!==a?n.context=t0(a):(a=ts(t)?tn:tr.current,n.context=ta(e,a)),n.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(rr(e,t,a,r),n.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof n.getSnapshotBeforeUpdate||"function"!=typeof n.UNSAFE_componentWillMount&&"function"!=typeof n.componentWillMount||(t=n.state,"function"==typeof n.componentWillMount&&n.componentWillMount(),"function"==typeof n.UNSAFE_componentWillMount&&n.UNSAFE_componentWillMount(),t!==n.state&&ri.enqueueReplaceState(n,n.state,null),t7(e,r,n,i),n.state=e.memoizedState),"function"==typeof n.componentDidMount&&(e.flags|=4194308)}var rl=[],ru=0,rc=null,rh=0,rd=[],rf=0,rp=null,rm=1,rg="";function rA(e,t){rl[ru++]=rh,rl[ru++]=rc,rc=e,rh=t}function rv(e,t,r){rd[rf++]=rm,rd[rf++]=rg,rd[rf++]=rp,rp=e;var i=rm;e=rg;var n=32-td(i)-1;i&=~(1<<n),r+=1;var a=32-td(t)+n;if(30<a){var s=n-n%5;a=(i&(1<<s)-1).toString(32),i>>=s,n-=s,rm=1<<32-td(t)+n|r<<n|i,rg=a+e}else rm=1<<a|r<<n|i,rg=e}function ry(e){null!==e.return&&(rA(e,1),rv(e,1,0))}function rE(e){for(;e===rc;)rc=rl[--ru],rl[ru]=null,rh=rl[--ru],rl[ru]=null;for(;e===rp;)rp=rd[--rf],rd[rf]=null,rg=rd[--rf],rd[rf]=null,rm=rd[--rf],rd[rf]=null}var rx=null,r_=null,rb=!1,rS=!1,rw=null;function rC(e,t){var r=aN(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,null===(t=e.deletions)?(e.deletions=[r],e.flags|=16):t.push(r)}function rT(e,t){switch(e.tag){case 5:return null!==(t=ek(t,e.type,e.pendingProps))&&(e.stateNode=t,rx=e,r_=eH(t),!0);case 6:return null!==(t=eF(t,e.pendingProps))&&(e.stateNode=t,rx=e,r_=null,!0);case 13:if(null!==(t=eO(t))){var r=null!==rp?{id:rm,overflow:rg}:null;return e.memoizedState={dehydrated:t,treeContext:r,retryLane:0x40000000},(r=aN(18,null,null,0)).stateNode=t,r.return=e,e.child=r,rx=e,r_=null,!0}return!1;default:return!1}}function rI(e){return 0!=(1&e.mode)&&0==(128&e.flags)}function rM(e){if(rb){var t=r_;if(t){var r=t;if(!rT(e,t)){if(rI(e))throw Error(h(418));t=eG(r);var i=rx;t&&rT(e,t)?rC(i,r):(e.flags=-4097&e.flags|2,rb=!1,rx=e)}}else{if(rI(e))throw Error(h(418));e.flags=-4097&e.flags|2,rb=!1,rx=e}}}function rR(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;rx=e}function rB(e){if(!J||e!==rx)return!1;if(!rb)return rR(e),rb=!0,!1;if(3!==e.tag&&(5!==e.tag||eZ(e.type)&&!V(e.type,e.memoizedProps))){var t=r_;if(t){if(rI(e)){for(e=r_;e;)e=eG(e);throw Error(h(418))}for(;t;)rC(e,t),t=eG(t)}}if(rR(e),13===e.tag){if(!J)throw Error(h(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(h(317));r_=eK(e)}else r_=rx?eG(e.stateNode):null;return!0}function rD(){J&&(r_=rx=null,rS=rb=!1)}function rP(e){null===rw?rw=[e]:rw.push(e)}function rL(e,t,r){if(null!==(e=r.ref)&&"function"!=typeof e&&"object"!=typeof e){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(h(309));var i=r.stateNode}if(!i)throw Error(h(147,e));var n=i,a=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===a?t.ref:((t=function(e){var t=n.refs;t===rt&&(t=n.refs={}),null===e?delete t[a]:t[a]=e})._stringRef=a,t)}if("string"!=typeof e)throw Error(h(284));if(!r._owner)throw Error(h(290,e))}return e}function rk(e,t){throw Error(h(31,"[object Object]"===(e=Object.prototype.toString.call(t))?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function rF(e){return(0,e._init)(e._payload)}function rO(e){function t(t,r){if(e){var i=t.deletions;null===i?(t.deletions=[r],t.flags|=16):i.push(r)}}function r(r,i){if(!e)return null;for(;null!==i;)t(r,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function n(e,t){return(e=aG(e,t)).index=0,e.sibling=null,e}function a(t,r,i){return(t.index=i,e)?null!==(i=t.alternate)?(i=i.index)<r?(t.flags|=2,r):i:(t.flags|=2,r):(t.flags|=1048576,r)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function o(e,t,r,i){return null===t||6!==t.tag?(t=aW(r,e.mode,i)).return=e:(t=n(t,r)).return=e,t}function l(e,t,r,i){var a=r.type;return a===m?c(e,t,r.props.children,i,r.key):(null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===S&&rF(a)===t.type)?(i=n(t,r.props)).ref=rL(e,t,r):(i=aH(r.type,r.key,r.props,null,e.mode,i)).ref=rL(e,t,r),i.return=e,i)}function u(e,t,r,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?(t=aj(r,e.mode,i)).return=e:(t=n(t,r.children||[])).return=e,t}function c(e,t,r,i,a){return null===t||7!==t.tag?(t=aQ(r,e.mode,i,a)).return=e:(t=n(t,r)).return=e,t}function d(e,t,r){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=aW(""+t,e.mode,r)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case f:return(r=aH(t.type,t.key,t.props,null,e.mode,r)).ref=rL(e,null,t),r.return=e,r;case p:return(t=aj(t,e.mode,r)).return=e,t;case S:return d(e,(0,t._init)(t._payload),r)}if(L(t)||T(t))return(t=aQ(t,e.mode,r,null)).return=e,t;rk(e,t)}return null}function g(e,t,r,i){var n=null!==t?t.key:null;if("string"==typeof r&&""!==r||"number"==typeof r)return null!==n?null:o(e,t,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case f:return r.key===n?l(e,t,r,i):null;case p:return r.key===n?u(e,t,r,i):null;case S:return g(e,t,(n=r._init)(r._payload),i)}if(L(r)||T(r))return null!==n?null:c(e,t,r,i,null);rk(e,r)}return null}function A(e,t,r,i,n){if("string"==typeof i&&""!==i||"number"==typeof i)return o(t,e=e.get(r)||null,""+i,n);if("object"==typeof i&&null!==i){switch(i.$$typeof){case f:return l(t,e=e.get(null===i.key?r:i.key)||null,i,n);case p:return u(t,e=e.get(null===i.key?r:i.key)||null,i,n);case S:return A(e,t,r,(0,i._init)(i._payload),n)}if(L(i)||T(i))return c(t,e=e.get(r)||null,i,n,null);rk(t,i)}return null}return function o(l,u,c,v){if("object"==typeof c&&null!==c&&c.type===m&&null===c.key&&(c=c.props.children),"object"==typeof c&&null!==c){switch(c.$$typeof){case f:s:{for(var y=c.key,E=u;null!==E;){if(E.key===y){if((y=c.type)===m){if(7===E.tag){r(l,E.sibling),(u=n(E,c.props.children)).return=l,l=u;break s}}else if(E.elementType===y||"object"==typeof y&&null!==y&&y.$$typeof===S&&rF(y)===E.type){r(l,E.sibling),(u=n(E,c.props)).ref=rL(l,E,c),u.return=l,l=u;break s}r(l,E);break}t(l,E),E=E.sibling}c.type===m?((u=aQ(c.props.children,l.mode,v,c.key)).return=l,l=u):((v=aH(c.type,c.key,c.props,null,l.mode,v)).ref=rL(l,u,c),v.return=l,l=v)}return s(l);case p:s:{for(E=c.key;null!==u;){if(u.key===E){if(4===u.tag&&u.stateNode.containerInfo===c.containerInfo&&u.stateNode.implementation===c.implementation){r(l,u.sibling),(u=n(u,c.children||[])).return=l,l=u;break s}r(l,u);break}t(l,u),u=u.sibling}(u=aj(c,l.mode,v)).return=l,l=u}return s(l);case S:return o(l,u,(E=c._init)(c._payload),v)}if(L(c))return function(n,s,o,l){for(var u=null,c=null,h=s,f=s=0,p=null;null!==h&&f<o.length;f++){h.index>f?(p=h,h=null):p=h.sibling;var m=g(n,h,o[f],l);if(null===m){null===h&&(h=p);break}e&&h&&null===m.alternate&&t(n,h),s=a(m,s,f),null===c?u=m:c.sibling=m,c=m,h=p}if(f===o.length)return r(n,h),rb&&rA(n,f),u;if(null===h){for(;f<o.length;f++)null!==(h=d(n,o[f],l))&&(s=a(h,s,f),null===c?u=h:c.sibling=h,c=h);return rb&&rA(n,f),u}for(h=i(n,h);f<o.length;f++)null!==(p=A(h,n,f,o[f],l))&&(e&&null!==p.alternate&&h.delete(null===p.key?f:p.key),s=a(p,s,f),null===c?u=p:c.sibling=p,c=p);return e&&h.forEach(function(e){return t(n,e)}),rb&&rA(n,f),u}(l,u,c,v);if(T(c))return function(n,s,o,l){var u=T(o);if("function"!=typeof u)throw Error(h(150));if(null==(o=u.call(o)))throw Error(h(151));for(var c=u=null,f=s,p=s=0,m=null,v=o.next();null!==f&&!v.done;p++,v=o.next()){f.index>p?(m=f,f=null):m=f.sibling;var y=g(n,f,v.value,l);if(null===y){null===f&&(f=m);break}e&&f&&null===y.alternate&&t(n,f),s=a(y,s,p),null===c?u=y:c.sibling=y,c=y,f=m}if(v.done)return r(n,f),rb&&rA(n,p),u;if(null===f){for(;!v.done;p++,v=o.next())null!==(v=d(n,v.value,l))&&(s=a(v,s,p),null===c?u=v:c.sibling=v,c=v);return rb&&rA(n,p),u}for(f=i(n,f);!v.done;p++,v=o.next())null!==(v=A(f,n,p,v.value,l))&&(e&&null!==v.alternate&&f.delete(null===v.key?p:v.key),s=a(v,s,p),null===c?u=v:c.sibling=v,c=v);return e&&f.forEach(function(e){return t(n,e)}),rb&&rA(n,p),u}(l,u,c,v);rk(l,c)}return"string"==typeof c&&""!==c||"number"==typeof c?(c=""+c,null!==u&&6===u.tag?(r(l,u.sibling),(u=n(u,c)).return=l):(r(l,u),(u=aW(c,l.mode,v)).return=l),s(l=u)):r(l,u)}}var rU=rO(!0),rN=rO(!1),rz={},rG=e9(rz),rH=e9(rz),rQ=e9(rz);function rV(e){if(e===rz)throw Error(h(174));return e}function rW(e,t){te(rQ,t),te(rH,e),te(rG,rz),e=F(t),e7(rG),te(rG,e)}function rj(){e7(rG),e7(rH),e7(rQ)}function rY(e){var t=rV(rQ.current),r=rV(rG.current);t=O(r,e.type,t),r!==t&&(te(rH,e),te(rG,t))}function rK(e){rH.current===e&&(e7(rG),e7(rH))}var rq=e9(0);function rX(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||eU(r)||eN(r)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var r$=[];function rJ(){for(var e=0;e<r$.length;e++){var t=r$[e];q?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}r$.length=0}var rZ=d.ReactCurrentDispatcher,r0=d.ReactCurrentBatchConfig,r1=0,r2=null,r3=null,r4=null,r5=!1,r6=!1,r8=0,r9=0;function r7(){throw Error(h(321))}function ie(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!tF(e[r],t[r]))return!1;return!0}function it(e,t,r,i,n,a){if(r1=a,r2=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,rZ.current=null===e||null===e.memoizedState?iN:iz,e=r(i,n),r6){a=0;do{if(r6=!1,r8=0,25<=a)throw Error(h(301));a+=1,r4=r3=null,t.updateQueue=null,rZ.current=iG,e=r(i,n)}while(r6)}if(rZ.current=iU,t=null!==r3&&null!==r3.next,r1=0,r4=r3=r2=null,r5=!1,t)throw Error(h(300));return e}function ir(){var e=0!==r8;return r8=0,e}function ii(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===r4?r2.memoizedState=r4=e:r4=r4.next=e,r4}function ia(){if(null===r3){var e=r2.alternate;e=null!==e?e.memoizedState:null}else e=r3.next;var t=null===r4?r2.memoizedState:r4.next;if(null!==t)r4=t,r3=e;else{if(null===e)throw Error(h(310));e={memoizedState:(r3=e).memoizedState,baseState:r3.baseState,baseQueue:r3.baseQueue,queue:r3.queue,next:null},null===r4?r2.memoizedState=r4=e:r4=r4.next=e}return r4}function is(e,t){return"function"==typeof t?t(e):t}function io(e){var t=ia(),r=t.queue;if(null===r)throw Error(h(311));r.lastRenderedReducer=e;var i=r3,n=i.baseQueue,a=r.pending;if(null!==a){if(null!==n){var s=n.next;n.next=a.next,a.next=s}i.baseQueue=n=a,r.pending=null}if(null!==n){a=n.next,i=i.baseState;var o=s=null,l=null,u=a;do{var c=u.lane;if((r1&c)===c)null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===l?(o=l=d,s=i):l=l.next=d,r2.lanes|=c,n3|=c}u=u.next}while(null!==u&&u!==a);null===l?s=i:l.next=o,tF(i,t.memoizedState)||(i2=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=l,r.lastRenderedState=i}if(null!==(e=r.interleaved)){n=e;do a=n.lane,r2.lanes|=a,n3|=a,n=n.next;while(n!==e)}else null===n&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function il(e){var t=ia(),r=t.queue;if(null===r)throw Error(h(311));r.lastRenderedReducer=e;var i=r.dispatch,n=r.pending,a=t.memoizedState;if(null!==n){r.pending=null;var s=n=n.next;do a=e(a,s.action),s=s.next;while(s!==n);tF(a,t.memoizedState)||(i2=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),r.lastRenderedState=a}return[a,i]}function iu(){}function ic(e,t){var r=r2,i=ia(),n=t(),a=!tF(i.memoizedState,n);if(a&&(i.memoizedState=n,i2=!0),i=i.queue,i_(ip.bind(null,r,i,e),[e]),i.getSnapshot!==t||a||null!==r4&&1&r4.memoizedState.tag){if(r.flags|=2048,iA(9,id.bind(null,r,i,n,t),void 0,null),null===nX)throw Error(h(349));0!=(30&r1)||ih(r,t,n)}return n}function ih(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},null===(t=r2.updateQueue)?(t={lastEffect:null,stores:null},r2.updateQueue=t,t.stores=[e]):null===(r=t.stores)?t.stores=[e]:r.push(e)}function id(e,t,r,i){t.value=r,t.getSnapshot=i,im(t)&&af(e,1,-1)}function ip(e,t,r){return r(function(){im(t)&&af(e,1,-1)})}function im(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!tF(e,r)}catch(e){return!0}}function ig(e){var t=ii();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:is,lastRenderedState:e},t.queue=e,e=e.dispatch=iP.bind(null,r2,e),[t.memoizedState,e]}function iA(e,t,r,i){return e={tag:e,create:t,destroy:r,deps:i,next:null},null===(t=r2.updateQueue)?(t={lastEffect:null,stores:null},r2.updateQueue=t,t.lastEffect=e.next=e):null===(r=t.lastEffect)?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e),e}function iv(){return ia().memoizedState}function iy(e,t,r,i){var n=ii();r2.flags|=e,n.memoizedState=iA(1|t,r,void 0,void 0===i?null:i)}function iE(e,t,r,i){var n=ia();i=void 0===i?null:i;var a=void 0;if(null!==r3){var s=r3.memoizedState;if(a=s.destroy,null!==i&&ie(i,s.deps)){n.memoizedState=iA(t,r,a,i);return}}r2.flags|=e,n.memoizedState=iA(1|t,r,a,i)}function ix(e,t){return iy(8390656,8,e,t)}function i_(e,t){return iE(2048,8,e,t)}function ib(e,t){return iE(4,2,e,t)}function iS(e,t){return iE(4,4,e,t)}function iw(e,t){return"function"==typeof t?(t(e=e()),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function iC(e,t,r){return r=null!=r?r.concat([e]):null,iE(4,4,iw.bind(null,t,e),r)}function iT(){}function iI(e,t){var r=ia();t=void 0===t?null:t;var i=r.memoizedState;return null!==i&&null!==t&&ie(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function iM(e,t){var r=ia();t=void 0===t?null:t;var i=r.memoizedState;return null!==i&&null!==t&&ie(t,i[1])?i[0]:(e=e(),r.memoizedState=[e,t],e)}function iR(e,t){var r=tb;tb=0!==r&&4>r?r:4,e(!0);var i=r0.transition;r0.transition={};try{e(!1),t()}finally{tb=r,r0.transition=i}}function iB(){return ia().memoizedState}function iD(e,t,r){var i=ad(e);r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},iL(e)?ik(t,r):(iF(e,t,r),null!==(e=af(e,i,r=ah()))&&iO(e,t,i))}function iP(e,t,r){var i=ad(e),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(iL(e))ik(t,n);else{iF(e,t,n);var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=a(s,r);if(n.hasEagerState=!0,n.eagerState=o,tF(o,s))return}catch(e){}finally{}null!==(e=af(e,i,r=ah()))&&iO(e,t,i)}}function iL(e){var t=e.alternate;return e===r2||null!==t&&t===r2}function ik(e,t){r6=r5=!0;var r=e.pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function iF(e,t,r){null!==nX&&0!=(1&e.mode)&&0==(2&nq)?(null===(e=t.interleaved)?(r.next=r,null===t1?t1=[t]:t1.push(t)):(r.next=e.next,e.next=r),t.interleaved=r):(null===(e=t.pending)?r.next=r:(r.next=e.next,e.next=r),t.pending=r)}function iO(e,t,r){if(0!=(4194240&r)){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,t_(e,r)}}var iU={readContext:t0,useCallback:r7,useContext:r7,useEffect:r7,useImperativeHandle:r7,useInsertionEffect:r7,useLayoutEffect:r7,useMemo:r7,useReducer:r7,useRef:r7,useState:r7,useDebugValue:r7,useDeferredValue:r7,useTransition:r7,useMutableSource:r7,useSyncExternalStore:r7,useId:r7,unstable_isNewReconciler:!1},iN={readContext:t0,useCallback:function(e,t){return ii().memoizedState=[e,void 0===t?null:t],e},useContext:t0,useEffect:ix,useImperativeHandle:function(e,t,r){return r=null!=r?r.concat([e]):null,iy(4194308,4,iw.bind(null,t,e),r)},useLayoutEffect:function(e,t){return iy(4194308,4,e,t)},useInsertionEffect:function(e,t){return iy(4,2,e,t)},useMemo:function(e,t){var r=ii();return t=void 0===t?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var i=ii();return t=void 0!==r?r(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=iD.bind(null,r2,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},ii().memoizedState=e},useState:ig,useDebugValue:iT,useDeferredValue:function(e){var t=ig(e),r=t[0],i=t[1];return ix(function(){var t=r0.transition;r0.transition={};try{i(e)}finally{r0.transition=t}},[e]),r},useTransition:function(){var e=ig(!1),t=e[0];return e=iR.bind(null,e[1]),ii().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var i=r2,n=ii();if(rb){if(void 0===r)throw Error(h(407));r=r()}else{if(r=t(),null===nX)throw Error(h(349));0!=(30&r1)||ih(i,t,r)}n.memoizedState=r;var a={value:r,getSnapshot:t};return n.queue=a,ix(ip.bind(null,i,a,e),[e]),i.flags|=2048,iA(9,id.bind(null,i,a,r,t),void 0,null),r},useId:function(){var e=ii(),t=nX.identifierPrefix;if(rb){var r=rg,i=rm;t=":"+t+"R"+(r=(i&~(1<<32-td(i)-1)).toString(32)+r),0<(r=r8++)&&(t+="H"+r.toString(32)),t+=":"}else t=":"+t+"r"+(r=r9++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},iz={readContext:t0,useCallback:iI,useContext:t0,useEffect:i_,useImperativeHandle:iC,useInsertionEffect:ib,useLayoutEffect:iS,useMemo:iM,useReducer:io,useRef:iv,useState:function(){return io(is)},useDebugValue:iT,useDeferredValue:function(e){var t=io(is),r=t[0],i=t[1];return i_(function(){var t=r0.transition;r0.transition={};try{i(e)}finally{r0.transition=t}},[e]),r},useTransition:function(){return[io(is)[0],ia().memoizedState]},useMutableSource:iu,useSyncExternalStore:ic,useId:iB,unstable_isNewReconciler:!1},iG={readContext:t0,useCallback:iI,useContext:t0,useEffect:i_,useImperativeHandle:iC,useInsertionEffect:ib,useLayoutEffect:iS,useMemo:iM,useReducer:il,useRef:iv,useState:function(){return il(is)},useDebugValue:iT,useDeferredValue:function(e){var t=il(is),r=t[0],i=t[1];return i_(function(){var t=r0.transition;r0.transition={};try{i(e)}finally{r0.transition=t}},[e]),r},useTransition:function(){return[il(is)[0],ia().memoizedState]},useMutableSource:iu,useSyncExternalStore:ic,useId:iB,unstable_isNewReconciler:!1};function iH(e,t){try{var r="",i=t;do r+=function(e){switch(e.tag){case 5:return e2(e.type);case 16:return e2("Lazy");case 13:return e2("Suspense");case 19:return e2("SuspenseList");case 0:case 2:case 15:return e=e4(e.type,!1);case 11:return e=e4(e.type.render,!1);case 1:return e=e4(e.type,!0);default:return""}}(i),i=i.return;while(i);var n=r}catch(e){n="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:n}}function iQ(e,t){try{console.error(t.value)}catch(e){setTimeout(function(){throw e})}}var iV="function"==typeof WeakMap?WeakMap:Map;function iW(e,t,r){(r=t5(-1,r)).tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){at||(at=!0,ar=i),iQ(e,t)},r}function ij(e,t,r){(r=t5(-1,r)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var n=t.value;r.payload=function(){return i(n)},r.callback=function(){iQ(e,t)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(r.callback=function(){iQ(e,t),"function"!=typeof i&&(null===ai?ai=new Set([this]):ai.add(this));var r=t.stack;this.componentDidCatch(t.value,{componentStack:null!==r?r:""})}),r}function iY(e,t,r){var i=e.pingCache;if(null===i){i=e.pingCache=new iV;var n=new Set;i.set(t,n)}else void 0===(n=i.get(t))&&(n=new Set,i.set(t,n));n.has(r)||(n.add(r),e=aL.bind(null,e,t,r),t.then(e,e))}function iK(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function iq(e,t,r,i,n){return 0==(1&e.mode)?e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,1===r.tag&&(null===r.alternate?r.tag=17:((t=t5(-1,1)).tag=2,t6(r,t))),r.lanes|=1):(e.flags|=65536,e.lanes=n),e}function iX(e){e.flags|=4}function i$(e,t){if(null!==e&&e.child===t.child)return!0;if(0!=(16&t.flags))return!1;for(e=t.child;null!==e;){if(0!=(12854&e.flags)||0!=(12854&e.subtreeFlags))return!1;e=e.sibling}return!0}if(X)t=function(e,t){for(var r=t.child;null!==r;){if(5===r.tag||6===r.tag)G(e,r.stateNode);else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}},i=function(){},n=function(e,t,r,i,n){(e=e.memoizedProps)!==i&&(r=Q(t.stateNode,r,e,i,n,rV(rG.current)),(t.updateQueue=r)&&iX(t))},a=function(e,t,r,i){r!==i&&iX(t)};else if($){t=function(e,r,i,n){for(var a=r.child;null!==a;){if(5===a.tag){var s=a.stateNode;i&&n&&(s=eP(s,a.type,a.memoizedProps,a)),G(e,s)}else if(6===a.tag)s=a.stateNode,i&&n&&(s=eL(s,a.memoizedProps,a)),G(e,s);else if(4!==a.tag){if(22===a.tag&&null!==a.memoizedState)null!==(s=a.child)&&(s.return=a),t(e,a,!0,!0);else if(null!==a.child){a.child.return=a,a=a.child;continue}}if(a===r)break;for(;null===a.sibling;){if(null===a.return||a.return===r)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};var iJ=function(e,t,r,i){for(var n=t.child;null!==n;){if(5===n.tag){var a=n.stateNode;r&&i&&(a=eP(a,n.type,n.memoizedProps,n)),eR(e,a)}else if(6===n.tag)a=n.stateNode,r&&i&&(a=eL(a,n.memoizedProps,n)),eR(e,a);else if(4!==n.tag){if(22===n.tag&&null!==n.memoizedState)null!==(a=n.child)&&(a.return=n),iJ(e,n,!0,!0);else if(null!==n.child){n.child.return=n,n=n.child;continue}}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};i=function(e,t){var r=t.stateNode;if(!i$(e,t)){var i=eM(e=r.containerInfo);iJ(i,t,!1,!1),r.pendingChildren=i,iX(t),eB(e,i)}},n=function(e,r,i,n,a){var s=e.stateNode,o=e.memoizedProps;if((e=i$(e,r))&&o===n)r.stateNode=s;else{var l=r.stateNode,u=rV(rG.current),c=null;o!==n&&(c=Q(l,i,o,n,a,u)),e&&null===c?r.stateNode=s:(H(s=eI(s,c,i,o,n,r,e,l),i,n,a,u)&&iX(r),r.stateNode=s,e?iX(r):t(s,r,!1,!1))}},a=function(e,t,r,i){r!==i?(e=rV(rQ.current),r=rV(rG.current),t.stateNode=W(i,e,r,t),iX(t)):t.stateNode=e.stateNode}}else i=function(){},n=function(){},a=function(){};function iZ(e,t){if(!rb)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;null!==r;)null!==r.alternate&&(i=r),r=r.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function i0(e){var t=null!==e.alternate&&e.alternate.child===e.child,r=0,i=0;if(t)for(var n=e.child;null!==n;)r|=n.lanes|n.childLanes,i|=0xe00000&n.subtreeFlags,i|=0xe00000&n.flags,n.return=e,n=n.sibling;else for(n=e.child;null!==n;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=i,e.childLanes=r,t}var i1=d.ReactCurrentOwner,i2=!1;function i3(e,t,r,i){t.child=null===e?rN(t,null,r,i):rU(t,e.child,r,i)}function i4(e,t,r,i,n){r=r.render;var a=t.ref;return(tZ(t,n),i=it(e,t,r,i,a,n),r=ir(),null===e||i2)?(rb&&r&&ry(t),t.flags|=1,i3(e,t,i,n),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,nd(e,t,n))}function i5(e,t,r,i,n){if(null===e){var a=r.type;return"function"!=typeof a||az(a)||void 0!==a.defaultProps||null!==r.compare||void 0!==r.defaultProps?((e=aH(r.type,null,i,t,t.mode,n)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,i6(e,t,a,i,n))}if(a=e.child,0==(e.lanes&n)){var s=a.memoizedProps;if((r=null!==(r=r.compare)?r:tQ)(s,i)&&e.ref===t.ref)return nd(e,t,n)}return t.flags|=1,(e=aG(a,i)).ref=t.ref,e.return=t,t.child=e}function i6(e,t,r,i,n){if(null!==e&&tQ(e.memoizedProps,i)&&e.ref===t.ref){if(i2=!1,0==(e.lanes&n))return t.lanes=e.lanes,nd(e,t,n);0!=(131072&e.flags)&&(i2=!0)}return i7(e,t,r,i,n)}function i8(e,t,r){var i=t.pendingProps,n=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode){if(0==(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null},te(n0,nZ),nZ|=r;else{if(0==(0x40000000&r))return e=null!==a?a.baseLanes|r:r,t.lanes=t.childLanes=0x40000000,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,te(n0,nZ),nZ|=e,null;t.memoizedState={baseLanes:0,cachePool:null},i=null!==a?a.baseLanes:r,te(n0,nZ),nZ|=i}}else null!==a?(i=a.baseLanes|r,t.memoizedState=null):i=r,te(n0,nZ),nZ|=i;return i3(e,t,n,r),t.child}function i9(e,t){var r=t.ref;(null===e&&null!==r||null!==e&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function i7(e,t,r,i,n){var a=ts(r)?tn:tr.current;return(a=ta(t,a),tZ(t,n),r=it(e,t,r,i,a,n),i=ir(),null===e||i2)?(rb&&i&&ry(t),t.flags|=1,i3(e,t,r,n),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,nd(e,t,n))}function ne(e,t,r,i,n){if(ts(r)){var a=!0;tc(t)}else a=!1;if(tZ(t,n),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),ra(t,r,i),ro(t,r,i,n),i=!0;else if(null===e){var s=t.stateNode,o=t.memoizedProps;s.props=o;var l=s.context,u=r.contextType;u="object"==typeof u&&null!==u?t0(u):ta(t,u=ts(r)?tn:tr.current);var c=r.getDerivedStateFromProps,h="function"==typeof c||"function"==typeof s.getSnapshotBeforeUpdate;h||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(o!==i||l!==u)&&rs(t,s,i,u),t2=!1;var d=t.memoizedState;s.state=d,t7(t,i,s,n),l=t.memoizedState,o!==i||d!==l||ti.current||t2?("function"==typeof c&&(rr(t,r,c,i),l=t.memoizedState),(o=t2||rn(t,r,o,i,d,l,u))?(h||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4194308)):("function"==typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),s.props=i,s.state=l,s.context=u,i=o):("function"==typeof s.componentDidMount&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,t4(e,t),o=t.memoizedProps,u=t.type===t.elementType?o:tV(t.type,o),s.props=u,h=t.pendingProps,d=s.context,l="object"==typeof(l=r.contextType)&&null!==l?t0(l):ta(t,l=ts(r)?tn:tr.current);var f=r.getDerivedStateFromProps;(c="function"==typeof f||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(o!==h||d!==l)&&rs(t,s,i,l),t2=!1,d=t.memoizedState,s.state=d,t7(t,i,s,n);var p=t.memoizedState;o!==h||d!==p||ti.current||t2?("function"==typeof f&&(rr(t,r,f,i),p=t.memoizedState),(u=t2||rn(t,r,u,i,d,p,l)||!1)?(c||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(i,p,l),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,p,l)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),s.props=i,s.state=p,s.context=l,i=u):("function"!=typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return nt(e,t,r,i,a,n)}function nt(e,t,r,i,n,a){i9(e,t);var s=0!=(128&t.flags);if(!i&&!s)return n&&th(t,r,!1),nd(e,t,a);i=t.stateNode,i1.current=t;var o=s&&"function"!=typeof r.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&s?(t.child=rU(t,e.child,null,a),t.child=rU(t,null,o,a)):i3(e,t,o,a),t.memoizedState=i.state,n&&th(t,r,!0),t.child}function nr(e){var t=e.stateNode;t.pendingContext?tl(e,t.pendingContext,t.pendingContext!==t.context):t.context&&tl(e,t.context,!1),rW(e,t.containerInfo)}function ni(e,t,r,i,n){return rD(),rP(n),t.flags|=256,i3(e,t,r,i),t.child}var nn={dehydrated:null,treeContext:null,retryLane:0};function na(e){return{baseLanes:e,cachePool:null}}function ns(e,t,r){var i,n,a,s,o,l,u,c,d,f,p,m,g,A,v=t.pendingProps,y=rq.current,E=!1,x=0!=(128&t.flags);if((A=x)||(A=(null===e||null!==e.memoizedState)&&0!=(2&y)),A?(E=!0,t.flags&=-129):(null===e||null!==e.memoizedState)&&(y|=1),te(rq,1&y),null===e)return(rM(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated))?(0==(1&t.mode)?t.lanes=1:eN(e)?t.lanes=8:t.lanes=0x40000000,null):(y=v.children,e=v.fallback,E?(v=t.mode,E=t.child,y={mode:"hidden",children:y},0==(1&v)&&null!==E?(E.childLanes=0,E.pendingProps=y):E=aV(y,v,0,null),e=aQ(e,v,r,null),E.return=t,e.return=t,E.sibling=e,t.child=E,t.child.memoizedState=na(r),t.memoizedState=nn,e):no(t,y));if(null!==(y=e.memoizedState)&&null!==(A=y.dehydrated)){if(x)return 256&t.flags?(t.flags&=-257,nl(e,t,r,Error(h(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(E=v.fallback,y=t.mode,v=aV({mode:"visible",children:v.children},y,0,null),E=aQ(E,y,r,null),E.flags|=2,v.return=t,E.return=t,v.sibling=E,t.child=v,0!=(1&t.mode)&&rU(t,e.child,null,r),t.child.memoizedState=na(r),t.memoizedState=nn,E);if(0==(1&t.mode))t=nl(e,t,r,null);else if(eN(A))t=nl(e,t,r,Error(h(419)));else if(v=0!=(r&e.childLanes),i2||v){if(null!==(v=nX)){switch(r&-r){case 4:E=2;break;case 16:E=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 0x1000000:case 0x2000000:case 0x4000000:E=32;break;case 0x20000000:E=0x10000000;break;default:E=0}0!==(v=0!=(E&(v.suspendedLanes|r))?0:E)&&v!==y.retryLane&&(y.retryLane=v,af(e,v,-1))}aC(),t=nl(e,t,r,Error(h(421)))}else eU(A)?(t.flags|=128,t.child=e.child,ez(A,t=aF.bind(null,e)),t=null):(r=y.treeContext,J&&(r_=eV(A),rx=t,rb=!0,rw=null,rS=!1,null!==r&&(rd[rf++]=rm,rd[rf++]=rg,rd[rf++]=rp,rm=r.id,rg=r.overflow,rp=t)),t=no(t,t.pendingProps.children),t.flags|=4096);return t}return E?(i=e,n=t,a=v.children,s=v.fallback,o=r,l=n.mode,u=(i=i.child).sibling,c={mode:"hidden",children:a},0==(1&l)&&n.child!==i?((a=n.child).childLanes=0,a.pendingProps=c,n.deletions=null):(a=aG(i,c)).subtreeFlags=0xe00000&i.subtreeFlags,null!==u?s=aG(u,s):(s=aQ(s,l,o,null),s.flags|=2),s.return=n,a.return=n,a.sibling=s,n.child=a,v=s,E=t.child,y=e.child.memoizedState,E.memoizedState=null===y?na(r):{baseLanes:y.baseLanes|r,cachePool:null},E.childLanes=e.childLanes&~r,t.memoizedState=nn,v):(d=e,f=t,p=v.children,m=r,d=(g=d.child).sibling,p=aG(g,{mode:"visible",children:p}),0==(1&f.mode)&&(p.lanes=m),p.return=f,p.sibling=null,null!==d&&(null===(m=f.deletions)?(f.deletions=[d],f.flags|=16):m.push(d)),r=f.child=p,t.memoizedState=null,r)}function no(e,t){return(t=aV({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function nl(e,t,r,i){return null!==i&&rP(i),rU(t,e.child,null,r),e=no(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function nu(e,t,r){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),tJ(e.return,t,r)}function nc(e,t,r,i,n){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=r,a.tailMode=n)}function nh(e,t,r){var i=t.pendingProps,n=i.revealOrder,a=i.tail;if(i3(e,t,i.children,r),0!=(2&(i=rq.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!=(128&e.flags))s:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&nu(e,r,t);else if(19===e.tag)nu(e,r,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)break s;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(te(rq,i),0==(1&t.mode))t.memoizedState=null;else switch(n){case"forwards":for(n=null,r=t.child;null!==r;)null!==(e=r.alternate)&&null===rX(e)&&(n=r),r=r.sibling;null===(r=n)?(n=t.child,t.child=null):(n=r.sibling,r.sibling=null),nc(t,!1,n,r,a);break;case"backwards":for(r=null,n=t.child,t.child=null;null!==n;){if(null!==(e=n.alternate)&&null===rX(e)){t.child=n;break}e=n.sibling,n.sibling=r,r=n,n=e}nc(t,!0,r,null,a);break;case"together":nc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function nd(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),n3|=t.lanes,0==(r&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(h(153));if(null!==t.child){for(r=aG(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=aG(e,e.pendingProps)).return=t;r.sibling=null}return t.child}var nf=!1,np=!1,nm="function"==typeof WeakSet?WeakSet:Set,ng=null;function nA(e,t){var r=e.ref;if(null!==r){if("function"==typeof r)try{r(null)}catch(r){aP(e,t,r)}else r.current=null}}function nv(e,t,r){try{r()}catch(r){aP(e,t,r)}}var ny=!1;function nE(e,t,r){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var n=i=i.next;do{if((n.tag&e)===e){var a=n.destroy;n.destroy=void 0,void 0!==a&&nv(t,r,a)}n=n.next}while(n!==i)}}function nx(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var r=t=t.next;do{if((r.tag&e)===e){var i=r.create;r.destroy=i()}r=r.next}while(r!==t)}}function n_(e){var t=e.ref;if(null!==t){var r=e.stateNode;e=5===e.tag?k(r):r,"function"==typeof t?t(e):t.current=e}}function nb(e,t,r){if(tk&&"function"==typeof tk.onCommitFiberUnmount)try{tk.onCommitFiberUnmount(tL,t)}catch(e){}switch(t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var i=e=e.next;do{var n=i,a=n.destroy;n=n.tag,void 0!==a&&(0!=(2&n)?nv(t,r,a):0!=(4&n)&&nv(t,r,a)),i=i.next}while(i!==e)}break;case 1:if(nA(t,r),"function"==typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(e){aP(t,r,e)}break;case 5:nA(t,r);break;case 4:X?nI(e,t,r):$&&$&&(r=eM(t=t.stateNode.containerInfo),eD(t,r))}}function nS(e,t,r){for(var i=t;;)if(nb(e,i,r),null===i.child||X&&4===i.tag){if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}else i.child.return=i,i=i.child}function nw(e){return 5===e.tag||3===e.tag||4===e.tag}function nC(e){s:for(;;){for(;null===e.sibling;){if(null===e.return||nw(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags||null===e.child||4===e.tag)continue s;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function nT(e){if(X){s:{for(var t=e.return;null!==t;){if(nw(t))break s;t=t.return}throw Error(h(160))}var r=t;switch(r.tag){case 5:t=r.stateNode,32&r.flags&&(e_(t),r.flags&=-33),r=nC(e),function e(t,r,i){var n=t.tag;if(5===n||6===n)t=t.stateNode,r?ev(i,t,r):ef(i,t);else if(4!==n&&null!==(t=t.child))for(e(t,r,i),t=t.sibling;null!==t;)e(t,r,i),t=t.sibling}(e,r,t);break;case 3:case 4:t=r.stateNode.containerInfo,r=nC(e),function e(t,r,i){var n=t.tag;if(5===n||6===n)t=t.stateNode,r?ey(i,t,r):ep(i,t);else if(4!==n&&null!==(t=t.child))for(e(t,r,i),t=t.sibling;null!==t;)e(t,r,i),t=t.sibling}(e,r,t);break;default:throw Error(h(161))}}}function nI(e,t,r){for(var i,n,a=t,s=!1;;){if(!s){s=a.return;s:for(;;){if(null===s)throw Error(h(160));switch(i=s.stateNode,s.tag){case 5:n=!1;break s;case 3:case 4:i=i.containerInfo,n=!0;break s}s=s.return}s=!0}if(5===a.tag||6===a.tag)nS(e,a,r),n?ex(i,a.stateNode):eE(i,a.stateNode);else if(18===a.tag)n?eJ(i,a.stateNode):e$(i,a.stateNode);else if(4===a.tag){if(null!==a.child){i=a.stateNode.containerInfo,n=!0,a.child.return=a,a=a.child;continue}}else if(nb(e,a,r),null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;4===(a=a.return).tag&&(s=!1)}a.sibling.return=a.return,a=a.sibling}}function nM(e,t){if(X){switch(t.tag){case 0:case 11:case 14:case 15:nE(3,t,t.return),nx(3,t),nE(5,t,t.return);return;case 1:case 12:case 17:return;case 5:var r=t.stateNode;if(null!=r){var i=t.memoizedProps;e=null!==e?e.memoizedProps:i;var n=t.type,a=t.updateQueue;t.updateQueue=null,null!==a&&eA(r,a,n,e,i,t)}return;case 6:if(null===t.stateNode)throw Error(h(162));r=t.memoizedProps,em(t.stateNode,null!==e?e.memoizedProps:r,r);return;case 3:J&&null!==e&&e.memoizedState.isDehydrated&&eq(t.stateNode.containerInfo);return;case 13:case 19:nR(t);return}throw Error(h(163))}switch(t.tag){case 0:case 11:case 14:case 15:nE(3,t,t.return),nx(3,t),nE(5,t,t.return);return;case 12:case 22:case 23:return;case 13:case 19:nR(t);return;case 3:J&&null!==e&&e.memoizedState.isDehydrated&&eq(t.stateNode.containerInfo)}s:if($){switch(t.tag){case 1:case 5:case 6:break s;case 3:case 4:eD((t=t.stateNode).containerInfo,t.pendingChildren);break s}throw Error(h(163))}}function nR(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var r=e.stateNode;null===r&&(r=e.stateNode=new nm),t.forEach(function(t){var i=aO.bind(null,e,t);r.has(t)||(r.add(t),t.then(i,i))})}}function nB(e){for(;null!==ng;){var t=ng;if(0!=(8772&t.flags)){var r=t.alternate;try{if(0!=(8772&t.flags))switch(t.tag){case 0:case 11:case 15:np||nx(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!np){if(null===r)i.componentDidMount();else{var n=t.elementType===t.type?r.memoizedProps:tV(t.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}}var a=t.updateQueue;null!==a&&re(t,a,i);break;case 3:var s=t.updateQueue;if(null!==s){if(r=null,null!==t.child)switch(t.child.tag){case 5:r=k(t.child.stateNode);break;case 1:r=t.child.stateNode}re(t,s,r)}break;case 5:var o=t.stateNode;null===r&&4&t.flags&&eg(o,t.type,t.memoizedProps,t);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(J&&null===t.memoizedState){var l=t.alternate;if(null!==l){var u=l.memoizedState;if(null!==u){var c=u.dehydrated;null!==c&&eX(c)}}}break;default:throw Error(h(163))}np||512&t.flags&&n_(t)}catch(e){aP(t,t.return,e)}}if(t===e){ng=null;break}if(null!==(r=t.sibling)){r.return=t.return,ng=r;break}ng=t.return}}function nD(e){for(;null!==ng;){var t=ng;if(t===e){ng=null;break}var r=t.sibling;if(null!==r){r.return=t.return,ng=r;break}ng=t.return}}function nP(e){for(;null!==ng;){var t=ng;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{nx(4,t)}catch(e){aP(t,r,e)}break;case 1:var i=t.stateNode;if("function"==typeof i.componentDidMount){var n=t.return;try{i.componentDidMount()}catch(e){aP(t,n,e)}}var a=t.return;try{n_(t)}catch(e){aP(t,a,e)}break;case 5:var s=t.return;try{n_(t)}catch(e){aP(t,s,e)}}}catch(e){aP(t,t.return,e)}if(t===e){ng=null;break}var o=t.sibling;if(null!==o){o.return=t.return,ng=o;break}ng=t.return}}var nL=0,nk=1,nF=2,nO=3,nU=4;if("function"==typeof Symbol&&Symbol.for){var nN=Symbol.for;nL=nN("selector.component"),nk=nN("selector.has_pseudo_class"),nF=nN("selector.role"),nO=nN("selector.test_id"),nU=nN("selector.text")}function nz(e){var t=Z(e);if(null!=t){if("string"!=typeof t.memoizedProps["data-testname"])throw Error(h(364));return t}if(null===(e=es(e)))throw Error(h(362));return e.stateNode.current}function nG(e,t){switch(t.$$typeof){case nL:if(e.type===t.value)return!0;break;case nk:s:{t=t.value,e=[e,0];for(var r=0;r<e.length;){var i=e[r++],n=e[r++],a=t[n];if(5!==i.tag||!eu(i)){for(;null!=a&&nG(i,a);)a=t[++n];if(n===t.length){t=!0;break s}for(i=i.child;null!==i;)e.push(i,n),i=i.sibling}}t=!1}return t;case nF:if(5===e.tag&&ec(e.stateNode,t.value))return!0;break;case nU:if((5===e.tag||6===e.tag)&&null!==(e=el(e))&&0<=e.indexOf(t.value))return!0;break;case nO:if(5===e.tag&&"string"==typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase())return!0;break;default:throw Error(h(365))}return!1}function nH(e){switch(e.$$typeof){case nL:return"<"+(I(e.value)||"Unknown")+">";case nk:return":has("+(nH(e)||"")+")";case nF:return'[role="'+e.value+'"]';case nU:return'"'+e.value+'"';case nO:return'[data-testname="'+e.value+'"]';default:throw Error(h(365))}}function nQ(e,t){var r=[];e=[e,0];for(var i=0;i<e.length;){var n=e[i++],a=e[i++],s=t[a];if(5!==n.tag||!eu(n)){for(;null!=s&&nG(n,s);)s=t[++a];if(a===t.length)r.push(n);else for(n=n.child;null!==n;)e.push(n,a),n=n.sibling}}return r}function nV(e,t){if(!ea)throw Error(h(363));e=nQ(e=nz(e),t),t=[],e=Array.from(e);for(var r=0;r<e.length;){var i=e[r++];if(5===i.tag)eu(i)||t.push(i.stateNode);else for(i=i.child;null!==i;)e.push(i),i=i.sibling}return t}var nW=Math.ceil,nj=d.ReactCurrentDispatcher,nY=d.ReactCurrentOwner,nK=d.ReactCurrentBatchConfig,nq=0,nX=null,n$=null,nJ=0,nZ=0,n0=e9(0),n1=0,n2=null,n3=0,n4=0,n5=0,n6=null,n8=null,n9=0,n7=1/0;function ae(){n7=tM()+500}var at=!1,ar=null,ai=null,an=!1,aa=null,as=0,ao=0,al=null,au=-1,ac=0;function ah(){return 0!=(6&nq)?tM():-1!==au?au:au=tM()}function ad(e){return 0==(1&e.mode)?1:0!=(2&nq)&&0!==nJ?nJ&-nJ:null!==tH.transition?(0===ac&&(e=tm,0==(4194240&(tm<<=1))&&(tm=64),ac=e),ac):0!==(e=tb)?e:et()}function af(e,t,r){if(50<ao)throw ao=0,al=null,Error(h(185));var i=ap(e,t);return null===i?null:(tx(i,t,r),(0==(2&nq)||i!==nX)&&(i===nX&&(0==(2&nq)&&(n4|=t),4===n1&&ay(i,nJ)),am(i,r),1===t&&0===nq&&0==(1&e.mode)&&(ae(),tU&&tG())),i)}function ap(e,t){e.lanes|=t;var r=e.alternate;for(null!==r&&(r.lanes|=t),r=e,e=e.return;null!==e;)e.childLanes|=t,null!==(r=e.alternate)&&(r.childLanes|=t),r=e,e=e.return;return 3===r.tag?r.stateNode:null}function am(e,t){var r,i=e.callbackNode;!function(e,t){for(var r=e.suspendedLanes,i=e.pingedLanes,n=e.expirationTimes,a=e.pendingLanes;0<a;){var s=31-td(a),o=1<<s,l=n[s];-1===l?(0==(o&r)||0!=(o&i))&&(n[s]=function(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return -1}}(o,t)):l<=t&&(e.expiredLanes|=o),a&=~o}}(e,t);var n=tv(e,e===nX?nJ:0);if(0===n)null!==i&&tC(i),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=i&&tC(i),1===t)0===e.tag?(r=aE.bind(null,e),tU=!0,tz(r)):tz(aE.bind(null,e)),ei?en(function(){0===nq&&tG()}):tw(tR,tG),i=null;else{switch(tS(n)){case 1:i=tR;break;case 4:i=tB;break;case 16:default:i=tD;break;case 0x20000000:i=tP}i=tw(i,ag.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function ag(e,t){if(au=-1,ac=0,0!=(6&nq))throw Error(h(327));var r=e.callbackNode;if(aB()&&e.callbackNode!==r)return null;var i=tv(e,e===nX?nJ:0);if(0===i)return null;if(0!=(30&i)||0!=(i&e.expiredLanes)||t)t=aT(e,i);else{t=i;var n=nq;nq|=2;var a=aw();for((nX!==e||nJ!==t)&&(ae(),ab(e,t));;)try{(function(){for(;null!==n$&&!tT();)aI(n$)})();break}catch(t){aS(e,t)}tq(),nj.current=a,nq=n,null!==n$?t=0:(nX=null,nJ=0,t=n1)}if(0!==t){if(2===t&&0!==(n=ty(e))&&(i=n,t=aA(e,n)),1===t)throw r=n2,ab(e,0),ay(e,i),am(e,tM()),r;if(6===t)ay(e,i);else{if(n=e.current.alternate,0==(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var r=t.updateQueue;if(null!==r&&null!==(r=r.stores))for(var i=0;i<r.length;i++){var n=r[i],a=n.getSnapshot;n=n.value;try{if(!tF(a(),n))return!1}catch(e){return!1}}}if(r=t.child,16384&t.subtreeFlags&&null!==r)r.return=t,t=r;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(n)&&(2===(t=aT(e,i))&&0!==(a=ty(e))&&(i=a,t=aA(e,a)),1===t))throw r=n2,ab(e,0),ay(e,i),am(e,tM()),r;switch(e.finishedWork=n,e.finishedLanes=i,t){case 0:case 1:throw Error(h(345));case 2:case 5:aR(e,n8);break;case 3:if(ay(e,i),(0x7c00000&i)===i&&10<(t=n9+500-tM())){if(0!==tv(e,0))break;if(((n=e.suspendedLanes)&i)!==i){ah(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=j(aR.bind(null,e,n8),t);break}aR(e,n8);break;case 4:if(ay(e,i),(4194240&i)===i)break;for(n=-1,t=e.eventTimes;0<i;){var s=31-td(i);a=1<<s,(s=t[s])>n&&(n=s),i&=~a}if(i=n,10<(i=(120>(i=tM()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*nW(i/1960))-i)){e.timeoutHandle=j(aR.bind(null,e,n8),i);break}aR(e,n8);break;default:throw Error(h(329))}}}return am(e,tM()),e.callbackNode===r?ag.bind(null,e):null}function aA(e,t){var r=n6;return e.current.memoizedState.isDehydrated&&(ab(e,t).flags|=256),2!==(e=aT(e,t))&&(t=n8,n8=r,null!==t&&av(t)),e}function av(e){null===n8?n8=e:n8.push.apply(n8,e)}function ay(e,t){for(t&=~n5,t&=~n4,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-td(t),i=1<<r;e[r]=-1,t&=~i}}function aE(e){if(0!=(6&nq))throw Error(h(327));aB();var t=tv(e,0);if(0==(1&t))return am(e,tM()),null;var r=aT(e,t);if(0!==e.tag&&2===r){var i=ty(e);0!==i&&(t=i,r=aA(e,i))}if(1===r)throw r=n2,ab(e,0),ay(e,t),am(e,tM()),r;if(6===r)throw Error(h(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,aR(e,n8),am(e,tM()),null}function ax(e){null!==aa&&0===aa.tag&&0==(6&nq)&&aB();var t=nq;nq|=1;var r=nK.transition,i=tb;try{if(nK.transition=null,tb=1,e)return e()}finally{tb=i,nK.transition=r,0==(6&(nq=t))&&tG()}}function a_(){nZ=n0.current,e7(n0)}function ab(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==K&&(e.timeoutHandle=K,Y(r)),null!==n$)for(r=n$.return;null!==r;){var i=r;switch(rE(i),i.tag){case 1:null!=(i=i.type.childContextTypes)&&to();break;case 3:rj(),e7(ti),e7(tr),rJ();break;case 5:rK(i);break;case 4:rj();break;case 13:case 19:e7(rq);break;case 10:t$(i.type._context);break;case 22:case 23:a_()}r=r.return}if(nX=e,n$=e=aG(e.current,null),nJ=nZ=t,n1=0,n2=null,n5=n4=n3=0,n8=n6=null,null!==t1){for(t=0;t<t1.length;t++)if(null!==(i=(r=t1[t]).interleaved)){r.interleaved=null;var n=i.next,a=r.pending;if(null!==a){var s=a.next;a.next=n,i.next=s}r.pending=i}t1=null}return e}function aS(e,t){for(;;){var r=n$;try{if(tq(),rZ.current=iU,r5){for(var i=r2.memoizedState;null!==i;){var n=i.queue;null!==n&&(n.pending=null),i=i.next}r5=!1}if(r1=0,r4=r3=r2=null,r6=!1,r8=0,nY.current=null,null===r||null===r.return){n1=1,n2=t,n$=null;break}s:{var a=e,s=r.return,o=r,l=t;if(t=nJ,o.flags|=32768,null!==l&&"object"==typeof l&&"function"==typeof l.then){var u=l,c=o,d=c.tag;if(0==(1&c.mode)&&(0===d||11===d||15===d)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var p=iK(s);if(null!==p){p.flags&=-257,iq(p,s,o,a,t),1&p.mode&&iY(a,u,t),t=p,l=u;var m=t.updateQueue;if(null===m){var g=new Set;g.add(l),t.updateQueue=g}else m.add(l);break s}if(0==(1&t)){iY(a,u,t),aC();break s}l=Error(h(426))}else if(rb&&1&o.mode){var A=iK(s);if(null!==A){0==(65536&A.flags)&&(A.flags|=256),iq(A,s,o,a,t),rP(l);break s}}a=l,4!==n1&&(n1=2),null===n6?n6=[a]:n6.push(a),l=iH(l,o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var v=iW(o,l,t);t9(o,v);break s;case 1:a=l;var y=o.type,E=o.stateNode;if(0==(128&o.flags)&&("function"==typeof y.getDerivedStateFromError||null!==E&&"function"==typeof E.componentDidCatch&&(null===ai||!ai.has(E)))){o.flags|=65536,t&=-t,o.lanes|=t;var x=ij(o,a,t);t9(o,x);break s}}o=o.return}while(null!==o)}aM(r)}catch(e){t=e,n$===r&&null!==r&&(n$=r=r.return);continue}break}}function aw(){var e=nj.current;return nj.current=iU,null===e?iU:e}function aC(){(0===n1||3===n1||2===n1)&&(n1=4),null===nX||0==(0xfffffff&n3)&&0==(0xfffffff&n4)||ay(nX,nJ)}function aT(e,t){var r=nq;nq|=2;var i=aw();for(nX===e&&nJ===t||ab(e,t);;)try{(function(){for(;null!==n$;)aI(n$)})();break}catch(t){aS(e,t)}if(tq(),nq=r,nj.current=i,null!==n$)throw Error(h(261));return nX=null,nJ=0,n1}function aI(e){var t=s(e.alternate,e,nZ);e.memoizedProps=e.pendingProps,null===t?aM(e):n$=t,nY.current=null}function aM(e){var r=e;do{var s=r.alternate;if(e=r.return,0==(32768&r.flags)){if(null!==(s=function(e,r,s){var o=r.pendingProps;switch(rE(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return i0(r),null;case 1:case 17:return ts(r.type)&&to(),i0(r),null;case 3:return o=r.stateNode,rj(),e7(ti),e7(tr),rJ(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(null===e||null===e.child)&&(rB(r)?iX(r):null===e||e.memoizedState.isDehydrated&&0==(256&r.flags)||(r.flags|=1024,null!==rw&&(av(rw),rw=null))),i(e,r),i0(r),null;case 5:rK(r),s=rV(rQ.current);var l=r.type;if(null!==e&&null!=r.stateNode)n(e,r,l,o,s),e.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!o){if(null===r.stateNode)throw Error(h(166));return i0(r),null}if(e=rV(rG.current),rB(r)){if(!J)throw Error(h(175));e=eW(r.stateNode,r.type,r.memoizedProps,s,e,r,!rS),r.updateQueue=e,null!==e&&iX(r)}else{var u=z(l,o,s,e,r);t(u,r,!1,!1),r.stateNode=u,H(u,l,o,s,e)&&iX(r)}null!==r.ref&&(r.flags|=512,r.flags|=2097152)}return i0(r),null;case 6:if(e&&null!=r.stateNode)a(e,r,e.memoizedProps,o);else{if("string"!=typeof o&&null===r.stateNode)throw Error(h(166));if(e=rV(rQ.current),s=rV(rG.current),rB(r)){if(!J)throw Error(h(176));if((s=ej(e=r.stateNode,o=r.memoizedProps,r,!rS))&&null!==(l=rx))switch(u=0!=(1&l.mode),l.tag){case 3:e0(l.stateNode.containerInfo,e,o,u);break;case 5:e1(l.type,l.memoizedProps,l.stateNode,e,o,u)}s&&iX(r)}else r.stateNode=W(o,e,s,r)}return i0(r),null;case 13:if(e7(rq),o=r.memoizedState,rb&&null!==r_&&0!=(1&r.mode)&&0==(128&r.flags)){for(e=r_;e;)e=eG(e);return rD(),r.flags|=98560,r}if(null!==o&&null!==o.dehydrated){if(o=rB(r),null===e){if(!o)throw Error(h(318));if(!J)throw Error(h(344));if(!(e=null!==(e=r.memoizedState)?e.dehydrated:null))throw Error(h(317));eY(e,r)}else rD(),0==(128&r.flags)&&(r.memoizedState=null),r.flags|=4;return i0(r),null}if(null!==rw&&(av(rw),rw=null),0!=(128&r.flags))return r.lanes=s,r;return o=null!==o,s=!1,null===e?rB(r):s=null!==e.memoizedState,o&&!s&&(r.child.flags|=8192,0!=(1&r.mode)&&(null===e||0!=(1&rq.current)?0===n1&&(n1=3):aC())),null!==r.updateQueue&&(r.flags|=4),i0(r),null;case 4:return rj(),i(e,r),null===e&&ee(r.stateNode.containerInfo),i0(r),null;case 10:return t$(r.type._context),i0(r),null;case 19:if(e7(rq),null===(l=r.memoizedState))return i0(r),null;if(o=0!=(128&r.flags),null===(u=l.rendering)){if(o)iZ(l,!1);else{if(0!==n1||null!==e&&0!=(128&e.flags))for(e=r.child;null!==e;){if(null!==(u=rX(e))){for(r.flags|=128,iZ(l,!1),null!==(e=u.updateQueue)&&(r.updateQueue=e,r.flags|=4),r.subtreeFlags=0,e=s,o=r.child;null!==o;)s=o,l=e,s.flags&=0xe00002,null===(u=s.alternate)?(s.childLanes=0,s.lanes=l,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,l=u.dependencies,s.dependencies=null===l?null:{lanes:l.lanes,firstContext:l.firstContext}),o=o.sibling;return te(rq,1&rq.current|2),r.child}e=e.sibling}null!==l.tail&&tM()>n7&&(r.flags|=128,o=!0,iZ(l,!1),r.lanes=4194304)}}else{if(!o){if(null!==(e=rX(u))){if(r.flags|=128,o=!0,null!==(e=e.updateQueue)&&(r.updateQueue=e,r.flags|=4),iZ(l,!0),null===l.tail&&"hidden"===l.tailMode&&!u.alternate&&!rb)return i0(r),null}else 2*tM()-l.renderingStartTime>n7&&0x40000000!==s&&(r.flags|=128,o=!0,iZ(l,!1),r.lanes=4194304)}l.isBackwards?(u.sibling=r.child,r.child=u):(null!==(e=l.last)?e.sibling=u:r.child=u,l.last=u)}if(null!==l.tail)return r=l.tail,l.rendering=r,l.tail=r.sibling,l.renderingStartTime=tM(),r.sibling=null,e=rq.current,te(rq,o?1&e|2:1&e),r;return i0(r),null;case 22:case 23:return a_(),o=null!==r.memoizedState,null!==e&&null!==e.memoizedState!==o&&(r.flags|=8192),o&&0!=(1&r.mode)?0!=(0x40000000&nZ)&&(i0(r),X&&6&r.subtreeFlags&&(r.flags|=8192)):i0(r),null;case 24:case 25:return null}throw Error(h(156,r.tag))}(s,r,nZ))){n$=s;return}}else{if(null!==(s=function(e,t){switch(rE(t),t.tag){case 1:return ts(t.type)&&to(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return rj(),e7(ti),e7(tr),rJ(),0!=(65536&(e=t.flags))&&0==(128&e)?(t.flags=-65537&e|128,t):null;case 5:return rK(t),null;case 13:if(e7(rq),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(h(340));rD()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return e7(rq),null;case 4:return rj(),null;case 10:return t$(t.type._context),null;case 22:case 23:return a_(),null;default:return null}}(s,r))){s.flags&=32767,n$=s;return}if(null!==e)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{n1=6,n$=null;return}}if(null!==(r=r.sibling)){n$=r;return}n$=r=e}while(null!==r);0===n1&&(n1=5)}function aR(e,t){var r=tb,i=nK.transition;try{nK.transition=null,tb=1,function(e,t,r){do aB();while(null!==aa);if(0!=(6&nq))throw Error(h(327));var i=e.finishedWork,n=e.finishedLanes;if(null!==i){if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(h(177));e.callbackNode=null,e.callbackPriority=0;var a=i.lanes|i.childLanes;if(function(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<r;){var n=31-td(r),a=1<<n;t[n]=0,i[n]=-1,e[n]=-1,r&=~a}}(e,a),e===nX&&(n$=nX=null,nJ=0),0==(2064&i.subtreeFlags)&&0==(2064&i.flags)||an||(an=!0,s=tD,o=function(){return aB(),null},tw(s,o)),a=0!=(15990&i.flags),0!=(15990&i.subtreeFlags)||a){a=nK.transition,nK.transition=null;var s,o,l,u,c=tb;tb=1;var d=nq;nq|=4,nY.current=null,function(e,t){for(U(e.containerInfo),ng=t;null!==ng;)if(t=(e=ng).child,0!=(1028&e.subtreeFlags)&&null!==t)t.return=e,ng=t;else for(;null!==ng;){e=ng;try{var r=e.alternate;if(0!=(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==r){var i=r.memoizedProps,n=r.memoizedState,a=e.stateNode,s=a.getSnapshotBeforeUpdate(e.elementType===e.type?i:tV(e.type,i),n);a.__reactInternalSnapshotBeforeUpdate=s}break;case 3:X&&eT(e.stateNode.containerInfo);break;default:throw Error(h(163))}}catch(t){aP(e,e.return,t)}if(null!==(t=e.sibling)){t.return=e.return,ng=t;break}ng=e.return}r=ny,ny=!1}(e,i),function(e,t){for(ng=t;null!==ng;){var r=(t=ng).deletions;if(null!==r)for(var i=0;i<r.length;i++){var n=r[i];try{var a=e;X?nI(a,n,t):nS(a,n,t);var s=n.alternate;null!==s&&(s.return=null),n.return=null}catch(e){aP(n,t,e)}}if(r=t.child,0!=(12854&t.subtreeFlags)&&null!==r)r.return=t,ng=r;else for(;null!==ng;){t=ng;try{var o=t.flags;if(32&o&&X&&e_(t.stateNode),512&o){var l=t.alternate;if(null!==l){var u=l.ref;null!==u&&("function"==typeof u?u(null):u.current=null)}}if(8192&o)switch(t.tag){case 13:if(null!==t.memoizedState){var c=t.alternate;(null===c||null===c.memoizedState)&&(n9=tM())}break;case 22:var h=null!==t.memoizedState,d=t.alternate,f=null!==d&&null!==d.memoizedState;if(r=t,X){s:if(i=r,n=h,a=null,X)for(var p=i;;){if(5===p.tag){if(null===a){a=p;var m=p.stateNode;n?eb(m):ew(p.stateNode,p.memoizedProps)}}else if(6===p.tag){if(null===a){var g=p.stateNode;n?eS(g):eC(g,p.memoizedProps)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===i)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===i)break;for(;null===p.sibling;){if(null===p.return||p.return===i)break s;a===p&&(a=null),p=p.return}a===p&&(a=null),p.sibling.return=p.return,p=p.sibling}}if(h&&!f&&0!=(1&r.mode)){ng=r;for(var A=r.child;null!==A;){for(r=ng=A;null!==ng;){var v=(i=ng).child;switch(i.tag){case 0:case 11:case 14:case 15:nE(4,i,i.return);break;case 1:nA(i,i.return);var y=i.stateNode;if("function"==typeof y.componentWillUnmount){var E=i.return;try{y.props=i.memoizedProps,y.state=i.memoizedState,y.componentWillUnmount()}catch(e){aP(i,E,e)}}break;case 5:nA(i,i.return);break;case 22:if(null!==i.memoizedState){nD(r);continue}}null!==v?(v.return=i,ng=v):nD(r)}A=A.sibling}}}switch(4102&o){case 2:nT(t),t.flags&=-3;break;case 6:nT(t),t.flags&=-3,nM(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,nM(t.alternate,t);break;case 4:nM(t.alternate,t)}}catch(e){aP(t,t.return,e)}if(null!==(r=t.sibling)){r.return=t.return,ng=r;break}ng=t.return}}}(e,i,n),N(e.containerInfo),e.current=i,l=i,u=e,ng=l,function e(t,r,i){for(var n=0!=(1&t.mode);null!==ng;){var a=ng,s=a.child;if(22===a.tag&&n){var o=null!==a.memoizedState||nf;if(!o){var l=a.alternate,u=null!==l&&null!==l.memoizedState||np;l=nf;var c=np;if(nf=o,(np=u)&&!c)for(ng=a;null!==ng;)u=(o=ng).child,22===o.tag&&null!==o.memoizedState?nP(a):null!==u?(u.return=o,ng=u):nP(a);for(;null!==s;)ng=s,e(s,r,i),s=s.sibling;ng=a,nf=l,np=c}nB(t,r,i)}else 0!=(8772&a.subtreeFlags)&&null!==s?(s.return=a,ng=s):nB(t,r,i)}}(l,u,n),tI(),nq=d,tb=c,nK.transition=a}else e.current=i;if(an&&(an=!1,aa=e,as=n),0===(a=e.pendingLanes)&&(ai=null),function(e){if(tk&&"function"==typeof tk.onCommitFiberRoot)try{tk.onCommitFiberRoot(tL,e,void 0,128==(128&e.current.flags))}catch(e){}}(i.stateNode,r),am(e,tM()),null!==t)for(r=e.onRecoverableError,i=0;i<t.length;i++)r(t[i]);if(at)throw at=!1,e=ar,ar=null,e;0!=(1&as)&&0!==e.tag&&aB(),0!=(1&(a=e.pendingLanes))?e===al?ao++:(ao=0,al=e):ao=0,tG()}}(e,t,r)}finally{nK.transition=i,tb=r}return null}function aB(){if(null!==aa){var e=tS(as),t=nK.transition,r=tb;try{if(nK.transition=null,tb=16>e?16:e,null===aa)var i=!1;else{if(e=aa,aa=null,as=0,0!=(6&nq))throw Error(h(331));var n=nq;for(nq|=4,ng=e.current;null!==ng;){var a=ng,s=a.child;if(0!=(16&ng.flags)){var o=a.deletions;if(null!==o){for(var l=0;l<o.length;l++){var u=o[l];for(ng=u;null!==ng;){var c=ng;switch(c.tag){case 0:case 11:case 15:nE(8,c,a)}var d=c.child;if(null!==d)d.return=c,ng=d;else for(;null!==ng;){var f=(c=ng).sibling,p=c.return;if(function e(t){var r=t.alternate;null!==r&&(t.alternate=null,e(r)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&null!==(r=t.stateNode)&&er(r),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}(c),c===u){ng=null;break}if(null!==f){f.return=p,ng=f;break}ng=p}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var A=g.sibling;g.sibling=null,g=A}while(null!==g)}}ng=a}}if(0!=(2064&a.subtreeFlags)&&null!==s)s.return=a,ng=s;else for(;null!==ng;){if(a=ng,0!=(2048&a.flags))switch(a.tag){case 0:case 11:case 15:nE(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,ng=v;break}ng=a.return}}var y=e.current;for(ng=y;null!==ng;){var E=(s=ng).child;if(0!=(2064&s.subtreeFlags)&&null!==E)E.return=s,ng=E;else for(s=y;null!==ng;){if(o=ng,0!=(2048&o.flags))try{switch(o.tag){case 0:case 11:case 15:nx(9,o)}}catch(e){aP(o,o.return,e)}if(o===s){ng=null;break}var x=o.sibling;if(null!==x){x.return=o.return,ng=x;break}ng=o.return}}if(nq=n,tG(),tk&&"function"==typeof tk.onPostCommitFiberRoot)try{tk.onPostCommitFiberRoot(tL,e)}catch(e){}i=!0}return i}finally{tb=r,nK.transition=t}}return!1}function aD(e,t,r){t=iW(e,t=iH(r,t),1),t6(e,t),t=ah(),null!==(e=ap(e,1))&&(tx(e,1,t),am(e,t))}function aP(e,t,r){if(3===e.tag)aD(e,e,r);else for(;null!==t;){if(3===t.tag){aD(t,e,r);break}if(1===t.tag){var i=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===ai||!ai.has(i))){e=ij(t,e=iH(r,e),1),t6(t,e),e=ah(),null!==(t=ap(t,1))&&(tx(t,1,e),am(t,e));break}}t=t.return}}function aL(e,t,r){var i=e.pingCache;null!==i&&i.delete(t),t=ah(),e.pingedLanes|=e.suspendedLanes&r,nX===e&&(nJ&r)===r&&(4===n1||3===n1&&(0x7c00000&nJ)===nJ&&500>tM()-n9?ab(e,0):n5|=r),am(e,t)}function ak(e,t){0===t&&(0==(1&e.mode)?t=1:(t=tg,0==(0x7c00000&(tg<<=1))&&(tg=4194304)));var r=ah();null!==(e=ap(e,t))&&(tx(e,t,r),am(e,r))}function aF(e){var t=e.memoizedState,r=0;null!==t&&(r=t.retryLane),ak(e,r)}function aO(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,n=e.memoizedState;null!==n&&(r=n.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(h(314))}null!==i&&i.delete(t),ak(e,r)}function aU(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function aN(e,t,r,i){return new aU(e,t,r,i)}function az(e){return!(!(e=e.prototype)||!e.isReactComponent)}function aG(e,t){var r=e.alternate;return null===r?((r=aN(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=0xe00000&e.flags,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function aH(e,t,r,i,n,a){var s=2;if(i=e,"function"==typeof e)az(e)&&(s=1);else if("string"==typeof e)s=5;else s:switch(e){case m:return aQ(r.children,n,a,t);case g:s=8,n|=8;break;case A:return(e=aN(12,r,t,2|n)).elementType=A,e.lanes=a,e;case x:return(e=aN(13,r,t,n)).elementType=x,e.lanes=a,e;case _:return(e=aN(19,r,t,n)).elementType=_,e.lanes=a,e;case w:return aV(r,n,a,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case v:s=10;break s;case y:s=9;break s;case E:s=11;break s;case b:s=14;break s;case S:s=16,i=null;break s}throw Error(h(130,null==e?e:typeof e,""))}return(t=aN(s,r,t,n)).elementType=e,t.type=i,t.lanes=a,t}function aQ(e,t,r,i){return(e=aN(7,e,i,t)).lanes=r,e}function aV(e,t,r,i){return(e=aN(22,e,i,t)).elementType=w,e.lanes=r,e.stateNode={},e}function aW(e,t,r){return(e=aN(6,e,null,t)).lanes=r,e}function aj(e,t,r){return(t=aN(4,null!==e.children?e.children:[],e.key,t)).lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function aY(e,t,r,i,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=K,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tE(0),this.expirationTimes=tE(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tE(0),this.identifierPrefix=i,this.onRecoverableError=n,J&&(this.mutableSourceEagerHydrationData=null)}function aK(e,t,r,i,n,a,s,o,l){return e=new aY(e,t,r,o,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=aN(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null},t3(a),e}function aq(e){if(!e)return tt;e=e._reactInternals;s:{if(M(e)!==e||1!==e.tag)throw Error(h(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break s;case 1:if(ts(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break s}}t=t.return}while(null!==t);throw Error(h(171))}if(1===e.tag){var r=e.type;if(ts(r))return tu(e,r,t)}return t}function aX(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(h(188));throw Error(h(268,e=Object.keys(e).join(",")))}return null===(e=D(t))?null:e.stateNode}function a$(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var r=e.retryLane;e.retryLane=0!==r&&r<t?r:t}}function aJ(e,t){a$(e,t),(e=e.alternate)&&a$(e,t)}function aZ(e){return null===(e=D(e))?null:e.stateNode}function a0(){return null}return s=function(e,t,r){if(null!==e){if(e.memoizedProps!==t.pendingProps||ti.current)i2=!0;else{if(0==(e.lanes&r)&&0==(128&t.flags))return i2=!1,function(e,t,r){switch(t.tag){case 3:nr(t),rD();break;case 5:rY(t);break;case 1:ts(t.type)&&tc(t);break;case 4:rW(t,t.stateNode.containerInfo);break;case 10:tX(t,t.type._context,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i){if(null!==i.dehydrated)return te(rq,1&rq.current),t.flags|=128,null;if(0!=(r&t.child.childLanes))return ns(e,t,r);return te(rq,1&rq.current),null!==(e=nd(e,t,r))?e.sibling:null}te(rq,1&rq.current);break;case 19:if(i=0!=(r&t.childLanes),0!=(128&e.flags)){if(i)return nh(e,t,r);t.flags|=128}var n=t.memoizedState;if(null!==n&&(n.rendering=null,n.tail=null,n.lastEffect=null),te(rq,rq.current),!i)return null;break;case 22:case 23:return t.lanes=0,i8(e,t,r)}return nd(e,t,r)}(e,t,r);i2=0!=(131072&e.flags)}}else i2=!1,rb&&0!=(1048576&t.flags)&&rv(t,rh,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var n=ta(t,tr.current);tZ(t,r),n=it(null,t,i,e,n,r);var a=ir();return t.flags|=1,"object"==typeof n&&null!==n&&"function"==typeof n.render&&void 0===n.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ts(i)?(a=!0,tc(t)):a=!1,t.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,t3(t),n.updater=ri,t.stateNode=n,n._reactInternals=t,ro(t,i,e,r),t=nt(null,t,i,!0,a,r)):(t.tag=0,rb&&a&&ry(t),i3(null,t,n,r),t=t.child),t;case 16:i=t.elementType;s:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(n=i._init)(i._payload),t.type=i,n=t.tag=function(e){if("function"==typeof e)return az(e)?1:0;if(null!=e){if((e=e.$$typeof)===E)return 11;if(e===b)return 14}return 2}(i),e=tV(i,e),n){case 0:t=i7(null,t,i,e,r);break s;case 1:t=ne(null,t,i,e,r);break s;case 11:t=i4(null,t,i,e,r);break s;case 14:t=i5(null,t,i,tV(i.type,e),r);break s}throw Error(h(306,i,""))}return t;case 0:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:tV(i,n),i7(e,t,i,n,r);case 1:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:tV(i,n),ne(e,t,i,n,r);case 3:s:{if(nr(t),null===e)throw Error(h(387));i=t.pendingProps,n=(a=t.memoizedState).element,t4(e,t),t7(t,i,null,r);var s=t.memoizedState;if(i=s.element,J&&a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:s.cache,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=ni(e,t,i,r,n=Error(h(423)));break s}if(i!==n){t=ni(e,t,i,r,n=Error(h(424)));break s}for(J&&(r_=eQ(t.stateNode.containerInfo),rx=t,rb=!0,rw=null,rS=!1),r=rN(t,null,i,r),t.child=r;r;)r.flags=-3&r.flags|4096,r=r.sibling}else{if(rD(),i===n){t=nd(e,t,r);break s}i3(e,t,i,r)}t=t.child}return t;case 5:return rY(t),null===e&&rM(t),i=t.type,n=t.pendingProps,a=null!==e?e.memoizedProps:null,s=n.children,V(i,n)?s=null:null!==a&&V(i,a)&&(t.flags|=32),i9(e,t),i3(e,t,s,r),t.child;case 6:return null===e&&rM(t),null;case 13:return ns(e,t,r);case 4:return rW(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=rU(t,null,i,r):i3(e,t,i,r),t.child;case 11:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:tV(i,n),i4(e,t,i,n,r);case 7:return i3(e,t,t.pendingProps,r),t.child;case 8:case 12:return i3(e,t,t.pendingProps.children,r),t.child;case 10:s:{if(i=t.type._context,n=t.pendingProps,a=t.memoizedProps,tX(t,i,s=n.value),null!==a){if(tF(a.value,s)){if(a.children===n.children&&!ti.current){t=nd(e,t,r);break s}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var o=a.dependencies;if(null!==o){s=a.child;for(var l=o.firstContext;null!==l;){if(l.context===i){if(1===a.tag){(l=t5(-1,r&-r)).tag=2;var u=a.updateQueue;if(null!==u){var c=(u=u.shared).pending;null===c?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}a.lanes|=r,null!==(l=a.alternate)&&(l.lanes|=r),tJ(a.return,r,t),o.lanes|=r;break}l=l.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(h(341));s.lanes|=r,null!==(o=s.alternate)&&(o.lanes|=r),tJ(s,r,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}}i3(e,t,n.children,r),t=t.child}return t;case 9:return n=t.type,i=t.pendingProps.children,tZ(t,r),i=i(n=t0(n)),t.flags|=1,i3(e,t,i,r),t.child;case 14:return n=tV(i=t.type,t.pendingProps),n=tV(i.type,n),i5(e,t,i,n,r);case 15:return i6(e,t,t.type,t.pendingProps,r);case 17:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:tV(i,n),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,ts(i)?(e=!0,tc(t)):e=!1,tZ(t,r),ra(t,i,n),ro(t,i,n,r),nt(null,t,i,!0,e,r);case 19:return nh(e,t,r);case 22:return i8(e,t,r)}throw Error(h(156,t.tag))},o.attemptContinuousHydration=function(e){13===e.tag&&(af(e,0x8000000,ah()),aJ(e,0x8000000))},o.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=ah(),r=ad(e);af(e,r,t),aJ(e,r)}},o.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=tA(t.pendingLanes);0!==r&&(t_(t,1|r),am(t,tM()),0==(6&nq)&&(ae(),tG()))}break;case 13:var i=ah();ax(function(){return af(e,1,i)}),aJ(e,1)}},o.batchedUpdates=function(e,t){var r=nq;nq|=1;try{return e(t)}finally{0===(nq=r)&&(ae(),tU&&tG())}},o.createComponentSelector=function(e){return{$$typeof:nL,value:e}},o.createContainer=function(e,t,r,i,n,a,s){return aK(e,t,!1,null,r,i,n,a,s)},o.createHasPseudoClassSelector=function(e){return{$$typeof:nk,value:e}},o.createHydrationContainer=function(e,t,r,i,n,a,s,o,l){return(e=aK(r,i,!0,e,n,a,s,o,l)).context=aq(null),r=e.current,(a=t5(i=ah(),n=ad(r))).callback=null!=t?t:null,t6(r,a),e.current.lanes=n,tx(e,n,i),am(e,i),e},o.createPortal=function(e,t,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:p,key:null==i?null:""+i,children:e,containerInfo:t,implementation:r}},o.createRoleSelector=function(e){return{$$typeof:nF,value:e}},o.createTestNameSelector=function(e){return{$$typeof:nO,value:e}},o.createTextSelector=function(e){return{$$typeof:nU,value:e}},o.deferredUpdates=function(e){var t=tb,r=nK.transition;try{return nK.transition=null,tb=16,e()}finally{tb=t,nK.transition=r}},o.discreteUpdates=function(e,t,r,i,n){var a=tb,s=nK.transition;try{return nK.transition=null,tb=1,e(t,r,i,n)}finally{tb=a,nK.transition=s,0===nq&&ae()}},o.findAllNodes=nV,o.findBoundingRects=function(e,t){if(!ea)throw Error(h(363));t=nV(e,t),e=[];for(var r=0;r<t.length;r++)e.push(eo(t[r]));for(t=e.length-1;0<t;t--){r=e[t];for(var i=r.x,n=i+r.width,a=r.y,s=a+r.height,o=t-1;0<=o;o--)if(t!==o){var l=e[o],u=l.x,c=u+l.width,d=l.y,f=d+l.height;if(i>=u&&a>=d&&n<=c&&s<=f){e.splice(t,1);break}if(i!==u||r.width!==l.width||f<a||d>s){if(!(a!==d||r.height!==l.height||c<i||u>n)){u>i&&(l.width+=u-i,l.x=i),c<n&&(l.width=n-u),e.splice(t,1);break}}else{d>a&&(l.height+=d-a,l.y=a),f<s&&(l.height=s-d),e.splice(t,1);break}}}return e},o.findHostInstance=aX,o.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=B(e))?function e(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){if(4!==t.tag){var r=e(t);if(null!==r)return r}t=t.sibling}return null}(e):null)?null:e.stateNode},o.findHostInstanceWithWarning=function(e){return aX(e)},o.flushControlled=function(e){var t=nq;nq|=1;var r=nK.transition,i=tb;try{nK.transition=null,tb=1,e()}finally{tb=i,nK.transition=r,0===(nq=t)&&(ae(),tG())}},o.flushPassiveEffects=aB,o.flushSync=ax,o.focusWithin=function(e,t){if(!ea)throw Error(h(363));for(t=Array.from(t=nQ(e=nz(e),t)),e=0;e<t.length;){var r=t[e++];if(!eu(r)){if(5===r.tag&&eh(r.stateNode))return!0;for(r=r.child;null!==r;)t.push(r),r=r.sibling}}return!1},o.getCurrentUpdatePriority=function(){return tb},o.getFindAllNodesFailureDescription=function(e,t){if(!ea)throw Error(h(363));var r=0,i=[];e=[nz(e),0];for(var n=0;n<e.length;){var a=e[n++],s=e[n++],o=t[s];if((5!==a.tag||!eu(a))&&(nG(a,o)&&(i.push(nH(o)),++s>r&&(r=s)),s<t.length))for(a=a.child;null!==a;)e.push(a,s),a=a.sibling}if(r<t.length){for(e=[];r<t.length;r++)e.push(nH(t[r]));return"findAllNodes was able to match part of the selector:\n  "+i.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},o.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?k(e.child.stateNode):e.child.stateNode:null},o.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:d.ReactCurrentDispatcher,findHostInstanceByFiber:aZ,findFiberByHostInstance:e.findFiberByHostInstance||a0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{tL=t.inject(e),tk=t}catch(e){}e=!!t.checkDCE}}return e},o.isAlreadyRendering=function(){return!1},o.observeVisibleRects=function(e,t,r,i){if(!ea)throw Error(h(363));var n=ed(e=nV(e,t),r,i).disconnect;return{disconnect:function(){n()}}},o.registerMutableSourceForHydration=function(e,t){var r=t._getVersion;r=r(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r)},o.runWithPriority=function(e,t){var r=tb;try{return tb=e,t()}finally{tb=r}},o.shouldError=function(){return null},o.shouldSuspend=function(){return!1},o.updateContainer=function(e,t,r,i){var n=t.current,a=ah(),s=ad(n);return r=aq(r),null===t.context?t.context=r:t.pendingContext=r,(t=t5(a,s)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),t6(n,t),null!==(e=af(n,s,a))&&t8(e,n,s),s},o}},95944:(e,t,r)=>{"use strict";e.exports=r(76423)},49145:(e,t,r)=>{"use strict";e.exports=r(58015)},98095:(e,t)=>{"use strict";function r(e,t){var r=e.length;for(e.push(t);0<r;){var i=r-1>>>1,n=e[i];if(0<a(n,t))e[i]=t,e[r]=n,r=i;else break}}function i(e){return 0===e.length?null:e[0]}function n(e){if(0===e.length)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;for(var i=0,n=e.length,s=n>>>1;i<s;){var o=2*(i+1)-1,l=e[o],u=o+1,c=e[u];if(0>a(l,r))u<n&&0>a(c,l)?(e[i]=c,e[u]=r,i=u):(e[i]=l,e[o]=r,i=o);else if(u<n&&0>a(c,r))e[i]=c,e[u]=r,i=u;else break}}return t}function a(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var s,o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,u=l.now();t.unstable_now=function(){return l.now()-u}}var c=[],h=[],d=1,f=null,p=3,m=!1,g=!1,A=!1,v="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,E="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var t=i(h);null!==t;){if(null===t.callback)n(h);else if(t.startTime<=e)n(h),t.sortIndex=t.expirationTime,r(c,t);else break;t=i(h)}}function _(e){if(A=!1,x(e),!g){if(null!==i(c))g=!0,P(b);else{var t=i(h);null!==t&&L(_,t.startTime-e)}}}function b(e,r){g=!1,A&&(A=!1,y(C),C=-1),m=!0;var a=p;try{for(x(r),f=i(c);null!==f&&(!(f.expirationTime>r)||e&&!M());){var s=f.callback;if("function"==typeof s){f.callback=null,p=f.priorityLevel;var o=s(f.expirationTime<=r);r=t.unstable_now(),"function"==typeof o?f.callback=o:f===i(c)&&n(c),x(r)}else n(c);f=i(c)}if(null!==f)var l=!0;else{var u=i(h);null!==u&&L(_,u.startTime-r),l=!1}return l}finally{f=null,p=a,m=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S=!1,w=null,C=-1,T=5,I=-1;function M(){return!(t.unstable_now()-I<T)}function R(){if(null!==w){var e=t.unstable_now();I=e;var r=!0;try{r=w(!0,e)}finally{r?s():(S=!1,w=null)}}else S=!1}if("function"==typeof E)s=function(){E(R)};else if("undefined"!=typeof MessageChannel){var B=new MessageChannel,D=B.port2;B.port1.onmessage=R,s=function(){D.postMessage(null)}}else s=function(){v(R,0)};function P(e){w=e,S||(S=!0,s())}function L(e,r){C=v(function(){e(t.unstable_now())},r)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||m||(g=!0,P(b))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var r=p;p=t;try{return e()}finally{p=r}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=p;p=e;try{return t()}finally{p=r}},t.unstable_scheduleCallback=function(e,n,a){var s=t.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?s+a:s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=0x3fffffff;break;case 4:o=1e4;break;default:o=5e3}return o=a+o,e={id:d++,callback:n,priorityLevel:e,startTime:a,expirationTime:o,sortIndex:-1},a>s?(e.sortIndex=a,r(h,e),null===i(c)&&e===i(h)&&(A?(y(C),C=-1):A=!0,L(_,a-s))):(e.sortIndex=o,r(c,e),g||m||(g=!0,P(b))),e},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(e){var t=p;return function(){var r=p;p=t;try{return e.apply(this,arguments)}finally{p=r}}}},11438:(e,t,r)=>{"use strict";e.exports=r(98095)},5379:function(e){var t;t=function(){var e=function(){function t(e){return n.appendChild(e.dom),e}function r(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";i=e}var i=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),r(++i%n.children.length)},!1);var a=(performance||Date).now(),s=a,o=0,l=t(new e.Panel("FPS","#0ff","#002")),u=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new e.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:n,addPanel:t,showPanel:r,begin:function(){a=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(u.update(e-a,200),e>s+1e3&&(l.update(1e3*o/(e-s),100),s=e,o=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:n,setMode:r}};return e.Panel=function(e,t,r){var i=1/0,n=0,a=Math.round,s=a(window.devicePixelRatio||1),o=80*s,l=48*s,u=3*s,c=2*s,h=3*s,d=15*s,f=74*s,p=30*s,m=document.createElement("canvas");m.width=o,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*s+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=r,g.fillRect(0,0,o,l),g.fillStyle=t,g.fillText(e,u,c),g.fillRect(h,d,f,p),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(h,d,f,p),{dom:m,update:function(l,A){i=Math.min(i,l),n=Math.max(n,l),g.fillStyle=r,g.globalAlpha=1,g.fillRect(0,0,o,d),g.fillStyle=t,g.fillText(a(l)+" "+e+" ("+a(i)+"-"+a(n)+")",u,c),g.drawImage(m,h+s,d,f-s,p,h,d,f-s,p),g.fillRect(h+f-s,d,s,p),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(h+f-s,d,s,a((1-l/A)*p))}}},e},e.exports=t()},10681:(e,t,r)=>{"use strict";var i=r(58009),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=i.useState,s=i.useEffect,o=i.useLayoutEffect,l=i.useDebugValue;function u(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(e){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),i=a({inst:{value:r,getSnapshot:t}}),n=i[0].inst,c=i[1];return o(function(){n.value=r,n.getSnapshot=t,u(n)&&c({inst:n})},[e,r,t]),s(function(){return u(n)&&c({inst:n}),e(function(){u(n)&&c({inst:n})})},[e]),l(r),r};t.useSyncExternalStore=void 0!==i.useSyncExternalStore?i.useSyncExternalStore:c},23058:(e,t,r)=>{"use strict";var i=r(58009),n=r(94924),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=n.useSyncExternalStore,o=i.useRef,l=i.useEffect,u=i.useMemo,c=i.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,i,n){var h=o(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;var f=s(e,(h=u(function(){function e(e){if(!l){if(l=!0,s=e,e=i(e),void 0!==n&&d.hasValue){var t=d.value;if(n(t,e))return o=t}return o=e}if(t=o,a(s,e))return t;var r=i(e);return void 0!==n&&n(t,r)?(s=e,t):(s=e,o=r)}var s,o,l=!1,u=void 0===r?null:r;return[function(){return e(t())},null===u?void 0:function(){return e(u())}]},[t,r,i,n]))[0],h[1]);return l(function(){d.hasValue=!0,d.value=f},[f]),c(f),f}},94924:(e,t,r)=>{"use strict";e.exports=r(10681)},73450:(e,t,r)=>{"use strict";e.exports=r(23058)},29614:(e,t,r)=>{"use strict";let i;r.r(t),r.d(t,{AbrController:()=>ez,AttrList:()=>tA,AudioStreamController:()=>ix,AudioTrackController:()=>iC,BasePlaylistController:()=>i_,BaseSegment:()=>L,BaseStreamController:()=>rl,BufferController:()=>iB,CMCDController:()=>nu,CapLevelController:()=>iL,ChunkMetadata:()=>tl,ContentSteeringController:()=>nc,Cues:()=>ax,DateRange:()=>tv,EMEController:()=>nf,ErrorActionFlags:()=>e0,ErrorController:()=>e1,ErrorDetails:()=>l,ErrorTypes:()=>o,Events:()=>u,FPSController:()=>nA,FetchLoader:()=>aS,Fragment:()=>F,Hls:()=>aX,HlsSkip:()=>ew,HlsUrlParameters:()=>eT,KeySystemFormats:()=>tM,KeySystems:()=>tI,Level:()=>eI,LevelDetails:()=>ty,LevelKey:()=>tk,LoadStats:()=>D,M3U8Parser:()=>tG,MetadataSchema:()=>rM,NetworkErrorAction:()=>eZ,Part:()=>O,PlaylistLevelType:()=>f,SubtitleStreamController:()=>nU,SubtitleTrackController:()=>nb,TimelineController:()=>ag,XhrLoader:()=>aI,default:()=>aX,fetchSupported:()=>a_,getMediaSource:()=>w,isMSESupported:()=>aH,isSupported:()=>aQ,requestMediaKeySystemAccess:()=>tP});let n=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},a=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=s},s=Number.MAX_SAFE_INTEGER||0x1fffffffffffff,o=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),l=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),u=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var c,h,d={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},f={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class p{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){let r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){let e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class m{constructor(e,t,r,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new p(e),this.fast_=new p(t),this.defaultTTFB_=i,this.ttfb_=new p(e)}update(e,t){let{slow_:r,fast_:i,ttfb_:n}=this;r.halfLife!==e&&(this.slow_=new p(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new p(t,i.getEstimate(),i.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new p(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){let r=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/r;this.fast_.sample(r,i),this.slow_.sample(r,i)}sampleTTFB(e){let t=Math.sqrt(2)*Math.exp(-Math.pow(e/1e3,2)/2);this.ttfb_.sample(t,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function g(){return(g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)({}).hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(null,arguments)}function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach(function(t){var i,n;i=t,n=r[t],(i=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t);if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(i))in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class y{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;let r=`[${e}]:`;this.trace=E,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}let E=function(){},x={trace:E,debug:E,log:E,warn:E,info:E,error:E};function _(){return g({},x)}function b(e,t,r){return t[e]?t[e].bind(t):function(e,t){let r=self.console[e];return r?r.bind(self.console,`${t?"["+t+"] ":""}[${e}] >`):E}(e,r)}let S=_();function w(e=!0){if("undefined"!=typeof self)return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function C(e,t){let r=Object.keys(e),i=Object.keys(t),n=r.length,a=i.length;return!n||!a||n===a&&!r.some(e=>-1===i.indexOf(e))}function T(e,t=!1){let r,i;if("undefined"!=typeof TextDecoder){let r=new TextDecoder("utf-8").decode(e);if(t){let e=r.indexOf("\0");return -1!==e?r.substring(0,e):r}return r.replace(/\0/g,"")}let n=e.length,a="",s=0;for(;s<n&&(0!==(r=e[s++])||!t);)if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:a+=String.fromCharCode((31&r)<<6|63&e[s++]);break;case 14:a+=String.fromCharCode((15&r)<<12|(63&e[s++])<<6|(63&e[s++])<<0)}return a}function I(e){let t="";for(let r=0;r<e.length;r++){let i=e[r].toString(16);i.length<2&&(i="0"+i),t+=i}return t}function M(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var R={exports:{}},B=function(){var e,t,r,i,n;return c||(c=1,e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,t=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,n={buildAbsoluteURL:function(e,r,i){if(i=i||{},e=e.trim(),!(r=r.trim())){if(!i.alwaysNormalize)return e;var a=n.parseURL(e);if(!a)throw Error("Error trying to parse base URL.");return a.path=n.normalizePath(a.path),n.buildURLFromParts(a)}var s=n.parseURL(r);if(!s)throw Error("Error trying to parse relative URL.");if(s.scheme)return i.alwaysNormalize?(s.path=n.normalizePath(s.path),n.buildURLFromParts(s)):r;var o=n.parseURL(e);if(!o)throw Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=t.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(u.netLoc=o.netLoc,"/"!==s.path[0])){if(s.path){var c=o.path,h=c.substring(0,c.lastIndexOf("/")+1)+s.path;u.path=n.normalizePath(h)}else u.path=o.path,s.params||(u.params=o.params,s.query||(u.query=o.query))}return null===u.path&&(u.path=i.alwaysNormalize?n.normalizePath(s.path):s.path),n.buildURLFromParts(u)},parseURL:function(t){var r=e.exec(t);return r?{scheme:r[1]||"",netLoc:r[2]||"",path:r[3]||"",params:r[4]||"",query:r[5]||"",fragment:r[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(r,"");e.length!==(e=e.replace(i,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},R.exports=n),R.exports}();class D{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var P={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class L{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof e&&(e={url:e}),this.base=e,function(e,t){let r=function e(t,r){let i=Object.getPrototypeOf(t);if(i)return Object.getOwnPropertyDescriptor(i,r)||e(i,r)}(e,t);r&&(r.enumerable=!0,Object.defineProperty(e,t,r))}(this,"stats")}setByteRange(e,t){let r;let i=e.split("@",2);r=1===i.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[P.AUDIO]:null,[P.VIDEO]:null,[P.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new D),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=B.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){let{elementaryStreams:e}=this;e[P.AUDIO]=null,e[P.VIDEO]=null,e[P.AUDIOVIDEO]=null}}function k(e){return"initSegment"!==e.sn}class F extends L{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){let e=this.stats.total;if(e)return e}if(this.byteRange.length){let e=this.byteRange[0],t=this.byteRange[1];if(n(e)&&n(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){let{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){let e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{let e=Object.keys(this.levelkeys);if(1===e.length){let t=this._decryptdata=this.levelkeys[e[0]]||null;if(t)return t.getDecryptData(this.sn)}}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;let e=n(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e,t;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){let e=Object.keys(this.levelkeys),r=e.length;if(r>1||1===r&&null!=(t=this.levelkeys[e[0]])&&t.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!n(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return k(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){let t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,r,i,n,a=!1){let{elementaryStreams:s}=this,o=s[e];if(!o){s[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:n,partial:a};return}o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,n)}}class O extends L{constructor(e,t,r,i,n){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;let a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){let{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}let U=[].push,N={video:1,audio:2,id3:3,text:4};function z(e){return String.fromCharCode.apply(null,e)}function G(e,t){let r=e[t]<<8|e[t+1];return r<0?65536+r:r}function H(e,t){let r=V(e,t);return r<0?0x100000000+r:r}function Q(e,t){let r=H(e,t);return r*=0x100000000,r+=H(e,t+4)}function V(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function W(e,t){let r=[];if(!t.length)return r;let i=e.byteLength;for(let n=0;n<i;){let a=H(e,n),s=z(e.subarray(n+4,n+8)),o=a>1?n+a:i;if(s===t[0]){if(1===t.length)r.push(e.subarray(n+8,o));else{let i=W(e.subarray(n+8,o),t.slice(1));i.length&&U.apply(r,i)}}n=o}return r}function j(e){let t=[],r=W(e,["moov","trak"]);for(let e=0;e<r.length;e++){let i=r[e],n=W(i,["tkhd"])[0];if(n){let e=n[0],r=H(n,0===e?12:20),a=W(i,["mdia","mdhd"])[0];if(a){e=a[0];let n=H(a,0===e?12:20),s=W(i,["mdia","hdlr"])[0];if(s){let e=z(s.subarray(8,12)),a={soun:P.AUDIO,vide:P.VIDEO}[e],o=function(e){let t;let r=e.subarray(8),i=r.subarray(86),n=z(r.subarray(4,8)),a=n,s="enca"===n||"encv"===n;if(s){let e=W(r,[n])[0].subarray("enca"===n?28:78);W(e,["sinf"]).forEach(e=>{let t=W(e,["schm"])[0];if(t){let r=z(t.subarray(4,8));if("cbcs"===r||"cenc"===r){let t=W(e,["frma"])[0];t&&(a=z(t))}}})}let o=a;switch(a){case"avc1":case"avc2":case"avc3":case"avc4":{let e=W(i,["avcC"])[0];e&&e.length>3&&(a+="."+q(e[1])+q(e[2])+q(e[3]),t=Y("avc1"===o?"dva1":"dvav",i));break}case"mp4a":{let e=W(r,[n])[0],t=W(e.subarray(28),["esds"])[0];if(t&&t.length>7){let e=4;if(3!==t[e++])break;e=K(t,e)+2;let r=t[e++];if(128&r&&(e+=2),64&r&&(e+=t[e++]),4!==t[e++])break;e=K(t,e);let i=t[e++];if(64===i)a+="."+q(i);else break;if(e+=12,5!==t[e++])break;e=K(t,e);let n=t[e++],s=(248&n)>>3;31===s&&(s+=1+((7&n)<<3)+((224&t[e])>>5)),a+="."+s}break}case"hvc1":case"hev1":{let e=W(i,["hvcC"])[0];if(e&&e.length>12){let t=e[1],r=["","A","B","C"][t>>6],i=H(e,2),n=e[12],s=e.subarray(6,12);a+="."+r+(31&t),a+="."+(function(e){let t=0;for(let r=0;r<32;r++)t|=(e>>r&1)<<31-r;return t>>>0})(i).toString(16).toUpperCase(),a+="."+((32&t)>>5?"H":"L")+n;let o="";for(let e=s.length;e--;){let t=s[e];(t||o)&&(o="."+t.toString(16).toUpperCase()+o)}a+=o}t=Y("hev1"==o?"dvhe":"dvh1",i);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":a=Y(a,i)||a;break;case"vp09":{let e=W(i,["vpcC"])[0];if(e&&e.length>6){let t=e[4],r=e[5],i=e[6]>>4&15;a+="."+X(t)+"."+X(r)+"."+X(i)}break}case"av01":{let e=W(i,["av1C"])[0];if(e&&e.length>2){let r=e[1]>>>5,n=31&e[1],s=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,u=(16&e[2])>>4,c=(8&e[2])>>3,h=(4&e[2])>>2,d=3&e[2];a+="."+r+"."+X(n)+s+"."+X(2===r&&o?l?12:10:o?10:8)+"."+u+"."+c+h+d+"."+X(1)+"."+X(1)+"."+X(1)+".0",t=Y("dav1",i)}}}return{codec:a,encrypted:s,supplemental:t}}(W(i,["mdia","minf","stbl","stsd"])[0]);a?(t[r]={timescale:n,type:a,stsd:o},t[a]=v({timescale:n,id:r},o)):t[r]={timescale:n,type:e,stsd:o}}}}}return W(e,["moov","mvex","trex"]).forEach(e=>{let r=t[H(e,4)];r&&(r.default={duration:H(e,12),flags:H(e,20)})}),t}function Y(e,t){let r=W(t,["dvvC"]),i=r.length?r[0]:W(t,["dvcC"])[0];if(i){let t=i[2]>>1&127,r=i[2]<<5&32|i[3]>>3&31;return e+"."+X(t)+"."+X(r)}}function K(e,t){let r=t+5;for(;128&e[t++]&&t<r;);return t}function q(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function X(e){return(e<10?"0":"")+e}function $(e){let t=W(e,["schm"])[0];if(t){let r=z(t.subarray(4,8));if("cbcs"===r||"cenc"===r)return W(e,["schi","tenc"])[0]}return null}function J(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function Z(e,t){let r=[],i=t.samples,n=t.timescale,a=t.id,s=!1;return W(i,["moof"]).map(o=>{let l=o.byteOffset-8;W(o,["traf"]).map(o=>{let u=W(o,["tfdt"]).map(e=>{let t=e[0],r=H(e,4);return 1===t&&(r*=0x100000000,r+=H(e,8)),r/n})[0];return void 0!==u&&(e=u),W(o,["tfhd"]).map(u=>{let c=H(u,4),h=0xffffff&H(u,0),d=0,f=0,p=8;c===a&&((1&h)!=0&&(p+=8),(2&h)!=0&&(p+=4),(8&h)!=0&&(d=H(u,p),p+=4),(16&h)!=0&&(f=H(u,p),p+=4),(32&h)!=0&&(p+=4),"video"===t.type&&(s=ee(t.codec)),W(o,["trun"]).map(a=>{let o=a[0],u=0xffffff&H(a,0),c=0,h=(256&u)!=0,p=0,m=(512&u)!=0,g=0,A=(1024&u)!=0,v=(2048&u)!=0,y=0,E=H(a,4),x=8;(1&u)!=0&&(c=H(a,x),x+=4),(4&u)!=0&&(x+=4);let _=c+l;for(let l=0;l<E;l++){if(h?(p=H(a,x),x+=4):p=d,m?(g=H(a,x),x+=4):g=f,A&&(x+=4),v&&(y=0===o?H(a,x):V(a,x),x+=4),t.type===P.VIDEO){let t=0;for(;t<g;){let a=H(i,_);_+=4,function(e,t){if(!e)return 6==(31&t);{let e=t>>1&63;return 39===e||40===e}}(s,i[_])&&et(i.subarray(_,_+a),s?2:1,e+y/n,r),_+=a,t+=a+4}}e+=p/n}}))})})}),r}function ee(e){if(!e)return!1;let t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function et(e,t,r,i){let n;let a=er(e);n=0+t;let s=0,o=0,l=0;for(;n<a.length;){s=0;do{if(n>=a.length)break;s+=l=a[n++]}while(255===l);o=0;do{if(n>=a.length)break;o+=l=a[n++]}while(255===l);let e=a.length-n,t=n;if(o<e)n+=o;else if(o>e){S.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===s){if(181===a[t++]){let e=G(a,t);if(t+=2,49===e){let e=H(a,t);if(t+=4,0x47413934===e){let e=a[t++];if(3===e){let n=a[t++],o=31&n,l=64&n,u=l?2+3*o:0,c=new Uint8Array(u);if(l){c[0]=n;for(let e=1;e<u;e++)c[e]=a[t++]}i.push({type:e,payloadType:s,pts:r,bytes:c})}}}}}else if(5===s&&o>16){let e=[];for(let r=0;r<16;r++){let i=a[t++].toString(16);e.push(1==i.length?"0"+i:i),(3===r||5===r||7===r||9===r)&&e.push("-")}let n=o-16,l=new Uint8Array(n);for(let e=0;e<n;e++)l[e]=a[t++];i.push({payloadType:s,pts:r,uuid:e.join(""),userData:T(l),userDataBytes:l})}}}function er(e){let t=e.byteLength,r=[],i=1;for(;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;let n=t-r.length,a=new Uint8Array(n),s=0;for(i=0;i<n;s++,i++)s===r[0]&&(s++,r.shift()),a[i]=e[s];return a}let ei=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),en={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function ea(e,t){let r=en[t];return!!r&&!!r[e.slice(0,4)]}function es(e,t,r=!0){return!e.split(",").some(e=>!eo(e,t,r))}function eo(e,t,r=!0){var i;let n=w(r);return null!=(i=null==n?void 0:n.isTypeSupported(el(e,t)))&&i}function el(e,t){return`${t}/mp4;codecs=${e}`}function eu(e){if(e){let t=e.substring(0,4);return en.video[t]}return 2}function ec(e){let t=ei();return e.split(",").reduce((e,r)=>{let i=t&&ee(r)?9:en.video[r];return i?(2*i+e)/(e?3:2):(en.audio[r]+e)/(e?2:1)},0)}let eh={},ed=/flac|opus|mp4a\.40\.34/i;function ef(e,t=!0){return e.replace(ed,e=>(function(e,t=!0){if(eh[e])return eh[e];let r={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let n=0;n<r.length;n++){var i;if(eo(r[n],"audio",t))return eh[e]=r[n],r[n];if("mp3"===r[n]&&null!=(i=w(t))&&i.isTypeSupported("audio/mpeg"))return""}return e})(e.toLowerCase(),t))}function ep(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e))&&(em(e,"audio")||em(e,"video")))return e;if(t){let r=t.split(",");if(r.length>1){if(e){for(let t=r.length;t--;)if(r[t].substring(0,4)===e.substring(0,4))return r[t]}return r[0]}}return t||e}function em(e,t){return ea(e,t)&&eo(e,t)}function eg(e){let t=w(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function eA(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}let ev={supported:!1,smooth:!1,powerEfficient:!1},ey={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function eE(e,t){return{supported:!1,configurations:t,decodingInfoResults:[ev],error:e}}function ex(e,t,r,i={}){let n=e.videoCodec;if(!n&&!e.audioCodec||!r)return Promise.resolve(ey);let a=[],s=function(e){var t;let r=null==(t=e.videoCodec)?void 0:t.split(","),i=e_(e),n=e.width||640,a=e.height||480,s=e.frameRate||30,o=e.videoRange.toLowerCase();return r?r.map(e=>{let t={contentType:el(function(e){if(e.startsWith("av01.")){let t=e.split("."),r=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=r[e-4];return t.join(".")}return e}(e),"video"),width:n,height:a,bitrate:i,framerate:s};return"sdr"!==o&&(t.transferFunction=o),t}):[]}(e),o=s.length,l=function(e,t,r){var i;let n=null==(i=e.audioCodec)?void 0:i.split(","),a=e_(e);return n&&e.audioGroups?e.audioGroups.reduce((e,i)=>{var s;let o=i?null==(s=t.groups[i])?void 0:s.tracks:null;return o?o.reduce((e,t)=>{if(t.groupId===i){let i=parseFloat(t.channels||"");n.forEach(t=>{let n={contentType:el(t,"audio"),bitrate:r?function(e,t){if(t<=1)return 1;let r=128e3;return"ec-3"===e?r=768e3:"ac-3"===e&&(r=64e4),Math.min(t/2,r)}(t,a):a};i&&(n.channels=""+i),e.push(n)})}return e},e):e},[]):[]}(e,t,o>0),u=l.length;for(let e=o||1*u||1;e--;){let t={type:"media-source"};if(o&&(t.video=s[e%o]),u){t.audio=l[e%u];let r=t.audio.bitrate;t.video&&r&&(t.video.bitrate-=r)}a.push(t)}if(n){let e=navigator.userAgent;if(n.split(",").some(e=>ee(e))&&ei())return Promise.resolve(eE(Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${e})`),a))}return Promise.all(a.map(e=>{let t=function(e){let t="",{audio:r,video:i}=e;if(i){let e=eA(i.contentType);t+=`${e}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(r){let e=eA(r.contentType);t+=`${i?"_":""}${e}_c${r.channels}`}return t}(e);return i[t]||(i[t]=r.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:a,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:a,decodingInfoResults:[],error:e}))}function e_(e){return 1e3*Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)/1e3)||1}let eb=["NONE","TYPE-0","TYPE-1",null],eS=["SDR","PQ","HLG"];var ew={No:"",Yes:"YES",v2:"v2"};function eC(e){let{canSkipUntil:t,canSkipDateRanges:r,age:i}=e;return t&&i<t/2?r?ew.v2:ew.Yes:ew.No}class eT{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){let t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class eI{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;let r=null==(t=e.supplemental)?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return eM(this._audioGroups,e)}hasSubtitleGroup(e){return eM(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function eM(e,t){return!!t&&!!e&&-1!==e.indexOf(t)}let eR=e=>{let t=new WeakSet;return(r,i)=>{if(e&&(i=e(r,i)),"object"==typeof i&&null!==i){if(t.has(i))return;t.add(i)}return i}},eB=(e,t)=>JSON.stringify(e,eR(t));function eD(e,t){S.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function eP(e){return e.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);let i=t.channels||"2";return r.channels[i]=(r.channels[i]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function eL(e){if(!e)return e;let{lang:t,assocLang:r,characteristics:i,channels:n,audioCodec:a}=e;return{lang:t,assocLang:r,characteristics:i,channels:n,audioCodec:a}}function ek(e,t,r){if("attrs"in e){let r=t.indexOf(e);if(-1!==r)return r}for(let i=0;i<t.length;i++)if(eF(e,t[i],r))return i;return -1}function eF(e,t,r){let{groupId:i,name:n,lang:a,assocLang:s,default:o}=e,l=e.forced;return(void 0===i||t.groupId===i)&&(void 0===n||t.name===n)&&(void 0===a||function(e,t="--"){return e.length===t.length?e===t:e.startsWith(t)||t.startsWith(e)}(a,t.lang))&&(void 0===a||t.assocLang===s)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e,t=""){let r=e.split(","),i=t.split(",");return r.length===i.length&&!r.some(e=>-1===i.indexOf(e))}(e.characteristics||"",t.characteristics))&&(void 0===r||r(e,t))}function eO(e,t){let{audioCodec:r,channels:i}=e;return(void 0===r||(t.audioCodec||"").substring(0,4)===r.substring(0,4))&&(void 0===i||i===(t.channels||"2"))}function eU(e,t,r){for(let i=t;i>-1;i--)if(r(e[i]))return i;for(let i=t+1;i<e.length;i++)if(r(e[i]))return i;return -1}function eN(e,t){var r;return!!e&&e!==(null==(r=t.loadLevelObj)?void 0:r.uri)}class ez extends y{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;let r;let{fragCurrent:i,partCurrent:a,hls:s}=this,{autoLevelEnabled:o,media:l}=s;if(!i||!l)return;let c=performance.now(),h=a?a.stats:i.stats,d=a?a.duration:i.duration,f=c-h.loading.start,p=s.minAutoLevel,m=i.level,g=this._nextAutoLevel;if(h.aborted||h.loaded&&h.loaded===h.total||m<=p){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;let A=g>-1&&g!==m,v=!!e||A;if(!v&&(l.paused||!l.playbackRate||!l.readyState))return;let y=s.mainForwardBufferInfo;if(!v&&null===y)return;let E=this.bwEstimator.getEstimateTTFB(),x=Math.abs(l.playbackRate);if(f<=Math.max(E,d/(2*x)*1e3))return;let _=y?y.len/x:0,b=h.loading.first?h.loading.first-h.loading.start:-1,S=h.loaded&&b>-1,w=this.getBwEstimate(),C=s.levels,T=C[m],I=Math.max(h.loaded,Math.round(d*(i.bitrate||T.averageBitrate)/8)),M=S?f-b:f;M<1&&S&&(M=Math.min(f,8*h.loaded/w));let R=S?1e3*h.loaded/M:0,B=E/1e3,D=R?(I-h.loaded)/R:8*I/w+B;if(D<=_)return;let P=R?8*R:w,L=(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live)===!0,k=this.hls.config.abrBandWidthUpFactor,F=Number.POSITIVE_INFINITY;for(r=m-1;r>p;r--){let e=C[r].maxBitrate,t=!C[r].details||L;if((F=this.getTimeToLoadFrag(B,P,d*e,t))<Math.min(_,d+B))break}if(F>=D||F>10*d)return;S?this.bwEstimator.sample(f-Math.min(E,b),h.loaded):this.bwEstimator.sampleTTFB(f);let O=C[r].maxBitrate;this.getBwEstimate()*k>O&&this.resetEstimator(O);let U=this.findBestLevel(O,p,r,0,_,1,1);U>-1&&(r=U),this.warn(`Fragment ${i.sn}${a?" part "+a.index:""} of level ${m} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${_.toFixed(3)} s
      Estimated load time for current fragment: ${D.toFixed(3)} s
      Estimated load time for down switch fragment: ${F.toFixed(3)} s
      TTFB estimate: ${0|b} ms
      Current BW estimate: ${n(w)?0|w:"Unknown"} bps
      New BW estimate: ${0|this.getBwEstimate()} bps
      Switching to level ${r} @ ${0|O} bps`),s.nextLoadLevel=s.nextAutoLevel=r,this.clearTimer();let N=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===r&&r>0){let e=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${r>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${e.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,r>p){let t=this.findBestLevel(this.hls.levels[p].bitrate,p,r,0,e,1,1);-1===t&&(t=p),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};A||D>2*F?N():this.timer=self.setInterval(N,1e3*F),s.trigger(u.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:a,stats:h})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){let e=this.hls.config;return new m(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){let{hls:e}=this;e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.FRAG_LOADING,this.onFragLoading,this),e.on(u.FRAG_LOADED,this.onFragLoaded,this),e.on(u.FRAG_BUFFERED,this.onFragBuffered,this),e.on(u.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(u.LEVEL_LOADED,this.onLevelLoaded,this),e.on(u.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(u.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(u.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e&&(e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.FRAG_LOADING,this.onFragLoading,this),e.off(u.FRAG_LOADED,this.onFragLoaded,this),e.off(u.FRAG_BUFFERED,this.onFragBuffered,this),e.off(u.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(u.LEVEL_LOADED,this.onLevelLoaded,this),e.off(u.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(u.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(u.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){let r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var i;this.fragCurrent=r,this.partCurrent=null!=(i=t.part)?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case l.BUFFER_ADD_CODEC_ERROR:case l.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case l.FRAG_LOAD_TIMEOUT:{let e=t.frag,{fragCurrent:r,partCurrent:i}=this;if(e&&r&&e.sn===r.sn&&e.level===r.level){let t=performance.now(),r=i?i.stats:e.stats,n=t-r.loading.start,a=r.loading.first?r.loading.first-r.loading.start:-1;if(r.loaded&&a>-1){let e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(n-Math.min(e,a),r.loaded)}else this.bwEstimator.sampleTTFB(n)}}}}getTimeToLoadFrag(e,t,r,i){let n=i?e+this.lastLevelLoadSec:0;return e+r/t+n}onLevelLoaded(e,t){let r=this.hls.config,{loading:i}=t.stats,a=i.end-i.first;n(a)&&(this.lastLevelLoadSec=a/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){let i=r?r.stats:t.stats;if(t.type===f.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){let e=r?r.duration:t.duration,n=this.hls.levels[t.level],a=(n.loaded?n.loaded.bytes:0)+i.loaded,s=(n.loaded?n.loaded.duration:0)+e;n.loaded={bytes:a,duration:s},n.realBitrate=Math.round(8*a/s)}if(t.bitrateTest){let e={stats:i,frag:t,part:r,id:t.type};this.onFragBuffered(u.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){let{frag:r,part:i}=t,n=null!=i&&i.stats.loaded?i.stats:r.stats;if(n.aborted||this.ignoreFragment(r))return;let a=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,n.loaded),n.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==f.MAIN||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){let{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,n=this.findBestLevel(r,t,e,0,i,1,1);if(n>-1)return n;let a=this.hls.firstLevel,s=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${s}`),s}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){let e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(-1!==e&&(!t||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;let i=t&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){let t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){let{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;let{maxAutoLevel:i,config:n,minAutoLevel:a}=r,s=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay(),u=n.abrBandWidthFactor,c=n.abrBandWidthUpFactor;if(l){let e=this.findBestLevel(o,a,i,l,0,u,c);if(e>=0)return this.rebufferNotice=-1,e}let h=s?Math.min(s,n.maxStarvationDelay):n.maxStarvationDelay;if(!l){let e=this.bitrateTestDelay;e&&(h=(s?Math.min(s,n.maxLoadingDelay):n.maxLoadingDelay)-e,this.info(`bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),u=c=1)}let d=this.findBestLevel(o,a,i,l,h,u,c);if(this.rebufferNotice!==d&&(this.rebufferNotice=d,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${d}`)),d>-1)return d;let f=r.levels[a],p=r.loadLevelObj;return p&&(null==f?void 0:f.bitrate)<p.bitrate?a:r.loadLevel}getStarvationDelay(){let e=this.hls,t=e.media;if(!t)return 1/0;let r=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,i,a,s,o){var l,u;let c;let h=i+a,d=this.lastLoadedFragLevel,f=-1===d?this.hls.firstLevel:d,{fragCurrent:p,partCurrent:m}=this,{levels:g,allAudioTracks:A,loadLevel:v,config:y}=this.hls;if(1===g.length)return 0;let E=g[f],x=!!(null!=(l=this.hls.latestLevelDetails)&&l.live),_=-1===v||-1===d,b="SDR",S=(null==E?void 0:E.frameRate)||0,{audioPreference:w,videoPreference:C}=y,T=this.audioTracksByGroup||(this.audioTracksByGroup=eP(A)),I=-1;if(_){if(-1!==this.firstSelection)return this.firstSelection;let i=function(e,t,r,i,a){let s=Object.keys(e),o=null==i?void 0:i.channels,l=null==i?void 0:i.audioCodec,u=null==a?void 0:a.videoCodec,c=o&&2===parseInt(o),h=!1,d=!1,f=1/0,p=1/0,m=1/0,g=1/0,A=0,v=[],{preferHDR:y,allowedVideoRanges:E}=function(e,t){let r=!1,i=[];if(e&&(r="SDR"!==e,i=[e]),t){let e="SDR"!==(i=t.allowedVideoRanges||eS.slice(0)).join("")&&!t.videoCodec;(r=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"==typeof matchMedia){let e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}())||(i=["SDR"])}return{preferHDR:r,allowedVideoRanges:i}}(t,a);for(let t=s.length;t--;){let r=e[s[t]];h||(h=r.channels[2]>0),f=Math.min(f,r.minHeight),p=Math.min(p,r.minFramerate),m=Math.min(m,r.minBitrate),E.filter(e=>r.videoRanges[e]>0).length>0&&(d=!0)}f=n(f)?f:0,p=n(p)?p:0;let x=Math.max(1080,f),_=Math.max(30,p);r=Math.max(m=n(m)?m:r,r),d||(t=void 0);let b=s.length>1;return{codecSet:s.reduce((t,i)=>{let n=e[i];if(i===t)return t;if(v=d?E.filter(e=>n.videoRanges[e]>0):[],b){if(n.minBitrate>r)return eD(i,`min bitrate of ${n.minBitrate} > current estimate of ${r}`),t;if(!n.hasDefaultAudio)return eD(i,"no renditions with default or auto-select sound found"),t;if(l&&i.indexOf(l.substring(0,4))%5!=0)return eD(i,`audio codec preference "${l}" not found`),t;if(o&&!c){if(!n.channels[o])return eD(i,`no renditions with ${o} channel sound found (channels options: ${Object.keys(n.channels)})`),t}else if((!l||c)&&h&&0===n.channels["2"])return eD(i,"no renditions with stereo sound found"),t;if(n.minHeight>x)return eD(i,`min resolution of ${n.minHeight} > maximum of ${x}`),t;if(n.minFramerate>_)return eD(i,`min framerate of ${n.minFramerate} > maximum of ${_}`),t;if(!v.some(e=>n.videoRanges[e]>0))return eD(i,`no variants with VIDEO-RANGE of ${eB(v)} found`),t;if(u&&i.indexOf(u.substring(0,4))%5!=0)return eD(i,`video codec preference "${u}" not found`),t;if(n.maxScore<A)return eD(i,`max score of ${n.maxScore} < selected max of ${A}`),t}return t&&(ec(i)>=ec(t)||n.fragmentError>e[t].fragmentError)?t:(g=n.minIndex,A=n.maxScore,i)},void 0),videoRanges:v,preferHDR:y,minFramerate:p,minBitrate:m,minIndex:g}}(this.codecTiers||(this.codecTiers=g.slice(t,r+1).reduce((e,t,r)=>{if(!t.codecSet)return e;let i=t.audioGroups,n=e[t.codecSet];n||(e[t.codecSet]=n={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:r,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!i,fragmentError:0}),n.minBitrate=Math.min(n.minBitrate,t.bitrate);let a=Math.min(t.height,t.width);return n.minHeight=Math.min(n.minHeight,a),n.minFramerate=Math.min(n.minFramerate,t.frameRate),n.minIndex=Math.min(n.minIndex,r),n.maxScore=Math.max(n.maxScore,t.score),n.fragmentError+=t.fragmentError,n.videoRanges[t.videoRange]=(n.videoRanges[t.videoRange]||0)+1,i&&i.forEach(e=>{if(!e)return;let t=T.groups[e];t&&(n.hasDefaultAudio=n.hasDefaultAudio||T.hasDefaultAudio?t.hasDefault:t.hasAutoSelect||!T.hasDefaultAudio&&!T.hasAutoSelectAudio,Object.keys(t.channels).forEach(e=>{n.channels[e]=(n.channels[e]||0)+t.channels[e]}))}),e},{})),b,e,w,C),{codecSet:a,videoRanges:s,minFramerate:o,minBitrate:l,minIndex:u,preferHDR:h}=i;I=u,c=a,b=h?s[s.length-1]:s[0],S=o,e=Math.max(e,l),this.log(`picked start tier ${eB(i)}`)}else c=null==E?void 0:E.codecSet,b=null==E?void 0:E.videoRange;let M=m?m.duration:p?p.duration:0,R=this.bwEstimator.getEstimateTTFB()/1e3,B=[];for(let l=r;l>=t;l--){let t;let p=g[l],A=l>f;if(!p)continue;if(y.useMediaCapabilities&&!p.supportedResult&&!p.supportedPromise){let t=navigator.mediaCapabilities;"function"==typeof(null==t?void 0:t.decodingInfo)&&function(e,t,r,i,a,s){let o=e.videoCodec,l=e.audioCodec?e.audioGroups:null,u=null==s?void 0:s.audioCodec,c=null==s?void 0:s.channels,h=c?parseInt(c):u?1/0:2,d=null;if(null!=l&&l.length)try{d=1===l.length&&l[0]?t.groups[l[0]].channels:l.reduce((e,r)=>{if(r){let i=t.groups[r];if(!i)throw Error(`Audio track group ${r} not found`);Object.keys(i.channels).forEach(t=>{e[t]=(e[t]||0)+i.channels[t]})}return e},{2:0})}catch(e){return!0}return void 0!==o&&(o.split(",").some(e=>ee(e))||e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(i,30)||"SDR"!==e.videoRange&&e.videoRange!==r||e.bitrate>Math.max(a,8e6))||!!d&&n(h)&&Object.keys(d).some(e=>parseInt(e)>h)}(p,T,b,S,e,w)?(p.supportedPromise=ex(p,T,t,this.supportedCache),p.supportedPromise.then(e=>{if(!this.hls)return;p.supportedResult=e;let t=this.hls.levels,r=t.indexOf(p);e.error?this.warn(`MediaCapabilities decodingInfo error: "${e.error}" for level ${r} ${eB(e)}`):e.supported?e.decodingInfoResults.some(e=>!1===e.smooth||!1===e.powerEfficient)&&this.log(`MediaCapabilities decodingInfo for level ${r} not smooth or powerEfficient: ${eB(e)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${r} ${eB(e)}`),r>-1&&t.length>1&&(this.log(`Removing unsupported level ${r}`),this.hls.removeLevel(r),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(e=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${e}`)})):p.supportedResult=ey}if((c&&p.codecSet!==c||b&&p.videoRange!==b||A&&S>p.frameRate||!A&&S>0&&S<p.frameRate||null!=(u=p.supportedResult)&&null!=(u=u.decodingInfoResults)&&u.some(e=>!1===e.smooth))&&(!_||l!==I)){B.push(l);continue}let E=p.details,C=(m?null==E?void 0:E.partTarget:null==E?void 0:E.averagetargetduration)||M;t=A?o*e:s*e;let D=M&&i>=2*M&&0===a?p.averageBitrate:p.maxBitrate,P=this.getTimeToLoadFrag(R,t,D*C,void 0===E);if(t>=D&&(l===d||0===p.loadError&&0===p.fragmentError)&&(P<=R||!n(P)||x&&!this.bitrateTestDelay||P<h)){let e=this.forcedAutoLevel;return l!==v&&(-1===e||e!==v)&&(B.length&&this.trace(`Skipped level(s) ${B.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${g[B[0]].codecs}" ${g[B[0]].videoRange}; not compatible with "${c}" ${b}`),this.info(`switch candidate:${f}->${l} adjustedbw(${Math.round(t)})-bitrate=${Math.round(t-D)} ttfb:${R.toFixed(1)} avgDuration:${C.toFixed(1)} maxFetchDuration:${h.toFixed(1)} fetchDuration:${P.toFixed(1)} firstSelection:${_} codecSet:${p.codecSet} videoRange:${p.videoRange} hls.loadLevel:${v}`)),_&&(this.firstSelection=l),l}}return -1}set nextAutoLevel(e){let t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){let{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}let eG={search:function(e,t){let r=0,i=e.length-1,n=null,a=null;for(;r<=i;){let s=t(a=e[n=(r+i)/2|0]);if(s>0)r=n+1;else{if(!(s<0))return a;i=n-1}}return null}};function eH(e,t,r=0,i=0,n=.005){let a=null;if(e){a=t[1+e.sn-t[0].sn]||null;let i=e.endDTS-r;i>0&&i<15e-7&&(r+=15e-7),a&&e.level!==a.level&&a.end<=e.end&&(a=t[2+e.sn-t[0].sn]||null)}else 0===r&&0===t[0].start&&(a=t[0]);if(a&&((!e||e.level===a.level)&&0===eQ(r,i,a)||function(e,t,r){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){let i=t.tagList.reduce((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e),r);return e.start<=i}return!1}(a,e,Math.min(n,i))))return a;let s=eG.search(t,eQ.bind(null,r,i));return s&&(s!==e||!a)?s:a}function eQ(e=0,t=0,r){if(r.start<=e&&r.start+r.duration>e)return 0;let i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-i<=e?1:r.start-i>e&&r.start?-1:0}function eV(e,t,r){if(e&&e.startCC<=t&&e.endCC>=t){let i,n=e.fragments,{fragmentHint:a}=e;return a&&(n=n.concat(a)),eG.search(n,e=>e.cc<t?1:e.cc>t?-1:(i=e,e.end<=r)?1:e.start>r?-1:0),i||null}return null}function eW(e){switch(e.details){case l.FRAG_LOAD_TIMEOUT:case l.KEY_LOAD_TIMEOUT:case l.LEVEL_LOAD_TIMEOUT:case l.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ej(e){return e.details.startsWith("key")}function eY(e){return ej(e)&&!!e.frag&&!e.frag.decryptdata}function eK(e,t){let r=eW(t);return e.default[`${r?"timeout":"error"}Retry`]}function eq(e,t){return Math.min(("linear"===e.backoff?1:Math.pow(2,t))*e.retryDelayMs,e.maxRetryDelayMs)}function eX(e){return v(v({},e),{errorRetry:null,timeoutRetry:null})}function e$(e,t,r,i){if(!e)return!1;let n=null==i?void 0:i.code,a=t<e.maxNumRetry&&(eJ(n)||!!n&&(n<400||n>499)||!!r);return e.shouldRetry?e.shouldRetry(e,t,r,i,a):a}function eJ(e){return 0===e&&!1===navigator.onLine}var eZ={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},e0={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class e1 extends y{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){let e=this.hls;e.on(u.ERROR,this.onError,this),e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){let e=this.hls;e&&(e.off(u.ERROR,this.onError,this),e.off(u.ERROR,this.onErrorOut,this),e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===f.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;let t=this.hls,r=t.currentLevel;return null!=(e=t.loadLevelObj)&&e.details||-1===r?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if(null!=(r=e.details)&&r.hasKey(t))return!0;let i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(e=>i.indexOf(e.groupId)>=0).some(e=>{var r;return null==(r=e.details)?void 0:r.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,i,n;if(t.fatal)return;let a=this.hls,s=t.context;switch(t.details){case l.FRAG_LOAD_ERROR:case l.FRAG_LOAD_TIMEOUT:case l.KEY_LOAD_ERROR:case l.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case l.FRAG_PARSING_ERROR:if(null!=(r=t.frag)&&r.gap){t.errorAction=e2();return}case l.FRAG_GAP:case l.FRAG_DECRYPT_ERROR:t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=eZ.SendAlternateToPenaltyBox;return;case l.LEVEL_EMPTY_ERROR:case l.LEVEL_PARSING_ERROR:{let e=t.parent===f.MAIN?t.level:a.loadLevel;t.details===l.LEVEL_EMPTY_ERROR&&null!=(i=t.context)&&null!=(i=i.levelDetails)&&i.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case l.LEVEL_LOAD_ERROR:case l.LEVEL_LOAD_TIMEOUT:"number"==typeof(null==s?void 0:s.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case l.AUDIO_TRACK_LOAD_ERROR:case l.AUDIO_TRACK_LOAD_TIMEOUT:case l.SUBTITLE_LOAD_ERROR:case l.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){let e=a.loadLevelObj;e&&(s.type===d.AUDIO_TRACK&&e.hasAudioGroup(s.groupId)||s.type===d.SUBTITLE_TRACK&&e.hasSubtitleGroup(s.groupId))&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.loadLevel),t.errorAction.action=eZ.SendAlternateToPenaltyBox,t.errorAction.flags=e0.MoveAllAlternatesMatchingHost)}return;case l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:eZ.SendAlternateToPenaltyBox,flags:e0.MoveAllAlternatesMatchingHDCP};return;case l.KEY_SYSTEM_SESSION_UPDATE_FAILED:case l.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case l.KEY_SYSTEM_NO_SESSION:t.errorAction={action:eZ.SendAlternateToPenaltyBox,flags:e0.MoveAllAlternatesMatchingKey};return;case l.BUFFER_ADD_CODEC_ERROR:case l.REMUX_ALLOC_ERROR:case l.BUFFER_APPEND_ERROR:t.errorAction||(t.errorAction=this.getLevelSwitchAction(t,null!=(n=t.level)?n:a.loadLevel));return;case l.INTERNAL_EXCEPTION:case l.BUFFER_APPENDING_ERROR:case l.BUFFER_FULL_ERROR:case l.LEVEL_SWITCH_ERROR:case l.BUFFER_STALLED_ERROR:case l.BUFFER_SEEK_OVER_HOLE:case l.BUFFER_NUDGE_ON_STALL:t.errorAction=e2();return}t.type===o.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=e2())}getPlaylistRetryOrSwitchAction(e,t){let r=eK(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++;if(e$(r,i,eW(e),e.response))return{action:eZ.RetryRequest,flags:e0.None,retryConfig:r,retryCount:i};let n=this.getLevelSwitchAction(e,t);return r&&(n.retryConfig=r,n.retryCount=i),n}getFragRetryOrSwitchAction(e){let t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],{fragLoadPolicy:n,keyLoadPolicy:a}=t.config,s=eK(ej(e)?a:n,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(i&&(e.details!==l.FRAG_GAP&&i.fragmentError++,!eY(e)&&e$(s,o,eW(e),e.response)))return{action:eZ.RetryRequest,flags:e0.None,retryConfig:s,retryCount:o};let u=this.getLevelSwitchAction(e,r);return s&&(u.retryConfig=s,u.retryCount=o),u}getLevelSwitchAction(e,t){let r=this.hls;null==t&&(t=r.loadLevel);let i=this.hls.levels[t];if(i){var n,a,s,o;let t=e.details;i.loadError++,t===l.BUFFER_APPEND_ERROR&&i.fragmentError++;let u=-1,{levels:c,loadLevel:h,minAutoLevel:p,maxAutoLevel:m}=r;r.autoLevelEnabled||r.config.preserveManualLevelOnError||(r.loadLevel=-1);let g=null==(n=e.frag)?void 0:n.type,A=(g===f.AUDIO&&t===l.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===l.BUFFER_ADD_CODEC_ERROR||t===l.BUFFER_APPEND_ERROR))&&c.some(({audioCodec:e})=>i.audioCodec!==e),v="video"===e.sourceBufferName&&(t===l.BUFFER_ADD_CODEC_ERROR||t===l.BUFFER_APPEND_ERROR)&&c.some(({codecSet:e,audioCodec:t})=>i.codecSet!==e&&i.audioCodec===t),{type:y,groupId:E}=null!=(a=e.context)?a:{};for(let r=c.length;r--;){let n=(r+h)%c.length;if(n!==h&&n>=p&&n<=m&&0===c[n].loadError){let r=c[n];if(t===l.FRAG_GAP&&g===f.MAIN&&e.frag){let t=c[n].details;if(t){let r=eH(e.frag,t.fragments,e.frag.start);if(null!=r&&r.gap)continue}}else if(y===d.AUDIO_TRACK&&r.hasAudioGroup(E)||y===d.SUBTITLE_TRACK&&r.hasSubtitleGroup(E))continue;else if(g===f.AUDIO&&null!=(s=i.audioGroups)&&s.some(e=>r.hasAudioGroup(e))||g===f.SUBTITLE&&null!=(o=i.subtitleGroups)&&o.some(e=>r.hasSubtitleGroup(e))||A&&i.audioCodec===r.audioCodec||v&&i.codecSet===r.codecSet||!A&&i.codecSet!==r.codecSet)continue;u=n;break}}if(u>-1&&r.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:eZ.SendAlternateToPenaltyBox,flags:e0.None,nextAutoLevel:u}}return{action:eZ.SendAlternateToPenaltyBox,flags:e0.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case eZ.DoNothing:break;case eZ.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===l.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0;case eZ.RetryRequest:}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){let t=this.hls,r=e.errorAction;if(!r)return;let{flags:i}=r,n=r.nextAutoLevel;switch(i){case e0.None:this.switchLevel(e,n);break;case e0.MoveAllAlternatesMatchingHDCP:{let i=this.getVariantLevelIndex(e.frag),n=t.levels[i],a=null==n?void 0:n.attrs["HDCP-LEVEL"];if(r.hdcpLevel=a,"NONE"===a)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(a){t.maxHdcpLevel=eb[eb.indexOf(a)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case e0.MoveAllAlternatesMatchingKey:{let t=e.decryptdata;if(t){let i=this.hls.levels,n=i.length;for(let r=n;r--;)if(this.variantHasKey(i[r],t)){var a,s;this.log(`Banned key found in level ${r} (${i[r].bitrate}bps) or audio group "${null==(a=i[r].audioGroups)?void 0:a.join(",")}" (${null==(s=e.frag)?void 0:s.type} fragment) ${I(t.keyId||[])}`),i[r].fragmentError++,i[r].loadError++,this.log(`Removing level ${r} with key error (${e.error})`),this.hls.removeLevel(r)}let o=e.frag;if(this.hls.levels.length<n)r.resolved=!0;else if(o&&o.type!==f.MAIN){let e=o.decryptdata;e&&!t.matches(e)&&(r.resolved=!0)}}}}r.resolved||this.switchLevel(e,n)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===l.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){let t=eA(e.mimeType),r=this.hls.levels;for(let i=r.length;i--;)r[i][`${e.sourceBufferName}Codec`]===t&&(this.log(`Removing level ${i} for ${e.details} ("${t}" not supported)`),this.hls.removeLevel(i))}}}function e2(e){let t={action:eZ.DoNothing,flags:e0.None};return e&&(t.resolved=!0),t}var e3={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class e4{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){let{hls:e}=this;e&&(e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.BUFFER_APPENDED,this.onBufferAppended,this),e.on(u.FRAG_BUFFERED,this.onFragBuffered,this),e.on(u.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){let{hls:e}=this;e&&(e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.BUFFER_APPENDED,this.onBufferAppended,this),e.off(u.FRAG_BUFFERED,this.onFragBuffered,this),e.off(u.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){let r=this.activePartLists[t];if(r)for(let t=r.length;t--;){let i=r[t];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){let{fragments:i}=this,n=Object.keys(i);for(let a=n.length;a--;){let s=i[n[a]];if((null==s?void 0:s.body.type)===t&&(!r||s.buffered)){let t=s.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,r,i,n){this.timeRanges&&(this.timeRanges[e]=t);let a=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(i=>{let s=this.fragments[i];if(!s||a>=s.body.sn)return;if(!s.buffered&&(!s.loaded||n)){s.body.type===r&&this.removeFragment(s.body);return}let o=s.range[e];if(o){if(0===o.time.length){this.removeFragment(s.body);return}o.time.some(e=>{let r=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&this.removeFragment(s.body),r})}})}detectPartialFragments(e){let t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;let r=e.frag,i=e6(r),n=this.fragments[i];if(!n||n.buffered&&r.gap)return;let a=!r.relurl;Object.keys(t).forEach(i=>{let s=r.elementaryStreams[i];if(!s)return;let o=t[i],l=a||!0===s.partial;n.range[i]=this.getBufferedTimes(r,e.part,l,o)}),n.loaded=null,Object.keys(n.range).length?(n.buffered=!0,(n.body.endList=r.endList||n.body.endList)&&(this.endListFragments[n.body.type]=n),e5(n)||this.removeParts(r.sn-1,r.type)):this.removeFragment(n.body)}removeParts(e,t){let r=this.activePartLists[t];r&&(this.activePartLists[t]=e8(r,t=>t.fragment.sn>=e))}fragBuffered(e,t){let r=e6(e),i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,r,i){let n={time:[],partial:r},a=e.start,s=e.end,o=e.minEndPTS||s,l=e.maxStartPTS||a;for(let e=0;e<i.length;e++){let t=i.start(e)-this.bufferPadding,r=i.end(e)+this.bufferPadding;if(l>=t&&o<=r){n.time.push({startPTS:Math.max(a,i.start(e)),endPTS:Math.min(s,i.end(e))});break}if(a<r&&s>t){let t=Math.max(a,i.start(e)),r=Math.min(s,i.end(e));r>t&&(n.partial=!0,n.time.push({startPTS:t,endPTS:r}))}else if(s<=t)break}return n}getPartialFragment(e){let t,r,i,n=null,a=0,{bufferPadding:s,fragments:o}=this;return Object.keys(o).forEach(l=>{let u=o[l];u&&e5(u)&&(r=u.body.start-s,i=u.body.end+s,e>=r&&e<=i&&a<=(t=Math.min(e-r,i-e))&&(n=u.body,a=t))}),n}isEndListAppended(e){let t=this.endListFragments[e];return void 0!==t&&(t.buffered||e5(t))}getState(e){let t=e6(e),r=this.fragments[t];return r?r.buffered?e5(r)?e3.PARTIAL:e3.OK:e3.APPENDING:e3.NOT_LOADED}isTimeBuffered(e,t,r){let i,n;for(let a=0;a<r.length;a++){if(i=r.start(a)-this.bufferPadding,n=r.end(a)+this.bufferPadding,e>=i&&t<=n)return!0;if(t<=i)break}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;let r=t.frag,i=t.part?null:t,n=e6(r);this.fragments[n]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){let{frag:r,part:i,timeRanges:n,type:a}=t;if("initSegment"===r.sn)return;let s=r.type;if(i){let e=this.activePartLists[s];e||(this.activePartLists[s]=e=[]),e.push(i)}this.timeRanges=n;let o=n[a];this.detectEvictedFragments(a,o,s,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){let t=e6(e);return!!this.fragments[t]}hasFragments(e){let{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let i=r.length;i--;){let n=t[r[i]];if((null==n?void 0:n.body.type)===e)return!0}return!1}hasParts(e){var t;return!!(null!=(t=this.activePartLists[e])&&t.length)}removeFragmentsInRange(e,t,r,i,n){(!i||this.hasGaps)&&Object.keys(this.fragments).forEach(a=>{let s=this.fragments[a];if(!s)return;let o=s.body;o.type===r&&(!i||o.gap)&&o.start<t&&o.end>e&&(s.buffered||n)&&this.removeFragment(o)})}removeFragment(e){let t=e6(e);e.clearElementaryStreamInfo();let r=this.activePartLists[e.type];if(r){let t=e.sn;this.activePartLists[e.type]=e8(r,e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;let t=null==(e=this.hls)||null==(e=e.latestLevelDetails)?void 0:e.partList;t&&t.forEach(e=>e.clearElementaryStreamInfo())}}function e5(e){var t,r,i;return e.buffered&&!!(e.body.gap||null!=(t=e.range.video)&&t.partial||null!=(r=e.range.audio)&&r.partial||null!=(i=e.range.audiovideo)&&i.partial)}function e6(e){return`${e.type}_${e.level}_${e.sn}`}function e8(e,t){return e.filter(e=>{let r=t(e);return r||e.clearElementaryStreamInfo(),r})}var e9={cbc:0,ctr:1};class e7{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case e9.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case e9.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}class te{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){let t=new DataView(e),r=new Uint32Array(4);for(let e=0;e<4;e++)r[e]=t.getUint32(4*e);return r}initTable(){let e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],n=r[1],a=r[2],s=r[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],h=o[3],d=new Uint32Array(256),f=0,p=0,m=0;for(m=0;m<256;m++)m<128?d[m]=m<<1:d[m]=m<<1^283;for(m=0;m<256;m++){let r=p^p<<1^p<<2^p<<3^p<<4;r=r>>>8^255&r^99,e[f]=r,t[r]=f;let o=d[f],m=d[o],g=d[m],A=257*d[r]^0x1010100*r;i[f]=A<<24|A>>>8,n[f]=A<<16|A>>>16,a[f]=A<<8|A>>>24,s[f]=A,A=0x1010101*g^65537*m^257*o^0x1010100*f,l[r]=A<<24|A>>>8,u[r]=A<<16|A>>>16,c[r]=A<<8|A>>>24,h[r]=A,f?(f=o^d[d[d[g^o]]],p^=d[d[p]]):f=p=1}}expandKey(e){let t,r,i,n;let a=this.uint8ArrayToUint32Array_(e),s=!0,o=0;for(;o<a.length&&s;)s=a[o]===this.key[o],o++;if(s)return;this.key=a;let l=this.keySize=a.length;if(4!==l&&6!==l&&8!==l)throw Error("Invalid aes key size="+l);let u=this.ksRows=(l+6+1)*4,c=this.keySchedule=new Uint32Array(u),h=this.invKeySchedule=new Uint32Array(u),d=this.sBox,f=this.rcon,p=this.invSubMix,m=p[0],g=p[1],A=p[2],v=p[3];for(t=0;t<u;t++){if(t<l){i=c[t]=a[t];continue}n=i,t%l==0?n=(d[(n=n<<8|n>>>24)>>>24]<<24|d[n>>>16&255]<<16|d[n>>>8&255]<<8|d[255&n])^f[t/l|0]<<24:l>6&&t%l==4&&(n=d[n>>>24]<<24|d[n>>>16&255]<<16|d[n>>>8&255]<<8|d[255&n]),c[t]=i=(c[t-l]^n)>>>0}for(r=0;r<u;r++)t=u-r,n=3&r?c[t]:c[t-4],r<4||t<=4?h[r]=n:h[r]=m[d[n>>>24]]^g[d[n>>>16&255]]^A[d[n>>>8&255]]^v[d[255&n]],h[r]=h[r]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(0xff0000&e)>>8|e>>>24}decrypt(e,t,r){let i,n,a,s,o,l,u,c,h,d,f,p,m,g;let A=this.keySize+6,v=this.invKeySchedule,y=this.invSBox,E=this.invSubMix,x=E[0],_=E[1],b=E[2],S=E[3],w=this.uint8ArrayToUint32Array_(r),C=w[0],T=w[1],I=w[2],M=w[3],R=new Int32Array(e),B=new Int32Array(R.length),D=this.networkToHostOrderSwap;for(;t<R.length;){for(g=1,h=D(R[t]),d=D(R[t+1]),f=D(R[t+2]),p=D(R[t+3]),o=h^v[0],l=p^v[1],u=f^v[2],c=d^v[3],m=4;g<A;g++)i=x[o>>>24]^_[l>>16&255]^b[u>>8&255]^S[255&c]^v[m],n=x[l>>>24]^_[u>>16&255]^b[c>>8&255]^S[255&o]^v[m+1],a=x[u>>>24]^_[c>>16&255]^b[o>>8&255]^S[255&l]^v[m+2],s=x[c>>>24]^_[o>>16&255]^b[l>>8&255]^S[255&u]^v[m+3],o=i,l=n,u=a,c=s,m+=4;i=y[o>>>24]<<24^y[l>>16&255]<<16^y[u>>8&255]<<8^y[255&c]^v[m],n=y[l>>>24]<<24^y[u>>16&255]<<16^y[c>>8&255]<<8^y[255&o]^v[m+1],a=y[u>>>24]<<24^y[c>>16&255]<<16^y[o>>8&255]<<8^y[255&l]^v[m+2],s=y[c>>>24]<<24^y[o>>16&255]<<16^y[l>>8&255]<<8^y[255&u]^v[m+3],B[t]=D(i^C),B[t+1]=D(s^T),B[t+2]=D(a^I),B[t+3]=D(n^M),C=h,T=d,I=f,M=p,t+=4}return B.buffer}}class tt{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){let e=function(e){switch(e){case e9.cbc:return"AES-CBC";case e9.ctr:return"AES-CTR";default:throw Error(`[FastAESKey] invalid aes mode ${e}`)}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class tr{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{let e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){let{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;let r=new Uint8Array(e);return(this.reset(),this.removePKCS7Padding)?function(e){let t=e.byteLength,r=t&&new DataView(e.buffer).getUint8(t-1);return r?e.slice(0,t-r):e}(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,i){return this.useSoftware?new Promise((n,a)=>{let s=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(s,t,r,i);let o=this.flush();o?n(o.buffer):a(Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,i)}softwareDecrypt(e,t,r,i){let{currentIV:n,currentResult:a,remainderData:s}=this;if(i!==e9.cbc||16!==t.byteLength)return S.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),s&&(e=J(s,e),this.remainderData=null);let o=this.getValidChunk(e);if(!o.length)return null;n&&(r=n);let l=this.softwareDecrypter;return(l||(l=this.softwareDecrypter=new te),l.expandKey(t),this.currentResult=l.decrypt(o.buffer,0,r),this.currentIV=o.slice(-16).buffer,a)?a:null}webCryptoDecrypt(e,t,r,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,i));this.key=t,this.fastAesKey=new tt(this.subtle,t,i)}return this.fastAesKey.expandKey().then(t=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new e7(this.subtle,new Uint8Array(r),i).decrypt(e.buffer,t)):Promise.reject(Error("web crypto not initialized"))).catch(n=>(S.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,t,r,i)))}onWebCryptoError(e,t,r,i){let n=this.enableSoftwareAES;if(n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,i);let n=this.flush();if(n)return n.buffer}throw Error("WebCrypto"+(n?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e,r=e.length-e.length%16;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(S.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}class ti{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){let r=e.url;if(!r)return Promise.reject(new ts({type:o.NETWORK_ERROR,details:l.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();let i=this.config,n=i.fLoader,a=i.loader;return new Promise((s,u)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0])){u(ta(e));return}e.gap=!1}let c=this.loader=n?new n(i):new a(i),h=tn(e);e.loader=c;let d=eX(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:131072};e.stats=c.stats;let p={onSuccess:(t,r,i,n)=>{this.resetLoader(e,c);let a=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(a.slice(0,16)),a=a.slice(16)),s({frag:e,part:null,payload:a,networkDetails:n})},onError:(t,i,n,a)=>{this.resetLoader(e,c),u(new ts({type:o.NETWORK_ERROR,details:l.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:v({url:r,data:void 0},t),error:Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:n,stats:a}))},onAbort:(t,r,i)=>{this.resetLoader(e,c),u(new ts({type:o.NETWORK_ERROR,details:l.INTERNAL_ABORTED,fatal:!1,frag:e,error:Error("Aborted"),networkDetails:i,stats:t}))},onTimeout:(t,r,i)=>{this.resetLoader(e,c),u(new ts({type:o.NETWORK_ERROR,details:l.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:Error(`Timeout after ${f.timeout}ms`),networkDetails:i,stats:t}))}};t&&(p.onProgress=(r,i,n,a)=>t({frag:e,part:null,payload:n,networkDetails:a})),c.load(h,f,p)})}loadPart(e,t,r){this.abort();let i=this.config,n=i.fLoader,a=i.loader;return new Promise((s,u)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){u(ta(e,t));return}let c=this.loader=n?new n(i):new a(i),h=tn(e,t);e.loader=c;let d=eX(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:131072};t.stats=c.stats,c.load(h,f,{onSuccess:(i,n,a,o)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);let l={frag:e,part:t,payload:i.data,networkDetails:o};r(l),s(l)},onError:(r,i,n,a)=>{this.resetLoader(e,c),u(new ts({type:o.NETWORK_ERROR,details:l.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:v({url:h.url,data:void 0},r),error:Error(`HTTP Error ${r.code} ${r.text}`),networkDetails:n,stats:a}))},onAbort:(r,i,n)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),u(new ts({type:o.NETWORK_ERROR,details:l.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:Error("Aborted"),networkDetails:n,stats:r}))},onTimeout:(r,i,n)=>{this.resetLoader(e,c),u(new ts({type:o.NETWORK_ERROR,details:l.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:Error(`Timeout after ${f.timeout}ms`),networkDetails:n,stats:r}))}})})}updateStatsFromPart(e,t){let r=e.stats,i=t.stats,n=i.total;if(r.loaded+=i.loaded,n){let i=Math.round(e.duration/t.duration),a=Math.min(Math.round(r.loaded/n),i),s=(i-a)*Math.round(r.loaded/a);r.total=r.loaded+s}else r.total=Math.max(r.loaded,r.total);let a=r.loading,s=i.loading;a.start?a.first+=s.first-s.start:(a.start=s.start,a.first=s.first),a.end=s.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function tn(e,t=null){let r=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},a=r.byteRangeStartOffset,s=r.byteRangeEndOffset;if(n(a)&&n(s)){var o,l;let t=a,r=s;if("initSegment"===e.sn&&("AES-128"===(l=null==(o=e.decryptdata)?void 0:o.method)||"AES-256"===l)){let e=s-a;e%16&&(r=s+(16-e%16)),0!==a&&(i.resetIV=!0,t=a-16)}i.rangeStart=t,i.rangeEnd=r}return i}function ta(e,t){let r=Error(`GAP ${e.gap?"tag":"attribute"} found`),i={type:o.MEDIA_ERROR,details:l.FRAG_GAP,fatal:!1,frag:e,error:r,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new ts(i)}class ts extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class to extends y{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class tl{constructor(e,t,r,i=0,n=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=tu(),this.buffering={audio:tu(),video:tu(),audiovideo:tu()},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=n,this.partial=a}}function tu(){return{start:0,executeStart:0,executeEnd:0,end:0}}let tc={length:0,start:()=>0,end:()=>0};class th{static isBuffered(e,t){if(e){let r=th.getBuffered(e);for(let e=r.length;e--;)if(t>=r.start(e)&&t<=r.end(e))return!0}return!1}static bufferedRanges(e){if(e){let t=th.getBuffered(e);return th.timeRangesToArray(t)}return[]}static timeRangesToArray(e){let t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){let i=th.bufferedRanges(e);if(i.length)return th.bufferedInfo(i,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){let i;t=Math.max(0,t),e.length>1&&e.sort((e,t)=>e.start-t.start||t.end-e.end);let n=-1,a=[];if(r)for(let i=0;i<e.length;i++){t>=e[i].start&&t<=e[i].end&&(n=i);let s=a.length;if(s){let t=a[s-1].end;e[i].start-t<r?e[i].end>t&&(a[s-1].end=e[i].end):a.push(e[i])}else a.push(e[i])}else a=e;let s=0,o=t,l=t;for(let e=0;e<a.length;e++){let u=a[e].start,c=a[e].end;if(-1===n&&t>=u&&t<=c&&(n=e),t+r>=u&&t<c)o=u,s=(l=c)-t;else if(t+r<u){i=u;break}}return{len:s,start:o||0,end:l||0,nextStart:i,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||tc}catch(e){return S.log("failed to get media.buffered",e),tc}}}let td=/\{\$([a-zA-Z0-9-_]+)\}/g;function tf(e,t){if(null!==e.variableList||e.hasVariableRefs){let r=e.variableList;return t.replace(td,t=>{let i=t.substring(2,t.length-1),n=null==r?void 0:r[i];return void 0===n?(e.playlistParsingError||(e.playlistParsingError=Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),t):n})}return t}function tp(e,t,r){let i,n,a=e.variableList;if(a||(e.variableList=a={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{let e=new self.URL(r).searchParams;if(e.has(i))n=e.get(i);else throw Error(`"${i}" does not match any query parameter in URI: "${r}"`)}catch(t){e.playlistParsingError||(e.playlistParsingError=Error(`EXT-X-DEFINE QUERYPARAM: ${t.message}`))}}else i=t.NAME,n=t.VALUE;i in a?e.playlistParsingError||(e.playlistParsingError=Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):a[i]=n||""}let tm=/^(\d+)x(\d+)$/,tg=/(.+?)=(".*?"|.*?)(?:,|$)/g;class tA{constructor(e,t){"string"==typeof e&&(e=tA.parseAttrList(e,t)),g(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){let t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2),r=new Uint8Array((t=(1&t.length?"0":"")+t).length/2);for(let e=0;e<t.length/2;e++)r[e]=parseInt(t.slice(2*e,2*e+2),16);return r}return null}hexadecimalIntegerAsNumber(e){let t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){let r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){let r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((e,t)=>(e[t.toLowerCase()]=!0,e),t)}bool(e){return"YES"===this[e]}decimalResolution(e){let t=tm.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;let i={};for(tg.lastIndex=0;null!==(r=tg.exec(e));){let n=r[1].trim(),a=r[2],s=0===a.indexOf('"')&&a.lastIndexOf('"')===a.length-1,o=!1;if(s)a=a.slice(1,-1);else switch(n){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(s||o))a=tf(t,a);else if(!o&&!s)switch(n){case"CLOSED-CAPTIONS":if("NONE"===a)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":S.warn(`${e}: attribute ${n} is missing quotes`)}i[n]=a}return i}}class tv{constructor(e,t,r=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(i=null==t?void 0:t.tagOrder)?i:r,t){let r=t.attr;for(let t in r)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==r[t]){S.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=g(new tA({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){let e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);n(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){let e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){let{tagAnchor:e}=this;return null===e||null===e.programDateTime?(S.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){let e=this._endDate||this._dateAtEnd;if(e)return e;let t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){let e=this.attr.decimalFloatingPoint("DURATION");if(n(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&n(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class ty{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}let t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return!!this.fragments.length&&n(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){let e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){let e=this.partList;if(e){let t=this.lastPartIndex;if(-1!==t){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){let e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function tE(e,t){return e.length===t.length&&!e.some((e,r)=>e!==t[r])}function tx(e,t){return!e&&!t||!!e&&!!t&&tE(e,t)}function t_(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function tb(e){switch(e){case"AES-128":case"AES-256":return e9.cbc;case"AES-256-CTR":return e9.ctr;default:throw Error(`invalid full segment method ${e}`)}}function tS(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function tw(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}function tC(e){let t=function(e,t,r){let i=e[t];e[t]=e[r],e[r]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}let tT="undefined"!=typeof self?self:void 0;var tI={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},tM={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function tR(e){switch(e){case tM.FAIRPLAY:return tI.FAIRPLAY;case tM.PLAYREADY:return tI.PLAYREADY;case tM.WIDEVINE:return tI.WIDEVINE;case tM.CLEARKEY:return tI.CLEARKEY}}function tB(e){switch(e){case tI.FAIRPLAY:return tM.FAIRPLAY;case tI.PLAYREADY:return tM.PLAYREADY;case tI.WIDEVINE:return tM.WIDEVINE;case tI.CLEARKEY:return tM.CLEARKEY}}function tD(e){let{drmSystems:t,widevineLicenseUrl:r}=e,i=t?[tI.FAIRPLAY,tI.WIDEVINE,tI.PLAYREADY,tI.CLEARKEY].filter(e=>!!t[e]):[];return!i[tI.WIDEVINE]&&r&&i.push(tI.WIDEVINE),i}let tP=function(e){return null!=tT&&null!=(e=tT.navigator)&&e.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}(),tL={};class tk{static clearKeyUriToKeyIdMap(){tL={}}static setKeyIdForUri(e,t){tL[e]=t}constructor(e,t,r,i=[1],n=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=n,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!t_(e),null!=a&&a.startsWith("0x")&&(this.keyId=new Uint8Array(M(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&tE(e.keyFormatVersions,this.keyFormatVersions)&&tx(e.iv,this.iv)&&tx(e.keyId,this.keyId)}isSupported(){if(this.method){if(t_(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case tM.FAIRPLAY:case tM.WIDEVINE:case tM.PLAYREADY:case tM.CLEARKEY:return -1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(t_(this.method)){let t=this.iv;return t||("number"!=typeof e&&(S.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),t=function(e){let t=new Uint8Array(16);for(let r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}(e)),new tk(this.method,this.uri,"identity",this.keyFormatVersions,t)}if(this.pssh&&this.keyId)return this;let t=function(e){let t=e.split(":"),r=null;if("data"===t[0]&&2===t.length){let e=t[1].split(";"),i=e[e.length-1].split(",");if(2===i.length){let t="base64"===i[0],n=i[1];t?(e.splice(-1,1),r=tS(n)):r=function(e){let t=tw(e).subarray(0,16),r=new Uint8Array(16);return r.set(t,16-t.length),r}(n)}}return r}(this.uri);if(t)switch(this.keyFormat){case tM.WIDEVINE:if(this.pssh=t,!this.keyId){let e=function(e){let t=[];if(e instanceof ArrayBuffer){let r=e.byteLength,i=0;for(;i+32<r;){let r=function(e){let t=e.getUint32(0),r=e.byteOffset,i=e.byteLength;if(i<t)return{offset:r,size:i};if(0x70737368!==e.getUint32(4))return{offset:r,size:t};let n=e.getUint32(8)>>>24;if(0!==n&&1!==n)return{offset:r,size:t};let a=e.buffer,s=I(new Uint8Array(a,r+12,16)),o=null,l=0;if(0===n)l=28;else{let n=e.getUint32(28);if(!n||i<32+16*n)return{offset:r,size:t};o=[];for(let e=0;e<n;e++)o.push(new Uint8Array(a,r+32+16*e,16));l=32+16*n}if(!l)return{offset:r,size:t};let u=e.getUint32(l);return t-32<u?{offset:r,size:t}:{version:n,systemId:s,kids:o,data:new Uint8Array(a,r+l+4,u),offset:r,size:t}}(new DataView(e,i));t.push(r),i+=r.size}}return t}(t.buffer);if(e.length){var r;let t=e[0];this.keyId=null!=(r=t.kids)&&r.length?t.kids[0]:null}}if(!this.keyId){let e=t.length-22;this.keyId=t.subarray(e,e+16)}break;case tM.PLAYREADY:{let e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(e,t,r){let i,n;if(16!==e.byteLength)throw RangeError("Invalid system id");i=new Uint8Array,n=new Uint8Array;let a=new Uint8Array(4);return r.byteLength>0&&new DataView(a.buffer).setUint32(0,r.byteLength,!1),function(e,...t){let r=t.length,i=8,n=r;for(;n--;)i+=t[n].byteLength;let a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4),n=0,i=8;n<r;n++)a.set(t[n],i),i+=t[n].byteLength;return a}([112,115,115,104],new Uint8Array([0,0,0,0]),e,n,i,a,r)}(e,0,t),this.keyId=function(e){let t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),r=String.fromCharCode.apply(null,Array.from(t)),i=r.substring(r.indexOf("<"),r.length),n=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(n){let e=n.childNodes[0]?n.childNodes[0].nodeValue:n.getAttribute("VALUE");if(e){let t=tS(e).subarray(0,16);return tC(t),t}}return null}(t);break}default:{let e=t.subarray(0,16);if(16!==e.length){let t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e}}if(!this.keyId||16!==this.keyId.byteLength){let e=tL[this.uri];if(!e){let t=Object.keys(tL).length%Number.MAX_SAFE_INTEGER;new DataView((e=new Uint8Array(16)).buffer,12,4).setUint32(0,t),tk.setKeyIdForUri(this.uri,e)}this.keyId=e}return this}}let tF=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,tO=/#EXT-X-MEDIA:(.*)/g,tU=/^#EXT(?:INF|-X-TARGETDURATION):/m,tN=RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),tz=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class tG{static findGroup(e,t){for(let r=0;r<e.length;r++){let i=e[r];if(i.id===t)return i}}static resolve(e,t){return B.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return tU.test(e)}static parseMasterPlaylist(e,t){var r;let i;let n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:td.test(e)},a=[];if(tF.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=Error("no EXTM3U delimiter"),n;for(;null!=(i=tF.exec(e));)if(i[1]){let e=new tA(i[1],n),s=tf(n,i[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:tG.resolve(s,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),tW(e.CODECS,o);let u=e["SUPPLEMENTAL-CODECS"];u&&(o.supplemental={},tW(u,o.supplemental)),null!=(r=o.unknownCodecs)&&r.length||a.push(o),n.levels.push(o)}else if(i[3]){let e=i[3],r=i[4];switch(e){case"SESSION-DATA":{let e=new tA(r,n),t=e["DATA-ID"];t&&(null===n.sessionData&&(n.sessionData={}),n.sessionData[t]=e);break}case"SESSION-KEY":{let e=tQ(r,t,n);e.encrypted&&e.isSupported()?(null===n.sessionKeys&&(n.sessionKeys=[]),n.sessionKeys.push(e)):S.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${r}"`);break}case"DEFINE":{let e=new tA(r,n);tp(n,e,t)}break;case"CONTENT-STEERING":{let e=new tA(r,n);n.contentSteering={uri:tG.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":n.startTimeOffset=tV(r)}}let s=a.length>0&&a.length<n.levels.length;return n.levels=s?a:n.levels,0===n.levels.length&&(n.playlistParsingError=Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,r){let i;let n={},a=r.levels,s={AUDIO:a.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:a.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]},o=0;for(tO.lastIndex=0;null!==(i=tO.exec(e));){let e=new tA(i[1],r),a=e.TYPE;if(a){let r=s[a],i=n[a]||[];n[a]=i;let l=e.LANGUAGE,u=e["ASSOC-LANGUAGE"],c=e.CHANNELS,h=e.CHARACTERISTICS,d=e["INSTREAM-ID"],f={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:a,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?tG.resolve(e.URI,t):""};if(u&&(f.assocLang=u),c&&(f.channels=c),h&&(f.characteristics=h),d&&(f.instreamId=d),null!=r&&r.length){let e=tG.findGroup(r,f.groupId)||r[0];tj(f,e,"audioCodec"),tj(f,e,"textCodec")}i.push(f)}}return n}static parseLevelPlaylist(e,t,r,i,a,s){var o;let l,u,c,h;let d={url:t},f=new ty(t),p=f.fragments,m=[],A=null,v=0,y=0,E=0,x=0,_=0,b=null,w=new F(i,d),C=-1,T=!1,I=null;if(tN.lastIndex=0,f.m3u8=e,f.hasVariableRefs=td.test(e),(null==(o=tN.exec(e))?void 0:o[0])!=="#EXTM3U")return f.playlistParsingError=Error("Missing format identifier #EXTM3U"),f;for(;null!==(l=tN.exec(e));){T&&(T=!1,(w=new F(i,d)).playlistOffset=E,w.setStart(E),w.sn=v,w.cc=x,_&&(w.bitrate=_),w.level=r,A&&(w.initSegment=A,A.rawProgramDateTime&&(w.rawProgramDateTime=A.rawProgramDateTime,A.rawProgramDateTime=null),I&&(w.setByteRange(I),I=null)));let e=l[1];if(e){w.duration=parseFloat(e);let t=(" "+l[2]).slice(1);w.title=t||null,w.tagList.push(t?["INF",e,t]:["INF",e])}else if(l[3]){if(n(w.duration)){w.playlistOffset=E,w.setStart(E),c&&tq(w,c,f),w.sn=v,w.level=r,w.cc=x,p.push(w);let e=(" "+l[3]).slice(1);w.relurl=tf(f,e),tY(w,b,m),b=w,E+=w.duration,v++,y=0,T=!0}}else{if(!(l=l[0].match(tz))){S.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<l.length&&void 0===l[u];u++);let e=(" "+l[u]).slice(1),a=(" "+l[u+1]).slice(1),o=l[u+2]?(" "+l[u+2]).slice(1):null;switch(e){case"BYTERANGE":b?w.setByteRange(a,b):w.setByteRange(a);break;case"PROGRAM-DATE-TIME":w.rawProgramDateTime=a,w.tagList.push(["PROGRAM-DATE-TIME",a]),-1===C&&(C=p.length);break;case"PLAYLIST-TYPE":f.type&&tX(f,e,l),f.type=a.toUpperCase();break;case"MEDIA-SEQUENCE":0!==f.startSN?tX(f,e,l):p.length>0&&t$(f,e,l),v=f.startSN=parseInt(a);break;case"SKIP":{f.skippedSegments&&tX(f,e,l);let t=new tA(a,f),r=t.decimalInteger("SKIPPED-SEGMENTS");if(n(r)){f.skippedSegments+=r;for(let e=r;e--;)p.push(null);v+=r}let i=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");i&&(f.recentlyRemovedDateranges=(f.recentlyRemovedDateranges||[]).concat(i.split("	")));break}case"TARGETDURATION":0!==f.targetduration&&tX(f,e,l),f.targetduration=Math.max(parseInt(a),1);break;case"VERSION":null!==f.version&&tX(f,e,l),f.version=parseInt(a);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":f.live||tX(f,e,l),f.live=!1;break;case"#":(a||o)&&w.tagList.push(o?[a,o]:[a]);break;case"DISCONTINUITY":x++,w.tagList.push(["DIS"]);break;case"GAP":w.gap=!0,w.tagList.push([e]);break;case"BITRATE":w.tagList.push([e,a]),n(_=1e3*parseInt(a))?w.bitrate=_:_=0;break;case"DATERANGE":{let e=new tA(a,f),t=new tv(e,f.dateRanges[e.ID],f.dateRangeTagCount);f.dateRangeTagCount++,t.isValid||f.skippedSegments?f.dateRanges[t.id]=t:S.warn(`Ignoring invalid DATERANGE tag: "${a}"`),w.tagList.push(["EXT-X-DATERANGE",a]);break}case"DEFINE":{let e=new tA(a,f);"IMPORT"in e?function(e,t,r){let i=t.IMPORT;if(r&&i in r){let t=e.variableList;t||(e.variableList=t={}),t[i]=r[i]}else e.playlistParsingError||(e.playlistParsingError=Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}(f,e,s):tp(f,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==f.startCC?tX(f,e,l):p.length>0&&t$(f,e,l),f.startCC=x=parseInt(a);break;case"KEY":{let e=tQ(a,t,f);if(e.isSupported()){if("NONE"===e.method){c=void 0;break}c||(c={});let t=c[e.keyFormat];null!=t&&t.matches(e)||(t&&(c=g({},c)),c[e.keyFormat]=e)}else S.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${a}"`);break}case"START":f.startTimeOffset=tV(a);break;case"MAP":{let e=new tA(a,f);if(w.duration){let t=new F(i,d);tK(t,e,r,c),A=t,w.initSegment=A,A.rawProgramDateTime&&!w.rawProgramDateTime&&(w.rawProgramDateTime=A.rawProgramDateTime)}else{let t=w.byteRangeEndOffset;if(t){let e=w.byteRangeStartOffset;I=`${t-e}@${e}`}else I=null;tK(w,e,r,c),A=w,T=!0}A.cc=x;break}case"SERVER-CONTROL":h&&tX(f,e,l),h=new tA(a),f.canBlockReload=h.bool("CAN-BLOCK-RELOAD"),f.canSkipUntil=h.optionalFloat("CAN-SKIP-UNTIL",0),f.canSkipDateRanges=f.canSkipUntil>0&&h.bool("CAN-SKIP-DATERANGES"),f.partHoldBack=h.optionalFloat("PART-HOLD-BACK",0),f.holdBack=h.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{f.partTarget&&tX(f,e,l);let t=new tA(a);f.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=f.partList;e||(e=f.partList=[]);let t=y>0?e[e.length-1]:void 0,r=y++,i=new O(new tA(a,f),w,d,r,t);e.push(i),w.duration+=i.duration;break}case"PRELOAD-HINT":{let e=new tA(a,f);f.preloadHint=e;break}case"RENDITION-REPORT":{let e=new tA(a,f);f.renditionReports=f.renditionReports||[],f.renditionReports.push(e);break}default:S.warn(`line parsed but not handled: ${l}`)}}}b&&!b.relurl?(p.pop(),E-=b.duration,f.partList&&(f.fragmentHint=b)):f.partList&&(tY(w,b,m),w.cc=x,f.fragmentHint=w,c&&tq(w,c,f)),f.targetduration||(f.playlistParsingError=Error("Missing Target Duration"));let M=p.length,R=p[0],B=p[M-1];if((E+=f.skippedSegments*f.targetduration)>0&&M&&B){f.averagetargetduration=E/M;let e=B.sn;f.endSN="initSegment"!==e?e:0,f.live||(B.endList=!0),C>0&&(function(e,t){let r=e[t];for(let i=t;i--;){let t=e[i];if(!t)return;t.programDateTime=r.programDateTime-1e3*t.duration,r=t}}(p,C),R&&m.unshift(R))}return f.fragmentHint&&(E+=f.fragmentHint.duration),f.totalduration=E,m.length&&f.dateRangeTagCount&&R&&tH(m,f),f.endCC=x,f}}function tH(e,t){let r=e.length;if(!r){if(!t.hasProgramDateTime)return;{let i=t.fragments[t.fragments.length-1];e.push(i),r++}}let i=e[r-1],n=t.live?1/0:t.totalduration,a=Object.keys(t.dateRanges);for(let o=a.length;o--;){let l=t.dateRanges[a[o]],u=l.startDate.getTime();l.tagAnchor=i.ref;for(let i=r;i--;){var s;if((null==(s=e[i])?void 0:s.sn)<t.startSN)break;let r=function(e,t,r,i,n){let a=r[i];if(a){let o=a.programDateTime;if(t>=o||0===i){var s;if(t<=o+1e3*(((null==(s=r[i+1])?void 0:s.start)||n)-a.start)){let n=r[i].sn-e.startSN;if(n<0)return -1;let a=e.fragments;if(a.length>r.length){let s=(r[i+1]||a[a.length-1]).sn-e.startSN;for(let e=s;e>n;e--){let r=a[e].programDateTime;if(t>=r&&t<r+1e3*a[e].duration)return e}}return n}}}return -1}(t,u,e,i,n);if(-1!==r){l.tagAnchor=t.fragments[r].ref;break}}}}function tQ(e,t,r){var i,n;let a=new tA(e,r),s=null!=(i=a.METHOD)?i:"",o=a.URI,l=a.hexadecimalInteger("IV"),u=a.KEYFORMATVERSIONS,c=null!=(n=a.KEYFORMAT)?n:"identity";return o&&a.IV&&!l&&S.error(`Invalid IV: ${a.IV}`),new tk(s,o?tG.resolve(o,t):"",c,(u||"1").split("/").map(Number).filter(Number.isFinite),l,a.KEYID)}function tV(e){let t=new tA(e).decimalFloatingPoint("TIME-OFFSET");return n(t)?t:null}function tW(e,t){let r=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{let i=r.filter(t=>ea(t,e));i.length&&(t[`${e}Codec`]=i.map(e=>e.split("/")[0]).join(","),r=r.filter(e=>-1===i.indexOf(e)))}),t.unknownCodecs=r}function tj(e,t,r){let i=t[r];i&&(e[r]=i)}function tY(e,t,r){e.rawProgramDateTime?r.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function tK(e,t,r,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=r,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function tq(e,t,r){e.levelkeys=t;let{encryptedFragments:i}=r;(!i.length||i[i.length-1].levelkeys!==t)&&Object.keys(t).some(e=>t[e].isCommonEncryption)&&i.push(e)}function tX(e,t,r){e.playlistParsingError=Error(`#EXT-X-${t} must not appear more than once (${r[0]})`)}function t$(e,t,r){e.playlistParsingError=Error(`#EXT-X-${t} must appear before the first Media Segment (${r[0]})`)}function tJ(e,t){let r=t.startPTS;if(n(r)){let i,n=0;t.sn>e.sn?(n=r-e.start,i=e):(n=e.start-r,i=t),i.duration!==n&&i.setDuration(n)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration):t.setStart(Math.max(e.start-t.duration,0))}function tZ(e,t,r,i,a,s,o){let l;i-r<=0&&(o.warn("Fragment should have a positive duration",t),i=r+t.duration,s=a+t.duration);let u=r,c=i,h=t.startPTS,d=t.endPTS;if(n(h)){let l=Math.abs(h-r);e&&l>e.totalduration?o.warn(`media timestamps and playlist times differ by ${l}s for level ${t.level} ${e.url}`):n(t.deltaPTS)?t.deltaPTS=Math.max(l,t.deltaPTS):t.deltaPTS=l,u=Math.max(r,h),r=Math.min(r,h),a=void 0!==t.startDTS?Math.min(a,t.startDTS):a,c=Math.min(i,d),i=Math.max(i,d),s=void 0!==t.endDTS?Math.max(s,t.endDTS):s}let f=r-t.start;0!==t.start&&t.setStart(r),t.setDuration(i-t.start),t.startPTS=r,t.maxStartPTS=u,t.startDTS=a,t.endPTS=i,t.minEndPTS=c,t.endDTS=s;let p=t.sn;if(!e||p<e.startSN||p>e.endSN)return 0;let m=p-e.startSN,g=e.fragments;for(g[m]=t,l=m;l>0;l--)tJ(g[l],g[l-1]);for(l=m;l<g.length-1;l++)tJ(g[l],g[l+1]);return e.fragmentHint&&tJ(g[g.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,f}function t0(e,t,r,i,n){return Error(`${e} ${n.url}
Playlist starting @${t.startSN}
${t.m3u8}

Playlist starting @${r.startSN}
${r.m3u8}`)}function t1(e,t,r=!0){let i=t.startSN+t.skippedSegments-e.startSN,n=e.fragments,a=i>=0,s=0;if(a&&i<n.length)s=n[i].start;else if(a&&t.startSN===e.endSN+1)s=e.fragmentEnd;else if(a&&r)s=e.fragmentStart+i*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;s=e.fragmentStart}t2(t,s)}function t2(e,t){if(t){let r=e.fragments;for(let i=e.skippedSegments;i<r.length;i++)r[i].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function t3(e,t=1/0){let r=1e3*e.targetduration;if(e.updated){let i=e.fragments;if(i.length&&4*r>t){let e=1e3*i[i.length-1].duration;e<r&&(r=e)}}else r/=2;return Math.round(r)}function t4(e,t,r){if(!e)return null;let i=e.fragments[t-e.startSN];return i||(i=e.fragmentHint)&&i.sn===t?i:t<e.startSN&&r&&r.sn===t?r:null}function t5(e,t,r){return e?t6(e.partList,t,r):null}function t6(e,t,r){if(e)for(let i=e.length;i--;){let n=e[i];if(n.index===r&&n.fragment.sn===t)return n}return null}function t8(e){e.forEach((e,t)=>{var r;null==(r=e.details)||r.fragments.forEach(e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)})})}function t9(e){return e.replace(/\?[^?]*$/,"")}function t7(e,t){for(let i=0,n=e.length;i<n;i++){var r;if((null==(r=e[i])?void 0:r.cc)===t)return e[i]}return null}function re(e,t){let r=e.start+t;e.startPTS=r,e.setStart(r),e.endPTS=r+e.duration}function rt(e,t){let r=t.fragments;for(let t=0,i=r.length;t<i;t++)re(r[t],e);t.fragmentHint&&re(t.fragmentHint,e),t.alignedSliding=!0}function rr(e,t){if(!t||!(e.startCC<t.endCC)||!(e.endCC>t.startCC))return;let r=Math.min(t.endCC,e.endCC),i=t7(t.fragments,r),n=t7(e.fragments,r);i&&n&&(S.log(`Aligning playlist at start of dicontinuity sequence ${r}`),rt(i.start-n.start,e))}function ri(e,t){let r,i;if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;let n=e.fragments,a=t.fragments;if(!n.length||!a.length)return;let s=Math.min(t.endCC,e.endCC);t.startCC<s&&e.startCC<s&&(r=t7(a,s),i=t7(n,s)),r&&i||(i=t7(n,(r=a[Math.floor(a.length/2)]).cc)||n[Math.floor(n.length/2)]);let o=r.programDateTime,l=i.programDateTime;o&&l&&rt((l-o)/1e3-(i.start-r.start),e)}function rn(e,t,r){ra(e,t,r),e.addEventListener(t,r)}function ra(e,t,r){e.removeEventListener(t,r)}let rs={toString:function(e){let t="",r=e.length;for(let i=0;i<r;i++)t+=`[${e.start(i).toFixed(3)}-${e.end(i).toFixed(3)}]`;return t}},ro={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class rl extends to{constructor(e,t,r,i,a){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ro.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{let{config:e,fragCurrent:t,media:r,mediaBuffer:i,state:a}=this,s=r?r.currentTime:0,o=th.bufferInfo(i||r,s,e.maxBufferHole),l=!o.len;if(this.log(`Media seeking to ${n(s)?s.toFixed(3):s}, state: ${a}, ${l?"out of":"in"} buffer`),this.state===ro.ENDED)this.resetLoadingState();else if(t){let r=e.maxFragLookUpTolerance,i=t.start-r,n=t.start+t.duration+r;if(l||n<o.start||i>o.end){let e=s>n;(s<i||e)&&(e&&t.loader&&(this.log(`Cancelling fragment load for seek (sn: ${t.sn})`),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(r&&(this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0),s>this.lastCurrentTime&&(this.lastCurrentTime=s),!this.loadingParts)){let e=Math.max(o.end,s),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log(`LL-Part loading ON after seeking to ${s.toFixed(2)} with buffer @${e.toFixed(2)}`),this.loadingParts=t)}!this.hls.hasEnoughToStart&&(this.log(`Setting ${l?"startPosition":"nextLoadPosition"} to ${s} for seek without enough to start`),this.nextLoadPosition=s,l&&(this.startPosition=s)),l&&this.state===ro.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=a,this.hls=e,this.fragmentLoader=new ti(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new tr(e.config)}registerListeners(){let{hls:e}=this;e.on(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(u.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(u.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ro.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);let e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ro.STOPPED}get startPositionValue(){let{nextLoadPosition:e,startPosition:t}=this;return -1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;let r=e.end||0,i=this.config.timelineOffset||0;if(r<=i)return!1;let n=e.buffered;this.config.maxBufferHole&&n&&n.length>1&&(e=th.bufferedInfo(n,e.start,0));let a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;let s=t.partList;if(null!=s&&s.length){let e=s[s.length-1];return th.isBuffered(this.media,e.start+e.duration/2)}let o=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){let e=this.config.timelineOffset;if(e){var t;return(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){let r=this.media=this.mediaBuffer=t.media;rn(r,"seeking",this.onMediaSeeking),rn(r,"ended",this.onMediaEnded);let i=this.config;this.levels&&i.autoStartLoad&&this.state===ro.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){let r=!!t.transferMedia,i=this.media;if(null!==i){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),ra(i,"seeking",this.onMediaSeeking),ra(i,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ro.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){this._doFragLoad(e,t,r,e=>{let t=e.frag;if(this.fragContextChanged(t)){this.warn(`${t.type} sn: ${t.sn}${e.part?" part: "+e.part.index:""} of ${this.fragInfo(t,!1,e.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(t);return}t.stats.chunkCount++,this._handleFragmentLoadProgress(e)}).then(e=>{if(!e)return;let t=this.state,r=e.frag;if(this.fragContextChanged(r)){t!==ro.FRAG_LOADING&&(this.fragCurrent||t!==ro.PARSING)||(this.fragmentTracker.removeFragment(r),this.state=ro.IDLE);return}"payload"in e&&(this.log(`Loaded ${r.type} sn: ${r.sn} of ${this.playlistLabel()} ${r.level}`),this.hls.trigger(u.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e)}).catch(t=>{this.state!==ro.STOPPED&&this.state!==ro.ERROR&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;let{fragmentTracker:r}=this;if(r.getState(e)===e3.APPENDING){let t=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,t),n=Math.max(e.duration,i?i.len:this.config.maxBufferLength),a=this.backtrackFragment;(1==(a?e.sn-a.sn:0)||this.reduceMaxBufferLength(n,e.duration))&&r.removeFragment(e)}else(null==(t=this.mediaBuffer)?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===e3.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){let t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){let t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){e-t&&this.hls.trigger(u.BUFFER_FLUSHING,{startOffset:e,endOffset:t,type:r})}_loadInitSegment(e,t){this._doFragLoad(e,t).then(e=>{let t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw Error("init load aborted");return e}).then(e=>{let{hls:t}=this,{frag:r,payload:i}=e,n=r.decryptdata;if(i&&i.byteLength>0&&null!=n&&n.key&&n.iv&&t_(n.method)){let a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),n.key.buffer,n.iv.buffer,tb(n.method)).catch(e=>{throw t.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:r}),e}).then(i=>{let n=self.performance.now();return t.trigger(u.FRAG_DECRYPTED,{frag:r,payload:i,stats:{tstart:a,tdecrypt:n}}),e.payload=i,this.completeInitSegmentLoad(e)})}return this.completeInitSegmentLoad(e)}).catch(t=>{this.state!==ro.STOPPED&&this.state!==ro.ERROR&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){let{levels:t}=this;if(!t)throw Error("init load aborted, missing levels");let r=e.frag.stats;this.state!==ro.STOPPED&&(this.state=ro.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,i;let n=e.tracks;if(n&&!t.encrypted&&(null!=(r=n.audio)&&r.encrypted||null!=(i=n.video)&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){let e=this.media,r=Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${e?"attached mediaKeys: "+e.mediaKeys:"detached"})`);return this.warn(r.message),!!e&&!e.mediaKeys&&(this.hls.trigger(u.ERROR,{type:o.KEY_SYSTEM_ERROR,details:l.KEY_SYSTEM_NO_KEYS,fatal:!1,error:r,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){let{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){let r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?rs.toString(th.getBuffered(r)):"(detached)"})`),k(e)){var i;if(e.type!==f.SUBTITLE){let t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e])){this.state=ro.IDLE;return}}let t=null==(i=this.levels)?void 0:i[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=ro.IDLE}_handleFragmentLoadComplete(e){let{transmuxer:t}=this;if(!t)return;let{frag:r,part:i,partsLoaded:n}=e,a=!n||0===n.length||n.some(e=>!e),s=new tl(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(s)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,i){var a,s;let o;this.fragCurrent=e;let l=t.details;if(!this.levels||!l)throw Error(`frag load aborted, missing level${l?"":" detail"}s`);let c=null;if(e.encrypted&&!(null!=(a=e.decryptdata)&&a.key)){if(this.log(`Loading key for ${e.sn} of [${l.startSN}-${l.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ro.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(u.KEY_LOADED,e),this.state===ro.KEY_LOADING&&(this.state=ro.IDLE),e}),this.hls.trigger(u.KEY_LOADING,{frag:e}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else!e.encrypted&&(c=this.keyLoader.loadClear(e,l.encryptedFragments,this.startFragRequested))&&this.log("[eme] blocking frag load until media-keys acquired");let h=this.fragPrevious;if(k(e)&&(!h||e.sn!==h.sn)){let r=this.shouldLoadParts(t.details,e.end);r!==this.loadingParts&&(this.log(`LL-Part loading ${r?"ON":"OFF"} loading sn ${null==h?void 0:h.sn}->${e.sn}`),this.loadingParts=r)}if(r=Math.max(e.start,r||0),this.loadingParts&&k(e)){let n=l.partList;if(n&&i){r>l.fragmentEnd&&l.fragmentHint&&(e=l.fragmentHint);let a=this.getNextPart(n,e,r);if(a>-1){let s;let o=n[a];return(e=this.fragCurrent=o.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${o.index} (${a}/${n.length-1}) of ${this.fragInfo(e,!1,o)}) cc: ${e.cc} [${l.startSN}-${l.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=o.start+o.duration,this.state=ro.FRAG_LOADING,s=c?c.then(r=>!r||this.fragContextChanged(r.frag)?null:this.doFragPartsLoad(e,o,t,i)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,o,t,i).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(u.FRAG_LOADING,{frag:e,part:o,targetBufferTime:r}),null===this.fragCurrent)?Promise.reject(Error("frag load aborted, context changed in FRAG_LOADING parts")):s}if(!e.url||this.loadedEndOfParts(n,r))return Promise.resolve(null)}}if(k(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${null==(s=l.partList)?void 0:s.filter(e=>e.loaded).map(e=>`[${e.start}-${e.end}]`)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+l.startSN+"-"+l.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),n(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ro.FRAG_LOADING;let d=this.config.progressive;return(o=d&&c?c.then(t=>!t||this.fragContextChanged(t.frag)?null:this.fragmentLoader.load(e,i)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,d?i:void 0),c]).then(([e])=>(!d&&i&&i(e),e)).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(u.FRAG_LOADING,{frag:e,targetBufferTime:r}),null===this.fragCurrent)?Promise.reject(Error("frag load aborted, context changed in FRAG_LOADING")):o}doFragPartsLoad(e,t,r,i){return new Promise((n,a)=>{var s;let o=[],l=null==(s=r.details)?void 0:s.partList,c=t=>{this.fragmentLoader.loadPart(e,t,i).then(i=>{o[t.index]=i;let a=i.part;this.hls.trigger(u.FRAG_LOADED,i);let s=t5(r.details,e.sn,t.index+1)||t6(l,e.sn,t.index+1);if(!s)return n({frag:e,part:a,partsLoaded:o});c(s)}).catch(a)};c(t)})}handleFragLoadError(e){if("data"in e){let t=e.data;t.frag&&t.details===l.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===o.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(u.ERROR,t)}else this.hls.trigger(u.ERROR,{type:o.OTHER_ERROR,details:l.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){let t=this.getCurrentContext(e);if(!t||this.state!==ro.PARSING){this.fragCurrent||this.state===ro.STOPPED||this.state===ro.ERROR||(this.state=ro.IDLE);return}let{frag:r,part:i,level:n}=t,a=self.performance.now();r.stats.parsing.end=a,i&&(i.stats.parsing.end=a);let s=this.getLevelDetails(),o=s&&r.sn>s.endSN||this.shouldLoadParts(s,r.end);o!==this.loadingParts&&(this.log(`LL-Part loading ${o?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=o),this.updateLevelTiming(r,i,n,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r,i;let n=e.partList[0];if(n.fragment.type===f.SUBTITLE)return!1;if(t>=n.end+((null==(r=e.fragmentHint)?void 0:r.duration)||0)&&(this.hls.hasEnoughToStart?(null==(i=this.media)?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>n.start-n.fragment.duration)return!0}}return!1}getCurrentContext(e){let{levels:t,fragCurrent:r}=this,{level:i,sn:n,part:a}=e;if(!(null!=t&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${n} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;let s=t[i],o=s.details,l=a>-1?t5(o,n,a):null,u=l?l.fragment:t4(o,n,r);return u?(r&&r!==u&&(u.stats=r.stats),{frag:u,part:l,level:s}):null}bufferFragmentData(e,t,r,i,n){if(this.state!==ro.PARSING)return;let{data1:a,data2:s}=e,o=a;if(s&&(o=J(a,s)),!o.length)return;let l=this.initPTS[t.cc],c=l?-l.baseTime/l.timescale:void 0,h={type:e.type,frag:t,part:r,chunkMeta:i,offset:c,parent:t.type,data:o};if(this.hls.trigger(u.BUFFER_APPENDING,h),e.dropped&&e.independent&&!r){if(n)return;this.flushBufferGap(t)}}flushBufferGap(e){let t=this.media;if(!t)return;if(!th.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}let r=t.currentTime,i=th.bufferInfo(t,r,0),n=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*n),s=Math.max(Math.min(e.start-a,i.end-a),r+a);e.start-s>a&&this.flushMainBuffer(s,e.start)}getFwdBufferInfo(e,t){var r;let i=this.getLoadPosition();if(!n(i))return null;let a=this.lastCurrentTime>i||null!=(r=this.media)&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,a)}getFwdBufferInfoAtPos(e,t,r,i){let n=th.bufferInfo(e,t,i);if(0===n.len&&void 0!==n.nextStart){let a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&(n.nextStart<=a.end||a.gap)){let r=Math.max(Math.min(n.nextStart,a.end)-t,i);return th.bufferInfo(e,t,r)}}return n}getMaxBufferLength(e){let{config:t}=this;return Math.min(e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){let r=this.config,i=Math.max(Math.min(e-t,r.maxBufferLength),t),n=Math.max(e-3*t,r.maxMaxBufferLength/2,i);return n>=i&&(r.maxMaxBufferLength=n,this.warn(`Reduce max buffer length to ${n}s`),!0)}getAppendedFrag(e,t=f.MAIN){let r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){let r=t.fragments,i=r.length;if(!i)return null;let{config:n}=this,a=r[0].start,s=n.lowLatencyMode&&!!t.partList,o=null;if(t.live){let r=n.initialLiveManifestSize;if(i<r)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${r})`),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<a){var l;s&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t);let r=this.hls.startPosition,i=this.hls.liveSyncPosition,n=o?(-1!==r&&r>=a?r:i)||o.start:e;this.log(`Setting startPosition to ${n} to match start frag at live edge. mainStart: ${r} liveSyncPosition: ${i} frag.start: ${null==(l=o)?void 0:l.start}`),this.startPosition=this.nextLoadPosition=n}}else e<=a&&(o=r[0]);if(!o){let r=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,r,t)}let u=this.filterReplacedPrimary(o,t);if(!u&&o){let e=o.sn-t.startSN;u=this.filterReplacedPrimary(r[e+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){let r=this.fragmentTracker.getState(e);return(r===e3.OK||r===e3.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,i,n){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t))&&!a.gap&&r.nextStart){let e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i,0);if(null!==e&&r.len+e.len>=n){let e=a.sn;return this.loopSn!==e&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e}`),this.loopSn=e),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(ru(this.config)){var e;if(null==(e=this.hls.interstitialsManager)||null==(e=e.playingItem)?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(ru(this.config)&&e.type!==f.SUBTITLE){let r=this.hls.interstitialsManager,i=null==r?void 0:r.bufferingItem;if(i){let r=i.event;if(r){if(r.appendInPlace||Math.abs(e.start-i.start)>1||0===i.start)return null}else if(e.end<=i.start&&(null==t?void 0:t.live)===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}let n=null==r?void 0:r.playerQueue;if(n)for(let t=n.length;t--;){let r=n[t].interstitial;if(r.appendInPlace&&e.start>=r.startTime&&e.end<=r.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,r){let i=-1,n=!1,a=!0;for(let s=0,o=e.length;s<o;s++){let o=e[s];if(a=a&&!o.independent,i>-1&&r<o.start)break;let l=o.loaded;l?i=-1:(n||(o.independent||a)&&o.fragment===t)&&(o.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${o.start}`),i=s),n=l}return i}loadedEndOfParts(e,t){let r;for(let i=e.length;i--&&(r=e[i]).loaded;)if(t>r.start)return!0;return!1}getInitialLiveFragment(e){let t=e.fragments,r=this.fragPrevious,i=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),i=function(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!n(t)||t<(e[0].programDateTime||0)||t>=(e[e.length-1].endProgramDateTime||0))return null;for(let i=0;i<e.length;++i){let n=e[i];if(function(e,t,r){let i=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-i>e}(t,r,n))return n}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){let n=r.sn+1;if(n>=e.startSN&&n<=e.endSN){let a=t[n-e.startSN];r.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}!i&&(i=eV(e,r.cc,r.end))&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`)}}else{let t=this.hls.liveSyncPosition;null!==t&&(i=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,r){let i;let{config:n}=this,{fragPrevious:a}=this,{fragments:s,endSN:o}=r,{fragmentHint:l}=r,{maxFragLookUpTolerance:u}=n,c=r.partList,h=!!(this.loadingParts&&null!=c&&c.length&&l);if(h&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(s=s.concat(l),o=l.sn),e<t){var d;let r=e<this.lastCurrentTime||e>t-u||null!=(d=this.media)&&d.paused||!this.startFragRequested?0:u;i=eH(a,s,e,r)}else i=s[s.length-1];if(i){let e=i.sn-r.startSN,t=this.fragmentTracker.getState(i);if((t===e3.OK||t===e3.PARTIAL&&i.gap)&&(a=i),a&&i.sn===a.sn&&(!h||c[0].fragment.sn>i.sn||!r.live)&&i.level===a.level){let t=s[e+1];i=i.sn<o&&this.fragmentTracker.getState(t)!==e3.OK?t:null}}return i}alignPlaylists(e,t,r){let i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;let a=e.fragmentStart,s=!t,o=e.alignedSliding&&n(a);if(s||!o&&!a){r&&(rr(e,r),e.alignedSliding||ri(e,r),e.alignedSliding||e.skippedSegments||t1(r,e,!1));let n=e.fragmentStart;return this.log(`Live playlist sliding: ${n.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),n}return a}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);let i=this.timelineOffset;if(-1===r){let a=null!==this.startTimeOffset,s=a?this.startTimeOffset:e.startTimeOffset;null!==s&&n(s)?(r=t+s,s<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${s} found in ${a?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+i}this.nextLoadPosition=r+i}getLoadPosition(){var e;let{media:t}=this,r=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&k(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===ro.FRAG_LOADING_WAITING_RETRY)||(this.state=ro.IDLE)}onFragmentOrKeyLoadError(e,t){var r,i,n;if(t.chunkMeta&&!t.frag){let e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}let a=t.frag;if(!a||a.type!==e||!this.levels)return;if(this.fragContextChanged(a)){this.warn(`Frag load error must match current frag to retry ${a.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);return}let s=t.details===l.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(a,!0);let o=t.errorAction;if(!o){this.state=ro.ERROR;return}let{action:u,flags:c,retryCount:h=0,retryConfig:d}=o,f=!!d,p=f&&u===eZ.RetryRequest,m=f&&!o.resolved&&c===e0.MoveAllAlternatesMatchingHost,g=null==(r=this.hls.latestLevelDetails)?void 0:r.live;if(!p&&m&&k(a)&&!a.endList&&g&&!eY(t))this.resetFragmentErrors(e),this.treatAsGap(a),o.resolved=!0;else if((p||m)&&h<d.maxNumRetry){let r=eJ(null==(n=t.response)?void 0:n.code),i=eq(d,h);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+i,this.state=ro.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,r){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${a.sn} of ${e} ${a.level} errored with ${t.details}, retrying loading ${h+1}/${d.maxNumRetry} in ${i}ms`)}else if(d){if(this.resetFragmentErrors(e),h<d.maxNumRetry)s||u===eZ.RemoveAlternatePermanently||(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${h})`);return}}else u===eZ.SendAlternateToPenaltyBox?this.state=ro.WAITING_LEVEL:this.state=ro.ERROR;this.tickImmediate()}checkRetryDate(){let e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!eJ(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ro.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ro.PARSING||this.state===ro.PARSED){let t=e.frag,r=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,r),n=i&&i.len>.5;n&&this.reduceMaxBufferLength(i.len,(null==t?void 0:t.duration)||10);let a=!n;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===f.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ro.STOPPED&&(this.state=ro.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;let i=th.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===ro.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ro.STOPPED&&(this.state=ro.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;let e=this.levelLastLoaded,t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${-1===e.level?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,i){let n=r.details;if(!n){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((t,a)=>{let s=e.elementaryStreams[a];if(s){let o=s.endPTS-s.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${a} duration reliably (${o})`),t||!1;let l=i?0:tZ(n,e,s.startPTS,s.endPTS,s.startDTS,s.endDTS,this);return this.hls.trigger(u.LEVEL_PTS_UPDATED,{details:n,level:r,drift:l,type:a,frag:e,start:s.startPTS,end:s.endPTS}),!0}return t},!1)){var a;if(0===r.fragmentError&&this.treatAsGap(e,r),(null==(a=this.transmuxer)?void 0:a.error)===null){let t=Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(t.message),this.hls.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ro.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(u.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===f.MAIN?"level":"track"}fragInfo(e,t=!0,r){var i,n;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${(null!=(i=t&&!r?e.startPTS:(r||e).start)?i:NaN).toFixed(3)}-${(null!=(n=t&&!r?e.endPTS:(r||e).end)?n:NaN).toFixed(3)}]${r&&"main"===e.type?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){let t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function ru(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class rc{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){let e;let{chunks:t,dataLength:r}=this;return t.length?(e=1===t.length?t[0]:function(e,t){let r=new Uint8Array(t),i=0;for(let t=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.length}return r}(t,r),this.reset(),e):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var rh={exports:{}},rd=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}((h||(h=1,function(e){var t=Object.prototype.hasOwnProperty,r="~";function i(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,i,a,s){if("function"!=typeof i)throw TypeError("The listener must be a function");var o=new n(i,a||e,s),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(r=!1)),o.prototype.eventNames=function(){var e,i,n=[];if(0===this._eventsCount)return n;for(i in e=this._events)t.call(e,i)&&n.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},o.prototype.listeners=function(e){var t=r?r+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,a=i.length,s=Array(a);n<a;n++)s[n]=i[n].fn;return s},o.prototype.listenerCount=function(e){var t=r?r+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,n,a,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,n),!0;case 5:return c.fn.call(c.context,t,i,n,a),!0;case 6:return c.fn.call(c.context,t,i,n,a,s),!0}for(u=1,l=Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,i);break;case 4:c[u].fn.call(c[u].context,t,i,n);break;default:if(!l)for(d=1,l=Array(h-1);d<h;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,i,n){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||n&&!o.once||i&&o.context!==i||s(this,a);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||n&&!o[l].once||i&&o[l].context!==i)&&u.push(o[l]);u.length?this._events[a]=1===u.length?u[0]:u:s(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o}(rh)),rh.exports));let rf="1.6.12",rp={};function rm(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function rg(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function rA(e,t){return(127&e[t])<<21|(127&e[t+1])<<14|(127&e[t+2])<<7|127&e[t+3]}function rv(e,t){let r=t,i=0;for(;rg(e,t);)i+=10,i+=rA(e,t+6),rm(e,t+10)&&(i+=10),t+=i;if(i>0)return e.subarray(r,r+i)}function ry(e,t){return 255===e[t]&&(246&e[t+1])==240}function rE(e,t){return 1&e[t+1]?7:9}function rx(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function r_(e,t){return t+1<e.length&&ry(e,t)}function rb(e,t,r,i,n){if(!e.samplerate){let a=function(e,t,r,i){let n=t[r+2],a=n>>2&15;if(a>12){let t=Error(`invalid ADTS sampling index:${a}`);e.emit(u.ERROR,u.ERROR,{type:o.MEDIA_ERROR,details:l.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message});return}let s=(n>>6&3)+1,c=t[r+3]>>6&3|(1&n)<<2,h="mp4a.40."+s,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][a],f=a;(5===s||29===s)&&(f-=3);let p=[s<<3|(14&f)>>1,(1&f)<<7|c<<3];return S.log(`manifest codec:${i}, parsed codec:${h}, channels:${c}, rate:${d} (ADTS object type:${s} sampling index:${a})`),{config:p,samplerate:d,channelCount:c,codec:h,parsedCodec:h,manifestCodec:i}}(t,r,i,n);a&&g(e,a)}}function rS(e,t,r,i,n){let a;let s=i+n*(9216e4/e.samplerate),o=function(e,t){let r=rE(e,t);if(t+r<=e.length){let i=rx(e,t)-r;if(i>0)return{headerLength:r,frameLength:i}}}(t,r);if(o){let{frameLength:i,headerLength:n}=o,l=n+i,u=Math.max(0,r+l-t.length);u?(a=new Uint8Array(l-n)).set(t.subarray(r+n,t.length),0):a=t.subarray(r+n,r+l);let c={unit:a,pts:s};return u||e.samples.push(c),{sample:c,length:l,missing:u}}let l=t.length-r;return(a=new Uint8Array(l)).set(t.subarray(r,t.length),0),{sample:{unit:a,pts:s},length:l,missing:-1}}function rw(e,t=0,r=1/0){return function(e,t,r,i){let n=e instanceof ArrayBuffer?e:e.buffer,a=1;"BYTES_PER_ELEMENT"in i&&(a=i.BYTES_PER_ELEMENT);let s=e&&e.buffer instanceof ArrayBuffer&&void 0!==e.byteLength&&void 0!==e.byteOffset?e.byteOffset:0,o=(s+e.byteLength)/a,l=Math.floor(Math.max(0,Math.min((s+t)/a,o))),u=Math.floor(Math.min(l+Math.max(r,0),o));return new i(n,l,u-l)}(e,t,r,Uint8Array)}function rC(e){let t=0,r=[];for(;rg(e,t);){let i=rA(e,t+6);e[t+5]>>6&1&&(t+=10);let n=(t+=10)+i;for(;t+10<n;){let i=function(e){let t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=rA(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}}(e.subarray(t)),n="PRIV"===i.type?function(e){if(e.size<2)return;let t=T(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}(i):"W"===i.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1,r=T(e.data.subarray(t),!0);t+=r.length+1;let i=T(e.data.subarray(t));return{key:e.type,info:r,data:i}}let t=T(e.data);return{key:e.type,info:"",data:t}}(i):"APIC"===i.type?function(e){let t;let r={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0]){console.log("Ignore frame with unrecognized character encoding");return}let i=e.data.subarray(1).indexOf(0);if(-1===i)return;let n=T(rw(e.data,1,i)),a=e.data[2+i],s=e.data.subarray(3+i).indexOf(0);if(-1===s)return;let o=T(rw(e.data,3+i,s));if("-->"===n)t=T(rw(e.data,4+i+s));else{var l;t=(l=e.data.subarray(4+i+s))instanceof ArrayBuffer?l:0==l.byteOffset&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer}return r.mimeType=n,r.pictureType=a,r.description=o,r.data=t,r}(i):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1,r=T(e.data.subarray(t),!0);t+=r.length+1;let i=T(e.data.subarray(t));return{key:e.type,info:r,data:i}}let t=T(e.data.subarray(1));return{key:e.type,info:"",data:t}}(i);n&&r.push(n),t+=i.size+10}rm(e,t)&&(t+=10)}return r}function rT(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function rI(e){let t=rC(e);for(let e=0;e<t.length;e++){let r=t[e];if(rT(r))return function(e){if(8===e.data.byteLength){let t=new Uint8Array(e.data),r=1&t[3],i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}}(r)}}let rM=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function rR(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class rB{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){let r;this.cachedData&&(e=J(this.cachedData,e),this.cachedData=null);let i=rv(e,0),a=i?i.length:0,s=this._audioTrack,o=this._id3Track,l=i?rI(i):void 0,u=e.length;for((null===this.basePTS||0===this.frameIndex&&n(l))&&(this.basePTS=rD(l,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:rM.audioId3,duration:Number.POSITIVE_INFINITY});a<u;){if(this.canParse(e,a)){let t=this.appendFrame(s,e,a);t?(this.frameIndex++,this.lastPTS=t.sample.pts,a+=t.length,r=a):a=u}else{var c,h;rg(c=e,h=a)&&rA(c,h+6)+10<=c.length-h?(i=rv(e,a),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:rM.audioId3,duration:Number.POSITIVE_INFINITY}),a+=i.length,r=a):a++}if(a===u&&r!==u){let t=e.slice(r);this.cachedData?this.cachedData=J(this.cachedData,t):this.cachedData=t}}return{audioTrack:s,videoTrack:rR(),id3Track:o,textTrack:rR()}}demuxSampleAes(e,t,r){return Promise.reject(Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){let t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:rR(),id3Track:this._id3Track,textTrack:rR()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}let rD=(e,t,r)=>n(e)?90*e:9e4*t+(r?9e4*r.baseTime/r.timescale:0),rP=null,rL=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],rk=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],rF=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],rO=[0,1,1,4];function rU(e,t,r,i,n){if(r+24>t.length)return;let a=rN(t,r);if(a&&r+a.frameLength<=t.length){let s=i+n*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(r,r+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}function rN(e,t){let r=e[t+1]>>3&3,i=e[t+1]>>1&3,n=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==r&&0!==n&&15!==n&&3!==a){let s=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*rL[14*(3===r?3-i:3===i?3:4)+n-1],u=rk[3*(3===r?0:2===r?1:2)+a],c=rF[r][i],h=rO[i],d=Math.floor(c*l/u+s)*h;if(null===rP){let e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);rP=e?parseInt(e[1]):0}return rP&&rP<=87&&2===i&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:u,channelCount:3===o?1:2,frameLength:d,samplesPerFrame:8*c*h}}}function rz(e,t){return 255===e[t]&&(224&e[t+1])==224&&(6&e[t+1])!=0}function rG(e,t){return t+1<e.length&&rz(e,t)}function rH(e,t){if(t+1<e.length&&rz(e,t)){let r=rN(e,t),i=4;null!=r&&r.frameLength&&(i=r.frameLength);let n=t+i;return n===e.length||rG(e,n)}return!1}class rQ extends rB{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;let r=rv(e,0),i=(null==r?void 0:r.length)||0;if(rH(e,i))return!1;for(let r=e.length;i<r;i++)if(function(e,t){if(r_(e,t)){let r=rE(e,t);if(t+r>=e.length)return!1;let i=rx(e,t);if(i<=r)return!1;let n=t+i;return n===e.length||r_(e,n)}return!1}(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return t+5<e.length&&ry(e,t)&&rx(e,t)<=e.length-t}appendFrame(e,t,r){rb(e,this.observer,t,r,e.manifestCodec);let i=rS(e,t,r,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}}let rV=(e,t)=>{let r=0,i=5;t+=5;let n=new Uint32Array(1),a=new Uint32Array(1),s=new Uint8Array(1);for(;i>0;){s[0]=e[t];let o=Math.min(i,8),l=8-o;a[0]=0xff000000>>>24+l<<l,n[0]=(s[0]&a[0])>>l,r=r?r<<o|n[0]:n[0],t+=1,i-=o}return r};class rW extends rB{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){let i=rj(e,t,r,this.basePTS,this.frameIndex);if(-1!==i)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;let t=rv(e,0);if(!t)return!1;let r=t.length;return!!(11===e[r]&&119===e[r+1]&&void 0!==rI(t)&&16>rV(e,r))}}function rj(e,t,r,i,n){if(r+8>t.length||11!==t[r]||119!==t[r+1])return -1;let a=t[r+4]>>6;if(a>=3)return -1;let s=[48e3,44100,32e3][a],o=63&t[r+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+a];if(r+l>t.length)return -1;let u=t[r+6]>>5,c=0;2===u?c+=2:(1&u&&1!==u&&(c+=2),4&u&&(c+=2));let h=(t[r+6]<<8|t[r+7])>>12-c&1,d=[2,1,2,3,3,4,4,5][u]+h,f=t[r+5]>>3,p=7&t[r+5],m=new Uint8Array([a<<6|f<<1|p>>2,(3&p)<<6|u<<3|h<<2|o>>4,o<<4&224]),g=t.subarray(r,r+l);return e.config=m,e.channelCount=d,e.samplerate=s,e.samples.push({unit:g,pts:i+1536/s*9e4*n}),l}class rY extends rB{resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=rv(e,0),r=(null==t?void 0:t.length)||0;if(t&&11===e[r]&&119===e[r+1]&&void 0!==rI(t)&&16>=rV(e,r))return!1;for(let t=e.length;r<t;r++)if(rH(e,r))return S.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return rz(e,t)&&4<=e.length-t}appendFrame(e,t,r){if(null!==this.basePTS)return rU(e,t,r,this.basePTS,this.frameIndex)}}let rK=/\/emsg[-/]ID3/i;class rq{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,i){let n=this.videoTrack=rR("video",1),a=this.audioTrack=rR("audio",1),s=this.txtTrack=rR("text",1);if(this.id3Track=rR("id3",1),this.timeOffset=0,!(null!=e&&e.byteLength))return;let o=j(e);if(o.video){let{id:e,timescale:t,codec:r,supplemental:i}=o.video;n.id=e,n.timescale=s.timescale=t,n.codec=r,n.supplemental=i}if(o.audio){let{id:e,timescale:t,codec:r}=o.audio;a.id=e,a.timescale=t,a.codec=r}s.id=N.text,n.sampleDuration=0,n.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return function(e){let t=e.byteLength;for(let r=0;r<t;){let i=H(e,r);if(i>8&&109===e[r+4]&&111===e[r+5]&&111===e[r+6]&&102===e[r+7])return!0;r=i>1?r+i:t}return!1}(e)}demux(e,t){this.timeOffset=t;let r=e,i=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=J(this.remainderData,e));let t=function(e){let t={valid:null,remainder:null},r=W(e,["moof"]);if(r.length<2)return t.remainder=e,t;let i=r[r.length-1];return t.valid=e.slice(0,i.byteOffset-8),t.remainder=e.slice(i.byteOffset-8),t}(r);this.remainderData=t.remainder,i.samples=t.valid||new Uint8Array}else i.samples=r;let a=this.extractID3Track(i,t);return n.samples=Z(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){let e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;let i=this.extractID3Track(t,this.timeOffset);return r.samples=Z(e,t),{videoTrack:t,audioTrack:rR(),id3Track:i,textTrack:rR()}}extractID3Track(e,t){let r=this.id3Track;if(e.samples.length){let i=W(e.samples,["emsg"]);i&&i.forEach(e=>{let i=function(e){let t=e[0],r="",i="",n=0,s=0,o=0,l=0,u=0,c=0;if(0===t){for(;"\0"!==z(e.subarray(c,c+1));)r+=z(e.subarray(c,c+1)),c+=1;for(r+=z(e.subarray(c,c+1)),c+=1;"\0"!==z(e.subarray(c,c+1));)i+=z(e.subarray(c,c+1)),c+=1;i+=z(e.subarray(c,c+1)),c+=1,n=H(e,12),s=H(e,16),l=H(e,20),u=H(e,24),c=28}else if(1===t){c+=4,n=H(e,c);let t=H(e,c+=4),s=H(e,c+=4);for(c+=4,a(o=0x100000000*t+s)||(o=Number.MAX_SAFE_INTEGER,S.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),l=H(e,c),c+=4,u=H(e,c),c+=4;"\0"!==z(e.subarray(c,c+1));)r+=z(e.subarray(c,c+1)),c+=1;for(r+=z(e.subarray(c,c+1)),c+=1;"\0"!==z(e.subarray(c,c+1));)i+=z(e.subarray(c,c+1)),c+=1;i+=z(e.subarray(c,c+1)),c+=1}return{schemeIdUri:r,value:i,timeScale:n,presentationTime:o,presentationTimeDelta:s,eventDuration:l,id:u,payload:e.subarray(c,e.byteLength)}}(e);if(rK.test(i.schemeIdUri)){let e=rX(i,t),n=0xffffffff===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;n<=.001&&(n=Number.POSITIVE_INFINITY);let a=i.payload;r.samples.push({data:a,len:a.byteLength,dts:e,pts:e,type:rM.emsg,duration:n})}else if(this.config.enableEmsgKLVMetadata&&i.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){let e=rX(i,t);r.samples.push({data:i.payload,len:i.payload.byteLength,dts:e,pts:e,type:rM.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function rX(e,t){return n(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class r${constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new tr(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,e9.cbc)}decryptAacSample(e,t,r){let i=e[t].unit;if(i.length<=16)return;let n=i.subarray(16,i.length-i.length%16),a=n.buffer.slice(n.byteOffset,n.byteOffset+n.length);this.decryptBuffer(a).then(n=>{let a=new Uint8Array(n);i.set(a,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){let t=new Int8Array(16*Math.floor((e.length-48)/160)+16),r=0;for(let i=32;i<e.length-16;i+=160,r+=16)t.set(e.subarray(i,i+16),r);return t}getAvcDecryptedUnit(e,t){let r=new Uint8Array(t),i=0;for(let t=32;t<e.length-16;t+=160,i+=16)e.set(r.subarray(i,i+16),t);return e}decryptAvcSample(e,t,r,i,n){let a=er(n.data),s=this.getAvcEncryptedData(a);this.decryptBuffer(s.buffer).then(s=>{n.data=this.getAvcDecryptedUnit(a,s),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,i)}).catch(i)}decryptAvcSamples(e,t,r,i){if(e instanceof Uint8Array)throw Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){i();return}let n=e[t].units;for(;!(r>=n.length);r++){let a=n[r];if(!(a.data.length<=48)&&(1===a.type||5===a.type)&&(this.decryptAvcSample(e,t,r,i,a),!this.decrypter.isSync()))return}}}}class rJ{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r;let i=this.VideoSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){let e=i.units;r=e[e.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){let r=t.samples,i=r.length;if(i){let t=r[i-1];e.pts=t.pts,e.dts=t.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){let i,n,a;let s=t.byteLength,o=e.naluState||0,l=o,u=[],c=0,h=-1,d=0;for(-1===o&&(h=0,d=this.getNALuType(t,0),o=0,c=1);c<s;){if(i=t[c++],!o){o=i?0:1;continue}if(1===o){o=i?0:2;continue}if(i){if(1===i){if(n=c-o-1,h>=0){let e={data:t.subarray(h,n),type:d};u.push(e)}else{let r=this.getLastNalUnit(e.samples);r&&(l&&c<=4-l&&r.state&&(r.data=r.data.subarray(0,r.data.byteLength-l)),n>0&&(r.data=J(r.data,t.subarray(0,n)),r.state=0))}c<s?(a=this.getNALuType(t,c),h=c,d=a,o=0):o=-1}else o=0}else o=3}if(h>=0&&o>=0){let e={data:t.subarray(h,s),type:d,state:o};u.push(e)}if(0===u.length){let r=this.getLastNalUnit(e.samples);r&&(r.data=J(r.data,t))}return e.naluState=o,u}}class rZ{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){let e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw Error("no bytes available");i.set(e.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e||(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e}readBits(e){let t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(e>32&&S.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw Error("no bits available");return(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&0x80000000>>>e)!=0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){let e=this.skipLZ();return this.readBits(e+1)-1}readEG(){let e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class r0 extends rJ{parsePES(e,t,r,i){let n;let a=this.parseNALu(e,r.data,i),s=this.VideoSample,o=!1;r.data=null,s&&a.length&&!e.audFound&&(this.pushAccessUnit(s,e),s=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),a.forEach(i=>{var a,l,u,c,h;switch(i.type){case 1:{let t=!1;n=!0;let a=i.data;if(o&&a.length>4){let e=this.readSliceType(a);(2===e||4===e||7===e||9===e)&&(t=!0)}t&&null!=(u=s)&&u.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null),s||(s=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),s.frame=!0,s.key=t;break}case 5:n=!0,null!=(a=s)&&a.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null),s||(s=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),s.key=!0,s.frame=!0;break;case 6:n=!0,et(i.data,1,r.pts,t.samples);break;case 7:{n=!0,o=!0;let t=i.data,r=this.readSPS(t);if(!e.sps||e.width!==r.width||e.height!==r.height||(null==(c=e.pixelRatio)?void 0:c[0])!==r.pixelRatio[0]||(null==(h=e.pixelRatio)?void 0:h[1])!==r.pixelRatio[1]){e.width=r.width,e.height=r.height,e.pixelRatio=r.pixelRatio,e.sps=[t];let i=t.subarray(1,4),n="avc1.";for(let e=0;e<3;e++){let t=i[e].toString(16);t.length<2&&(t="0"+t),n+=t}e.codec=n}break}case 8:n=!0,e.pps=[i.data];break;case 9:n=!0,e.audFound=!0,null!=(l=s)&&l.frame&&(this.pushAccessUnit(s,e),s=null),s||(s=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:n=!0;break;default:n=!1}s&&n&&s.units.push(i)}),i&&s&&(this.pushAccessUnit(s,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){let t=new rZ(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,i=8;for(let n=0;n<e;n++)0!==i&&(i=(r+t.readEG()+256)%256),r=0===i?r:i}readSPS(e){let t,r,i;let n=new rZ(e),a=0,s=0,o=0,l=0,u=n.readUByte.bind(n),c=n.readBits.bind(n),h=n.readUEG.bind(n),d=n.readBoolean.bind(n),f=n.skipBits.bind(n),p=n.skipEG.bind(n),m=n.skipUEG.bind(n),g=this.skipScalingList.bind(this);u();let A=u();if(c(5),f(3),u(),m(),100===A||110===A||122===A||244===A||44===A||83===A||86===A||118===A||128===A){let e=h();if(3===e&&f(1),m(),m(),f(1),d())for(i=0,r=3!==e?8:12;i<r;i++)d()&&g(i<6?16:64,n)}m();let v=h();if(0===v)h();else if(1===v)for(f(1),p(),p(),t=h(),i=0;i<t;i++)p();m(),f(1);let y=h(),E=h(),x=c(1);0===x&&f(1),f(1),d()&&(a=h(),s=h(),o=h(),l=h());let _=[1,1];if(d()&&d())switch(u()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:_=[u()<<8|u(),u()<<8|u()]}return{width:Math.ceil((y+1)*16-2*a-2*s),height:(2-x)*(E+1)*16-(x?2:4)*(o+l),pixelRatio:_}}}class r1 extends rJ{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,i){let n;let a=this.parseNALu(e,r.data,i),s=this.VideoSample,o=!1;r.data=null,s&&a.length&&!e.audFound&&(this.pushAccessUnit(s,e),s=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),a.forEach(i=>{var a,l,u;switch(i.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:s||(s=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.frame=!0,n=!0;break;case 16:case 17:case 18:case 21:n=!0,o&&null!=(u=s)&&u.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null),s||(s=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),s.key=!0,s.frame=!0;break;case 19:case 20:n=!0,null!=(a=s)&&a.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null),s||(s=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),s.key=!0,s.frame=!0;break;case 39:n=!0,et(i.data,2,r.pts,t.samples);break;case 32:n=!0,e.vps||("object"!=typeof e.params&&(e.params={}),e.params=g(e.params,this.readVPS(i.data)),this.initVPS=i.data),e.vps=[i.data];break;case 33:if(n=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],i.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){let t=this.readSPS(i.data);for(let r in e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!=typeof e.params&&(e.params={}),t.params)e.params[r]=t.params[r]}this.pushParameterSet(e.sps,i.data,e.vps),s||(s=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),s.key=!0;break;case 34:if(n=!0,"object"==typeof e.params){if(!e.pps){e.pps=[];let t=this.readPPS(i.data);for(let r in t)e.params[r]=t[r]}this.pushParameterSet(e.pps,i.data,e.vps)}break;case 35:n=!0,e.audFound=!0,null!=(l=s)&&l.frame&&(this.pushAccessUnit(s,e),s=null),s||(s=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:n=!1}s&&n&&s.units.push(i)}),i&&s&&(this.pushAccessUnit(s,e),this.VideoSample=null)}pushParameterSet(e,t,r){(!r||r[0]!==this.initVPS)&&(r||e.length)||e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){let t=new Uint8Array(e.byteLength),r=0;for(let i=0;i<e.byteLength;i++)(!(i>=2)||3!==e[i]||0!==e[i-1]||0!==e[i-2])&&(t[r]=e[i],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){let t=new rZ(e);return t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6),{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){let t=new rZ(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);let r=t.readBits(3);t.readBoolean();let i=t.readBits(2),n=t.readBoolean(),a=t.readBits(5),s=t.readUByte(),o=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),h=t.readUByte(),d=t.readUByte(),f=t.readUByte(),p=t.readUByte(),m=t.readUByte(),g=t.readUByte(),A=[],v=[];for(let e=0;e<r;e++)A.push(t.readBoolean()),v.push(t.readBoolean());if(r>0)for(let e=r;e<8;e++)t.readBits(2);for(let e=0;e<r;e++)A[e]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),v[e]&&t.readUByte();t.readUEG();let y=t.readUEG();3==y&&t.skipBits(1);let E=t.readUEG(),x=t.readUEG(),_=t.readBoolean(),b=0,S=0,w=0,C=0;_&&(b+=t.readUEG(),S+=t.readUEG(),w+=t.readUEG(),C+=t.readUEG());let T=t.readUEG(),I=t.readUEG(),M=t.readUEG(),R=t.readBoolean();for(let e=R?0:r;e<=r;e++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let e=0;e<4;e++)for(let r=0;r<(3===e?2:6);r++)if(t.readBoolean()){let r=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<r;e++)t.readEG()}else t.readUEG();t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());let B=t.readUEG(),D=0;for(let e=0;e<B;e++){let r=!1;if(0!==e&&(r=t.readBoolean()),r){e===B&&t.readUEG(),t.readBoolean(),t.readUEG();let r=0;for(let e=0;e<=D;e++){let e=t.readBoolean(),i=!1;e||(i=t.readBoolean()),(e||i)&&r++}D=r}else{let e=t.readUEG(),r=t.readUEG();D=e+r;for(let r=0;r<e;r++)t.readUEG(),t.readBoolean();for(let e=0;e<r;e++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){let e=t.readUEG();for(let r=0;r<e;r++){for(let e=0;e<M+4;e++)t.readBits(1);t.readBits(1)}}let P=0,L=1,k=1,F=!0,O=1,U=0;t.readBoolean(),t.readBoolean();if(t.readBoolean()){if(t.readBoolean()){let e=t.readUByte();e>0&&e<16?(L=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],k=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(L=t.readBits(16),k=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(O=t.readBits(32),U=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){let e=t.readBoolean(),i=t.readBoolean(),n=!1;(e||i)&&((n=t.readBoolean())&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),n&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let a=0;a<=r;a++){let r=(F=t.readBoolean())||t.readBoolean(),a=!1;r?t.readEG():a=t.readBoolean();let s=a?1:t.readUEG()+1;if(e||i)for(let e=0;e<s;e++)t.readUEG(),t.readUEG(),n&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let N=E,z=x;if(_){let e=1,t=1;1===y?e=t=2:2==y&&(e=2),N=E-e*S-e*b,z=x-t*C-t*w}let G=i?["A","B","C"][i]:"",H=s<<24|o<<16|l<<8|u,Q=0;for(let e=0;e<32;e++)Q=(Q|(H>>e&1)<<31-e)>>>0;let V=Q.toString(16);return 1===a&&"2"===V&&(V="6"),{codecString:`hvc1.${G}${a}.${V}.${n?"H":"L"}${g}.B0`,params:{general_tier_flag:n,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[s,o,l,u],general_constraint_indicator_flags:[c,h,d,f,p,m],general_level_idc:g,bit_depth:T+8,bit_depth_luma_minus8:T,bit_depth_chroma_minus8:I,min_spatial_segmentation_idc:P,chroma_format_idc:y,frame_rate:{fixed:F,fps:U/O}},width:N,height:z,pixelRatio:[L,k]}}readPPS(e){let t=new rZ(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);let r=t.readBoolean(),i=t.readBoolean(),n=1;return i&&r?n=0:i?n=3:r&&(n=2),{parallelismType:n}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}class r2{constructor(e,t,r,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=i,this.videoParser=null}static probe(e,t){let r=r2.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),-1!==r}static syncOffset(e){let t=e.length,r=Math.min(940,t-188)+1,i=0;for(;i<r;){let n=!1,a=-1,s=0;for(let o=i;o<t;o+=188)if(71===e[o]&&(t-o==188||71===e[o+188])){if(s++,-1===a&&0!==(a=o)&&(r=Math.min(a+18612,e.length-188)+1),n||(n=0===r3(e,o)),n&&s>1&&(0===a&&s>2||o+188>r))return a}else if(s)return -1;else break;i++}return -1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:N[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=r2.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=r2.createTrack("audio",i),this._id3Track=r2.createTrack("id3"),this._txtTrack=r2.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){let{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,i=!1){let n;r||(this.sampleAes=null);let a=this._videoTrack,s=this._audioTrack,o=this._id3Track,l=this._txtTrack,u=a.pid,c=a.pesData,h=s.pid,d=o.pid,f=s.pesData,p=o.pesData,m=null,g=this.pmtParsed,A=this._pmtId,v=e.length;if(this.remainderData&&(v=(e=J(this.remainderData,e)).length,this.remainderData=null),v<188&&!i)return this.remainderData=e,{audioTrack:s,videoTrack:a,id3Track:o,textTrack:l};let y=Math.max(0,r2.syncOffset(e));(v-=(v-y)%188)<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,v,e.buffer.byteLength-v));let E=0;for(let t=y;t<v;t+=188)if(71===e[t]){let i;let v=!!(64&e[t+1]),E=r3(e,t);if((48&e[t+3])>>4>1){if((i=t+5+e[t+4])===t+188)continue}else i=t+4;switch(E){case u:v&&(c&&(n=r6(c,this.logger))&&(this.readyVideoParser(a.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(a,l,n,!1)),c={data:[],size:0}),c&&(c.data.push(e.subarray(i,t+188)),c.size+=t+188-i);break;case h:if(v){if(f&&(n=r6(f,this.logger)))switch(s.segmentCodec){case"aac":this.parseAACPES(s,n);break;case"mp3":this.parseMPEGPES(s,n);break;case"ac3":this.parseAC3PES(s,n)}f={data:[],size:0}}f&&(f.data.push(e.subarray(i,t+188)),f.size+=t+188-i);break;case d:v&&(p&&(n=r6(p,this.logger))&&this.parseID3PES(o,n),p={data:[],size:0}),p&&(p.data.push(e.subarray(i,t+188)),p.size+=t+188-i);break;case 0:var x,_;v&&(i+=e[i]+1),A=this._pmtId=(31&(x=e)[(_=i)+10])<<8|x[_+11];break;case A:{v&&(i+=e[i]+1);let n=function(e,t,r,i,n,a){let s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(15&e[t+1])<<8|e[t+2],l=t+3+o-4,u=(15&e[t+10])<<8|e[t+11];for(t+=12+u;t<l;){let o=r3(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!i){r5("ADTS AAC",a);break}case 15:-1===s.audioPid&&(s.audioPid=o);break;case 21:-1===s.id3Pid&&(s.id3Pid=o);break;case 219:if(!i){r5("H.264",a);break}case 27:-1===s.videoPid&&(s.videoPid=o);break;case 3:case 4:r.mpeg||r.mp3?-1===s.audioPid&&(s.audioPid=o,s.segmentAudioCodec="mp3"):a.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){r5("AC-3",a);break}case 129:r.ac3?-1===s.audioPid&&(s.audioPid=o,s.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===s.audioPid&&l>0){let i=t+5,n=l;for(;n>2;){106===e[i]&&(!0!==r.ac3?a.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=o,s.segmentAudioCodec="ac3"));let t=e[i+1]+2;i+=t,n-=t}}break;case 194:case 135:return r4(n,Error("Unsupported EC-3 in M2TS found"),void 0,a),s;case 36:-1===s.videoPid&&(s.videoPid=o,s.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"))}t+=l+5}return s}(e,i,this.typeSupported,r,this.observer,this.logger);(u=n.videoPid)>0&&(a.pid=u,a.segmentCodec=n.segmentVideoCodec),(h=n.audioPid)>0&&(s.pid=h,s.segmentCodec=n.segmentAudioCodec),(d=n.id3Pid)>0&&(o.pid=d),null===m||g||(this.logger.warn(`MPEG-TS PMT found at ${t} after unknown PID '${m}'. Backtracking to sync byte @${y} to parse all TS packets.`),m=null,t=y-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=E}}else E++;E>0&&r4(this.observer,Error(`Found ${E} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=c,s.pesData=f,o.pesData=p;let b={audioTrack:s,videoTrack:a,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(b),b}flush(){let e;let{remainderData:t}=this;return(this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes)?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(e){let t;let{audioTrack:r,videoTrack:i,id3Track:n,textTrack:a}=e,s=i.pesData,o=r.pesData,l=n.pesData;if(s&&(t=r6(s,this.logger))?(this.readyVideoParser(i.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(i,a,t,!0),i.pesData=null)):i.pesData=s,o&&(t=r6(o,this.logger))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,t);break;case"mp3":this.parseMPEGPES(r,t);break;case"ac3":this.parseAC3PES(r,t)}r.pesData=null}else null!=o&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=o;l&&(t=r6(l,this.logger))?(this.parseID3PES(n,t),n.pesData=null):n.pesData=l}demuxSampleAes(e,t,r){let i=this.demux(e,r,!0,!this.config.progressive),n=this.sampleAes=new r$(this.observer,this.config,t);return this.decrypt(i,n)}readyVideoParser(e){null===this.videoParser&&("avc"===e?this.videoParser=new r0:"hevc"===e&&(this.videoParser=new r1))}decrypt(e,t){return new Promise(r=>{let{audioTrack:i,videoTrack:n}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,()=>{n.samples?t.decryptAvcSamples(n.samples,0,0,()=>{r(e)}):r(e)}):n.samples&&t.decryptAvcSamples(n.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r,i,n,a,s=0,o=this.aacOverFlow,l=t.data;if(o){this.aacOverFlow=null;let t=o.missing,r=o.sample.unit.byteLength;-1===t?l=J(o.sample.unit,l):(o.sample.unit.set(l.subarray(0,t),r-t),e.samples.push(o.sample),s=o.missing)}for(r=s,i=l.length;r<i-1&&!r_(l,r);r++);if(r!==s){let e;let t=r<i-1;if(e=t?`AAC PES did not start with ADTS header,offset:${r}`:"No ADTS header found in AAC PES",r4(this.observer,Error(e),t,this.logger),!t)return}if(rb(e,this.observer,l,r,this.audioCodec),void 0!==t.pts)n=t.pts;else if(o){let t=9216e4/e.samplerate;n=o.sample.pts+t}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0;for(;r<i;){if(a=rS(e,l,r,n,u),r+=a.length,a.missing){this.aacOverFlow=a;break}for(u++;r<i-1&&!r_(l,r);r++);}}parseMPEGPES(e,t){let r=t.data,i=r.length,n=0,a=0,s=t.pts;if(void 0===s){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(rG(r,a)){let t=rU(e,r,a,s,n);if(t)a+=t.length,n++;else break}else a++}parseAC3PES(e,t){{let r;let i=t.data,n=t.pts;if(void 0===n){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}let a=i.length,s=0,o=0;for(;o<a&&(r=rj(e,i,o,n,s++))>0;)o+=r}}parseID3PES(e,t){if(void 0===t.pts){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}let r=g({},t,{type:this._videoTrack?rM.emsg:rM.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function r3(e,t){return((31&e[t+1])<<8)+e[t+2]}function r4(e,t,r,i){i.warn(`parsing error: ${t.message}`),e.emit(u.ERROR,u.ERROR,{type:o.MEDIA_ERROR,details:l.FRAG_PARSING_ERROR,fatal:!1,levelRetry:r,error:t,reason:t.message})}function r5(e,t){t.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function r6(e,t){let r,i,n,a,s,o=0,l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=J(l[0],l[1]),l.splice(1,1);if(1===((r=l[0])[0]<<16)+(r[1]<<8)+r[2]){if((i=(r[4]<<8)+r[5])&&i>e.size-6)return null;let u=r[7];192&u&&(a=(14&r[9])*0x20000000+(255&r[10])*4194304+(254&r[11])*16384+(255&r[12])*128+(254&r[13])/2,64&u?a-(s=(14&r[14])*0x20000000+(255&r[15])*4194304+(254&r[16])*16384+(255&r[17])*128+(254&r[18])/2)>54e5&&(t.warn(`${Math.round((a-s)/9e4)}s delta between PTS and DTS, align them`),a=s):s=a);let c=(n=r[8])+9;if(e.size<=c)return null;e.size-=c;let h=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){let t=(r=l[e]).byteLength;if(c){if(c>t){c-=t;continue}r=r.subarray(c),t-=c,c=0}h.set(r,o),o+=t}return i&&(i-=n+3),{data:h,pts:a,dts:s,len:i}}return null}class r8{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);else if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);else if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t||3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}class r9{static init(){let e;for(e in r9.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},r9.types)r9.types.hasOwnProperty(e)&&(r9.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);let t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);r9.HDLR_TYPES={video:t,audio:r};let i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);r9.STTS=r9.STSC=r9.STCO=n,r9.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),r9.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),r9.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),r9.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);let a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);r9.FTYP=r9.box(r9.types.ftyp,a,o,a,s),r9.DINF=r9.box(r9.types.dinf,r9.box(r9.types.dref,i))}static box(e,...t){let r=8,i=t.length,n=i;for(;i--;)r+=t[i].byteLength;let a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=255&r,a.set(e,4),i=0,r=8;i<n;i++)a.set(t[i],r),r+=t[i].byteLength;return a}static hdlr(e){return r9.box(r9.types.hdlr,r9.HDLR_TYPES[e])}static mdat(e){return r9.box(r9.types.mdat,e)}static mdhd(e,t){let r=Math.floor((t*=e)/0x100000000),i=Math.floor(t%0x100000000);return r9.box(r9.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static mdia(e){return r9.box(r9.types.mdia,r9.mdhd(e.timescale||0,e.duration||0),r9.hdlr(e.type),r9.minf(e))}static mfhd(e){return r9.box(r9.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?r9.box(r9.types.minf,r9.box(r9.types.smhd,r9.SMHD),r9.DINF,r9.stbl(e)):r9.box(r9.types.minf,r9.box(r9.types.vmhd,r9.VMHD),r9.DINF,r9.stbl(e))}static moof(e,t,r){return r9.box(r9.types.moof,r9.mfhd(e),r9.traf(r,t))}static moov(e){let t=e.length,r=[];for(;t--;)r[t]=r9.trak(e[t]);return r9.box.apply(null,[r9.types.moov,r9.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(r9.mvex(e)))}static mvex(e){let t=e.length,r=[];for(;t--;)r[t]=r9.trex(e[t]);return r9.box.apply(null,[r9.types.mvex,...r])}static mvhd(e,t){let r=Math.floor((t*=e)/0x100000000),i=Math.floor(t%0x100000000),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return r9.box(r9.types.mvhd,n)}static sdtp(e){let t,r;let i=e.samples||[],n=new Uint8Array(4+i.length);for(t=0;t<i.length;t++)r=i[t].flags,n[t+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return r9.box(r9.types.sdtp,n)}static stbl(e){return r9.box(r9.types.stbl,r9.stsd(e),r9.box(r9.types.stts,r9.STTS),r9.box(r9.types.stsc,r9.STSC),r9.box(r9.types.stsz,r9.STSZ),r9.box(r9.types.stco,r9.STCO))}static avc1(e){let t,r,i,n=[],a=[];for(t=0;t<e.sps.length;t++)i=(r=e.sps[t]).byteLength,n.push(i>>>8&255),n.push(255&i),n=n.concat(Array.prototype.slice.call(r));for(t=0;t<e.pps.length;t++)i=(r=e.pps[t]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));let s=r9.box(r9.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(a))),o=e.width,l=e.height,u=e.pixelRatio[0],c=e.pixelRatio[1];return r9.box(r9.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,r9.box(r9.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),r9.box(r9.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))}static esds(e){return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...e.config,6,1,2])}static audioStsd(e){let t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return r9.box(r9.types.mp4a,r9.audioStsd(e),r9.box(r9.types.esds,r9.esds(e)))}static mp3(e){return r9.box(r9.types[".mp3"],r9.audioStsd(e))}static ac3(e){return r9.box(r9.types["ac-3"],r9.audioStsd(e),r9.box(r9.types.dac3,e.config))}static stsd(e){let{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return r9.box(r9.types.stsd,r9.STSD,r9.mp4a(e));if("ac3"===t&&e.config)return r9.box(r9.types.stsd,r9.STSD,r9.ac3(e));if("mp3"===t&&"mp3"===e.codec)return r9.box(r9.types.stsd,r9.STSD,r9.mp3(e))}else if(e.pps&&e.sps){if("avc"===t)return r9.box(r9.types.stsd,r9.STSD,r9.avc1(e));if("hevc"===t&&e.vps)return r9.box(r9.types.stsd,r9.STSD,r9.hvc1(e))}else throw Error("video track missing pps or sps");throw Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){let t=e.id,r=(e.duration||0)*(e.timescale||0),i=e.width||0,n=e.height||0,a=Math.floor(r/0x100000000),s=Math.floor(r%0x100000000);return r9.box(r9.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,n>>8&255,255&n,0,0]))}static traf(e,t){let r=r9.sdtp(e),i=e.id,n=Math.floor(t/0x100000000),a=Math.floor(t%0x100000000);return r9.box(r9.types.traf,r9.box(r9.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),r9.box(r9.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a])),r9.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||0xffffffff,r9.box(r9.types.trak,r9.tkhd(e),r9.mdia(e))}static trex(e){let t=e.id;return r9.box(r9.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){let r,i,n,a,s,o;let l=e.samples||[],u=l.length,c=12+16*u,h=new Uint8Array(c);for(t+=8+c,h.set(["video"===e.type?1:0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),r=0;r<u;r++)n=(i=l[r]).duration,a=i.size,s=i.flags,o=i.cts,h.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,o>>>24&255,o>>>16&255,o>>>8&255,255&o],12+16*r);return r9.box(r9.types.trun,h)}static initSegment(e){r9.types||r9.init();let t=r9.moov(e);return J(r9.FTYP,t)}static hvc1(e){let t=e.params,r=[e.vps,e.sps,e.pps],i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]),n=i.length;for(let e=0;e<r.length;e+=1){n+=3;for(let t=0;t<r[e].length;t+=1)n+=2+r[e][t].length}let a=new Uint8Array(n);a.set(i,0),n=i.length;let s=r.length-1;for(let e=0;e<r.length;e+=1){a.set(new Uint8Array([32+e|(e===s?128:0),0,r[e].length]),n),n+=3;for(let t=0;t<r[e].length;t+=1)a.set(new Uint8Array([r[e][t].length>>8,255&r[e][t].length]),n),n+=2,a.set(r[e][t],n),n+=r[e][t].length}let o=r9.box(r9.types.hvcC,a),l=e.width,u=e.height,c=e.pixelRatio[0],h=e.pixelRatio[1];return r9.box(r9.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,r9.box(r9.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),r9.box(r9.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,h>>24,h>>16&255,h>>8&255,255&h])))}}function r7(e,t,r=1,i=!1){let n=e*t*r;return i?Math.round(n):n}function ie(e,t=!1){return r7(e,1e3,11111111111111112e-21,t)}r9.types=void 0,r9.HDLR_TYPES=void 0,r9.STTS=void 0,r9.STSC=void 0,r9.STCO=void 0,r9.STSZ=void 0,r9.VMHD=void 0,r9.SMHD=void 0,r9.STSD=void 0,r9.FTYP=void 0,r9.DINF=void 0;let it=null,ir=null;function ii(e,t,r,i){return{duration:t,size:r,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class ia extends y{constructor(e,t,r,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===it){let e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);it=e?parseInt(e[1]):0}if(null===ir){let e=navigator.userAgent.match(/Safari\/(\d+)/i);ir=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1,r=e[0].pts,i=e.reduce((e,i)=>{let n=i.pts,a=n-e;return(a<-0x100000000&&(t=!0,a=(n=is(n,r))-e),a>0)?e:n},r);return t&&this.debug("PTS rollover detected"),i}remux(e,t,r,i,n,a,s,o){let l,u,c,h,d,p;let m=n,g=n,A=e.pid>-1,v=t.pid>-1,y=t.samples.length,E=e.samples.length>0,x=s&&y>0||y>1;if((!A||E)&&(!v||x)||this.ISGenerated||s){let r;if(this.ISGenerated){var _,b,S,w;let e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(_=t.pixelRatio)?void 0:_[0])!==(null==(b=e.pixelRatio)?void 0:b[0])||(null==(S=t.pixelRatio)?void 0:S[1])!==(null==(w=e.pixelRatio)?void 0:w[1]))||!e&&x||null===this.nextAudioTs&&E)&&this.resetInitSegment()}this.ISGenerated||(c=this.generateIS(e,t,n,a));let i=this.isVideoContiguous,s=-1;if(x&&(s=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return -1}(t.samples),!i&&this.config.forceKeyFrameOnDiscontinuity)){if(p=!0,s>0){this.warn(`Dropped ${s} out of ${y} video samples due to a missing keyframe`);let e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(s),t.dropped+=s,g+=(t.samples[0].pts-e)/t.inputTimeScale,r=g}else -1===s&&(this.warn(`No keyframe found out of ${y} video samples`),p=!1)}if(this.ISGenerated){if(E&&x){let r=this.getVideoStartPts(t.samples),i=(is(e.samples[0].pts,r)-r)/t.inputTimeScale;m+=Math.max(0,i),g+=Math.max(0,-i)}if(E){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),c=this.generateIS(e,t,n,a)),u=this.remuxAudio(e,m,this.isAudioContiguous,a,v||x||o===f.AUDIO?g:void 0),x){let r=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),c=this.generateIS(e,t,n,a)),l=this.remuxVideo(t,g,i,r)}}else x&&(l=this.remuxVideo(t,g,i,0));l&&(l.firstKeyFrame=s,l.independent=-1!==s,l.firstKeyFramePTS=r)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(d=io(r,n,this._initPTS,this._initDTS)),i.samples.length&&(h=il(i,n,this._initPTS))),{audio:u,video:l,initSegment:c,independent:p,text:h,id3:d}}generateIS(e,t,r,i){let n,a,s;let o=e.samples,l=t.samples,u=this.typeSupported,c={},h=this._initPTS,d=!h||i,f="audio/mp4",p=-1;if(d&&(n=a=1/0),e.config&&o.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(f="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}c.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&u.mpeg?new Uint8Array(0):r9.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(p=e.id,s=e.inputTimeScale,h&&s===h.timescale?d=!1:n=a=o[0].pts-Math.round(s*r))}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:r9.initSegment([t]),metadata:{width:t.width,height:t.height}},d){if(p=t.id,s=t.inputTimeScale,h&&s===h.timescale)d=!1;else{let e=this.getVideoStartPts(l),t=Math.round(s*r);a=Math.min(a,is(l[0].dts,e)-t),n=Math.min(n,e-t)}}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(c).length)return this.ISGenerated=!0,d?(h&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${r} ${n/s} != initPTS: ${h.baseTime/h.timescale} (${h.baseTime}/${h.timescale}) trackId: ${h.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${n/s} (${n}/${s}) trackId: ${p}`),this._initPTS={baseTime:n,timescale:s,trackId:p},this._initDTS={baseTime:a,timescale:s,trackId:p}):n=s=void 0,{tracks:c,initPTS:n,timescale:s,trackId:p}}remuxVideo(e,t,r,i){let n,a,s;let c=e.inputTimeScale,h=e.samples,d=[],f=h.length,p=this._initPTS,m=p.baseTime*c/p.timescale,A=this.nextVideoTs,v=8,y=this.videoSampleDuration,E=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,_=!1;if(!r||null===A){let e=m+t*c,i=h[0].pts-is(h[0].dts,h[0].pts);it&&null!==A&&15e3>Math.abs(e-i-(A+m))?r=!0:A=e-i-m}let b=A+m;for(let e=0;e<f;e++){let t=h[e];t.pts=is(t.pts,b),t.dts=is(t.dts,b),t.dts<h[e>0?e-1:e].dts&&(_=!0)}_&&h.sort(function(e,t){let r=e.dts-t.dts,i=e.pts-t.pts;return r||i}),n=h[0].dts;let S=(a=h[h.length-1].dts)-n,w=S?Math.round(S/(f-1)):y||e.inputTimeScale/30;if(r){let r=n-b,i=r>w,a=r<-1;if((i||a)&&(i?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ie(r,!0)} ms (${r}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ie(-r,!0)} ms (${r}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!a||b>=h[0].pts||it)){n=b;let e=h[0].pts-r;if(i)h[0].dts=n,h[0].pts=e;else{let t=!0;for(let i=0;i<h.length&&(!(h[i].dts>e)||!t);i++){let e=h[i].pts;if(h[i].dts-=r,h[i].pts-=r,i<h.length-1){let r=h[i+1].pts;t=r<=h[i].pts==r<=e}}}this.log(`Video: Initial PTS/DTS adjusted: ${ie(e,!0)}/${ie(n,!0)}, delta: ${ie(r,!0)} ms`)}}let C=0,T=0,I=n=Math.max(0,n);for(let e=0;e<f;e++){let t=h[e],r=t.units,i=r.length,n=0;for(let e=0;e<i;e++)n+=r[e].data.length;T+=n,C+=i,t.length=n,t.dts<I?(t.dts=I,I+=w/4|0||1):I=t.dts,E=Math.min(t.pts,E),x=Math.max(t.pts,x)}a=h[f-1].dts;let M=T+4*C+8;try{s=new Uint8Array(M)}catch(e){this.observer.emit(u.ERROR,u.ERROR,{type:o.MUX_ERROR,details:l.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:M,reason:`fail allocating video mdat ${M}`});return}let R=new DataView(s.buffer);R.setUint32(0,M),s.set(r9.types.mdat,4);let B=!1,D=Number.POSITIVE_INFINITY,P=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY;for(let e=0;e<f;e++){let t;let r=h[e],n=r.units,a=0;for(let e=0,t=n.length;e<t;e++){let t=n[e],r=t.data,i=t.data.byteLength;R.setUint32(v,i),v+=4,s.set(r,v),v+=i,a+=4+i}if(e<f-1)y=h[e+1].dts-r.dts,t=h[e+1].pts-r.pts;else{let n=this.config,a=e>0?r.dts-h[e-1].dts:w;if(t=e>0?r.pts-h[e-1].pts:w,n.stretchShortVideoTrack&&null!==this.nextAudioTs){let e=Math.floor(n.maxBufferHole*c),t=(i?E+i*c:this.nextAudioTs+m)-r.pts;t>e?((y=t-a)<0?y=a:B=!0,this.log(`It is approximately ${t/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=a}else y=a}let o=Math.round(r.pts-r.dts);D=Math.min(D,y),L=Math.max(L,y),P=Math.min(P,t),k=Math.max(k,t),d.push(ii(r.key,y,a,o))}if(d.length){if(it){if(it<70){let e=d[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(ir&&k-P<L-D&&w/L<.025&&0===d[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=n;for(let t=0,r=d.length;t<r;t++){let i=e+d[t].duration,n=e+d[t].cts;if(t<r-1){let e=i+d[t+1].cts;d[t].duration=e-n}else d[t].duration=t?d[t-1].duration:w;d[t].cts=0,e=i}}}let F=a+(y=B||!y?w:y);this.nextVideoTs=A=F-m,this.videoSampleDuration=y,this.isVideoContiguous=!0;let O={data1:r9.moof(e.sequenceNumber++,n,g(e,{samples:d})),data2:s,startPTS:(E-m)/c,endPTS:(x+y-m)/c,startDTS:(n-m)/c,endDTS:A/c,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:e.dropped};return e.samples=[],e.dropped=0,O}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,r,i,n){let a;let s=e.inputTimeScale,c=e.samplerate?e.samplerate:s,h=s/c,d=this.getSamplesPerFrame(e),f=d*h,p=this._initPTS,m="mp3"===e.segmentCodec&&this.typeSupported.mpeg,A=[],v=void 0!==n,y=e.samples,E=m?0:8,x=this.nextAudioTs||-1,_=p.baseTime*s/p.timescale,b=_+t*s;if(this.isAudioContiguous=r=r||y.length&&x>0&&(i&&9e3>Math.abs(b-(x+_))||Math.abs(is(y[0].pts,b)-(x+_))<20*f),y.forEach(function(e){e.pts=is(e.pts,b)}),!r||x<0){if(!(y=y.filter(e=>e.pts>=0)).length)return;x=0===n?0:i&&!v?Math.max(0,b-_):y[0].pts-_}if("aac"===e.segmentCodec){let t=this.config.maxAudioFramesDrift;for(let r=0,i=x+_;r<y.length;r++){let n=y[r],a=n.pts,o=a-i,l=Math.abs(1e3*o/s);if(o<=-t*f&&v)0===r&&(this.warn(`Audio frame @ ${(a/s).toFixed(3)}s overlaps marker by ${Math.round(1e3*o/s)} ms.`),this.nextAudioTs=x=a-_,i=a);else if(o>=t*f&&l<1e4&&v){let t=Math.round(o/f);for(i=a-t*f;i<0&&t&&f;)t--,i+=f;0===r&&(this.nextAudioTs=x=i-_),this.warn(`Injecting ${t} audio frames @ ${((i-_)/s).toFixed(3)}s due to ${Math.round(1e3*o/s)} ms gap.`);for(let a=0;a<t;a++){let t=r8.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);t||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),t=n.unit.subarray()),y.splice(r,0,{unit:t,pts:i}),i+=f,r++}}n.pts=i,i+=f}}let S=null,w=null,C=0,T=y.length;for(;T--;)C+=y[T].unit.byteLength;for(let t=0,i=y.length;t<i;t++){let i=y[t],n=i.unit,s=i.pts;if(null!==w)A[t-1].duration=Math.round((s-w)/h);else{if(r&&"aac"===e.segmentCodec&&(s=x+_),S=s,!(C>0))return;C+=E;try{a=new Uint8Array(C)}catch(e){this.observer.emit(u.ERROR,u.ERROR,{type:o.MUX_ERROR,details:l.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:C,reason:`fail allocating audio mdat ${C}`});return}m||(new DataView(a.buffer).setUint32(0,C),a.set(r9.types.mdat,4))}a.set(n,E);let c=n.byteLength;E+=c,A.push(ii(!0,d,c,0)),w=s}let I=A.length;if(!I)return;let M=A[A.length-1];x=w-_,this.nextAudioTs=x+h*M.duration;let R=m?new Uint8Array(0):r9.moof(e.sequenceNumber++,S/h,g({},e,{samples:A}));e.samples=[];let B=(S-_)/s,D=x/s,P={data1:R,data2:a,startPTS:B,endPTS:D,startDTS:B,endDTS:D,type:"audio",hasAudio:!0,hasVideo:!1,nb:I};return this.isAudioContiguous=!0,P}}function is(e,t){let r;if(null===t)return e;for(r=t<e?-0x200000000:0x200000000;Math.abs(e-t)>0x100000000;)e+=r;return e}function io(e,t,r,i){let n=e.samples.length;if(!n)return;let a=e.inputTimeScale;for(let s=0;s<n;s++){let n=e.samples[s];n.pts=is(n.pts-r.baseTime*a/r.timescale,t*a)/a,n.dts=is(n.dts-i.baseTime*a/i.timescale,t*a)/a}let s=e.samples;return e.samples=[],{samples:s}}function il(e,t,r){let i=e.samples.length;if(!i)return;let n=e.inputTimeScale;for(let a=0;a<i;a++){let i=e.samples[a];i.pts=is(i.pts-r.baseTime*n/r.timescale,t*n)/n}e.samples.sort((e,t)=>e.pts-t.pts);let a=e.samples;return e.samples=[],{samples:a}}class iu extends y{constructor(e,t,r,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;let t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:i}=this;if(!(null!=e&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}let{audio:n,video:a}=this.initData=j(e);if(t)!function(e,t){if(!e||!t)return;let r=t.keyId;r&&t.isCommonEncryption&&W(e,["moov","trak"]).forEach(e=>{let t=W(e,["mdia","minf","stbl","stsd"])[0].subarray(8),i=W(t,["enca"]),n=i.length>0;n||(i=W(t,["encv"])),i.forEach(e=>{W(n?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{let t=$(e);if(t){let e=t.subarray(8,24);e.some(e=>0!==e)||(S.log(`[eme] Patching keyId in 'enc${n?"a":"v"}>sinf>>tenc' box: ${I(e)} -> ${I(r)}`),t.set(r,8))}})})})}(e,t);else{let e=n||a;null!=e&&e.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${e.codec}")!`)}n&&(r=ih(n,P.AUDIO,this)),a&&(i=ih(a,P.VIDEO,this));let s={};n&&a?s.audiovideo={container:"video/mp4",codec:r+","+i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:n?s.audio={container:"audio/mp4",codec:r,encrypted:n.encrypted,initSegment:e,id:"audio"}:a?s.video={container:"video/mp4",codec:i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,r,i,a,s){var o,l;let{initPTS:u,lastEndTime:c}=this,h={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};n(c)||(c=this.lastEndTime=a||0);let d=t.samples;if(!d.length)return h;let f={initPTS:void 0,timescale:void 0,trackId:void 0},p=this.initData;if(null!=(o=p)&&o.length||(this.generateInitSegment(d),p=this.initData),!(null!=(l=p)&&l.length))return this.warn("Failed to generate initSegment."),h;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);let m=function(e,t,r){let i={},a=W(e,["moof","traf"]);for(let e=0;e<a.length;e++){let s=a[e],o=W(s,["tfhd"])[0],l=H(o,4),u=t[l];if(!u)continue;i[l]||(i[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});let c=i[l],h=W(s,["tfdt"])[0];if(h){let e=h[0],t=H(h,4);1===e&&(0xffffffff===t?r.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(t*=0x100000000,t+=H(h,8))),n(t)&&(!n(c.start)||t<c.start)&&(c.start=t)}let d=u.default,f=H(o,0)|(null==d?void 0:d.flags),p=(null==d?void 0:d.duration)||0;8&f&&(p=2&f?H(o,12):H(o,8));let m=W(s,["trun"]),g=c.start||0,A=0,v=p;for(let e=0;e<m.length;e++){let t=m[e],r=H(t,4),i=c.sampleCount;c.sampleCount+=r;let n=1&t[3],a=4&t[3],s=1&t[2],o=2&t[2],l=4&t[2],u=8&t[2],h=8,d=r;for(n&&(h+=4),a&&r&&(1&t[h+1]||void 0!==c.keyFrameIndex||(c.keyFrameIndex=i),h+=4,s?(v=H(t,h),h+=4):v=p,o&&(h+=4),u&&(h+=4),g+=v,A+=v,d--);d--;)s?(v=H(t,h),h+=4):v=p,o&&(h+=4),l&&(1&t[h+1]||void 0!==c.keyFrameIndex||(c.keyFrameIndex=c.sampleCount-(d+1),c.keyFrameStart=g),h+=4),u&&(h+=4),g+=v,A+=v;!A&&p&&(A+=p*r)}c.duration+=A}if(!Object.keys(i).some(e=>i[e].duration)){let t=1/0,r=0,a=W(e,["sidx"]);for(let e=0;e<a.length;e++){let i=function(e){let t=[],r=e[0],i=8,n=H(e,8);i+=4;let a=0,s=0;0===r?(a=H(e,i),s=H(e,i+4),i+=8):(a=Q(e,i),s=Q(e,i+8),i+=16),i+=2;let o=e.length+s,l=G(e,i);i+=2;for(let r=0;r<l;r++){let r=i,a=H(e,r);r+=4;let s=0x7fffffff&a;if(1==(0x80000000&a)>>>31)return S.warn("SIDX has hierarchical references (not supported)"),null;let l=H(e,r);r+=4,t.push({referenceSize:s,subsegmentDuration:l,info:{duration:l/n,start:o,end:o+s-1}}),o+=s,r+=4,i=r}return{earliestPresentationTime:a,timescale:n,version:r,referencesCount:l,references:t}}(a[e]);if(null!=i&&i.references){t=Math.min(t,i.earliestPresentationTime/i.timescale);let e=i.references.reduce((e,t)=>e+t.info.duration||0,0);r=Math.max(r,e+i.earliestPresentationTime/i.timescale)}}r&&n(r)&&Object.keys(i).forEach(e=>{i[e].duration||(i[e].duration=r*i[e].timescale-i[e].start)})}return i}(d,p,this),g=p.audio?m[p.audio.id]:null,A=p.video?m[p.video.id]:null,v=ic(A,1/0),y=ic(g,1/0),E=ic(A,0,!0),x=ic(g,0,!0),_=a,b=0,w=g&&(!A||!u&&y<v||u&&u.trackId===p.audio.id),C=w?g:A;if(C){let e=C.timescale,t=C.start-a*e,r=w?p.audio.id:p.video.id;_=C.start/e,b=w?x-y:E-v,(s||!u)&&(function(e,t,r,i){if(null===e)return!0;let n=Math.max(i,1);return Math.abs(t-e.baseTime/e.timescale-r)>n}(u,_,a,b)||e!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${a} ${t/e} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${a} offset: ${_-a} (${t}/${e}) trackId: ${r}`),u=null,f.initPTS=t,f.timescale=e,f.trackId=r)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${a}`);u?(f.initPTS=u.baseTime,f.timescale=u.timescale,f.trackId=u.trackId):(f.timescale&&void 0!==f.trackId&&void 0!==f.initPTS||(this.warn("Could not set initPTS"),f.initPTS=_,f.timescale=1,f.trackId=-1),this.initPTS=u={baseTime:f.initPTS,timescale:f.timescale,trackId:f.trackId});let T=_-u.baseTime/u.timescale,I=T+b;b>0?this.lastEndTime=I:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());let M=!!p.audio,R=!!p.video,B="";M&&(B+="audio"),R&&(B+="video");let D={data1:d,startPTS:T,startDTS:T,endPTS:I,endDTS:I,type:B,hasAudio:M,hasVideo:R,nb:1,dropped:0,encrypted:!!p.audio&&p.audio.encrypted||!!p.video&&p.video.encrypted};h.audio=M&&!R?D:void 0,h.video=R?D:void 0;let P=null==A?void 0:A.sampleCount;if(P){let e=A.keyFrameIndex,t=-1!==e;D.nb=P,D.dropped=0===e||this.isVideoContiguous?0:t?e:P,D.independent=t,D.firstKeyFrame=e,t&&A.keyFrameStart&&(D.firstKeyFramePTS=(A.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(h.independent=t),this.isVideoContiguous||(this.isVideoContiguous=t),D.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${e}/${P} dropped: ${D.dropped} start: ${D.firstKeyFramePTS||"NA"}`)}return h.initSegment=f,h.id3=io(r,a,u,u),i.samples.length&&(h.text=il(i,a,u)),h}}function ic(e,t,r=!1){return(null==e?void 0:e.start)!==void 0?(e.start+(r?e.duration:0))/e.timescale:t}function ih(e,t,r){let i=e.codec;return i&&i.length>4?i:t===P.AUDIO?"ec-3"===i||"ac-3"===i||"alac"===i?i:"fLaC"===i||"Opus"===i?ef(i,!1):(r.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(r.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}try{i=self.performance.now.bind(self.performance)}catch(e){i=Date.now}let id=[{demux:rq,remux:iu},{demux:r2,remux:ia},{demux:rQ,remux:ia},{demux:rY,remux:ia}];id.splice(2,0,{demux:rW,remux:ia});class ip{constructor(e,t,r,i,n,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=n,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,n){let a;let s=r.transmuxing;s.executeStart=i();let c=new Uint8Array(e),{currentTransmuxState:h,transmuxConfig:d}=this;n&&(this.currentTransmuxState=n);let{contiguous:f,discontinuity:p,trackSwitch:m,accurateTimeOffset:g,timeOffset:A,initSegmentChange:v}=n||h,{audioCodec:y,videoCodec:E,defaultInitPts:x,duration:_,initSegmentData:b}=d,S=(a=null,c.byteLength>0&&(null==t?void 0:t.key)!=null&&null!==t.iv&&null!=t.method&&(a=t),a);if(S&&t_(S.method)){let e=this.getDecrypter(),t=tb(S.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(c,S.key.buffer,S.iv.buffer,t).then(e=>{let t=this.push(e,null,r);return this.decryptionPromise=null,t}),this.decryptionPromise;{let n=e.softwareDecrypt(c,S.key.buffer,S.iv.buffer,t);if(r.part>-1){let t=e.flush();n=t?t.buffer:t}if(!n)return s.executeEnd=i(),im(r);c=new Uint8Array(n)}}let w=this.needsProbing(p,m);if(w){let e=this.configureTransmuxer(c);if(e)return this.logger.warn(`[transmuxer] ${e.message}`),this.observer.emit(u.ERROR,u.ERROR,{type:o.MEDIA_ERROR,details:l.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),s.executeEnd=i(),im(r)}(p||m||v||w)&&this.resetInitSegment(b,y,E,_,t),(p||v||w)&&this.resetInitialTimestamp(x),f||this.resetContiguity();let C=this.transmux(c,S,A,g,r);this.asyncResult=ig(C);let T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,s.executeEnd=i(),C}flush(e){let t=e.transmuxing;t.executeStart=i();let{decrypter:r,currentTransmuxState:n,decryptionPromise:a}=this;if(a)return this.asyncResult=!0,a.then(()=>this.flush(e));let s=[],{timeOffset:o}=n;if(r){let t=r.flush();t&&s.push(this.push(t.buffer,null,e))}let{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=i();let r=[im(e)];return this.asyncResult?Promise.resolve(r):r}let c=l.flush(o);return ig(c)?(this.asyncResult=!0,c.then(t=>(this.flushRemux(s,t,e),s))):(this.flushRemux(s,c,e),this.asyncResult)?Promise.resolve(s):s}flushRemux(e,t,r){let{audioTrack:n,videoTrack:a,id3Track:s,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===f.MAIN?"level":"track"} ${r.level}`);let c=this.remuxer.remux(n,a,s,o,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=i()}resetInitialTimestamp(e){let{demuxer:t,remuxer:r}=this;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){let{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,i,n){let{demuxer:a,remuxer:s}=this;a&&s&&(a.resetInitSegment(e,t,r,i),s.resetInitSegment(e,t,r,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,i,n){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,i,n):this.transmuxUnencrypted(e,r,i,n)}transmuxUnencrypted(e,t,r,i){let{audioTrack:n,videoTrack:a,id3Track:s,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n,a,s,o,t,r,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,r,i,n){return this.demuxer.demuxSampleAes(e,t,r).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,r,i,!1,this.id),chunkMeta:n}))}configureTransmuxer(e){let t;let{config:r,observer:i,typeSupported:n}=this;for(let r=0,i=id.length;r<i;r++){var a;if(null!=(a=id[r].demux)&&a.probe(e,this.logger)){t=id[r];break}}if(!t)return Error("Failed to find demuxer by probing fragment data");let s=this.demuxer,o=this.remuxer,l=t.remux,u=t.demux;o&&o instanceof l||(this.remuxer=new l(i,r,n,this.logger)),s&&s instanceof u||(this.demuxer=new u(i,r,n,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new tr(this.config)),e}}let im=e=>({remuxResult:{},chunkMeta:e});function ig(e){return"then"in e&&e.then instanceof Function}class iA{constructor(e,t,r,i,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=n||null}}class iv{constructor(e,t,r,i,n,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=n,this.initSegmentChange=a}}let iy=0;class iE{constructor(e,t,r,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=iy++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{let t=e.data,r=this.hls;if(r&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var i;let e=null==(i=this.workerContext)?void 0:i.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":r.logger[t.data.logType]&&r.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,r.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;let t=Error(`${e.message}  (${e.filename}:${e.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(u.ERROR,{type:o.OTHER_ERROR,details:l.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};let n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;let a=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===u.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new rd,this.observer.on(u.FRAG_DECRYPTED,a),this.observer.on(u.ERROR,a);let s=eg(n.preferManagedMediaSource);if(this.useWorker&&"undefined"!=typeof Worker){let r=this.hls.logger;if(n.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{n.workerPath?(r.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=function(e){let t=rp[e];if(t)return t.clientCount++,t;let r=new self.URL(e,self.location.href).href,i={worker:new self.Worker(r),scriptURL:r,clientCount:1};return rp[e]=i,i}(n.workerPath)):(r.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){let e=rp[rf];if(e)return e.clientCount++,e;let t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),r=self.URL.createObjectURL(t),i={worker:new self.Worker(r),objectURL:r,clientCount:1};return rp[rf]=i,i}());let{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:s,id:t,config:eB(n)})}catch(i){r.warn(`Error setting up "${t}" Web Worker, fallback to inline`,i),this.terminateWorker(),this.error=null,this.transmuxer=new ip(this.observer,s,n,"",t,e.logger)}return}}this.transmuxer=new ip(this.observer,s,n,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){let e=this.instanceNo;this.instanceNo=iy++;let t=this.hls.config,r=eg(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:eB(t)})}}terminateWorker(){if(this.workerContext){let{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){let t=rp[e||rf];if(t&&1==t.clientCount--){let{worker:r,objectURL:i}=t;delete rp[e||rf],i&&self.URL.revokeObjectURL(i),r.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{let e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}let e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,i,n,a,s,o,l,u){var c,h;l.transmuxing.start=self.performance.now();let{instanceNo:d,transmuxer:p}=this,m=a?a.start:n.start,g=n.decryptdata,A=this.frag,v=!(A&&n.cc===A.cc),y=!(A&&l.level===A.level),E=A?l.sn-A.sn:-1,x=this.part?l.part-this.part.index:-1,_=0===E&&l.id>1&&l.id===(null==A?void 0:A.stats.chunkCount),b=!y&&(1===E||0===E&&(1===x||_&&x<=0)),S=self.performance.now();(y||E||0===n.stats.parsing.start)&&(n.stats.parsing.start=S),a&&(x||!b)&&(a.stats.parsing.start=S);let w=!(A&&(null==(c=n.initSegment)?void 0:c.url)===(null==(h=A.initSegment)?void 0:h.url)),C=new iv(v,b,o,y,m,w);if(!b||v||w){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${n.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===f.MAIN?"level":"track"}: ${l.level} id: ${l.id}
        discontinuity: ${v}
        trackSwitch: ${y}
        contiguous: ${b}
        accurateTimeOffset: ${o}
        timeOffset: ${m}
        initSegmentChange: ${w}`);let e=new iA(r,i,t,s,u);this.configureTransmuxer(e)}if(this.frag=n,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:d,cmd:"demux",data:e,decryptdata:g,chunkMeta:l,state:C},e instanceof ArrayBuffer?[e]:[]);else if(p){let t=p.push(e,g,l,C);ig(t)?t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();let{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){let t=r.flush(e);ig(t)?t.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}):this.handleFlushResult(t,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}configureTransmuxer(e){let{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class ix extends rl{constructor(e,t,r){super(e,t,r,"audio-stream-controller",f.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(u.LEVEL_LOADED,this.onLevelLoaded,this),e.on(u.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(u.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(u.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(u.BUFFER_RESET,this.onBufferReset,this),e.on(u.BUFFER_CREATED,this.onBufferCreated,this),e.on(u.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(u.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(u.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(u.FRAG_LOADING,this.onFragLoading,this),e.on(u.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){let{hls:e}=this;e&&(super.unregisterListeners(),e.off(u.LEVEL_LOADED,this.onLevelLoaded,this),e.off(u.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(u.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(u.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(u.BUFFER_RESET,this.onBufferReset,this),e.off(u.BUFFER_CREATED,this.onBufferCreated,this),e.off(u.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(u.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(u.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(u.FRAG_LOADING,this.onFragLoading,this),e.off(u.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:n,trackId:a}){if(r===f.MAIN){let e=t.cc,r=this.fragCurrent;if(this.initPTS[e]={baseTime:i,timescale:n,trackId:a},this.log(`InitPTS for cc: ${e} found from main: ${i/n} (${i}/${n}) trackId: ${a}`),this.mainAnchor=t,this.state===ro.WAITING_INIT_PTS){let r=this.waitingData;(r||this.loadingParts)&&(!r||r.frag.cc===e)||this.syncWithAnchor(t,null==r?void 0:r.frag)}else!this.hls.hasEnoughToStart&&r&&r.cc!==e?(r.abortRequests(),this.syncWithAnchor(t,r)):this.state===ro.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;let i=(null==(r=this.mainFragLoading)?void 0:r.frag)||null;if(t&&(null==i?void 0:i.cc)===t.cc)return;let n=(i||e).cc,a=eV(this.getLevelDetails(),n,this.getLoadPosition());a&&(this.log(`Syncing with main frag at ${a.start} cc ${a.cc}`),this.startFragRequested=!1,this.nextLoadPosition=a.start,this.resetLoadingState(),this.state===ro.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ro.STOPPED;return}let r=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),r>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=ro.IDLE):this.state=ro.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ro.IDLE:this.doTickIdle();break;case ro.WAITING_TRACK:{let{levels:e,trackId:t}=this,r=null==e?void 0:e[t],i=null==r?void 0:r.details;if(i&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(i))break;this.state=ro.WAITING_INIT_PTS}break}case ro.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break;case ro.WAITING_INIT_PTS:{let e=this.waitingData;if(e){let{frag:t,part:r,cache:i,complete:n}=e,a=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=ro.FRAG_LOADING;let e={frag:t,part:r,payload:i.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),n&&super._handleFragmentLoadComplete(e)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=ro.IDLE}}this.onTickEnd()}resetLoadingState(){let e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){let{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;let{hls:t,levels:r,media:i,trackId:n}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(null!=r&&r[n]))return;let s=r[n],o=s.details;if(!o||this.waitForLive(s)||this.waitForCdnTuneIn(o)){this.state=ro.WAITING_TRACK,this.startFragRequested=!1;return}let l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,P.AUDIO,f.AUDIO));let c=this.getFwdBufferInfo(l,f.AUDIO);if(null===c)return;if(!this.switchingTrack&&this._streamEnded(c,o)){t.trigger(u.BUFFER_EOS,{type:"audio"}),this.state=ro.ENDED;return}let h=c.len,d=t.maxBufferLength,p=o.fragments,m=p[0].start,g=this.getLoadPosition(),A=this.flushing?g:c.end;if(this.switchingTrack&&i&&o.PTSKnown&&g<m&&(c.end>m||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=m+.05),h>=d&&!this.switchingTrack&&A<p[p.length-1].start)return;let v=this.getNextFragment(A,o);if(v&&this.isLoopLoading(v,A)&&(v=this.getNextFragmentLoopLoading(v,o,c,f.MAIN,d)),!v){this.bufferFlushed=!0;return}let y=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&y&&k(v)&&!v.endList&&(!o.live||!this.loadingParts&&A<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(y)===e3.OK&&(this.mainFragLoading=y=null),y&&k(y))){if(v.start>y.end){let e=this.fragmentTracker.getFragAtPos(A,f.MAIN);e&&e.end>y.end&&(y=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(v.start>y.end)return}this.loadFragment(v,s,A)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(e=>new eI(e))}onAudioTrackSwitching(e,t){let r=!!t.url;this.trackId=t.id;let{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ro.STOPPED&&(this.setInterval(100),this.state=ro.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;let r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(u.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r,i;let{levels:n}=this,{details:a,id:s,groupId:o,track:l}=t;if(!n){this.warn(`Audio tracks reset while loading track ${s} "${l.name}" of "${o}"`);return}let c=this.mainDetails;if(!c||a.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==ro.STOPPED&&(this.state=ro.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${s} "${l.name}" of "${o}" loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`);let h=n[s],d=0;if(a.live||null!=(r=h.details)&&r.live){if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;h.details&&(d=this.alignPlaylists(a,h.details,null==(i=this.levelLastLoaded)?void 0:i.details)),a.alignedSliding||(rr(a,c),a.alignedSliding||ri(a,c),d=a.fragmentStart)}h.details=a,this.levelLastLoaded=h,this.startFragRequested||this.setStartPosition(c,d),this.hls.trigger(u.AUDIO_TRACK_UPDATED,{details:a,id:s,groupId:t.groupId}),this.state!==ro.WAITING_TRACK||this.waitForCdnTuneIn(a)||(this.state=ro.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;let r=e.frag,{part:i,payload:n}=e,{config:a,trackId:s,levels:o}=this;if(!o){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}let l=o[s];if(!l){this.warn("Audio track is undefined on fragment load progress");return}let u=l.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}let c=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2",h=this.transmuxer;h||(h=this.transmuxer=new iE(this.hls,f.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));let d=this.initPTS[r.cc],p=null==(t=r.initSegment)?void 0:t.data;if(void 0!==d){let e=i?i.index:-1,t=new tl(r.level,r.sn,r.stats.chunkCount,n.byteLength,e,-1!==e);h.push(n,p,c,"",r,i,u.totalduration,!1,t,d)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${u.startSN} ,${u.endSN}],track ${s}`);let{cache:e}=this.waitingData=this.waitingData||{frag:r,part:i,cache:new rc,complete:!1};e.push(new Uint8Array(n)),this.state!==ro.STOPPED&&(this.state=ro.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;let r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===f.MAIN&&k(t.frag)&&(this.mainFragLoading=t,this.state===ro.IDLE&&this.tick())}onFragBuffered(e,t){let{frag:r,part:i}=t;if(r.type!==f.AUDIO){this.audioOnly||r.type!==f.MAIN||r.elementaryStreams.video||r.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(k(r)){this.fragPrevious=r;let e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(u.AUDIO_TRACK_SWITCHED,v({},e)))}this.fragBufferedComplete(r,i),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=ro.ERROR;return}switch(t.details){case l.FRAG_GAP:case l.FRAG_PARSING_ERROR:case l.FRAG_DECRYPT_ERROR:case l.FRAG_LOAD_ERROR:case l.FRAG_LOAD_TIMEOUT:case l.KEY_LOAD_ERROR:case l.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(f.AUDIO,t);break;case l.AUDIO_TRACK_LOAD_ERROR:case l.AUDIO_TRACK_LOAD_TIMEOUT:case l.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==ro.WAITING_TRACK||(null==(r=t.context)?void 0:r.type)!==d.AUDIO_TRACK||(this.state=ro.IDLE);break;case l.BUFFER_ADD_CODEC_ERROR:case l.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case l.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case l.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,{type:t}){t!==P.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==P.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ro.ENDED&&(this.state=ro.IDLE);let e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,f.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;let r="audio",{hls:i}=this,{remuxResult:n,chunkMeta:a}=e,s=this.getCurrentContext(a);if(!s){this.resetWhenMissingContext(a);return}let{frag:o,part:l,level:c}=s,{details:h}=c,{audio:d,text:f,id3:p,initSegment:m}=n;if(this.fragContextChanged(o)||!h){this.fragmentTracker.removeFragment(o);return}if(this.state=ro.PARSING,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),null!=m&&m.tracks){let e=o.initSegment||o;if(this.unhandledEncryptionError(m,o))return;this._bufferInitSegment(c,m.tracks,e,a),i.trigger(u.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:r,tracks:m.tracks})}if(d){let{startPTS:e,endPTS:t,startDTS:r,endDTS:i}=d;l&&(l.elementaryStreams[P.AUDIO]={startPTS:e,endPTS:t,startDTS:r,endDTS:i}),o.setElementaryStreamInfo(P.AUDIO,e,t,r,i),this.bufferFragmentData(d,o,l,a)}if(null!=p&&null!=(t=p.samples)&&t.length){let e=g({id:r,frag:o,details:h},p);i.trigger(u.FRAG_PARSING_METADATA,e)}if(f){let e=g({id:r,frag:o,details:h},f);i.trigger(u.FRAG_PARSING_USERDATA,e)}}_bufferInitSegment(e,t,r,i){if(this.state!==ro.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;let n=t.audio;n.id=f.AUDIO;let a=e.audioCodec;this.log(`Init audio buffer, container:${n.container}, codecs[level/parsed]=[${a}/${n.codec}]`),a&&1===a.split(",").length&&(n.levelCodec=a),this.hls.trigger(u.BUFFER_CODECS,t);let s=n.initSegment;if(null!=s&&s.byteLength){let e={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:s};this.hls.trigger(u.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,r){let i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===e3.NOT_LOADED||i===e3.PARTIAL){var n;if(k(e)){if(null!=(n=t.details)&&n.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ro.WAITING_INIT_PTS;let r=this.mainDetails;r&&r.fragmentStart!==t.details.fragmentStart&&ri(t.details,r)}else super.loadFragment(e,t,r)}else this._loadInitSegment(e,t)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){let{name:t,lang:r,assocLang:i,characteristics:n,audioCodec:a,channels:s}=this.bufferedTrack;eF({name:t,lang:r,assocLang:i,characteristics:n,audioCodec:a,channels:s},e,eO)||(eN(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){let{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(u.AUDIO_TRACK_SWITCHED,v({},e))}}class i_ extends y{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){let i=null==t?void 0:t.renditionReports;if(i){let n=-1;for(let r=0;r<i.length;r++){let a;let s=i[r];try{a=new self.URL(s.URI,t.url).href}catch(e){this.warn(`Could not construct new URL for Rendition Report: ${e}`),a=s.URI||""}if(a===e){n=r;break}a===e.substring(0,a.length)&&(n=r)}if(-1!==n){let e=i[n],a=parseInt(e["LAST-MSN"])||t.lastPartSn,s=parseInt(e["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){let e=Math.min(t.age-t.partTarget,t.targetduration);s>=0&&e>t.partTarget&&(s+=1)}return new eT(a,s>=0?s:void 0,r&&eC(r))}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}return e}playlistLoaded(e,t,r){let{details:i,stats:a}=t,s=self.performance.now(),c=a.loading.first?Math.max(0,s-a.loading.first):0;i.advancedDateTime=Date.now()-c;let h=this.hls.config.timelineOffset;if(h!==i.appliedTimelineOffset){let e=Math.max(h||0,0);i.appliedTimelineOffset=e,i.fragments.forEach(t=>{t.setStart(t.playlistOffset+e)})}if(i.live||null!=r&&r.live){let h,f,p;let m="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(r),r&&i.fragments.length>0){!function(e,t,r){let i;if(e===t)return;let a=null,s=e.fragments;for(let e=s.length-1;e>=0;e--){let t=s[e].initSegment;if(t){a=t;break}}e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,r){let i=t.skippedSegments,n=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let h=n;h<=a;h++){let n=l[s+h],a=o[h];if(i&&!a&&n&&(a=t.fragments[h]=n),n&&a){var u,c;r(n,a,h,o);let i=n.relurl,s=a.relurl;if(i&&(u=i)!==(c=s)&&c&&t9(u)!==t9(c)){t.playlistParsingError=t0(`media sequence mismatch ${a.sn}:`,e,t,n,a);return}if(n.cc!==a.cc){t.playlistParsingError=t0(`discontinuity sequence mismatch (${n.cc}!=${a.cc})`,e,t,n,a);return}}}}(e,t,(e,r,s,o)=>{if((!t.startCC||t.skippedSegments)&&r.cc!==e.cc){let i=e.cc-r.cc;for(let e=s;e<o.length;e++)o[e].cc+=i;t.endCC=o[o.length-1].cc}n(e.startPTS)&&n(e.endPTS)&&(r.setStart(r.startPTS=e.startPTS),r.startDTS=e.startDTS,r.maxStartPTS=e.maxStartPTS,r.endPTS=e.endPTS,r.endDTS=e.endDTS,r.minEndPTS=e.minEndPTS,r.setDuration(e.endPTS-e.startPTS),r.duration&&(i=r),t.PTSKnown=t.alignedSliding=!0),e.hasStreams&&(r.elementaryStreams=e.elementaryStreams),r.loader=e.loader,e.hasStats&&(r.stats=e.stats),e.initSegment&&(r.initSegment=e.initSegment,a=e.initSegment)});let o=t.fragments,l=t.fragmentHint?o.concat(t.fragmentHint):o;if(a&&l.forEach(e=>{var t;e&&(!e.initSegment||e.initSegment.relurl===(null==(t=a)?void 0:t.relurl))&&(e.initSegment=a)}),t.skippedSegments){if(t.deltaUpdateFailed=o.some(e=>!e),t.deltaUpdateFailed){r.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)o.shift();t.startSN=o[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=function(e,t,r){let{dateRanges:i,recentlyRemovedDateranges:n}=t,a=g({},e);n&&n.forEach(e=>{delete a[e]});let s=Object.keys(a).length;return s?(Object.keys(i).forEach(e=>{let t=a[e],n=new tv(i[e].attr,t);n.isValid?(a[e]=n,t||(n.tagOrder+=s)):r.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${eB(i[e].attr)}"`)}),a):i}(e.dateRanges,t,r));let i=e.fragments.filter(e=>e.rawProgramDateTime);if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<l.length;e++)null===l[e].programDateTime&&tY(l[e],l[e-1],i);tH(i,t)}t.endCC=o[o.length-1].cc}if(!t.startCC){var u;let r=t4(e,t.startSN-1);t.startCC=null!=(u=null==r?void 0:r.cc)?u:o[0].cc}(function(e,t,r){if(e&&t){let i=0;for(let n=0,a=e.length;n<=a;n++){let a=e[n],s=t[n+i];a&&s&&a.index===s.index&&a.fragment.sn===s.fragment.sn?r(a,s):i--}}})(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),i?tZ(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,r):t1(e,t),o.length&&(t.totalduration=t.edge-o[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;let c=t.advancedDateTime;if(t.advanced&&c){let e=t.edge;t.driftStart||(t.driftStartTime=c,t.driftStart=e),t.driftEndTime=c,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}(r,i,this);let e=i.playlistParsingError;if(e){this.warn(e);let r=this.hls;if(!r.config.ignorePlaylistParsingErrors){var d;let{networkDetails:n}=t;r.trigger(u.ERROR,{type:o.NETWORK_ERROR,details:l.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(d=i.fragments[0])?void 0:d.type,networkDetails:n,stats:a});return}i.playlistParsingError=null}}-1===i.requestScheduled&&(i.requestScheduled=a.loading.start);let A=this.hls.mainForwardBufferInfo,v=A?A.end-A.len:0,y=(i.edge-v)*1e3,E=t3(i,y);if(i.requestScheduled+E<s?i.requestScheduled=s:i.requestScheduled+=E,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;if(i.canBlockReload&&i.endSN&&i.advanced){let e=this.hls.config.lowLatencyMode,n=i.lastPartSn,a=i.endSN,o=i.lastPartIndex,l=n===a;-1!==o?l?(f=a+1,p=e?0:o):(f=n,p=e?o+1:i.maxPartIndex):f=a+1;let u=i.age,c=u+i.ageHeader,d=Math.min(c-i.partTarget,1.5*i.targetduration);if(d>0){if(c>3*i.targetduration)this.log(`Playlist last advanced ${u.toFixed(2)}s ago. Omitting segment and part directives.`),f=void 0,p=void 0;else if(null!=r&&r.tuneInGoal&&c-i.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${d} with playlist age: ${i.age}`),d=0;else{let e=Math.floor(d/i.targetduration);f+=e,void 0!==p&&(p+=Math.round(d%i.targetduration/i.partTarget)),this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${u.toFixed(2)}s goal: ${d} skip sn ${e} to part ${p}`)}i.tuneInGoal=d}if(h=this.getDeliveryDirectives(i,t.deliveryDirectives,f,p),e||!l){i.requestScheduled=s,this.loadingPlaylist(m,h);return}}else(i.canBlockReload||i.canSkipUntil)&&(h=this.getDeliveryDirectives(i,t.deliveryDirectives,f,p));h&&void 0!==f&&i.canBlockReload&&(i.requestScheduled=a.loading.first+Math.max(E-2*c,E/2)),this.scheduleLoading(m,h,i)}else this.clearTimer()}scheduleLoading(e,t,r){let i=r||e.details;if(!i){this.loadingPlaylist(e,t);return}let n=self.performance.now(),a=i.requestScheduled;if(n>=a){this.loadingPlaylist(e,t);return}let s=a-n;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(s)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),s)}getDeliveryDirectives(e,t,r,i){let n=eC(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,n=ew.No),new eT(r,i,n)}checkRetry(e){let t=e.details,r=eW(e),i=e.errorAction,{action:n,retryCount:a=0,retryConfig:s}=i||{},o=!!i&&!!s&&(n===eZ.RetryRequest||!i.resolved&&n===eZ.SendAlternateToPenaltyBox);if(o){var l;if(a>=s.maxNumRetry)return!1;if(r&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${s.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{let e=eq(s,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn(`Retrying playlist loading ${a+1}/${s.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,i.resolved=!0}return o}}function ib(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!iS(e[r].attrs,t[r].attrs))return!1;return!0}function iS(e,t,r){let i=e["STABLE-RENDITION-ID"];return i&&!r?i===t["STABLE-RENDITION-ID"]:!(r||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>e[r]!==t[r])}function iw(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class iC extends i_{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){let{hls:e}=this;e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.MANIFEST_PARSED,this.onManifestParsed,this),e.on(u.LEVEL_LOADING,this.onLevelLoading,this),e.on(u.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(u.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(u.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.MANIFEST_PARSED,this.onManifestParsed,this),e.off(u.LEVEL_LOADING,this.onLevelLoading,this),e.off(u.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(u.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(u.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){let{id:r,groupId:i,details:n}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==i){this.warn(`Audio track with id:${r} and group:${i} not found in active group ${null==a?void 0:a.groupId}`);return}let s=a.details;a.details=t.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${i} loaded [${n.startSN}-${n.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,s)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let r=t.audioGroups||null,i=this.groupIds,n=this.currentTrack;if(!r||(null==i?void 0:i.length)!==(null==r?void 0:r.length)||null!=r&&r.some(e=>(null==i?void 0:i.indexOf(e))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;let e=this.tracks.filter(e=>!r||-1!==r.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=e;let t=this.hls.config.audioPreference;if(!n&&t){let r=ek(t,e,eO);if(r>-1)n=e[r];else{let e=ek(t,this.tracks);n=this.tracks[e]}}let i=this.findTrackId(n);-1===i&&n&&(i=this.findTrackId(null)),this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==r?void 0:r.join(",")}`),this.hls.trigger(u.AUDIO_TRACKS_UPDATED,{audioTracks:e});let s=this.trackId;if(-1!==i&&-1===s)this.setAudioTrack(i);else if(e.length&&-1===s){var a;let t=Error(`No audio track selected for current audio group-ID(s): ${null==(a=this.groupIds)?void 0:a.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==d.AUDIO_TRACK||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){let t=this.hls;if(t.config.audioPreference=e,e){let r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){let i=this.currentTrack;if(i&&eF(e,i,eO))return i;let n=ek(e,this.tracksInGroup,eO);if(n>-1){let e=this.tracksInGroup[n];return this.setAudioTrack(n),e}if(i){let i=t.loadLevel;-1===i&&(i=t.firstAutoLevel);let n=function(e,t,r,i,n){let a=t[i],s=t.reduce((e,t,r)=>{let i=t.uri;return(e[i]||(e[i]=[])).push(r),e},{})[a.uri];s.length>1&&(i=Math.max.apply(Math,s));let o=a.videoRange,l=a.frameRate,u=a.codecSet.substring(0,4),c=eU(t,i,t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==u)return!1;let i=t.audioGroups;return ek(e,r.filter(e=>!i||-1!==i.indexOf(e.groupId)),n)>-1});return c>-1?c:eU(t,i,t=>{let i=t.audioGroups;return ek(e,r.filter(e=>!i||-1!==i.indexOf(e.groupId)),n)>-1})}(e,t.levels,r,i,eO);if(-1===n)return null;t.nextLoadLevel=n}if(e.channels||e.audioCodec){let t=ek(e,r);if(t>-1)return r[t]}}}return null}setAudioTrack(e){let t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;let r=this.currentTrack,i=t[e],n=i.details&&!i.details.live;if(e===this.trackId&&i===r&&n||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(u.AUDIO_TRACK_SWITCHING,v({},i)),n))return;let a=this.switchParams(i.url,null==r?void 0:r.details,i.details);this.loadPlaylist(a)}findTrackId(e){let t=this.tracksInGroup;for(let r=0;r<t.length;r++){let i=t[r];if((!this.selectDefaultTrack||i.default)&&(!e||eF(e,i,eO)))return r}if(e){let{name:r,lang:i,assocLang:n,characteristics:a,audioCodec:s,channels:o}=e;for(let e=0;e<t.length;e++)if(eF({name:r,lang:i,assocLang:n,characteristics:a,audioCodec:s,channels:o},t[e],eO))return e;for(let r=0;r<t.length;r++){let i=t[r];if(iS(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){let i=t[r];if(iS(e.attrs,i.attrs,["LANGUAGE"]))return r}}return -1}loadPlaylist(e){super.loadPlaylist();let t=this.currentTrack;this.shouldLoadPlaylist(t)&&eN(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let r=e.id,i=e.groupId,n=this.getUrlWithDirectives(e.url,t),a=e.details,s=null==a?void 0:a.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${i}${(null==t?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s&&a.live?" age "+s.toFixed(1)+(a.type?" "+a.type:""):""} ${n}`),this.hls.trigger(u.AUDIO_TRACK_LOADING,{url:n,id:r,groupId:i,deliveryDirectives:t||null,track:e})}}class iT{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(null===this.queues||null===this.tracks)return;let i=this.queues[t];i.push(e),1!==i.length||r||this.executeNext(t)}appendBlocker(e){return new Promise(t=>{this.append({label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}},e)})}prependBlocker(e){return new Promise(t=>{this.queues&&this.queues[e].unshift({label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}})})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;let r=null==(t=e[0])?void 0:t.label;("async-blocker"===r||"async-blocker-prepend"===r)&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){null!==this.queues&&this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;let t=this.queues[e];if(t.length){let i=t[0];try{i.execute()}catch(n){var r;if(i.onError(n),null===this.queues||null===this.tracks)return;let t=null==(r=this.tracks[e])?void 0:r.buffer;null!=t&&t.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){let{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return null!=(t=this.queues)&&t[e]||null!=(r=this.tracks)&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;let r=null==(t=this.tracks)?void 0:t[e],i=null==r?void 0:r.buffer;return i?`SourceBuffer${i.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map(e=>e.label).join(", "))||""}}let iI=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,iM="HlsJsTrackRemovedError";class iR extends Error{constructor(e){super(e),this.name=iM}}class iB extends y{constructor(e,t){var r;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&(null==(t=this.mediaSource)?void 0:t.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{let{media:t,mediaSource:r}=this;e&&this.log("Media source opened"),t&&r&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(u.MEDIA_ATTACHED,{media:t,mediaSource:r}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{let{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=(r=w(e.config.preferManagedMediaSource),"undefined"!=typeof self&&r===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){let{hls:e}=this;e.on(u.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.MANIFEST_PARSED,this.onManifestParsed,this),e.on(u.BUFFER_RESET,this.onBufferReset,this),e.on(u.BUFFER_APPENDING,this.onBufferAppending,this),e.on(u.BUFFER_CODECS,this.onBufferCodecs,this),e.on(u.BUFFER_EOS,this.onBufferEos,this),e.on(u.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(u.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(u.FRAG_PARSED,this.onFragParsed,this),e.on(u.FRAG_CHANGED,this.onFragChanged,this),e.on(u.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(u.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.MANIFEST_PARSED,this.onManifestParsed,this),e.off(u.BUFFER_RESET,this.onBufferReset,this),e.off(u.BUFFER_APPENDING,this.onBufferAppending,this),e.off(u.BUFFER_CODECS,this.onBufferCodecs,this),e.off(u.BUFFER_EOS,this.onBufferEos,this),e.off(u.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(u.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(u.FRAG_PARSED,this.onFragParsed,this),e.off(u.FRAG_CHANGED,this.onFragChanged,this),e.off(u.ERROR,this.onError,this)}transferMedia(){let{media:e,mediaSource:t}=this;if(!e)return null;let r={};if(this.operationQueue){let e=this.isUpdating();e||this.operationQueue.removeBlockers();let t=this.isQueued();(e||t)&&this.warn(`Transfering MediaSource with${t?" operations in queue":""}${e?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}let i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?g(r,i.tracks):this.sourceBuffers.forEach(e=>{let[t]=e;t&&(r[t]=g({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let i=2;(!t.audio||t.video)&&t.altAudio||(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),null!=(r=this.transferData)&&r.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){let r=this.media=t.media;this.transferData=this.overrides=void 0;let i=w(this.appendSource);if(i){let e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);let n=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(n),e)this._objectUrl=r.src,this.attachTransferred();else{let e=this._objectUrl=self.URL.createObjectURL(n);if(this.appendSource)try{r.removeAttribute("src");let t=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||t&&n instanceof t,iD(r),function(e,t){let r=self.document.createElement("source");r.type="video/mp4",r.src=t,e.appendChild(r)}(r,e),r.load()}catch(t){r.src=e}else r.src=e}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${(null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${null==(r=e.constructor)?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){let e=this.media,t=this.transferData;if(!t||!e)return;let r=this.tracks,i=t.tracks,n=i?Object.keys(i):null,a=n?n.length:0,s=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&n&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${eB(r,(e,t)=>"initSegment"===e?void 0:t)};
transfer tracks: ${eB(i,(e,t)=>"initSegment"===e?void 0:t)}}`),!C(i,r)){t.mediaSource=null,t.tracks=void 0;let n=e.currentTime,a=this.details,s=Math.max(n,(null==a?void 0:a.fragments[0].start)||0);if(s-n>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${n} -> ${s}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(r)}") start time: ${s} currentTime: ${n}`),this.onMediaDetaching(u.MEDIA_DETACHING,{}),this.onMediaAttaching(u.MEDIA_ATTACHING,t),e.currentTime=s;return}this.transferData=void 0,n.forEach(e=>{let t=i[e];if(t){let r=t.buffer;if(r){let i=this.fragmentTracker,n=t.id;if(i.hasFragments(n)||i.hasParts(n)){let t=th.getBuffered(r);i.detectEvictedFragments(e,t,n,null,!0)}let a=iP(e),s=[e,r];this.sourceBuffers[a]=s,r.updating&&this.operationQueue&&this.operationQueue.prependBlocker(e),this.trackSourceBuffer(e,t)}}}),s(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),s()}get mediaSourceOpenOrEnded(){var e;let t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){let r=!!t.transferMedia;this.transferData=this.overrides=void 0;let{media:i,mediaSource:n,_objectUrl:a}=this;if(n){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([e])=>{e&&this.removeBuffer(e)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){let e="open"===n.readyState;try{let t=n.sourceBuffers;for(let r=t.length;r--;)e&&t[r].abort(),n.removeSourceBuffer(t[r]);e&&n.endOfStream()}catch(e){this.warn(`onMediaDetaching: ${e.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}n.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("sourceended",this._onMediaSourceEnded),n.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(n.removeEventListener("startstreaming",this._onStartStreaming),n.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),r||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&iD(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(u.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t,r;let i=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),i)try{null!=(r=this.mediaSource)&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(t){this.warn(`onBufferReset ${e}`,t)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[iP(e)]=[null,null];let t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new iT(this.tracks)}onBufferCodecs(e,t){var r;let i=this.tracks,n=Object.keys(t);this.log(`BUFFER_CODECS: "${n}" (current SB count ${this.sourceBufferCount})`);let a="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),s=!a&&this.sourceBufferCount&&this.media&&n.some(e=>!i[e]);if(a||s){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${n}" SourceBuffers`);return}n.forEach(e=>{var r,n;let{id:a,codec:s,levelCodec:o,container:l,metadata:u,supplemental:c}=t[e],h=i[e],d=null==(r=this.transferData)||null==(r=r.tracks)?void 0:r[e],f=null!=d&&d.buffer?d:h,p=(null==f?void 0:f.pendingCodec)||(null==f?void 0:f.codec),m=null==f?void 0:f.levelCodec;h||(h=i[e]={buffer:void 0,listeners:[],codec:s,supplemental:c,container:l,levelCodec:o,metadata:u,id:a});let g=ep(p,m),A=null==g?void 0:g.replace(iI,"$1"),v=ep(s,o),y=null==(n=v)?void 0:n.replace(iI,"$1");v&&g&&A!==y&&("audio"===e.slice(0,5)&&(v=ef(v,this.appendSource)),this.log(`switching codec ${p} to ${v}`),v!==(h.pendingCodec||h.codec)&&(h.pendingCodec=v),h.container=l,this.appendChangeType(e,l,v))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(!(this.bufferCodecEventsTotal>1)||this.tracks.video||t.video||(null==(r=t.audio)?void 0:r.id)!=="main"||(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{let r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){let i=`${t};codecs=${r}`,n={label:`change-type=${i}`,execute:()=>{let n=this.tracks[e];if(n){let a=n.buffer;null!=a&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),a.changeType(i),n.codec=r,n.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};this.append(n,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;let r=e.start,i=r+.05*e.duration;if((null==(t=this.fragmentTracker.getAppendedFrag(r,f.MAIN))?void 0:t.gap)===!0)return;let n={label:"block-audio",execute:()=>{var e;let t=this.tracks.video;(this.lastVideoAppendEnd>i||null!=t&&t.buffer&&th.isBuffered(t.buffer,i)||(null==(e=this.fragmentTracker.getAppendedFrag(i,f.MAIN))?void 0:e.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:n,frag:e},this.append(n,"audio",!0)}unblockAudio(){let{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){let{tracks:r}=this,{data:i,type:a,parent:s,frag:c,part:h,chunkMeta:d,offset:p}=t,m=d.buffering[a],{sn:g,cc:A}=c,v=self.performance.now();m.start=v;let y=c.stats.buffering,E=h?h.stats.buffering:null;0===y.start&&(y.start=v),E&&0===E.start&&(E.start=v);let x=r.audio,_=!1;"audio"===a&&(null==x?void 0:x.container)==="audio/mpeg"&&(_=!this.lastMpegAudioChunk||1===d.id||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);let b=r.video,S=null==b?void 0:b.buffer;if(S&&"initSegment"!==g){let e=h||c,t=this.blockedAudioAppend;if("audio"!==a||"main"===s||this.blockedAudioAppend||b.ending||b.ended){if("video"===a){let r=e.end;if(t){let e=t.frag.start;(r>e||r<this.lastVideoAppendEnd||th.isBuffered(S,e))&&this.unblockAudio()}this.lastVideoAppendEnd=r}}else{let t=e.start+.05*e.duration,r=S.buffered,i=this.currentOp("video");(r.length||i)&&(i||th.isBuffered(S,t)||!(this.lastVideoAppendEnd<t))||this.blockAudio(e)}}let w=(h||c).start,C={label:`append-${a}`,execute:()=>{var e;m.executeStart=self.performance.now();let t=null==(e=this.tracks[a])?void 0:e.buffer;t&&(_?this.updateTimestampOffset(t,w,.1,a,g,A):void 0!==p&&n(p)&&this.updateTimestampOffset(t,p,1e-6,a,g,A)),this.appendExecutor(i,a)},onStart:()=>{},onComplete:()=>{let e=self.performance.now();m.executeEnd=m.end=e,0===y.first&&(y.first=e),E&&0===E.first&&(E.first=e);let t={};this.sourceBuffers.forEach(([e,r])=>{e&&(t[e]=th.getBuffered(r))}),this.appendErrors[a]=0,"audio"===a||"video"===a?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(u.BUFFER_APPENDED,{type:a,frag:c,part:h,chunkMeta:d,parent:c.type,timeRanges:t})},onError:e=>{var t;let r={type:o.MEDIA_ERROR,parent:c.type,details:l.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:c,part:h,chunkMeta:d,error:e,err:e,fatal:!1},i=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==e.name||"quota"in e)r.details=l.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!i)r.errorAction=e2(!0);else if(e.name===iM&&0===this.sourceBufferCount)r.errorAction=e2(!0);else{let e=++this.appendErrors[a];this.warn(`Failed ${e}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer (${i||"no media error"})`),(e>=this.hls.config.appendErrorMaxRetry||i)&&(r.fatal=!0)}this.hls.trigger(u.ERROR,r)}};this.log(`queuing "${a}" append sn: ${g}${h?" p: "+h.index:""} of ${c.type===f.MAIN?"level":"track"} ${c.level} cc: ${A}`),this.append(C,a,this.isPending(this.tracks[a]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(u.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){let{type:r,startOffset:i,endOffset:n}=t;r?this.append(this.getFlushOp(r,i,n),r):this.sourceBuffers.forEach(([e])=>{e&&this.append(this.getFlushOp(e,i,n),e)})}onFragParsed(e,t){let{frag:r,part:i}=t,n=[],a=i?i.elementaryStreams:r.elementaryStreams;a[P.AUDIOVIDEO]?n.push("audiovideo"):(a[P.AUDIO]&&n.push("audio"),a[P.VIDEO]&&n.push("video")),0===n.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(()=>{let e=self.performance.now();r.stats.buffering.end=e,i&&(i.stats.buffering.end=e);let t=i?i.stats:r.stats;this.hls.trigger(u.FRAG_BUFFERED,{frag:r,part:i,stats:t,id:r.type})},n).catch(e=>{this.warn(`Fragment buffered callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){let t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([e])=>{if(e){let r=this.tracks[e];t.type&&t.type!==e||(r.ending=!0,r.ended||(r.ended=!0,this.log(`${e} buffer reached EOS`)))}});let i=(null==(r=this.overrides)?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t;return e&&!(null!=(t=this.tracks[e])&&t.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();let{mediaSource:e}=this;if(!e||"open"!==e.readyState){e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(u.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(u.BUFFERED_TO_END,void 0)):"video"===t.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(null!==e){let t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{let e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===l.BUFFER_APPEND_ERROR&&t.frag){var r;let e=null==(r=t.errorAction)?void 0:r.nextAutoLevel;n(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){let{hls:e,details:t,media:r}=this;if(!r||null===t||!this.sourceBufferCount)return;let i=e.config,a=r.currentTime,s=t.levelTargetDuration,o=t.live&&null!==i.liveBackBufferLength?i.liveBackBufferLength:i.backBufferLength;if(n(o)&&o>=0){let e=Math.max(o,s),t=Math.floor(a/s)*s-e;this.flushBackBuffer(a,s,t)}let l=i.frontBufferFlushThreshold;if(n(l)&&l>0){let e=Math.max(Math.max(i.maxBufferLength,l),s),t=Math.floor(a/s)*s+e;this.flushFrontBuffer(a,s,t)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([e,t])=>{if(t){let n=th.getBuffered(t);if(n.length>0&&r>n.start(0)){var i;this.hls.trigger(u.BACK_BUFFER_REACHED,{bufferEnd:r});let t=this.tracks[e];if(null!=(i=this.details)&&i.live)this.hls.trigger(u.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(null!=t&&t.ended){this.log(`Cannot flush ${e} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(u.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:e})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([t,i])=>{if(i){let n=th.getBuffered(i),a=n.length;if(a<2)return;let s=n.start(a-1),o=n.end(a-1);r>s||e>=s&&e<=o||this.hls.trigger(u.BUFFER_FLUSHING,{startOffset:s,endOffset:1/0,type:t})}})}getDurationAndRange(){var e;let{details:t,mediaSource:r}=this;if(!t||!this.media||(null==r?void 0:r.readyState)!=="open")return null;let i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){let e=Math.max(0,t.fragmentStart),r=Math.max(e,i);return{duration:1/0,start:e,end:r}}return{duration:1/0}}let a=null==(e=this.overrides)?void 0:e.duration;if(a)return n(a)?{duration:a}:null;let s=this.media.duration;return i>(n(r.duration)?r.duration:0)&&i>s||!n(s)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:r}){let i=this.mediaSource;this.media&&i&&"open"===i.readyState&&(i.duration!==e&&(n(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),void 0!==t&&void 0!==r&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${r}.`),i.setLiveSeekableRange(t,r)))}get tracksReady(){let e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){let{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${eB(r)}`),this.tracksReady){var i;let e=null==(i=this.transferData)?void 0:i.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){let e={};this.sourceBuffers.forEach(([t,r])=>{if(t){let i=this.tracks[t];e[t]={buffer:r,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(u.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([e])=>{this.executeNext(e)})}else{let e=Error("could not create source buffer for media codec(s)");this.hls.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){let{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(let n in e){let a=e[n];if(this.isPending(a)){let e=this.getTrackCodec(a,n),s=`${a.container};codecs=${e}`;a.codec=e,this.log(`creating sourceBuffer(${s})${this.currentOp(n)?" Queued":""} ${eB(a)}`);try{let e=r.addSourceBuffer(s),i=iP(n),o=[n,e];t[i]=o,a.buffer=e}catch(e){var i;this.error(`error while trying to add sourceBuffer: ${e.message}`),this.shiftAndExecuteNext(n),null==(i=this.operationQueue)||i.removeBlockers(),delete this.tracks[n],this.hls.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,sourceBufferName:n,mimeType:s,parent:a.id});return}this.trackSourceBuffer(n,a)}}this.bufferCreated()}getTrackCodec(e,t){let r=e.supplemental,i=e.codec;r&&("video"===t||"audiovideo"===t)&&es(r,"video")&&(i=function(e,t){let r=[];if(e){let t=e.split(",");for(let e=0;e<t.length;e++)ea(t[e],"video")||r.push(t[e])}return t&&r.push(t),r.join(",")}(i,r));let n=ep(i,e.levelCodec);return n?"audio"===t.slice(0,5)?ef(n,this.appendSource):n:""}trackSourceBuffer(e,t){let r=t.buffer;if(!r)return;let i=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(e,t)=>{let r=t.removedRanges;null!=r&&r.length&&this.hls.trigger(u.BUFFER_FLUSHED,{type:e})})}get mediaSrc(){var e,t;let r=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==r?void 0:r.src}onSBUpdateStart(e){let t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if((null==(t=this.mediaSource)?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}let r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;let i=Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(r=this.mediaSource)?void 0:r.readyState}`);this.error(`${i}`,t),this.hls.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});let n=this.currentOp(e);n&&n.onError(i)}updateTimestampOffset(e,t,r,i,n,a){Math.abs(t-e.timestampOffset)>=r&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${t} (sn: ${n} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,r){let{media:i,mediaSource:a}=this,s=this.tracks[e],o=null==s?void 0:s.buffer;if(!i||!a||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}let l=n(i.duration)?i.duration:1/0,u=n(a.duration)?a.duration:1/0,c=Math.max(0,t),h=Math.min(r,l,u);h>c&&(!s.ending||s.ended)?(s.ended=!1,this.log(`Removing [${c},${h}] from the ${e} SourceBuffer`),o.remove(c,h)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){let r=this.tracks[t],i=null==r?void 0:r.buffer;if(!i)throw new iR(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(e){this.warn(`Callback run without blocking ${this.operationQueue} ${e}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);let{operationQueue:r}=this,i=t.map(e=>this.appendBlocker(e));return t.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(t=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(e=>{var t;let r=null==(t=this.tracks[e])?void 0:t.buffer;r&&!r.updating&&this.shiftAndExecuteNext(e)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){let i=this.tracks[e];if(!i)return;let n=i.buffer;if(!n)return;let a=r.bind(this,e);i.listeners.push({event:t,listener:a}),n.addEventListener(t,a)}removeBufferListeners(e){let t=this.tracks[e];if(!t)return;let r=t.buffer;r&&(t.listeners.forEach(e=>{r.removeEventListener(e.event,e.listener)}),t.listeners.length=0)}}function iD(e){let t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function iP(e){return"audio"===e?1:0}class iL{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){let{hls:e}=this;e.on(u.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(u.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(u.MANIFEST_PARSED,this.onManifestParsed,this),e.on(u.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(u.BUFFER_CODECS,this.onBufferCodecs,this),e.on(u.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){let{hls:e}=this;e.off(u.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(u.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(u.MANIFEST_PARSED,this.onManifestParsed,this),e.off(u.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(u.BUFFER_CODECS,this.onBufferCodecs,this),e.off(u.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){let r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){let r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&n(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}let e=this.hls.levels;if(e.length){let t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){let t=this.hls.levels;if(!t.length)return -1;let r=t.filter((t,r)=>this.isLevelAllowed(t)&&r<=e);return this.clientRect=null,iL.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;let e=this.media,t={width:0,height:0};if(e){let r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,r){if(!(null!=e&&e.length))return -1;let i=(e,t)=>!t||e.width!==t.width||e.height!==t.height,n=e.length-1,a=Math.max(t,r);for(let t=0;t<e.length;t+=1){let r=e[t];if((r.width>=a||r.height>=a)&&i(r,e[t+1])){n=t;break}}return n}}let ik={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",TIMED_TEXT:"tt"},iF={HLS:"h"};class iO{constructor(e,t){Array.isArray(e)&&(e=e.map(e=>e instanceof iO?e:new iO(e))),this.value=e,this.params=t}}function iU(e,t,r){return Error(`failed to serialize "${Array.isArray(e)?JSON.stringify(e):e instanceof Map?"Map{}":e instanceof Set?"Set{}":"object"==typeof e?JSON.stringify(e):String(e)}" as ${t}`,{cause:r})}class iN{constructor(e){this.description=e}}let iz="Bare Item";function iG(e){if(e<-0x38d7ea4c67fff||0x38d7ea4c67fff<e)throw iU(e,"Integer");return e.toString()}let iH=/[\x00-\x1f\x7f]+/;function iQ(e){let t=e.description||e.toString().slice(7,-1);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw iU(t,"Token");return t}function iV(e){switch(typeof e){case"number":if(!n(e))throw iU(e,iz);if(Number.isInteger(e))return iG(e);return function(e){let t=function e(t,r){if(t<0)return-e(-t,r);let i=Math.pow(10,r);if(!(Math.abs(t*i%1-.5)<Number.EPSILON))return Math.round(t*i)/i;{let e=Math.floor(t*i);return(e%2==0?e:e+1)/i}}(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw iU(e,"Decimal");let r=t.toString();return r.includes(".")?r:`${r}.0`}(e);case"string":return function(e){if(iH.test(e))throw iU(e,"String");return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(e);case"symbol":return iQ(e);case"boolean":return function(e){if("boolean"!=typeof e)throw iU(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return`@${iG(e.getTime()/1e3)}`;if(e instanceof Uint8Array)return function(e){if(!1===ArrayBuffer.isView(e))throw iU(e,"Byte Sequence");return`:${btoa(String.fromCharCode(...e))}:`}(e);if(e instanceof iN)return iQ(e);default:throw iU(e,iz)}}function iW(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw iU(e,"Key");return e}function ij(e){return null==e?"":Object.entries(e).map(([e,t])=>!0===t?`;${iW(e)}`:`;${iW(e)}=${iV(t)}`).join("")}function iY(e){return e instanceof iO?`${iV(e.value)}${ij(e.params)}`:iV(e)}function iK(e,t){return function(e,t={whitespace:!0}){if("object"!=typeof e||null==e)throw iU(e,"Dict");let r=e instanceof Map?e.entries():Object.entries(e),i=(null==t?void 0:t.whitespace)?" ":"";return Array.from(r).map(([e,t])=>{t instanceof iO==!1&&(t=new iO(t));let r=iW(e);if(!0===t.value)r+=ij(t.params);else if(r+="=",Array.isArray(t.value)){var i;r+=(i=t,`(${i.value.map(iY).join(" ")})${ij(i.params)}`)}else r+=iY(t);return r}).join(`,${i}`)}(e,t)}let iq="CMCD-Object",iX="CMCD-Request",i$="CMCD-Session",iJ="CMCD-Status",iZ={br:iq,ab:iq,d:iq,ot:iq,tb:iq,tpb:iq,lb:iq,tab:iq,lab:iq,url:iq,pb:iX,bl:iX,tbl:iX,dl:iX,ltc:iX,mtp:iX,nor:iX,nrr:iX,rc:iX,sn:iX,sta:iX,su:iX,ttfb:iX,ttfbb:iX,ttlb:iX,cmsdd:iX,cmsds:iX,smrt:iX,df:iX,cs:iX,ts:iX,cid:i$,pr:i$,sf:i$,sid:i$,st:i$,v:i$,msd:i$,bs:iJ,bsd:iJ,cdn:iJ,rtp:iJ,bg:iJ,pt:iJ,ec:iJ,e:iJ},i0={REQUEST:iX},i1="event",i2=e=>Math.round(e),i3=(e,t)=>Array.isArray(e)?e.map(e=>i3(e,t)):e instanceof iO&&"string"==typeof e.value?new iO(i3(e.value,t),e.params):(t.baseUrl&&(e=function(e,t){let r=new URL(e),i=new URL(t);if(r.origin!==i.origin)return e;let n=r.pathname.split("/").slice(1),a=i.pathname.split("/").slice(1,-1);for(;n[0]===a[0];)n.shift(),a.shift();for(;a.length;)a.shift(),n.unshift("..");return n.join("/")+r.search+r.hash}(e,t.baseUrl)),1===t.version?encodeURIComponent(e):e),i4=e=>100*i2(e/100),i5={br:i2,d:i2,bl:i4,dl:i4,mtp:i4,nor:(e,t)=>{let r=e;return t.version>=2&&(e instanceof iO&&"string"==typeof e.value?r=new iO([e]):"string"==typeof e&&(r=[e])),i3(r,t)},rtp:i4,tb:i2},i6="request",i8="response",i9=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],i7=["e"],ne=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function nt(e){return ne.test(e)}let nr=["d","dl","nor","ot","rtp","su"],ni=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"],nn=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function na(e){return nn.includes(e)||nt(e)}let ns={[i8]:function(e){return i9.includes(e)||nr.includes(e)||ni.includes(e)||nt(e)},[i1]:function(e){return i9.includes(e)||i7.includes(e)||nt(e)},[i6]:function(e){return i9.includes(e)||nr.includes(e)||nt(e)}};function no(e,t={}){let r={};if(null==e||"object"!=typeof e)return r;let i=t.version||e.v||1,a=t.reportingMode||i6,s=1===i?na:ns[a],o=Object.keys(e).filter(s),l=t.filter;"function"==typeof l&&(o=o.filter(l));let u=a===i8||a===i1;u&&!o.includes("ts")&&o.push("ts"),i>1&&!o.includes("v")&&o.push("v");let c=g({},i5,t.formatters),h={version:i,reportingMode:a,baseUrl:t.baseUrl};return o.sort().forEach(t=>{var a;let s=e[t],o=c[t];if("function"==typeof o&&(s=o(s,h)),"v"===t){if(1===i)return;s=i}("pr"!=t||1!==s)&&(u&&"ts"===t&&!n(s)&&(s=Date.now()),("number"==typeof(a=s)?n(a):null!=a&&""!==a&&!1!==a)&&(["ot","sf","st","e","sta"].includes(t)&&"string"==typeof s&&(s=new iN(s)),r[t]=s))}),r}let nl=/CMCD=[^&#]+/;class nu{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:ik.MANIFEST,su:!this.initialized})}catch(e){this.hls.logger.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{let{frag:t,part:r}=e,i=this.hls.levels[t.level],n=this.getObjectType(t),a={d:1e3*(r||t).duration,ot:n};(n===ik.VIDEO||n===ik.AUDIO||n==ik.MUXED)&&(a.br=i.bitrate/1e3,a.tb=this.getTopBandwidth(n)/1e3,a.bl=this.getBufferLength(n));let s=r?this.getNextPart(r):this.getNextFrag(t);null!=s&&s.url&&s.url!==t.url&&(a.nor=s.url),this.apply(e,a)}catch(e){this.hls.logger.warn("Could not generate segment CMCD data.",e)}},this.hls=e;let t=this.config=e.config,{cmcd:r}=t;null!=r&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=!0===r.useHeaders,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){let e=this.hls;e.on(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(u.MEDIA_DETACHED,this.onMediaDetached,this),e.on(u.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){let e=this.hls;e.off(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(u.MEDIA_DETACHED,this.onMediaDetached,this),e.off(u.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,i;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}createData(){var e;return{v:1,sf:iF.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){g(t,this.createData());let r=t.ot===ik.INIT||t.ot===ik.VIDEO||t.ot===ik.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);let{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((e,r)=>(i.includes(r)&&(e[r]=t[r]),e),{}));let n={baseUrl:e.url};if(this.useHeaders){var a;e.headers||(e.headers={}),a=e.headers,g(a,function(e,t={}){let r={};return e?Object.entries(function(e,t){let r={};if(!e)return r;let i=Object.keys(e),n=t?Object.keys(t).reduce((e,r)=>{var i;return null===(i=t[r])||void 0===i||i.forEach(t=>e[t]=r),e},{}):{};return i.reduce((t,r)=>{var i;let a=iZ[r]||n[r]||i0.REQUEST;return(null!==(i=t[a])&&void 0!==i?i:t[a]={})[r]=e[r],t},r)}(no(e,t),null==t?void 0:t.customHeaderMap)).reduce((e,[t,r])=>{let i=iK(r,{whitespace:!1});return i&&(e[t]=i),e},r):r}(t,n))}else e.url=function(e,t,r){let i=function(e,t={}){if(!e)return"";let r=function(e,t={}){return e?encodeURIComponent(function(e,t={}){return e?iK(no(e,t),{whitespace:!1}):""}(e,t)):""}(e,t);return`CMCD=${r}`}(t,r);if(!i)return e;if(nl.test(e))return e.replace(nl,i);let n=e.includes("?")?"&":"?";return`${e}${n}${i}`}(e.url,t,n)}getNextFrag(e){var t;let r=null==(t=this.hls.levels[e.level])?void 0:t.details;if(r){let t=e.sn-r.startSN;return r.fragments[t+1]}}getNextPart(e){var t;let{index:r,fragment:i}=e,n=null==(t=this.hls.levels[i.level])||null==(t=t.details)?void 0:t.partList;if(n){let{sn:e}=i;for(let t=n.length-1;t>=0;t--){let i=n[t];if(i.index===r&&i.fragment.sn===e)return n[t+1]}}}getObjectType(e){let{type:t}=e;return"subtitle"===t?ik.TIMED_TEXT:"initSegment"===e.sn?ik.INIT:"audio"===t?ik.AUDIO:"main"===t?this.hls.audioTracks.length?ik.VIDEO:ik.MUXED:void 0}getTopBandwidth(e){let t,r=0,i=this.hls;if(e===ik.AUDIO)t=i.audioTracks;else{let e=i.maxAutoLevel,r=e>-1?e+1:i.levels.length;t=i.levels.slice(0,r)}return t.forEach(e=>{e.bitrate>r&&(r=e.bitrate)}),r>0?r:NaN}getBufferLength(e){let t=this.media,r=e===ik.AUDIO?this.audioBuffer:this.videoBuffer;return r&&t?1e3*th.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){let{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new r(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,r,i){t(e),this.loader.load(e,r,i)}}}createFragmentLoader(){let{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new r(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,r,i){t(e),this.loader.load(e,r,i)}}}}class nc extends y{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){let e=this.hls;e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(u.MANIFEST_PARSED,this.onManifestParsed,this),e.on(u.ERROR,this.onError,this)}unregisterListeners(){let e=this.hls;e&&(e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(u.MANIFEST_PARSED,this.onManifestParsed,this),e.off(u.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){let e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){let t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){let{contentSteering:r}=t;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){let{errorAction:r}=t;if((null==r?void 0:r.action)===eZ.SendAlternateToPenaltyBox&&r.flags===e0.MoveAllAlternatesMatchingHost){let e=this.levels,i=this._pathwayPriority,n=this.pathwayId;if(t.context){let{groupId:r,pathwayId:i,type:a}=t.context;r&&e?n=this.getPathwayForGroupId(r,a,n):i&&(n=i)}n in this.penalizedPathways||(this.penalizedPathways[n]=performance.now()),!i&&e&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==n),t.details!==l.BUFFER_APPEND_ERROR||t.fatal?r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${n} levels: ${e?e.length:e} priorities: ${eB(i)} penalized: ${eB(this.penalizedPathways)}`):r.resolved=!0}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){let r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this._pathwayPriority=e;let r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(e=>{i-r[e]>3e5&&delete r[e]});for(let i=0;i<e.length;i++){let n=e[i];if(n in r)continue;if(n===this.pathwayId)return;let a=this.hls.nextLoadLevel,s=this.hls.levels[a];if((t=this.getLevelsForPathway(n)).length>0){this.log(`Setting Pathway to "${n}"`),this.pathwayId=n,t8(t),this.hls.trigger(u.LEVELS_UPDATED,{levels:t});let e=this.hls.levels[a];s&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==s.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==s.bitrate&&this.log(`Unstable Pathways change from bitrate ${s.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,r){let i=this.getLevelsForPathway(r).concat(this.levels||[]);for(let r=0;r<i.length;r++)if(t===d.AUDIO_TRACK&&i[r].hasAudioGroup(e)||t===d.SUBTITLE_TRACK&&i[r].hasSubtitleGroup(e))return i[r].pathwayId;return r}clonePathways(e){let t=this.levels;if(!t)return;let r={},i={};e.forEach(e=>{let{ID:n,"BASE-ID":a,"URI-REPLACEMENT":s}=e;if(t.some(e=>e.pathwayId===n))return;let o=this.getLevelsForPathway(a).map(e=>{let t=new tA(e.attrs);t["PATHWAY-ID"]=n;let a=t.AUDIO&&`${t.AUDIO}_clone_${n}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${n}`;a&&(r[t.AUDIO]=a,t.AUDIO=a),o&&(i[t.SUBTITLES]=o,t.SUBTITLES=o);let l=nd(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",s),u=new eI({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let t=1;t<e.audioGroups.length;t++)u.addGroupId("audio",`${e.audioGroups[t]}_clone_${n}`);if(e.subtitleGroups)for(let t=1;t<e.subtitleGroups.length;t++)u.addGroupId("text",`${e.subtitleGroups[t]}_clone_${n}`);return u});t.push(...o),nh(this.audioTracks,r,s,n),nh(this.subtitleTracks,i,s,n)})}loadSteeringManifest(e){let t;let r=this.hls.config,i=r.loader;this.loader&&this.loader.destroy(),this.loader=new i(r);try{t=new self.URL(e)}catch(t){this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if("data:"!==t.protocol){let e=0|(this.hls.bandwidthEstimate||r.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+e)}let n={responseType:"json",url:t.href},a=r.steeringManifestLoadPolicy.default,s=a.errorRetry||a.timeoutRetry||{},o={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0};this.log(`Requesting steering manifest: ${t}`),this.loader.load(n,o,{onSuccess:(e,r,i,n)=>{this.log(`Loaded steering manifest: "${t}"`);let a=e.data;if((null==a?void 0:a.VERSION)!==1){this.log(`Steering VERSION ${a.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=a.TTL;let{"RELOAD-URI":s,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=a;if(s)try{this.uri=new self.URL(s,t).href}catch(e){this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${s}`);return}this.scheduleRefresh(this.uri||i.url),o&&this.clonePathways(o);let c={steeringManifest:a,url:t.toString()};this.hls.trigger(u.STEERING_MANIFEST_LOADED,c),l&&this.updatePathwayPriority(l)},onError:(e,t,r,i)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code){this.enabled=!1,this.log(`Steering manifest ${t.url} no longer available`);return}let n=1e3*this.timeToLoad;if(429===e.code){let e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){let t=e.getResponseHeader("Retry-After");t&&(n=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`);return}this.scheduleRefresh(this.uri||t.url,n)},onTimeout:(e,t,r)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}})}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;let r=null==(t=this.hls)?void 0:t.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,1e3*this.timeToLoad)},t)}}function nh(e,t,r,i){e&&Object.keys(t).forEach(n=>{let a=e.filter(e=>e.groupId===n).map(e=>{let a=g({},e);return a.details=void 0,a.attrs=new tA(a.attrs),a.url=a.attrs.URI=nd(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),a.groupId=a.attrs["GROUP-ID"]=t[n],a.attrs["PATHWAY-ID"]=i,a});e.push(...a)})}function nd(e,t,r,i){let n;let{HOST:a,PARAMS:s,[r]:o}=i;t&&(n=null==o?void 0:o[t])&&(e=n);let l=new self.URL(e);return a&&!n&&(l.host=a),s&&Object.keys(s).sort().forEach(e=>{e&&l.searchParams.set(e,s[e])}),l.href}class nf extends y{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=nf.CDMCleanupPromise?[nf.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{let{initDataType:t,initData:r}=e,i=`"${e.type}" event: init data type: "${t}"`;if(this.debug(i),null!==r){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=tD(this.config));let t=e.map(tB).filter(e=>!!e);this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then(n=>{let a;let s=tR(n);if("sinf"!==t||s!==tI.FAIRPLAY){this.log(`Ignoring "${e.type}" event with init data type: "${t}" for selected key-system ${s}`);return}try{let e=z(new Uint8Array(r)),t=tS(JSON.parse(e).sinf),i=$(t);if(!i)throw Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(i.subarray(8,24))}catch(e){this.warn(`${i} Failed to parse sinf: ${e}`);return}let o=I(a),{keyIdToKeySessionPromise:l,mediaKeySessions:u}=this,c=l[o];for(let e=0;e<u.length;e++){let i=u[e],n=i.decryptdata;if(!n.keyId)continue;let s=I(n.keyId);if(tE(a,n.keyId)||-1!==n.uri.replace(/-/g,"").indexOf(o)){if(!(c=l[s]))continue;if(n.pssh)break;delete l[s],n.pssh=new Uint8Array(r),n.keyId=a,(c=l[o]=c.then(()=>this.generateRequestWithPreferredKeySession(i,t,r,"encrypted-event-key-match"))).catch(e=>this.handleError(e));break}}c||this.handleError(Error(`Key ID ${o} not encountered in playlist. Key-system sessions ${u.length}.`))}).catch(e=>this.handleError(e))}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();let e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(u.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(u.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(u.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(u.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(u.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(u.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(u.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(u.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(u.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(u.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){let{drmSystems:t,widevineLicenseUrl:r}=this.config,i=null==t?void 0:t[e];return i?i.licenseUrl:e===tI.WIDEVINE&&r?r:void 0}getLicenseServerUrlOrThrow(e){let t=this.getLicenseServerUrl(e);if(void 0===t)throw Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){let{drmSystems:t}=this.config,r=null==t?void 0:t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){let t=this.hls.levels,r=(e,t,r)=>!!e&&r.indexOf(e)===t,i=t.map(e=>e.audioCodec).filter(r),n=t.map(e=>e.videoCodec).filter(r);return i.length+n.length===0&&n.push("avc1.42e01e"),new Promise((t,r)=>{let a=e=>{let s=e.shift();this.getMediaKeysPromise(s,i,n).then(e=>t({keySystem:s,mediaKeys:e})).catch(t=>{e.length?a(e):t instanceof nm?r(t):r(new nm({type:o.KEY_SYSTEM_ERROR,details:l.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};a(e)})}requestMediaKeySystemAccess(e,t){let{requestMediaKeySystemAccessFunc:r}=this.config;if("function"!=typeof r){let e=`Configured requestMediaKeySystemAccess is not a function ${r}`;return null===tP&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(Error(e))}return r(e,t)}getMediaKeysPromise(e,t,r){var i;let n=function(e,t,r,i){let n;switch(e){case tI.FAIRPLAY:n=["cenc","sinf"];break;case tI.WIDEVINE:case tI.PLAYREADY:n=["cenc"];break;case tI.CLEARKEY:n=["cenc","keyids"];break;default:throw Error(`Unknown key-system: ${e}`)}return[{initDataTypes:n,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:`audio/mp4; codecs=${e}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:r.map(e=>({contentType:`video/mp4; codecs=${e}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}(e,t,r,this.config.drmSystemOptions||{}),a=this.keySystemAccessPromises[e],s=null==(i=a)?void 0:i.keySystemAccess;if(!s){this.log(`Requesting encrypted media "${e}" key-system access with config: ${eB(n)}`),s=this.requestMediaKeySystemAccess(e,n);let t=a=this.keySystemAccessPromises[e]={keySystemAccess:s};return s.catch(t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)}),s.then(r=>{this.log(`Access for key-system "${r.keySystem}" obtained`);let i=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);let n=t.mediaKeys=r.createMediaKeys().then(r=>(this.log(`Media-keys created for "${e}"`),t.hasMediaKeys=!0,i.then(t=>t?this.setMediaKeysServerCertificate(r,e,t):r)));return n.catch(t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)}),n})}return s.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${I(e.keyId||[])} keyUri: ${e.uri}`);let i=r.createSession(),n={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(n),n}renewKeySession(e){let t=e.decryptdata;if(t.pssh){let r=this.createMediaKeySessionContext(e),i=np(t);this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,"cenc",t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){let r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${I(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>tB(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:e,mediaKeys:t})=>this.attemptSetMediaKeys(e,t))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:e})=>{let i=tB(e);i?t(i):r(Error(`Unable to find format for key-system "${e}"`))}).catch(r)})}selectKeySystemFormat(e){let t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){let t=tD(this.config),r=e.map(tR).filter(e=>!!e&&-1!==t.indexOf(e));return this.selectKeySystem(r)}getKeyStatus(e){let{mediaKeySessions:t}=this;for(let i=0;i<t.length;i++){var r;let n=(r=t[i],e.keyId&&r.mediaKeysSession.keyStatuses.has(e.keyId)?r.mediaKeysSession.keyStatuses.get(e.keyId):e.matches(r.decryptdata)?r.keyStatus:void 0);if(n)return n}}loadKey(e){let t=e.keyInfo.decryptdata,r=np(t),i=this.bannedKeyIds[r];if(i||"internal-error"===this.getKeyStatus(t)){let r=ng(i||"internal-error",t);return this.handleError(r,e.frag),Promise.reject(r)}let n=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${n}`);let a=this.keyIdToKeySessionPromise[r];if(!a){let i=this.getKeySystemForKeyPromise(t).then(({keySystem:r,mediaKeys:i})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${n}`),this.attemptSetMediaKeys(r,i).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:r,mediaKeys:i,decryptdata:t}))))).then(e=>{let r=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",r,"playlist-key")});return i.catch(t=>this.handleError(t,e.frag)),this.keyIdToKeySessionPromise[r]=i,i}return a.catch(r=>{if(r instanceof nm){let i=v({},r.data);"internal-error"===this.getKeyStatus(t)&&(i.decryptdata=t);let n=new nm(i,r.message);this.handleError(n,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw Error("invalid state")}handleError(e,t){if(this.hls){if(e instanceof nm){t&&(e.data.frag=t);let r=e.data.decryptdata;this.error(`${e.message}${r?` (${I(r.keyId||[])})`:""}`),this.hls.trigger(u.ERROR,e.data)}else this.error(e.message),this.hls.trigger(u.ERROR,{type:o.KEY_SYSTEM_ERROR,details:l.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}}getKeySystemForKeyPromise(e){let t=np(e),r=this.keyIdToKeySessionPromise[t];if(!r){let t=tR(e.keyFormat),r=t?[t]:tD(this.config);return this.attemptKeySystemAccess(r)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=tD(this.config)),0===e.length)throw new nm({type:o.KEY_SYSTEM_ERROR,details:l.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${eB({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();let r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);let i=Promise.all(r).then(()=>{if(!this.media)throw this.mediaKeys=null,Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===r.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,r,i){var n;let a=null==(n=this.config.drmSystems)||null==(n=n[e.keySystem])?void 0:n.generateRequest;if(a)try{let i=a.call(this.hls,t,r,e);if(!i)throw Error("Invalid response from configured generateRequest filter");t=i.initDataType,r=i.initData?i.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(e){if(this.warn(e.message),this.hls&&this.hls.config.debug)throw e}if(null===r)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);let s=np(e.decryptdata),u=e.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${s} URI: ${u} (init data type: ${t} length: ${r.byteLength})`);let c=new rd,h=e._onmessage=t=>{let r=e.mediaKeysSession;if(!r){c.emit("error",Error("invalid state"));return}let{messageType:i,message:n}=t;this.log(`"${i}" message event for session "${r.sessionId}" message size: ${n.byteLength}`),"license-request"===i||"license-renewal"===i?this.renewLicense(e,n).catch(e=>{c.eventNames().length?c.emit("error",e):this.handleError(e)}):"license-release"===i?e.keySystem===tI.FAIRPLAY&&this.updateKeySession(e,tw("acknowledged")).then(()=>this.removeSession(e)).catch(e=>this.handleError(e)):this.warn(`unhandled media key message type "${i}"`)},d=(e,t)=>{let r;t.keyStatus=e,e.startsWith("usable")?c.emit("resolved"):"internal-error"===e||"output-restricted"===e||"output-downscaled"===e?r=ng(e,t.decryptdata):"expired"===e?r=Error(`key expired (keyId: ${s})`):"released"===e?r=Error("key released"):"status-pending"===e||this.warn(`unhandled key status change "${e}" (keyId: ${s})`),r&&(c.eventNames().length?c.emit("error",r):this.handleError(r))},f=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession){c.emit("error",Error("invalid state"));return}let r=this.getKeyStatuses(e);if(!Object.keys(r).some(e=>"status-pending"!==r[e]))return;if("expired"===r[s]){this.log(`Expired key ${eB(r)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let i=r[s];if(i)d(i,e);else{var n;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(n=e.keyStatusTimeouts)[s]||(n[s]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;let t=this.getKeyStatus(e.decryptdata);if(t&&"status-pending"!==t)return this.log(`No status for keyId ${s} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${t} from other session.`),d(t,e);this.log(`key status for ${s} in key-session "${e.mediaKeysSession.sessionId}" timed out after 0ms`),d(i="internal-error",e)},0)),this.log(`No status for keyId ${s} (${eB(r)}).`)}};rn(e.mediaKeysSession,"message",h),rn(e.mediaKeysSession,"keystatuseschange",f);let p=new Promise((e,t)=>{c.on("error",t),c.on("resolved",e)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${s} URI: ${u}`)}).catch(t=>{throw new nm({type:o.KEY_SYSTEM_ERROR,details:l.KEY_SYSTEM_NO_SESSION,error:t,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${t}`)}).then(()=>p).catch(t=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw t}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){let t={};return e.mediaKeysSession.keyStatuses.forEach((r,i)=>{if("string"==typeof i&&"object"==typeof r){let e=i;i=r,r=e}let n="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);e.keySystem===tI.PLAYREADY&&16===n.length&&tC(n);let a=I(n);"internal-error"===r&&(this.bannedKeyIds[a]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=r}),t}fetchServerCertificate(e){let t=this.config,r=new t.loader(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((n,a)=>{let s={responseType:"arraybuffer",url:i},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};r.load(s,c,{onSuccess:(e,t,r,i)=>{n(e.data)},onError:(t,r,n,u)=>{a(new nm({type:o.KEY_SYSTEM_ERROR,details:l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:n,response:v({url:s.url,data:void 0},t)},`"${e}" certificate request failed (${i}). Status: ${t.code} (${t.text})`))},onTimeout:(t,r,n)=>{a(new nm({type:o.KEY_SYSTEM_ERROR,details:l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:n,response:{url:s.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(e,t,r)=>{a(Error("aborted"))}})})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((i,n)=>{e.setServerCertificate(r).then(n=>{this.log(`setServerCertificate ${n?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),i(e)}).catch(e=>{n(new nm({type:o.KEY_SYSTEM_ERROR,details:l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(t=>{throw new nm({type:o.KEY_SYSTEM_ERROR,details:l.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:t,fatal:!1},t.message)}))}unpackPlayReadyKeyMessage(e,t){let r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;let i=new DOMParser().parseFromString(r,"application/xml"),n=i.querySelectorAll("HttpHeader");if(n.length>0){let t;for(let r=0,i=n.length;r<i;r++){var a,s;let i=null==(a=(t=n[r]).querySelector("name"))?void 0:a.textContent,o=null==(s=t.querySelector("value"))?void 0:s.textContent;i&&o&&e.setRequestHeader(i,o)}}let o=i.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw Error("Cannot find <Challenge> in key message");return tw(atob(l))}setupLicenseXHR(e,t,r,i){let n=this.config.licenseXhrSetup;return n?Promise.resolve().then(()=>{if(!r.decryptdata)throw Error("Key removed");return n.call(this.hls,e,t,r,i)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",t,!0),n.call(this.hls,e,t,r,i)}).then(r=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:r||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){let r=this.config.keyLoadPolicy.default;return new Promise((i,n)=>{let a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);let s=new XMLHttpRequest;s.responseType="arraybuffer",s.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return n(Error("invalid state"));if(4===s.readyState){if(200===s.status){this._requestLicenseFailureCount=0;let t=s.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);let r=this.config.licenseResponseCallback;if(r)try{t=r.call(this.hls,s,a,e)}catch(e){this.error(e)}i(t)}else{let u=r.errorRetry,c=u?u.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||s.status>=400&&s.status<500)n(new nm({type:o.KEY_SYSTEM_ERROR,details:l.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:s,response:{url:a,data:void 0,code:s.status,text:s.statusText}},`License Request XHR failed (${a}). Status: ${s.status} (${s.statusText})`));else{let r=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${r} attempts left`),this.requestLicense(e,t).then(i,n)}}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=s,this.setupLicenseXHR(s,a,e,t).then(({xhr:t,licenseChallenge:r})=>{e.keySystem==tI.PLAYREADY&&(r=this.unpackPlayReadyKeyMessage(t,r)),t.send(r)}).catch(n)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;let r=t.media;this.media=r,rn(r,"encrypted",this.onMediaEncrypted),rn(r,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){let e=this.media;e&&(ra(e,"encrypted",this.onMediaEncrypted),ra(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;let t=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,tk.clearKeyUriToKeyIdMap();let i=r.length;nf.CDMCleanupPromise=Promise.all(r.map(e=>this.removeSession(e)).concat((null==t||null==(e=t.setMediaKeys(null))?void 0:e.catch(e=>{this.log(`Could not clear media keys: ${e}`),this.hls&&this.hls.trigger(u.ERROR,{type:o.OTHER_ERROR,details:l.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:Error(`Could not clear media keys: ${e}`)})}))||Promise.resolve())).catch(e=>{this.log(`Could not close sessions and clear media keys: ${e}`),this.hls&&this.hls.trigger(u.ERROR,{type:o.OTHER_ERROR,details:l.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:Error(`Could not close sessions and clear media keys: ${e}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){let e=t.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){let{mediaKeysSession:t,licenseXhr:r,decryptdata:i}=e;if(t){var n;this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${I((null==i?void 0:i.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;let a=this.mediaKeySessions.indexOf(e);a>-1&&this.mediaKeySessions.splice(a,1);let{keyStatusTimeouts:s}=e;s&&Object.keys(s).forEach(e=>self.clearTimeout(s[e]));let{drmSystemOptions:c}=this.config;return(c&&("persistent-license"===c.sessionType||null!=(n=c.sessionTypes)&&n.some(e=>"persistent-license"===e))?new Promise((e,r)=>{self.setTimeout(()=>r(Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(e).catch(r)}):Promise.resolve()).catch(e=>{this.log(`Could not remove session: ${e}`),this.hls&&this.hls.trigger(u.ERROR,{type:o.OTHER_ERROR,details:l.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:Error(`Could not remove session: ${e}`)})}).then(()=>t.close()).catch(e=>{this.log(`Could not close session: ${e}`),this.hls&&this.hls.trigger(u.ERROR,{type:o.OTHER_ERROR,details:l.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:Error(`Could not close session: ${e}`)})})}return Promise.resolve()}}function np(e){if(!e)throw Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw Error("keyId is null");return I(e.keyId)}nf.CDMCleanupPromise=void 0;class nm extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=Error(t)),this.data=e,e.err=e.error}}function ng(e,t){let r="output-restricted"===e,i=r?l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:l.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new nm({type:o.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:t},r?"HDCP level output restricted":`key status changed to "${e}"`)}class nA{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(u.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(u.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(u.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(u.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){let r=this.hls.config;if(r.capLevelOnFPSDrop){let e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){let i=performance.now();if(t){if(this.lastTime){let e=i-this.lastTime,n=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,s=1e3*n/e,o=this.hls;if(o.trigger(u.FPS_DROP,{currentDropped:n,currentDecoded:a,totalDroppedFrames:r}),s>0&&n>o.config.fpsDroppedMonitoringThreshold*a){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(u.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){let e=this.media;if(e){if(this.isVideoPlaybackQualityAvailable){let t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}}function nv(e,t){let r;try{r=new Event("addtrack")}catch(e){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function ny(e,t){let r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw Error(`addCue is failed for: ${t}`)}catch(r){S.debug(`[texttrack-utils]: ${r}`);try{let r=new self.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id,e.addCue(r)}catch(e){S.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${e}`)}}"disabled"===r&&(e.mode=r)}function nE(e,t){let r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues)for(let r=e.cues.length;r--;)t&&e.cues[r].removeEventListener("enter",t),e.removeCue(e.cues[r]);"disabled"===r&&(e.mode=r)}function nx(e,t,r,i){let n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&e.cues.length>0){let n=function(e,t,r){let i=[],n=function(e,t){let r;if(t<=e[0].startTime)return 0;let i=e.length-1;if(t>e[i].endTime)return -1;let n=0,a=i;for(;n<=a;)if(t<e[r=Math.floor((a+n)/2)].startTime)a=r-1;else{if(!(t>e[r].startTime)||!(n<i))return r;n=r+1}return e[n].startTime-t<t-e[a].startTime?n:a}(e,t);if(n>-1)for(let a=n,s=e.length;a<s;a++){let n=e[a];if(n.startTime>=t&&n.endTime<=r)i.push(n);else if(n.startTime>r)break}return i}(e.cues,t,r);for(let t=0;t<n.length;t++)(!i||i(n[t]))&&e.removeCue(n[t])}"disabled"===n&&(e.mode=n)}function n_(e){let t=[];for(let r=0;r<e.length;r++){let i=e[r];("subtitles"===i.kind||"captions"===i.kind)&&i.label&&t.push(e[r])}return t}class nb extends i_{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null,t=n_(this.media.textTracks);for(let r=0;r<t.length;r++)if("hidden"===t[r].mode)e=t[r];else if("showing"===t[r].mode){e=t[r];break}let r=this.findTrackForTextTrack(e);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){let{hls:e}=this;e.on(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.MANIFEST_PARSED,this.onManifestParsed,this),e.on(u.LEVEL_LOADING,this.onLevelLoading,this),e.on(u.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(u.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(u.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.MANIFEST_PARSED,this.onManifestParsed,this),e.off(u.LEVEL_LOADING,this.onLevelLoading,this),e.off(u.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(u.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(u.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){let r=this.media;if(!r)return;let i=!!t.transferMedia;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i||n_(r.textTracks).forEach(e=>{nE(e)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){let{id:r,groupId:i,details:n}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==i){this.warn(`Subtitle track with id:${r} and group:${i} not found in active group ${null==a?void 0:a.groupId}`);return}let s=a.details;a.details=t.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${i} loaded [${n.startSN}-${n.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,s)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let r=t.subtitleGroups||null,i=this.groupIds,n=this.currentTrack;if(!r||(null==i?void 0:i.length)!==(null==r?void 0:r.length)||null!=r&&r.some(e=>(null==i?void 0:i.indexOf(e))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;let e=this.tracks.filter(e=>!r||-1!==r.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=e;let t=this.hls.config.subtitlePreference;if(!n&&t){this.selectDefaultTrack=!1;let r=ek(t,e);if(r>-1)n=e[r];else{let e=ek(t,this.tracks);n=this.tracks[e]}}let i=this.findTrackId(n);-1===i&&n&&(i=this.findTrackId(null)),this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==r?void 0:r.join(",")}" group-id`),this.hls.trigger(u.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:e}),-1!==i&&-1===this.trackId&&this.setSubtitleTrack(i)}}findTrackId(e){let t=this.tracksInGroup,r=this.selectDefaultTrack;for(let i=0;i<t.length;i++){let n=t[i];if((!r||n.default)&&(r||e)&&(!e||eF(n,e)))return i}if(e){for(let r=0;r<t.length;r++){let i=t[r];if(iS(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){let i=t[r];if(iS(e.attrs,i.attrs,["LANGUAGE"]))return r}}return -1}findTrackForTextTrack(e){if(e){let t=this.tracksInGroup;for(let r=0;r<t.length;r++)if(iw(t[r],e))return r}return -1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==d.SUBTITLE_TRACK||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;let t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){let r=this.currentTrack;if(r&&eF(e,r))return r;let i=ek(e,this.tracksInGroup);if(i>-1){let e=this.tracksInGroup[i];return this.setSubtitleTrack(i),e}if(r);else{let r=ek(e,t);if(r>-1)return t[r]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let r=e.id,i=e.groupId,n=this.getUrlWithDirectives(e.url,t),a=e.details,s=null==a?void 0:a.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${i}${(null==t?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s&&a.live?" age "+s.toFixed(1)+(a.type?" "+a.type:""):""} ${n}`),this.hls.trigger(u.SUBTITLE_TRACK_LOADING,{url:n,id:r,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){let e;let{media:t}=this;if(!t)return;let r=n_(t.textTracks),i=this.currentTrack;if(!i||(e=r.filter(e=>iw(i,e))[0])||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`),[].slice.call(r).forEach(t=>{"disabled"!==t.mode&&t!==e&&(t.mode="disabled")}),e){let t=this.subtitleDisplay?"showing":"hidden";e.mode!==t&&(e.mode=t)}}setSubtitleTrack(e){let t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!n(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;let r=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(u.SUBTITLE_TRACK_SWITCH,{id:e});return}let a=!!i.details&&!i.details.live;if(e===this.trackId&&i===r&&a)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));let{id:s,groupId:o="",name:l,type:c,url:h}=i;this.hls.trigger(u.SUBTITLE_TRACK_SWITCH,{id:s,groupId:o,name:l,type:c,url:h});let d=this.switchParams(i.url,null==r?void 0:r.details,i.details);this.loadPlaylist(d)}}function nS(e){let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()}let nw=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});class nC{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;let r=this.playoutLimit;return!(e<=0||isNaN(r))&&(0===r||((null==(t=this.assetList[e])?void 0:t.startOffset)||0)>r)}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){let e=this.dateRange.startTime;if(this.snapOptions.out){let t=this.dateRange.tagAnchor;if(t)return nT(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;let e=this.dateRange.tagAnchor;if(e){let t=this.dateRange.startTime,r=nT(t,e);return t-r<.1}return!1}get resumptionOffset(){let e=this.resumeOffset,t=n(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){let e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){let t=this.resumeAnchor;if(t)return nT(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&.025>Math.abs(this.resumeOffset-this.duration)))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){let e;let t=this.playoutLimit;return e=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(t)&&t<e&&(e=t),e}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?nw.Range:nw.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return`["${this.identifier}" ${this.cue.pre?"<pre>":this.cue.post?"<post>":""}${this.timelineStart.toFixed(2)}-${this.resumeTime.toFixed(2)}]`}}function nT(e,t){return e-t.start<t.duration/2&&!(.025>Math.abs(e-(t.start+t.duration)))?t.start:t.start+t.duration}function nI(e,t,r){let i=new self.URL(e,r);return"data:"!==i.protocol&&i.searchParams.set("_HLS_primary_id",t),i}function nM(e,t){for(;null!=(r=e.assetList[++t])&&r.error;)var r;return t}function nR(e){let t=e.timelineStart,r=e.duration||0;return`["${e.identifier}" ${t.toFixed(2)}-${(t+r).toFixed(2)}]`}class nB{constructor(e,t,r,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(u.PLAYOUT_LIMIT_REACHED,{})};let n=this.hls=new e(t);this.interstitial=r,this.assetItem=i;let a=()=>{this.hasDetails=!0};n.once(u.LEVEL_LOADED,a),n.once(u.AUDIO_TRACK_LOADED,a),n.once(u.SUBTITLE_TRACK_LOADED,a),n.on(u.MEDIA_ATTACHING,(e,{media:t})=>{this.removeMediaListeners(),this.mediaAttached=t,this.interstitial.playoutLimit&&(t.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&n.on(u.BUFFER_APPENDED,()=>{let e=this.bufferedEnd;this.reachedPlayout(e)&&(this._bufferedEosTime=e,n.trigger(u.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){let e=this.hls;if(e){if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=nI(t,e.config.primarySessionId||"").href}catch(e){}e.loadSource(t)}}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e)return!1;let r=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,n=th.bufferInfo(e,i,0);return this.getAssetTime(n.end)>=r-.02}reachedPlayout(e){let t=this.interstitial.playoutLimit;return this.startOffset+e>=t}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){let e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;let t=th.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){let e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){let e=this.assetItem.duration;if(!e)return 0;let t=this.interstitial.playoutLimit;if(t){let r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){let e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){let t=this.timelineOffset;if(e!==t&&Math.abs(e-t)>1/9e4&&this.hls){if(this.hasDetails)throw Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}getAssetTime(e){return Math.min(Math.max(0,e-this.timelineOffset),this.duration)}removeMediaListeners(){let e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),null==(t=this.hls)||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,null==(e=this.hls)||e.detachMedia()}resumeBuffering(){var e;null==(e=this.hls)||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.hls)||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),(null==(e=this.hls)?void 0:e.transferMedia())||null}resetDetails(){let e=this.hls;if(e&&this.hasDetails){e.stopLoad();let t=e=>delete e.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var i;null==(i=this.hls)||i.on(e,t)}once(e,t,r){var i;null==(i=this.hls)||i.once(e,t)}off(e,t,r){var i;null==(i=this.hls)||i.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${nR(this.assetItem)} ${null==(e=this.hls)?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}class nD extends y{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,r+1):r,0):0}get duration(){let e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);let i=this.items;if(i)for(i[r]||(void 0===t&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&null!=(n=i[r])&&n.event;){var n;r--}return r}findItemIndexAtTime(e,t){let r=this.items;if(r)for(let i=0;i<r.length;i++){let n=r[i];if(t&&"primary"!==t&&(n=n[t]),e===n.start||e>n.start&&e<n.end)return i}return -1}findJumpRestrictedIndex(e,t){let r=this.items;if(r)for(let i=e;i<=t&&r[i];i++){let e=r[i].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return i}return -1}findEventIndex(e){let t=this.items;if(t)for(let i=t.length;i--;){var r;if((null==(r=t[i].event)?void 0:r.identifier)===e)return i}return -1}findAssetIndex(e,t){let r=e.assetList,i=r.length;if(i>1)for(let e=0;e<i;e++){let n=r[e];if(!n.error){let r=n.timelineStart;if(t===r||t>r&&(t<r+(n.duration||0)||e===i-1))return e}}return 0}get assetIdAtEnd(){var e;let t=null==(e=this.items)||null==(e=e[this.length-1])?void 0:e.event;if(t){let e=t.assetList,r=e[e.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){let r=e.main.details,{dateRanges:i}=r,n=this.events,a=this.parseDateRanges(i,{url:r.url},t),s=Object.keys(i),o=n?n.filter(e=>!s.includes(e.identifier)):[];a.length&&a.sort((e,t)=>{let r=e.cue.pre,i=e.cue.post,n=t.cue.pre,a=t.cue.post;if(r&&!n)return -1;if(n&&!r||i&&!a)return 1;if(a&&!i)return -1;if(!r&&!n&&!i&&!a){let r=e.startTime,i=t.startTime;if(r!==i)return r-i}return e.dateRange.tagOrder-t.dateRange.tagOrder}),this.events=a,o.forEach(e=>{this.removeEvent(e)}),this.updateSchedule(e,o)}updateSchedule(e,t=[],r=!1){let i=this.events||[];if(i.length||t.length||this.length<2){let n=this.items,a=this.parseSchedule(i,e);(r||t.length||(null==n?void 0:n.length)!==a.length||a.some((e,t)=>Math.abs(e.playout.start-n[t].playout.start)>.005||Math.abs(e.playout.end-n[t].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,n))}}parseDateRanges(e,t,r){let i=[],n=Object.keys(e);for(let a=0;a<n.length;a++){let s=n[a],o=e[s];if(o.isInterstitial){let e=this.eventMap[s];e?e.setDateRange(o):(e=new nC(o,t),this.eventMap[s]=e,!1===r&&(e.appendInPlace=r)),i.push(e)}}return i}parseSchedule(e,t){let r=[],i=t.main.details,n=i.live?1/0:i.edge,a=0;if((e=e.filter(e=>!e.error&&!(e.cue.once&&e.hasPlayed))).length){this.resolveOffsets(e,t);let i=0,o=0;if(e.forEach((t,s)=>{let l=t.cue.pre,u=t.cue.post,c=e[s-1]||null,h=t.appendInPlace,d=u?n:t.startOffset,f=t.duration,p=t.timelineOccupancy===nw.Range?f:0,m=t.resumptionOffset,g=(null==c?void 0:c.startTime)===d,A=d+t.cumulativeDuration,v=h?A+f:d+m;if(l||!u&&d<=0){let e=o;o+=p,t.timelineStart=A;let i=a;a+=f,r.push({event:t,start:A,end:v,playout:{start:i,end:a},integrated:{start:e,end:o}})}else{if(!(d<=n))return;if(!g){let n=d-i;if(n>.033){let l=i,u=o;o+=n;let c=a;a+=n;let h={previousEvent:e[s-1]||null,nextEvent:t,start:l,end:l+n,playout:{start:c,end:a},integrated:{start:u,end:o}};r.push(h)}else n>0&&c&&(c.cumulativeDuration+=n,r[r.length-1].end=d)}u&&(v=A),t.timelineStart=A;let l=o;o+=p;let h=a;a+=f,r.push({event:t,start:A,end:v,playout:{start:h,end:a},integrated:{start:l,end:o}})}let y=t.resumeTime;i=u||y>n?n:y}),i<n){var s;let e=i,t=o,l=n-i;o+=l;let u=a;a+=l,r.push({previousEvent:(null==(s=r[r.length-1])?void 0:s.event)||null,nextEvent:null,start:i,end:e+l,playout:{start:u,end:a},integrated:{start:t,end:o}})}this.setDurations(n,a,o)}else r.push({previousEvent:null,nextEvent:null,start:0,end:n,playout:{start:0,end:n},integrated:{start:0,end:n}}),this.setDurations(n,n,n);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){let r=t.main.details,i=r.live?1/0:r.edge,a=0,s=-1;e.forEach((o,l)=>{let u=o.cue.pre,c=o.cue.post,h=u?0:c?i:o.startTime;this.updateAssetDurations(o),s===h?o.cumulativeDuration=a:(a=0,s=h),!c&&o.snapOptions.in&&(o.resumeAnchor=eH(null,r.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),!o.appendInPlace||o.appendInPlaceStarted||this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<.033&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));let d=n(o.resumeOffset)?o.resumeOffset:o.duration;a+=d})}primaryCanResumeInPlaceAt(e,t){let r=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(r-i)>.025?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${i}`),!1):!Object.keys(t).some(i=>{let n=t[i].details,a=n.edge;if(r>=a)return this.log(`"${e.identifier}" resumption ${r} past ${i} playlist end ${a}`),!1;let s=eH(null,n.fragments,r);if(!s)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${i} playlist (${n.fragStart}-${n.fragmentEnd})`),!0;let o="audio"===i?.175:0;return!(Math.abs(s.start-r)<.025+o||Math.abs(s.end-r)<.025+o)&&(this.log(`"${e.identifier}" resumption ${r} not aligned with ${i} fragment bounds (${s.start}-${s.end} sn: ${s.sn} cc: ${s.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;let t=e.timelineStart,r=0,i=!1,n=!1;for(let a=0;a<e.assetList.length;a++){let s=e.assetList[a],o=t+r;s.startOffset=r,s.timelineStart=o,i||(i=null===s.duration),n||(n=!!s.error),r+=s.error?0:s.duration||0}i&&!n?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function nP(e){return`[${e.event?'"'+e.event.identifier+'"':"primary"}: ${e.start.toFixed(2)}-${e.end.toFixed(2)}]`}class nL{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){let r;let i=e.assetListUrl;try{r=nI(i,this.hls.sessionId,e.baseUrl)}catch(r){let t=this.assignAssetListError(e,l.ASSET_LIST_LOAD_ERROR,r,i);this.hls.trigger(u.ERROR,t);return}t&&"data:"!==r.protocol&&r.searchParams.set("_HLS_start_offset",""+t);let n=this.hls.config,a=new n.loader(n),s={responseType:"json",url:r.href},o=n.interstitialAssetListLoadPolicy.default,c={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};return a.load(s,c,{onSuccess:(t,r,i,n)=>{let a=t.data;if(!Array.isArray(null==a?void 0:a.ASSETS)){let t=this.assignAssetListError(e,l.ASSET_LIST_PARSING_ERROR,Error("Invalid interstitial asset list"),i.url,r,n);this.hls.trigger(u.ERROR,t);return}e.assetListResponse=a,this.hls.trigger(u.ASSET_LIST_LOADED,{event:e,assetListResponse:a,networkDetails:n})},onError:(t,r,i,n)=>{let a=this.assignAssetListError(e,l.ASSET_LIST_LOAD_ERROR,Error(`Error loading X-ASSET-LIST: HTTP status ${t.code} ${t.text} (${r.url})`),r.url,n,i);this.hls.trigger(u.ERROR,a)},onTimeout:(t,r,i)=>{let n=this.assignAssetListError(e,l.ASSET_LIST_LOAD_TIMEOUT,Error(`Timeout loading X-ASSET-LIST (${r.url})`),r.url,t,i);this.hls.trigger(u.ERROR,n)}}),this.hls.trigger(u.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,r,i,n,a){return e.error=r,{type:o.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:r,networkDetails:a,stats:n}}}function nk(e){null==e||e.play().catch(()=>{})}function nF(e,t){return`[${e}] Advancing timeline position to ${t}`}class nO extends y{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{var e,t;let r=this.currentTime;if(void 0===r||this.playbackDisabled||!this.schedule)return;let i=r-this.timelinePos;if(Math.abs(i)<1/7056e5)return;let n=i<=-.01;this.timelinePos=r,this.bufferedPos=r;let a=this.playingItem;if(!a){this.checkBuffer();return}if(n&&this.schedule.resetErrorsInRange(r,r-i)&&this.updateSchedule(!0),this.checkBuffer(),n&&r<a.start||r>=a.end){let t=this.findItemIndex(a),i=this.schedule.findItemIndexAtTime(r);if(-1===i&&(i=t+(n?-1:1),this.log(`seeked ${n?"back ":""}to position not covered by schedule ${r} (resolving from ${t} to ${i})`)),!this.isInterstitial(a)&&null!=(e=this.media)&&e.paused&&(this.shouldPlay=!1),!n&&i>t){let e=this.schedule.findJumpRestrictedIndex(t+1,i);if(e>t){this.setSchedulePosition(e);return}}this.setSchedulePosition(i);return}let s=this.playingAsset;if(!s){if(this.playingLastItem&&this.isInterstitial(a)){let e=a.event.assetList[0];e&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,e))}return}let o=s.timelineStart,l=s.duration||0;(n&&r<o||r>=o+l)&&(null!=(t=a.event)&&t.appendInPlace&&(this.clearInterstitial(a.event,a),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,s))},this.onTimeupdate=()=>{let e=this.currentTime;if(void 0===e||this.playbackDisabled||!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();let t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;let e=this.findItemIndex(t);this.setSchedulePosition(e+1)}let r=this.playingAsset;r&&e>=r.timelineStart+(r.duration||0)&&this.setScheduleToAssetAtTime(e,r)},this.onScheduleUpdate=(e,t)=>{let r=this.schedule;if(!r)return;let i=this.playingItem,n=r.events||[],a=r.items||[],s=r.durations,o=e.map(e=>e.identifier),l=!!(n.length||o.length);(l||t)&&this.log(`INTERSTITIALS_UPDATED (${n.length}): ${n}
Schedule: ${a.map(e=>nP(e))} pos: ${this.timelinePos}`),o.length&&this.log(`Removed events ${o}`);let c=null,h=null;i&&(c=this.updateItem(i,this.timelinePos),this.itemsMatch(i,c)?this.playingItem=c:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);let d=this.bufferingItem;if(d&&(h=this.updateItem(d,this.bufferedPos),this.itemsMatch(d,h)?this.bufferingItem=h:d.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(d.event,null))),e.forEach(e=>{e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,null)})}),this.playerQueue.forEach(e=>{if(e.interstitial.appendInPlace){let t=e.assetItem.timelineStart,r=e.timelineOffset-t;if(r)try{e.timelineOffset=t}catch(i){Math.abs(r)>.025&&this.warn(`${i} ("${e.assetId}" ${e.timelineOffset}->${t})`)}}}),l||t){if(this.hls.trigger(u.INTERSTITIALS_UPDATED,{events:n.slice(0),schedule:a.slice(0),durations:s,removedIds:o}),this.isInterstitial(i)&&o.includes(i.event.identifier)){this.warn(`Interstitial "${i.event.identifier}" removed while playing`),this.primaryFallback(i.event);return}i&&this.trimInPlace(c,i),d&&h!==c&&this.trimInPlace(h,d),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new nL(e),this.schedule=new nD(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){let e=this.hls;e&&(e.on(u.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(u.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(u.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(u.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(u.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(u.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(u.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(u.BUFFER_APPENDED,this.onBufferAppended,this),e.on(u.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(u.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(u.MEDIA_ENDED,this.onMediaEnded,this),e.on(u.ERROR,this.onError,this),e.on(u.DESTROYING,this.onDestroying,this))}unregisterListeners(){let e=this.hls;e&&(e.off(u.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(u.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(u.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(u.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(u.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(u.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(u.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(u.BUFFER_CODECS,this.onBufferCodecs,this),e.off(u.BUFFER_APPENDED,this.onBufferAppended,this),e.off(u.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(u.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(u.MEDIA_ENDED,this.onMediaEnded,this),e.off(u.ERROR,this.onError,this),e.off(u.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){let e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){ra(e,"play",this.onPlay),ra(e,"pause",this.onPause),ra(e,"seeking",this.onSeeking),ra(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){let r=this.media=t.media;rn(r,"seeking",this.onSeeking),rn(r,"timeupdate",this.onTimeupdate),rn(r,"play",this.onPlay),rn(r,"pause",this.onPause)}onMediaAttached(e,t){let r=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,null===r)this.checkStart();else if(!i){this.clearScheduleState();let e=this.findItemIndex(r);this.setSchedulePosition(e)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){let r=!!t.transferMedia,i=this.media;if(this.media=null,!r&&(i&&this.removeMediaListeners(i),this.detachedData)){let e=this.getBufferingPlayer();e&&(this.log(`Removing schedule state for detachedData and ${e}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;let e=this,t=()=>e.bufferingItem||e.waitingItem,r=t=>t?e.getAssetPlayer(t.identifier):t,i=(t,i,n,s,o)=>{if(t){let l=t[i].start,u=t.event;if(u){if("playout"===i||u.timelineOccupancy!==nw.Point){let e=r(n);(null==e?void 0:e.interstitial)===u&&(l+=e.assetItem.startOffset+e[o])}}else l+=("bufferedPos"===s?a():e[s])-t.start;return l}return 0},n=(t,r)=>{var i,n;if(0!==t&&"primary"!==r&&null!=(i=e.schedule)&&i.length){let i=e.schedule.findItemIndexAtTime(t),a=null==(n=e.schedule.items)?void 0:n[i];if(a)return t+(a[r].start-a.start)}return t},a=()=>{let t=e.bufferedPos;return t===Number.MAX_VALUE?s("primary"):Math.max(t,0)},s=t=>{var r,i;return null!=(r=e.primaryDetails)&&r.live?e.primaryDetails.edge:(null==(i=e.schedule)?void 0:i.durations[t])||0},o=(t,n)=>{var a,s;let o=e.effectivePlayingItem;if(null!=o&&null!=(a=o.event)&&a.restrictions.skip||!e.schedule)return;e.log(`seek to ${t} "${n}"`);let l=e.effectivePlayingItem,u=e.schedule.findItemIndexAtTime(t,n),c=null==(s=e.schedule.items)?void 0:s[u],h=e.getBufferingPlayer(),d=null==h?void 0:h.interstitial,f=null==d?void 0:d.appendInPlace,p=l&&e.itemsMatch(l,c);if(l&&(f||p)){let a=r(e.playingAsset),s=(null==a?void 0:a.media)||e.primaryMedia;if(s){let r="primary"===n?s.currentTime:i(l,n,e.playingAsset,"timelinePos","currentTime"),o=t-r,u=(f?r:s.currentTime)+o;if(u>=0&&(!a||f||u<=a.duration)){s.currentTime=u;return}}}if(c){let r=t;if("primary"!==n){let e=t-c[n].start;r=c.start+e}let i=!e.isInterstitial(c);if((!e.isInterstitial(l)||l.event.appendInPlace)&&(i||c.event.appendInPlace)){let t=e.media||(f?null==h?void 0:h.media:null);t&&(t.currentTime=r)}else if(l){let a=e.findItemIndex(l);if(u>a){let t=e.schedule.findJumpRestrictedIndex(a+1,u);if(t>a){e.setSchedulePosition(t);return}}let s=0;if(i)e.timelinePos=r,e.checkBuffer();else{let e=c.event.assetList,r=t-(c[n]||c).start;for(let t=e.length;t--;){let i=e[t];if(i.duration&&r>=i.startOffset&&r<i.startOffset+i.duration){s=t;break}}}e.setSchedulePosition(u,s)}}},l=()=>{let r=e.effectivePlayingItem;if(e.isInterstitial(r))return r;let i=t();return e.isInterstitial(i)?i:null},u={get bufferedEnd(){let r=t(),n=e.bufferingItem;if(n&&n===r){var c;return i(n,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-n.playout.start||(null==(c=e.bufferingAsset)?void 0:c.startOffset)||0}return 0},get currentTime(){let t=l(),r=e.effectivePlayingItem;if(r&&r===t)return i(r,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-r.playout.start;return 0},set currentTime(time){let t=l(),r=e.effectivePlayingItem;r&&r===t&&o(time+r.playout.start,"playout")},get duration(){let e=l();if(e)return e.playout.end-e.playout.start;return 0},get assetPlayers(){var h;let t=null==(h=l())?void 0:h.event.assetList;if(t)return t.map(t=>e.getAssetPlayer(t.identifier));return[]},get playingIndex(){var d;let t=null==(d=l())?void 0:d.event;if(t&&e.effectivePlayingAsset)return t.findAssetIndex(e.effectivePlayingAsset);return -1},get scheduleItem(){return l()}};return this.manager={get events(){var f;return(null==(f=e.schedule)||null==(f=f.events)?void 0:f.slice(0))||[]},get schedule(){var p;return(null==(p=e.schedule)||null==(p=p.items)?void 0:p.slice(0))||[]},get interstitialPlayer(){if(l())return u;return null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){let r=t();return e.findItemIndex(r)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){let t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return a()},get currentTime(){let t=e.timelinePos;return t>0?t:0},set currentTime(time){o(time,"primary")},get duration(){return s("primary")},get seekableStart(){var m;return(null==(m=e.primaryDetails)?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(time){o(time,"integrated")},get duration(){return s("integrated")},get seekableStart(){var g;return n((null==(g=e.primaryDetails)?void 0:g.fragmentStart)||0,"integrated")}},skip:()=>{let t=e.effectivePlayingItem,r=null==t?void 0:t.event;if(r&&!r.restrictions.skip){let i=e.findItemIndex(t);r.appendInPlace?o(t.playout.start+t.event.duration+.001,"playout"):e.advanceAfterAssetEnded(r,i,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;let t=this.playingItem,r=null==(e=this.schedule)?void 0:e.items;return!!this.playbackStarted&&!!t&&!!r&&this.findItemIndex(t)===r.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t;if(null===this.mediaSelection)return;let r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let i=this.media;!i&&null!=(e=this.bufferingItem)&&null!=(e=e.event)&&e.appendInPlace&&(i=this.primaryMedia);let a=null==(t=i)?void 0:t.currentTime;if(void 0!==a&&n(a))return a}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!!(null!=e&&e.event)}retreiveMediaSource(e,t){let r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){let r=e.interstitial.appendInPlace,i=e.media;if(r&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}let r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${eB(r)}`),this.detachedData=r}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var r,i;let n;if(e.media===t)return;let a=null,s=this.hls,o=e!==s,l=o&&e.interstitial.appendInPlace,u=null==(r=this.detachedData)?void 0:r.mediaSource;if(s.media)l&&(a=s.transferMedia(),this.detachedData=a),n="Primary";else if(u){let e=this.getBufferingPlayer();e?(a=e.transferMedia(),n=`${e}`):n="detached MediaSource"}else n="detached media";if(!a){if(u)a=this.detachedData,this.log(`using detachedData: MediaSource ${eB(a)}`);else if(!this.detachedData||s.media===t){let e=this.playerQueue;e.length>1&&e.forEach(e=>{if(o&&e.interstitial.appendInPlace!==l){let t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${t}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}let c=a&&"mediaSource"in a&&(null==(i=a.mediaSource)?void 0:i.readyState)!=="closed",h=c&&a?a:t;this.log(`${c?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${n} (media.currentTime: ${t.currentTime})`);let d=this.schedule;if(h===a&&d){let t=o&&e.assetId===d.assetIdAtEnd;h.overrides={duration:d.duration,endOfStream:!o||t,cueRemoval:!o}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){let e=this.schedule,t=null==e?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);let r=this.timelinePos,i=this.effectivePlayingItem;if(-1===r){let r=this.hls.startPosition;if(this.log(nF("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){let r=e.findEventIndex(t[0].identifier);this.setSchedulePosition(r)}else if(r>=0||!this.primaryLive){let t=this.timelinePos=r>0?r:0,i=e.findItemIndexAtTime(t);this.setSchedulePosition(i)}}else if(i&&!this.playingItem){let t=e.findItemIndex(i);this.setSchedulePosition(t)}}advanceAssetBuffering(e,t){let r=e.event,i=r.findAssetIndex(t),n=nM(r,i);if(r.isAssetPastPlayoutLimit(n)){if(this.schedule){var a;let t=null==(a=this.schedule.items)?void 0:a[this.findItemIndex(e)+1];t&&this.bufferedToItem(t)}}else this.bufferedToEvent(e,n)}advanceAfterAssetEnded(e,t,r){let i=nM(e,r);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){let r=this.schedule.items;if(r){let i=t+1;if(i>=r.length){this.setSchedulePosition(-1);return}let n=e.resumeTime;this.timelinePos<n&&(this.log(nF("advanceAfterAssetEnded",n)),this.timelinePos=n,e.appendInPlace&&this.advanceInPlace(n),this.checkBuffer(this.bufferedPos<n)),this.setSchedulePosition(i)}}}else{if(e.appendInPlace){let t=e.assetList[i];t&&this.advanceInPlace(t.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){let r=this.schedule;if(!r)return;let i=t.parentIdentifier,n=r.getEvent(i);if(n){let t=r.findEventIndex(i),a=r.findAssetIndex(n,e);this.advanceAfterAssetEnded(n,t,a-1)}}setSchedulePosition(e,t){var r,i,n;let a=null==(r=this.schedule)?void 0:r.items;if(!a||this.playbackDisabled)return;let s=e>=0?a[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s?nP(s):s}) pos: ${this.timelinePos}`);let o=this.waitingItem||this.playingItem,l=this.playingLastItem;if(this.isInterstitial(o)){let r=o.event,c=this.playingAsset,h=null==c?void 0:c.identifier,d=h?this.getAssetPlayer(h):null;if(d&&h&&(!this.eventItemsMatch(o,s)||void 0!==t&&h!==r.assetList[t].identifier)){let t=r.findAssetIndex(c);if(this.log(`INTERSTITIAL_ASSET_ENDED ${t+1}/${r.assetList.length} ${nR(c)}`),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(u.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:t,event:r,schedule:a.slice(0),scheduleIndex:e,player:d}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(r,this.findItemIndex(this.playingItem),t);return}this.retreiveMediaSource(h,s),d.media&&!(null!=(i=this.detachedData)&&i.mediaSource)&&d.detachMedia()}if(!this.eventItemsMatch(o,s)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${r} ${nP(o)}`),r.hasPlayed=!0,this.hls.trigger(u.INTERSTITIAL_ENDED,{event:r,schedule:a.slice(0),scheduleIndex:e}),r.cue.once)){this.updateSchedule();let e=null==(n=this.schedule)?void 0:n.items;if(s&&e){let r=this.findItemIndex(s);this.advanceSchedule(r,e,t,o,l)}return}}this.advanceSchedule(e,a,t,o,l)}advanceSchedule(e,t,r,i,n){let a=this.schedule;if(!a)return;let s=t[e]||null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(t=>{let r=t.interstitial,i=a.findEventIndex(r.identifier);(i<e||i>e+1)&&this.clearInterstitial(r,s)}),this.isInterstitial(s)){this.timelinePos=Math.min(Math.max(this.timelinePos,s.start),s.end);let n=s.event;if(void 0===r){r=a.findAssetIndex(n,this.timelinePos);let t=nM(n,r-1);if(n.isAssetPastPlayoutLimit(t)||n.appendInPlace&&this.timelinePos===s.end){this.advanceAfterAssetEnded(n,e,r);return}r=t}let l=this.waitingItem;this.assetsBuffered(s,o)||this.setBufferingItem(s);let c=this.preloadAssets(n,r);if(this.eventItemsMatch(s,l||i)||(this.waitingItem=s,this.log(`INTERSTITIAL_STARTED ${nP(s)} ${n.appendInPlace?"append in place":""}`),this.hls.trigger(u.INTERSTITIAL_STARTED,{event:n,schedule:t.slice(0),scheduleIndex:e})),!n.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${n}`);return}if(n.assetListLoader&&(n.assetListLoader.destroy(),n.assetListLoader=void 0),!o){this.log(`Waiting for attachMedia to start Interstitial ${n}`);return}this.waitingItem=this.endedItem=null,this.playingItem=s;let h=n.assetList[r];if(!h){this.advanceAfterAssetEnded(n,e,r||0);return}if(c||(c=this.getAssetPlayer(h.identifier)),null===c||c.destroyed){let e=n.assetList.length;this.warn(`asset ${r+1}/${e} player destroyed ${n}`),(c=this.createAssetPlayer(n,h,r)).loadSource()}if(!this.eventItemsMatch(s,this.bufferingItem)&&n.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(c,r,t,e,o),this.shouldPlay&&nk(c.media)}else s?(this.resumePrimary(s,e,i),this.shouldPlay&&nk(this.hls.media)):n&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e;return null==(e=this.mediaSelection)?void 0:e.main.details}get primaryLive(){var e;return!!(null!=(e=this.primaryDetails)&&e.live)}resumePrimary(e,t,r){var i,n;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${nP(e)}`),!(null!=(i=this.detachedData)&&i.mediaSource)){let r=this.timelinePos;(r<e.start||r>=e.end)&&(r=this.getPrimaryResumption(e,t),this.log(nF("resumePrimary",r)),this.timelinePos=r),this.attachPrimary(r,e)}if(!r)return;let a=null==(n=this.schedule)?void 0:n.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${nP(e)}`),this.hls.trigger(u.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){let r=e.start;if(this.primaryLive){let e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(r<e.fragmentStart||r>e.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){let t=this.getAssetPlayer(e.identifier);return null!=t&&t.hls?t.hls.bufferedToEnd:th.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;let i=this.primaryMedia;if(!i)return;let n=this.hls;n.media?this.checkBuffer():(this.transferMediaTo(n,i),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(nF("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;let i=this.hls;!i.loadingEnabled||!i.media||Math.abs(((null==(r=i.mainForwardBufferInfo)?void 0:r.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),null==(e=this.schedule)||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(u.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(u.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level||!this.schedule)return;let r=this.hls.levels[t.level];if(!r.details)return;let i=v(v({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){let r=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=v(v({},this.altSelection),{},{audio:r});return}let n=v(v({},i),{},{audio:r});this.mediaSelection=n}onSubtitleTrackUpdated(e,t){let r=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=v(v({},this.altSelection),{},{subtitles:r});return}let n=v(v({},i),{},{subtitles:r});this.mediaSelection=n}onAudioTrackSwitching(e,t){let r=eL(t);this.playerQueue.forEach(({hls:e})=>e&&(e.setAudioOption(t)||e.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){let r=eL(t);this.playerQueue.forEach(({hls:e})=>e&&(e.setSubtitleOption(t)||-1!==t.id&&e.setSubtitleOption(r)))}onBufferCodecs(e,t){let r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){let r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){let e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;let t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){let i=t[e];if(i.cue.post){var r;let e=this.schedule.findEventIndex(i.identifier),t=null==(r=this.schedule.items)?void 0:r[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){let t=this.playingItem;if(!this.playingLastItem&&t){let e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){var r;let i=null==(r=this.schedule)?void 0:r.items;return e&&i&&i[this.findItemIndex(e,t)]||null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((t,r)=>{e.event.isAssetPastPlayoutLimit(r)&&this.clearAssetPlayer(t.identifier,null)});let r=e.end+.25,i=th.bufferInfo(this.primaryMedia,r,0);(i.end>r||(i.nextStart||0)>r)&&(this.log(`trim buffered interstitial ${nP(e)} (was ${nP(t)})`),this.attachPrimary(r,null,!0),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===(null==(r=t.event)?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;let r=this.mediaSelection;r&&(null==(t=this.schedule)||t.updateSchedule(r,[],e))}checkBuffer(e){var t;let r=null==(t=this.schedule)?void 0:t.items;if(!r)return;let i=th.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,r,e)}updateBufferedPos(e,t,r){let i=this.schedule,n=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(1===t.length&&this.itemsMatch(t[0],n)){this.bufferedPos=e;return}let a=this.playingItem,s=this.findItemIndex(a),o=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;let r=this.findItemIndex(n),i=Math.min(r+1,t.length-1),a=t[i];if((-1===o&&n&&e>=n.end||null!=(l=a.event)&&l.appendInPlace&&e+.01>=a.start)&&(o=i),this.isInterstitial(n)){let e=n.event;if(i-s>1&&!1===e.appendInPlace||0===e.assetList.length&&e.assetListLoader)return}if(this.bufferedPos=e,o>r&&o>s)this.bufferedToItem(a);else{let t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&a.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(a)&&this.preloadAssets(a.event,0)}}else r&&a&&!this.itemsMatch(a,n)&&(o===s?this.bufferedToItem(a):o===s+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some(e=>{let r=this.getAssetPlayer(e.identifier);return!(null!=r&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){let t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){let{items:i,events:n}=r;if(!i||!n)return t;let a=this.isInterstitial(e),s=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));let o=s?s.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${nP(e)}`+(t?` (${o.toFixed(2)} remaining)`:"")),!this.playbackDisabled){if(a){let t=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((e,r)=>{let i=this.getAssetPlayer(e.identifier);i&&(r===t&&i.loadSource(),i.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(e=>e.pauseBuffering())}this.hls.trigger(u.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:n.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){let r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==r){this.bufferingAsset=null;let t=this.detachedData;t&&t.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e)}}}preloadPrimary(e){let t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){let r=e.event,i=0===r.assetList.length&&!r.assetListLoader,n=r.cue.once;if(i||!n){let e=this.preloadAssets(r,t);if(null!=e&&e.interstitial.appendInPlace){let t=this.primaryMedia;t&&this.bufferAssetPlayer(e,t)}}}preloadAssets(e,t){let r=e.assetUrl,i=e.assetList.length,n=0===i&&!e.assetListLoader,a=e.cue.once;if(n){let n;let a=e.timelineStart;if(e.appendInPlace){var s;let t=this.playingItem;this.isInterstitial(t)||(null==t||null==(s=t.nextEvent)?void 0:s.identifier)!==e.identifier||this.flushFrontBuffer(a+.25)}let o=0;if(!this.playingItem&&this.primaryLive&&-1===(o=this.hls.startPosition)&&(o=this.hls.liveSyncPosition||0),o&&!(e.cue.pre||e.cue.post)){let e=o-a;e>0&&(n=Math.round(1e3*e)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:i} ${e}${n?` live-start: ${o} start-offset: ${n}`:""}`),r)return this.createAsset(e,0,0,a,e.duration,r);let l=this.assetListLoader.loadAssetList(e,n);l&&(e.assetListLoader=l)}else if(!a&&i){for(let r=t;r<i;r++){let t=e.assetList[r],i=this.getAssetPlayerQueueIndex(t.identifier);(-1===i||this.playerQueue[i].destroyed)&&!t.error&&this.createAssetPlayer(e,t,r)}let r=e.assetList[t];if(r){let e=this.getAssetPlayer(r.identifier);return e&&e.loadSource(),e}}return null}flushFrontBuffer(e){let t=this.requiredTracks;t&&(this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(t=>{this.hls.trigger(u.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})}))}getAssetPlayerQueueIndex(e){let t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return -1}getAssetPlayer(e){let t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){let{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,i,n,a){let s={parentIdentifier:e.identifier,identifier:`${e.identifier}-${t+1}-${nS(a)}`,duration:n,startOffset:r,timelineStart:i,uri:a};return this.createAssetPlayer(e,s,t)}createAssetPlayer(e,t,r){let i=this.hls,n=i.userConfig,a=n.videoPreference,s=i.loadLevelObj||i.levels[i.currentLevel];(a||s)&&(a=g({},a),s.videoCodec&&(a.videoCodec=s.videoCodec),s.videoRange&&(a.allowedVideoRanges=[s.videoRange]));let c=i.audioTracks[i.audioTrack],h=i.subtitleTracks[i.subtitleTrack],d=0;if(this.primaryLive||e.appendInPlace){let e=this.timelinePos-t.timelineStart;if(e>1){let r=t.duration;r&&e<r&&(d=e)}}let f=t.identifier,p=v(v({},n),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:f,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:d,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:c||n.audioPreference,subtitlePreference:h||n.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(p.timelineOffset=t.timelineStart));let m=p.cmcd;null!=m&&m.sessionId&&m.contentId&&(p.cmcd=g({},m,{contentId:nS(t.uri)})),this.getAssetPlayer(f)&&this.warn(`Duplicate date range identifier ${e} and asset ${f}`);let A=new nB(this.HlsPlayerClass,p,e,t);this.playerQueue.push(A),e.assetList[r]=t;let y=!0,E=i=>{if(i.live){var n;let t=Error(`Interstitials MUST be VOD assets ${e}`),i={fatal:!0,type:o.OTHER_ERROR,details:l.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},a=(null==(n=this.schedule)?void 0:n.findEventIndex(e.identifier))||-1;this.handleAssetItemError(i,e,a,r,t.message);return}let a=i.edge-i.fragmentStart,s=t.duration;(y||null===s||a>s)&&(y=!1,this.log(`Interstitial asset "${f}" duration change ${s} > ${a}`),t.duration=a,this.updateSchedule())};A.on(u.LEVEL_UPDATED,(e,{details:t})=>E(t)),A.on(u.LEVEL_PTS_UPDATED,(e,{details:t})=>E(t)),A.on(u.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());let x=(e,t)=>{let r=this.getAssetPlayer(f);if(r&&t.tracks){r.off(u.BUFFER_CODECS,x),r.tracks=t.tracks;let e=this.primaryMedia;this.bufferingAsset===r.assetItem&&e&&!r.media&&this.bufferAssetPlayer(r,e)}};A.on(u.BUFFER_CODECS,x),A.on(u.BUFFERED_TO_END,()=>{var r;let i=this.getAssetPlayer(f);if(this.log(`buffered to end of asset ${i}`),!i||!this.schedule)return;let n=this.schedule.findEventIndex(e.identifier),a=null==(r=this.schedule.items)?void 0:r[n];this.isInterstitial(a)&&this.advanceAssetBuffering(a,t)});let _=t=>()=>{if(!this.getAssetPlayer(f)||!this.schedule)return;this.shouldPlay=!0;let r=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,r,t)};return A.once(u.MEDIA_ENDED,_(r)),A.once(u.PLAYOUT_LIMIT_REACHED,_(1/0)),A.on(u.ERROR,(t,i)=>{if(!this.schedule)return;let n=this.getAssetPlayer(f);if(i.details===l.BUFFER_STALLED_ERROR){if(null!=n&&n.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${i.error} ${e}`)}),A.on(u.DESTROYING,()=>{if(!this.getAssetPlayer(f)||!this.schedule)return;let t=Error(`Asset player destroyed unexpectedly ${f}`),i={fatal:!0,type:o.OTHER_ERROR,details:l.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(i,e,this.schedule.findEventIndex(e.identifier),r,t.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${nR(t)}`),this.hls.trigger(u.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:A}),A}clearInterstitial(e,t){e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,t)}),e.reset()}resetAssetPlayer(e){let t=this.getAssetPlayerQueueIndex(e);if(-1!==t){this.log(`reset asset player "${e}" after error`);let r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){let r=this.getAssetPlayerQueueIndex(e);if(-1!==r){let e=this.playerQueue[r];this.log(`clear ${e} toSegment: ${t?nP(t):t}`),this.transferMediaFromPlayer(e,t),this.playerQueue.splice(r,1),e.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,i,n){let{interstitial:a,assetItem:s,assetId:o}=e,l=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=s,c&&c.identifier===o||(c&&(this.clearAssetPlayer(c.identifier,r[i]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${l} ${nR(s)}`),this.hls.trigger(u.INTERSTITIAL_ASSET_STARTED,{asset:s,assetListIndex:t,event:a,schedule:r.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,n)}bufferAssetPlayer(e,t){var r,i;if(!this.schedule)return;let{interstitial:n,assetItem:a}=e,s=this.schedule.findEventIndex(n.identifier),u=null==(r=this.schedule.items)?void 0:r[s];if(!u)return;e.loadSource(),this.setBufferingItem(u),this.bufferingAsset=a;let c=this.getBufferingPlayer();if(c===e)return;let h=n.appendInPlace;if(h&&(null==c?void 0:c.interstitial.appendInPlace)===!1)return;let d=(null==c?void 0:c.tracks)||(null==(i=this.detachedData)?void 0:i.tracks)||this.requiredTracks;if(h&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!C(d,e.tracks)){let t=Error(`Asset ${nR(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),r={fatal:!0,type:o.OTHER_ERROR,details:l.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},i=n.findAssetIndex(a);this.handleAssetItemError(r,n,s,i,t.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){let t=this.schedule,r=this.primaryMedia;if(!t||!r)return;let i=r.currentTime,n=t.findAssetIndex(e,i),a=e.assetList[n];if(a){let s=this.getAssetPlayer(a.identifier);if(s){let o=s.currentTime||i-a.timelineStart,l=s.duration-o;if(this.warn(`Stalled at ${o} of ${o+l} in ${s} ${e} (media.currentTime: ${i})`),o&&(l/r.playbackRate<.5||s.bufferedInPlaceToEnd(r))&&s.hls){let r=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,r,n)}}}}advanceInPlace(e){let t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,i,n){if(e.details===l.BUFFER_STALLED_ERROR)return;let a=t.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a?nR(a):a} ${e.error}`),!this.schedule)return;let s=(null==a?void 0:a.identifier)||"",o=this.getAssetPlayerQueueIndex(s),c=this.playerQueue[o]||null,h=this.schedule.items,d=g({},e,{fatal:!1,errorAction:e2(!0),asset:a,assetListIndex:i,event:t,schedule:h,scheduleIndex:r,player:c});if(this.hls.trigger(u.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;let f=this.playingAsset,p=this.bufferingAsset,m=Error(n);if(a&&(this.clearAssetPlayer(s,null),a.error=m),t.assetList.some(e=>!e.error))for(let e=i;e<t.assetList.length;e++)this.resetAssetPlayer(t.assetList[e].identifier);else t.error=m;this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===s?this.advanceAfterAssetEnded(t,r,i):p&&p.identifier===s&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,p)}primaryFallback(e){let t=e.timelineStart,r=this.effectivePlayingItem;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${nP(r)} error: ${e.error}`);let i=this.timelinePos;-1===i&&(i=this.hls.startPosition);let n=this.updateItem(r,i);if(this.itemsMatch(r,n)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;let a=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var r,i,n;let a=t.event,s=a.identifier,o=t.assetListResponse.ASSETS;if(!(null!=(r=this.schedule)&&r.hasEvent(s)))return;let l=a.timelineStart,u=a.duration,c=0;o.forEach((e,t)=>{let r=parseFloat(e.DURATION);this.createAsset(a,t,c,l+c,r,e.URI),c+=r}),a.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${u}) ${a}`);let h=this.waitingItem,d=(null==h?void 0:h.event.identifier)===s;this.updateSchedule();let f=null==(i=this.bufferingItem)?void 0:i.event;if(d){let e=this.schedule.findEventIndex(s),t=null==(n=this.schedule.items)?void 0:n[e];if(t){if(!this.playingItem&&this.timelinePos>t.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==e){a.error=Error(`Interstitial no longer within playback range ${this.timelinePos} ${a}`),this.updateSchedule(!0),this.primaryFallback(a);return}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==f?void 0:f.identifier)===s){let e=a.assetList[0];if(e){let t=this.getAssetPlayer(e.identifier);if(f.appendInPlace){let e=this.primaryMedia;t&&e&&this.bufferAssetPlayer(t,e)}else t&&t.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case l.ASSET_LIST_PARSING_ERROR:case l.ASSET_LIST_LOAD_ERROR:case l.ASSET_LIST_LOAD_TIMEOUT:{let e=t.interstitial;e&&(this.updateSchedule(!0),this.primaryFallback(e));break}case l.BUFFER_STALLED_ERROR:{let e=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(e)&&e.event.appendInPlace){this.handleInPlaceStall(e.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0)}}}}class nU extends rl{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",f.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(u.LEVEL_LOADED,this.onLevelLoaded,this),e.on(u.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(u.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(u.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(u.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(u.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();let{hls:e}=this;e.off(u.LEVEL_LOADED,this.onLevelLoaded,this),e.off(u.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(u.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(u.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(u.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(u.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ro.IDLE,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){let r;let{frag:i,success:n}=t;if(this.fragContextChanged(i)||(k(i)&&(this.fragPrevious=i),this.state=ro.IDLE),!n)return;let a=this.tracksBuffered[this.currentTrackId];if(!a)return;let s=i.start;for(let e=0;e<a.length;e++)if(s>=a[e].start&&s<=a[e].end){r=a[e];break}let o=i.start+i.duration;r?r.end=o:(r={start:s,end:o},a.push(r)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){let{startOffset:r,endOffset:i}=t;if(0===r&&i!==Number.POSITIVE_INFINITY){let e=i-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let r=0;r<t.length;){if(t[r].end<=e){t.shift();continue}if(t[r].start<e)t[r].start=e;else break;r++}}),this.fragmentTracker.removeFragmentsInRange(r,e,f.SUBTITLE)}}onError(e,t){let r=t.frag;(null==r?void 0:r.type)===f.SUBTITLE&&(t.details===l.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ro.STOPPED&&(this.state=ro.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&ib(this.levels,t)){this.levels=t.map(e=>new eI(e));return}this.tracksBuffered=[],this.levels=t.map(e=>{let t=new eI(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,f.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!(null!=(r=this.levels)&&r.length)||-1===this.currentTrackId){this.clearInterval();return}let i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==ro.STOPPED&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var r,i;let{currentTrackId:n,levels:a}=this,{details:s,id:o}=t;if(!a){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}let l=a[o];if(o>=a.length||!l)return;this.log(`Subtitle track ${o} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(s.live||null!=(r=l.details)&&r.live){if(s.deltaUpdateFailed)return;let e=this.mainDetails;if(!e){this.startFragRequested=!1;return}let t=e.fragments[0];l.details?0===(c=this.alignPlaylists(s,l.details,null==(i=this.levelLastLoaded)?void 0:i.details))&&t&&t2(s,c=t.start):s.hasProgramDateTime&&e.hasProgramDateTime?(ri(s,e),c=s.fragmentStart):t&&t2(s,c=t.start),e&&!this.startFragRequested&&this.setStartPosition(e,c)}l.details=s,this.levelLastLoaded=l,o===n&&(this.hls.trigger(u.SUBTITLE_TRACK_UPDATED,{details:s,id:o,groupId:t.groupId}),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===ro.IDLE&&!eH(null,s.fragments,this.media.currentTime,0)&&(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0))}_handleFragmentLoadComplete(e){let{frag:t,payload:r}=e,i=t.decryptdata,n=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&null!=i&&i.key&&i.iv&&t_(i.method)){let e=performance.now();this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer,tb(i.method)).catch(e=>{throw n.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(r=>{let i=performance.now();n.trigger(u.FRAG_DECRYPTED,{frag:t,payload:r,stats:{tstart:e,tdecrypt:i}})}).catch(e=>{this.warn(`${e.name}: ${e.message}`),this.state=ro.IDLE})}}doTick(){if(!this.media){this.state=ro.IDLE;return}if(this.state===ro.IDLE){let{currentTrackId:e,levels:t}=this,r=null==t?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;let{config:i}=this,n=this.getLoadPosition(),{end:a,len:s}=th.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n,i.maxBufferHole),o=r.details;if(s>this.hls.maxBufferLength+o.levelTargetDuration)return;let l=o.fragments,u=l.length,c=o.edge,h=null,d=this.fragPrevious;if(a<c){let e=i.maxFragLookUpTolerance;(h=eH(d,l,Math.max(l[0].start,a),a>c-e?0:e))||!d||!(d.start<l[0].start)||(h=l[0])}else h=l[u-1];if(!(h=this.filterReplacedPrimary(h,r.details)))return;let f=l[h.sn-o.startSN-1];if(f&&f.cc===h.cc&&this.fragmentTracker.getState(f)===e3.NOT_LOADED&&(h=f),this.fragmentTracker.getState(h)===e3.NOT_LOADED){let e=this.mapToInitFragWhenRequired(h);e&&this.loadFragment(e,r,a)}}}loadFragment(e,t,r){k(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new nN(this.tracksBuffered[this.currentTrackId]||[])}}class nN{constructor(e){this.buffered=void 0;let t=(t,r,i)=>{if((r>>>=0)>i-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${i})`);return e[r][t]};this.buffered={get length(){return e.length},end:r=>t("end",r,e.length),start:r=>t("start",r,e.length)}}}let nz={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},nG=e=>String.fromCharCode(nz[e]||e),nH={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},nQ={17:2,18:4,21:6,22:8,23:10,19:13,20:15},nV={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},nW={25:2,26:4,29:6,30:8,31:10,27:13,28:15},nj=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class nY{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){let r="function"==typeof t?t():t;S.log(`${this.time} [${e}] ${r}`)}}}let nK=function(e){let t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class nq{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){let t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){let i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class nX{constructor(){this.uchar=" ",this.penState=new nq}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class n${constructor(e){this.chars=[],this.pos=0,this.currPenState=new nq,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<100;e++)this.chars.push(new nX);this.logger=e}equals(e){for(let t=0;t<100;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<100;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<100;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=100)}moveCursor(e){let t=this.pos+e;if(e>1)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();let t=nG(e);if(this.pos>=100){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<100;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){let e=[],t=!0;for(let r=0;r<100;r++){let i=this.chars[r].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class nJ{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<15;t++)this.rows.push(new n$(e));this.logger=e}reset(){for(let e=0;e<15;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let r=0;r<15;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<15;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+eB(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let e=0;e<15;e++)this.rows[e].clear();let e=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){let i=r.rows[e].cueStartTime,n=this.logger.time;if(null!==i&&null!==n&&i<n)for(let i=0;i<this.nrRollUpRows;i++)this.rows[t-this.nrRollUpRows+i+1].copy(r.rows[e+i])}}this.currRow=t;let r=this.rows[this.currRow];if(null!==e.indent){let t=Math.max(e.indent-1,0);r.setCursor(e.indent),e.color=r.chars[t].penState.foreground}let i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+eB(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());let e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;let t=[],r="",i=-1;for(let r=0;r<15;r++){let n=this.rows[r].getTextString();n&&(i=r+1,e?t.push("Row "+i+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}getTextAndFormat(){return this.rows}}class nZ{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new nJ(r),this.nonDisplayedMemory=new nJ(r),this.lastOutputScreen=new nJ(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);let t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){let e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){let t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{let r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+eB(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){let t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&!this.displayedMemory.isEmpty()&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e)}}class n0{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;let i=this.logger=new nY;this.channels=[null,new nZ(e,t,i),new nZ(e+1,r,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let e=0;e<t.length;e+=2){var r;let i=127&t[e],n=127&t[e+1],a=!1,s=null;if(0===i&&0===n)continue;this.logger.log(3,()=>"["+nK([t[e],t[e+1]])+"] -> ("+nK([i,n])+")");let o=this.cmdHistory;if(i>=16&&i<=31){if(o.a===i&&o.b===n){o.a=null,o.b=null,this.logger.log(3,()=>"Repeated command ("+nK([i,n])+") is dropped");continue}(r=this.cmdHistory).a=i,r.b=n,(a=this.parseCmd(i,n))||(a=this.parseMidrow(i,n)),a||(a=this.parsePAC(i,n)),a||(a=this.parseBackgroundAttributes(i,n))}else o.a=null,o.b=null;if(!a&&(s=this.parseChars(i,n))){let e=this.currentChannel;e&&e>0?this.channels[e].insertChars(s):this.logger.log(2,"No channel found yet. TEXT-MODE?")}a||s||this.logger.log(2,()=>"Couldn't parse cleaned data "+nK([i,n])+" orig: "+nK([t[e],t[e+1]]))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;let r=20===e||21===e||23===e?1:2,i=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let r=0;if((17===e||25===e)&&t>=32&&t<=47){if((r=17===e?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;let i=this.channels[r];return!!i&&(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+nK([e,t])+")"),!0)}return!1}parsePAC(e,t){let r;let i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,n=(16===e||24===e)&&t>=64&&t<=95;if(!(i||n))return!1;let a=e<=23?1:2;r=t>=64&&t<=95?1===a?nH[e]:nV[e]:1===a?nQ[e]:nW[e];let s=this.channels[a];return!!s&&(s.setPAC(this.interpretPAC(r,t)),this.currentChannel=a,!0)}interpretPAC(e,t){let r;let i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=(1&r)==1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i}parseChars(e,t){let r;let i=null,n=null;if(e>=25?(r=2,n=e-8):(r=1,n=e),n>=17&&n<=19){let e;e=17===n?t+80:18===n?t+112:t+144,this.logger.log(2,()=>"Special char '"+nG(e)+"' in channel "+r),i=[e]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+nK(i).join(",")),i}parseBackgroundAttributes(e,t){let r;if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;let i={};return 16===e||24===e?(r=Math.floor((t-32)/2),i.background=nj[r],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0)),this.channels[e<=23?1:2].setBkgData(i),!0}reset(){var e;for(let e=0;e<Object.keys(this.channels).length;e++){let t=this.channels[e];t&&t.reset()}(e=this.cmdHistory).a=null,e.b=null}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){let r=this.channels[t];r&&r.cueSplitAtTime(e)}}}var n1=function(){if(null!=tT&&tT.VTTCue)return self.VTTCue;let e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!=typeof t||!Array.isArray(e))return!1;let r=t.toLowerCase();return!!~e.indexOf(r)&&r}function i(e,...t){let r=1;for(;r<arguments.length;r++){let t=arguments[r];for(let r in t)e[r]=t[r]}return e}function n(n,a,s){let o={enumerable:!0};this.hasBeenReset=!1;let l="",u=!1,c=n,h=a,d=s,f=null,p="",m=!0,g="auto",A="start",v=50,y="middle",E=50,x="middle";Object.defineProperty(this,"id",i({},o,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(this,"pauseOnExit",i({},o,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(this,"startTime",i({},o,{get:function(){return c},set:function(e){if("number"!=typeof e)throw TypeError("Start time must be set to a number.");c=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"endTime",i({},o,{get:function(){return h},set:function(e){if("number"!=typeof e)throw TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"text",i({},o,{get:function(){return d},set:function(e){d=""+e,this.hasBeenReset=!0}})),Object.defineProperty(this,"region",i({},o,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"vertical",i({},o,{get:function(){return p},set:function(t){let i=r(e,t);if(!1===i)throw SyntaxError("An invalid or illegal string was specified.");p=i,this.hasBeenReset=!0}})),Object.defineProperty(this,"snapToLines",i({},o,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(this,"line",i({},o,{get:function(){return g},set:function(e){if("number"!=typeof e&&"auto"!==e)throw SyntaxError("An invalid number or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"lineAlign",i({},o,{get:function(){return A},set:function(e){let i=r(t,e);if(!i)throw SyntaxError("An invalid or illegal string was specified.");A=i,this.hasBeenReset=!0}})),Object.defineProperty(this,"position",i({},o,{get:function(){return v},set:function(e){if(e<0||e>100)throw Error("Position must be between 0 and 100.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"positionAlign",i({},o,{get:function(){return y},set:function(e){let i=r(t,e);if(!i)throw SyntaxError("An invalid or illegal string was specified.");y=i,this.hasBeenReset=!0}})),Object.defineProperty(this,"size",i({},o,{get:function(){return E},set:function(e){if(e<0||e>100)throw Error("Size must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(this,"align",i({},o,{get:function(){return x},set:function(e){let i=r(t,e);if(!i)throw SyntaxError("An invalid or illegal string was specified.");x=i,this.hasBeenReset=!0}})),this.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();class n2{decode(e,t){if(!e)return"";if("string"!=typeof e)throw Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function n3(e){function t(e,t,r,i){return(0|e)*3600+(0|t)*60+(0|r)+parseFloat(i||0)}let r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}class n4{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){let r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function n5(e,t,r,i){let n=i?e.split(i):[e];for(let e in n){if("string"!=typeof n[e])continue;let i=n[e].split(r);2===i.length&&t(i[0],i[1])}}let n6=new n1(0,0,""),n8="middle"===n6.align?"middle":"center";function n9(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class n7{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new n2,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){let t=this;function r(){let e=t.buffer,r=0;for(e=n9(e);r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;let i=e.slice(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.slice(r),i}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;let i=(e=r()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(null!=i&&i[0]))throw Error("Malformed WebVTT signature.");t.state="HEADER"}let n=!1;for(;t.buffer&&/\r\n|\n/.test(t.buffer);)switch(n?n=!1:e=r(),t.state){case"HEADER":if(/:/.test(e)){var i;i=e,n5(i,function(e,t){},/:/)}else e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new n1(0,0,""),t.state="CUE",-1===e.indexOf("-->")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{!function(e,t,r){let i=e;function n(){let t=n3(e);if(null===t)throw Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=n(),a(),"-->"!==e.slice(0,3))throw Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);e=e.slice(3),a(),t.endTime=n(),a(),function(e,t){let i=new n4;n5(e,function(e,t){let n;switch(e){case"region":for(let n=r.length-1;n>=0;n--)if(r[n].id===t){i.set(e,r[n].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":n=t.split(","),i.integer(e,n[0]),i.percent(e,n[0])&&i.set("snapToLines",!1),i.alt(e,n[0],["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start",n8,"end"]);break;case"position":n=t.split(","),i.percent(e,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start",n8,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",n8,"end","left","right"])}},/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");let n=i.get("line","auto");"auto"===n&&-1===n6.line&&(n=-1),t.line=n,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",n8);let a=i.get("position","auto");"auto"===a&&50===n6.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{let r=-1!==e.indexOf("-->");if(!e||r&&(n=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw Error("Malformed WebVTT signature.")}catch(e){this.onparsingerror&&this.onparsingerror(e)}return this.onflush&&this.onflush(),this}}let ae=/\r\n|\n\r|\n|\r/g,at=function(e,t,r=0){return e.slice(r,r+t.length)===t},ar=function(e){let t=parseInt(e.slice(-3)),r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),a=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!n(t)||!n(r)||!n(i)||!n(a))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=6e4*i,t+=36e5*a};function ai(e,t,r){return nS(e.toString())+nS(t.toString())+nS(r)}let an=function(e,t,r){let i=e[t],n=e[i.prevCC];if(!n||!n.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;null!=(a=n)&&a.new;){var a;e.ccOffset+=i.start-n.start,i.new=!1,n=e[(i=n).prevCC]}e.presentationOffset=r},aa="stpp.ttml.im1t",as=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ao=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,al={left:"start",center:"center",right:"end",start:"start",end:"end"};function au(e,t,r,i){let n=W(new Uint8Array(e),["mdat"]);if(0===n.length){i(Error("Could not parse IMSC1 mdat"));return}let a=n.map(e=>T(e)),s=function(e,t,r=1,i=!1){return r7(e,1,1/r,i)}(t.baseTime,0,t.timescale);try{a.forEach(e=>r(function(e,t){let r=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!r)throw Error("Invalid ttml");let i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(i).reduce((e,t)=>(e[t]=r.getAttribute(`ttp:${t}`)||i[t],e),{}),a="preserve"!==r.getAttribute("xml:space"),s=ah(ac(r,"styling","style")),o=ah(ac(r,"layout","region")),l=ac(r,"body","[begin]");return[].map.call(l,e=>{let r=function e(t,r){return[].slice.call(t.childNodes).reduce((t,i,n)=>{var a;return"br"===i.nodeName&&n?t+"\n":null!=(a=i.childNodes)&&a.length?e(i,r):r?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}(e,a);if(!r||!e.hasAttribute("begin"))return null;let i=ap(e.getAttribute("begin"),n),l=ap(e.getAttribute("dur"),n),u=ap(e.getAttribute("end"),n);if(null===i)throw af(e);if(null===u){if(null===l)throw af(e);u=i+l}let c=new n1(i-t,u-t,r);c.id=ai(c.startTime,c.endTime,c.text);let h=o[e.getAttribute("region")],d=function(e,t,r){let i="http://www.w3.org/ns/ttml#styling",n=null,a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return a&&r.hasOwnProperty(a)&&(n=r[a]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((r,a)=>{let s=ad(t,i,a)||ad(e,i,a)||ad(n,i,a);return s&&(r[a]=s),r},{})}(h,s[e.getAttribute("style")],s),{textAlign:f}=d;if(f){let e=al[f];e&&(c.lineAlign=e),c.align=f}return g(c,d),c}).filter(e=>null!==e)}(e,s)))}catch(e){i(e)}}function ac(e,t,r){let i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(r)):[]}function ah(e){return e.reduce((e,t)=>{let r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function ad(e,t,r){return e&&e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function af(e){return Error(`Could not parse ttml timestamp ${e}`)}function ap(e,t){if(!e)return null;let r=n3(e);return null===r&&(as.test(e)?r=function(e,t){let r=as.exec(e),i=(0|r[4])+(0|r[5])/t.subFrameRate;return(0|r[1])*3600+(0|r[2])*60+(0|r[3])+i/t.frameRate}(e,t):ao.test(e)&&(r=function(e,t){let r=ao.exec(e),i=Number(r[1]);switch(r[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(e,t))),r}class am{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class ag{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=ay(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(u.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(u.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(u.FRAG_LOADING,this.onFragLoading,this),e.on(u.FRAG_LOADED,this.onFragLoaded,this),e.on(u.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(u.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(u.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(u.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(u.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){let{hls:e}=this;e.off(u.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(u.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(u.FRAG_LOADING,this.onFragLoading,this),e.off(u.FRAG_LOADED,this.onFragLoaded,this),e.off(u.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(u.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(u.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(u.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(u.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){let e=new am(this,"textTrack1"),t=new am(this,"textTrack2"),r=new am(this,"textTrack3"),i=new am(this,"textTrack4");this.cea608Parser1=new n0(1,e,t),this.cea608Parser2=new n0(3,r,i)}addCues(e,t,r,i,n){let a=!1;for(let e=n.length;e--;){var s;let i=n[e],o=(s=i[0],Math.min(i[1],r)-Math.max(s,t));if(o>=0&&(i[0]=Math.min(i[0],t),i[1]=Math.max(i[1],r),a=!0,o/(r-t)>.5))return}if(a||n.push([t,r]),this.config.renderTextTracksNatively){let n=this.captionsTracks[e];this.Cues.newCue(n,t,r,i)}else{let n=this.Cues.newCue(null,t,r,i);this.hls.trigger(u.CUES_PARSED,{type:"captions",cues:n,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:n,trackId:a}){let{unparsedVttFrags:s}=this;r===f.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:n,trackId:a}),s.length&&(this.unparsedVttFrags=[],s.forEach(e=>{this.initPTS[e.frag.cc]?this.onFragLoaded(u.FRAG_LOADED,e):this.hls.trigger(u.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e.frag,error:Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){let{media:r}=this;if(r)for(let i=0;i<r.textTracks.length;i++){let n=r.textTracks[i];if(av(n,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return n}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;let{captionsProperties:t,captionsTracks:r,media:i}=this,{label:n,languageCode:a}=t[e],s=this.getExistingTrack(n,a);if(s)r[e]=s,nE(r[e]),nv(r[e],i);else{let t=this.createTextTrack("captions",n,a);t&&(t[e]=!0,r[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;let t=this.captionsProperties[e];if(!t)return;let r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(u.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,r){let i=this.media;if(i)return i.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){let r=!!t.transferMedia;if(this.media=null,r)return;let{captionsTracks:i}=this;Object.keys(i).forEach(e=>{nE(i[e]),delete i[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=ay(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){let{media:e}=this;if(!e)return;let t=e.textTracks;if(t)for(let e=0;e<t.length;e++)nE(t[e])}onSubtitleTracksUpdated(e,t){let r=t.subtitleTracks||[],i=r.some(e=>e.textCodec===aa);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(ib(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){let e=this.media,t=e?n_(e.textTracks):null;if(this.tracks.forEach((e,r)=>{let i;if(t){let r=null;for(let i=0;i<t.length;i++)if(t[i]&&av(t[i],e)){r=t[i],t[i]=null;break}r&&(i=r)}if(i)nE(i);else{let t=aA(e);(i=this.createTextTrack(t,e.name,e.lang))&&(i.mode="disabled")}i&&this.textTracks.push(i)}),null!=t&&t.length){let e=t.filter(e=>null!==e).map(e=>e.label);e.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){let e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(u.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{let t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;let r=`textTrack${t[1]}`,i=this.captionsProperties[r];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)})}closedCaptionsForLevel(e){let t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===f.MAIN){var r,i;let{cea608Parser1:e,cea608Parser2:n,lastSn:a}=this,{cc:s,sn:o}=t.frag,l=null!=(r=null==(i=t.part)?void 0:i.index)?r:-1;e&&n&&(o!==a+1||o===a&&l!==this.lastPartIndex+1||s!==this.lastCc)&&(e.reset(),n.reset()),this.lastCc=s,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){let{frag:r,payload:i}=t;if(r.type===f.SUBTITLE){if(i.byteLength){let e=r.decryptdata,n="stats"in t;if(null==e||!e.encrypted||n){let e=this.tracks[r.level],n=this.vttCCs;n[r.cc]||(n[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),e&&e.textCodec===aa?this._parseIMSC1(r,i):this._parseVTTs(t)}}else this.hls.trigger(u.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:Error("Empty subtitle payload")})}}_parseIMSC1(e,t){let r=this.hls;au(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),r.trigger(u.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{r.logger.log(`Failed to parse IMSC1: ${t}`),r.trigger(u.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;let{frag:r,payload:i}=e,{initPTS:n,unparsedVttFrags:a}=this,s=n.length-1;if(!n[r.cc]&&-1===s){a.push(e);return}let o=this.hls;!function(e,t,r,i,n,a,s){let o;let l=new n7,u=T(new Uint8Array(e)).trim().replace(ae,"\n").split("\n"),c=[],h=t?function(e,t=1){return r7(e,9e4,1/t)}(t.baseTime,t.timescale):0,d="00:00.000",f=0,p=0,m=!0;l.oncue=function(e){let a=r[i],s=r.ccOffset,l=(f-h)/9e4;if(null!=a&&a.new&&(void 0!==p?s=r.ccOffset=a.start:an(r,i,l)),l){if(!t){o=Error("Missing initPTS for VTT MPEGTS");return}s=l-r.presentationOffset}let u=e.endTime-e.startTime,d=is((e.startTime+s-p)*9e4,9e4*n)/9e4;e.startTime=Math.max(d,0),e.endTime=Math.max(d+u,0);let m=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(m)),e.id||(e.id=ai(e.startTime,e.endTime,m)),e.endTime>0&&c.push(e)},l.onparsingerror=function(e){o=e},l.onflush=function(){if(o){s(o);return}a(c)},u.forEach(e=>{if(m){if(at(e,"X-TIMESTAMP-MAP=")){m=!1,e.slice(16).split(",").forEach(e=>{at(e,"LOCAL:")?d=e.slice(6):at(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))});try{p=ar(d)/1e3}catch(e){o=e}return}""===e&&(m=!1)}l.parse(e+"\n")}),l.flush()}(null!=(t=r.initSegment)&&t.data?J(r.initSegment.data,new Uint8Array(i)).buffer:i,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,e=>{this._appendCues(e,r.level),o.trigger(u.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},t=>{let n="Missing initPTS for VTT MPEGTS"===t.message;n?a.push(e):this._fallbackToIMSC1(r,i),o.logger.log(`Failed to parse VTT cue: ${t}`),n&&s>r.cc||o.trigger(u.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:t})})}_fallbackToIMSC1(e,t){let r=this.tracks[e.level];r.textCodec||au(t,this.initPTS[e.cc],()=>{r.textCodec=aa,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){let r=this.hls;if(this.config.renderTextTracksNatively){let r=this.textTracks[t];if(!r||"disabled"===r.mode)return;e.forEach(e=>ny(r,e))}else{let i=this.tracks[t];if(!i)return;let n=i.default?"default":"subtitles"+t;r.trigger(u.CUES_PARSED,{type:"subtitles",cues:e,track:n})}}onFragDecrypted(e,t){let{frag:r}=t;r.type===f.SUBTITLE&&this.onFragLoaded(u.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;let{frag:r,samples:i}=t;if(r.type!==f.MAIN||"NONE"!==this.closedCaptionsForLevel(r))for(let e=0;e<i.length;e++){let t=i[e].bytes;if(t){this.cea608Parser1||this.initCea608Parsers();let r=this.extractCea608Data(t);this.cea608Parser1.addData(i[e].pts,r[0]),this.cea608Parser2.addData(i[e].pts,r[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:i,type:n}){let{media:a}=this;if(a&&!(a.currentTime<r)){if(!n||"video"===n){let{captionsTracks:e}=this;Object.keys(e).forEach(i=>nx(e[i],t,r))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==i){let{textTracks:e}=this;Object.keys(e).forEach(r=>nx(e[r],t,i))}}}extractCea608Data(e){let t=[[],[]],r=31&e[0],i=2;for(let n=0;n<r;n++){let r=e[i++],n=127&e[i++],a=127&e[i++];if((0!==n||0!==a)&&(4&r)!=0){let e=3&r;(0===e||1===e)&&(t[e].push(n),t[e].push(a))}}return t}}function aA(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function av(e,t){return!!e&&e.kind===aA(t)&&iw(t,e)}function ay(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}let aE=/\s/,ax={newCue(e,t,r,i){let n,a,s,o,l;let u=[],c=self.VTTCue||self.TextTrackCue;for(let d=0;d<i.rows.length;d++)if(n=i.rows[d],s=!0,o=0,l="",!n.isEmpty()){var h;for(let e=0;e<n.chars.length;e++)aE.test(n.chars[e].uchar)&&s?o++:(l+=n.chars[e].uchar,s=!1);n.cueStartTime=t,t===r&&(r+=1e-4),o>=16?o--:o++;let i=n9(l.trim()),f=ai(t,r,i);null!=e&&null!=(h=e.cues)&&h.getCueById(f)||((a=new c(t,r,i)).id=f,a.line=d+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*o/32)),u.push(a))}return e&&u.length&&(u.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),u.forEach(t=>ny(e,t))),u}};function a_(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}let ab=/(\d+)-(\d+)\/(\d+)/;class aS{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||aw,this.controller=new self.AbortController,this.stats=new D}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){let i=this.stats;if(i.loading.start)throw Error("Loader can only be used once.");i.loading.start=self.performance.now();let a=function(e,t){let r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(g({},e.headers))};return e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),r}(e,this.controller.signal),s="arraybuffer"===e.responseType,o=s?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=l&&n(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(ig(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(r=>{var a;this.response=this.loader=r;let o=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},u-(o-i.loading.start)),!r.ok){let{status:e,statusText:t}=r;throw new aC(t||"fetch, bad network response",e,r)}i.loading.first=o,i.total=function(e){let t=e.get("Content-Range");if(t){let e=function(e){let t=ab.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(n(e))return e}let r=e.get("Content-Length");if(r)return parseInt(r)}(r.headers)||i.total;let l=null==(a=this.callbacks)?void 0:a.onProgress;return l&&n(t.highWaterMark)?this.loadProgressively(r,i,e,t.highWaterMark,l):s?r.arrayBuffer():"json"===e.responseType?r.json():r.text()}).then(r=>{var a,s;let l=this.response;if(!l)throw Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);let u=r[o];u&&(i.loaded=i.total=u);let c={url:l.url,data:r,code:l.status},h=null==(a=this.callbacks)?void 0:a.onProgress;h&&!n(t.highWaterMark)&&h(i,e,r,l),null==(s=this.callbacks)||s.onSuccess(c,i,e,l)}).catch(t=>{var r;if(self.clearTimeout(this.requestTimeout),i.aborted)return;let n=t&&t.code||0,a=t?t.message:null;null==(r=this.callbacks)||r.onError({code:n,text:a},e,t?t.details:null,i)})}getCacheAge(){let e=null;if(this.response){let t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,i=0,n){let a=new rc,s=e.body.getReader(),o=()=>s.read().then(s=>{if(s.done)return a.dataLength&&n(t,r,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));let l=s.value,u=l.length;return t.loaded+=u,u<i||a.dataLength?(a.push(l),a.dataLength>=i&&n(t,r,a.flush().buffer,e)):n(t,r,l.buffer,e),o()}).catch(()=>Promise.reject());return o()}}function aw(e,t){return new self.Request(e.url,t)}class aC extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}let aT=/^age:\s*[\d.]+\s*$/im;class aI{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new D,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){let e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){let{config:e,context:t}=this;if(!e||!t)return;let r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;let n=this.xhrSetup;n?Promise.resolve().then(()=>{if(this.loader===r&&!this.stats.aborted)return n(r,t.url)}).catch(e=>{if(this.loader===r&&!this.stats.aborted)return r.open("GET",t.url,!0),n(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(e=>{var n;null==(n=this.callbacks)||n.onError({code:r.status,text:e.message},t,r,i)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);let i=t.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:s}=r.loadPolicy;if(i)for(let t in i)e.setRequestHeader(t,i[t]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=a&&n(a)?a:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){let{context:e,loader:t,stats:r}=this;if(!e||!t)return;let i=t.readyState,n=this.config;if(!r.aborted&&i>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===i)){var a,s,o;self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;let i=t.status,l="text"===t.responseType?t.responseText:null;if(i>=200&&i<300){let n=null!=l?l:t.response;if(null!=n){r.loading.end=Math.max(self.performance.now(),r.loading.first);let o="arraybuffer"===t.responseType?n.byteLength:n.length;r.loaded=r.total=o,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first);let l=null==(a=this.callbacks)?void 0:a.onProgress;l&&l(r,e,n,t);let u={url:t.responseURL,data:n,code:i};null==(s=this.callbacks)||s.onSuccess(u,r,e,t);return}}let u=n.loadPolicy.errorRetry;e$(u,r.retry,!1,{url:e.url,data:void 0,code:i})?this.retry(u):(S.error(`${i} while loading ${e.url}`),null==(o=this.callbacks)||o.onError({code:i,text:t.statusText},e,t,r))}}loadtimeout(){if(!this.config)return;let e=this.config.loadPolicy.timeoutRetry;if(e$(e,this.stats.retry,!0))this.retry(e);else{var t;S.warn(`timeout while loading ${null==(t=this.context)?void 0:t.url}`);let e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){let{context:t,stats:r}=this;this.retryDelay=eq(e,r.retry),r.retry++,S.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){let t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&aT.test(this.loader.getAllResponseHeaders())){let t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}let aM=v(v({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:aI,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ez,bufferController:iB,capLevelController:iL,errorController:e1,fpsController:nA,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:tP,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:ax,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:nU,subtitleTrackController:nb,timelineController:ag,audioStreamController:ix,audioTrackController:iC,emeController:nf,cmcdController:nu,contentSteeringController:nc,interstitialsController:nO});class aR extends to{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var e;this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(u.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){let{hls:e}=this;e&&(e.on(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(u.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){let{hls:e}=this;e&&(e.off(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(u.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;let r=this.media=t.media;rn(r,"playing",this.onMediaPlaying),rn(r,"waiting",this.onMediaWaiting),rn(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();let{media:r}=this;r&&(ra(r,"playing",this.onMediaPlaying),ra(r,"waiting",this.onMediaWaiting),ra(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!(null!=(e=this.media)&&e.readyState)||!this.hasBuffered)return;let t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,i,n;let a=null==(r=this.hls)?void 0:r.config;if(!a)return;let s=this.media;if(!s)return;let{seeking:o}=s,l=this.seeking&&!o,c=!this.seeking&&o,h=s.paused&&!o||s.ended||0===s.playbackRate;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,!o&&(this.nudgeRetry=0,a.nudgeOnVideoHole&&!h&&e>t&&this.nudgeOnVideoHole(e,t)),0===this.waiting&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(h){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&s.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(u.MEDIA_ENDED,{stalled:!1}));return}if(!th.getBuffered(s).length){this.nudgeRetry=0;return}let d=th.bufferInfo(s,e,0),f=d.nextStart||0,p=this.fragmentTracker;if(o&&p&&this.hls){let t=aB(this.hls.inFlightFragments,e),r=d.len>2,i=!f||t||f-e>2&&!p.getPartialFragment(e);if(r||i)return;this.moved=!1}let m=null==(i=this.hls)?void 0:i.latestLevelDetails;if(!this.moved&&null!==this.stalled&&p){if(!(d.len>0)&&!f)return;let t=Math.max(f,d.start||0)-e,r=null!=m&&m.live?2*m.targetduration:2,i=aP(e,p);if(t>0&&(t<=r||i)){s.paused||this._trySkipBufferHole(i);return}}let g=a.detectStallWithCurrentTimeMs,A=self.performance.now(),v=this.waiting,y=this.stalled;if(null===y){if(v>0&&A-v<g)y=this.stalled=v;else{this.stalled=A;return}}let E=A-y;if(!o&&(E>=g||v)&&this.hls){if((null==(n=this.mediaSource)?void 0:n.readyState)==="ended"&&!(null!=m&&m.live)&&1>Math.abs(e-((null==m?void 0:m.edge)||0))){if(this.ended)return;this.ended=e||1,this.hls.trigger(u.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}let x=th.bufferInfo(s,e,a.maxBufferHole);this._tryFixBufferStall(x,E,e)}stallResolved(e){let t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){let r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(u.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;let i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(r=this.buffered.audio)&&r.length&&i&&i.length>1&&e>i.end(0)){let r=th.bufferedInfo(th.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){let r=th.timeRangesToArray(i),n=th.bufferedInfo(r,t,0).bufferedIndex;if(n>-1&&n<r.length-1){let t=th.bufferedInfo(r,e,0).bufferedIndex,i=r[n].end,a=r[n+1].start;if((-1===t||t>n)&&a-i<1&&e-i<2){let r=Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${i} -> ${a} buffered index: ${t}`);this.warn(r.message),this.media.currentTime+=1e-6;let n=aP(e,this.fragmentTracker);n&&"fragment"in n?n=n.fragment:n||(n=void 0);let s=th.bufferInfo(this.media,e,0);this.hls.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:r,reason:r.message,frag:n,buffer:s.len,bufferInfo:s})}}}}}_tryFixBufferStall(e,t,r){var i,n;let{fragmentTracker:a,media:s}=this,o=null==(i=this.hls)?void 0:i.config;if(!s||!a||!o)return;let l=null==(n=this.hls)?void 0:n.latestLevelDetails,u=aP(r,a);if((u||null!=l&&l.live&&r<l.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;let c=e.buffered,h=this.adjacentTraversal(e,r);(c&&c.length>1&&e.len>o.maxBufferHole||e.nextStart&&(e.nextStart-r<o.maxBufferHole||h))&&(t>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){let r=this.fragmentTracker,i=e.nextStart;if(r&&i){let e=r.getFragAtPos(t,f.MAIN),n=r.getFragAtPos(i,f.MAIN);if(e&&n)return n.sn-e.sn<2}return!1}_reportStall(e){let{hls:t,media:r,stallReported:i,stalled:n}=this;if(!i&&null!==n&&r&&t){this.stallReported=!0;let i=Error(`Playback stalling at @${r.currentTime} due to low buffer (${eB(e)})`);this.warn(i.message),t.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len,bufferInfo:e,stalled:{start:n}})}}_trySkipBufferHole(e){var t,r;let{fragmentTracker:i,media:n}=this,a=null==(t=this.hls)?void 0:t.config;if(!n||!i||!a)return 0;let s=n.currentTime,c=th.bufferInfo(n,s,0),h=s<c.start?c.start:c.nextStart;if(h&&this.hls){let t=c.len<=a.maxBufferHole,d=c.len>0&&c.len<1&&n.readyState<3,p=h-s;if(p>0&&(t||d)){if(p>a.maxBufferHole){let t=!1;if(0===s){let e=i.getAppendedFrag(0,f.MAIN);e&&h<e.end&&(t=!0)}if(!t&&e){if(!(null!=(r=this.hls.loadLevelObj)&&r.details)||aB(this.hls.inFlightFragments,h))return 0;let t=!1,n=e.end;for(;n<h;){let e=aP(n,i);if(e)n+=e.duration;else{t=!0;break}}if(t)return 0}}let t=Math.max(h+.05,s+.1);if(this.warn(`skipping hole, adjusting currentTime from ${s} to ${t}`),this.moved=!0,n.currentTime=t,!(null!=e&&e.gap)){let r=Error(`fragment loaded with buffer holes, seeking from ${s} to ${t}`),i={type:o.MEDIA_ERROR,details:l.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:r,reason:r.message,buffer:c.len,bufferInfo:c};e&&("fragment"in e?i.part=e:i.frag=e),this.hls.trigger(u.ERROR,i)}return t}}return 0}_tryNudgeBuffer(e){let{hls:t,media:r,nudgeRetry:i}=this,n=null==t?void 0:t.config;if(!r||!n)return 0;let a=r.currentTime;if(this.nudgeRetry++,i<n.nudgeMaxRetry){let s=a+(i+1)*n.nudgeOffset,c=Error(`Nudging 'currentTime' from ${a} to ${s}`);this.warn(c.message),r.currentTime=s,t.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1,buffer:e.len,bufferInfo:e})}else{let r=Error(`Playhead still not moving while enough data buffered @${a} after ${n.nudgeMaxRetry} nudges`);this.error(r.message),t.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.BUFFER_STALLED_ERROR,error:r,fatal:!0,buffer:e.len,bufferInfo:e})}}}function aB(e,t){let r=aD(e.main);if(r&&r.start<=t)return r;let i=aD(e.audio);return i&&i.start<=t?i:null}function aD(e){if(!e)return null;switch(e.state){case ro.IDLE:case ro.STOPPED:case ro.ENDED:case ro.ERROR:return null}return e.frag}function aP(e,t){return t.getAppendedFrag(e,f.MAIN)||t.getPartialFragment(e)}function aL(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function ak(e,t,r,i,n){let a=new e(t,r,"");try{a.value=i,n&&(a.type=n)}catch(s){a=new e(t,r,eB(n?v({type:n},i):i))}return a}let aF=(()=>{let e=aL();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class aO{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(u.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){let{hls:e}=this;e&&(e.on(u.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(u.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(u.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(u.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){let{hls:e}=this;e&&(e.off(u.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(u.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(u.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(u.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,(null==(r=t.overrides)?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;let t=null==(e=this.hls)?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,t.transferMedia||(this.id3Track&&(this.removeCues&&nE(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){let t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){let r=e[t];if("metadata"===r.kind&&"id3"===r.label)return nv(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;let{enableEmsgMetadataCues:r,enableID3MetadataCues:i}=this.hls.config;if(!r&&!i)return;let{samples:n}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));let a=aL();if(a)for(let e=0;e<n.length;e++){let t=n[e].type;if(t===rM.emsg&&!r||!i)continue;let s=rC(n[e].data),o=n[e].pts,l=o+n[e].duration;l>aF&&(l=aF),l-o<=0&&(l=o+.25);for(let e=0;e<s.length;e++){let r=s[e];if(!rT(r)){this.updateId3CueEnds(o,t);let e=ak(a,o,l,r,t);e&&this.id3Track.addCue(e)}}}}updateId3CueEnds(e,t){var r;let i=null==(r=this.id3Track)?void 0:r.cues;if(i)for(let r=i.length;r--;){let n=i[r];n.type===t&&n.startTime<e&&n.endTime===aF&&(n.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:i}){let{id3Track:n,hls:a}=this;if(!a)return;let{config:{enableEmsgMetadataCues:s,enableID3MetadataCues:o}}=a;n&&(s||o)&&nx(n,t,r,"audio"===i?e=>e.type===rM.audioId3&&o:"video"===i?e=>e.type===rM.emsg&&s:e=>e.type===rM.audioId3&&o||e.type===rM.emsg&&s)}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){var r,i;if(!this.hls||!this.media)return;let{assetPlayerId:a,timelineOffset:s,enableDateRangeMetadataCues:o,interstitialsController:l}=this.hls.config;if(!o)return;let u=aL();if(a&&s&&!l){let{fragmentStart:t,fragmentEnd:r}=e,i=this.assetCue;i?(i.startTime=t,i.endTime=r):u&&(i=this.assetCue=ak(u,t,r,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"))&&(i.id=a,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(i),i.addEventListener("enter",this.onEventCueEnter))}if(!e.hasProgramDateTime)return;let{id3Track:c}=this,{dateRanges:h}=e,d=Object.keys(h),f=this.dateRangeCuesAppended;if(c&&t){if(null!=(r=c.cues)&&r.length){let e=Object.keys(f).filter(e=>!d.includes(e));for(let t=e.length;t--;){let r=e[t],n=null==(i=f[r])?void 0:i.cues;delete f[r],n&&Object.keys(n).forEach(e=>{let t=n[e];if(t){t.removeEventListener("enter",this.onEventCueEnter);try{c.removeCue(t)}catch(e){}}})}}else f=this.dateRangeCuesAppended={}}let p=e.fragments[e.fragments.length-1];if(0!==d.length&&n(null==p?void 0:p.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let e=0;e<d.length;e++){let t=d[e],r=h[t],i=r.startTime,n=f[t],a=(null==n?void 0:n.cues)||{},s=(null==n?void 0:n.durationKnown)||!1,o=aF,{duration:c,endDate:p}=r;if(p&&null!==c)o=i+c,s=!0;else if(r.endOnNext&&!s){let e=d.reduce((e,t)=>{if(t!==r.id){let i=h[t];if(i.class===r.class&&i.startDate>r.startDate&&(!e||r.startDate<e.startDate))return i}return e},null);e&&(o=e.startTime,s=!0)}let m=Object.keys(r.attr);for(let e=0;e<m.length;e++){let c=m[e];if(!("ID"!==c&&"CLASS"!==c&&"CUE"!==c&&"START-DATE"!==c&&"DURATION"!==c&&"END-DATE"!==c&&"END-ON-NEXT"!==c))continue;let h=a[c];if(h)s&&!(null!=n&&n.durationKnown)?h.endTime=o:Math.abs(h.startTime-i)>.01&&(h.startTime=i,h.endTime=o);else if(u){let e=r.attr[c];("SCTE35-OUT"===c||"SCTE35-IN"===c||"SCTE35-CMD"===c)&&(e=M(e));let n=ak(u,i,o,{key:c,data:e},rM.dateRange);n&&(n.id=t,this.id3Track.addCue(n),a[c]=n,l&&("X-ASSET-LIST"===c||"X-ASSET-URL"===c)&&n.addEventListener("enter",this.onEventCueEnter))}}f[t]={cues:a,dateRange:r,durationKnown:s}}}}}class aU{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{let{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;let r=this.computeLatency();if(null===r)return;this._latency=r;let{lowLatencyMode:i,maxLiveSyncPlaybackRate:n}=this.config;if(!i||1===n||!t.live)return;let a=this.targetLatency;if(null===a)return;let s=r-a;if(s<Math.min(this.maxLatency,a+t.targetduration)&&s>.05&&this.forwardBufferLength>1){let t=Math.min(Math.min(2,Math.max(1,n)),Math.max(1,Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20));this.changeMediaPlaybackRate(e,t)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){let{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;let t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){let e=this.levelDetails;if(null===e||null===this.hls)return null;let{holdBack:t,partHoldBack:r,targetduration:i}=e,{liveSyncDuration:n,liveSyncDurationCount:a,lowLatencyMode:s}=this.config,o=this.hls.userConfig,l=s&&r||t;return(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==n?n:a*i),l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,i)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){let e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;let r=this.levelDetails;if(null===r)return null;let i=r.edge,n=e-t-this.edgeStalled;return Math.min(Math.max(i-r.totalduration,n),i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration))}get drift(){let e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){let e=this.levelDetails;if(null===e)return 0;let t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){let{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;let r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){let{hls:e}=this;e&&(e.on(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(u.ERROR,this.onError,this))}unregisterListeners(){let{hls:e}=this;e&&(e.off(u.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(u.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(u.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===l.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(r=this.levelDetails)&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,i;e.playbackRate!==t&&(null==(r=this.hls)||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${null==(i=this.targetLatency)?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){let e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){let e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class aN extends i_{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(u.LEVEL_LOADED,this.onLevelLoaded,this),e.on(u.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(u.FRAG_BUFFERED,this.onFragBuffered,this),e.on(u.ERROR,this.onError,this)}_unregisterListeners(){let{hls:e}=this;e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(u.LEVEL_LOADED,this.onLevelLoaded,this),e.off(u.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(u.FRAG_BUFFERED,this.onFragBuffered,this),e.off(u.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){let r=this.hls.config.preferManagedMediaSource,i=[],n={},a={},s=!1,o=!1,l=!1;t.levels.forEach(e=>{let t=e.attrs,{audioCodec:u,videoCodec:c}=e;u&&(e.audioCodec=u=ef(u,r)||void 0),c&&(c=e.videoCodec=function(e){let t=e.split(",");for(let e=0;e<t.length;e++){let r=t[e].split(".");r.length>2&&"avc1"===r[0]&&(t[e]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return t.join(",")}(c));let{width:h,height:d,unknownCodecs:f}=e,p=(null==f?void 0:f.length)||0;if(s||(s=!!(h&&d)),o||(o=!!c),l||(l=!!u),p||u&&!this.isAudioSupported(u)||c&&!this.isVideoSupported(c)){this.log(`Some or all CODECS not supported "${t.CODECS}"`);return}let{CODECS:m,"FRAME-RATE":g,"HDCP-LEVEL":A,"PATHWAY-ID":v,RESOLUTION:y,"VIDEO-RANGE":E}=t,x=`${v||"."}-`,_=`${x}${e.bitrate}-${y}-${g}-${m}-${E}-${A}`;if(n[_]){if(n[_].uri===e.url||e.attrs["PATHWAY-ID"])n[_].addGroupId("audio",t.AUDIO),n[_].addGroupId("text",t.SUBTITLES);else{let t=a[_]+=1;e.attrs["PATHWAY-ID"]=Array(t+1).join(".");let r=this.createLevel(e);n[_]=r,i.push(r)}}else{let t=this.createLevel(e);n[_]=t,a[_]=1,i.push(t)}}),this.filterAndSortMediaOptions(i,t,s,o,l)}createLevel(e){let t=new eI(e),r=e.supplemental;if(null!=r&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){let e=Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(e.message),t.supportedResult=eE(e,[])}return t}isAudioSupported(e){return es(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return es(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,i,n){var a,s;let c=[],h=[],d=e,f=(null==(a=t.stats)?void 0:a.parsing)||{};if((r||i)&&n&&(d=d.filter(({videoCodec:e,videoRange:t,width:r,height:i})=>{var n;return(!!e||!!(r&&i))&&!!(n=t)&&eS.indexOf(n)>-1})),0===d.length){Promise.resolve().then(()=>{if(this.hls){let e="no level with compatible codecs found in manifest",r=e;t.levels.length&&(r=`one or more CODECS in variant not supported: ${eB(t.levels.map(e=>e.attrs.CODECS).filter((e,t,r)=>r.indexOf(e)===t))}`,this.warn(r),e+=` (${r})`);let i=Error(e);this.hls.trigger(u.ERROR,{type:o.MEDIA_ERROR,details:l.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:i,reason:r})}}),f.end=performance.now();return}t.audioTracks&&az(c=t.audioTracks.filter(e=>!e.audioCodec||this.isAudioSupported(e.audioCodec))),t.subtitles&&az(h=t.subtitles);let p=d.slice(0);d.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return eS.indexOf(e.videoRange)-eS.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){let r=eu(e.videoCodec),i=eu(t.videoCodec);if(r!==i)return i-r}if(e.uri===t.uri&&e.codecSet!==t.codecSet){let r=ec(e.codecSet),i=ec(t.codecSet);if(r!==i)return i-r}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let m=p[0];if(this.steering&&(d=this.steering.filterParsedLevels(d)).length!==p.length){for(let e=0;e<p.length;e++)if(p[e].pathwayId===d[0].pathwayId){m=p[e];break}}this._levels=d;for(let e=0;e<d.length;e++)if(d[e]===m){this._firstLevel=e;let t=m.bitrate,r=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${t}`),(null==(s=this.hls.userConfig)?void 0:s.abrEwmaDefaultEstimate)===void 0){let e=Math.min(t,this.hls.config.abrEwmaDefaultEstimateMax);e>r&&r===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=e)}break}let g=n&&!i,A=this.hls.config,v=!!(A.audioStreamController&&A.audioTrackController),y={levels:d,audioTracks:c,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:n,video:i,altAudio:v&&!g&&c.some(e=>!!e.url)};f.end=performance.now(),this.hls.trigger(u.MANIFEST_PARSED,y)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){let t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){let r=Error("invalid level idx"),i=e<0;if(this.hls.trigger(u.ERROR,{type:o.OTHER_ERROR,details:l.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:r,reason:r.message}),i)return;e=Math.min(e,t.length-1)}let r=this.currentLevelIndex,i=this.currentLevel,n=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],s=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&i&&n===s)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${s?" with Pathway "+s:""} from level ${r}${n?" with Pathway "+n:""}`);let c={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(u.LEVEL_SWITCHING,c);let h=a.details;if(!h||h.live){let e=this.switchParams(a.uri,null==i?void 0:i.details,h);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){let e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){let t=this.steering.pathways(),r=e.filter(e=>-1!==t.indexOf(e));if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){!t.fatal&&t.context&&t.context.type===d.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===f.MAIN){let e=t.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;let r=this._levels[t.level];null!=r&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var r,i;let{level:n,details:a}=t,s=t.levelInfo;if(!s){this.warn(`Invalid level index ${n}`),null!=(i=t.deliveryDirectives)&&i.skip&&(a.deltaUpdateFailed=!0);return}if(s===this.currentLevel||t.withoutMultiVariant){0===s.fragmentError&&(s.loadError=0);let e=s.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(n,t,e)}else null!=(r=t.deliveryDirectives)&&r.skip&&(a.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);let r=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,n=e.attrs["PATHWAY-ID"],a=e.details,s=null==a?void 0:a.age;this.log(`Loading level index ${i}${(null==t?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${n?" Pathway "+n:""}${s&&a.live?" age "+s.toFixed(1)+(a.type?" "+a.type:""):""} ${r}`),this.hls.trigger(u.LEVEL_LOADING,{url:r,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return -1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;let r=this._levels.filter((t,r)=>r!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1));t8(r),this._levels=r,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);let i=r.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(u.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){let{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(u.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function az(e){let t={};e.forEach(e=>{let r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++})}function aG(){return self.SourceBuffer||self.WebKitSourceBuffer}function aH(){if(!w())return!1;let e=aG();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}function aQ(){if(!aH())return!1;let e=w();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(el(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(el(t,"audio"))))}class aV extends rl{constructor(e,t,r){super(e,t,r,"stream-controller",f.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{let e=this.media,t=e?e.currentTime:null;if(null===t||!n(t)||(this.log(`Media seeked to ${t.toFixed(3)}`),!this.getBufferedFrag(t)))return;let r=this.getFwdBufferInfoAtPos(e,t,f.MAIN,0);if(null===r||0===r.len){this.warn(`Main forward buffer length at ${t} on "seeked" event ${r?r.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();let{hls:e}=this;e.on(u.MANIFEST_PARSED,this.onManifestParsed,this),e.on(u.LEVEL_LOADING,this.onLevelLoading,this),e.on(u.LEVEL_LOADED,this.onLevelLoaded,this),e.on(u.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(u.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(u.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(u.BUFFER_CREATED,this.onBufferCreated,this),e.on(u.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(u.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(u.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();let{hls:e}=this;e.off(u.MANIFEST_PARSED,this.onManifestParsed,this),e.off(u.LEVEL_LOADED,this.onLevelLoaded,this),e.off(u.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(u.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(u.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(u.BUFFER_CREATED,this.onBufferCreated,this),e.off(u.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(u.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(u.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){let{lastCurrentTime:r,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=i.startLevel;-1===e&&(i.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=i.firstAutoLevel),i.nextLoadLevel=e,this.level=i.loadLevel,this._hasEnoughToStart=!!t}r>0&&-1===e&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=ro.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ro.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ro.WAITING_LEVEL:{let{levels:e,level:t}=this,r=null==e?void 0:e[t],i=null==r?void 0:r.details;if(!i||i.live&&(this.levelLastLoaded!==r||this.waitForLive(r)))this.hls.nextLoadLevel!==this.level&&(this.state=ro.IDLE);else{if(this.waitForCdnTuneIn(i))break;this.state=ro.IDLE}break}case ro.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate()}this.state===ro.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){let{hls:e,levelLastLoaded:t,levels:r,media:i}=this;if(null===t||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;let n=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(null!=r&&r[n]))return;let a=r[n],s=this.getMainFwdBufferInfo();if(null===s)return;let o=this.getLevelDetails();if(o&&this._streamEnded(s,o)){let e={};2===this.altAudio&&(e.type="video"),this.hls.trigger(u.BUFFER_EOS,e),this.state=ro.ENDED;return}if(!this.buffering)return;e.loadLevel!==n&&-1===e.manualLevel&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=e.nextLoadLevel=n;let l=a.details;if(!l||this.state===ro.WAITING_LEVEL||this.waitForLive(a)){this.level=n,this.state=ro.WAITING_LEVEL,this.startFragRequested=!1;return}let c=s.len,h=this.getMaxBufferLength(a.maxBitrate);if(c>=h)return;this.backtrackFragment&&this.backtrackFragment.start>s.end&&(this.backtrackFragment=null);let d=this.backtrackFragment?this.backtrackFragment.start:s.end,p=this.getNextFragment(d,l);if(this.couldBacktrack&&!this.fragPrevious&&p&&k(p)&&this.fragmentTracker.getState(p)!==e3.OK){var m;let e=(null!=(m=this.backtrackFragment)?m:p).sn-l.startSN,t=l.fragments[e-1];t&&p.cc===t.cc&&(p=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&s.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,d)){if(!p.gap){let e=this.audioOnly&&!this.altAudio?P.AUDIO:P.VIDEO,t=(e===P.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,f.MAIN)}p=this.getNextFragmentLoopLoading(p,l,s,f.MAIN,h)}p&&(!p.initSegment||p.initSegment.data||this.bitrateTest||(p=p.initSegment),this.loadFragment(p,a,d))}loadFragment(e,t,r){let i=this.fragmentTracker.getState(e);i===e3.NOT_LOADED||i===e3.PARTIAL?k(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,f.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){let{levels:e,media:t}=this;if(null!=t&&t.readyState){let r;let i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);let n=this.getLevelDetails();if(null!=n&&n.live){let e=this.getMainFwdBufferInfo();if(!e||e.len<2*n.targetduration)return}if(!t.paused&&e){let t=e[this.hls.nextLoadLevel],i=this.fragLastKbps;r=i&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*i)+1:0}else r=0;let a=this.getBufferedFrag(t.currentTime+r);if(a){let e=this.followingBufferedFrag(a);if(e){this.abortCurrentFrag();let t=e.maxStartPTS?e.maxStartPTS:e.start,r=e.duration,i=Math.max(a.end,t+Math.min(Math.max(r-this.config.maxFragLookUpTolerance,r*(this.couldBacktrack?.5:.125)),r*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(i,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){let e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ro.KEY_LOADING:case ro.FRAG_LOADING:case ro.FRAG_LOADING_WAITING_RETRY:case ro.PARSING:case ro.PARSED:this.state=ro.IDLE}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);let r=t.media;rn(r,"playing",this.onMediaPlaying),rn(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){let{media:r}=this;r&&(ra(r,"playing",this.onMediaPlaying),ra(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(u.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,i=!1;for(let e=0;e<t.levels.length;e++){let n=t.levels[e].audioCodec;n&&(r=r||-1!==n.indexOf("mp4a.40.2"),i=i||-1!==n.indexOf("mp4a.40.5"))}this.audioCodecSwitch=r&&i&&!function(){var e;let t=aG();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){let{levels:r}=this;if(!r||this.state!==ro.IDLE)return;let i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=ro.WAITING_LEVEL)}onLevelLoaded(e,t){var r,i;let{levels:n,startFragRequested:a}=this,s=t.level,o=t.details,l=o.totalduration;if(!n){this.warn(`Levels were reset while loading level ${s}`);return}this.log(`Level ${s} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);let c=t.levelInfo,h=this.fragCurrent;h&&(this.state===ro.FRAG_LOADING||this.state===ro.FRAG_LOADING_WAITING_RETRY)&&h.level!==t.level&&h.loader&&this.abortCurrentFrag();let d=0;if(o.live||null!=(r=c.details)&&r.live){if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,c.details,null==(i=this.levelLastLoaded)?void 0:i.details)}if(c.details=o,this.levelLastLoaded=c,a||this.setStartPosition(o,d),this.hls.trigger(u.LEVEL_UPDATED,{details:o,level:s}),this.state===ro.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=ro.IDLE}a&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){let{config:t,media:r}=this;if(!r)return;let i=this.hls.liveSyncPosition,n=this.getLoadPosition(),a=e.fragmentStart,s=e.edge,o=n>=a-t.maxFragLookUpTolerance&&n<=s;if(null!==i&&r.duration>i&&(n<i||!o)){let a=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!o&&r.readyState<4||n<s-a)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),r.readyState)){if(this.warn(`Playback: ${n.toFixed(3)} is located too far from the end of live sliding playlist: ${s}, reset currentTime to : ${i.toFixed(3)}`),"buffered"===this.config.liveSyncMode){var l;let e=th.bufferInfo(r,i,0);if(!(null!=(l=e.buffered)&&l.length)||e.start<=n){r.currentTime=i;return}let{nextStart:t}=th.bufferedInfo(e.buffered,n,0);t&&(r.currentTime=t)}else r.currentTime=i}}}_handleFragmentLoadProgress(e){var t;let r=e.frag,{part:i,payload:n}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}let s=a[r.level];if(!s){this.warn(`Level ${r.level} not found on progress`);return}let o=s.details;if(!o){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}let l=s.videoCodec,u=o.PTSKnown||!o.live,c=null==(t=r.initSegment)?void 0:t.data,h=this._getAudioCodec(s),d=this.transmuxer=this.transmuxer||new iE(this.hls,f.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=i?i.index:-1,m=new tl(r.level,r.sn,r.stats.chunkCount,n.byteLength,p,-1!==p),g=this.initPTS[r.cc];d.push(n,c,h,l,r,i,o.totalduration,u,m,g)}onAudioTrackSwitching(e,t){let r=this.hls,i=2===this.altAudio;if(eN(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;let e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.fragmentTracker.removeAllFragments(),r.once(u.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(u.AUDIO_TRACK_SWITCHED,t)}),r.trigger(u.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(u.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){let r=eN(t.url,this.hls);if(r){let e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){let r,i;let n=t.tracks,a=!1;for(let e in n){let t=n[e];if("main"===t.id){if(i=e,r=t,"video"===e){let t=n[e];t&&(this.videoBuffer=t.buffer)}}else a=!0}a&&r?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){let{frag:r,part:i}=t,n=r.type===f.MAIN;if(n){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ro.PARSED&&(this.state=ro.IDLE);return}let e=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),k(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}let a=this.media;a&&(!this._hasEnoughToStart&&th.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),n&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=ro.ERROR;return}switch(t.details){case l.FRAG_GAP:case l.FRAG_PARSING_ERROR:case l.FRAG_DECRYPT_ERROR:case l.FRAG_LOAD_ERROR:case l.FRAG_LOAD_TIMEOUT:case l.KEY_LOAD_ERROR:case l.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(f.MAIN,t);break;case l.LEVEL_LOAD_ERROR:case l.LEVEL_LOAD_TIMEOUT:case l.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==ro.WAITING_LEVEL||(null==(r=t.context)?void 0:r.type)!==d.LEVEL||(this.state=ro.IDLE);break;case l.BUFFER_ADD_CODEC_ERROR:case l.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case l.BUFFER_FULL_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case l.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=ro.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==P.AUDIO||!this.altAudio){let e=(t===P.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,t,f.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){let{media:e}=this;if(!e)return;let t=e.currentTime,r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}let i=this.timelineOffset;i&&r&&(r+=i);let n=this.getLevelDetails(),a=th.getBuffered(e),s=a.length?a.start(0):0,o=s-r,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==n?void 0:n.partTarget)||0)))&&(this.log(`adjusting start position by ${o} to match buffer start`),r+=o,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${s}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(e=>{let{hls:r}=this,i=null==e?void 0:e.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=ro.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;let n=i.stats;n.parsing.start=n.parsing.end=n.buffering.start=n.buffering.end=self.performance.now(),r.trigger(u.FRAG_LOADED,e),i.bitrateTest=!1}).catch(t=>{this.state!==ro.STOPPED&&this.state!==ro.ERROR&&(this.warn(t),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){let t=this.playlistType,{hls:r}=this,{remuxResult:i,chunkMeta:a}=e,s=this.getCurrentContext(a);if(!s){this.resetWhenMissingContext(a);return}let{frag:o,part:l,level:c}=s,{video:h,text:d,id3:f,initSegment:p}=i,{details:m}=c,g=this.altAudio?void 0:i.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=ro.PARSING,p){let e=p.tracks;if(e){let i=o.initSegment||o;if(this.unhandledEncryptionError(p,o))return;this._bufferInitSegment(c,e,i,a),r.trigger(u.FRAG_PARSING_INIT_SEGMENT,{frag:i,id:t,tracks:e})}let i=p.initPTS,s=p.timescale,l=this.initPTS[o.cc];if(n(i)&&(!l||l.baseTime!==i||l.timescale!==s)){let e=p.trackId;this.initPTS[o.cc]={baseTime:i,timescale:s,trackId:e},r.trigger(u.INIT_PTS_FOUND,{frag:o,id:t,initPTS:i,timescale:s,trackId:e})}}if(h&&m){g&&"audiovideo"===h.type&&this.logMuxedErr(o);let e=m.fragments[o.sn-1-m.startSN],t=o.sn===m.startSN,r=!e||o.cc>e.cc;if(!1!==i.independent){let{startPTS:e,endPTS:i,startDTS:n,endDTS:s}=h;if(l)l.elementaryStreams[h.type]={startPTS:e,endPTS:i,startDTS:n,endDTS:s};else if(h.firstKeyFrame&&h.independent&&1===a.id&&!r&&(this.couldBacktrack=!0),h.dropped&&h.independent){let n=this.getMainFwdBufferInfo(),a=(n?n.end:this.getLoadPosition())+this.config.maxBufferHole,l=h.firstKeyFramePTS?h.firstKeyFramePTS:e;if(t||!(a<l-this.config.maxBufferHole)||r)r&&(o.gap=!0);else{this.backtrack(o);return}o.setElementaryStreamInfo(h.type,o.start,i,o.start,s,!0)}else t&&e-(m.appliedTimelineOffset||0)>2&&(o.gap=!0);o.setElementaryStreamInfo(h.type,e,i,n,s),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(h,o,l,a,t||r)}else if(t||r)o.gap=!0;else{this.backtrack(o);return}}if(g){let{startPTS:e,endPTS:t,startDTS:r,endDTS:i}=g;l&&(l.elementaryStreams[P.AUDIO]={startPTS:e,endPTS:t,startDTS:r,endDTS:i}),o.setElementaryStreamInfo(P.AUDIO,e,t,r,i),this.bufferFragmentData(g,o,l,a)}if(m&&null!=f&&f.samples.length){let e={id:t,frag:o,details:m,samples:f.samples};r.trigger(u.FRAG_PARSING_METADATA,e)}if(m&&d){let e={id:t,frag:o,details:m,samples:d.samples};r.trigger(u.FRAG_PARSING_USERDATA,e)}}logMuxedErr(e){this.warn(`${k(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,i){if(this.state!==ro.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));let{audio:n,video:a,audiovideo:s}=t;if(n){let r=e.audioCodec,i=ep(n.codec,r);"mp4a"===i&&(i="mp4a.40.5");let a=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){i&&(i=-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");let e=n.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===a.indexOf("firefox")&&(i="mp4a.40.5")}i&&-1!==i.indexOf("mp4a.40.5")&&-1!==a.indexOf("android")&&"audio/mpeg"!==n.container&&(i="mp4a.40.2",this.log(`Android: force audio codec to ${i}`)),r&&r!==i&&this.log(`Swapping manifest audio codec "${r}" for "${i}"`),n.levelCodec=i,n.id=f.MAIN,this.log(`Init audio buffer, container:${n.container}, codecs[selected/level/parsed]=[${i||""}/${r||""}/${n.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=f.MAIN;let r=a.codec;if((null==r?void 0:r.length)===4)switch(r){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e"}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${r}]${a.codec!==r?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}s&&(this.log(`Init audiovideo buffer, container:${s.container}, codecs[level/parsed]=[${e.codecs}/${s.codec}]`),delete t.video,delete t.audio);let o=Object.keys(t);if(o.length){if(this.hls.trigger(u.BUFFER_CODECS,t),!this.hls)return;o.forEach(e=>{let n=t[e].initSegment;null!=n&&n.byteLength&&this.hls.trigger(u.BUFFER_APPENDING,{type:e,data:n,frag:r,part:null,chunkMeta:i,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){let e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,f.MAIN)}get maxBufferLength(){let{levels:e,level:t}=this,r=null==e?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ro.IDLE}checkFragmentChanged(){let e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){let r=e.currentTime;if(th.isBuffered(e,r)?t=this.getAppendedFrag(r):th.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;let e=this.fragPlaying,r=t.level;e&&t.sn===e.sn&&e.level===r||(this.fragPlaying=t,this.hls.trigger(u.FRAG_CHANGED,{frag:t}),e&&e.level===r||this.hls.trigger(u.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){let e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;let t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return n(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;let t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(n(t)){let e=this.getLevelDetails(),r=this.currentFrag||(e?eH(null,e.fragments,t):null);if(r){let e=r.programDateTime;if(null!==e)return new Date(e+(t-r.start)*1e3)}}return null}get currentLevel(){let e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){let e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class aW extends y{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(let r in this.keyIdToKeyInfo){let i=this.keyIdToKeyInfo[r].loader;if(i){var t;if(e&&e!==(null==(t=i.context)?void 0:t.frag.type))return;i.abort()}}}detach(){for(let e in this.keyIdToKeyInfo){let t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){for(let e in this.detach(),this.keyIdToKeyInfo){let t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=l.KEY_LOAD_ERROR,r,i,n){return new ts({type:o.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:r,networkDetails:i})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,n=t.length;i<n;i++){let a=t[i];if(e.cc<=a.cc&&(!k(e)||!k(a)||e.sn<a.sn)||!r&&i==n-1)return this.emeController.selectKeySystemFormat(a).then(e=>{if(!this.emeController)return;a.setKeyFormat(e);let t=tR(e);if(t)return this.emeController.getKeySystemAccess([t])})}if(this.config.requireKeySystemAccessOnStart){let e=tD(this.config);if(e.length)return this.emeController.getKeySystemAccess(e)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,i;t&&e.setKeyFormat(t);let n=e.decryptdata;if(!n){let r=Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,l.KEY_LOAD_ERROR,r))}let a=n.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,l.KEY_LOAD_ERROR,Error(`Invalid key URI: "${a}"`)));let s=aj(n),o=this.keyIdToKeyInfo[s];if(null!=(r=o)&&r.decryptdata.key)return n.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if(this.emeController&&null!=(i=o)&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(o.decryptdata)){case"usable":case"usable-in-future":return o.keyLoadPromise.then(t=>{let{keyInfo:r}=t;return n.key=r.decryptdata.key,{frag:e,keyInfo:r}})}switch(this.log(`${this.keyIdToKeyInfo[s]?"Rel":"L"}oading${n.keyId?" keyId: "+I(n.keyId):""} URI: ${n.uri} from ${e.type} ${e.level}`),o=this.keyIdToKeyInfo[s]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":if("identity"===n.keyFormat)return this.loadKeyHTTP(o,e);return this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,l.KEY_LOAD_ERROR,Error(`Key supplied with unsupported METHOD: "${n.method}"`)))}}loadKeyEME(e,t){let r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){let i=this.emeController.loadKey(r);return(e.keyLoadPromise=i.then(t=>(e.mediaKeySessionContext=t,r))).catch(r=>{throw e.keyLoadPromise=null,"data"in r&&(r.data.frag=t),r})}return Promise.resolve(r)}loadKeyHTTP(e,t){let r=this.config,i=new r.loader(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((n,a)=>{let s={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=r.keyLoadPolicy.default,u={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0};i.load(s,u,{onSuccess:(e,t,r,i)=>{let{frag:s,keyInfo:o}=r,u=aj(o.decryptdata);if(!s.decryptdata||o!==this.keyIdToKeyInfo[u])return a(this.createKeyLoadError(s,l.KEY_LOAD_ERROR,Error("after key load, decryptdata unset or changed"),i));o.decryptdata.key=s.decryptdata.key=new Uint8Array(e.data),s.keyLoader=null,o.loader=null,n({frag:s,keyInfo:o})},onError:(e,r,i,n)=>{this.resetLoader(r),a(this.createKeyLoadError(t,l.KEY_LOAD_ERROR,Error(`HTTP Error ${e.code} loading key ${e.text}`),i,v({url:s.url,data:void 0},e)))},onTimeout:(e,r,i)=>{this.resetLoader(r),a(this.createKeyLoadError(t,l.KEY_LOAD_TIMEOUT,Error("key loading timed out"),i))},onAbort:(e,r,i)=>{this.resetLoader(r),a(this.createKeyLoadError(t,l.INTERNAL_ABORTED,Error("key loading aborted"),i))}})})}resetLoader(e){let{frag:t,keyInfo:r,url:i}=e,n=r.loader;t.keyLoader===n&&(t.keyLoader=null,r.loader=null);let a=aj(r.decryptdata)||i;delete this.keyIdToKeyInfo[a],n&&n.destroy()}}function aj(e){if(e.keyFormat!==tM.FAIRPLAY){let t=e.keyId;if(t)return I(t)}return e.uri}function aY(e){let{type:t}=e;switch(t){case d.AUDIO_TRACK:return f.AUDIO;case d.SUBTITLE_TRACK:return f.SUBTITLE;default:return f.MAIN}}function aK(e,t){let r=e.url;return(void 0===r||0===r.indexOf("data:"))&&(r=t.url),r}class aq{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){let{hls:e}=this;e.on(u.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.LEVEL_LOADING,this.onLevelLoading,this),e.on(u.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(u.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(u.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){let{hls:e}=this;e.off(u.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.LEVEL_LOADING,this.onLevelLoading,this),e.off(u.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(u.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(u.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){let t=this.hls.config,r=t.pLoader,i=t.loader,n=new(r||i)(t);return this.loaders[e.type]=n,n}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(let e in this.loaders){let t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){let{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:d.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){let{id:r,level:i,pathwayId:n,url:a,deliveryDirectives:s,levelInfo:o}=t;this.load({id:r,level:i,pathwayId:n,responseType:"text",type:d.LEVEL,url:a,deliveryDirectives:s,levelOrTrack:o})}onAudioTrackLoading(e,t){let{id:r,groupId:i,url:n,deliveryDirectives:a,track:s}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:d.AUDIO_TRACK,url:n,deliveryDirectives:a,levelOrTrack:s})}onSubtitleTrackLoading(e,t){let{id:r,groupId:i,url:n,deliveryDirectives:a,track:s}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:d.SUBTITLE_TRACK,url:n,deliveryDirectives:a,levelOrTrack:s})}onLevelsUpdated(e,t){let r=this.loaders[d.LEVEL];if(r){let e=r.context;e&&!t.levels.some(t=>t===e.levelOrTrack)&&(r.abort(),delete this.loaders[d.LEVEL])}}load(e){var t;let r;let i=this.hls.config,a=this.getInternalLoader(e);if(a){let t=this.hls.logger,r=a.context;if(r&&r.levelOrTrack===e.levelOrTrack&&(r.url===e.url||r.deliveryDirectives&&!e.deliveryDirectives)){r.url===e.url?t.log(`[playlist-loader]: ignore ${e.url} ongoing request`):t.log(`[playlist-loader]: ignore ${e.url} in favor of ${r.url}`);return}t.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),a.abort()}if(r=e.type===d.MANIFEST?i.manifestLoadPolicy.default:g({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),a=this.createInternalLoader(e),n(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===d.LEVEL&&null!==e.level?t=this.hls.levels[e.level].details:e.type===d.AUDIO_TRACK&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===d.SUBTITLE_TRACK&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){let e=t.partTarget,i=t.targetduration;if(e&&i){let t=1e3*Math.max(3*e,.8*i);r=g({},r,{maxTimeToFirstByteMs:Math.min(t,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,r.maxTimeToFirstByteMs)})}}}let s=r.errorRetry||r.timeoutRetry||{},o={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0};a.load(e,o,{onSuccess:(e,t,r,i)=>{let n=this.getInternalLoader(r);this.resetInternalLoader(r.type);let a=e.data;t.parsing.start=performance.now(),tG.isMediaPlaylist(a)||r.type!==d.MANIFEST?this.handleTrackOrLevelPlaylist(e,t,r,i||null,n):this.handleMasterPlaylist(e,t,r,i)},onError:(e,t,r,i)=>{this.handleNetworkError(t,r,!1,e,i)},onTimeout:(e,t,r)=>{this.handleNetworkError(t,r,!0,void 0,e)}})}checkAutostartLoad(){if(!this.hls)return;let{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,i){let n=this.hls,a=e.data,s=aK(e,r),o=tG.parseMasterPlaylist(a,s);if(o.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,r,o.playlistParsingError,i,t);return}let{contentSteering:l,levels:c,sessionData:h,sessionKeys:d,startTimeOffset:f,variableList:p}=o;this.variableList=p,c.forEach(e=>{let{unknownCodecs:t}=e;if(t){let{preferManagedMediaSource:r}=this.hls.config,{audioCodec:i,videoCodec:n}=e;for(let a=t.length;a--;){let s=t[a];es(s,"audio",r)?(e.audioCodec=i=i?`${i},${s}`:s,en.audio[i.substring(0,4)]=2,t.splice(a,1)):es(s,"video",r)&&(e.videoCodec=n=n?`${n},${s}`:s,en.video[n.substring(0,4)]=2,t.splice(a,1))}}});let{AUDIO:m=[],SUBTITLES:g,"CLOSED-CAPTIONS":A}=tG.parseMasterPlaylistMedia(a,s,o);m.length&&!m.some(e=>!e.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new tA({}),bitrate:0,url:""})),n.trigger(u.MANIFEST_LOADED,{levels:c,audioTracks:m,subtitles:g,captions:A,contentSteering:l,url:s,stats:t,networkDetails:i,sessionData:h,sessionKeys:d,startTimeOffset:f,variableList:p})}handleTrackOrLevelPlaylist(e,t,r,i,a){let s=this.hls,{id:o,level:l,type:c}=r,h=aK(e,r),f=n(l)?l:n(o)?o:0,p=aY(r),m=tG.parseLevelPlaylist(e.data,h,f,p,0,this.variableList);if(c===d.MANIFEST){let e={attrs:new tA({}),bitrate:0,details:m,name:"",url:h};m.requestScheduled=t.loading.start+t3(m,0),s.trigger(u.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:h,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=m,this.handlePlaylistLoaded(m,e,t,r,i,a)}handleManifestParsingError(e,t,r,i,n){this.hls.trigger(u.ERROR,{type:o.NETWORK_ERROR,details:l.MANIFEST_PARSING_ERROR,fatal:t.type===d.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:n})}handleNetworkError(e,t,r=!1,i,n){let a=`A network ${r?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===d.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===d.AUDIO_TRACK||e.type===d.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);let s=Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let c=l.UNKNOWN,h=!1,f=this.getInternalLoader(e);switch(e.type){case d.MANIFEST:c=r?l.MANIFEST_LOAD_TIMEOUT:l.MANIFEST_LOAD_ERROR,h=!0;break;case d.LEVEL:c=r?l.LEVEL_LOAD_TIMEOUT:l.LEVEL_LOAD_ERROR,h=!1;break;case d.AUDIO_TRACK:c=r?l.AUDIO_TRACK_LOAD_TIMEOUT:l.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case d.SUBTITLE_TRACK:c=r?l.SUBTITLE_TRACK_LOAD_TIMEOUT:l.SUBTITLE_LOAD_ERROR,h=!1}f&&this.resetInternalLoader(e.type);let p={type:o.NETWORK_ERROR,details:c,fatal:h,url:e.url,loader:f,context:e,error:s,networkDetails:t,stats:n};if(i){let r=(null==t?void 0:t.url)||e.url;p.response=v({url:r,data:void 0},i)}this.hls.trigger(u.ERROR,p)}handlePlaylistLoaded(e,t,r,i,n,a){let s=this.hls,{type:c,level:h,levelOrTrack:p,id:m,groupId:g,deliveryDirectives:A}=i,v=aK(t,i),y=aY(i),E="number"==typeof i.level&&y===f.MAIN?h:void 0,x=e.playlistParsingError;if(x){if(this.hls.logger.warn(`${x} ${e.url}`),!s.config.ignorePlaylistParsingErrors){s.trigger(u.ERROR,{type:o.NETWORK_ERROR,details:l.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:x,reason:x.message,response:t,context:i,level:E,parent:y,networkDetails:n,stats:r});return}e.playlistParsingError=null}if(!e.fragments.length){let a=e.playlistParsingError=Error("No Segments found in Playlist");s.trigger(u.ERROR,{type:o.NETWORK_ERROR,details:l.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:a,reason:a.message,response:t,context:i,level:E,parent:y,networkDetails:n,stats:r});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),c){case d.MANIFEST:case d.LEVEL:if(E){if(p){if(p!==s.levels[E]){let e=s.levels.indexOf(p);e>-1&&(E=e)}}else E=0}s.trigger(u.LEVEL_LOADED,{details:e,levelInfo:p||s.levels[0],level:E||0,id:m||0,stats:r,networkDetails:n,deliveryDirectives:A,withoutMultiVariant:c===d.MANIFEST});break;case d.AUDIO_TRACK:s.trigger(u.AUDIO_TRACK_LOADED,{details:e,track:p,id:m||0,groupId:g||"",stats:r,networkDetails:n,deliveryDirectives:A});break;case d.SUBTITLE_TRACK:s.trigger(u.SUBTITLE_TRACK_LOADED,{details:e,track:p,id:m||0,groupId:g||"",stats:r,networkDetails:n,deliveryDirectives:A})}}}class aX{static get version(){return rf}static isMSESupported(){return aH()}static isSupported(){return aQ()}static getMediaSource(){return w()}static get Events(){return u}static get MetadataSchema(){return rM}static get ErrorTypes(){return o}static get ErrorDetails(){return l}static get DefaultConfig(){return aX.defaultConfig?aX.defaultConfig:aM}static set DefaultConfig(e){aX.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new rd,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;let t=this.logger=function(e,t,r){let i=_();if("object"==typeof console&&!0===e||"object"==typeof e){let n=["debug","log","info","warn","error"];n.forEach(t=>{i[t]=b(t,e,r)});try{i.log(`Debug logs enabled for "${t}" in hls.js version 1.6.12`)}catch(e){return _()}n.forEach(t=>{S[t]=b(t,e)})}else g(S,i);return i}(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=function(e,t,r){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');let i=function e(t){return t&&"object"==typeof t?Array.isArray(t)?t.map(e):Object.keys(t).reduce((r,i)=>(r[i]=e(t[i]),r),{}):t}(e),n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{let a=`${"level"===e?"playlist":e}LoadPolicy`,s=void 0===t[a],o=[];n.forEach(r=>{let n=`${e}Loading${r}`,l=t[n];if(void 0!==l&&s){o.push(n);let e=i[a].default;switch(t[a]={default:e},r){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&r.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${a}": ${eB(t[a])}`)}),v(v({},i),t)}(aX.DefaultConfig,e,t);this.userConfig=e,r.progressive&&function(e,t){let r=e.loader;r!==aS&&r!==aI?(t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):a_()&&(e.loader=aS,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}(r,t);let{abrController:i,bufferController:n,capLevelController:a,errorController:s,fpsController:o}=r,l=new s(this),c=this.abrController=new i(this),h=new e4(this),d=r.interstitialsController,f=d?this.interstitialsController=new d(this,aX):null,p=this.bufferController=new n(this,h),m=this.capLevelController=new a(this),A=new o(this),y=new aq(this),E=r.contentSteeringController,x=E?new E(this):null,w=this.levelController=new aN(this,x),C=new aO(this),T=new aW(this.config,this.logger),I=this.streamController=new aV(this,h,T),M=this.gapController=new aR(this,h);m.setStreamController(I),A.setStreamController(I);let R=[y,w,I];f&&R.splice(1,0,f),x&&R.splice(1,0,x),this.networkControllers=R;let B=[c,p,M,m,A,C,h];this.audioTrackController=this.createController(r.audioTrackController,R);let D=r.audioStreamController;D&&R.push(this.audioStreamController=new D(this,h,T)),this.subtitleTrackController=this.createController(r.subtitleTrackController,R);let P=r.subtitleStreamController;P&&R.push(this.subtititleStreamController=new P(this,h,T)),this.createController(r.timelineController,B),T.emeController=this.emeController=this.createController(r.emeController,B),this.cmcdController=this.createController(r.cmcdController,B),this.latencyController=this.createController(aU,B),this.coreComponents=B,R.push(l);let L=l.onErrorOut;"function"==typeof L&&this.on(u.ERROR,L,l),this.on(u.MANIFEST_LOADED,y.onManifestLoaded,y)}createController(e,t){if(e){let r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,i){this._emitter.off(e,t,r,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;let r=e===u.ERROR;this.trigger(u.ERROR,{type:o.OTHER_ERROR,details:l.INTERNAL_EXCEPTION,fatal:r,event:e,error:t}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(u.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;let e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){let t=Error(`attachMedia failed: invalid argument (${e})`);this.trigger(u.ERROR,{type:o.OTHER_ERROR,details:l.ATTACH_MEDIA_ERROR,fatal:!0,error:t});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());let t="media"in e,r=t?e.media:e,i=t?e:{media:r};this._media=r,this.trigger(u.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(u.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;let e=this.bufferController.transferMedia();return this.trigger(u.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();let t=this.media,r=this._url,i=this._url=B.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(u.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),this.started&&this.networkControllers);r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){let e={[f.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[f.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[f.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");let e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{let e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(t){let e=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)})}}}()),e}get levels(){return this.levelController.levels||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){let e=this.levelController.startLevel;return -1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){let t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){let{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){let{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){let{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){eb.indexOf(e)>-1&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return -1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){let{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;let r=e.length;for(let i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){let e;let{levels:t,autoLevelCapping:r,maxHdcpLevel:i}=this;if(e=-1===r&&null!=t&&t.length?t.length-1:r,i)for(let r=e;r--;){let e=t[r].attrs["HDCP-LEVEL"];if(e&&e<=i)return r}return e}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){let e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){let e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){let e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){let t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){let e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){let e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){let e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){let t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){let e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){let t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!(null!=(e=this.bufferController)&&e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){return ex(e,eP(t),navigator.mediaCapabilities)}}aX.defaultConfig=void 0}};