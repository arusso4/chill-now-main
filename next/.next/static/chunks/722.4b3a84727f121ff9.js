"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[722],{8722:(e,t,s)=>{s.r(t),s.d(t,{default:()=>I});var r=s(5155),n=s(2115),o=s(3312),a=s(3900),i=s(1868),l=s(1567);let c=n.forwardRef((e,t)=>{let{className:s,children:n,...o}=e;return(0,r.jsxs)(i.bL,{ref:t,className:(0,l.cn)("relative overflow-hidden",s),...o,children:[(0,r.jsx)(i.LM,{className:"h-full w-full rounded-[inherit]",children:n}),(0,r.jsx)(d,{}),(0,r.jsx)(i.OK,{})]})});c.displayName=i.bL.displayName;let d=n.forwardRef((e,t)=>{let{className:s,orientation:n="vertical",...o}=e;return(0,r.jsx)(i.VM,{ref:t,orientation:n,className:(0,l.cn)("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...o,children:(0,r.jsx)(i.lr,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=i.VM.displayName;var u=s(7410),m=s(767),h=s(1466),g=s(8283),p=s(9271),f=s(2818);class y{getApiKey(){return null===this.apiKey&&(this.apiKey=f.env.NEXT_PUBLIC_OPENAI_API_KEY||""),this.apiKey}async sendMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2?arguments[2]:void 0,r=this.getApiKey();if(!r)throw Error("OpenAI API key not configured");let n=[];s&&n.push({role:"system",content:s}),n.push(...t),n.push({role:"user",content:e});try{var o,a,i;let e=await fetch("".concat(this.baseURL,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({model:"gpt-4",messages:n,max_tokens:500,temperature:.7,stream:!1})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error("OpenAI API error: ".concat(e.status," - ").concat((null===(i=t.error)||void 0===i?void 0:i.message)||e.statusText))}let t=await e.json();return(null===(a=t.choices[0])||void 0===a?void 0:null===(o=a.message)||void 0===o?void 0:o.content)||"Sorry, I couldn't generate a response."}catch(e){throw console.error("OpenAI API error:",e),e}}formatConversationHistory(e){return e.map(e=>({role:"user"===e.sender?"user":"assistant",content:e.text}))}constructor(){this.apiKey=null,this.baseURL="https://api.openai.com/v1"}}new y;var b=s(4586);class x{getSessionId(){let e=localStorage.getItem("chat_session_id");return e||(e=crypto.randomUUID(),localStorage.setItem("chat_session_id",e)),e}async saveMessage(e,t){try{let s=this.getSessionId(),{error:r}=await b.N.from("chat_history").insert({session_id:s,message:e,sender:t});if(r)return console.error("Error saving message to Supabase:",r),!1;return console.log("✅ Message saved to Supabase: ".concat(t,' - "').concat(e.substring(0,50)).concat(e.length>50?"...":"",'"')),!0}catch(e){return console.error("Error in saveMessage:",e),!1}}async getSessionHistory(e){try{let t=e||this.getSessionId(),{data:s,error:r}=await b.N.from("chat_history").select("*").eq("session_id",t).order("timestamp",{ascending:!0});if(r)return console.error("Error fetching chat history:",r),[];return console.log("\uD83D\uDCDA Retrieved ".concat((null==s?void 0:s.length)||0," messages for session: ").concat(t)),(s||[]).map(e=>({...e,sender:e.sender}))}catch(e){return console.error("Error in getSessionHistory:",e),[]}}async getSessionHistoryByDateRange(e,t){try{let{data:s,error:r}=await b.N.from("chat_history").select("*").gte("timestamp",e.toISOString()).lte("timestamp",t.toISOString()).order("timestamp",{ascending:!0});if(r)return console.error("Error fetching chat history by date range:",r),[];return(s||[]).map(e=>({...e,sender:e.sender}))}catch(e){return console.error("Error in getSessionHistoryByDateRange:",e),[]}}getCurrentSessionId(){return this.getSessionId()}clearSession(){localStorage.removeItem("chat_session_id"),console.log("\uD83D\uDDD1️ Chat session cleared")}}let v=new x;class w{getWelcomeMessage(){return{message:"Yo. I'm The Plug. \uD83D\uDD0C\n\nLooking for cannabis drinks, snacks, or that chill-next-level?\n\nHit me with what you need."}}processMessage(e){this.interactionCount++;let t=e.toLowerCase().trim();return this.interactionCount>=3&&!this.hasAskedForEmail?(this.hasAskedForEmail=!0,{message:"Want early access to drops? \uD83D\uDC40\n\nDrop your email and I'll plug you in.",action:"email_capture"}):this.isPopularDrinkQuestion(t)?this.getPopularDrinksResponse():this.isOrderTrackingQuestion(t)?this.getOrderTrackingResponse():this.isSleepQuestion(t)?this.getSleepProductsResponse():this.isHumanSupportQuestion(t)?this.getHumanSupportResponse():this.isProductQuestion(t)?this.getProductRecommendations(t):this.getDefaultResponse()}isPopularDrinkQuestion(e){return["popular","best","drink","beverage","favorite","top"].some(t=>e.includes(t))}isOrderTrackingQuestion(e){return["track","order","delivery","where","status","shipping"].some(t=>e.includes(t))}isSleepQuestion(e){return["sleep","bed","night","insomnia","rest","relax"].some(t=>e.includes(t))}isHumanSupportQuestion(e){return["human","person","talk","speak","agent","representative","support"].some(t=>e.includes(t))}isProductQuestion(e){return["product","item","thing","recommend","suggest","what","show"].some(t=>e.includes(t))}getPopularDrinksResponse(){let e=this.products.filter(e=>"drink"===e.category).slice(0,2),t="\uD83D\uDD25 Here's what's hitting hard right now:\n\n";return e.forEach((e,s)=>{t+="".concat(s+1,". **").concat(e.name,"**\n"),t+="   ".concat(e.description,"\n\n")}),{message:t+="Want to see more? Hit me with 'show me drinks' or check out the marketplace.",action:"product_showcase",data:{products:e,category:"drinks"}}}getOrderTrackingResponse(){return{message:"I got you — hit [Track Order] or type your order number.\n\nIf you don't have an order number, hit me up and I'll connect you with the crew.",action:"track_order"}}getSleepProductsResponse(){let e=this.products.filter(e=>e.tags.some(e=>["sleep","relaxation"].includes(e))),t="\uD83D\uDE34 Need that deep sleep? Here's what'll knock you out:\n\n";return e.forEach((e,s)=>{t+="".concat(s+1,". **").concat(e.name,"**\n"),t+="   ".concat(e.description,"\n\n")}),{message:t+="Take 30-45 minutes before bed for best results. Sweet dreams! \uD83C\uDF19",action:"product_showcase",data:{products:e,category:"sleep"}}}getHumanSupportResponse(){return{message:"Cool, I'll pass you off to a human. Hang tight.\n\n*Connecting you to our support team...*",action:"human_support"}}getProductRecommendations(e){let t=[];t=e.includes("drink")||e.includes("beverage")?this.products.filter(e=>"drink"===e.category):e.includes("snack")||e.includes("food")?this.products.filter(e=>"snack"===e.category):e.includes("focus")||e.includes("work")?this.products.filter(e=>e.tags.includes("focus")):this.products.slice(0,3);let s="Here's what I'm thinking for you:\n\n";return t.forEach((e,t)=>{s+="".concat(t+1,". **").concat(e.name,"**\n"),s+="   ".concat(e.description,"\n\n")}),{message:s+="Want something specific? Just tell me what you're looking for.",action:"product_showcase",data:{products:t}}}getDefaultResponse(){let e=["Hmm, not sure what you're looking for. Try asking about drinks, snacks, sleep, or tracking orders.","I'm here to help with products, orders, and recommendations. What's on your mind?","Need something specific? I can help with product recs, order tracking, or connect you with the team.","Yo, hit me with what you need - drinks, snacks, wellness stuff, or order help."];return{message:e[Math.floor(Math.random()*e.length)]}}handleEmailCapture(e){return console.log("\uD83D\uDCE7 Email captured for The Plug:",e),{message:"\uD83D\uDD25 You're in! I'll hit you up when we drop new stuff.\n\nKeep an eye on your inbox for exclusive access and early drops."}}resetInteractionCount(){this.interactionCount=0,this.hasAskedForEmail=!1}getInteractionCount(){return this.interactionCount}constructor(){this.interactionCount=0,this.hasAskedForEmail=!1,this.products=[{name:"ChillNOW Sparkling Cannabis Water",description:"5mg THC, 0mg CBD - Perfect for social vibes",category:"drink",tags:["social","energy","sparkling"],link:"/marketplace#drinks"},{name:"Deep Sleep Gummies",description:"10mg THC, 5mg CBD - Knock out like a champ",category:"wellness",tags:["sleep","relaxation","gummies"],link:"/marketplace#wellness"},{name:"Chill Chips - Spicy Nacho",description:"Infused with 2mg THC - Snack smarter",category:"snack",tags:["snack","savory","chips"],link:"/marketplace#snacks"},{name:"Focus Fuel Tincture",description:"5mg THC, 10mg CBD - Clear mind, sharp focus",category:"wellness",tags:["focus","productivity","tincture"],link:"/marketplace#wellness"}]}}let k=new w;var N=s(2818);let I=e=>{let{initialContext:t="You are a helpful assistant for ChillNOW, a premium cannabis and wellness delivery service. \n\nYour personality:\n- Be friendly, knowledgeable, and maintain the brand's chill, slightly rebellious tone\n- Use emojis occasionally to keep the vibe light and fun\n- Be helpful with product recommendations, delivery questions, and general cannabis/wellness advice\n- Keep responses concise but informative\n- Always prioritize safety and legal compliance\n- If asked about illegal activities, politely redirect to legal alternatives\n\nKey information about ChillNOW:\n- Premium cannabis and wellness delivery service\n- Operating in legal markets only\n- Fast delivery (60 minutes or less)\n- Curated selection of products\n- Background-checked drivers\n- Lab-tested products\n- Secure, verified marketplace\n\nRemember: You're here to help users find their perfect chill while maintaining a professional, legal, and safe approach.",className:s=""}=e,[i,l]=(0,n.useState)(!1),[d,f]=(0,n.useState)([{id:"1",text:k.getWelcomeMessage().message,sender:"bot",timestamp:new Date}]),[y,x]=(0,n.useState)(""),[w,I]=(0,n.useState)(!1),S=(0,n.useRef)(null),j=(0,n.useRef)(null);if(!(N.env.NEXT_PUBLIC_OPENAI_API_KEY||N.env.NEXT_PUBLIC_OPENAI_ENABLED))return null;(0,n.useEffect)(()=>{var e;null===(e=S.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[d]),(0,n.useEffect)(()=>{i&&(j.current&&setTimeout(()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.focus()},100),d.length<=1&&C())},[i]);let C=async()=>{try{let e=await v.getSessionHistory();if(e.length>0){let t=e.map(e=>({id:e.id,text:e.message,sender:"user"===e.sender?"user":"bot",timestamp:new Date(e.timestamp)}));f(t),console.log("\uD83D\uDCDA Loaded ".concat(t.length," messages from chat history"))}}catch(e){console.error("Error loading chat history:",e)}},D=async e=>{if(!e.trim())return;let t={id:Date.now().toString(),text:e.trim(),sender:"user",timestamp:new Date};f(e=>[...e,t]),x(""),I(!0),await v.saveMessage(e.trim(),"user")||console.warn("⚠️ Failed to save user message to Supabase");try{let t=k.processMessage(e),s={id:(Date.now()+1).toString(),text:t.message,sender:"bot",timestamp:new Date};f(e=>[...e,s]),await v.saveMessage(t.message,"assistant")||console.warn("⚠️ Failed to save bot message to Supabase");try{let{error:s}=await b.N.from("plug_interactions").insert({session_id:v.getCurrentSessionId(),user_input:e.trim(),bot_response:t.message,interaction_count:k.getInteractionCount()});s?console.error("Error logging plug interaction:",s):console.log("\uD83D\uDCDD Plug interaction logged to Supabase")}catch(e){console.error("Error logging plug interaction:",e)}"email_capture"===t.action&&console.log("\uD83D\uDCE7 Email capture opportunity triggered")}catch(t){console.error("Error processing message with The Plug:",t);let e={id:(Date.now()+1).toString(),text:"Yo, something's not working right now. Hit me up again in a sec.",sender:"bot",timestamp:new Date};f(t=>[...t,e]),await v.saveMessage(e.text,"assistant")}finally{I(!1)}};return(0,r.jsxs)("div",{className:"fixed bottom-6 right-6 z-50 ".concat(s),children:[i&&(0,r.jsxs)("div",{className:"mb-4 w-80 h-96 bg-card border border-border rounded-2xl shadow-2xl overflow-hidden",children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-green-500/10 to-blue-500/10 border-b border-border p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,r.jsx)(u.A,{className:"w-4 h-4 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-bold text-foreground",children:"The Plug \uD83D\uDD0C"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Your digital budtender"})]})]}),(0,r.jsx)(o.$,{variant:"ghost",size:"sm",onClick:()=>l(!1),className:"h-8 w-8 p-0 hover:bg-accent",children:(0,r.jsx)(m.A,{className:"w-4 h-4"})})]})}),(0,r.jsx)(c,{className:"h-64 p-4",children:(0,r.jsxs)("div",{className:"space-y-4",children:[d.map(e=>(0,r.jsx)("div",{className:"flex ".concat("user"===e.sender?"justify-end":"justify-start"),children:(0,r.jsx)("div",{className:"max-w-[80%] rounded-2xl px-4 py-2 ".concat("user"===e.sender?"bg-gradient-to-r from-orange-500 to-red-500 text-white":"bg-accent text-foreground"),children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:["bot"===e.sender&&(0,r.jsx)(u.A,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm leading-relaxed",children:e.text}),(0,r.jsx)("p",{className:"text-xs opacity-70 mt-1",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),"user"===e.sender&&(0,r.jsx)(h.A,{className:"w-4 h-4 mt-0.5 flex-shrink-0"})]})})},e.id)),w&&(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)("div",{className:"bg-accent text-foreground rounded-2xl px-4 py-2",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(u.A,{className:"w-4 h-4"}),(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,r.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})}),(0,r.jsx)("div",{ref:S})]})}),(0,r.jsx)("div",{className:"border-t border-border p-4",children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),D(y)},className:"flex gap-2",children:[(0,r.jsx)(a.p,{ref:j,value:y,onChange:e=>x(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),D(y))},placeholder:"Type your message...",disabled:w,className:"flex-1 bg-background border-border focus:border-green-500"}),(0,r.jsx)(o.$,{type:"submit",size:"sm",disabled:w||!y.trim(),className:"bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700 text-white border-0",children:(0,r.jsx)(g.A,{className:"w-4 h-4"})})]})})]}),(0,r.jsx)(o.$,{onClick:()=>l(!i),className:"w-14 h-14 rounded-full shadow-2xl transition-all duration-300 transform hover:scale-110 ".concat(i?"bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600":"bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700"," text-white border-0"),children:i?(0,r.jsx)(m.A,{className:"w-6 h-6"}):(0,r.jsx)(p.A,{className:"w-6 h-6"})})]})}},3900:(e,t,s)=>{s.d(t,{p:()=>a});var r=s(5155),n=s(2115),o=s(1567);let a=n.forwardRef((e,t)=>{let{className:s,type:n,...a}=e;return(0,r.jsx)("input",{type:n,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...a})});a.displayName="Input"},4586:(e,t,s)=>{s.d(t,{N:()=>i});var r=s(1106),n=s(2818);let o=n.env.NEXT_PUBLIC_SUPABASE_URL||"https://mpcxzgufotmzqovzorgx.supabase.co",a=n.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1wY3h6Z3Vmb3RtenFvdnpvcmd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI4NDMwNzUsImV4cCI6MjA2ODQxOTA3NX0.miiBlg19EmRdTKQ4S4vhmmaV2ZkQ9ys9bOrPNy92RrQ",i=(0,r.UU)(o,a,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}})}}]);